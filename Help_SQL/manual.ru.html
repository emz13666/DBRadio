  <HTML>
  <HEAD>
  
  <TITLE>Справочное руководство по MySQL версии 5.0.0-alpha.</TITLE>
   <style> code {color:purple} tt {color:green} samp {color:navy} pre {color:maroon} </style> <meta http-equiv="Content-Type" content="text/html; charset=koi8-r">
  </HEAD>
  <BODY BGCOLOR=white TEXT=#000000 LINK=#101090 VLINK=#7030B0>
<H1>Справочное руководство по MySQL версии 5.0.0-alpha.</H1>
<P>
<P><HR><P>


<H1><A NAME="Introduction" HREF="manual.ru_toc.html#Introduction">1  Общая информация</A></H1>

<P>
<A NAME="IDX1"></A>
<A NAME="IDX2"></A>

</P>
<P>
Программное обеспечение <code>MySQL (TM)</code> представляет собой очень быстрый
многопоточный, многопользовательский надежный <code>SQL</code>-сервер баз данных (SQL -
язык структурированных запросов). Сервер MySQL предназначен как для
критических по задачам производственных систем с большой нагрузкой, так и
для встраивания в программное обеспечение массового распространения.

</P>
<P>
MySQL - это торговая марка MySQL АВ.

</P>
<P>
Программное обеспечение MySQL имеет <code>двойное лицензирование</code>. Это означает,
что пользователи могут выбирать, использовать ли ПО MySQL бесплатно по общедоступной лицензии <code>GNU
General Public License</code> (<code>GPL</code>) или приобрести одну из стандартных коммерческих лицензий MySQL AB.
(<a HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>).

</P>
<P>
Для получения самой свежей информации о программном обеспечении MySQL
обращайтесь на веб-сайт MySQL (<a HREF="http://www.mysql.com/">http://www.mysql.com/</a>).

</P>
<P>
Ниже перечислены наиболее интересные разделы данного руководства.

</P>

<UL>
<LI>

Информация о компании, которая занимается разработкой и
распространением ПО MySQL, находится в разделе section <A HREF="manual.ru.html#What_is_MySQL_AB">1.5  Что представляет собой компания MySQL AB?</A>.

<LI>

Основные возможности сервера MySQL рассматриваются в разделе section <A HREF="manual.ru.html#Features">1.4.2  Основные возможности MySQL</A>.

<LI>

Инструкции по инсталляции приведены в разделе section <A HREF="manual.ru.html#Installing">2  Установка MySQL</A>.

<LI>

Советы по переносу на другие архитектуры и операционные системы вы
найдете в разделе section <A HREF="manual.ru.html#Porting">D  Перенос на другие системы</A>.

<LI>

Информация по апгрейду с версии 3.23 находится в разделе section <A HREF="manual.ru.html#Upgrading-from-3.23">2.5.2  Модернизация с версии 3.23 до версии 4.0</A>

<LI>

Информация по апгрейду с версии 3.22 находится в разделе section <A HREF="manual.ru.html#Upgrading-from-3.22">2.5.3  Модернизация с версии 3.22 до версии 3.23</A>

<LI>

Введение в обучающий курс по серверу MySQL см. в разделе section <A HREF="manual.ru.html#Tutorial">3  Учебное пособие по MySQL</A>.

<LI>

Примеры по SQL и данные по тестам производительности находятся в
директории тестов производительности  (<tt>`sql-bench'</tt> в дистрибутиве).

<LI>

Информацию о новых возможностях и об исправлениях ошибок см. в разделе
section <A HREF="manual.ru.html#News">C  История изменений и обновлений MySQL</A>.

<LI>

Список известных на сегодняшний день ошибок и конструктивных дефектов
см. в разделе section <A HREF="manual.ru.html#Bugs">1.9.5  Известные ошибки и недостатки проектирования в MySQL</A>.

<LI>

Планы развития MySQL см. в разделе section <A HREF="manual.ru.html#TODO">1.10  MySQL и будущее (что предстоит сделать)</A>.

<LI>

Полный список тех людей, которые сделали вклад в наш проект, вы
найдете в разделе section <A HREF="manual.ru.html#Credits">B  Благодарности</A>.
</UL>

<P>
<strong>Что важно</strong>:

</P>
<P>
Отчеты об ошибках (bugs), а также вопросы и комментарии следует посылать
по адресу <a HREF="mailto:mysql@lists.mysql.com">mysql@lists.mysql.com</a>. See section <A HREF="manual.ru.html#Bug_reports">1.8.1.3  Как отправлять отчеты об ошибках или проблемах</A>. Для
составления отчетов об ошибках следует использовать сценарий <code>mysqlbug</code>. В
поставках исходного текста сценарий <code>mysqlbug</code> находится в директории
<code>scripts</code>. Если у вас бинарная поставка, то сценарий <code>mysqlbug</code> следует
искать в директории <tt>`bin'</tt>. 

</P>
<P>
Если вы обнаружите существенную ошибку, относящуюся к безопасности в сервере
MySQL, следует сообщить об этом по адресу: <a HREF="mailto:security@mysql.com">security@mysql.com</a>.

</P>
<P>
<A NAME="IDX3"></A>
<A NAME="IDX4"></A>
<A NAME="IDX5"></A>
<A NAME="IDX6"></A>

</P>



<H2><A NAME="Manual-info" HREF="manual.ru_toc.html#Manual-info">1.1  Об этом руководстве</A></H2>

<P>
<A NAME="IDX7"></A>
<A NAME="IDX8"></A>

</P>
<P>
Это - справочное руководство по MySQL; оно представляет собой документацию по
MySQL версии 5.0.0-alpha. Функциональные изменения отмечены номером 
версии, в которой они произведены, поэтому это руководство будет полезно
при освоении также и более старых версий MySQL. 

</P>
<P>
Поскольку данный материал носит чисто справочный характер, в нем не содержится
основных положений SQL или сведений по реляционным базам данных.

</P>
<P>
Руководство часто обновляется, поскольку ПО СУБД MySQL находится в
состоянии постоянного развития. Самая последняя версия данного руководства
доступна по адресу <a HREF="http://www.mysql.com/documentation/">http://www.mysql.com/documentation/</a> в различных
форматах, включая HTML, PDF и Windows HLP.

</P>
<P>
Исходным документом для всех версий документации является файл Texinfo.
HTML-версия генерируется автоматически модифицированной версией <code>texi2html</code>. 
Текстовая и Info-версии генерируются при помощи <code>makeinfo</code>,
PostScript-версия создается <code>texi2dvi</code> и <code>dvips</code>. PDF-версия генерируется с
помощью <code>pdftex</code>.

</P>
<P>
Если найти нужную информацию в руководстве не удается, можно прибегнуть к
помощи версии руководства с функцией поиска, находящейся по адресу
<a HREF="http://www.mysql.com/doc/">http://www.mysql.com/doc/</a>.

</P>
<P>
Группа, работающая над документацией, рассмотрит любые предложения по
дополнению или исправлению данного руководства. Их следует отправлять по
адресу <a HREF="mailto:docs@mysql.com">docs@mysql.com</a>.

</P>
<P>
Данное руководство было изначально написано Дэвидом Аксмарком (David
Axmark) и Майклом (Монти) Видениусом (Michael (Monty) Widenius). Сейчас 
это руководство поддерживается Майклом (Монти) Видениусом, Полом
Дюбуа (Paul DuBois), Арйен Ленц (Arjen Lentz). Остальные разработчики упомянуты
в разделе section <A HREF="manual.ru.html#Credits">B  Благодарности</A>.

</P>
<P>
<A NAME="IDX9"></A>
<A NAME="IDX10"></A>

</P>
<P>
Авторское право (2003) на данное руководство принадлежит шведской компании
MySQL AB. See section <A HREF="manual.ru.html#Copyright">1.6.2  Авторские права и лицензии на MySQL</A>.

</P>



<H2><A NAME="Manual_conventions" HREF="manual.ru_toc.html#Manual_conventions">1.2  Соглашения, используемые в данном руководстве</A></H2>

<P>
В данном руководстве используются следующие обозначения:

</P>
<P>
<A NAME="IDX11"></A>
<A NAME="IDX12"></A>
<A NAME="IDX13"></A>

</P>
<DL COMPACT>

<DT><code>Моноширинный</code>
<DD>
Для имен команд и опций; SQL-операторов; имен баз данных, таблиц,
столбцов; кода на C и Perl, переменных окружения применяется моноширинный
шрифт. Например: ''Чтобы увидеть, как работает <code>mysqladmin</code>, запустите его с
опцией <code>--help</code>.''

<DT><tt>`filename'</tt>
<DD>
Моноширинный шрифт и кавычки используются для имен файлов и путей. Например: "Дистрибутив устанавливается в каталог <tt>`/usr/local/'</tt>". 

<DT><samp>`c'</samp>
<DD>
Для представления последовательности символов используется моноширинный
шрифт, а сама последовательность символов заключается в кавычки. Например:
"Для задания шаблонного символа используется символ <samp>`%'</samp>".

<DT><em>Курсив</em>
<DD>
Курсив используется для выделения текста, <em>подобно данному</em>.

<DT><strong>полужирный шрифт</strong>
<DD>
Полужирный шрифт используется для заголовков таблиц и для того, чтобы
<strong>особо выделить фрагмент текста</strong>.
</DL>

<P>
Если нужно показать, что приведенная команда должна выполняться
определенной программой, она предваряется подсказкой с именем этой
программы. Например, <code>shell&#62;</code> указывает, что команда будет выполняться
вашей оболочкой, а <code>mysql&#62;</code> означает, что команда будет выполняться
клиентской программой mysql:

</P>

<PRE>
shell&#62; набирайте команды оболочки здесь
mysql&#62; набирайте SQL-операторы здесь
</PRE>

<P>
Для представления команд оболочки в данном руководстве применяется
синтаксис оболочки Bourne. Если у вас используется <code>csh</code>-оболочка, синтаксис
для нее будет несколько отличаться. Например, последовательность команд
для установки переменной окружения и запуска команды в синтаксисе оболочки
Bourne выглядит следующим образом:

</P>

<PRE>
shell&#62; ПЕРЕМЕННАЯ=значение некая_команда
</PRE>

<P>
<A NAME="IDX14"></A>
<A NAME="IDX15"></A>

</P>
<P>
В случае <code>csh</code>-оболочки для выполнения тех же действий вам потребуются
следующие команды:

</P>

<PRE>
shell&#62; setenv ПЕРЕМЕННАЯ значение
shell&#62; некая_команда
</PRE>

<P>
Часто в командах имена баз данных, таблиц, столбцов следует заменять
конкретными значениями. Чтобы показать необходимость такой замены, в
данном руководстве используются выражения типа <code>db_name</code> (имя базы данных),
<code>table_name</code> (имя таблицы) и <code>col_name</code> (имя столбца). Например, в тексте
руководства может встретиться оператор, подобный следующему:

</P>

<PRE>
mysql&#62; SELECT col_name FROM db_name.table_name;
</PRE>

<P>
Это означает, что при вводе такого оператора вам необходимо будет указать
собственную базу данных, имя таблицы и имя столбца, например:

</P>

<PRE>
mysql&#62; SELECT author_name FROM biblio_db.author_list;
</PRE>

<P>
Ключевые слова SQL являются нечувствительными к регистру, поэтому их можно
записывать, используя как прописные, так и строчные буквы. В данном
руководстве используется регистр прописных букв.

</P>
<P>
Для представления необязательных слов и выражений в синтаксических
описаниях используются квадратные скобки (<samp>`['</samp> и <samp>`]'</samp>). Например, в
приведенном ниже операторе выражение <code>IF EXISTS</code> является необязательным:

</P>

<PRE>
DROP TABLE [IF EXISTS] имя_таблицы
</PRE>

<P>
Если элемент синтаксиса состоит из ряда альтернативных элементов,
последние отделяются друг от друга вертикальными чертами (<samp>`|'</samp> ). В случае,
когда может быть выбран один элемент из такого ряда, альтернативные
элементы заключаются в квадратные скобки (<samp>`['</samp> и <samp>`]'</samp>):

</P>

<PRE>
TRIM([[BOTH | LEADING | TRAILING] [remstr] FROM] str)
</PRE>

<P>
В случае, когда должен быть выбран один элемент из такого ряда,
альтернативные элементы заключаются в фигурные скобки (<samp>`{'</samp> и <samp>`}'</samp>):

</P>

<PRE>
{DESCRIBE | DESC } имя_таблицы {имя_столбца | wild}
</PRE>



<H2><A NAME="About_russian" HREF="manual.ru_toc.html#About_russian">1.3  О русском переводе руководства</A></H2>

<P>
Русский перевод документации на ПО СУБД MySQL выполнен в 2002-2003гг. 
компанией Ensita.NET (<a HREF="http://www.ensita.net/">http://www.ensita.net/</a>). 

</P>
<P>
<strong>Переводчики:</strong> (в алфавитном порядке) Василюк Елена, Добродеев Сергей, Закиянов Денис, Коротун
Юрий, Пономарев Алексей, Ченцов Алексей; а также Жданов Сергей (раздел
"Интерфейс <code>DBI</code>").

</P>
<P>
<strong>Научная редакция:</strong> Егор Егоров, Людмила Мезенко, Виктория Резниченко.

</P>
<P>
<strong>Литературный редактор:</strong> Людмила Мезенко (the best!)

</P>
<P>
<strong>Главный редактор перевода:</strong> Егор Егоров

</P>
<P>
Все замечания по русской документации направляйте по адресу <a HREF="mailto:docs-team@ensita.net">docs-team@ensita.net</a>.

</P>
<P>
* * * * * 

</P>
<P>
Компания Ensita.NET (<a HREF="http://www.ensita.net/">http://www.ensita.net/</a>), являясь официальным
партнером MySQL AB с января 2002г. консультирует пользователей ПО СУБД MySQL по
всему миру, поддерживая список рассылки <code>mysql@lists.mysql.com</code>
(see section <A HREF="manual.ru.html#Mailing-list">1.8.1.1  Списки рассылки MySQL</A>). 

</P>
<P>
Ensita.NET с 1999г. занимается разработкой программного обеспечения для веб-сайтов, 
обслуживанием СУБД и консалтингом. 

</P>



<H3><A NAME="Russian-terms" HREF="manual.ru_toc.html#Russian-terms">1.3.1  Список терминов, принятых в русском переводе</A></H3>

<P>
Редакционная коллегия при подготовке этого перевода старалась как можно адекватнее
перевести специфические термины с английского языка на русский. Нами была 
поставлена цель создать справочное руководство на живом и понятном языке, но в то
же время не переходить на чистый сленг. Поэтому терминология, принятая в этом
переводе, возможно, не полностью соответствует четким терминам, принятым 
в русскоязычной литературе на "около-реляционную" тему. 

</P>
<P>
Для ясности понимания мы включаем в документацию список принятых в этом 
переводе терминов.

</P>

<TABLE BORDER>
<TR><TD><strong>Термин</strong> </TD><TD> <strong>Значение</strong>
</TD></TR>
<TR><TD>account </TD><TD> аккаунт, учетная запись
</TD></TR>
<TR><TD>ACL </TD><TD> списки контроля доступа
</TD></TR>
<TR><TD>banner </TD><TD> баннер
</TD></TR>
<TR><TD>benchmark page </TD><TD> страничка тестов производительности
</TD></TR>
<TR><TD>Berkeley-style copyright </TD><TD> лицензия наподобие Berkeley
</TD></TR>
<TR><TD>binary release, binary distribution </TD><TD> бинарная поставка, двоичная поставка
</TD></TR>
<TR><TD>cache </TD><TD> кэш
</TD></TR>
<TR><TD>case sensitive </TD><TD> чувствительный к регистру, регистро-зависимый
</TD></TR>
<TR><TD>change history </TD><TD> история изменений
</TD></TR>
<TR><TD>charset </TD><TD> набор символов, кодировка
</TD></TR>
<TR><TD>client/server </TD><TD> клиент-серверный
</TD></TR>
<TR><TD>command-line tool </TD><TD> утилита командной строки
</TD></TR>
<TR><TD>commit </TD><TD> принять; <em>commit transaction - принять транзакцию</em>
</TD></TR>
<TR><TD>communication protocol </TD><TD> коммуникационный протокол
</TD></TR>
<TR><TD>contact form </TD><TD> форма. <em>fill in the contact form - заполните форму</em>
</TD></TR>
<TR><TD>data dir </TD><TD> каталог с данными
</TD></TR>
<TR><TD>datadir, data dir </TD><TD> каталог datadir, каталог данных
</TD></TR>
<TR><TD>date type </TD><TD> тип даты
</TD></TR>
<TR><TD>DBA </TD><TD> администратор (физическое лицо)
</TD></TR>
<TR><TD>dbms </TD><TD> см. rdbms
</TD></TR>
<TR><TD>ddos </TD><TD> distributed dos - распределенная атака создания отказа в обслуживании
</TD></TR>
<TR><TD>denial of service </TD><TD> отказ в обслуживании
</TD></TR>
<TR><TD>deployment </TD><TD> распространение
</TD></TR>
<TR><TD>distribution </TD><TD> поставка, дистрибутив
</TD></TR>
<TR><TD>distributor </TD><TD> производитель
</TD></TR>
<TR><TD>dos </TD><TD> см. denial of service
</TD></TR>
<TR><TD>embedded </TD><TD> встраиваемый. <strong>Не "встроенный"</strong>
</TD></TR>
<TR><TD>environment variables </TD><TD> переменные окружения
</TD></TR>
<TR><TD>escape chars </TD><TD> символы экранирования
</TD></TR>
<TR><TD>escaped chars </TD><TD> экранированные символы
</TD></TR>
<TR><TD>extended regular expression </TD><TD> расширенное регулярное выражение
</TD></TR>
<TR><TD>fail-safe </TD><TD> отказобезопасный
</TD></TR>
<TR><TD>feature </TD><TD> возможность, особенность
</TD></TR>
<TR><TD>firewall </TD><TD> брандмауэр
</TD></TR>
<TR><TD>flush </TD><TD> сброс, очистка, перегрузка
</TD></TR>
<TR><TD>foreign key constraint </TD><TD> ограничения внешних ключей
</TD></TR>
<TR><TD>full precision </TD><TD> полная точность
</TD></TR>
<TR><TD>full-text </TD><TD> полнотекстовый
</TD></TR>
<TR><TD>grant tables </TD><TD> таблицы привилегий
</TD></TR>
<TR><TD>grants </TD><TD> привилегии
</TD></TR>
<TR><TD>group </TD><TD> группа, группировка
</TD></TR>
<TR><TD>group functions </TD><TD> групповые функции, операции группировки данных, операции над групповыми данными
</TD></TR>
<TR><TD>host </TD><TD> удаленный компьютер
</TD></TR>
<TR><TD>inserting data </TD><TD> добавление, вставка данных
</TD></TR>
<TR><TD>join </TD><TD> связь
</TD></TR>
<TR><TD>join optimizer </TD><TD> оптимизатор связей
</TD></TR>
<TR><TD>key cache </TD><TD> кэш ключей
</TD></TR>
<TR><TD>large-scale </TD><TD> широкомасштабный
</TD></TR>
<TR><TD>license </TD><TD> лицензция
</TD></TR>
<TR><TD>link </TD><TD> линкование (в контексте линкования компиляции программ)
</TD></TR>
<TR><TD>localhost, local host </TD><TD> локальный хост, локальный компьютер
</TD></TR>
<TR><TD>locking </TD><TD> блокировка
</TD></TR>
<TR><TD>log </TD><TD> журнал
</TD></TR>
<TR><TD>log position </TD><TD> точка положения в журнале репликации
</TD></TR>
<TR><TD>login </TD><TD> см. account
</TD></TR>
<TR><TD>login shell </TD><TD> первая оболочка входа (login shell)
</TD></TR>
<TR><TD>master </TD><TD> (репликация) головной сервер
</TD></TR>
<TR><TD>miscellaneous </TD><TD> разнообразный
</TD></TR>
<TR><TD>multi-byte </TD><TD> мультибайтный
</TD></TR>
<TR><TD>multi-layered </TD><TD> многоуровневый
</TD></TR>
<TR><TD>multithread </TD><TD> многопоточный
</TD></TR>
<TR><TD>mysql server </TD><TD> MySQL или сервер
</TD></TR>
<TR><TD>mysql user </TD><TD> пользователь MySQL
</TD></TR>
<TR><TD>non-updating queries </TD><TD> запросы, не изменяющие информацию
</TD></TR>
<TR><TD>null </TD><TD> null
</TD></TR>
<TR><TD>open source </TD><TD> система с открытым кодом (open source)
</TD></TR>
<TR><TD>optional </TD><TD> опциональный
</TD></TR>
<TR><TD>parser </TD><TD> синтаксический анализатор
</TD></TR>
<TR><TD>patch </TD><TD> патч
</TD></TR>
<TR><TD>port listening </TD><TD> слушание порта, слушать порт, ожидать соединение на порту
</TD></TR>
<TR><TD>privacy </TD><TD> конфиденциальность
</TD></TR>
<TR><TD>privilege </TD><TD> привилегии
</TD></TR>
<TR><TD>qualifier </TD><TD> определитель
</TD></TR>
<TR><TD>qualify </TD><TD> определять
</TD></TR>
<TR><TD>rdbms </TD><TD> система управления реляционными базами данных
</TD></TR>
<TR><TD>reference manual </TD><TD> справочник, руководство
</TD></TR>
<TR><TD>regular client </TD><TD> обычный клиент
</TD></TR>
<TR><TD>regular expression </TD><TD> регулярное выражение; extended - расширенное р.в.
</TD></TR>
<TR><TD>released under gpl </TD><TD> выпущено под лицензией GPL
</TD></TR>
<TR><TD>replica (server) </TD><TD> сервер с копиями
</TD></TR>
<TR><TD>robustness </TD><TD> надежность, отказоустойчивость
</TD></TR>
<TR><TD>rollback </TD><TD> откат
</TD></TR>
<TR><TD>rotation </TD><TD> ротация
</TD></TR>
<TR><TD>row-level locking </TD><TD> строчная блокировка
</TD></TR>
<TR><TD>scope </TD><TD> контекст
</TD></TR>
<TR><TD>script </TD><TD> сценарий, скрипт
</TD></TR>
<TR><TD>security </TD><TD> безопасность
</TD></TR>
<TR><TD>security issues </TD><TD> вопросы безопасности
</TD></TR>
<TR><TD>SET </TD><TD> множество
</TD></TR>
<TR><TD>silent </TD><TD> молчаливо
</TD></TR>
<TR><TD>slave </TD><TD> (репликация) подчиненный сервер
</TD></TR>
<TR><TD>snapshop </TD><TD> образ, снимок
</TD></TR>
<TR><TD>socket </TD><TD> сокет
</TD></TR>
<TR><TD>ssh port-forwarding </TD><TD> пересылка по SSH (SSH port-forwarding)
</TD></TR>
<TR><TD>SSL connections </TD><TD> SSL-соединения
</TD></TR>
<TR><TD>sticky </TD><TD> прилипчив
</TD></TR>
<TR><TD>superuser </TD><TD> суперпользователь
</TD></TR>
<TR><TD>symbol table </TD><TD> см. charset
</TD></TR>
<TR><TD>symbol value </TD><TD> строкое значение
</TD></TR>
<TR><TD>symlink </TD><TD> символическая ссылка
</TD></TR>
<TR><TD>table handler </TD><TD> обработчик таблиц
</TD></TR>
<TR><TD>thread </TD><TD> поток
</TD></TR>
<TR><TD>time stamp </TD><TD> временная метка
</TD></TR>
<TR><TD>timestamp </TD><TD> тип данных временной метки
</TD></TR>
<TR><TD>TODO-list </TD><TD> список задач к выполнению
</TD></TR>
<TR><TD>track </TD><TD> последовательность, протокол
</TD></TR>
<TR><TD>transactional </TD><TD> транзакционный
</TD></TR>
<TR><TD>trick </TD><TD> трюк, хитрость
</TD></TR>
<TR><TD>unix socket, unix domain socket </TD><TD> unix-сокет
</TD></TR>
<TR><TD>up-to-date </TD><TD> своевременный
</TD></TR>
<TR><TD>utilities </TD><TD> инструментальные программы
</TD></TR>
<TR><TD>vendor </TD><TD> поставщик
</TD></TR>
<TR><TD>verbose </TD><TD> расширенный режим вывода сообщений
</TD></TR>
<TR><TD>voting algorithm </TD><TD> алгоритм голосования
</TD></TR>
<TR><TD>warning </TD><TD> предупреждение
</TD></TR>
<TR><TD>wildcard </TD><TD> шаблон, шаблонные символы
</TD></TR>
<TR><TD>wrapper </TD><TD> оболочка
</TD></TR>
</TABLE>



<H2><A NAME="What-is" HREF="manual.ru_toc.html#What-is">1.4  Что представляет собой MySQL?</A></H2>

<P>
<A NAME="IDX16"></A>
<A NAME="IDX17"></A>

</P>
<P>
Разработку и сопровождение MySQL, самой популярной SQL-базы данных с открытым
кодом, осуществляет компания MySQL AB. MySQL AB - коммерческая компания,
основанная разработчиками MySQL, строящая свой бизнес, предоставляя различные
сервисы для СУБД MySQL. See section <A HREF="manual.ru.html#What_is_MySQL_AB">1.5  Что представляет собой компания MySQL AB?</A>.

</P>
<P>
На веб-сайте MySQL (<a HREF="http://www.mysql.com/">http://www.mysql.com/</a>) представлена самая свежая
информация о программном обеспечении MySQL и о компании MySQL AB.

</P>
<DL COMPACT>

<DT>MySQL - это система управления базами данных.
<DD>
База данных представляет собой структурированную совокупность данных. Эти
данные могут быть любыми - от простого списка предстоящих покупок до
перечня экспонатов картинной галереи или огромного количества информации в
корпоративной сети. Для записи, выборки и обработки данных, хранящихся в
компьютерной базе данных, необходима система управления базой данных,
каковой и является ПО MySQL. Поскольку компьютеры замечательно справляются
с обработкой больших объемов данных, управление базами данных играет
центральную роль в вычислениях. Реализовано такое управление может быть
по-разному - как в виде отдельных утилит, так и в виде кода, входящего в
состав других приложений.

<A NAME="IDX18"></A>

<DT>MySQL - это система управления реляционными базами данных.
<DD>
В реляционной базе данных данные хранятся не все скопом, а в отдельных
таблицах, благодаря чему достигается выигрыш в скорости и гибкости.
Таблицы связываются между собой при помощи отношений, благодаря чему
обеспечивается возможность объединять при выполнении запроса данные из
нескольких таблиц. <code>SQL</code> как часть системы MySQL можно охарактеризовать как
<code>язык структурированных запросов</code> плюс наиболее распространенный
стандартный язык, используемый для доступа к базам данных.

<A NAME="IDX19"></A>
<A NAME="IDX20"></A>

<DT>Программное обеспечение MySQL - это ПО с открытым кодом.
<DD>
ПО с открытым кодом означает, что применять и модифицировать его может
любой желающий. Такое ПО можно получать по Internet и использовать
бесплатно. При этом каждый пользователь может изучить исходный код и
изменить его в соответствии со своими потребностями. Использование
программного обеспечения MySQL регламентируется лицензией <code>GPL</code> (<code>GNU General
Public License</code>), <a HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>, в которой указано, что
можно и чего нельзя делать с этим программным обеспечением в различных
ситуациях. Если работа в рамках <code>GPL</code> вас не устраивает или планируется
встраивание MySQL-кода в коммерческое приложение, есть возможность купить
коммерческую лицензированную версию у компании MySQL AB. See section <A HREF="manual.ru.html#MySQL_licenses">1.6.3  Лицензии на ПО MySQL</A>.

<A NAME="IDX21"></A>
<A NAME="IDX22"></A>

<DT>В каких случаях следует отдавать предпочтение СУБД MySQL?
<DD>
MySQL является очень быстрым, надежным и легким в использовании. Если вам
требуются именно эти качества, попробуйте поработать с данным сервером.
<code>MySQL</code> обладает также рядом удобных возможностей, разработанных в
тесном контакте с пользователями. Сравнительные характеристики MySQL и
других средств управления базами данных приведены на нашей странице тестов
производительности (see section <A HREF="manual.ru.html#MySQL_Benchmarks">5.1.4  Набор тестов MySQL (The MySQL Benchmark Suite)</A>).

Первоначально сервер MySQL разрабатывался для управления большими базами данных с целью
обеспечить более высокую скорость работы по сравнению с существующими на
тот момент аналогами. И вот уже в течение нескольких лет данный сервер
успешно используется в условиях промышленной эксплуатации с высокими
требованиями. Несмотря на то что MySQL постоянно совершенствуется, он уже
сегодня обеспечивает широкий спектр полезных функций. Благодаря своей
доступности, скорости и безопасности MySQL очень хорошо подходит для
доступа к базам данных по Internet.

<DT>Технические возможности СУБД MySQL
<DD>
Более детальную информацию по техническим возможностям MySQL можно
получить в разделе section <A HREF="manual.ru.html#Reference">6  Справочник по языку MySQL</A>. <code>ПО MySQL</code> является системой
клиент-сервер, которая содержит многопоточный <code>SQL</code>-сервер, обеспечивающий
поддержку различных вычислительных машин баз данных, а также несколько
различных клиентских программ и библиотек, средства администрирования и
широкий спектр программных интерфейсов (<code>API</code>).

Мы также поставляем сервер MySQL в виде многопоточной библиотеки, которую можно подключить к
пользовательскому приложению и получить компактный, более быстрый и легкий
в управлении продукт.

<DT>Доступно также большое количество программного обеспечения MySQL,
<DD>
разработанного сторонними разработчиками.

Вполне возможно, что СУБД <code>MySQL</code> уже поддерживается вашим
любимым приложением или языком.

</DL>

<P>
<A NAME="IDX23"></A>
<A NAME="IDX24"></A>
<A NAME="IDX25"></A>

</P>

<P>
MySQL правильно произносится как ''Май Эс Кью Эль'' (а не ''майсиквел''),
хотя никто не запрещает вам произносить эту аббревиатуру как ``майсиквел''
или еще каким-либо образом.

</P>



<H3><A NAME="History" HREF="manual.ru_toc.html#History">1.4.1  История MySQL</A></H3>

<P>
<A NAME="IDX26"></A>
<A NAME="IDX27"></A>
<A NAME="IDX28"></A>

</P>
<P>
В один прекрасный день мы  решили применить mSQL для доступа к нашим
таблицам, для которых использовались собственные быстрые (<code>ISAM</code>)
подпрограммы низкого уровня. Однако после тестирования мы пришли к
заключению, что для наших целей скорость и гибкость mSQL недостаточны.
В результате для базы данных был разработан новый SQL-интерфейс, но почти
с тем же API-интерфейсом, что и mSQL. Этот API мы выбрали, чтобы
упростить перенос на код сторонних разработчиков.

</P>
<P>
Происхождение имени MySQL не совсем ясно. Уже около 10 лет наша основная
директория и большое количество библиотек и инструментария имеют префикс
<tt>`my'</tt>. Более того, дочь Монти (она несколькими годами моложе) тоже
получила имя My! Что из этих двух факторов повлияло на имя - до сих пор
остается загадкой, даже для разработчиков.

</P>


<H3><A NAME="Features" HREF="manual.ru_toc.html#Features">1.4.2  Основные возможности MySQL</A></H3>

<P>
<A NAME="IDX29"></A>
<A NAME="IDX30"></A>

</P>

<P>
Ниже приведено описание важных характеристик программного обеспечения
MySQL. See section <A HREF="manual.ru.html#MySQL_4.0_In_A_Nutshell">1.7  Кратко о MySQL 4.x</A>.

</P>
<DL COMPACT>

<DT>Внутренние характеристики и переносимость
<DD>

<UL>
<LI>

Написан на C и C++. Протестирован на множестве различных компиляторов.
<LI>

Работает на различных платформах. See section <A HREF="manual.ru.html#Which_OS">2.2.5  Операционные системы, поддерживаемые MySQL</A>.
<LI>

Для обеспечения переносимости используется GNU Automake,
Autoconf и Libtool.
<LI>API для C, C++, Eiffel, Java, Perl, PHP, Python, Ruby и Tcl.

See section <A HREF="manual.ru.html#Clients">8  Интерфейсы для MySQL</A>.
<LI>

Полностью многопоточный с использованием потоков ядра. Это означает,
что, если такая возможность обеспечивается, можно легко организовать
работу с несколькими процессорами.
<LI>

Очень быстрые дисковые таблицы на основе В-деревьев со сжатием
индексов.
<LI>

Очень быстрая базирующаяся на потоках система распределения памяти.
<LI>

Очень быстрые соединения, использующие оптимизированный метод
однопроходного мультисоединения (one-sweep multi-join).
<LI>

Хеш-таблицы в памяти, используемые как временные таблицы.
<LI>

SQL-функции реализованы при помощи хорошо оптимизированной библиотеки
классов, поэтому они выполняются настолько быстро, насколько это
возможно. Обычно после инициализации запроса распределения памяти не
происходит вообще.
<LI>

MySQL- код протестирован с использованием Purify (коммерческий
детектор утечки памяти), а также Valgrind, одного из GPL-инструментов
(<a HREF="http://developer.kde.org/~sewardj/">http://developer.kde.org/~sewardj/</a>
</UL>

<DT>Типы столбцов
<DD>

<UL>
<LI>

Большое количество: целочисленные со знаком/беззнаковые, длиной в 1, 2, 3, 4 и
8 байтов, <code>FLOAT</code>, <code>DOUBLE</code>, <code>CHAR</code>, <code>VARCHAR</code>,
<code>TEXT</code>, <code>BLOB</code>, <code>DATE</code>, <code>TIME</code>, <code>DATETIME</code>,
<code>TIMESTAMP</code>, <code>YEAR</code>, <code>SET</code> и <code>ENUM</code>. See section <A HREF="manual.ru.html#Column_types">6.2  Типы данных столбцов</A>.

<LI>

С записями фиксированной и переменной длины.
<LI>

<A NAME="IDX31"></A>

Все столбцы имеют значения по умолчанию. С помощью <code>INSERT</code> можно
вставить подмножество столбцов таблицы; столбцы, для которых явно не
заданы значения, устанавливаются в значения по умолчанию.
</UL>

<DT>Команды и функции
<DD>

<UL>
<LI>Полная поддержка операторов и функций в <code>SELECT</code>- и <code>WHERE</code>- частях

запросов. Например:


<PRE>
mysql&#62; SELECT CONCAT(first_name, " ", last_name)
    -&#62; FROM tbl_name
    -&#62; WHERE income/dependents &#62; 10000 AND age &#62; 30;
</PRE>

<LI>

Полная поддержка для операторов SQL <code>GROUP BY</code> и <code>ORDER BY</code> с выражениями SQL. Поддержка
групповых функций (<code>COUNT()</code>, <code>COUNT(DISTINCT ...)</code>, <code>AVG()</code>, <code>STD()</code>, <code>SUM()</code>,
<code>MAX()</code> и <code>MIN()</code>).
<LI>

Поддержка <code>LEFT OUTER JOIN</code> и <code>RIGHT OUTER JOIN</code> с синтаксисом ANSI SQL и
ODBC.
<LI>Разрешены псевдонимы для таблиц и столбцов в соответствии со

стандартом SQL92.
<LI><code>DELETE</code>, <code>INSERT</code>, <code>REPLACE</code>, and <code>UPDATE</code> возвращают число строк, которые

были изменены. Вместо этого можно задать возвращение совпавших строк.
Для этого следует установить флаг при соединении с сервером.
<LI>

Команду <code>SHOW</code>, которая является специфической для MySQL, можно
использовать для получения информации о базах данных, таблицах и
индексах. Чтобы выяснить, как оптимизатор выполняет запрос, можно
применять команду <code>EXPLAIN</code>.
<LI>

Имена функций не конфликтуют с именами таблиц и столбцов. Например,
<code>ABS</code> является корректным именем столбца. Для вызова функции существует
только одно ограничение: между именем функции и следующей за ним
открывающей скобкой <samp>`('</samp> не должно быть пробелов. See section <A HREF="manual.ru.html#Reserved_words">6.1.7  ``Придирчив'' ли MySQL к зарезервированным словам?</A>.
<LI>

В одном и том же запросе могут указываться таблицы из различных баз
данных (с версии 3.22).
</UL>

<DT>Безопасность
<DD>

<UL>
<LI>

Система, основанная на привилегиях и паролях, за счет чего
обеспечивается гибкость и безопасность, и с возможностью верификации с
удаленного компьютера. Пароли защищены, т.к. они при передаче по сети
при соединении с сервером шифруются.
</UL>

<DT>Масштабируемость и ограничения
<DD>

<UL>
<LI>

Управляет очень большими базами данных. Компания MySQL AB. использует
<code>MySQL</code> для работы с несколькими базами данных, которые содержат
50 миллионов записей, кроме того, нам известны пользователи,
использующие MySQL для работы с 60000 таблицами, включающими
около 5000000000 строк.
<LI>

Для каждой таблицы разрешается иметь до 32 индексов. Каждый индекс
может содержать от 1 до 16 столбцов или частей столбцов. Максимальная
ширина индекса 500 бит (это значение может быть изменено при
компиляции MySQL). Для индекса может использоваться префикс
поля <code>CHAR</code> или <code>VARCHAR</code>.
</UL>

<DT>Установка соединений
<DD>

<UL>
<LI>

Клиенты могут соединяться с <code>MySQL</code>, используя сокеты TCP/IP,
сокеты Unix или именованные каналы (named pipes, под NT).
<LI>

Поддержка <code>ODBC</code> (Open-DataBase-Connectivity) для Win32 (с исходным
кодом). Все функции ODBC 2.5 и многие другие. Например, для соединения
с MySQL можно использовать MS Access. See section <A HREF="manual.ru.html#ODBC">8.3  Поддержка ODBC в MySQL</A>.
</UL>

<DT>Локализация
<DD>

<UL>
<LI>

Сервер может обеспечивать сообщения об ошибках для клиентов на
различных языках. See section <A HREF="manual.ru.html#Languages">4.6.2  Сообщения об ошибках на языках, отличных от английского</A>.
<LI>

Полная поддержка нескольких различных кодировок, включая ISO-8859-1
(Latin1), немецкий, big5, ujis и многие другие. Например,
скандинавские символы разрешены в именах таблиц и столбцов.
<LI>

Для хранения всех данных используется выбранный набор символов. Все
сравнения для столбцов с нормальными строками проводятся с учетом
регистра символов.
<LI>

Сортировка производится согласно выбранному алфавиту (по умолчанию
используется шведский). Эту установку можно изменить при запуске
сервера MySQL. Чтобы ознакомиться с примером очень грамотной
сортировки, можно обратиться к коду сортировки для чешского языка.
MySQL поддерживает много различных кодировок, которые можно задавать
во время компиляции и в процессе работы.
</UL>

<DT>Клиенты и инструментарий
<DD>

<UL>
<LI>

Включает <code>myisamchk</code>, очень быструю утилиту для проверки, оптимизации и
восстановления таблиц. Все функциональные возможности <code>myisamchk</code> также
доступны через SQL-интерфейс. See section <A HREF="manual.ru.html#MySQL_Database_Administration">4  Администрирование баз данных</A>.
<LI>

Все MySQL-программы можно запускать с опциями <code>--help</code> или <code>-?</code> для
получения помощи.
</UL>

</DL>



<H3><A NAME="Stability" HREF="manual.ru_toc.html#Stability">1.4.3  Насколько стабильным является MySQL?</A></H3>

<P>
<A NAME="IDX32"></A>

</P>
<P>
Этот раздел дает ответ на следующие вопросы ''<em>Насколько стабильным
является MySQL?</em>'' и ''<em>Могу ли я положиться на MySQL в своем
проекте?</em>'' Мы попытаемся внести ясность в эти проблемы, а также ответить
на некоторые важные вопросы, которые имеют значение для многих
потенциальных пользователей. Информация данного раздела базируется на
данных из списка рассылки, - наши пользователи очень активно сообщают нам
о выявленных проблемах и о своем опыте использования нашего ПО.

</P>
<P>
Самые первые версии кода были созданы в начале 80-х. Это был устойчивый
код с форматом таблиц <code>ISAM</code>, обеспечивающим обратную совместимость с
предыдущими версиями. Во времена компании TcX, предшественника MySQL AB, с
середины 1986 года код MySQL работал в проектах без каких-либо проблем. Но
когда сервер MySQL был выпущен для широкого использования, оказалось, что
существует несколько фрагментов ``непротестированного кода''. Эти
фрагменты были быстро обнаружены новыми пользователями, которые составляли
запросы в несколько ином виде, чем мы.

</P>
<P>
С каждым новым релизом количество проблем, связанных с переносимостью,
уменьшалось (несмотря на то, что в каждом выпуске появлялось множество
новых возможностей).

</P>
<P>
Каждый релиз MySQL был рабочим, проблемы возникали только при
использовании кода из ``серых зон''. Естественно, что новые пользователи
не знают о том, где находятся такие ``серые зоны''; в данном разделе
сделана попытка описать те из них, которые известны на данный момент.
Большая часть описания относится к версии 3.23 MySQL-сервера. В самой
последней версии все известные ошибки устранены, за исключением тех,
которые перечислены в разделе ошибок, а также конструктивных дефектов. 
See section <A HREF="manual.ru.html#Bugs">1.9.5  Известные ошибки и недостатки проектирования в MySQL</A>.

</P>
<P>
Структура ПО MySQL является многоуровневой с независимыми модулями.
Некоторые из новейших модулей перечислены ниже, причем по каждому дается
информация о том, насколько хорошо он протестирован.

</P>
<P>
<A NAME="IDX33"></A>

</P>
<DL COMPACT>

<DT><strong>Репликация - Gamma</strong>
<DD>
Большие серверные кластеры, в которых применяется репликация, находятся в
промышленной эксплуатации и показывают хорошие результаты. Работа над
средствами репликации в MySQL 4.x продолжается.

<DT><strong><code>InnoDB</code>-таблицы - стабильно (в 3.23 с 3.23.49)</strong>
<DD>
Обработчик транзакционных <code>InnoDB</code>-таблиц объявлен в настоящее время
стабильными в дереве MySQL 3.23, начиная с версии 3.23.49. <code>InnoDB</code>
используется в больших промышленных системах с большой нагрузкой.

<DT><strong><code>BDB</code>-таблицы - Gamma</strong>
<DD>
Код <code>Berkeley DB</code> очень устойчив, но на настоящий момент продолжается
усовершенствование интерфейса обработчика транзакционных <code>BDB</code>-таблиц с
MySQL, поэтому должно пройти некоторое время, пока он будет так же хорошо
протестирован, как и таблицы других типов.

<DT><strong><code>Полнотекстовый поиск</code> - Beta</strong>
<DD>
Полнотекстовый поиск работает, но широко не используется. В версии MySQL
4.0 реализованы существенные улучшения данной возможности.

<DT><strong><code>MyODBC 2.50</code> (использующий ODBC SDK 2.5) - Gamma</strong>
<DD>
Чрезвычайно широко используется. Как оказалось, некоторые из возникших
проблем являются зависящими от приложения, а не от ODBC-драйвера или
сервера баз данных.

<DT><strong>Aвтоматическое восстановление <code>MyISAM</code>-таблиц - Gamma</strong>
<DD>
Статус Gamma относится только к новому коду в обработчике таблиц, который
проверяет правильность закрытия таблицы после ее открытия и выполняет
автоматическую проверку/восстановление незакрытой таблицы.

<DT><strong>Вставка больших объемов данных - Alpha</strong>
<DD>
Новая возможность в <code>MyISAM</code>-таблицах в MySQL 4.0 для быстрой вставки
большого количества строк.

<DT><strong>Блокировка - Gamma</strong>
<DD>
В большой степени зависит от системы. В некоторых системах возникают
большие проблемы с использованием стандартной для ОС блокировки
(<code>fcntl()</code>). В таких случаях следует запустить демон <code>mysqld</code> с флагом
<code>--skip-external-locking</code>. Известно, что проблемы имеют место в некоторых системах
Linux и в SunOS, когда используются NFS-монтированные файловые системы.

</DL>

<P>
Несмотря на то, что высококвалифицированную поддержку MySQL AB
обеспечивает за плату, в списке рассылки MySQL обычно можно получить
ответы на часто возникающие вопросы. Ошибки обычно ликвидируются сразу же
при помощи патчей, а серьезные дефекты почти всегда устраняются в новом
выпуске.

</P>


<H3><A NAME="Table_size" HREF="manual.ru_toc.html#Table_size">1.4.4  Насколько большими могут быть таблицы в MySQL?</A></H3>

<P>
<A NAME="IDX34"></A>
<A NAME="IDX35"></A>
<A NAME="IDX36"></A>
<A NAME="IDX37"></A>
<A NAME="IDX38"></A>

</P>

<P>
MySQL версии 3.22 имеет предел по размеру таблиц 4 Гб. В MySQL версии
3.23, где используется новый тип таблиц, максимальный размер таблицы
доведен до 8 миллионов терабайтов (2 ^ 63 bytes).

</P>
<P>
Однако следует заметить, что операционные системы имеют свои собственные
ограничения по размерам файлов. Ниже приведено несколько примеров:

</P>
<TABLE BORDER>
<TR><TD><strong>Операционная система</strong> </TD><TD> <strong>Ограничения на размеры файла</strong>
</TD></TR>
<TR><TD>32-разрядная Linux-Intel </TD><TD> 2Гб, 4Гб и более, в зависимости от версии Linux
</TD></TR>
<TR><TD>Linux-Alpha </TD><TD> 8T (?)
</TD></TR>
<TR><TD>Solaris 2.5.1 </TD><TD> 2 Гб (с патчем возможно 4Гб)
</TD></TR>
<TR><TD>Solaris 2.6 </TD><TD> 4Гб (может быть изменено при помощи указания флага)
</TD></TR>
<TR><TD>Solaris 2.7 Intel </TD><TD> 4 Гб
</TD></TR>
<TR><TD>Solaris 2.7 UltraSPARC </TD><TD> 512 Гб
</TD></TR>
</TABLE>

<P>
В Linux 2.2 существует возможность создавать таблицы с размерами более 2
Гб, используя патч LFS для файловой системы ext2. Существуют также патчи,
обеспечивающие поддержку больших файлов для ReiserFS в Linux 2.4.

</P>
<P>
Как можно видеть, размер таблицы в базе данных MySQL обычно лимитируется
операционной системой.

</P>
<P>
По умолчанию MySQL-таблицы имеют максимальный размер около 4 Гб. Для любой
таблицы можно проверить/определить ее максимальный размер с помощью команд
<code>SHOW TABLE STATUS</code> или <code>myisamchk -dv table_name</code>. See section <A HREF="manual.ru.html#SHOW">4.5.6  Синтаксис команды <code>SHOW</code></A>.

</P>
<P>
Если необходимы таблицы большего размера, чем 4 Гб (и используемая
операционная система ``не возражает''), следует при создании такой таблицы
задать параметры <code>AVG_ROW_LENGTH</code> и <code>MAX_ROWS</code> (see section <A HREF="manual.ru.html#CREATE_TABLE">6.5.3  Синтаксис оператора <code>CREATE TABLE</code></A>). Эти параметры можно задать и позже - с помощью <code>ALTER TABLE</code> (see section <A HREF="manual.ru.html#ALTER_TABLE">6.5.4  Синтаксис оператора <code>ALTER TABLE</code></A>).

</P>
<P>
Если большая таблица предназначена только для чтения, можно
воспользоваться <code>myisampack</code>, чтобы слить несколько таблиц в одну и сжать
ее. Обычно <code>myisampack</code> ужимает таблицу по крайней мере на 50%, поэтому в
результате можно получить очень большие таблицы (see section <A HREF="manual.ru.html#myisampack">4.7.4  <code>myisampack</code>, MySQL-генератор сжатых таблиц (только для чтения)</A>).

</P>
<P>
Есть еще одна возможность обойти ограничения операционной системы на
размеры файлов данных MyISAM, - это делается при помощи опции <code>RAID</code> (see section <A HREF="manual.ru.html#CREATE_TABLE">6.5.3  Синтаксис оператора <code>CREATE TABLE</code></A>).

</P>
<P>
Еще одним решением может быть использование функции <code>MERGE</code>, которая
обеспечивает возможность обрабатывать набор идентичных таблиц как одну
таблицу (see section <A HREF="manual.ru.html#MERGE">7.2  Таблицы <code>MERGE</code></A>).

</P>


<H3><A NAME="Year_2000_compliance" HREF="manual.ru_toc.html#Year_2000_compliance">1.4.5  Вопросы, связанные с Проблемой-2000</A></H3>

<P>
<A NAME="IDX39"></A>
<A NAME="IDX40"></A>
<A NAME="IDX41"></A>
<A NAME="IDX42"></A>

</P>
<P>
Сам MySQL не имеет проблем, связанных с Проблемой-2000 (Y2K):

</P>

<UL>
<LI>

В MySQL используются функции времени Unix, поэтому проблемы с
датами, вплоть до <code>2069</code>, исключены. Принимается, что все двузначные
значения годов находятся в диапазоне с <code>1970</code> по <code>2069</code>, поэтому число <code>01</code> в
столбце с типом <code>year</code> MySQL обрабатывает как <code>2001</code>.

<LI>

Все MySQL-функции, обрабатывающие даты, хранятся в одном файле
<tt>`sql/time.cc'</tt>. Их код был написан очень тщательно, чтобы
застраховаться от проблем, связанных с 2000-м годом.

<LI>

В версиях MySQL 3.22 и более поздних в столбцах с новым типом <code>YEAR</code>,
который обеспечивает хранение нулевого <code>0</code> года и значений лет от <code>1901</code>
до <code>2155</code> в одном байте, а также отображение дат при помощи 2 или 4
знаков.
</UL>

<P>
Проблемы, связанные с 2000-м годом, могут возникнуть в приложениях,
которые используют MySQL так, что это может оказаться небезопасным
с точки зрения Y2K. Например, во многих старых приложениях для хранения и
обработки значений годов используются 2-значные величины (которые можно
трактовать неоднозначно), а не 4-значные. Эта проблема может быть
урегулирована при помощи приложений, которые используют <code>00</code> или <code>99</code> как
``отсутствующие'' индикаторы значений.

</P>
<P>
К сожалению, такие проблемы бывает сложно устранить, так как разные
приложения могут быть написаны разными программистами, каждый из которых
мог применять отличный от других набор соглашений и обрабатывающих
значения даты функций.

</P>
<P>
Приведенный ниже код является наглядной демонстрацией того, что в MySQL
Server проблемы с датами вплоть до 2030 года отсутствуют.

</P>

<PRE>
mysql&#62; DROP TABLE IF EXISTS y2k;
Query OK, 0 rows affected (0.01 sec)

mysql&#62; CREATE TABLE y2k (date DATE,
    -&#62; date_time DATETIME,
    -&#62; time_stamp TIMESTAMP);
Query OK, 0 rows affected (0.00 sec)

mysql&#62; INSERT INTO y2k VALUES
    -&#62; ("1998-12-31","1998-12-31 23:59:59",19981231235959),
    -&#62; ("1999-01-01","1999-01-01 00:00:00",19990101000000),
    -&#62; ("1999-09-09","1999-09-09 23:59:59",19990909235959),
    -&#62; ("2000-01-01","2000-01-01 00:00:00",20000101000000),
    -&#62; ("2000-02-28","2000-02-28 00:00:00",20000228000000),
    -&#62; ("2000-02-29","2000-02-29 00:00:00",20000229000000),
    -&#62; ("2000-03-01","2000-03-01 00:00:00",20000301000000),
    -&#62; ("2000-12-31","2000-12-31 23:59:59",20001231235959),
    -&#62; ("2001-01-01","2001-01-01 00:00:00",20010101000000),
    -&#62; ("2004-12-31","2004-12-31 23:59:59",20041231235959),
    -&#62; ("2005-01-01","2005-01-01 00:00:00",20050101000000),
    -&#62; ("2030-01-01","2030-01-01 00:00:00",20300101000000),
    -&#62; ("2050-01-01","2050-01-01 00:00:00",20500101000000);
Query OK, 13 rows affected (0.01 sec)
Records: 13 Duplicates: 0 Warnings: 0

mysql&#62; SELECT * FROM y2k;
+------------+---------------------+----------------+
| date | date_time | time_stamp |
+------------+---------------------+----------------+
| 1998-12-31 | 1998-12-31 23:59:59 | 19981231235959 |
| 1999-01-01 | 1999-01-01 00:00:00 | 19990101000000 |
| 1999-09-09 | 1999-09-09 23:59:59 | 19990909235959 |
| 2000-01-01 | 2000-01-01 00:00:00 | 20000101000000 |
| 2000-02-28 | 2000-02-28 00:00:00 | 20000228000000 |
| 2000-02-29 | 2000-02-29 00:00:00 | 20000229000000 |
| 2000-03-01 | 2000-03-01 00:00:00 | 20000301000000 |
| 2000-12-31 | 2000-12-31 23:59:59 | 20001231235959 |
| 2001-01-01 | 2001-01-01 00:00:00 | 20010101000000 |
| 2004-12-31 | 2004-12-31 23:59:59 | 20041231235959 |
| 2005-01-01 | 2005-01-01 00:00:00 | 20050101000000 |
| 2030-01-01 | 2030-01-01 00:00:00 | 20300101000000 |
| 2050-01-01 | 2050-01-01 00:00:00 | 00000000000000 |
+------------+---------------------+----------------+
13 rows in set (0.00 sec)

</PRE>

<P>
Можно видеть, что при использовании типов <code>DATE</code> и <code>DATETIME</code> проблем с датами
будущего не возникнет (эти типы ``справляются'' с датами вплоть до 9999
года).

</P>
<P>
Тип <code>TIMESTAMP</code>, который используется для сохранения текущего времени, имеет
диапазон только до <code>2030-01-01</code>. В 32-разрядных машинах <code>TIMESTAMP</code> тип имеет
диапазон от <code>1970</code> до <code>2030</code> (значение со знаком). В 64-разрядных машинах этот
тип ``справляется'' со значениями времени до <code>2106</code> года (значение без
знака).

</P>
<P>
Таким образом, даже несмотря на то, что MySQL является
Y2K-совместимым, ответственность за однозначную интерпретацию значений
даты ложится на плечи пользователя. See section <A HREF="manual.ru.html#Y2K_issues">6.2.2.1  Проблема 2000 года и типы данных</A>,
где приведены правила по работе MySQL с входными данными, которые
имеют неоднозначные значения даты (данные, содержащие 2-значные значения
года).

</P>


<H2><A NAME="What_is_MySQL_AB" HREF="manual.ru_toc.html#What_is_MySQL_AB">1.5  Что представляет собой компания MySQL AB?</A></H2>

<P>
<A NAME="IDX43"></A>

</P>
<P>
MySQL AB - компания, в состав которой входят основатели MySQL и основные
разработчики. MySQL AB создана в Швеции Дэвидом Аксмарком (David Axmark),
Аланом Ларссом (Allan Larsson) и Майклом <code>Монти</code> Видениусом (Michael
Monty Widenius).

</P>
<P>
Все разработчики сервера MySQL - штатные сотрудники компании. MySQL AB -
виртуальная компания, состоящая из сотрудников, живущих в десятках стран
по всему миру. Мы каждый день общаемся по Сети друг с другом, а также с
нашими партнерами и пользователями.

</P>
<P>
Наша компания занимается разработкой и распространением СУБД MySQL и
сопутствующего ПО. MySQL AB владеет всеми правами на исходный код MySQL,
на логотип и торговую марку MySQL, а также на данное руководство (see section <A HREF="manual.ru.html#What-is">1.4  Что представляет собой MySQL?</A>).

</P>

<P>
Наши основные ценности - это то, что наша деятельность посвящена MySQL и
идеям <code>Open Source</code>, открытого программного обеспечения.

</P>
<P>
Мы хотим, чтобы сервер MySQL соответствовал следующим критериям:

</P>

<UL>
<LI>

Лучший и популярнейший сервер СУБД в мире
<LI>

Доступный всем
<LI>

Простой в эксплуатации
<LI>

Постоянно развивающийся не в ущерб скорости и безопасности
<LI>

Работающий надежно
<LI>

Удобный для использования и усовершенствования
</UL>

<P>
MySQL AB и люди, работающие в MySQL AB:

<UL>
<LI>

Продвигают философию Open Source и поддерживают пользователей Open
Source
<LI>

Хорошие граждане
<LI>

С удовольствием работают с партнерами, разделяющими нашу точку зрения
и ценности
<LI>

Отвечают на электронную почту и предоставляют поддержку пользователям
<LI>

Является виртуальной командой, взаимодействующей через Internet
<LI>

Работают ``против'' патентованного ПО
</UL>

<P>
Свежая информация о MySQL и MySQL AB находится на сайте MySQL
(<a HREF="http://www.mysql.com/">http://www.mysql.com/</a>).

</P>


<H3><A NAME="MySQL_AB_business_model_and_services" HREF="manual.ru_toc.html#MySQL_AB_business_model_and_services">1.5.1  Бизнес-модель и услуги, оказываемые компанией MySQL AB</A></H3>

<P>
Очень часто нам задают такой вопрос: ''<em>Как вам удается зарабатывать на
жизнь, ведь вы все раздаете бесплатно?</em>''

</P>
<P>
Компания MySQL AB получает плату за поддержку, услуги, коммерческие
лицензии и лицензионные платежи. Эти доходы вкладываются в разработку
продукта и расширение бизнеса нашей компании.

</P>

<P>
Компания является прибыльной с момента своего основания. В октябре 2001
ряд ведущих скандинавских инвесторов и небольшая группа меценатов
предоставили нам венчурный кредит. Эти капиталовложения идут на укрепление
нашей бизнес-модели и создают основу устойчивого роста бизнеса компании.

</P>


<H4><A NAME="Business_Services_Support" HREF="manual.ru_toc.html#Business_Services_Support">1.5.1.1  Поддержка</A></H4>

<P>
Владельцами и руководителями компании MySQL AB являются ее основатели и
ведущие разработчики ПО баз данных MySQL. В задачи разработчиков входит
предоставление поддержки клиентам и другим пользователям, что обеспечивает
нам возможность всегда быть в курсе их потребностей и проблем. Вся наша
поддержка осуществляется квалифицированными разработчиками. Ответы на
самые каверзные вопросы дает

</P>
<P>
Майкл Монти Вайдиниус (Michael Monty Widenius), главный автор MySQL
Server. See section <A HREF="manual.ru.html#Support">1.6.1  Поддержка, предлагаемая компанией MySQL AB</A>.

</P>
<P>
Для более подробной информации и  заказа различных уровней поддержки обратитесь на 
веб-сайт <a HREF="https://order.mysql.com/">https://order.mysql.com/</a> или свяжитесь с нашим
отделом сбыта по адресу <a HREF="mailto:sales@mysql.com">sales@mysql.com</a>.

</P>


<H4><A NAME="Business_Services_Training" HREF="manual.ru_toc.html#Business_Services_Training">1.5.1.2  Обучение и сертификация</A></H4>

<P>
<A NAME="IDX44"></A>
<A NAME="IDX45"></A>
<A NAME="IDX46"></A>
<A NAME="IDX47"></A>

</P>
<P>
Компания MySQL AB проводит обучение по MySQL и другим смежным продуктам по
всему миру. Мы предлагаем как общедоступные, так и внутрифирменные курсы,
подготовленные в соответствии с конкретными потребностями вашей компании.
Обучение по MySQL проводят также наши партнеры - авторизованные центры
обучения по MySQL.

</P>
<P>
В наших учебных материалах в качестве примеров используются те же базы
данных, что и в нашей документации и типовых приложениях. Эти материалы
постоянно дополняются, чтобы соответствовать последней версии MySQL. Наши
инструкторы опираются на поддержку коллектива разработчиков, что
гарантирует качество обучения и постоянное совершенствование учебного
материала. Благодаря тесной связи с разработчиками вы можете быть уверены
также и в том, что какой бы вопрос ни возник у вас в процессе обучения, на
него всегда будет найден ответ.

</P>
<P>
Обучение на наших курсах позволит вам достичь целей, которые вы ставите
перед собой при создании своих MySQL-приложений. Помимо этого вы:

<UL>
<LI>

сэкономите время
<LI>

повысите эффективность работы своих приложений
<LI>

уменьшите или устраните необходимость в дополнительном оборудовании,
сократив таким образом издержки
<LI>

усилите защищенность своих приложений
<LI>

полнее удовлетворите потребности ваших заказчиков и коллег.
<LI>

подготовитесь к <code>сертификации по MySQL</code>.
</UL>

<P>
Если предлагаемое нами обучение интересует вас как потенциального
участника нашего проекта или партнера в реализации учебных курсов,
посетите учебный раздел на нашем веб-сайте <a HREF="http://www.mysql.com/training/">http://www.mysql.com/training/</a>
или свяжитесь с нами по адресу: <a HREF="mailto:training@mysql.com">training@mysql.com</a>.

</P>
<P>
Для более подробной информации о программе сертификации MySQL, см. 
<a HREF="http://www.mysql.com/certification/">http://www.mysql.com/certification/</a>.

</P>



<H4><A NAME="Business_Services_Consulting" HREF="manual.ru_toc.html#Business_Services_Consulting">1.5.1.3  Консультации</A></H4>

<P>
<A NAME="IDX48"></A>
<A NAME="IDX49"></A>
<A NAME="IDX50"></A>
<A NAME="IDX51"></A>

</P>

<P>
Компания MySQL AB и ее авторизованные партнеры предлагают по всему миру
консультационные услуги для пользователей MySQL а также для
разработчиков, встраивающих MySQL в свое программное обеспечение.

</P>
<P>
Наши консультанты окажут вам помощь в таких вопросах, как проектирование и
настройка баз данных, создание эффективных запросов, настройка
используемой вами платформы для достижения оптимальной эффективности
работы, решение проблем миграции, реализация тиражирования, создание
устойчивых приложений диалоговой обработки запросов, а также во многих
других. Кроме того, мы помогаем нашим клиентам встраивать MySQL в
их продукты и приложения, предназначенные для широкомасштабного
распространения.

</P>
<P>
Наши консультанты работают в тесном сотрудничестве с коллективом
разработчиков компании, что обеспечивает высокий технический уровень
предоставляемых ими профессиональных услуг. Мы предлагаем широкий диапазон
форм консультационной поддержки - от двухдневных интенсивных курсов до
проектов продолжительностью в недели и месяцы. Наши консультации
охватывают не только MySQL, но и языки программирования и
сценариев, например PHP, Perl и многое другое.

</P>
<P>
Заинтересованных в наших консультационных услугах, а также тех, кто хотели
бы стать нашими партнерами в оказании таких услуг, приглашаем посетить
консультационный раздел на нашем веб-сайте
<a HREF="http://www.mysql.com/consulting/">http://www.mysql.com/consulting/</a> или связаться с нашим консультационным
отделом по адресу <a HREF="mailto:consulting@mysql.com">consulting@mysql.com</a>.

</P>


<H4><A NAME="Business_Services_Commercial_licenses" HREF="manual.ru_toc.html#Business_Services_Commercial_licenses">1.5.1.4  Коммерческие лицензии</A></H4>

<P>
ПО баз данных MySQL выпускается по общедоступной лицензии <code>GNU General
Public License</code> (<code>GPL</code>). Это означает, что при соблюдении условий <code>GPL</code> ПО 
<code>MySQL</code> можно пользоваться бесплатно. Если вы не хотите связывать себя
лицензионными ограничениями <code>GPL</code> (например, вас не устраивает условие, что
ваше собственное приложение также подпадает под действие <code>GPL</code>), есть
возможность приобрести у компании MySQL AB на этот же продукт коммерческую
лицензию.

</P>
<P>
См.  <a HREF="https://order.mysql.com/">https://order.mysql.com/</a>). 

</P>
<P>
Компания MySQL AB владеет авторскими правами на
исходный код MySQL, поэтому мы вправе использовать двойное лицензирование,
в соответствии с которым один и тот же продукт доступен как по лицензии
<code>GPL</code>, так и по коммерческой лицензии, и это никоим образом не нарушает
обязательств компании MySQL AB по предоставлению исходного кода. Более
подробную информацию о том, в каких случаях необходимо приобретение
коммерческой лицензии, вы найдете в разделе section <A HREF="manual.ru.html#MySQL_licenses">1.6.3  Лицензии на ПО MySQL</A>.

</P>
<P>
Компания MySQL AB занимается также продажей коммерческих лицензий на ПО
сторонних разработчиков, предоставляемое с открытым исходным кодом на
условиях <code>GPL</code>. Это ПО расширяет возможности <code>MySQL</code>. Хороший пример -
транзакционный обработчик таблиц InnoDB, обеспечивающий поддержку
технологии <code>ACID</code>, строковую блокировку, восстановление системы после аварии,
управление версиями, поддержку внешних ключей и многое другое (see section <A HREF="manual.ru.html#InnoDB">7.5  Таблицы <code>InnoDB</code></A>).

</P>


<H4><A NAME="Business_Services_Partnering" HREF="manual.ru_toc.html#Business_Services_Partnering">1.5.1.5  О нашей программе партнерства</A></H4>

<P>
<A NAME="IDX52"></A>

</P>
<P>
Компания MySQL AB реализует глобальную программу партнерства, которая
охватывает учебные курсы, консультативные услуги и поддержку продукта,
издательскую деятельность, а также продажу и распространение MySQL и
смежных продуктов. Партнеры компании MySQL AB получают право быть
представленными на веб-сайте <a HREF="http://www.mysql.com/">http://www.mysql.com/</a> и использовать в
маркировке своих продуктов специальные варианты торговой марки MySQL - с
целью идентификации и продвижения этих продуктов на рынке.

</P>
<P>
Тех, кто заинтересован в получении статуса партнера MySQL, просим
обращаться по адресу <a HREF="mailto:partner@mysql.com">partner@mysql.com</a>.

</P>
<P>
Название MySQL и логотип MySQL в виде дельфина являются торговыми марками
компании MySQL AB (see section <A HREF="manual.ru.html#MySQL_AB_Logos_and_Trademarks">1.6.4  Логотипы и торговые марки MySQL AB</A>),
принадлежащими компании MySQL AB. Узнаваемость этих торговых марок
свидетельствует о том, что за годы своей работы основатели компании MySQL
AB сумели добиться для своей компании заметного положения и признания в
мире.

</P>


<H4><A NAME="Business_Services_Advertising" HREF="manual.ru_toc.html#Business_Services_Advertising">1.5.1.6  О рекламе</A></H4>

<P>
Веб-сайт компании MySQL (<a HREF="http://www.mysql.com/">http://www.mysql.com/</a>) пользуется популярностью
среди разработчиков и пользователей. Например, в октябре 2001 г. мы
обслужили 10 миллионов запросов на просмотр размещенных на нем страниц.
Наши посетители относятся к категории лиц, принимающих решения и дающих
рекомендации о покупке как программного, так и аппаратного обеспечения.
12% наших посетителей утверждают решения о приобретении, и только 9% наших
посетителей совсем не имеют отношения к принятию подобных решений. Более
65% наших посетителей сделали в деловых целях как минимум одну покупку в
Сети за последние полгода, а 70% - планируют совершить ее в ближайшие
месяцы.

</P>


<H3><A NAME="Contact_information" HREF="manual.ru_toc.html#Contact_information">1.5.2  Как с нами связаться</A></H3>

<P>
<A NAME="IDX53"></A>
<A NAME="IDX54"></A>
<A NAME="IDX55"></A>
<A NAME="IDX56"></A>
<A NAME="IDX57"></A>
<A NAME="IDX58"></A>

</P>
<P>
Самая свежая информация о MySQL и нашей компании представлена на веб-сайте
MySQL (<a HREF="http://www.mysql.com/">http://www.mysql.com/</a>).

</P>
<P>
По вопросам связи с прессой и темам, не затронутым в наших сообщениях для
печати (<a HREF="http://www.mysql.com/news/">http://www.mysql.com/news/</a>), обращайтесь по адресу
<a HREF="mailto:press@mysql.com">press@mysql.com</a>.

</P>
<P>
Для получения своевременных и точных ответов на технические вопросы,
касающиеся ПО MySQL, необходимо иметь действующий контракт с компанией
MySQL AB по поддержке (за дополнительной информацией обращайтесь к разделу
section <A HREF="manual.ru.html#Support">1.6.1  Поддержка, предлагаемая компанией MySQL AB</A>). Чтобы заказать контракт по поддержке,
следует обратиться на сайт <a HREF="https://order.mysql.com/">https://order.mysql.com/</a> или направить
сообщение по адресу <a HREF="mailto:sales@mysql.com">sales@mysql.com</a>.

</P>
<P>
Для получения информации об учебных курсах, которые проводит компания
MySQL AB, посетите раздел по обучению на веб-сайте
<a HREF="http://www.mysql.com/training/">http://www.mysql.com/training/</a>. Тех, кто имеет ограниченный доступ в
Internet, просим связаться с учебным отделом компании MySQL AB по адресу
<a HREF="mailto:training@mysql.com">training@mysql.com</a> (see section <A HREF="manual.ru.html#Business_Services_Training">1.5.1.2  Обучение и сертификация</A>).

</P>
<P>
Информацию о программе сертификации компании MySQL AB вы найдете на
странице <a HREF="http://www.mysql.com/certification/index.html">http://www.mysql.com/certification/index.html</a> нашего
веб-сайта. Если вы желаете быть в курсе текущего состояния программы
сертификации по MySQL, просим сообщить об этом по адресу
<a HREF="mailto:certification@mysql.com">certification@mysql.com</a>. See section <A HREF="manual.ru.html#Business_Services_Training">1.5.1.2  Обучение и сертификация</A>.

</P>
<P>
Заинтересованных в получении консультаций приглашаем посетить раздел
консультаций на веб-сайте <a HREF="http://www.mysql.com/consulting/">http://www.mysql.com/consulting/</a>. Тех, у кого
имеется ограниченный доступ в Internet, просим связаться с
консультационным отделом компании MySQL AB по адресу <a HREF="mailto:consulting@mysql.com">consulting@mysql.com</a>.
Обращайтесь к разделу section <A HREF="manual.ru.html#Business_Services_Consulting">1.5.1.3  Консультации</A>.

</P>
<P>
Коммерческие лицензии можно приобрести по Сети, на веб-сайте
<a HREF="https://order.mysql.com/">https://order.mysql.com/</a>. Здесь вы найдете также информацию о том, как
передать в компанию MySQL AB свой заказ на покупку по факсу. Более подробная информация
о лицензировании доступна на <a HREF="http://www.mysql.com/products/pricing.html">http://www.mysql.com/products/pricing.html</a>.

</P>
<P>
Если у вас
имеются вопросы, касающиеся лицензирования, или вы хотите знать расценки
на лицензии в случае массового выпуска продукта, заполните форму на нашем
веб-сайте (<a HREF="http://www.mysql.com/">http://www.mysql.com/</a>) или пошлите сообщение по электронной
почте: вопросы, касающиеся лицензирования, направляйте по адресу
<a HREF="mailto:licensing@mysql.com">licensing@mysql.com</a>, а запросы на покупку - по адресу <a HREF="mailto:sales@mysql.com">sales@mysql.com</a>.
Обращайтесь также к разделу section <A HREF="manual.ru.html#MySQL_licenses">1.6.3  Лицензии на ПО MySQL</A>.

</P>
<P>
Если вы представляете деловые круги, заинтересованные в партнерских
отношениях с компанией MySQL AB, напишите нам по адресу <a HREF="mailto:partner@mysql.com.">partner@mysql.com.</a>
Обращайтесь к разделу section <A HREF="manual.ru.html#Business_Services_Partnering">1.5.1.5  О нашей программе партнерства</A>.

</P>
<P>
Для получения дополнительной информации о политике компании MySQL в
отношении торговых марок обращайтесь на наш веб-сайт
<a HREF="http://www.mysql.com/company/trademark.html">http://www.mysql.com/company/trademark.html</a> или напишите письмо по адресу
<a HREF="mailto:trademark@mysql.com">trademark@mysql.com</a>. Обратитесь к разделу section <A HREF="manual.ru.html#MySQL_AB_Logos_and_Trademarks">1.6.4  Логотипы и торговые марки MySQL AB</A>.

</P>
<P>
Если вас заинтересовало какое-либо из предложений, перечисленных в нашем
разделе предложений работы (<a HREF="http://www.mysql.com/company/jobs/">http://www.mysql.com/company/jobs/</a>),
направляйте свои письма по адресу <a HREF="mailto:jobs@mysql.com">jobs@mysql.com</a>. Просьба не оформлять
свои личные данные в виде вложения в письмо: лучше добавьте эту информацию
в виде обычного текста в конце своего сообщения.

</P>
<P>
Если вы желаете принять участие в общей дискуссии с нашими многочисленными
пользователями, обращайтесь на соответствующий список рассылки (see section <A HREF="manual.ru.html#Questions">1.8.1  Списки рассылки MySQL</A>).

</P>
<P>
Сообщения об ошибках (или bugs), а также вопросы и комментарии следует
направлять в список рассылки по адресу <a HREF="mailto:mysql@lists.mysql.com">mysql@lists.mysql.com</a>. При
обнаружении в <code>MySQL ошибок</code>, влияющих на безопасность баз данных,
просим сообщать об этом по адресу <a HREF="mailto:security@mysql.com">security@mysql.com</a>. Обратитесь также к
разделу section <A HREF="manual.ru.html#Bug_reports">1.8.1.3  Как отправлять отчеты об ошибках или проблемах</A>.

</P>
<P>
Если у вас имеются сравнительные результаты тестирования, которые мы можем
опубликовать, свяжитесь с нами по адресу <a HREF="mailto:benchmarks@mysql.com">benchmarks@mysql.com</a>.

</P>
<P>
Предложения по внесению дополнений или исправлений в данное руководство
пользователя следует направлять коллективу разработчиков руководства по
адресу <a HREF="mailto:docs@mysql.com">docs@mysql.com</a>.

</P>
<P>
Вопросы и замечания по работе или содержанию веб-сайта MySQL
(<a HREF="http://www.mysql.com/">http://www.mysql.com/</a>) направляйте по адресу <a HREF="mailto:webmaster@mysql.com">webmaster@mysql.com</a>.

</P>
<P>
Компания MySQL AB придерживается определенной политики относительно
конфиденциальности информации. Об этом вы можете прочитать на странице
<a HREF="http://www.mysql.com/company/privacy.html">http://www.mysql.com/company/privacy.html</a> нашего веб-сайта. По вопросам
этой политики просим обращаться по адресу <a HREF="mailto:privacy@mysql.com">privacy@mysql.com</a>.

</P>
<P>
По всем другим вопросам обращайтесь по адресу <a HREF="mailto:info@mysql.com">info@mysql.com</a>.

</P>


<H2><A NAME="Licensing_and_Support" HREF="manual.ru_toc.html#Licensing_and_Support">1.6  Лицензии и поддержка MySQL</A></H2>

<P>
<A NAME="IDX59"></A>
<A NAME="IDX60"></A>

</P>
<P>
В этом разделе описаны условия предоставления компанией MySQL AB лицензий
и поддержки.

</P>



<H3><A NAME="Support" HREF="manual.ru_toc.html#Support">1.6.1  Поддержка, предлагаемая компанией MySQL AB</A></H3>

<P>
<A NAME="IDX61"></A>
<A NAME="IDX62"></A>
<A NAME="IDX63"></A>
<A NAME="IDX64"></A>
<A NAME="IDX65"></A>
<A NAME="IDX66"></A>
<A NAME="IDX67"></A>

</P>

<P>
Что подразумевается под технической поддержкой компании MySQL AB? Это
означает, что на каждый свой вопрос вы получите адресованный лично вам
ответ непосредственно от программистов, пишущих программы баз данных
MySQL.

</P>
<P>
Мы стараемся, чтобы наша техническая поддержка носила широкий и
содержательный характер. Если вопрос, который вы задаете по MySQL, важен
для вас, то, следовательно, он должен быть важен и для нас. Как правило,
клиенты просят помочь разобраться в том, как работают те или иные команды
или утилиты, как устранить ``узкие места'', мешающие эффективной работе
системы, как восстановить систему в случае аварии, как влияет на работу
MySQL та или иная операционная система или локальная сеть, какие
технологии резервного копирования и восстановления данных лучше применять,
как использовать <code>API</code>-интерфейсы и т.д. Наша поддержка охватывает вопросы,
относящиеся только к серверу MySQL и нашим собственным утилитам, но не к
продуктам сторонних разработчиков, которые обеспечивают доступ к серверу
MySQL, хотя мы стараемся и в этих случаях оказывать посильную помощь.

</P>
<P>
Подробная информация о различных видах поддержки, которую предлагает
компания, приведена на веб-сайте <a HREF="http://www.mysql.com/support/">http://www.mysql.com/support/</a>. Там же вы
можете заказать по Сети контракты по поддержке. Те, кто имеет ограниченный
доступ в Internet, могут связаться с нашим отделом сбыта по адресу
<a HREF="mailto:sales@mysql.com">sales@mysql.com</a>.

</P>
<P>
Техническая поддержка - это своего рода страхование жизни. Без такой
страховки можно успешно обходиться долгие годы, но наступит критический
момент - и придется сожалеть о своей беспечности! Если вы используете
сервер MySQL для важных приложений и внезапно сталкиваетесь с неполадками
в их работе, может оказаться, что на самостоятельное выяснение ответов на
все вопросы потребуется слишком много времени. В таких случаях не обойтись
без срочной помощи самых опытных специалистов по устранению аварийных
ситуаций в MySQL, а они работают именно в компании MySQL AB.

</P>


<H3><A NAME="Copyright" HREF="manual.ru_toc.html#Copyright">1.6.2  Авторские права и лицензии на MySQL</A></H3>

<P>
<A NAME="IDX68"></A>
<A NAME="IDX69"></A>

</P>

<P>
Компания MySQL AB является владельцем авторских прав на исходный код ПО
MySQL, логотипы и торговые марки MySQL, а также на данное руководство
пользователя. Обратитесь к разделу section <A HREF="manual.ru.html#What_is_MySQL_AB">1.5  Что представляет собой компания MySQL AB?</A> Распространение
MySQL подпадает под действие нескольких различных лицензий:

</P>

<OL>
<LI>

Весь код ПО сервера, специфичный только для MySQL, библиотека
<code>mysqlclient</code> и клиентское ПО, а также библиотека <code>GNU</code> <code>readline</code> подпадают под
действие общедоступной лицензиии <code>GNU</code> <code>General Public License</code> 
(see section <A HREF="manual.ru.html#GPL_license">G  GNU General Public License</A>). Текст этой лицензии имеется также в
составе дистрибутива ПО, в файле <tt>`COPYING'</tt>.

<LI>

Библиотека  <code>GNU</code>  getopt  подпадает  под  действие  <code>GNU Lesser General
Public License</code> (see section <A HREF="manual.ru.html#LGPL_license">H  GNU Lesser General Public License</A>).

<LI>

Некоторые фрагменты исходного кода (библиотека regexp) подпадают под
действие Berkeley-подобной лицензии.

<LI>

Старые версии MySQL (3.22 и более ранние) подпадают под действие более
строгой лицензии (<a HREF="http://www.mysql.com/products/mypl.html">http://www.mysql.com/products/mypl.html</a>).
Информация об условиях лицензии имеется в документации на конкретную
версию.

<LI>

Распространение руководства пользователя в данное время не подпадает
под действие лицензии типа <code>GPL</code>. Его использование допускается на следующих
условиях:

<UL>
<LI>

Допускается конвертирование в другие форматы, но внесение при этом
каких-либо изменений или редактирование содержания не допускается.

<LI>

Разрешается выпуск печатных копий руководства для личных целей.

<LI>

Во всех остальных случаях, таких как продажа печатных изданий
руководства или использование руководства (или его части) в других
публикациях, требуется предварительно получить письменное согласие
компании MySQL AB.
</UL>

Для получения дополнительной информации или в случае, если вы хотели бы
принять участие в переводе руководства, обращайтесь по адресу
<a HREF="mailto:docs@mysql.com">docs@mysql.com</a>.
</OL>

<P>
Дополнительная информация о том, как практически осуществляется
лицензирование MySQL, находится в разделе section <A HREF="manual.ru.html#MySQL_licenses">1.6.3  Лицензии на ПО MySQL</A>. Обращайтесь
также к разделу section <A HREF="manual.ru.html#MySQL_AB_Logos_and_Trademarks">1.6.4  Логотипы и торговые марки MySQL AB</A>.

</P>


<H3><A NAME="MySQL_licenses" HREF="manual.ru_toc.html#MySQL_licenses">1.6.3  Лицензии на ПО MySQL</A></H3>

<P>
<A NAME="IDX70"></A>
<A NAME="IDX71"></A>
<A NAME="IDX72"></A>
<A NAME="IDX73"></A>
<A NAME="IDX74"></A>
<A NAME="IDX75"></A>
<A NAME="IDX76"></A>
<A NAME="IDX77"></A>

</P>

<P>
ПО MySQL распространяется в соответствии с условиями общедоступной
лицензии <code>GNU General Public License</code> (<code>GPL</code>), которая является одной из
наиболее широко распространенных лицензий на ПО с открытым исходным кодом.
Официальные условия лицензии <code>GPL</code> вы найдете на веб-сайте
<a HREF="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>. Обратитесь также к
<a HREF="http://www.gnu.org/licenses/gpl-faq.html">http://www.gnu.org/licenses/gpl-faq.html</a> и
<a HREF="http://www.gnu.org/philosophy/enforcing-gpl.html">http://www.gnu.org/philosophy/enforcing-gpl.html</a>.

</P>
<P>
Так как ПО MySQL выпускается по лицензии <code>GPL</code>, зачастую им можно
пользоваться бесплатно, но в некоторых случаях желательно или необходимо
приобрести коммерческую лицензию у компании MySQL AB (это можно сделать на
веб-сайте <a HREF="https://order.mysql.com/">https://order.mysql.com/</a>).

</P>
<P>
См. <a HREF="http://www.mysql.com/products/licensing.html">http://www.mysql.com/products/licensing.html</a> для получения более
подробной информации.

</P>

<P>
Старые версии MySQL (3.22 и более ранние) подпадают под действие более
строгой лицензии (<a HREF="http://www.mysql.com/products/mypl.html">http://www.mysql.com/products/mypl.html</a>).
Информацию об условиях лицензии вы найдете в документации на конкретную
версию.

</P>
<P>
Обращаем ваше внимание на то, что использование ПО MySQL, подпадающего под
коммерческую лицензию, лицензию <code>GPL</code> или старую лицензию MySQL, не
означает, что вы автоматически получаете право на использование торговых марок,
принадлежащих компании MySQL AB. Об этом читайте в разделе section <A HREF="manual.ru.html#MySQL_AB_Logos_and_Trademarks">1.6.4  Логотипы и торговые марки MySQL AB</A>.

</P>



<H4><A NAME="Using_the_MySQL_software_under_a_commercial_license" HREF="manual.ru_toc.html#Using_the_MySQL_software_under_a_commercial_license">1.6.3.1  Использование ПО MySQL под коммерческой лицензией</A></H4>

<P>
Лицензия <code>GPL</code> - в хорошем смысле - носит ``заразный'' характер. Это
означает, что в случае линкования какой-либо программы с программой, выпущенной
по данной лицензии, все части исходного кода получившегося продукта должны
также выпускаться по лицензии <code>GPL</code>. В противном случае будут нарушены
условия лицензии и вы вообще лишитесь права использовать программу, подпадающую
под ее действие.

</P>
<P>
Коммерческая лицензия является необходимой в следующих случаях:

</P>

<UL>
<LI>

При линковании программы с любым <code>GPL</code> кодом из ПО MySQL, в тех случаях, когда вы не
хотите, чтобы готовый продукт подпадал под действие <code>GPL</code> (например,
продукт разрабатывается как коммерческий или существуют какие-либо
другие причины не открывать добавленный программный код, который не
подпадает под действие <code>GPL</code>). При покупке коммерческой лицензии
вы не используете ПО MySQL под лицензией <code>GPL</code>, даже несмотря на то,
что это один и тот же код. 

<LI>

В случае распространения приложения, не защищенного лицензией <code>GPL</code>,
которое предназначено для работы исключительно с ПО MySQL и
поставляется вместе с ним. Такой вариант решения в действительности
считается связыванием, даже если оно осуществляется по сети.

<LI>

В случае, когда вам требуется распространять ПО MySQL без
предоставления исходного кода, как того требует лицензия <code>GPL</code>.

<LI>

Если вы хотите сделать вклад в дальнейшее развитие технологии баз
данных MySQL - в таких случаях коммерческая лицензия формально может и
не требоваться. Еще одним хорошим способом оказать содействие развитию
ПО MySQL является приобретение контракта по поддержке непосредственно
у компании MySQL AB - это сразу же принесет пользу и вам (see section <A HREF="manual.ru.html#Support">1.6.1  Поддержка, предлагаемая компанией MySQL AB</A>).
</UL>

<P>
Для каждой инсталляции ПО MySQL вам понадобится отдельная лицензия. Ее
действие распространяется на любое число процессоров в машине и при этом
не накладывается никаких юридических ограничений на число клиентских
машин, подключенных к серверу.

</P>

<P>
По поводу коммерческих лицензий, см.
<a HREF="http://www.mysql.com/products/licensing.html">http://www.mysql.com/products/licensing.html</a>. Для контрактов на
поддержку, см. <a HREF="http://www.mysql.com/support/">http://www.mysql.com/support/</a>. Тех, для кого требуются
особые условия лицензирования, а также тех, у кого имеется ограниченный доступ
в Internet, просим связаться с нашим отделом сбыта по адресу
<a HREF="mailto:sales@mysql.com">sales@mysql.com</a>.

</P>


<H4><A NAME="Using_the_MySQL_software_for_free_under_GPL" HREF="manual.ru_toc.html#Using_the_MySQL_software_for_free_under_GPL">1.6.3.2  Бесплатное использование ПО MySQL по лицензии GPL</A></H4>

<P>
<A NAME="IDX78"></A>
<A NAME="IDX79"></A>

</P>

<P>
По лицензии <code>GPL</code> допускается бесплатное использование ПО MySQL если вы
согласны с условиями <code>GPL</code>. Подробнее по поводу лицензии <code>GPL</code> и 
освещение наиболее популярных вопросов вы найдете по адресу 
<a HREF="http://www.gnu.org/licenses/gpl-faq.html">http://www.gnu.org/licenses/gpl-faq.html</a>.

</P>
<P>
Некоторые общие примеры GPL-использования MySQL: 
 

<UL>
<LI>

Если вы распространяете код вашего приложения и код MySQL под 
лицензией GPL и в исходных текстах.

<LI>

При распространении исходного кода MySQL в комплекте с другими
программами, не связанными с <code>MySQL</code> или не зависящими от него по
своему функциональному назначению, даже в том случае, если они
распространяются на коммерческой основе.
Это называется <em>mere aggregation</em> в лицензии <code>GPL</code>.

<LI>

Если вы не распространяете <strong>никаких</strong> частей кода MySQL - вы можете
использовать MySQL бесплатно.

<LI>

<A NAME="IDX80"></A>
<A NAME="IDX81"></A>
<A NAME="IDX82"></A>
<A NAME="IDX83"></A>
<A NAME="IDX84"></A>

При использовании ПО MySQL сервис-провайдерами Internet (ISP),
предлагающими своим клиентам веб-хостинг с серверами баз данных MySQL.
С другой стороны, мы настоятельно рекомендуем пользователям обращаться
только к тем сервис-провайдерам, которые имеют контракт на поддержку
компании MySQL: только при наличии такого контракта можно иметь
уверенность в том, что при возникновении проблем с инсталляцией MySQL
сервис-провайдер будет способен оказать своим клиентам действенную
помощь. 

Заметим, что даже те сервис-провайдеры, которые
не имеют коммерческой лицензии на MySQL, должны, по крайней
мере, предоставить своим клиентам доступ к чтению исходного кода
инсталляции MySQL, чтобы они могли самостоятельно проверить
корректность всех сделанных ими дополнений или изменений.

<LI>

<A NAME="IDX85"></A>
<A NAME="IDX86"></A>
При использовании ПО баз данных MySQL совместно с веб-сервером
коммерческой лицензии не требуется (если, конечно, это не есть 
продукт, который вы распространяете). Это разрешение остается в силе
даже в том случае, если веб-сервер, использующий MySQL, -
коммерческий, так как при этом продажи версии MySQL, заложенной в
него, как таковой не происходит. Однако в таком случае желательно,
чтобы владелец веб-сервера приобрел контракт на поддержку MySQL,
поскольку ПО MySQL способствует успеху его предприятия.
</UL>

<P>
В общем случае мы рекомендуем приобретать контракт на поддержку компании
MySQL AB и тем, кому для использования ПО баз данных MySQL не требуется
коммерческой лицензии: этим вы будете способствовать развитию технологии
MySQL и заодно немедленно получите для себя дополнительные преимущества
(see section <A HREF="manual.ru.html#Support">1.6.1  Поддержка, предлагаемая компанией MySQL AB</A>).

</P>
<P>
В случае использования ПО баз данных MySQL в коммерческих целях,
предполагающего получение прибыли, мы предлагаем приобретение поддержки
того или иного уровня, что будет способствовать дальнейшему развитию ПО
MySQL. Мы считаем, что, если база данных MySQL способствует вашему
бизнесу, то резонно предложить и вам оказать содействие компании MySQL AB
(иначе получается так, что, обращаясь в нашу службу поддержки с вопросом,
вы не только бесплатно пользуетесь тем, во что мы вложили большое
количество усилий, но к тому же и требуете от нас еще и бесплатной
поддержки)

</P>


<H3><A NAME="MySQL_AB_Logos_and_Trademarks" HREF="manual.ru_toc.html#MySQL_AB_Logos_and_Trademarks">1.6.4  Логотипы и торговые марки MySQL AB</A></H3>

<P>
<A NAME="IDX87"></A>
<A NAME="IDX88"></A>

</P>
<P>
Многие пользователи СУБД MySQL выражают желание расположить логотип MySQL
AB с изображением дельфина на своих веб-сайтах, книгах или коробках со
своими программными продуктами. Мы приветствуем это желание, хотя и
обязаны напомнить, что MySQL и логотип MySQL с изображением дельфина
являются торговыми марками компании MySQL AB и могут применяться только в
соответствии с нашими правилами использования торговых знаков, с которыми
вы можете ознакомиться  по адресу
<a HREF="http://www.mysql.com/company/trademark.html">http://www.mysql.com/company/trademark.html</a>.

</P>



<H4><A NAME="The_Original_MySQL_logo" HREF="manual.ru_toc.html#The_Original_MySQL_logo">1.6.4.1  Оригинальный логотип MySQL</A></H4>

<P>
Логотип MySQL с изображением дельфина был создан финским рекламным
агентством Priority в 2001 году. Мы решили сделать эмблемой СУБД MySQL
дельфина - умное, проворное и изящное животное, с удивительной легкостью
плавающее в океане, так же как и наша СУБД - в океане данных. К тому же
дельфины нам просто нравятся.

</P>
<P>
Оригинальный логотип MySQL может использоваться только представителями
MySQL AB, а также лицами, получившими на то письменное разрешение.

</P>


<H4><A NAME="MySQL_Logos_that_may_be_Used_Without_Written_Permission" HREF="manual.ru_toc.html#MySQL_Logos_that_may_be_Used_Without_Written_Permission">1.6.4.2  Логотипы MySQL, которые могут использоваться без письменного разрешения</A></H4>

<P>
Мы разработали несколько специальных логотипов для договорного
использования, которые можно загрузить с нашего сайта, расположенного по
адресу <a HREF="http://www.mysql.com/press/logos.html">http://www.mysql.com/press/logos.html</a> и применять на сайтах
третьих сторон без письменного разрешения MySQL AB. Возможности
использования этих логотипов, как и следует из их названия, определенным
образом ограничены: они регламентируются правилами применения наших
торговых знаков (которые также приведены у нас на сайте). Если вы
планируете использовать данные логотипы, необходимо ознакомиться с
указанными правилами. Они в основном сводятся к следующим:

</P>

<UL>
<LI>

Нужный вам логотип вы можете использовать в том виде, в котором он
приведен на сайте <a HREF="http://www.mysql.com/">http://www.mysql.com/</a>. Вы имеете право задать
необходимые размеры логотипа, но не можете менять его цвета или
вносить в изображение какие-либо другие изменения.

<LI>

Должно быть явно указано, что именно вы, а не MySQL AB, являетесь
создателем и владельцем сайта, на котором присутствует торговый знак
MySQL.

<LI>

Не разрешается использовать торговый знак в целях, которые могли бы
принести вред MySQL AB или понизить ценность торговых знаков MySQL AB.
Мы оставляем за собой право запретить использование торгового знака
MySQL AB.

<LI>

Помещая торговый знак на своем сайте, сделайте его гиперссылкой на
сайт <a HREF="http://www.mysql.com/">http://www.mysql.com/</a>.

<LI>

Если вы используете СУБД MySQL в своем приложении на условиях лицензии
GPL, оно должно быть создано в соответствии с идеологией Open Source и
снабжено способностью подсоединяться к серверу MySQL.
</UL>

<P>
Связаться с нами с целью заключения соответствующих вашим потребностям
соглашений можно по адресу <a HREF="mailto:trademark@mysql.com">trademark@mysql.com</a>.

</P>


<H4><A NAME="When_need_MySQL_logo_permission" HREF="manual.ru_toc.html#When_need_MySQL_logo_permission">1.6.4.3  В каком случае для использования логотипов необходимо письменное разрешение?</A></H4>

<P>
Письменное разрешение MySQL AB для использования логотипов MySQL
необходимо в следующих случаях:

</P>

<UL>
<LI>

При использовании логотипа MySQL AB где бы то ни было, кроме вашего
веб-сайта.

<LI>

При использовании любого логотипа MySQL AB, кроме вышеупомянутых
специальных логотипов для договорного использования, на веб-сайтах или
в любых других местах.
</UL>

<P>
Исходя из юридических и коммерческих соображений, мы следим за
использованием торговых знаков MySQL на различных продуктах, книгах и т.п.
Обычно мы взимаем плату за помещение логотипов MySQL AB на коммерческих
продуктах, так как считаем, что вполне справедливо, если часть полученных
производителем прибылей идет таким образом на финансирование дальнейшего
усовершенствования СУБД MySQL.

</P>


<H4><A NAME="MySQL_AB_Partnership_Logos" HREF="manual.ru_toc.html#MySQL_AB_Partnership_Logos">1.6.4.4  Партнерские логотипы MySQL AB</A></H4>

<P>
Партнерские логотипы MySQL могут использоваться только теми компаниями и
частными лицами, которые подписали письменное соглашение о партнерстве с
MySQL AB. В условия подписания такового соглашения входит сертификация в
качестве преподавателя или консультанта MySQL. See section <A HREF="manual.ru.html#Business_Services_Partnering">1.5.1.5  О нашей программе партнерства</A>.

</P>


<H4><A NAME="Using_MySQL_word_in_presentations" HREF="manual.ru_toc.html#Using_MySQL_word_in_presentations">1.6.4.5  Использование слова <code>MySQL</code> в текстовых документах и презентациях</A></H4>

<P>
MySQL AB приветствует упоминания о СУБД MySQL, но не следует забывать о
том, что слово <code>MySQL</code> - торговая марка MySQL AB. Поэтому первое
встречающееся в тексте слово <code>MySQL</code> следует снабдить символом,
обозначающим торговую марку (<code>TM</code>), а также (по возможности) упомянуть о
том, что MySQL является зарегистрированной торговой маркой компании MySQL
AB. Дополнительную информацию вы сможете получить, ознакомившись с нашими
правилами использования торговых знаков, расположенными по адресу
<a HREF="http://www.mysql.com/company/trademark.html">http://www.mysql.com/company/trademark.html</a>.

</P>


<H4><A NAME="Using_MySQL_word_in_company_and_product_names" HREF="manual.ru_toc.html#Using_MySQL_word_in_company_and_product_names">1.6.4.6  Использование слова <code>MySQL</code> в названиях компаний и продуктов</A></H4>

<P>
Использовать слово MySQL в названиях компаний, продуктов или в именах
доменов без письменного разрешения MySQL AB запрещено.

</P>



<H2><A NAME="MySQL_4.0_In_A_Nutshell" HREF="manual.ru_toc.html#MySQL_4.0_In_A_Nutshell">1.7  Кратко о MySQL 4.x</A></H2>

<P>
Наконец-то появилась давно обещанная компанией MySQL AB бета-версия MySQL
Server 4.0, которую так долго ждали пользователи. Ее можно загрузить с
веб-сайта <a HREF="http://www.mysql.com/">http://www.mysql.com/</a> или с наших зеркал.

</P>
<P>
Большинство новых функций MySQL 4.0 ориентированы на уже
существующих пользователей MySQL уже существующих пользователей в
общественной и деловой сфере. Эти функции позволяют усовершенствовать
программное обеспечение базы данных MySQL, предоставляя решения для
критически важных систем управления базами данных, работающих с большими
объемами информации. Остальные новые функции предназначены для
пользователей встроенных баз данных.

</P>



<H3><A NAME="Nutshell_Stepwise_Rollout" HREF="manual.ru_toc.html#Nutshell_Stepwise_Rollout">1.7.1  Поэтапный выпуск</A></H3>

<P>
Начиная с 4.0.6, MySQL имеет статус gamma, что означает что версии 4.0.x в
течении более чем 2 месяцев (сначала в alpha-, затем и в beta-статусе)
используются без каких-либо известных серьезных и сложных для исправления
ошибок и готовы для промышленного использования. 

</P>
<P>
Мы снимем префикс gamma, когда MySQL 4.0 будет в эксплуатации более чем один
месяц без обнаруженных серьезных ошибок. 

</P>
<P>
Все новые функции будут добавляться в версию MySQL 4.1, доступную сейчас
из нашего репозитория bk, выпуск alpha-версии которой запланирован на 
первый квартал 2003. See section <A HREF="manual.ru.html#Installing_source_tree">2.3.4  Установка из экспериментального набора исходных кодов</A>.

</P>



<H3><A NAME="Nutshell_Ready_for_Immediate_Use" HREF="manual.ru_toc.html#Nutshell_Ready_for_Immediate_Use">1.7.2  Можно использовать уже прямо сейчас</A></H3>

<P>
Все бинарные поставки проходят наши сложные тесты без каких-либо ошибок на всех
платформах, на которых мы тестируем MySQL. MySQL 4.0 протестирован в реальных
условиях огромным количеством пользователей и находится в промышленной
эксплуатациями на нескольких крупных сайтах. 

</P>



<H3><A NAME="Nutshell_Embedded_MySQL" HREF="manual.ru_toc.html#Nutshell_Embedded_MySQL">1.7.3  Встроенный MySQL</A></H3>

<P>
Библиотека <code>libmysqld</code> обеспечивает для <code>MySQL</code> возможность не
отставать от прогресса в стремительно развивающемся мире приложений.
Вариант MySQL в виде встроенной библиотеки позволяет встраивать
MySQL в различные приложения и электронные устройства так, что
конечный пользователь даже не будет знать о ``заложенной в их фундаменте''
базе данных. Встроенный MySQL идеально подходит для использования в
интернет-приложениях, публичных киосках, в устройствах с сочетанием
аппаратного и программного обеспечения, высокопроизводительных
интернет-серверах, автономных базах данных, распространяемых на
компакт-дисках, и так далее.

</P>
<P>
Большинство пользователей <code>libmysqld</code> оценят преимущество <em>Двойной лицензии</em>
MySQL. Для тех, кто не хочет связывать себя условиями <code>GPL</code> лицензии, программное обеспечение доступно также на условиях коммерческой
лицензии. Для встроенной библиотеки MySQL используется такой же интерфейс,
как и для обычной клиентской библиотеки, поэтому ею удобно и легко
пользоваться. See section <A HREF="manual.ru.html#libmysqld">8.4.9  libmysqld, встраиваемая библиотека сервера MySQL</A>.

</P>


<H3><A NAME="Nutshell_Other_features" HREF="manual.ru_toc.html#Nutshell_Other_features">1.7.4  Другие функции, доступные в MySQL 4.0</A></H3>


<UL>
<LI>

В версии 4.0 еще больше возросла скорость работы MySQL в нескольких
областях, таких как множественные вставки (<code>bulk INSERT</code>) для большого
количества данных, поиск в сжатых индексах, создание полнотекстовых
индексов (<code>FULLTEXT</code>), а также <code>COUNT(DISTINCT)</code>.

<LI>

Обработчик таблиц InnoDB теперь входит в стандартный набор сервера
MySQL, включая полную поддержку транзакций и блокировок уровня строки.

<LI>

Немецкие, австрийские и швейцарские пользователи нашей программы
обратят внимание, что мы добавили новый набор символов, latin1_de,
который позволяет исправить порядок сортировки немецких символов,
размещая немецкие умляуты в соответствии с телефонными книгами,
используемыми в Германии.

<LI>

Функции для упрощения преобразования из других систем баз данных в
MySQL, включают <code>TRUNCATE TABLE</code> (как в Oracle) и <code>IDENTITY</code>, как
синоним автоматически инкрементируемых ключей (как в Sybase). Многим
пользователям также будет приятно узнать, что MySQL теперь
поддерживает оператор <code>UNION</code>, долгожданную стандартную функцию SQL.

<LI>

Создавая новые функции для новых пользователей, мы не забыли о запросах наших
постоянных пользователей. У нас есть многотабличные операторы <code>DELETE</code> и
<code>UPDATE</code> Добавив поддержку символических ссылок к <code>MyISAM</code> на уровне
таблицы (а не только на уровне базы данных, как это было раньше), а также
включив обработку таких ссылок как функцию, используемую в Windows по
умолчанию, мы надеемся продемонстрировать, что серьезно относимся к
предложениям по усовершенствованиям. Такие функции как
<code>SQL_CALC_FOUND_ROWS</code> и <code>FOUND_ROWS()</code> позволяют узнать, сколько
строк возвратит запрос без оператора <code>LIMIT</code>.  

</UL>



<H3><A NAME="Nutshell_Future_features" HREF="manual.ru_toc.html#Nutshell_Future_features">1.7.5  Функции MySQL 4.x, которые будут добавлены в будущем</A></H3>

<P>
В последующих версиях <code>MySQL</code> 4.x будут добавлены следующие функции,
которые на данный момент находятся в стадии разработки:

</P>

<UL>
<LI>

Пользователи MySQL, работающие с критически важными системами и
большими объемами данных, оценят дополнения к нашей системе репликации
и удаленного резервного копирования. В более поздние версии 4.x будет
включена отказобезопасная репликация; а к функциям уже существующей в
версии 4.0 команды <code>LOAD DATA FROM MASTER</code> в скором времени будет
добавлена автоматизация настройки подчиненных серверов. Удаленное
резервное копирование обеспечит возможность легко добавлять новые
подчиненные серверы, не отключая головной сервер, - это позволит
практически избежать потерь в производительности при обновлении
объемных систем.

<LI>

Для администраторов баз данных удобным окажется еще одно новшество: в
скором времени параметры <code>mysqld</code> (настройки запуска) можно будет
изменять без выключения серверов.

<LI>

Новые свойства поиска <code>FULLTEXT</code> в MySQL 4.0 позволяют
использовать <code>FULLTEXT</code>-индексацию больших объемов текста при помощи как
бинарной логики поиска, так и логики поиска естественного языка.
Пользователи могут производить настройку минимальной длины слова и
задавать свои списки недопустимых слов на любом естественном языке,
благодаря чему появляется возможность создания новой группы программ
на основе MySQL.

<LI>

Производительность многих ``тяжеловесных'' приложений повысится
благодаря еще более возросшей скорости заново переписанного ключевого
кэша.

<LI>

Большинству разработчиков также понравится встроенная в MySQL справка,
которая вызывается из командной строки на клиенте.
</UL>



<H3><A NAME="Nutshell_4.1_development_release" HREF="manual.ru_toc.html#Nutshell_4.1_development_release">1.7.6  MySQL 4.1, следующая ветка в разработке</A></H3>

<P>
MySQL 4.0 готовит базу для реализации новых возможностей в сервере MySQL
4.1 и более новых версиях. Имеются в виду такие возможности, как вложенные
подзапросы (<code>nested subqueries</code>) (4.1), хранимые процедуры (5.0) и правила
целостности ссылок (<code>foreign key integrity rules</code>) для MyISAM-таблиц (5.0). 

</P>
<P>
Эти возможности возглавляют список наиболее востребованных нашими потребителями
функций.

</P>
<P>
После реализации этих изменений критикам СУБД MySQL придется проявить
больше изобретательности и придумать более убедительные аргументы, чем
просто указание на недостающие функциональные возможности. Будучи давно
известной как быстродействующая, надежная и легкая в использовании, СУБД
MySQL теперь станет соответствовать ожиданиям самых требовательных
потребителей.

</P>


<H2><A NAME="MySQL_Information_Sources" HREF="manual.ru_toc.html#MySQL_Information_Sources">1.8  Источники информации по MySQL</A></H2>



<H3><A NAME="Questions" HREF="manual.ru_toc.html#Questions">1.8.1  Списки рассылки MySQL</A></H3>

<P>
<A NAME="IDX89"></A>
<A NAME="IDX90"></A>
<A NAME="IDX91"></A>

</P>

<P>
В этом разделе представлены списки рассылки MySQL, а также даются
некоторые указания по их использованию. Подписавшись на список рассылки,
вы будете получать по электронной почте информацию из данного списка и
сможете отправлять туда свои собственные вопросы и ответы.

</P>


<H4><A NAME="Mailing-list" HREF="manual.ru_toc.html#Mailing-list">1.8.1.1  Списки рассылки MySQL</A></H4>

<P>
<A NAME="IDX92"></A>

</P>
<P>
Чтобы подписаться на главный список рассылки MySQL, следует отправить
сообщение на адрес электронной почты <a HREF="mailto:mysql-subscribe@lists.mysql.com">mysql-subscribe@lists.mysql.com</a>.

</P>
<P>
Чтобы отказаться от подписки на главный список рассылки MySQL, следует
отправить сообщение на адрес электронной почты
<a HREF="mailto:mysql-unsubscribe@lists.mysql.com">mysql-unsubscribe@lists.mysql.com</a>.

</P>
<P>
В посылаемом сообщении роль играет только адрес, на который это сообщение
отправляется. Тема и текст сообщения игнорируются.

</P>
<P>
Если адрес, с которого было отправлено ваше сообщение, не действителен,
можно точно указать адрес для подписки или адрес, подписку для которого
следует аннулировать. Для этого в указанных выше адресах электронной почты
следует добавить дефис в конце командного слова, обозначающего подписку
(<code>subscribe</code>) или отказ от нее (<code>unsubscribe</code>), а за ним - нужный адрес
электронной почты, заменив в нем символ <samp>`@'</samp> на символ <samp>`='</samp>. Например, чтобы
подписать адрес <a HREF="mailto:your_name@host.domain">your_name@host.domain</a>, необходимо отправить сообщение на
<a HREF="mailto:mysql-subscribe-your_name=host.domain@lists.mysql.com">mysql-subscribe-your_name=host.domain@lists.mysql.com</a>.

</P>
<P>
Сообщения, посланные по адресам <a HREF="mailto:mysql-subscribe@lists.mysql.com">mysql-subscribe@lists.mysql.com</a> или
<a HREF="mailto:mysql-unsubscribe@lists.mysql.com">mysql-unsubscribe@lists.mysql.com</a>, обрабатываются автоматически программой
обслуживания списка рассылки <code>ezmlm</code>. Информация по программе ezmlm доступна
на веб-узле <code>ezmlm</code> (<a HREF="http://www.ezmlm.org/">http://www.ezmlm.org/</a>).

</P>
<P>
Чтобы отправить сообщение в список рассылки, следует послать сообщение по
адресу <a HREF="mailto:mysql@lists.mysql.com">mysql@lists.mysql.com</a>. Пожалуйста, не отправляйте сообщения о
подписке или отказе от подписки на адрес <a HREF="mailto:mysql@lists.mysql.com">mysql@lists.mysql.com</a>, поскольку
все сообщения, направленные на этот адрес, автоматически распространяются
среди тысяч других подписчиков.

</P>
<P>
Если на вашем локальном веб-узле уже есть подписчики на
<a HREF="mailto:mysql@lists.mysql.com">mysql@lists.mysql.com</a>, то на нем может существовать локальный список
рассылки, поэтому сообщения, отправленные из <code>lists.mysql.com</code> на ваш
веб-узел, будут также дублироваться в местный список. В таких случаях
необходимо связаться со своим системным администратором, чтобы он добавил
вас в местный список рассылки MySQL или исключил из него.

</P>
<P>
Если необходимо, чтобы сообщения, поступающие со списка рассылки,
направлялись в отдельный почтовый ящик вашего почтового клиента,
установите фильтр по заголовкам сообщений. Чтобы выделить сообщения из
списка рассылки, можно использовать заголовки <code>List-ID:</code> или <code>Delivered-To:</code>.

</P>
<P>
Существуют следующие списки рассылки MySQL:

</P>
<DL COMPACT>

<DT><code><a HREF="mailto:announce-subscribe@lists.mysql.com">announce-subscribe@lists.mysql.com</a> announce</code>
<DD>
Список для объявлений о выходах новых версий MySQL и относящихся к нему
программ. Количество сообщений здесь небольшое, и на этот список
желательно подписаться всем пользователям MySQL.

<DT><code><a HREF="mailto:mysql-subscribe@lists.mysql.com">mysql-subscribe@lists.mysql.com</a> mysql</code>
<DD>
Главный список для обсуждения общих вопросов по MySQL. Обратите внимание:
некоторые темы лучше обсуждать в более специализированных списках. Если
отправить сообщение не в тот список, то можно не получить ответа!

<DT><code><a HREF="mailto:mysql-digest-subscribe@lists.mysql.com">mysql-digest-subscribe@lists.mysql.com</a> mysql-digest</code>
<DD>
Список <code>mysql</code> в виде сборника. Это означает, что вы получите все сообщения,
отправленные за день, в виде одного большого почтового сообщения, которое
отправляется раз в день.

<DT><code><a HREF="mailto:bugs-subscribe@lists.mysql.com">bugs-subscribe@lists.mysql.com</a> bugs</code>
<DD>
В этот список можно отправлять только подробные отчеты о повторяющихся
ошибках, используя макропрограмму <code>mysqlbug</code> (если вы работаете в Windows,
необходимо включить описание операционной системы и указать версию MySQL).
Прежде чем отправлять отчет об ошибке, желательно проверить, при
использовании какой версии MySQL данная ошибка возникает -
последней окончательной или находящейся на стадии разработки! Чтобы любой
желающий мог воспроизвести эту ошибку, желательно также включить в отчет
контрольный тестовый пример, который можно было бы запустить при помощи
<code>mysql test &#60; script</code>. Все ошибки, сообщения о которых будут направлены в
список рассылки, будут либо исправлены, либо включены в список ошибок в
следующей версии MySQL! Если необходимо только небольшое изменение кода,
мы также отправим исправляющую эту ошибку заплатку для программы.

<DT><code><a HREF="mailto:bugs-digest-subscribe@lists.mysql.com">bugs-digest-subscribe@lists.mysql.com</a> bugs-digest</code>
<DD>
Список <code>bugs</code> в виде сборника.

<DT><code><a HREF="mailto:internals-subscribe@lists.mysql.com">internals-subscribe@lists.mysql.com</a> internals</code>
<DD>
Список для тех, кто работает над кодом MySQL. В этом списке также можно
обсуждать разработку MySQL и отправлять в него вставки в программу.

<DT><code><a HREF="mailto:internals-digest-subscribe@lists.mysql.com">internals-digest-subscribe@lists.mysql.com</a> internals-digest</code>
<DD>
Версия в виде сборника для списка <code>internals</code>.

<DT><code><a HREF="mailto:java-subscribe@lists.mysql.com">java-subscribe@lists.mysql.com</a> java</code>
<DD>
Обсуждение вопросов, связанных с MySQL и Java. В основном
обсуждение по драйверам JDBC включая MySQL Connector/J.

<DT><code><a HREF="mailto:java-digest-subscribe@lists.mysql.com">java-digest-subscribe@lists.mysql.com</a> java-digest</code>
<DD>
Версия в виде сборника для списка <code>java</code>.

<DT><code><a HREF="mailto:win32-subscribe@lists.mysql.com">win32-subscribe@lists.mysql.com</a> win32</code>
<DD>
Все вопросы, касающиеся программного обеспечения MySQL в операционных
системах Microsoft, таких как Windows 9x/Me/NT/2000/XP.

<DT><code><a HREF="mailto:win32-digest-subscribe@lists.mysql.com">win32-digest-subscribe@lists.mysql.com</a> win32-digest</code>
<DD>
Версия в виде сборника для списка <code>win32</code>.

<DT><code><a HREF="mailto:myodbc-subscribe@lists.mysql.com">myodbc-subscribe@lists.mysql.com</a> myodbc</code>
<DD>
Все вопросы, касающиеся соединения MySQL через ODBC.

<DT><code><a HREF="mailto:myodbc-digest-subscribe@lists.mysql.com">myodbc-digest-subscribe@lists.mysql.com</a> myodbc-digest</code>
<DD>
Версия в виде сборника для списка <code>myodbc</code>.

<DT><code><a HREF="mailto:mysqlcc-subscribe@lists.mysql.com">mysqlcc-subscribe@lists.mysql.com</a> mysqlcc</code>
<DD>
Все вопросы, касающиеся графического клиента MySQL Control Center (MyCC).

<DT><code><a HREF="mailto:mysqlcc-digest-subscribe@lists.mysql.com">mysqlcc-digest-subscribe@lists.mysql.com</a> mysqlcc-digest</code>
<DD>
Версия в виде сборника для списка <code>mysqlcc</code>.

<DT><code><a HREF="mailto:plusplus-subscribe@lists.mysql.com">plusplus-subscribe@lists.mysql.com</a> plusplus</code>
<DD>
Все вопросы, касающиеся программирования на C++ API для MySQL.

<DT><code><a HREF="mailto:plusplus-digest-subscribe@lists.mysql.com">plusplus-digest-subscribe@lists.mysql.com</a> plusplus-digest</code>
<DD>
Версия в виде сборника для списка <code>plusplus</code>.

<DT><code><a HREF="mailto:msql-mysql-modules-subscribe@lists.mysql.com">msql-mysql-modules-subscribe@lists.mysql.com</a> msql-mysql-modules</code>
<DD>
Список по поддержке Perl для MySQL при помощи msql-mysql-modules.

<DT><code><a HREF="mailto:msql-mysql-modules-digest-subscribe@lists.mysql.com">msql-mysql-modules-digest-subscribe@lists.mysql.com</a> msql-mysql-modules-digest</code>
<DD>
Версия в виде сборника для списка <code>msql-mysql-modules</code>.
</DL>

<P>
Подписаться или отказаться от подписки на все списки рассылки можно
способом, указанным выше. В своем сообщении о подписке или отказе от
подписки вместо <code>mysql</code> просто укажите соответствующее название списка
рассылки. Например, чтобы подписаться на список рассылки <code>myodbc</code> или
отказаться от подписки на него, следует отправить сообщение по адресу
<a HREF="mailto:myodbc-subscribe@lists.mysql.com">myodbc-subscribe@lists.mysql.com</a> или <a HREF="mailto:myodbc-unsubscribe@lists.mysql.com">myodbc-unsubscribe@lists.mysql.com</a>.

</P>
<P>
Если получить ответы на свои вопросы в списке рассылки не удалось, можно
оплатить поддержку от MySQL AB - это позволит вам напрямую общаться с
разработчиками MySQL. See section <A HREF="manual.ru.html#Support">1.6.1  Поддержка, предлагаемая компанией MySQL AB</A>.

</P>
<P>
В приведенной ниже таблице указаны некоторые списки рассылки MySQL на
языках, отличных от английского. Обратите внимание на то, что компания
MySQL AB эти списки не контролирует, поэтому мы не можем гарантировать их
качество.

</P>
<DL COMPACT>

<DT><code><a HREF="mailto:mysql-france-subscribe@yahoogroups.com">mysql-france-subscribe@yahoogroups.com</a> Французский список рассылки</code>
<DD>
<DT><code><a HREF="mailto:list@tinc.net">list@tinc.net</a> Корейский список рассылки</code>
<DD>
Чтобы подписаться на этот список рассылки, отправьте сообщение <code>subscribe
mysql your@e-mail.address</code>.

<DT><code><a HREF="mailto:mysql-de-request@lists.4t2.com">mysql-de-request@lists.4t2.com</a> Немецкий список рассылки</code>
<DD>
Чтобы подписаться на этот список рассылки, отправьте сообщение <code>subscribe
mysql-de your@e-mail.address</code>. Информацию по этому списку рассылки можно
найти на <a HREF="http://www.4t2.com/mysql/">http://www.4t2.com/mysql/</a>.

<DT><code><a HREF="mailto:mysql-br-request@listas.linkway.com.br">mysql-br-request@listas.linkway.com.br</a> Португальский список рассылки</code>
<DD>
Чтобы подписаться на этот список рассылки, отправьте сообщение <code>subscribe
mysql-br your@e-mail.address</code>.

<DT><code><a HREF="mailto:mysql-alta@elistas.net">mysql-alta@elistas.net</a> Испанский список рассылки</code>
<DD>
Чтобы подписаться на этот список рассылки, отправьте сообщение <code>subscribe
mysql your@e-mail.address</code>.
</DL>



<H4><A NAME="Asking_questions" HREF="manual.ru_toc.html#Asking_questions">1.8.1.2  Как задавать вопросы и направлять сообщения об ошибках</A></H4>

<P>
<A NAME="IDX93"></A>
<A NAME="IDX94"></A>
<A NAME="IDX95"></A>

</P>
<P>
Прежде чем отправлять отчет об ошибке, необходимо выполнить следующие
действия:

</P>

<UL>
<LI>

Сначала проведите поиск в интерактивном руководстве по MySQL на:
<a HREF="http://www.mysql.com/doc">http://www.mysql.com/doc</a>/

Мы стараемся постоянно обновлять данное руководство, добавляя информацию об
исправлениях последних обнаруженных ошибок!  Приложение, описывающее историю
изменений  (<a HREF="http://www.mysql.com/doc/en/News.html">http://www.mysql.com/doc/en/News.html</a>) также может быть
полезным, т.к. вполне возможно, что именно в новой версии уже есть решение
вашей проблемы. 

<LI>

Посмотрите в базе данных ошибок по адресу <a HREF="http://bugs.mysql.com">http://bugs.mysql.com</a>. Может,
известная ошибка уже сообщена и исправлена. 

<LI>

Просмотрите архивы списка рассылки MySQL:
<a HREF="http://lists.mysql.com">http://lists.mysql.com</a>/

<LI>

Можно также воспользоваться ссылкой <a HREF="http://www.mysql.com/search/">http://www.mysql.com/search/</a>,
чтобы произвести поиск по всем веб-страницам (включая руководство),
расположенным на веб-узле <a HREF="http://www.mysql.com/">http://www.mysql.com/</a>.
</UL>

<P>
Если в руководстве или архивах не удалось найти ответ, обратитесь к
локальному эксперту по MySQL. Если же и таким образом не удалось получить
ответы на вопросы, переходите к следующему разделу, в котором описано, как
отправлять почту на <a HREF="mailto:mysql@lists.mysql.com">mysql@lists.mysql.com</a>.

</P>


<H4><A NAME="Bug_reports" HREF="manual.ru_toc.html#Bug_reports">1.8.1.3  Как отправлять отчеты об ошибках или проблемах</A></H4>

<P>
<A NAME="IDX96"></A>
<A NAME="IDX97"></A>
<A NAME="IDX98"></A>
<A NAME="IDX99"></A>
<A NAME="IDX100"></A>
<A NAME="IDX101"></A>

</P>
<P>
Чтобы написать хороший отчет об ошибке, потребуется немало терпения.
Однако лучше сделать все правильно с первой попытки - это сбережет и ваше,
и наше время. Грамотно составленный отчет об ошибке, содержащий ее
подробное описание, позволит нам исправить эту ошибку уже в следующей
версии программы. Включенные в данный раздел рекомендации помогут вам
правильно написать свой отчет, не тратя времени на описание того, что мало
чем сможет нам помочь или не потребуется вовсе.

</P>
<P>
Мы рекомендуем для создания отчетов об ошибках (или отчетов о любых
проблемах), всегда, если это возможно, использовать сценарий <code>mysqlbug</code>.
<code>mysqlbug</code> можно найти в каталоге <tt>`scripts'</tt> раздела распространения исходных
текстов, или в разделе распространения исполняемых программ, в каталоге
<tt>`bin'</tt> инсталляционного каталога MySQL. Если же не удается воспользоваться
<code>mysqlbug</code>, то все равно необходимо указать в своем отчете все данные,
перечисленные ниже в этом разделе.

</P>
<P>
Сценарий <code>mysqlbug</code> помогает сгенерировать отчет путем автоматического
определения большей части приведенной ниже информации, но если окажется,
что в сгенерированном отчете отсутствует что-либо важное, обязательно
включите это в свое сообщение! Внимательно прочитайте данный раздел и
убедитесь, что в отчет вошли все описанные здесь сведения.

</P>
<P>
<A NAME="IDX102"></A>
Обычно отчеты об ошибках и проблемах направляются в <a HREF="mailto:mysql@lists.mysql.com">mysql@lists.mysql.com</a>.
Если же вы можете создать подробное описание, четко определяющее ошибку,
его можно направить в список рассылки <a HREF="mailto:bugs@lists.mysql.com">bugs@lists.mysql.com</a>. Обратите
внимание: в этот список рассылки можно посылать только полный отчет о
повторяющейся ошибке, составленный при помощи сценария <code>mysqlbug</code>. Если вы
работаете в Windows, необходимо включить описание операционной системы и
версии MySQL. Прежде чем направлять отчет, желательно проверить,
проявляется ли данная проблема при использовании последней окончательной
или находящейся в стадии разработки версии MySQL! Чтобы любой
желающий мог воспроизвести эту ошибку, желательно также включить в отчет
контрольный тестовый пример, который можно было бы запустить при помощи
``<code>mysql test &#60; script</code>'', либо Perl-сценарий или сценарий оболочки, которые
можно запустить непосредственно. Все ошибки, сообщения о которых будут
направлены в список рассылки, будут либо исправлены, либо включены в
список ошибок в следующей версии MySQL! Если необходимо только небольшое
изменение кода, мы также отправим исправляющий эту ошибку патч для
программы.

</P>
<P>
Если вы нашли ошибку в системе безопасности MySQL, необходимо отправить
сообщение по адресу <a HREF="mailto:security@mysql.com">security@mysql.com</a>.

</P>
<P>
Не забывайте о том, что можно ответить на сообщение, в котором содержится
слишком много информации, но нельзя ответить на сообщение, в котором
информации недостаточно. Часто те, кто нам пишет, опускают некоторые
факты: они считают, что им известна причина возникшей проблемы и поэтому,
по их мнению, некоторые детали не имеют значения. Необходимо
придерживаться следующего принципа: если возникают сомнения в отношении
того, следует или нет приводить в отчете те или иные сведения, - включите
их в отчет обязательно! Намного быстрее и проще написать несколько
дополнительных строк в отчете, чем получать уточняющие вопросы и снова
ждать ответа только потому, что в первый раз были указаны не все данные.

</P>
<P>
Чаще всего наши корреспонденты не указывают используемую версию MySQL или
платформу, на которой установлен сервер MySQL (включая версию платформы).
Это довольно существенная информация, и в 99 случаях из 100 отчет об
ошибке без нее будет совершенно бесполезным! Очень часто бывает и так: мы
получаем вопрос типа: ''Почему это у меня не работает?'', а потом
оказывается, что указанная функция в данной версии MySQL отсутствует или
что ошибка, описанная в отчете, уже была исправлена в более новой версии
MySQL. Иногда ошибка зависит от используемой платформы. В таких случаях
практически невозможно ничего исправить, не имея информации об
операционной системе и о версии платформы.

</P>
<P>
Не забывайте указывать информацию о своем компиляторе - в тех случаях,
когда это имеет отношение к возникшей проблеме. Ведь бывает и так:
пользователь полагает, что проблема связана с MySQL, а на самом деле он
нашел ошибку в компиляторе. Большинство компиляторов постоянно находятся в
состоянии разработки и становятся лучше от версии к версии. Чтобы
определить, зависит ли ваша проблема от компилятора, мы должны знать,
какой именно используется компилятор. Обратите внимание на то, что все
проблемы с компиляторами должны рассматриваться как ошибки и по ним должен
составляться соответствующий отчет.

</P>
<P>
Вы окажете нам значительную помощь, включив в отчет об ошибке подробное
описание проблемы. В качестве хорошего примера подобной информации можно
привести описание всех действий, которые привели к возникновению проблемы
и описание самой проблемы. Лучшие отчеты содержат подробные примеры, в
которых показано, как можно воспроизвести ошибку или проблему.
section <A HREF="manual.ru.html#Reproduceable_test_case">D.1.6  Создание контрольного примера при повреждении таблиц</A>.

</P>
<P>
Если программа выдает сообщение об ошибке, очень важно точно воспроизвести
это сообщение в своем отчете! Возможно, нам придется производить поиск в
архивах - лучше, чтобы указанное в отчете сообщение об ошибке точно
совпадало с тем, которое выдает программа. Не следует пытаться запомнить
сообщение об ошибке, имеет смысл просто скопировать его полностью и
вставить в отчет!

</P>
<P>
Если возникли проблемы с <code>MyODBC</code>, необходимо попытаться создать файл
трассировки <code>MyODBC</code>. See section <A HREF="manual.ru.html#MyODBC_bug_report">8.3.7  Составление отчетов о проблемах с MyODBC</A>.

</P>
<P>
Не забывайте, что у большинства людей, которые будут читать ваш отчет,
экраны дисплеев имеют ширину в 80 символов. При создании отчетов или
примеров при помощи средств командной строки <code>mysql</code> необходимо использовать
параметр <code>--vertical</code> (или терминатор оператора <code>\G</code>) для выходных данных,
которые будут превышать ширину для таких дисплеев (пример для оператора
<code>EXPLAIN SELECT</code> приведен ниже в данном разделе).

</P>
<P>
<A NAME="IDX103"></A>
В свой отчет вам необходимо включить следующую информацию:

</P>

<UL>
<LI>

Версию используемого дистрибутива MySQL (например MySQL Version
3.22.22). Чтобы узнать, какая версия запущена, следует выполнить
команду <code>mysqladmin version</code>. Программу <code>mysqladmin</code> можно найти в
каталоге <tt>`bin'</tt> инсталляционного каталога MySQL.

<LI>

Производителя и модель компьютера, на котором вы работаете.

<LI>

Название и версию операционной системы. Для большинства операционных
систем эту информацию можно получить, выполнив команду Unix <code>uname -a</code>.

<LI>

Иногда важную роль играет количество памяти (реальной и виртуальной).
Если у вас есть основания считать, что такая информация может
оказаться полезной, включите в отчет эти значения.

<LI>

Если используется дистрибутив в виде исходных текстов программного
обеспечения MySQL, необходимо указать версию используемого
компилятора. Если используется бинарный дистрибутив, необходимо
указать имя дистрибутива.

<LI>

Если проблема возникает во время компиляции, включите в отчет точное
сообщение об ошибке (или ошибках), а также несколько строк до и после
вызывающего ошибку кода в файле, вызвавшем проблему.

<LI>

Если произошло аварийное завершение работы <code>mysqld</code>, необходимо сообщить
о запросе, который привел к такому завершению. Это можно выяснить,
запустив <code>mysqld</code> с включенной функцией ведения журнала.
See section <A HREF="manual.ru.html#Using_log_files">D.1.5  Использование журналов для определения причин ошибок в mysqld</A>.

<LI>

Если с программой связана какая-либо таблица базы данных, включите в
отчет выходную информацию команды <code>mysqldump --no-data db_name
tbl_name1 tbl_name2 ...</code>. Выполняется это очень легко. Таким способом
можно получить подробную информацию о таблице в базе данных, что
поможет нам создать ситуацию, соответствующую той, в которой оказались
вы.

<LI>

Для ошибок, связанных со скоростью выполнения или проблемами с операторами
<code>SELECT</code>, всегда необходимо включать в отчет выходную информацию команды
<code>EXPLAIN SELECT ...</code> и, по крайней мере, количество строк, которые выдает
оператор <code>SELECT</code>. Вы также должны включить вывода <code>SHOW CREATE TABLE
...</code> для каждой таблицы, задействованной в запросе.  Чем больше информации
будет предоставлено о сложившейся ситуации, тем больше шансов, что будет
оказана надлежащая помощь! Например, ниже приведен образец очень хорошего
отчета об ошибке (он, конечно, должен быть отправлен при помощи сценария
<code>mysqlbug</code>): 

Пример запускается при помощи командной строки <code>mysql</code> (обратите внимание
на применение терминатора операторов <code>\G</code>, который используется для
операторов, если ширина выводимой ими информации превышает ширину строки
80-символьного дисплея):


<PRE>
mysql&#62; SHOW VARIABLES;
mysql&#62; SHOW COLUMNS FROM ...\G
       &#60;вывод SHOW COLUMNS&#62;
mysql&#62; EXPLAIN SELECT ...\G
       &#60;вывод EXPLAIN&#62;
mysql&#62; FLUSH STATUS;
mysql&#62; SELECT ...;
       &#60;Корокая версия вывода SELECT, включая время,
        затраченное на обработку запроса&#62;
mysql&#62; SHOW STATUS;
       &#60;вывод SHOW STATUS&#62;
</PRE>

<LI>

Если ошибка или проблема возникли во время работы <code>mysqld</code>, постарайтесь
предоставить сценарий, который воспроизведет аномальное поведение
программы. Сценарий должен включать все необходимые файлы данных. Чем
точнее сценарий может воспроизвести сложившуюся ситуацию, тем лучше.

Если вы можете создать воспроизводимый контрольный пример, его
необходимо отправить на <a HREF="mailto:bugs@lists.mysql.com">bugs@lists.mysql.com</a> для немедленного
рассмотрения! Если сценарий обеспечить нельзя, необходимо, по крайней
мере, включить в свое сообщение выходную информацию команды <code>mysqladmin
variables extended-status processlist</code>, чтобы предоставить данные о
работе системы!

<LI>

Если не удается создать контрольный пример в несколько строк, или если
таблица тестирования слишком велика для отправления в список рассылки
(более 10 строк), необходимо вывести содержимое таблиц при помощи
команды <code>mysqldump</code> и создать файл <tt>`README'</tt> с описанием вашей проблемы.

Запакуйте файлы при помощи <code>tar</code> и <code>gzip</code> или <code>zip</code>, и по <code>ftp</code> загрузите
архив на <a HREF="ftp://support.mysql.com/pub/mysql/secret/">ftp://support.mysql.com/pub/mysql/secret/</a>. Затем отправьте
краткое описание проблемы на <a HREF="mailto:bugs@lists.mysql.com">bugs@lists.mysql.com</a>.

<LI>

Если MySQL на ваш запрос выдает странный, на ваш взгляд,
результат, приведите в отчете не только сам результат, но также и ваше
мнение о том, каким должен быть результат, и расчеты, подтверждающие
это мнение.

<LI>

Когда вы приводите пример ситуации, при которой возникает проблема,
лучше сохранить действительные имена переменных, таблиц и т.п., вместо
того, чтобы давать им новые имена. Иногда проблема может быть вызвана
именем переменной или таблицы! Это довольно редкие случаи, но лучше,
чтобы не терять времени, такую информацию отправить нам сразу. В конце
концов, вам будет даже легче использовать данные, соответствующие
реальной ситуации, и это во всех отношениях лучше для нас. Те же, кто
не хотел бы показывать свои данные другим пользователям, могут
загрузить файл по <code>ftp</code> на
<a HREF="ftp://support.mysql.com/pub/mysql/secret/">ftp://support.mysql.com/pub/mysql/secret/</a>. Если данные действительно
представляют собой секретную информацию, которую нельзя показывать
даже нам, тогда можно привести пример, используя другие имена, но этот
вариант следует оставить на крайний случай.

<LI>

Включите в отчет все параметры, указанные для важных программ, если
это возможно. Например, приведите параметры, которые вы используете
как для запуска сервера <code>mysqld</code>, так и для запуска клиентских программ
MySQL. Параметры таких программ как <code>mysqld</code> и <code>mysql</code>, а также сценарий
<code>configure</code> часто содержат ответы на многие вопросы и очень важны!
Включить их в отчет не помешает в любом случае! Если используются
какие-либо модули, такие как Perl или PHP, также укажите их версии.

<LI>

Если ваш вопрос относится к системе привилегий, укажите выходные
данные команды <code>mysqlaccess</code>, выходные данные команды <code>mysqladmin reload</code>
и все сообщения об ошибках, которые выдаются при попытке соединения!
Во время проверки своих привилегий сначала необходимо выполнить
команду <code>mysqlaccess</code>. После этого запустите <code>mysqladmin reload version</code> и
попытайтесь соединиться с программой, которая вызывала проблемы.
Программу <code>mysqlaccess</code> можно найти в каталоге <tt>`bin'</tt> установочного
каталога MySQL.

<LI>

Если у вас есть патч, который исправляет ошибку, - это хорошо. Но не
думайте, что одного лишь патча для нас будет достаточно, или что мы
будем ее использовать, если вы не предоставите необходимую информацию,
такую как описание ошибки, которую исправляет ваш патч. Ведь мы можем
найти проблемы в самом патче или попросту в нем не разобраться, что не
даст нам возможности его применять. Если нам не удастся проверить, для
чего именно служит этот патч, мы не станем его использовать. В таких
случаях нам помогут контрольные примеры. Продемонстрируйте, что патч
исправляет все проблемы, которые могут возникнуть в связи с этой
ошибкой. Если мы найдем хотя бы один вариант, в котором патч не
работает, то он может оказаться бесполезным.

<LI>

Попытки угадать, что представляет собой ошибка, почему она возникает
или от чего зависит, обычно не дают положительного результата. Даже
члены команды MySQL не могут определить реальную причину ошибки без
программы отладки.

<LI>

Укажите в своем почтовом сообщении, что вы просмотрели справочное
руководство и почтовый архив - тогда будет видно, как вы пытались
решить эту проблему самостоятельно.

<LI>

Если возникла синтаксическая ошибка, внимательно просмотрите свою
программу! Если не удается найти никаких ошибок, может оказаться, что
ваша версия MySQL не поддерживает используемый запрос. Если
используется текущая версия в руководстве на <a HREF="http://www.mysql.com/doc/">http://www.mysql.com/doc/</a> 
не описан синтаксис, который вы используете, MySQL не
поддерживает ваш запрос. В этом случае вы можете либо самостоятельно
реализовать такой синтаксис, либо направить сообщение по адресу
<a HREF="mailto:licensing@mysql.com">licensing@mysql.com</a> и попросить либо предложить реализовать его! Если
в руководстве описан используемый синтаксис, но у вас установлена
более старая версия MySQL, необходимо проверить журнал
изменений MySQL, чтобы узнать, когда был реализован данный синтаксис.
В этом случае вы можете произвести обновление до более новой версии
MySQL. See section <A HREF="manual.ru.html#News">C  История изменений и обновлений MySQL</A>.

<LI>

Если в результате ошибки ваши данные оказываются поврежденными, или
возникают ошибки при обращении к какой-либо определенной таблице,
сначала необходимо проверить, а потом попытаться восстановить таблицы
при помощи команды <code>myisamchk</code> или <code>CHECK TABLE</code> и <code>REPAIR TABLE</code>.
See section <A HREF="manual.ru.html#MySQL_Database_Administration">4  Администрирование баз данных</A>.

<LI>

Если повреждения ваших таблиц случаются часто, необходимо выяснить,
когда и почему это происходит. В этом случае файл
<tt>`mysql-data-directory/`hostname`.err'</tt> может содержать некоторую
информацию о происходящем. See section <A HREF="manual.ru.html#Error_log">4.9.1  Журнал ошибок</A>. Включите в отчет
об ошибке всю важную информацию из этого файла. Обычно <code>mysqld</code>  никогда
не должна повреждать данные в таблицах, если не произошло никакого
сбоя во время обновления! Если вам удалось найти причину ошибки в
<code>mysqld</code>, нам будет гораздо проще оказать вам помощь в решении этой
проблемы. See section <A HREF="manual.ru.html#What_is_crashing">A.1  Как определить, чем вызваны проблемы</A>.

<LI>

Если это возможно, загрузите и установите последнюю версию MySQL
Server и проверьте, не решена ли в ней ваша проблема. Все версии
программного обеспечения MySQL проходят тщательное тестирование и
должны работать без проблем. Мы делаем все возможное, чтобы сохранить
обратную совместимость, поэтому при переходе с одной версии MySQL на
другую никаких проблем не должно возникать. See section <A HREF="manual.ru.html#Which_version">2.2.6  Какую версию MySQL использовать</A>.
</UL>

<P>
<A NAME="IDX104"></A>
<A NAME="IDX105"></A>
<A NAME="IDX106"></A>
<A NAME="IDX107"></A>

</P>
<P>
Если вы пользователь, пользующийся официальной поддержкой, направьте отчет
об ошибке на <a HREF="mailto:mysql-support@mysql.com">mysql-support@mysql.com</a>, чтобы его рассмотрели в первую
очередь, а также в соответствующий список рассылки, чтобы узнать,
сталкивался ли кто-нибудь еще с этой проблемой (и, возможно, нашел
решение).

</P>
<P>
Чтобы получить информацию по отчетам об ошибках в <code>MyODBC</code>, See section <A HREF="manual.ru.html#ODBC_Problems">8.3.4  Как сообщать о проблемах с MyODBC</A>.

</P>
<P>
Решения для наиболее часто встречающихся проблем можно найти в разделе
section <A HREF="manual.ru.html#Problems">A  Проблемы и распространенные ошибки</A>.

</P>
<P>
Если ответы направляются к вам индивидуально, не попадая в список
рассылки, хорошим тоном считается составить отчет по полученным ответам и
отправить его в список рассылки, чтобы другие пользователи смогли получить
информацию, которая помогла решить вашу проблему!

</P>


<H4><A NAME="Answering_questions" HREF="manual.ru_toc.html#Answering_questions">1.8.1.4  Рекомендации по ответам на вопросы, направляемые в список рассылки</A></H4>

<P>
<A NAME="IDX108"></A>
<A NAME="IDX109"></A>
<A NAME="IDX110"></A>
<A NAME="IDX111"></A>

</P>
<P>
Если вы считаете, что ваш ответ представляет интерес для большинства
пользователей, то можете направить его прямо в список рассылки, вместо
того, чтобы отвечать напрямую человеку, задавшему вопрос. Постарайтесь
обобщить свой ответ таким образом, чтобы его смысл был понятен всем, а не
только человеку, задавшему вопрос. При отправке сообщения в список
рассылки убедитесь, что ваш ответ не является повторением предыдущего
ответа.

</P>
<P>
Постарайтесь оставить главную часть вопроса в своем ответе, не стесняйтесь
оставить все исходное сообщение в своем письме.

</P>
<P>
Не отправляйте сообщения из своего браузера с включенным режимом HTML!
Многие пользователи не используют браузер для чтения почты!

</P>


<H3><A NAME="IRC" HREF="manual.ru_toc.html#IRC">1.8.2  Пользователи MySQL на IRC</A></H3>

<P>
<A NAME="IDX112"></A>
<A NAME="IDX113"></A>

</P>
<P>
В дополнение к спискам рассылки MySQL, вы можете найти поддержку у
опытных пользователей MySQL в IRC. 

</P>
<P>
Вот сети/каналы, известные нам на данный момент: 

</P>

<UL>
<LI><strong>freenode</strong> (см. список серверов на <a HREF="http://www.freenode.net/">http://www.freenode.net/</a> )


<UL>
<LI><code>#mysql</code>

В основном обсуждение MySQL, но вопросы по другим СУБД приветствуются. 
<LI><code>#mysqlphp</code>

Вопросы про популярную связку MySQL+PHP
</UL>

<LI><strong>EFnet</strong> (см. список серверов на  <a HREF="http://www.efnet.org/">http://www.efnet.org/</a>)


<UL>
<LI><code>#mysql</code>

Вопросы по MySQL.
</UL>

</UL>

<P>
Мы можем рекомендовать вам X-Chat для подключения к IRC-сети. X-Chat доступен
как для Unix, так и для Windows по адресу: <a HREF="http://www.xchat.org/">http://www.xchat.org/</a>. 

</P>


<H2><A NAME="Compatibility" HREF="manual.ru_toc.html#Compatibility">1.9  Насколько MySQL соответствует стандартам?</A></H2>

<P>
<A NAME="IDX114"></A>
<A NAME="IDX115"></A>
<A NAME="IDX116"></A>
<A NAME="IDX117"></A>

</P>
<P>
В этом разделе рассматривается соотношение между MySQL и стандартами ANSI
SQL. Сервер MySQL имеет много расширений стандарта ANSI SQL; здесь вы
найдете информацию о том, что представляют собой эти расширения и как их
использовать. Помимо этого, в данном разделе содержится информация о том,
какие функциональные возможности отсутствуют в сервере MySQL, а также
дается описание способов обхода некоторых трудностей.

</P>
<P>
Мы не ставили перед собой цель ограничивать какую бы то ни было область
применения сервера MySQL, если на то нет веских причин. И несмотря на то
что у нас не хватает ресурсов выполнять разработку для каждого возможного
применения сервера, мы всегда охотно окажем помощь и предложим советы тем,
кто пытается расширять сферу использования MySQL.

</P>
<P>
Одним из главных направлений разработки данного продукта является
продолжение работы в области соответствия его стандартам ANSI 99, но не за
счет ущерба для скорости или надежности. Мы без опаски добавляем к серверу
MySQL расширения к SQL или поддержку не предусмотренных в SQL
возможностей, если это заметно увеличивает удобство его использования для
значительной части наших пользователей (одним из примеров такой стратегии
является новый интерфейс <code>HANDLER</code> в версии сервера MySQL 4.0; 
see section <A HREF="manual.ru.html#HANDLER">6.4.2  Синтаксис оператора  <code>HANDLER</code></A>).

</P>
<P>
В наших планах - продолжение поддержки баз данных с транзакциями и без
транзакций, чтобы обеспечить как интенсивное применение для
веб-регистрации, так и зависящее от целевого назначения использование в
круглосуточном режиме 24/7.

</P>
<P>
С самого начала сервер MySQL был спроектирован для работы с базами данных
среднего размера (10-100 миллионов строк или около 100 MB на таблицу) на
малых вычислительных системах. Мы будем продолжать расширять сервер MySQL
для работы с базами данных с размерами даже больше терабайта, и наряду с
этим - предоставлять возможность компиляции упрощенной версии MySQL,
которая больше подходит для портативных устройств и встраивания. Благодаря
компоновочной схеме сервера MySQL оба эти направления возможны без
каких-либо конфликтов в дереве исходных кодов.

</P>
<P>
В настоящее время мы не ставим перед собой задач поддержки работы в режиме
реального времени или кластеризованных баз данных (хотя наши сервисы
репликации уже обеспечивают многие из таких возможностей).

</P>
<P>
Мы не считаем, что для базы данных необходима поддержка чистого XML, но
при этом будем добавлять на клиентской стороне поддержку XML-запросов
наших пользователей. По нашему мнению, основной код сервера должен
оставаться настолько ``скудным и чистым'', насколько возможно, а взамен
следует разрабатывать библиотеки, которые ``взвалят на свои плечи'' все
сложности на клиентской стороне. Эта концепция полностью соответствует
упомянутой выше стратегии - не жертвовать скоростью или надежностью
сервера.

</P>



<H3><A NAME="Standards" HREF="manual.ru_toc.html#Standards">1.9.1  Каким стандартам соответствует MySQL ?</A></H3>

<P>
Начальный уровень SQL92. Для ODBC уровни 0-3.51.

</P>
<P>
Мы стремимся к полной поддержке стандарта ANSI SQL99, но без ущерба для
скорости и качества кода.

</P>


<H3><A NAME="ANSI_mode" HREF="manual.ru_toc.html#ANSI_mode">1.9.2  Запуск MySQL в режиме ANSI</A></H3>

<P>
<A NAME="IDX118"></A>

</P>
<P>
При запуске <code>mysqld</code> с опцией <code>--ansi</code> поведение сервера MySQL изменяется
следующим образом:

</P>

<UL>
<LI>

<code>||</code> представляет собой конкатенацию строк вместо ИЛИ (OR).

<LI>

Допускается любое количество пробелов между именем функции и скобкой
<samp>`('</samp>. Это заставляет MySQL интерпретировать все имена функций как
зарезервированные слова.

<LI>

<samp>`"'</samp> будет интерпретироваться как символ кавычки идентификатора (как
символ кавычки <samp>``'</samp> сервера MySQL), а не как символ кавычки строки.

<LI>

<code>REAL</code> будет синонимом для <code>FLOAT</code>, а не для <code>DOUBLE</code>.

<LI>

Уровнем изоляции транзакций по умолчанию является <code>SERIALIZABLE</code> (see section <A HREF="manual.ru.html#SET_TRANSACTION">6.7.3  Синтаксис команды <code>SET TRANSACTION</code></A>).

<LI>

Вы можете использовать столбец/выражение в <code>GROUP BY</code>, которое не перечислено в списке столбцов.
</UL>

<P>
Использование данной опции равносильно применению 
<code>--sql-mode=REAL_AS_FLOAT,PIPES_AS_CONCAT,ANSI_QUOTES,
IGNORE_SPACE,SERIALIZE,ONLY_FULL_GROUP_BY</code>.

</P>


<H3><A NAME="Extensions_to_ANSI" HREF="manual.ru_toc.html#Extensions_to_ANSI">1.9.3  Расширения MySQL к ANSI SQL92</A></H3>

<P>
<A NAME="IDX119"></A>

</P>
<P>
Сервер MySQL включает в себя ряд расширений, которые могут отсутствовать в
других базах данных SQL. Если вы их используете, то следует иметь в виду,
что такой код не будет переносимым на другие SQL-серверы. В некоторых
случаях можно написать код, включающий расширения MySQL, но, тем не менее,
являющийся переносимым, воспользовавшись комментариями вида <code>/*! ... */</code>. В
этом случае сервер MySQL будет анализировать и выполнять данный код внутри
этого комментария как обычную команду MySQL, в то время как другие
SQL-серверы будут игнорировать данное расширение. Например:

</P>

<PRE>
SELECT /*! STRAIGHT_JOIN */ col_name FROM table1,table2 WHERE ...
</PRE>

<P>
При добавлении номера версии после <code>'!'</code> это выражение будет исполняться
только в случае, если номер данной версии MySQL равен указанному номеру
или больше:

</P>

<PRE>
CREATE /*!32302 TEMPORARY */ TABLE t (a int);
</PRE>

<P>
Это означает, что при наличии версии 3.23.02 или выше сервер MySQL будет
использовать ключевое слово <code>TEMPORARY</code>.

</P>
<P>
Ниже приводится перечень расширений MySQL:

</P>

<UL>
<LI>

Типы полей <code>MEDIUMINT</code>, <code>SET</code>, <code>ENUM</code> и различные типы <code>BLOB</code> и <code>TEXT</code>.

<LI>

Атрибуты полей <code>AUTO_INCREMENT</code>, <code>BINARY</code>, <code>NULL</code>, <code>UNSIGNED</code> и <code>ZEROFILL</code>.

<LI>

Все сравнения строк по умолчанию являются независимыми от регистра
символов с порядком сортировки, заданным текущей кодировкой
(ISO-8859-1 Latin1 по умолчанию). Если вас это не устраивает, то можно
объявить столбцы с атрибутом <code>BINARY</code> или использовать явное приведение
типов <code>BINARY</code>, в результате чего сравнение будет выполняться в
соответствии с порядком ASCII, используемом на хосте сервера MySQL.

<LI>

Сервер MySQL сопоставляет каждую базу данных с подкаталогом в каталоге
данных MySQL, а таблицы внутри базы данных - с именами файлов в этом
подкаталоге базы данных. 

Это правило имеет несколько следствий:

<A NAME="IDX120"></A>
<A NAME="IDX121"></A>
<A NAME="IDX122"></A>
<A NAME="IDX123"></A>


<UL>
<LI>

В сервере MySQL, работающем под операционными системами с
зависимыми от регистра символов именами файлов (таковыми являются
большинство Unix-систем), имена баз данных и имена таблиц
являются зависимыми от регистра символов (see section <A HREF="manual.ru.html#Name_case_sensitivity">6.1.3  Чувствительность имен к регистру</A>).

<LI>

Имена базы данных, таблицы, индекса, столбца или псевдонимы могут
начинаться с цифры (но не должны содержать только цифры).

<LI>

Можно использовать стандартную систему команд выполнения
резервного копирования, переименования, перемещения, удаления и
копирования таблиц. Например, для переименования таблицы
необходимо переименовать соответствующие этой таблице файлы <tt>`.MYD'</tt>,
<tt>`.MYI'</tt> и <tt>`.frm'</tt>.
</UL>

<LI>

В командах SQL можно обращаться к таблицам из разных баз данных с
помощью выражения <code>db_name.tbl_name</code>. В некоторых SQL-серверах
обеспечивается точно такая же функциональная возможность, но она
называется <code>User space</code>. Сервер MySQL не поддерживает табличные
пространства (как в выражении: <code>CREATE TABLE ralph.my_table...IN
my_tablespace</code>).

<LI>

<code>LIKE</code> разрешается на числовых столбцах.

<LI>

Использование <code>INTO OUTFILE</code> и <code>STRAIGHT_JOIN</code> в команде <code>SELECT</code> (see section <A HREF="manual.ru.html#SELECT">6.4.1  Синтаксис оператора <code>SELECT</code></A>).

<LI>

Опция <code>SQL_SMALL_RESULT</code> в команде <code>SELECT</code>.

<LI>

Использование <code>EXPLAIN SELECT</code> для получения описаний объединения
таблиц.

<LI>

Использование индексных имен, индексов на префиксах полей, а также
<code>INDEX</code> или <code>KEY</code> в команде <code>CREATE</code> TABLE (see section <A HREF="manual.ru.html#CREATE_TABLE">6.5.3  Синтаксис оператора <code>CREATE TABLE</code></A>).

<LI>

Использование <code>TEMPORARY</code> или <code>IF NOT EXISTS</code> с <code>CREATE TABLE</code>.

<LI>

Использование <code>COUNT(DISTINCT list)</code>, где <code>list</code> представляет собой более
чем один элемент.

<LI>

Использование <code>CHANGE col_name</code>, <code>DROP col_name</code> или <code>DROP INDEX,</code> <code>IGNORE</code>
или <code>RENAME</code> в команде <code>ALTER TABLE</code> (see section <A HREF="manual.ru.html#ALTER_TABLE">6.5.4  Синтаксис оператора <code>ALTER TABLE</code></A>).

<LI>

Использование <code>RENAME TABLE</code>. See section <A HREF="manual.ru.html#RENAME_TABLE">6.5.5  Синтаксис оператора  <code>RENAME TABLE</code></A>.

<LI>

Использование нескольких выражений <code>ADD</code>, <code>ALTER</code>, <code>DROP</code> или <code>CHANGE</code> в
команде <code>ALTER TABLE</code>.

<LI>

Использование <code>DROP TABLE</code> с ключевыми словами <code>IF EXISTS</code>.

<LI>

Возможность удаления нескольких таблиц одной командой <code>DROP TABLE</code>.

<LI>

Условие <code>LIMIT</code> в команде <code>DELETE</code>.

<LI>

Условие <code>DELAYED</code> в командах <code>INSERT</code> и <code>REPLACE</code>.

<LI>

Условие <code>LOW_PRIORITY</code> в командах <code>INSERT</code>, <code>REPLACE</code>, <code>DELETE</code> и <code>UPDATE</code>.

<A NAME="IDX124"></A>

<LI>

Использование <code>LOAD DATA INFILE</code>. Во многих случаях этот синтаксис
совместим с применяющимся в Oracle <code>LOAD DATA INFILE</code> (see section <A HREF="manual.ru.html#LOAD_DATA">6.4.9  Синтаксис оператора  <code>LOAD DATA INFILE</code></A>).

<LI>

Команды <code>ANALYZE TABLE</code>, <code>CHECK TABLE</code>, <code>OPTIMIZE TABLE</code> и <code>REPAIR TABLE</code>.

<LI>

Команда <code>SHOW</code> (see section <A HREF="manual.ru.html#SHOW">4.5.6  Синтаксис команды <code>SHOW</code></A>).

<LI>

Строки могут быть заключены в кавычки с помощью или <samp>`"'</samp>, или <samp>`''</samp>, но
не просто <samp>`''</samp>.

<LI>

Использование символа экранирования <samp>`\'</samp>.

<LI>

Команда <code>SET</code> (see section <A HREF="manual.ru.html#SET_OPTION">5.5.6  Синтаксис команды <code>SET</code></A>).

<LI>

Нет необходимости называть имена всех выбранных столбцов в части <code>GROUP
BY</code>. Это дает лучшую производительность для некоторых очень
специфических, но вполне нормальных запросов (see section <A HREF="manual.ru.html#Group_by_functions">6.3.7  Функции, используемые в операторах <code>GROUP BY</code></A>).

<LI>

Можно указывать <code>ASC</code> и <code>DESC</code> с <code>GROUP BY</code>.

<LI>

Чтобы упростить работу для пользователей, привыкших к иным условиям
среды SQL, в сервере MySQL поддерживаются псевдонимы для многих
функций. Например, для всех строковых функций поддерживается синтаксис
как ANSI SQL, так и ODBC.

<LI>

Сервер MySQL понимает операторы <code>||</code> и <code>&#38;&#38;</code> для обозначения логических ИЛИ
(<code>OR</code>) и И (<code>AND</code>), как это принято в языке программирования C. В сервере
MySQL <code>||</code> и ИЛИ (<code>OR</code>) являются синонимами, так же, как <code>&#38;&#38;</code> и И (<code>AND</code>).
Благодаря этому удобному синтаксису, в сервере MySQL не поддерживается
оператор ANSI SQL <code>||</code> для конкатенации строк: вместо него используется
функция <code>CONCAT()</code>. Поскольку функция <code>CONCAT()</code> принимает любое
количество аргументов, то в сервере MySQL можно легко модифицировать
использование оператора <code>||</code>.

<LI>

<code>CREATE DATABASE</code> или <code>DROP DATABASE</code> (see section <A HREF="manual.ru.html#CREATE_DATABASE">6.5.1  Синтаксис оператора <code>CREATE DATABASE</code></A>).

<A NAME="IDX125"></A>
<LI>

Оператор <code>%</code> является синонимом для <code>MOD()</code>. Т.е. <code>N % M</code> эквивалентно
<code>MOD(N,M)</code>. Оператор <code>%</code> поддерживается для программистов на C и для
совместимости с PostgreSQL.

<LI>

Операторы <code>=</code>, <code>&#60;&#62;</code>, <code>&#60;=</code>,<code>&#60;</code>, <code>&#62;=</code>,<code>&#62;</code>, <code>&#60;&#60;</code>, <code>&#62;&#62;</code>, <code>&#60;=&#62;</code>, <code>AND</code>, <code>OR</code> или <code>LIKE</code> могут
использоваться при сравнении столбцов слева от <code>FROM</code> в командах <code>SELECT</code>.
Например:


<PRE>
mysql&#62; SELECT col1=1 AND col2=2 FROM tbl_name;
</PRE>

<LI>

Функция <code>LAST_INSERT_ID()</code> (see section <A HREF="manual.ru.html#mysql_insert_id">8.4.3.31  <code>mysql_insert_id()</code></A>).

<LI>

Операторы <code>REGEXP</code> и <code>NOT REGEXP</code> расширенных регулярных выражений.

<LI>

<code>CONCAT()</code> или <code>CHAR()</code> с одним аргументом или более чем с двумя
аргументами (в сервере MySQL эти функции могут принимать любое
количество аргументов).

<LI>

Функции <code>BIT_COUNT()</code>, <code>CASE</code>, <code>ELT()</code>, <code>FROM_DAYS()</code>, <code>FORMAT()</code>, <code>IF()</code>,
<code>PASSWORD()</code>, <code>ENCRYPT()</code>, <code>MD5()</code>, <code>ENCODE()</code>, <code>DECODE()</code>, <code>PERIOD_ADD()</code>,
<code>PERIOD_DIFF()</code>, <code>TO_DAYS()</code> или <code>WEEKDAY()</code>.

<LI>

Использование функции <code>TRIM()</code> для усечения подстрок. В ANSI SQL
поддерживается только удаление единичных символов.

<LI>

Операция <code>GROUP BY</code> для функций <code>STD()</code>, <code>BIT_OR()</code> и <code>BIT_AND()</code>.

<LI>

Использование <code>REPLACE</code> вместо <code>DELETE</code> + <code>INSERT</code> (see section <A HREF="manual.ru.html#REPLACE">6.4.8  Синтаксис оператора <code>REPLACE</code></A>).

<LI>

Команды <code>FLUSH</code>, <code>RESET</code> и <code>DO</code>.

<LI>

Возможность устанавливать переменные в команде с помощью <code>:=</code>:


<PRE>
SELECT @a:=SUM(total),@b=COUNT(*),@a/@b AS avg FROM test_table;
SELECT @t1:=(@t2:=1)+@t3:=4,@t1,@t2,@t3;
</PRE>

</UL>



<H3><A NAME="Differences_from_ANSI" HREF="manual.ru_toc.html#Differences_from_ANSI">1.9.4  Отличия MySQL от ANSI SQL92</A></H3>

<P>
Наши усилия направлены на то, чтобы сервер MySQL соответствовал стандартам
ANSI SQL и ODBC SQL, но в некоторых случаях сервер MySQL функционирует
по-другому. Ниже приведен перечень таких отличий:

</P>

<UL>
<LI>

Для столбцов <code>VARCHAR</code> при хранении величины концевые пробелы удаляются
(see section <A HREF="manual.ru.html#Bugs">1.9.5  Известные ошибки и недостатки проектирования в MySQL</A>).

<LI>

В некоторых случаях столбцы <code>CHAR</code> без уведомления изменяются на столбцы
<code>VARCHAR</code> (see section <A HREF="manual.ru.html#Silent_column_changes">6.5.3.1  Молчаливые изменения определений столбцов</A>).

<LI>

Привилегии для таблицы не аннулируются автоматически при удалении
таблицы; чтобы удалить привилегии для таблицы, необходимо явно вызвать
<code>REVOKE</code> (see section <A HREF="manual.ru.html#GRANT">4.3.1  Синтаксис команд <code>GRANT</code> и <code>REVOKE</code></A>).

<LI>

<code>NULL AND FALSE</code> будет трактоваться как <code>NULL</code>, а не как <code>FALSE</code>. Причина
здесь в том, что мы не считаем необходимым оценивать множество
дополнительных условий для этого случая.
</UL>

<P>
Если вас интересует, когда к серверу MySQL будут добавляться новые
расширения, необходимо обратиться к онлайновому списку перспективных задач
к выполнению, в котором дан их перечень в порядке приоритетности. Он
находится по адресу
<a HREF="http://www.mysql.com/doc/en/TODO.html">http://www.mysql.com/doc/en/TODO.html</a>. Это самая
последняя версия списка задач к выполнению (TODO list) в  данном 
руководстве (see section <A HREF="manual.ru.html#TODO">1.10  MySQL и будущее (что предстоит сделать)</A>).

</P>


<H4><A NAME="ANSI_diff_Sub-selects" HREF="manual.ru_toc.html#ANSI_diff_Sub-selects">1.9.4.1  Вложенные <code>SELECT</code>ы</A></H4>

<P>
<A NAME="IDX126"></A>
<A NAME="IDX127"></A>
<A NAME="IDX128"></A>

</P>
<P>
В сервер MySQL поддерживает вложенные запросы вида <code>INSERT ... SELECT ...</code>
и  <code>REPLACE ... SELECT ...</code>. В других контекстах можно использовать
и функцию <code>IN()</code>. 

</P>
<P>
Вложенные операции выборки реализованы в версии 4.1.

</P>
<P>
Между тем, во многих случаях можно переписать запрос, чтобы не
использовать вложенную выборку. Например, запрос:

</P>

<PRE>
SELECT * FROM table1 WHERE id IN (SELECT id FROM table2);
</PRE>

<P>
можно переписать следующим образом:

</P>

<PRE>
SELECT table1.* FROM table1,table2 WHERE table1.id=table2.id;
</PRE>

<P>
Запросы:

</P>

<PRE>
SELECT * FROM table1 WHERE id NOT IN (SELECT id FROM table2);
SELECT * FROM table1 WHERE NOT EXISTS (SELECT id FROM table2
         WHERE table1.id=table2.id);
</PRE>

<P>
эквивалентны следующему:

</P>

<PRE>
SELECT table1.* FROM table1 LEFT JOIN table2 ON table1.id=table2.id
                WHERE table2.id IS NULL;
</PRE>

<P>
Для более сложных подзапросов часто можно создать временные таблицы,
содержащие данный подзапрос. Иногда, однако, этот способ не годится, чаще
всего для команд <code>DELETE</code>, для которых в стандарте SQL не поддерживаются
объединения (за исключением вложенных выборок). В этой ситуации возможны
два временных (пока вложенные запросы не поддерживаются сервером MySQL)
варианта решения проблемы.

</P>
<P>
Первый вариант следующий: при помощи какого-либо
процедурно-ориентированного языка программирования (такого как Perl или
PHP) делается запрос <code>SELECT</code> для получения первичных ключей тех записей,
которые должны быть удалены, а затем полученные величины используются для
составления команды <code>DELETE (DELETE FROM ... WHERE ... IN (key1, key2,
...))</code>.

</P>
<P>
Второй вариант предполагает применение диалогового SQL для автоматического
создания набора команд <code>DELETE</code> с использованием расширения MySQL <code>CONCAT()</code>
(вместо стандартного оператора <code>||</code>). Например:

</P>

<PRE>
SELECT CONCAT('DELETE FROM tab1 WHERE pkid = ', "'", tab1.pkid, "'", ';')
       FROM tab1, tab2
       WHERE tab1.col1 = tab2.col2;
</PRE>

<P>
Можно поместить этот запрос в файл скрипта, перенаправить  стандартный 
вход клиента  командной  строки  с  этого  файла, а стандартный  выход - на 
еще  один  экземпляр  клиента  командной  строки:

</P>

<PRE>
shell&#62; mysql --skip-column-names mydb &#60; myscript.sql | mysql mydb
</PRE>

<P>
Сервер версии MySQL 4.0 поддерживает многотабличные удаления - эту функцию
можно использовать для эффективного удаления строк как из одной таблицы,
так и из нескольких одновременно

</P>


<H4><A NAME="ANSI_diff_SELECT_INTO_TABLE" HREF="manual.ru_toc.html#ANSI_diff_SELECT_INTO_TABLE">1.9.4.2  Оператор  <code>SELECT INTO TABLE</code></A></H4>

<P>
<A NAME="IDX129"></A>

</P>
<P>
Для сервера MySQL пока не реализована поддержка расширения Oracle SQL:
<code>SELECT ... INTO TABLE ...</code>. Вместо этого сервер MySQL поддерживает
синтаксис ANSI SQL <code>INSERT INTO ... SELECT ...</code>, который, по существу,
представляет собой то же самое (see section <A HREF="manual.ru.html#INSERT_SELECT">6.4.3.1  Синтаксис оператора <code>INSERT ... SELECT</code></A>).

</P>

<PRE>
INSERT INTO tblTemp2 (fldID) SELECT tblTemp1.fldOrder_ID
       FROM tblTemp1 WHERE tblTemp1.fldOrder_ID &#62; 100;
</PRE>

<P>
Можно также использовать выражения  <code>SELECT INTO OUTFILE...</code> или <code>CREATE
TABLE ... SELECT</code>.

</P>


<H4><A NAME="ANSI_diff_Transactions" HREF="manual.ru_toc.html#ANSI_diff_Transactions">1.9.4.3  Транзакции и атомарные операции</A></H4>

<P>
<A NAME="IDX130"></A>
<A NAME="IDX131"></A>
<A NAME="IDX132"></A>
<A NAME="IDX133"></A>
<A NAME="IDX134"></A>
<A NAME="IDX135"></A>
<A NAME="IDX136"></A>
<A NAME="IDX137"></A>
<A NAME="IDX138"></A>

</P>

<P>
Поддержка транзакций в сервере MySQL реализуется при помощи обработчиков
транзакционных таблиц типов <code>InnoDB</code> и <code>BDB</code> (see section <A HREF="manual.ru.html#Table_types">7  Типы  таблиц MySQL</A>).
Таблицы <code>InnoDB</code> обеспечивают соответствие требованиям <code>ACID</code>.

</P>
<P>
Однако для таблиц нетранзакционных типов, таких как <code>MyISAM</code>, в MySQL
используется иная парадигма обеспечения целостности данных, получившая
название ``<code>атомарные операции</code>''. Атомарные операции в сравнении с
транзакциями часто обеспечивают такую же или даже лучшую целостность при
более высокой производительности. Поскольку сервер MySQL поддерживает обе
парадигмы, пользователь может выбирать между скоростью, которую
обеспечивают атомарные операции, и транзакционными возможностями для своих
приложений. Такой выбор может быть сделан для каждой таблицы отдельно.

</P>
<P>
Рассмотрим, как используются возможности сервера MySQL для обеспечения
строгой целостности и каковы эти возможности в сравнении с транзакционной
парадигмой.

</P>

<OL>
<LI>

Транзакционная парадигма обеспечивает следующие возможности: если
приложения написаны таким образом, что в критических ситуациях зависят
от вызова <code>ROLLBACK</code> вместо <code>COMMIT</code>, то транзакции предпочтительней
атомарных операций. Транзакции также обеспечивают гарантию того, что
незаконченные обновления или искаженные действия не будут
фиксироваться в базе данных; серверу предоставляется возможность
выполнить автоматический откат, и база данных будет сохранена. Почти
во всех случаях при работе с сервером MySQL решить возможные проблемы
можно путем включения простых проверок перед обновлениями и запуска
простых скриптов, которые выполняют проверку баз данных на нарушение
целостности с автоматическим исправлением повреждений или выдачей
предупреждения, если такое нарушение возникает. Отметим, что
полноценное выявление и устранение ошибок в таблицах без потери
целостности данных можно обеспечить, просто используя системный журнал
MySQL или добавив еще один дополнительный журнал.

<LI>

Во многих случаях транзакционные обновления можно переписать как
атомарные. В общем случае все проблемы, которые решаются с помощью
транзакций, можно решить с помощью <code>LOCK TABLES</code> или атомарных <code>UPDATE</code>,
при гарантии того, что в базе данных никогда не произойдет
автоматического прерывания (что является часто встречающейся проблемой
для транзакционных баз данных).

<LI>

Даже в транзакционной системе возможна потеря данных в случае
внезапной остановки сервера (если сервер ``упадет''). Разница между
различными системами состоит только в том, насколько мал промежуток
времени, в течение которого данные могут быть потеряны. Ни одна
система не является надежной на 100%, только ``достаточно надежной''.
Даже для сервера Oracle (эта база данных считается наиболее надежной
транзакционной базой данных), по сообщениям, в подобных ситуациях
иногда возможна потеря данных. Что же касается использования сервера
MySQL, то в любом случае, независимо от того, применяются или нет
транзакционные таблицы, для обеспечения безопасности необходимо только
иметь резервные копии и включенную регистрацию обновлений. Благодаря
этим мерам в MySQL, так же как и в  других транзакционных базах
данных, можно восстановить информацию в любой ситуации. Резервные
копии вообще хорошо иметь всегда, независимо от того, какая база
данных используется.
</OL>

<P>
Транзакционная парадигма имеет свои достоинства и свои недостатки. Для
многих пользователей и разработчиков приложений решающее значение имеет
простота кодирования в проблемных ситуациях, в которых может произойти или
неизбежно аварийное прерывание. Однако даже если парадигма атомарных
операций для вас нова или вы привыкли к транзакциям, все же следует
принимать во внимание выигрыш в скорости, который могут обеспечить
нетранзакционные таблицы (порядка от трех до пяти раз по сравнению со
скоростью наиболее быстрых и оптимально настроенных транзакционных
таблиц).

</P>
<P>
В ситуациях, где целостность данных чрезвычайно важна, сервер MySQL
обеспечивает даже для нетранзакционных таблиц надежность и целостность
данных уровня транзакций или лучше. При блокировании таблиц с помощью <code>LOCK
TABLES</code> все обновления останавливаются до тех пор, пока не будут выполнены
все проверки на целостность. При наличии только блокировки чтения (в
противоположность блокировке записи) операции чтения и вставки, тем не
менее, производятся. Новые внесенные записи не будут видны никому из
имеющих блокировку чтения клиентов до освобождения этих блокировок. С
iомощью <code>INSERT DELAYED</code> вставки становятся в очередь и находятся там до тех
пор, пока не будут сняты все блокировки. При этом клиент не вынужден
ждать, пока отработает <code>INSERT</code> (see section <A HREF="manual.ru.html#INSERT_DELAYED">6.4.4  Синтаксис оператора <code>INSERT DELAYED</code></A>).

</P>
<P>
То, что мы подразумеваем под термином ``атомарные'', не означает ничего
сверхъестественного. Имеется в виду лишь следующее: гарантируется, что при
выполнении каждого конкретного обновления никакой другой пользователь не
может повлиять на него и никогда не произойдет автоматического отката
(который возможен на транзакционных таблицах, если не приняты должные меры
предосторожности). Сервер MySQL также гарантирует, что не случится
грязного чтения (dirty read)".

</P>
<P>
Ниже описаны некоторые технические приемы работы с нетранзакционными
таблицами:

</P>

<UL>
<LI>

Циклы, для которых требуются транзакции, обычно могут кодироваться с
помощью <code>LOCK TABLES</code>, причем нет необходимости в указателях при
динамическом обновлении записей.

<LI>

Чтобы избежать применения <code>ROLLBACK</code>, можно использовать следующую
стратегию:


<UL>
<LI>

Применить <code>LOCK TABLES ...</code> для блокирования всех таблиц, к которым
необходим доступ.

<LI>

Проверить условия.

<LI>

Обновить, если все в порядке.

<LI>

Использовать <code>UNLOCK TABLES</code> для освобождения произведенных
блокировок.
</UL>

Обычно этот метод обеспечивает намного более высокую скорость, чем
использование транзакций с возможными откатами, хотя и не всегда. Это
решение не годится только для одной ситуации - когда кто-либо уничтожает
потоки посреди обновления. В этом случае все блокировки будут сняты, но
некоторые обновления могут не выполниться.

<LI>

Для обновления записей в рамках одиночной операции можно также
использовать функции. Применяя приведенные ниже технические приемы, вы
получите очень эффективное приложение:


<UL>
<LI>Поля модифицируются относительно их текущей величины.

<LI>Обновляются только те поля, которые действительно изменились.

</UL>

Например, при выполнении обновлений информации некоторого заказчика мы
обновляем только те данные этого заказчика, которые изменялись, и делаем
проверку только на предмет того, модифицировались ли изменяемые данные или
зависящие от них по сравнению с исходной строкой. Проверка на то,
изменялись или нет данные, выполняется с помощью выражения <code>WHERE</code> в команде
<code>UPDATE</code>. Если данную запись обновить не удалось, то клиент получает
сообщение: "Некоторые данные, которые вы изменяли, были модифицированы
другим пользователем". После этого в окне выводится старая версия, чтобы
пользователь мог решить, какую версию записи заказчика он должен
использовать. Такой алгоритм обеспечивает нечто похожее на блокирование
столбцов, но реально он даже лучше, поскольку мы обновляем только часть
столбцов, используя величины, соответствующие их текущим значениям. Это
означает, что типичные команды <code>UPDATE</code> выглядят примерно как приведенные
ниже:


<PRE>
UPDATE tablename SET pay_back=pay_back+'relative change';
UPDATE customer
  SET
    customer_date='current_date',
    address='new address',
    phone='new phone',
    money_he_owes_us=money_he_owes_us+'new_money'
  WHERE
    customer_id=id AND address='old address' AND phone='old phone';
</PRE>

Как можно видеть, этот способ очень эффективно и работает, даже если
другой клиент изменит величины в столбцах <code>pay_back</code> или <code>money_he_owes_us</code>.

<LI>

<A NAME="IDX139"></A>
<A NAME="IDX140"></A>
Во многих случаях пользователи хотят применять <code>ROLLBACK</code> и/или <code>LOCK
TABLES</code> для управления уникальными идентификаторами для разных таблиц.
Того же результата можно добиться намного более эффективно, используя
столбец <code>AUTO_INCREMENT</code> и либо SQL-функцию <code>LAST_INSERT_ID()</code>, либо
функцию C API <code>mysql_insert_id()</code> (see section <A HREF="manual.ru.html#mysql_insert_id">8.4.3.31  <code>mysql_insert_id()</code></A>). 

<A NAME="IDX141"></A>
<A NAME="IDX142"></A>
<A NAME="IDX143"></A>

В общем случае можно написать код и для блокирования на уровне строк.  Для
некоторых ситуаций это действительно необходимо, но таких случаев очень мало.
Блокировка на уровне строк поддерживается в таблицах <code>InnoDB</code>. Для типа
<code>MyISAM</code> можно использовать флаговые столбцы в таблице и выполнять
запросы, подобные следующему:


<PRE>
UPDATE tbl_name SET row_flag=1 WHERE id=ID;
</PRE>

MySQL возвращает 1 в качестве количества подвергнутых воздействию строк,
если данная строка была найдена, а <code>row_flag</code> в исходной строке не был уже
равен 1. Это можно себе представить так, как будто сервер MySQL изменяет
предшествующий запрос на:


<PRE>
UPDATE tbl_name SET row_flag=1 WHERE id=ID AND row_flag &#60;&#62; 1;
</PRE>

</UL>



<H4><A NAME="ANSI_diff_Triggers" HREF="manual.ru_toc.html#ANSI_diff_Triggers">1.9.4.4  Хранимые процедуры и триггеры</A></H4>

<P>
<A NAME="IDX144"></A>
<A NAME="IDX145"></A>
<A NAME="IDX146"></A>

</P>
<P>
Хранимые процедуры представляют собой набор команд SQL, которые могут
компилироваться и храниться на сервере. Таким образом, вместо того, чтобы
хранить часто используемый запрос, клиенты могут ссылаться на
соответствующую хранимую процедуру. Это обеспечивает лучшую
производительность, поскольку данный запрос должен анализироваться только
однажды и уменьшается трафик между сервером и клиентом. Концептуальный
уровень можно также повысить за счет создания на сервере библиотеки
функций.

</P>
<P>
Триггер представляет собой хранимую процедуру, которая активизируется при
наступлении определенного события. Например, можно задать хранимую
процедуру, которая срабатывает каждый раз при удалении записи из
транзакционной таблицы - таким образом обеспечивается автоматическое
удаление соответствующего заказчика из таблицы заказчиков, когда все его
транзакции удаляются.

</P>
<P>
Возможность  работы  с  хранимыми процедурами  будет  обеспечивать 
планируемый  язык  обновлений. Наша цель - ввести хранимые процедуры
приблизительно в версию сервера MySQL 5.0. Мы работаем также и над
триггерами.

</P>


<H4><A NAME="ANSI_diff_Foreign_Keys" HREF="manual.ru_toc.html#ANSI_diff_Foreign_Keys">1.9.4.5  Внешние ключи</A></H4>

<P>
<A NAME="IDX147"></A>
<A NAME="IDX148"></A>

</P>
<P>
Следует учитывать, что в SQL внешние ключи используются не для объединения
таблиц, а главным образом для проверки целостности ссылочных данных
(ограничения внешних ключей). Если необходимо получить результаты из
большого количества таблиц от команды <code>SELECT</code>, следует делать это через
объединение таблиц:

</P>

<PRE>
SELECT * FROM table1,table2 WHERE table1.id = table2.id;
</PRE>

<P>
См. разделы section <A HREF="manual.ru.html#JOIN">6.4.1.1  Синтаксис оператора <code>JOIN</code></A> и See section <A HREF="manual.ru.html#example-Foreign_keys">3.5.6  Использование внешних ключей</A>.

</P>
<P>
В версии сервера MySQL 3.23.44 и выше таблицы InnoDB поддерживают проверку
ограничений внешних ключей (see section <A HREF="manual.ru.html#InnoDB">7.5  Таблицы <code>InnoDB</code></A>). Для таблиц других
типов сервер MySQL производит анализ синтаксиса <code>FOREIGN KEY</code> в командах
<code>CREATE TABLE</code>, но без выполнения дальнейших действий.

</P>
<P>
Синтаксис <code>FOREIGN KEY</code> без <code>ON DELETE ...</code> главным образом применяется для
целей документирования. В некоторых ODBC-приложениях его можно
использовать для автоматического создания выражений <code>WHERE</code>, но обычно это
легко сделать вручную. <code>FOREIGN KEY</code> иногда используется в качестве
проверки ограничений, но на практике такая проверка не является
необходимой, если строки вносятся в таблицу в правильном порядке.

</P>
<P>
В сервере MySQL можно обойти проблему отсутствия реализации <code>ON DELETE ...</code> 
добавлением соответствующей команды <code>DELETE</code> в приложение, когда удаляются
записи из таблицы, имеющей внешний ключ. На практике при этом достигается
почти такая же скорость (в некоторых случаях еще быстрее), как и при
использование внешних ключей, и намного большая переносимость.

</P>
<P>
В версии сервера MySQL 4.0 можно использовать многотабличное удаление,
чтобы удалить строки из многих таблиц одной командой (see section <A HREF="manual.ru.html#DELETE">6.4.6  Синтаксис оператора <code>DELETE</code></A>).

</P>
<P>
В ближайшем будущем мы расширим реализацию <code>FOREIGN KEY</code> таким образом, что
информация будет сохраняться в специальном файле таблицы и ее можно будет
извлечь с помощью <code>mysqldump</code> и ODBC. На следующем этапе мы внедрим
ограничения внешних ключей для приложений, в которых не так просто
обойтись без них.

</P>
<P>
Следует иметь в виду, что внешние ключи часто применяются неправильно, что
может вызывать большие проблемы. Даже если они использованы
соответствующим образом, то не являются магическим решением для проблемы
целостности ссылочных данных, хотя в некоторых случаях действительно
упрощают ситуацию.

</P>
<P>
Некоторые преимущества внедрения внешних ключей:

</P>

<UL>
<LI>

При условии, что связи спроектированы правильно, ограничения внешних
ключей сделают более сложным для программиста введение
противоречивости в базу данных.

<LI>

Использование каскадных обновлений и удалений может упростить код
клиента.

<LI>

Должным образом разработанные правила внешних ключей помогают в
документировании отношений между таблицами.
</UL>

<P>
Недостатки:

</P>

<UL>
<LI>

Ошибки, которые легко сделать в проектировании отношений ключей, могут
вызывать сложные проблемы: например, зацикленные правила или ложные
комбинации каскадных удалений.

<LI>

Правильно написанное приложение будет само по себе обеспечивать
отсутствие нарушения целостности ссылочных данных перед началом работы
запроса. Таким образом, дополнительные проверки на уровне базы данных
только понизят производительность для такого приложения.

<LI>

Администраторы баз данных часто создают такую сложную топологию
связей, при которой затруднительно, а зачастую и вовсе невозможно
получить резервную копию или восстановить единичные таблицы.
</UL>



<H4><A NAME="ANSI_diff_Views" HREF="manual.ru_toc.html#ANSI_diff_Views">1.9.4.6  Представления</A></H4>

<P>
<A NAME="IDX149"></A>

</P>
<P>
Представления планируется реализовать примерно в версии сервера MySQL 5.0.

</P>
<P>
Представления полезны в основном для случая, когда требуется предоставлять
пользователям доступ к набору связей как к одной таблице (только в режиме
чтения). Во многих базах данных SQL не обеспечивается возможность
обновлять какие-либо строки в представлении - такие обновления необходимо
выполнять в отдельных таблицах.

</P>
<P>
Поскольку сервер MySQL применяется в основном в приложениях и
веб-системах, где разработчик приложения имеет полный контроль над
использованием базы данных, большинство из наших пользователей не считают
представления достаточно важной функциональной возможностью (по крайней
мере, никто не заинтересовался ими настолько, чтобы выразить готовность
финансировать реализацию представлений).

</P>
<P>
Для сервера MySQL нет необходимости в применении представлений для
ограничения доступа к столбцам, так как в нем реализована хорошо
продуманная система привилегий (see section <A HREF="manual.ru.html#Privilege_system">4.2  Общие проблемы безопасности и система привилегий доступа MySQL</A>).

</P>


<H4><A NAME="ANSI_diff_comments" HREF="manual.ru_toc.html#ANSI_diff_comments">1.9.4.7  Символы `--' как начало комментария</A></H4>

<P>
<A NAME="IDX150"></A>
<A NAME="IDX151"></A>

</P>
<P>
В некоторых отличных от MySQL базах данных SQL символы <samp>`--'</samp> используются
как начальные символы комментариев. В сервере MySQL символом начала
комментариев является <samp>`#'</samp>. Для сервера MySQL можно также использовать
стиль комментирования из C: <code>/* this is a comment */</code> (see section <A HREF="manual.ru.html#Comments">6.1.6  Синтаксис  комментариев</A>).

</P>
<P>
В версии сервера MySQL 3.23.3 и выше поддерживается комментирование с
помощью символов <samp>`--'</samp> - при условии, что за комментарием следует пробел.
Это объясняется тем, что данный стиль комментирования вызвал много проблем
при автоматической генерации SQL-запросов, в которых присутствовал код,
подобный приведенному ниже (величина платежа вставляется в выражение
<code>!payment!</code> автоматически):

</P>

<PRE>
UPDATE tbl_name SET credit=credit-!payment!
</PRE>

<P>
Давайте представим себе, что произойдет в случае, если величина <code>payment</code>
окажется отрицательной. Поскольку выражение <code>1--1</code> в SQL является
допустимым, то просто страшно себе вообразить последствия в случае, если
будут разрешены комментарии, начинающиеся с <samp>`--'</samp>,

</P>
<P>
Использование нашей реализации этого метода комментирования в версии
сервера MySQL 3.23.3 и выше - в форме <code>1-- This is a comment</code> - является
действительно безопасным.

</P>
<P>
Существует еще один безопасный способ решения этой проблемы. Он
заключается в том, что клиент командной строки <code>mysql</code> удаляет все строки,
начинающиеся с <samp>`--'</samp>.

</P>
<P>
Приведенная ниже информация относится только к работе более ранних, чем
3.23.3, версий MySQL.

</P>
<P>
Если ваша SQL-программа представлена в виде текстового файла, содержащего
комментарии <samp>`--'</samp>, необходимо использовать:

</P>

<PRE>
shell&#62; replace " --" " #" &#60; text-file-with-funny-comments.sql \
	| mysql database
</PRE>

<P>
вместо обычного:

</P>

<PRE>
shell&#62; mysql database &#60; text-file-with-funny-comments.sql
</PRE>

<P>
Можно также отредактировать сам командный файл, заменив комментарии <samp>`--'</samp>
комментариями <samp>`#'</samp>:

</P>

<PRE>
shell&#62; replace " --" " #" -- text-file-with-funny-comments.sql
</PRE>

<P>
Привести эти комментарии к первоначальному виду можно с помощью следующей
команды:

</P>

<PRE>
shell&#62; replace " #" " --" -- text-file-with-funny-comments.sql
</PRE>



<H3><A NAME="Bugs" HREF="manual.ru_toc.html#Bugs">1.9.5  Известные ошибки и недостатки проектирования в MySQL</A></H3>

<P>
<A NAME="IDX152"></A>
<A NAME="IDX153"></A>
<A NAME="IDX154"></A>
<A NAME="IDX155"></A>

</P>



<H4><A NAME="Errors_in_3.23" HREF="manual.ru_toc.html#Errors_in_3.23">1.9.5.1  Ошибки, известные в 3.23 и исправленные в более поздних версиях MySQL</A></H4>

<P>
Следующие ошибки не исправлены в MySQL 3.23, поскольку исправление их
требует слишком значительных изменений кода, которые могут повлечь 
создание еще большего количества ошибок. Эти ошибки классифицированы 
как "не фатальные" и "переносимые". 

</P>

<UL>
<LI>

Можно получить взаимоблокировку при помощи <code>LOCK TABLE</code> на множестве таблиц,
а затем выполнив в том же соединениии <code>DROP TABLE</code> одной из таблиц, пока другой поток
пытается получить блокировку на таблицу. Однако можно уничтожить (<code>KILL</code>) эти
потоки с тем, чтобы ситуация была исправлена. Исправлено в 4.0.12. 
<LI>

<code>SELECT MAX(key_column) FROM t1,t2,t3...</code>  где одна из таблиц является
пустой не вернет <code>NULL</code>, но вместо этого вернет максимальное значение для столбца. 
Исправлено в 4.0.11.
</UL>



<H4><A NAME="Open_bugs" HREF="manual.ru_toc.html#Open_bugs">1.9.5.2  Открытые ошибки / особенности строения MySQL</A></H4>

<P>
Устранение следующих из выявленных проблем относится к числу
первоочередных задач:

</P>

<UL>
<LI>

<code>ANALYZE TABLE</code> на таблицах <code>BDB</code> в некоторых случаях может сделать
таблицу недоступной для использования, пока не произойдет перезапуск
<code>mysqld</code>. При этом в файле ошибок MySQL можно будет увидеть ошибки,
подобные следующим:


<PRE>
001207 22:07:56 bdb: log_flush: LSN past current end-of-log
</PRE>

<LI>

Не следует выполнять <code>ALTER TABLE</code> на таблицах <code>BDB</code>, на которых
осуществляются многокомандные транзакции, пока все эти транзакции не
завершатся (возможно, данные транзакции будут проигнорированы).

<LI>

<code>ANALYZE TABLE</code>, <code>OPTIMIZE TABLE</code> и <code>REPAIR TABLE</code> могут вызвать проблемы на
таблицах, для которых используется <code>INSERT DELAYED</code>.

<LI>

Выполнение <code>LOCK TABLE ...</code> и <code>FLUSH TABLES ...</code> не гарантирует, что на
данной таблице нет исполняемых в текущий момент незаконченных
транзакций.

<LI>

Открытие таблиц <code>BDB</code> происходит несколько медленно. Если база данных
содержит много таблиц <code>BDB</code>, то потребуется значительное время для
использования клиента <code>mysql</code> на этой базе данных, если не применять
опцию <code>-A</code> или если использовать <code>rehash</code>. Это особенно заметно при
наличии большого табличного кэша.

</UL>

<P>
Следующие проблемы также известны и будут устранены в свое время:

</P>

<UL>

<LI>

При использовании функции <code>RPAD</code>, или любой другой строковой функции, 
добавляющией пробелы в правую часть строки, в запросе, для которого MySQL 
будет создавать временные таблицы для его выполнения, все результирующие
строки будут в результате обработаны RTRIM'ом (RTRIM'ed).  Вот пример запроса: 

<code>SELECT    RPAD(t1.field1, 50, ' ') AS f2,    RPAD(t2.field2, 50, '
') AS f1  FROM    table1 as t1     LEFT JOIN table2 AS t2 ON
t1.record=t2.joinID ORDER BY t2.record;</code> 

В результате невозможно получить пробелы в правой части результирующего столбца. 

Такое поведение присутствует во всех версиях MySQL.

Причина заключается в том, что HEAP-таблицы, которые в первую очередь используются для временных 
таблиц, неспособны работать с VARCHAR-столбцами. 

Такое поведение будет исправлено в одной из версий 4.1. 

<LI>

При использовании <code>SET CHARACTER SET</code> нельзя использовать
преобразованные символы в именах базы данных, таблицы и столбца.

<LI>

Нельзя использовать <code>_</code> или <code>%</code> с <code>ESCAPE</code> в <code>LIKE
... ESCAPE</code>.

<LI>

<LI>

Если в столбце <code>DECIMAL</code> число хранится в различных форматах (+01.00,
1.00, 01.00), то <code>GROUP BY</code> может рассматривать каждую величину как
самостоятельную.

<LI>

<code>DELETE FROM merge_table</code> при использовании без <code>WHERE</code> будет очищать
только отображение для этой таблицы, а не удалять все данные в
отображенных таблицах.

<LI>

При использовании потоков MIT-pthreads нельзя расположить сервер в
ином каталоге. Поскольку для решения данной проблемы требуются
изменения для потоков MIT-pthreads, маловероятно, что мы ее устраним
(see section <A HREF="manual.ru.html#MIT-pthreads">2.3.6  Замечания по потокам MIT-pthreads</A>).

<LI>

Не обеспечивается ``надежное'' применение величин <code>BLOB</code> в <code>GROUP BY</code> или
<code>ORDER BY</code> или <code>DISTINCT</code>. В этих случаях при сравнении величин <code>BLOB</code>
используются только первые <code>max_sort_length</code> байтов (по умолчанию 1024).
Это можно изменить с помощью опции <code>-O max_sort_length</code> для <code>mysqld</code>.
Обходной путь для большинства случаев заключается в использовании
подстроки: <code>SELECT DISTINCT LEFT(blob,2048) FROM tbl_name</code>.

<LI>

В сервере MySQL вычисления производятся в форматах типов <code>BIGINT</code> или
<code>DOUBLE</code> (оба типа обычно имеют длину 64 бита). Это зависит от того,
какую точность обеспечивает применяемая функция. Общее правило состоит
в том, что битовые функции работают с точностью <code>BIGINT</code>, функции <code>IF</code> и
<code>ELT()</code> - с точностью <code>BIGINT</code> или <code>DOUBLE</code>, а остальные - с точностью
<code>DOUBLE</code>. Следует избегать применения беззнаковых величин двойной
точности, если они могут превысить 63 бита (9223372036854775807), для
каких-либо величин, кроме битовых полей! В версии сервера MySQL 4.0
реализована лучшая обработка <code>BIGINT</code>, чем в 3.23.

<LI>

Во всех строковых столбцах, исключая <code>BLOB</code> и <code>TEXT</code>  при извлечении
данных автоматически удаляются все концевые пробелы. Для типов <code>CHAR</code>
это хорошо и может рассматриваться как свойство, соответствующее ANSI
SQL92. Ошибка заключается в том, что в сервере MySQL столбцы <code>VARCHAR</code>
трактуются тем же самым образом.

<LI>

В одной таблице может быть только до 255 столбцов типа <code>ENUM</code> и <code>SET</code>.

<LI>

В <code>MIN()</code>, <code>MAX()</code> и других групповых функциях, MySQL сейчас
сравнивает <code>ENUM</code> и <code>SET</code>-столбцы по их строковому значению, а не по
относительной позиции строки в множестве.  

<LI>

При указании параметра <code>safe_mysqld</code> все сообщения из <code>mysqld</code>
направляются в журнал данного потока <code>mysqld</code>. Одна из проблем
заключается в том, что если вы исполняете <code>mysqladmin refresh</code> для того,
чтобы закрыть и заново открыть журнал, то <code>stdout</code> и <code>stderr</code> будут все
еще по-прежнему направлены в старый журнал. При активном использовании
<code>--log</code> следует отредактировать <code>safe_mysqld</code>, чтобы записи велись в
<tt>``hostname`.err'</tt>, а не в <tt>``hostname`.log'</tt>, с тем, чтобы вы могли очищать
пространство, удаляя старые журналы и вызывая <code>mysqladmin refresh</code>.

<LI>

При выполнении команды <code>UPDATE</code> столбцы обновляются слева направо. При
ссылке на обновленный столбец вместо исходной величины будет получена
обновленная величина. Например:


<PRE>
mysql&#62; UPDATE tbl_name SET KEY=KEY+1,KEY=KEY+1;
</PRE>

Эта команда обновит <code>KEY</code> со значением 2 вместо значения 1.

<LI>

В одном и том же запросе нельзя использовать временные таблицы более
чем один раз. Например, следующая команда выполнена не будет:


<PRE>
mysql&#62; SELECT * FROM temporary_table, temporary_table AS t2;
</PRE>

<LI>

<code>RENAME</code> не работает с временными таблицами или при использовании
таблицы <code>MERGE</code>.

<LI>

Оптимизатор может обрабатывать <code>DISTINCT</code> по-разному, в зависимости от
того, используются или нет в объединении ``скрытые'' столбцы. В
объединении скрытые столбцы считаются частью результата (даже если они
не показываются), в то время как в обычных запросах скрытые столбцы не
участвуют в сравнении <code>DISTINCT</code>. Возможно, в будущем мы изменим это
правило таким образом, чтобы при выполнении <code>DISTINCT</code> скрытые столбцы
никогда не сравнивались. Например:


<PRE>
SELECT DISTINCT mp3id FROM band_downloads
       WHERE userid = 9 ORDER BY id DESC;
</PRE>

и


<PRE>
SELECT DISTINCT band_downloads.mp3id
       FROM band_downloads,band_mp3
       WHERE band_downloads.userid = 9
       AND band_mp3.id = band_downloads.mp3id
       ORDER BY band_downloads.id DESC;
</PRE>

Во втором случае в версии сервера MySQL 3.23.x можно получить две
идентичных строки в результирующем наборе данных (поскольку скрытый
столбец <code>id</code> может варьироваться). Заметьте, что это случается только с
запросами, где в результате отсутствуют столбцы <code>ORDER BY</code>, что не
разрешается делать в ANSI SQL.

<LI>

Поскольку сервер MySQL обеспечивает возможность работать с типами
таблиц, которые не поддерживают транзакции и, следовательно, не
допускают отката данных, то поведение сервера MySQL в некоторых
аспектах отличается от других серверов SQL. Это делается, чтобы
гарантировать, что сервер MySQL никогда не будет нуждаться в откате
SQL-команд. Такое поведение временами может быть несколько неудобным,
так как вследствие этого величины столбцов должны проверяться в
приложении. Однако благодаря такому решению вы получаете действительно
хорошее увеличение скорости, поскольку для сервера MySQL
обеспечивается возможность производить определенные оптимизации, что в
противном случае было бы очень трудно сделать. При попытке установить
столбец в некорректную величину сервер MySQL вместо выполнения отката
будет сохранять в данном столбце ``наиболее вероятную величину'':


<UL>
<LI>

При попытке сохранить в числовом столбце величину, выходящую за
допустимые пределы, сервер MySQL вместо нее будет сохранять в
этом столбце наименьшую или наибольшую допустимую величину.

<LI>

При попытке сохранить в числовом столбце строку, которая
начинается не с числа, сервер MySQL будет сохранять в нем 0.

<LI>

При попытке сохранить <code>NULL</code> в числовом столбце, который не
принимает значения величины <code>NULL</code>, сервер MySQL вместо <code>NULL</code> будет
сохранять 0 или <code>''</code> (пустая строка) (однако это поведение можно
изменить с помощью опции компиляции <code>-DDONT_USE_DEFAULT_FIELDS</code>).

<LI>

MySQL обеспечивает возможность сохранять некоторые ошибочные величины даты в
столбцах <code>DATE</code> и <code>DATETIME</code> (такие как 2000-02-31 или 2000-02-00).
Идея заключается в том, что задача проверки валидности даты не входит в круг
обязанностей сервера баз данных. Если MySQL может сохранить и корректно
воспроизвести какие-либо значение даты, пусть и неправильное - MySQL будет
сохранять такое значение. Если дата полностью неправильна, сервер MySQL будет
сохранять в этом столбце специальную величину даты 0000-00-00.

<LI>

Если устанавливать столбец <code>ENUM</code> в неподдерживаемую величину, то
он будет устанавливаться в значение ошибки <code>empty string</code> с
числовым значением 0.

<LI>

Если устанавливать столбец <code>SET</code> в неподдерживаемую величину, то
эта величина будет игнорироваться.

</UL>

<LI>

При выполнении <code>PROCEDURE</code> на запросе, возвращающем пустой набор, в
некоторых случаях <code>PROCEDURE</code> не будет преобразовывать столбцы.

<LI>

При создании таблицы типа <code>MERGE</code> не происходит проверки, если лежащие в
ее основе таблицы имеют совместимые типы.

<LI>

Сервер MySQL пока еще не может обрабатывать величины <code>NaN</code>, <code>-Inf</code> и <code>Inf</code> с
двойной точностью. Их использование вызовет проблемы при попытке
экспорта или импорта данных. В качестве промежуточного решения мы
должны изменить <code>NaN</code> на <code>NULL</code> (если возможно) и <code>-Inf</code> и <code>Inf</code> на
минимальную или, соответственно, максимально возможную величину
двойной точности.

<LI>

<code>LIMIT</code> на отрицательных числах трактуются как большие положительные
числа.

<LI>

Если <code>ALTER TABLE</code> используется для того, чтобы сначала добавить индекс
<code>UNIQUE</code> к таблице, которая входит в таблицу <code>MERGE</code>, а затем - чтобы
добавить обычный индекс к таблице <code>MERGE</code>, то в случае, если существовал
старый ключ, который не был уникальным в данной таблице, порядок
ключей для таблиц будет различным. Это обусловлено тем, что <code>ALTER
TABLE</code> помещает уникальные ключи перед обычными ключами, чтобы
обеспечить возможность определять дублирующиеся ключи как можно
раньше.
</UL>

<P>
В более ранних версиях MySQL известны следующие ошибки:

</P>

<UL>
<LI>

Можно получить зависший поток при выполнении <code>DROP TABLE</code> на таблице,
которая является одной из числа многих таблиц, заблокированных с
помощью <code>LOCK TABLES</code>.

<LI>

В следующем случае может произойти аварийное завершение процесса:


<UL>
<LI>

Обработчик задержанных вставок имеет незаконченные вставки в
таблицу.

<LI>

<code>LOCK table</code> с помощью <code>WRITE</code>.

<LI>

<code>FLUSH TABLES</code>.
</UL>

<LI>

В версиях сервера MySQL до 3.23.2 команда <code>UPDATE</code>, которая обновляла
ключ с помощью <code>WHERE</code> на тот же самый ключ, может оказаться неудачной,
поскольку данный ключ использовался для поиска записей и одна и та же
строка может быть найдена много раз:


<PRE>
UPDATE tbl_name SET KEY=KEY+1 WHERE KEY &#62; 100;
</PRE>

Обходным решением является использование:


<PRE>
mysql&#62; UPDATE tbl_name SET KEY=KEY+1 WHERE KEY+0 &#62; 100;
</PRE>

Эта команда будет работать, поскольку сервер MySQL не будет
использовать индекс на выражениях в утверждении <code>WHERE</code>.

<LI>

До версии сервера MySQL 3.23 все числовые типы трактовались как поля с
фиксированной точкой. Это означает, что необходимо было указывать,
сколько десятичных знаков должно содержать поле с плавающей точкой.
Все результаты возвращались с правильным количеством десятичных
знаков.
</UL>

<P>
В отношении ошибок, связанных со спецификой различных платформ, см. разделы
о компилировании и переносе.

</P>


<H2><A NAME="TODO" HREF="manual.ru_toc.html#TODO">1.10  MySQL и будущее (что предстоит сделать)</A></H2>

<P>
<A NAME="IDX156"></A>
<A NAME="IDX157"></A>

</P>

<P>
В этом разделе приведен список возможностей, которые планируется
реализовать в MySQL.

</P>
<P>
Разработка приведенных в списке пунктов будет проходить примерно в порядке
их перечисления. Если вы считаете, что это порядок следует изменить, то,
пожалуйста, зарегистрируйте лицензию или окажите поддержку MySQL АВ и
сообщите нам, что желательно было бы разработать побыстрее.
See section <A HREF="manual.ru.html#Licensing_and_Support">1.6  Лицензии и поддержка MySQL</A>.

</P>
<P>
Планируется, что в будущем стандарт ANSI SQL99 будет поддерживаться
полностью, но с большим числом полезных расширений. Проблема заключается в
том, чтобы сделать все намеченное, не жертвуя скоростью и без компромиссов
при кодировании.

</P>


<H3><A NAME="TODO_MySQL_4.0" HREF="manual.ru_toc.html#TODO_MySQL_4.0">1.10.1  Что планируется реализовать в версии в 4.0</A></H3>

<P>
Уже все сделано. Сейчас мы только исправляем обнаруженные ошибки в MySQL 4.0. See section <A HREF="manual.ru.html#News-4.0.x">C.2  Изменения в версии 4.0.x (В разработке; Альфа)</A>.
Сейчас ведется разработка версий 4.1 и 5.0. 

</P>


<H3><A NAME="TODO_MySQL_4.1" HREF="manual.ru_toc.html#TODO_MySQL_4.1">1.10.2  Что планируется реализовать в версии 4.1</A></H3>

<P>
Следующие возможности планируются для реализации в MySQL 4.1. 
Список того, что уже сделано, можно найти в See section <A HREF="manual.ru.html#News-4.1.x">C.1  Изменения в версии 4.1.x (Alpha)</A>. 

</P>

<UL>
<LI>

Стабильная поддержка OpenSSL (MySQL 4.0 поддерживает базовую, не 100%-протестированную
поддержку OpenSSL). 
<LI>

Схема перекодировки и синтаксис для поддержки множества разных кодировок. 
<LI>

Встроенная помощь для всех команд из клиента командной строки.
<LI>

Больше тестирования подготовленных выражений и множественных кодировок
для одной таблицы.
</UL>



<H3><A NAME="TODO_MySQL_5.0" HREF="manual.ru_toc.html#TODO_MySQL_5.0">1.10.3  Что планируется реализовать в версии 5.0</A></H3>

<P>
Перечисленные ниже функции планируется реализовать в MySQL 5.0. 

</P>
<P>
Отметим также, что поскольку у нас над новыми проектами работает большое
количество разработчиков, появятся и дополнительные возможности.
Существует - хотя и очень небольшая - вероятность, что эти возможности
будут введены уже в MySQL 4.1.
Список того, что уже сделано в 4.1, можно найти в See section <A HREF="manual.ru.html#News-4.1.x">C.1  Изменения в версии 4.1.x (Alpha)</A>.

</P>

<UL>
<LI>

Хранимые процедуры
<LI>

Поддержка внешних ключей для всех типов таблиц.
<LI>

Новый текстовый формат файлов определения структуры таблиц (<tt>`.frm'</tt>-файлы) и 
табличный кэш для определений таблиц. Это позволит нам быстрее получать информацию
о структуре таблиц и более качественно поддерживать внешние ключи. 
<LI>

<code>SHOW COLUMNS FROM table_name</code> (используемый клиентом <code>mysql</code> для
получения информации о столбцах) не должен открывать таблицы, а только 
файл определения структуры. Это занимает меньше памяти и будет работать быстрее. 
<LI>

Отказобезопасная репликация. 
<LI>

Резервное копирование без остановки работы системы с очень малыми
затратами на выполнение. Резервное копирование без остановки работы
системы позволит добавлять новый подчиненный сервер репликации без
демонтажа головного сервера.
<LI>

<code>ROLLUP</code> и <code>CUBE</code> OLAP (Online Analytical Processing) опции группировки для 
приложения хранения данных (Data warehousing). 
<LI>

Обеспечить возможность для <code>DELETE</code>, работающей с <code>MyISAM</code>-таблицами,
использовать кэш записей. Чтобы осуществить это, нам необходимо
обновлять кэш записей потока при обновлении <tt>`.MYD'</tt>-файла.
<LI>

При использовании <code>SET CHARACTER SET</code> мы должны преобразовать весь запрос целиком, а не
только строки. Это позволит пользователям использовать сконвертированные символы в 
именах баз данных, таблиц и столбцов. 
<LI>

Решить проблему, заключающуюся в том, что оператор <code>RENAME TABLE</code>,
использующийся для активной <code>MERGE</code>-таблицы, может повредить таблицу.
<LI>

Добавить к клиент-серверному протоколу возможность получения
информации о прогрессе выполнения для сложных и длительных запросов.
<LI>

Реализовать <code>RENAME DATABASE</code>. Чтобы сделать эту команду безопасной для
всех обработчиков таблиц, она будет работать следующим образом:

<UL>
<LI>

Создавать новую базу данных.
<LI>

Переименовывать каждую таблицу, помещаемую в новую базу данных, как
это обычно делается командой <code>RENAME</code>.
<LI>

Удалять старую базу данных.
<LI>

Добавить корректную поддержку <code>VARCHAR</code> (такая поддержка уже имеется для
<code>MyISAM</code>).
</UL>

<LI>

Оптимизировать тип <code>BIT</code>, чтобы он занимал 1 бит (сейчас 1 символ).
<LI>

Новое изменение внутреннего файлового интерфейса. Это позволит сделать
обработку всех файлов более однотипной и упростит добавление такой
функциональности, как <code>RAID</code> (текущая реализация - это просто хак).
<LI>

Улучшенные таблицы в памяти (<code>HEAP</code>):

<UL>
<LI>

Записи динамического размера
<LI>

Более быстрая обработка строк (сокращение операций копирования)
</UL>

</UL>



<H3><A NAME="TODO_future" HREF="manual.ru_toc.html#TODO_future">1.10.4  Что должно быть сделано в ближайшем будущем</A></H3>


<UL>
<LI>

Не разрешать более чем определенному количеству потоков одновременно
заниматься восстановлением <code>MyISAM</code>-таблиц.
<LI>

Изменение <code>INSERT ... SELECT</code> с целью оптимального использования
одновременных вставок.
<LI>

Возвращать истинные типы полей при выполнении <code>SELECT MIN(столбец) 
GROUP BY</code>.
<LI>

Множественные результаты.
<LI>

Сделать возможным задание <code>long_query_time</code> с градацией в микросекундах.
<LI>

Cлинковать код <code>myisampack</code> прямо в сервер.
<LI>

Перенос кода MySQL на QNX.
<LI>

Перенос кода MySQL на BeOS.
<LI>

Перенос MySQL-клиентов на LynxOS.
<LI>

Добавление временного буферного кэша ключей во время выполнения
<code>INSERT</code>/<code>DELETE</code>/<code>UPDATE</code>, чтобы обеспечить изящное восстановление в
случае, если индексный файл окажется полностью заполненным.
<LI>

Если выполняется работа <code>ALTER TABLE</code> над таблицей, которая имеет
символическую ссылку на другой диск, создавать временные таблицы на
этом диске.
<LI>

Реализация типа <code>DATE</code>/<code>DATETIME</code> с корректной обработкой информации о
временных зонах, чтобы упростить работу с форматом даты для различных
временных зон.
<LI>

FreeBSD и MIT-pthreads; отнимают ли спящие потоки время процессора?
<LI>

Проверить, занимают ли блокированные потоки время процессора.
<LI>

Исправить <code>configure</code> так, чтобы можно было компилировать все библиотеки
(подобно <code>MyISAM</code>) без потоков.
<LI>

Добавить опцию периодического сброса на диск страниц ключей для таблиц
с запрещенными, в случае, если они некоторое время не использовались.
<LI>

Возможность связывания по частям ключа (проблема оптимизации).
<LI>

<code>INSERT SQL_CONCURRENT</code> и <code>mysqld --concurrent-insert</code> для выполнения
одновременной вставки в конец файла, если файл закрыт для чтения.
<LI>

Серверные курсоры.
<LI>

Проверить, работает ли <code>lockd</code> с современными ядрами Linux; если нет, то
внести исправления в <code>lockd</code>! Чтобы это протестировать, необходимо
запустить <code>mysqld</code> с <code>--enable-locking</code> и выполнить различные наборы
тестов на <code>fork*</code>. Они не должны выявить никаких ошибок, если <code>lockd</code>
работает.
<LI>

Возможность использования SQL-переменных в <code>LIMIT</code>, как, например, в
<code>LIMIT @a,@b</code>.
<LI>

Возможность обновления переменных в операторах <code>UPDATE</code>. Например:
<code>UPDATE TABLE foo SET @a=a+b,a=@a, b=@a+c</code>.
<LI>

Изменение: если пользовательские переменные обновляются, то сделать
так, чтобы их можно было использовать с <code>GROUP BY</code>, как в следующем
примере: <code>SELECT id, @a:=COUNT(*), SUM(sum_col)/@a FROM table_name
GROUP BY id</code>.
<LI>

Запретить автоматическое внесение <code>DEFAULT</code>-значений (значений по
умолчанию) в столбцы. Выдавать ошибку в случае использования <code>INSERT</code>,
не содержащего столбца, для которого не определено значение по
умолчанию.
<LI>

Исправить <code>libmysql.c</code> так, чтобы две команды <code>mysql_query()</code>, идущие
подряд, могли работать без чтения результатов или с выдачей хорошего
сообщения об ошибке, если это все-таки происходит.
<LI>

Проверка, почему функция <code>ctime()</code> потоков MIT-pthreads не работает на
некоторых FreeBSD системах.
<LI>

Добавление опции <code>IMAGE</code> опции к <code>LOAD DATA INFILE</code>, чтобы не обновлять
поля <code>TIMESTAMP</code> и <code>AUTO_INCREMENT</code>.
<LI>

Добавляемый  синтаксис  <code>LOAD DATE INFILE ... UPDATE</code>.
<LI>

Для таблиц с первичными ключами: если данные содержат первичный ключ,
строки, соответствующие этому первичному ключу, обновляются остальными
столбцами. Столбцы, которых нет во входных данных,  остаются без
изменений.
<LI>

Для таблиц с первичными ключами, для которых отсутствует некоторая
часть ключа во входном потоке данных или которые не имеют первичного
ключа, входные данные интерпретируются сейчас как <code>LOAD DATA INFILE ...
REPLACE INTO</code>.
<LI>

Сделать понятный синтаксис <code>LOAD DATA INFILE</code>, подобно следующему:

<PRE>
LOAD DATA INFILE 'file_name.txt' INTO TABLE tbl_name
     TEXT_FIELDS (text_field1, text_field2, text_field3)
     SET table_field1=CONCAT(text_field1, text_field2),
         table_field3=23
     IGNORE text_field3
</PRE>

Такой синтаксис может быть использован для пропуска лишних столбцов в
текстовом файле или для обновления столбцов на основе выражений,
построенных по прочитанным данным.

<LI>

<code>LOAD DATA INFILE 'file_name' INTO TABLE 'table_name' ERRORS TO
err_table_name</code>. Этот оператор задает запись всех ошибок и
предупреждений в таблицу <code>err_table_name</code>, которая будет иметь
структуру, подобную следующей:

<PRE>
line_number   - номер строки в файле данных
error_message - сообщение об ошибке/предупреждение
  и, возможно
data_line     - строка из файла данных
</PRE>

<LI>

Автоматический вывод из <code>mysql</code> в Netscape.
<LI>

<code>LOCK DATABASES</code> (с различными опциями.)
<LI>

Функции: <code>ADD_TO_SET(value,set)</code> и <code>REMOVE_FROM_SET(value,set)</code>.
<LI>

Добавить использование <code>t1 JOIN t2 ON ... и t1 JOIN t2 USING ...</code> В
данное время можно использовать этот синтаксис только с <code>LEFT JOIN</code>.
<LI>

Намного большее количество переменных для <code>SHOW STATUS</code>. Фиксирование
операций чтения и обновления. Выборки по 1 таблице и выборки по
связям. Среднее число таблиц в выборке. Большое число запросов <code>ORDER
BY</code> и <code>GROUP BY</code>.
<LI>

Если вы прерываете выполнение запроса в середине, необходимо открыть
другое соединение и убить старый выполнявшийся запрос. В свою очередь,
сервер должен распознавать это на своей стороне.
<LI>

Добавить интерфейс обработчика для табличных данных таким образом,
чтобы была возможность использовать его как системную таблицу. Это
будет работать несколько медленно в случае запрашивания информации обо
всех таблицах, но очень гибко. Должен быть реализован <code>SHOW INFO FROM
tbl_name</code> для основных данных о таблицах.
<LI>

Сделать  возможным  <code>SELECT a FROM crash_me LEFT JOIN crash_me2 USING
(a)</code>; в  данном  случае  подразумевается, что  <code>a</code>  будет  браться  из 
таблицы  <code>crash_me</code>.
<LI>

Oracle-подобный <code>CONNECT BY PRIOR ...</code> для изучения иерархических
структур.
<LI>

<code>mysqladmin copy database new-database</code>; требуется добавить команду <code>COPY</code>
в <code>mysqld</code>.
<LI>

Список процессов должен показывать количество запросов/потоков.
<LI>

<code>SHOW HOSTS</code> для распечатки информации о кэше имен хостов.
<LI>

Опции <code>DELETE</code> и <code>REPLACE</code> для оператора <code>UPDATE</code> (оператор с этими опциями
будет удалять строки при получении ошибки дублирующихся ключей во
время обновления).
<LI>

Изменить формат <code>DATETIME</code>, чтобы сохранять  порции в секундах.
<LI>

Добавить все недостающие типы ANSI92 и ODBC 3.0.
<LI>

Изменить имена таблиц с пустых строк на <code>NULL</code> для вычисляемых столбцов.
<LI>

Не использовать <code>Item_copy_string</code> для числовых значений во избежание
преобразований число-&#62;строка-&#62;число в случае: <code>SELECT COUNT(*)*(id+0)
FROM table_name GROUP BY id</code> 
<LI>

Сделать возможным использование новой библиотеки <code>GNU regexp</code> вместо
текущей (библиотека <code>GNU</code> должна быть намного быстрее, чем предыдущая).
<LI>

Сделать так, чтобы <code>ALTER TABLE</code> не срывал работу <code>INSERT DELAYED</code>.
<LI>

Сделать следующее исправление: если на столбцы есть ссылки в выражении
<code>UPDATE</code>, они будут содержать значения, хранившиеся там до запуска
процесса обновления.
<LI>

Добавить эмуляцию <code>pread()</code>/<code>pwrite()</code> под Windows, чтобы сделать
возможными одновременные вставки.
<LI>

Разработать анализатор файла журнала для анализа и выдачи информации о
том, какие таблицы используются наиболее часто, насколько часто
выполняются мультитабличные связи и т.д. Это помогло бы пользователям
выбирать такую конструкцию таблиц и областей, которая могла бы быть
оптимизирована для выполнения наиболее эффективных запросов.
<LI>

Добавить <code>SUM(DISTINCT)</code>.
<LI>

Добавить групповые функции <code>ANY()</code>, <code>EVERY()</code> и <code>SOME()</code>. В ANSI SQL эти
функции работают только с булевыми столбцами, но мы можем расширить
эти функции, чтобы они работали с любыми столбцами/выражениями,
применив: <code>value == 0 -&#62; FALSE</code> и <code>value &#60;&#62; 0 -&#62; TRUE</code>.
<LI>

Добиться, чтобы тип для <code>MAX(column)</code> был таким же как и тип столбцов:

<PRE>
mysql&#62; CREATE TABLE t1 (a DATE);
mysql&#62; INSERT INTO t1 VALUES (NOW());
mysql&#62; CREATE TABLE t2 SELECT MAX(a) FROM t1;
mysql&#62; SHOW COLUMNS FROM t2;
</PRE>

<LI>

Придумать хороший синтаксис для оператора, который будет выполнять <code>UPDATE</code>
над строкой при наличии таковой, и <code>INSERT</code> новой строки, если строка
отсутствует (подобно тому, как <code>REPLACE</code> работает с <code>INSERT</code> / <code>DELETE</code>).
</UL>



<H3><A NAME="TODO_sometime" HREF="manual.ru_toc.html#TODO_sometime">1.10.5  То, что надо сделать когда-нибудь</A></H3>


<UL>
<LI>

Реализовать  функцию: <code>get_changed_tables(timeout,table1,table2,...)</code>.
<LI>

Изменить чтение таблиц так, чтобы везде, где возможно. использовалась
memmap. Сейчас memmap используется только для уплотненных таблиц.
<LI>

Сделать лучше автоматический код временных меток (timestamp).
Добавлять временные метки в журнал обновлений при помощи <code>SET
TIMESTAMP=#;</code>.
<LI>

Использовать в некоторых местах семафор чтения/записи для увеличения
скорости.
<LI>

Обеспечить полную поддержку внешних ключей в <code>MyISAM</code>-таблицах
(возможно, после реализации хранимых процедур с триггерами).
<LI>

Подготовить простые обзоры (сначала по одной таблице, позднее по
любому выражению).
<LI>

Реализовать автоматическое закрытие некоторых таблиц, если таблица,
временная таблица или временные файлы получат ошибку 23 (недостаточно
открытых файлов).
<LI>

Если обнаружится поле=#, заменить все местонахождения поля на #.
Сейчас такое делается только для некоторых простых случаев.
<LI>

Заменить все константные выражения вычисляемыми, если возможно.
<LI>

Реализовать оптимизацию ключ=выражение. К данному моменту делается
оптимизация только для ключ=поле или ключ=константа.
<LI>

Связывать некоторые функции копирования для улучшения кода.
<LI>

Заменить <code>sql_yacc.yy</code> внутритекстовым синтаксическим анализатором,
чтобы уменьшить ее размер и получать лучшие сообщения об ошибке (5
дней).
<LI>

Изменить собственный синтаксический анализатор так, чтобы он
использовал только одно правило для различного количества аргументов в
функции.
<LI>

Использовать полные вычисляемые имена в части сортировки (для
ACCESS97).
<LI>

<code>MINUS</code>, <code>INTERSECT</code> и  <code>FULL OUTER JOIN</code> (в настоящее время поддерживаются
<code>UNION</code> [в 4.0] и <code>LEFT OUTER JOIN</code>).
<LI>

<code>SQL_OPTION MAX_SELECT_TIME=#</code>, чтобы устанавливать ограничения по
времени для запроса.
<LI>

Сделать так, чтобы обновляемый журнал записывался в базу данных..
<LI>

Сделать добавления в <code>LIMIT</code>, чтобы можно было делать восстановление
данных с конца результирующего набора.
<LI>

Сигналы предупреждений для функций соединения/чтения/записи клиента.
<LI>

Необходимо обратить внимание на изменения на <code>safe_mysqld</code>; согласно
FSSTND (которому пытается следовать Debian) PID-файлы должны
помещаться в <tt>`/var/run/&#60;progname&#62;.pid'</tt>, a файлы журналов - в <tt>`/var/log'</tt>.
Было бы хорошо, если бы было можно поместить "<tt>`DATADIR'</tt>" в первое
объявление "<tt>`pidfile'</tt>" и "<tt>`log'</tt>", чтобы местоположение этих файлов можно было
изменить одним оператором.
<LI>

Разрешать клиенту запрашивать ведение журналов.
<LI>

Добавить использование <code>zlib()</code> для <code>gzip</code>-файлов в <code>LOAD DATA INFILE</code>.
<LI>

Исправить сортировку и группирование <code>BLOB</code>-столбцов (сейчас проблема
частично решена).
<LI>

Хранимые процедуры. Рассматриваются также триггеры.
<LI>

Простой (атомарный) язык обновления, который может быть использован
для написания циклов и т.п. в MySQL-сервере.
<LI>

Произвести изменения для того, чтобы пользоваться семафорами при
подсчете потоков. Но сначала нужно реализовать библиотеку семафоров
для потоков MIT-pthreads.
<LI>

Не устанавливать новое значение во время установки колонки в 0. вместо
этого использовать <code>NULL</code>.
<LI>

Добавить полную поддержку круглых скобок для <code>JOIN</code>.
<LI>

В качестве альтернативы одному потоку/соединению управлять пулом
потоков при обработке запросов.
<LI>

Обеспечить возможность получать более чем одну блокировку при помощи
<code>GET_LOCK</code>. Когда это будет реализовано, потребуется еще сделать
обработку возможных тупиковых ситуаций, которые привнесет данное
изменение.
</UL>

<P>
Время отводится согласно объемам работ, а не реальному времени.

</P>


<H3><A NAME="TODO_unplanned" HREF="manual.ru_toc.html#TODO_unplanned">1.10.6  То, чего не планируется делать</A></H3>


<UL>
<LI>

Такого не существует; мы стремимся к полной совместимости с ANSI
92/ANSI 99.
</UL>



<H2><A NAME="Comparisons" HREF="manual.ru_toc.html#Comparisons">1.11  Сравнение MySQL с другими СУБД</A></H2>

<P>
<A NAME="IDX158"></A>
<A NAME="IDX159"></A>

</P>
<P>
Наши пользователи провели исследование скорости работы нескольких обычных
серверов баз данных и серверов баз данных с открытым кодом. Нам известно о
проводившихся сравнениях MySQL с сервером Oracle, сервером DB/2, Microsoft
SQL Server и другими коммерческими программными продуктами. Однако по
причинам юридического характера опубликовать результаты некоторых из этих
сравнений в документации не представляется возможным.

</P>
<P>
В данном разделе приведены результаты сравнения с mSQL (проводившегося по
историческим причинам) и с PostgreSQL (так как эта СУБД также
распространяется как ПО с открытым кодом). Если у вас имеются результаты
подобного тестирования, которые мы могли бы опубликовать, просьба
связаться с нами по адресу <a HREF="mailto:benchmarks@mysql.com">benchmarks@mysql.com</a>.

</P>
<P>
Сравнения всех имеющихся функций и типов а также данные о пределах
возможностей различных СУБД вы найдете на веб-странице <code>crash-me</code>,
расположенной по адресу  <a HREF="http://www.mysql.com/information/crash-me.php">http://www.mysql.com/information/crash-me.php</a>.

</P>



<H3><A NAME="Compare_mSQL" HREF="manual.ru_toc.html#Compare_mSQL">1.11.1  Сравнение MySQL и mSQL</A></H3>

<P>
<A NAME="IDX160"></A>

</P>
<DL COMPACT>

<DT><strong>Производительность</strong>
<DD>
Точные результаты сравнения скорости работы можно найти в постоянно
пополняющейся библиотеке проведенных тестов по MySQL (see section <A HREF="manual.ru.html#MySQL_Benchmarks">5.1.4  Набор тестов MySQL (The MySQL Benchmark Suite)</A>).

СУБД mSQL, благодаря отсутствию затрат дополнительных
ресурсов на создание потоков, а также за счет компактности синтаксического
анализатора, небольшого количества функций и упрощенной системы
безопасности, должна выигрывать в скорости выполнения:


<UL>
<LI>

тестов на выполнение циклов соединение-отсоединение, при каждом
соединении выполняющих какой-нибудь простой запрос

<LI>

операций <code>INSERT</code> над простыми таблицами, содержащими небольшое
количество столбцов и ключей

<LI>

<code>CREATE TABLE</code>  и  <code>DROP TABLE</code>

<LI>

операций <code>SELECT</code> чего-нибудь, кроме индексов (очень просто выполняется
просмотр таблицы)
</UL>

Поскольку такие операции очень просты, при больших затратах ресурсов на
начальном этапе выиграть в скорости их выполнения достаточно сложно.
Поэтому лучшие результаты MySQL может показать лишь после установки
соединения. С другой стороны, MySQL значительно превосходит mSQL (и
большинство других реализаций SQL) при:


<UL>
<LI>

выполнении сложных операций <code>SELECT</code>.

<LI>

загрузке объемных результатов (протокол, применяющийся в MySQL,
превосходит другие по качеству, скорости и безопасности).

<LI>

работе с таблицами, имеющими строки переменной длины, так как
обработка данных в MySQL реализована более эффективно и в нем
допускается создание индексов для столбцов с типом <code>VARCHAR</code>.

<LI>

обработке таблиц, содержащих большое количество столбцов.

<LI>

обработке таблиц с длинными записями.

<LI>

выполнении операций <code>SELECT</code> с несколькими выражениями.

<LI>

выполнении операций <code>SELECT</code> над объемными таблицами.

<LI>

одновременной работе с несколькими соединениями. Архитектура MySQL
Server является полностью многопоточной. Для каждого соединения
создается отдельный поток и, таким образом, ни одному из них не
приходится ожидать завершения другого (если, конечно, один из потоков
не занимается изменением таблицы, доступ к которой требуется другому
потоку). В mSQL же после установки одного соединения остальным
приходится ожидать его завершения, вне зависимости от сложности и
времени выполнения примененного в этом соединении запроса. По
завершении первого соединения начинает обслуживаться второе, а все
остальные снова ждут своей очереди.

<LI>

связывании таблиц. При изменении порядка таблиц в вызове <code>SELECT</code>,
скорость работы mSQL может упасть ниже всяких допустимых пределов. При
выполнении комплекта тестов производительности выполнение такой
операции заняло в 15000 раз больше времени, чем у MySQL.
Причиной столь плачевно низкой производительности является отсутствие
в mSQL оптимизатора связей, который обеспечивал бы оптимальность
используемого порядка соединения таблиц. Однако если в mSQL2
расположить таблицы в правильном порядке, не перегружать оператор
<code>WHERE</code> и использовать индексные столбцы, связывание будет выполнено
относительно быстро! (see section <A HREF="manual.ru.html#MySQL_Benchmarks">5.1.4  Набор тестов MySQL (The MySQL Benchmark Suite)</A>).

<LI>

<code>ORDER BY</code>  и  <code>GROUP BY</code>.

<LI>

<code>DISTINCT</code>.

<LI>

работе со столбцами с типами <code>TEXT</code> или <code>BLOB</code>.
</UL>

<DT><strong>Возможности SQL</strong>
<DD>

<UL>
<LI><code>GROUP BY</code> и <code>HAVING</code>.

В mSQL функция <code>GROUP BY</code> отсутствует вовсе. В MySQL
Server же <code>GROUP BY</code> имеется и работает как с <code>HAVING</code>, так и со следующими
функциями: <code>COUNT()</code>, <code>AVG()</code>, <code>MIN()</code>, <code>MAX()</code>, <code>SUM()</code>и <code>STD()</code>. 
Работа оператора
<code>COUNT(*)</code> оптимизирована в расчете на быстрый возврат результатов, если
оператор <code>SELECT</code> берет данные из одной таблицы, не используя никаких других
столбцов и выражения <code>WHERE</code>. Функции <code>MIN()</code> и <code>MAX()</code> могут принимать
строковые аргументы.

<LI>

<code>INSERT</code> и <code>UPDATE</code> с вычислениями. MySQL может выполнять
вычисления непосредственно в теле вызова <code>INSERT</code> или <code>UPDATE</code>. Вот 
пример:


<PRE>
mysql&#62; UPDATE SET x=x*10+y WHERE x&#60;20;
</PRE>

<LI>

Псевдонимы. В MySQL имеется возможность определения псевдонимов
столбцов.

<LI>

Квалификация имен столбцов. В MySQL, при условии уникальности
имени столбца среди таблиц, использующихся при выполнении запроса, нет
необходимости приводить его полный квалификатор.

<LI>

<code>SELECT</code> с функциями. Функций в MySQL много (даже слишком много,
чтобы их можно было перечислить здесь; see section <A HREF="manual.ru.html#Functions">6.3  Функции, используемые в операторах <code>SELECT</code> и <code>WHERE</code></A>).
</UL>

<DT><strong>Эффективность использования дискового пространства</strong>
<DD>
Можно ли уменьшить таблицы, и если да, то насколько? В MySQL 
имеются очень точные типы данных, а с их помощью можно создавать таблицы,
занимающие минимум пространства. Примером чрезвычайно полезного типа
данных MySQL может служить <code>MEDIUMINT</code>, длина значений которого составляет 3
байта. При наличии 100 миллионов записей значение экономии даже одного
байта на каждой из них трудно переоценить. Выбор типов столбцов в mSQL2
значительно беднее, и поэтому снизить размеры таблиц заметно трудней.

<DT><strong>Стабильность</strong>
<DD>
Объективно оценить этот параметр трудно. Подробно вопрос стабильности
MySQL рассмотрен в разделе section <A HREF="manual.ru.html#Stability">1.4.3  Насколько стабильным является MySQL?</A>. Данных и опыта,
позволяющих судить о стабильности mSQL, у нас не имеется.

<DT><strong>Стоимость</strong>
<DD>
Цена лицензии является немаловажным фактором. По гибкости лицензии MySQL
Server превосходит mSQL, да и стоит меньше. Вне зависимости от того, какой
из продуктов вы выберете, не забудьте принять во внимание стоимость
лицензии или технической поддержки по электронной почте.

<DT><strong>Perl-интерфейсы</strong>
<DD>
Perl-интерфейсы MySQL практически идентичны своим аналогам из mSQL,
хотя и обладают некоторыми дополнительными возможностями.

<DT><strong>JDBC (Java)</strong>
<DD>
В настоящее время для MySQL разработано много разнообразных
<code>JDBC</code>-драйверов:


<UL>
<LI>

MySQL Connector/J - родной драйвер для Java. 
Версия 3.x выпускается под двойным лицензированием (GPL и коммерческая лицензия). 

<LI>

Драйвер Resin: коммерческий JDBC-драйвер, распространяющийся как ПО с
открытым кодом. <a HREF="http://www.caucho.com/projects/jdbc-mysql/index.xtp">http://www.caucho.com/projects/jdbc-mysql/index.xtp</a> 

<LI>

Драйвер gwe: Java-интерфейс, разработанный компанией GWE technologies
(более не поддерживается).

<LI>

Драйвер jms: улучшенная версия драйвера gwe, разработанная Кельвином
Заоку Жу (Xiaokun Kelvin ZHU, <a HREF="mailto:X.Zhu@brad.ac.uk">X.Zhu@brad.ac.uk</a>) (более не
поддерживается).

<LI>

Драйвер twz: JDBC-драйвер типа 4, разработанный Терренсом В. Зеллерсом
(Terrence W. Zellers <a HREF="mailto:zellert@voicenet.com">zellert@voicenet.com</a>). Это коммерческий продукт,
но в частном порядке и для образовательных целей им можно пользоваться
бесплатно (более не поддерживается).
</UL>

Рекомендуется использование драйвера mm. Драйвер Resin тоже, возможно,
неплох (по крайней мере, результаты тестов выглядят хорошо), но
достаточного количества информации по нему у нас пока нет. Мы знаем, что в
mSQL имеется JDBC-драйвер, но для сравнения у нас не хватает опыта работы
с ним.

<DT><strong>Скорость разработки</strong>
<DD>
Основная команда разработчиков MySQL немногочисленна, но мы
привыкли писать код на C и C++ очень быстро. Так как потоки, функции,
оператор <code>GROUP BY</code> и т.п. в mSQL все еще не реализованы, этой системе еще
долго придется догонять нас. Более точное представление о положении вещей
вы сможете получить, прочитав файл <tt>`HISTORY'</tt> от mSQL за последний год, и
сравнив его с разделом новостей (News) MySQL Reference Manual (see section <A HREF="manual.ru.html#News">C  История изменений и обновлений MySQL</A>). 
После этого сомнений относительно того, какая
система развивалась быстрее, остаться не должно.

<DT><strong>Инструментальные программы</strong>
<DD>
Как для mSQL, так и для MySQL сторонними разработчиками было
создано множество интересных инструментальных средств. Поскольку перенос
программ из mSQL в MySQL сложностей не представляет, почти все
интересные приложения, разработанные первоначально для mSQL,имеются и в
вариантах для MySQL. В комплект поставки MySQL входит
простая программа <code>msql2mysql</code>, исправляющая различия в написании наиболее
популярных функций C API между mSQL и MySQL. Вызовы функции
<code>msqlConnect()</code>, например, она заменяет на <code>mysql_connect()</code>. Обычно для
перевода клиентской программы из mSQL в MySQL оказывается
достаточно минимальных усилий.
</DL>



<H4><A NAME="Using_mSQL_tools" HREF="manual.ru_toc.html#Using_mSQL_tools">1.11.1.1  Как конвертировать инструментальные средства mSQL в MySQL</A></H4>

<P>
<A NAME="IDX161"></A>
<A NAME="IDX162"></A>

</P>
<P>
Согласно нашему опыту, переделать такие инструментальные программы, как
<code>msql-tcl</code> и <code>msqljava</code>, созданные на основе C API mSQL для работы с C API
MySQL, несложно.

</P>
<P>
Сделать это можно так:

</P>

<OL>
<LI>

Пропустите исходный файл через сценарий оболочки <code>msql2mysql</code>. Для этого
необходима программа <code>replace</code>, распространяющаяся вместе с MySQL
Server.

<LI>

Откомпилируйте.

<LI>

Исправьте все найденные компилятором ошибки.
</OL>

<P>
Различия между реализациями C API в mSQL и MySQL заключаются в следующем:

</P>

<UL>
<LI>

В качестве типа в MySQL используется структура <code>MYSQL</code> (в mSQL в этом
качестве применяется <code>int</code>).

<LI>

Оператор <code>mysql_connect()</code> принимает в качестве параметра указатель на
структуру <code>MYSQL</code>. Такую структуру можно легко объявить как глобальную
или создать ее с помощью <code>malloc()</code>. Кроме того, <code>mysql_connect()</code> 
принимает еще два параметра, в которых указываются имя пользователя и
его пароль. Для использования данной структуры по умолчанию этим
параметрам нужно присвоить значения <code>NULL</code>, <code>NULL</code>.

<LI>

<code>mysql_error()</code> принимает в качестве параметра структуру <code>MYSQL</code>. При
переносе старого кода достаточно добавить параметр в вызов
<code>msql_error()</code>.

<LI>

Для всех ошибок MySQL возвращает номер ошибки и текстовое
сообщение. mSQL же возвращает только текстовое сообщение об ошибке.

<LI>

Существует некоторая несовместимость, обусловленная тем, что в MySQL
Server можно создавать несколько соединений с сервером из одного и того же
процесса.
</UL>



<H4><A NAME="Protocol_differences" HREF="manual.ru_toc.html#Protocol_differences">1.11.1.2  Различия в клиент-серверных коммуникационных протоколах mSQL и MySQL</A></H4>

<P>
<A NAME="IDX163"></A>
<A NAME="IDX164"></A>
<A NAME="IDX165"></A>

</P>
<P>
Различий здесь имеется более чем достаточно для того, чтобы поддержку
обоих протоколов одновременно обеспечить было невозможно (или, по меньшей
мере, очень сложно).

</P>
<P>
Ниже приведены наиболее заметные различия между коммуникационными
протоколами MySQL и mSQL:

</P>

<UL>
<LI>

В буфере сообщения может находиться несколько столбцов результатов.

<LI>

Буферы сообщений динамически увеличиваются, если запрос или результат
не умещаются в их текущем объеме, ограничение на объем буфера
устанавливается сервером и клиентом.

<LI>

Все пакеты нумеруются, что позволяет обнаружить среди них
повторяющиеся или пропуски.

<LI>

Все значения столбцов отправляются в виде ASCII. Длины строк и
столбцов посылаются в упакованном виде в двоичном виде (1, 2 или 3
байта).

<LI>

MySQL может считывать результаты без буферизации (без необходимости
сохранения всех данных в клиенте).

<LI>

Если одна операция считывания/записи занимает более 30 секунд, сервер
закрывает соединение.

<LI>

Если соединение бездействует в течение 8 часов, сервер его закрывает.
</UL>



<H4><A NAME="Syntax_differences" HREF="manual.ru_toc.html#Syntax_differences">1.11.1.3  Различия в синтаксисе SQL между mSQL 2.0 и MySQL</A></H4>

<P>
<strong>Типы  столбцов</strong>

</P>
<DL COMPACT>

<DT><code>MySQL</code>
<DD>
Имеются следующие дополнительные типы (не считая остальных; see section <A HREF="manual.ru.html#CREATE_TABLE">6.5.3  Синтаксис оператора <code>CREATE TABLE</code></A>):

<UL>
<LI>

<code>ENUM</code> - тип для одного набора строк.
<LI>

<code>SET</code> - тип для нескольких наборов строк.
<LI>

<code>BIGINT</code> - тип для 64-битовых целых чисел.
</UL>

<DT><code></code>
<DD>
Кроме того, MySQL поддерживает следующие атрибуты дополнительных
типов:

<UL>
<LI>

<code>UNSIGNED</code> - опция для целочисленных столбцов и столбцов чисел с
плавающей запятой.
<LI>

<code>ZEROFILL</code> - опция для целочисленных столбцов.
<LI>

<code>AUTO_INCREMENT</code> - опция для целочисленных столбцов, являющихся
первичными ключами. See section <A HREF="manual.ru.html#mysql_insert_id">8.4.3.31  <code>mysql_insert_id()</code></A>.
<LI>

<code>DEFAULT</code> - значение для всех столбцов.
</UL>

<DT><code>mSQL2</code>
<DD>
Типы столбцов в mSQL соответствуют приведенным в таблице типам MySQL:
<TABLE BORDER>
<TR><TD><strong>Тип в mSQL</strong> </TD><TD> <strong>Соответствующий тип в MySQL</strong>
</TD></TR>
<TR><TD><code>CHAR(len)</code> </TD><TD> <code>CHAR(len)</code>
</TD></TR>
<TR><TD><code>TEXT(len)</code> </TD><TD> <code>TEXT(len)</code>. <code>len</code> - максимальная  длина. Работает <code>LIKE</code>.
</TD></TR>
<TR><TD><code>INT</code> </TD><TD> <code>INT</code>. Со множеством опций!
</TD></TR>
<TR><TD><code>REAL</code> </TD><TD> <code>REAL</code>. Или  <code>FLOAT</code>. Имеются как 4-битовые, так и 8-битовые варианты.
</TD></TR>
<TR><TD><code>UINT</code> </TD><TD> <code>INT UNSIGNED</code>
</TD></TR>
<TR><TD><code>DATE</code> </TD><TD> <code>DATE</code>. Использует формат ANSI  SQL, а не собственный формат mSQL.
</TD></TR>
<TR><TD><code>TIME</code> </TD><TD> <code>TIME</code>
</TD></TR>
<TR><TD><code>MONEY</code> </TD><TD> <code>DECIMAL(12,2)</code>. Значение с фиксированной точкой и двумя знаками после нее.
</TD></TR>
</TABLE>
</DL>

<P>
<strong>Создание индексов</strong>

</P>
<DL COMPACT>

<DT><code>MySQL</code>
<DD>
Индексы могут указываться во время создания таблицы при помощи оператора
<code>CREATE TABLE</code>.
<DT><code>mSQL</code>
<DD>
Индексы создаются после создания таблицы с помощью операторов <code>CREATE
INDEX</code>.
</DL>

<P>
<strong>Вставка уникального идентификатора в таблицу</strong>

</P>
<DL COMPACT>

<DT><code>MySQL</code>
<DD>
Для указания типа столбца достаточно использовать <code>AUTO_INCREMENT</code>. See section <A HREF="manual.ru.html#mysql_insert_id">8.4.3.31  <code>mysql_insert_id()</code></A>.
<DT><code>mSQL</code>
<DD>
Необходимо создать в таблице <code>SEQUENCE</code> и выбрать столбец <code>_seq</code>.
</DL>

<P>
<strong>Получение уникального идентификатора для строки</strong>

</P>
<DL COMPACT>

<DT><code>MySQL</code>
<DD>
Следует добавить к таблице первичный или уникальный ключ и использовать
его. Новое в версии 3.23.11: если ключ <code>PRIMARY</code> или <code>UNIQUE</code> состоит только
из одного целочисленного столбца, к нему можно обращаться и как к <code>_rowid</code>.
<DT><code>mSQL</code>
<DD>
Следует использовать столбец <code>_rowid</code>. Нельзя забывать о том, что <code>_rowid</code>
может, в зависимости от множества факторов, со временем измениться.
</DL>

<P>
<strong>Получение времени последнего изменения столбца</strong>

</P>
<DL COMPACT>

<DT><code>MySQL</code>
<DD>
Нужно вставить в таблицу столбец <code>TIMESTAMP</code>. Этому столбцу автоматически
присваиваются текущая дата и время при вызове операторов <code>INSERT</code> или
<code>UPDATE</code>, если ему не присвоить определенного значения или присвоить
значение <code>NULL</code>.
<DT><code>mSQL</code>
<DD>
Следует использовать столбец <code>_timestamp</code>.
</DL>

<P>
<strong>Сравнение значений <code>NULL</code></strong>

</P>
<DL COMPACT>

<DT><code>MySQL</code>
<DD>
MySQL соответствует стандарту ANSI SQL, поэтому сравнение с <code>NULL</code>
всегда возвращает результат <code>NULL</code>.
<DT><code>mSQL</code>
<DD>
В mSQL выражение <code>NULL = NULL</code> имеет значение TRUE. Поэтому при переводе
старого кода из mSQL в MySQL <code>=NULL</code> необходимо заменить на <code>IS NULL</code>,
а <code>&#60;&#62;NULL</code> - на <code>IS NOT NULL</code>.
</DL>

<P>
<strong>Сравнение строк</strong>

</P>
<DL COMPACT>

<DT><code>MySQL</code>
<DD>
Обычно сравнение строк проводится без учета регистра символов, с порядком
сортировки, который определяется текущим набором символов (ISO-8859-1
Latin1 по умолчанию). Если вам это не подходит, необходимо установить при
объявлении столбцов атрибут <code>BINARY</code>, тогда сравнение будет проводиться в
соответствии с ASCII-порядком, установленным на сервере MySQL.
<DT><code>mSQL</code>
<DD>
Все сравнения строк проводятся с учетом регистра символов в ASCII-порядке
сортировки.
</DL>

<P>
<strong>Поиск без учета регистра символов</strong>

</P>
<DL COMPACT>

<DT><code>MySQL</code>
<DD>
<code>LIKE</code> может быть как чувствительным, так и нечувствительным к регистру
оператором, в зависимости от столбцов, к которым он применяется. По
возможности MySQL использует индексы, если аргумент <code>LIKE</code> не начинается с
шаблонного символа.
<DT><code>mSQL</code>
<DD>
Следует использовать <code>CLIKE</code>.
</DL>

<P>
<strong>Обработка концевых пробелов</strong>

</P>
<DL COMPACT>

<DT><code>MySQL</code>
<DD>
Все пробелы в конце столбцов <code>CHAR</code> и <code>VARCHAR</code> удаляются. Если такое
поведение нежелательно, используйте столбцы <code>TEXT</code>.
<DT><code>mSQL</code>
<DD>
Концевые пробелы сохраняются.
</DL>

<P>
<strong>Операторы WHERE</strong>

</P>
<DL COMPACT>

<DT><code>MySQL</code>
<DD>
MySQL правильно определяет приоритеты действий (<code>AND</code> имеет приоритет перед
<code>OR</code>). Заставить MySQL вести себя так, как mSQL, можно при помощи
скобок (как можно видеть в соответствующем примере).
<DT><code>mSQL</code>
<DD>
Все действия производятся слева направо. А это значит, что некоторые
логические вычисления, в которых наличествует более трех аргументов, не
могут быть выполнены вообще. Кроме того, это означает, что при переносе в
MySQL некоторые запросы необходимо менять. Это довольно просто
сделать при помощи скобок. Возьмем, к примеру, следующий запрос mSQL:

<PRE>
mysql&#62; SELECT * FROM table WHERE a=1 AND b=2 OR a=3 AND b=4;
</PRE>

Чтобы MySQL вычислил результат этого запроса так же, как это сделал
бы mSQL, нужно расставить скобки:

<PRE>
mysql&#62; SELECT * FROM table WHERE (a=1 AND (b=2 OR (a=3 AND (b=4))));
</PRE>

</DL>

<P>
<strong>Ограничения доступа</strong>

</P>
<DL COMPACT>

<DT><code>MySQL</code>
<DD>
Для хранения привилегий для каждого пользователя, удаленного компьютера и
базы имеются соответствующие таблицы. See section <A HREF="manual.ru.html#Privileges">4.2.6  Как работает система привилегий</A>.
<DT><code>mSQL</code>
<DD>
Имеется файл <tt>`mSQL.acl'</tt>, в котором можно определить привилегии
чтения/записи для пользователей.
</DL>



<H3><A NAME="Compare_PostgreSQL" HREF="manual.ru_toc.html#Compare_PostgreSQL">1.11.2  Сравнение MySQL c PostgreSQL</A></H3>

<P>
<A NAME="IDX166"></A>

</P>
<P>
Читая этот раздел, помните о том, что оба программных продукта находятся в
постоянном развитии. Мы (разработчики MySQL) и разработчики PostgreSQL
постоянно заняты улучшением наших СУБД, поэтому обе системы являются
серьезными альтернативами любым коммерческим СУБД.

</P>
<P>
Приведенное ниже сравнение проводилось в MySQL AB. Мы старались быть как
можно более точными и объективными, однако, зная MySQL наизусть, мы
не можем похвастаться таким же знанием возможностей PostgreSQL, поэтому в
чем-то могли и ошибиться. Однако мы будем тут же исправлять все замеченные
неточности.

</P>
<P>
Прежде всего хотелось бы отметить, что PostgreSQL и MySQL являются широко
используемыми программными продуктами, которые разрабатывались с разными
целями (хотя создатели обоих и стремятся довести их до полной
совместимости со стандартом ANSI SQL). Это значит, что для решения одних
задач больше подходит MySQL, для других же - PostgreSQL. Выбирая
СУБД, проверьте, соответствуют ли ее возможности требованиям,
предъявляемым решаемой задачей. Если требуется максимальная скорость
работы, лучше всего, вероятно, будет остановить свой выбор на MySQL
Server. Если же вам необходимы дополнительные возможности, имеющиеся
только у <code>PostgreSQL</code>, этой СУБД и стоит пользоваться.

</P>



<H4><A NAME="MySQL-PostgreSQL_goals" HREF="manual.ru_toc.html#MySQL-PostgreSQL_goals">1.11.2.1  Стратегии развития MySQL и PostgreSQL</A></H4>

<P>
<A NAME="IDX167"></A>

</P>
<P>
Расширяя возможности MySQL мы всегда стараемся принять оптимальное
решение. Код должен быть настолько хорош, чтобы в обозримом будущем в нем
не понадобилось ничего менять. Кроме того, мы не считаем целесообразным
ради расширения возможностей приносить в жертву скорость, а вместо этого
стараемся в каждом случае обеспечить максимально возможную
производительность. В итоге несколько увеличивается время разработки, но
результаты того стоят. Разработка в таком ключе возможна потому, что все
новые фрагменты серверного кода перед включением в состав MySQL 
проверяются несколькими разработчиками.

</P>
<P>
Мы считаем, что лучшим средством предоставления нашим пользователям новых
возможностей является частый выпуск новых версий. Поэтому примерно раз в
три недели у нас выходит несколько обновленная версия системы, а раз в
год - полностью новая. Все версии проходят полное тестирование с помощью
наших инструментальных средств на множестве платформ.

</P>
<P>
Система PostgreSQL основана на ядре, созданном множеством разработчиков. В
подобных случаях разумно сосредоточиться на оснащении системы новыми
возможностями, но не заниматься оптимальным их воплощением, так как в
случае возникновения необходимости всегда можно будет вернуться к
оптимизации соответствующих участков кода.

</P>
<P>
Еще одно значительное отличие MySQL от PostgreSQL заключается в
том, что практически весь содержащийся в MySQL код создан разработчиками,
работающими в MySQL AB и постоянно занятыми совершенствованием кода
сервера. Исключением из этого правила являются системы транзакций и
библиотека регулярных выражений <code>regexp</code>.

</P>
<P>
Большая же часть кода PostgreSQL написана множеством разработчиков, никак
друг с другом не связанных. Не так давно разработчики PostgreSQL объявили
о том, что у их команды наконец-то хватило времени на просмотр всего кода,
вошедшего в состав очередной версии PostgreSQL.

</P>
<P>
У обоих вышеупомянутых методов разработки есть достоинства и недостатки.
Мы, сотрудники MySQL AB, разумеется, считаем, что наша модель лучше, так
как обеспечивает большую логичность кода, оптимальность и возможность его
повторного использования, а также - меньшее количество ошибок. Будучи
авторами кода сервера MySQL, мы с большим успехом можем координировать
включение в систему новых возможностей и выход ее новых версий.

</P>


<H4><A NAME="MySQL-PostgreSQL_features" HREF="manual.ru_toc.html#MySQL-PostgreSQL_features">1.11.2.2  Сравнение возможностей MySQL и PostgreSQL</A></H4>

<P>
<A NAME="IDX168"></A>

</P>
<P>
На странице <code>crash-me</code> (<a HREF="http://www.mysql.com/information/crash-me.php">http://www.mysql.com/information/crash-me.php</a>)
приведен список ограничений и особенностей СУБД, которые могут быть
обнаружены автоматически с помощью специальных программ. Однако не стоит
забывать о том, что многие ограничения могут быть изменены настройкой
соответствующих баз данных. Впрочем, эта web-страница оказывается очень
кстати, если необходимо, чтобы создаваемое приложение нормально работало с
несколькими СУБД или для перевода приложения с одной СУБД в другую.

</P>
<P>
MySQL обладает следующими преимуществами перед PostgreSQL:

</P>

<UL>
<LI>

<code>MySQL</code> обычно намного превосходит PostgreSQL по скорости работы. Кроме
того, в MySQL 4.0 реализован кэш запросов. Он позволяет во много раз
увеличить скорость обработки запросов для сайтов, на которых
преобладают неоднократно повторяющиеся запросы на чтение.

<LI>

По количеству пользователей MySQL также намного превосходит
PostgreSQL. Поэтому код тестируется значительно более придирчиво и
опытным путем доказана большая его надежность, нежели у PostgreSQL.
MySQL чаще, чем PostgreSQL, используется на производстве, в
основном потому, что компания MySQL AB (ранее - TCX DataKonsult AB)
предоставляет высококачественную коммерческую техническую поддержку
MySQL с момента появления этой системы на рынке, а у PostgreSQL
до самого последнего времени никакой поддержки не было.

<LI>

MySQL работает в среде Windows лучше, чем PostgreSQL. MySQL
Server запускается как настоящее (родное) Windows-приложение (в
NT/2000/XP - сервис), в то время как PostgreSQL запускается в среде
эмуляции, <code>Cygwin</code>. Нам доводилось слышать о недостаточной стабильности
работы PostgreSQL в среде Windows, но самостоятельно эти сведения до
сих пор мы проверить не могли.

<LI>

MySQL оснащен большим количеством API для других языков и
поддерживается большим количеством существующих программ, нежели
PostgreSQL.

<LI>

MySQL работает на высоконадежных промышленных системах 24/7
(включенных 24 часа в сутки 7 дней в неделю). В большинстве случаев
никаких ``чисток'' в MySQL производить не требуется. PostgreSQL же
пока что не может работать в таких системах, так как иногда приходится
запускать <code>VACUUM</code> для освобождения занятого последствиями работы команд
<code>UPDATE</code> и <code>DELETE</code> пространства и проводить статистический анализ,
необходимый для достижения максимальной производительности PostgreSQL.
Запускать <code>VACUUM</code> необходимо и после каждого добавления к таблице
нескольких столбцов. На напряженно работающих системах <code>VACUUM</code> нужно
запускать более часто, в худших случаях - по несколько раз в день. А
ведь во время работы <code>VACUUM</code> (а ее работа может продолжаться часы, если
база данных достаточно велика) база практически ``мертва''. Впрочем, в
PostgreSQL версии 7.2 выполнение основных функций этой программы
больше не приводит к блокировке базы, и пользователи могут продолжать
нормально работать с ней. Новая команда <code>VACUUM FULL</code> берется за дело
более серьезно: она, как и в старых версиях, блокирует таблицу и
сжимает копию таблицы на диске.

<LI>

Репликация MySQL отлично протестирована и используется в таких сайтах,
как:

<UL>
<LI>

Yahoo Finance (<a HREF="http://finance.yahoo.com/">http://finance.yahoo.com/</a>)
<LI>

Mobile.de (<a HREF="http://www.mobile.de/">http://www.mobile.de/</a>)
<LI>

Slashdot (<a HREF="http://www.slashdot.org/">http://www.slashdot.org/</a>)
</UL>

<LI>

В комплект поставки MySQL входят два тестовых пакета, <code>mysql-test-run</code> и
<code>crash-me</code> (<a HREF="http://www.mysql.com/information/crash-me.php">http://www.mysql.com/information/crash-me.php</a>), а также
пакет для замеров производительности. Тестовая система постоянно
обновляется, в нее добавляется код для тестирования всех новых
возможностей и почти всех воспроизводимых ошибок, которые попали в
поле нашего зрения. Перед выпуском каждой новой версии мы используем
эти пакеты для тестирования MySQL на нескольких платформах.
Наши тесты значительно превосходят по своим возможностям все
существующие в PostgreSQL аналоги, и обеспечивают высокое качество
кода MySQL.

<LI>

Книг о MySQL вышло значительно больше, нежели о PostgreSQL.
Книги о MySQL выпустили издательства O'Reilly, SAMS, Que и New Riders.
Все возможности MySQL детально описаны в документации, так как это
является обязательным условием включения новых возможностей в код.

<LI>

MySQL поддерживает больше стандартных функций ODBC, чем
<code>PostgreSQL</code>.

<LI>

MySQL обладает значительно более мощной реализацией <code>ALTER
TABLE</code>.

<LI>

В MySQL предусмотрена возможность создания таблиц без
транзакций, что необходимо приложениям, требующим максимально
возможной скорости работы. Эти таблицы могут храниться в памяти,
относиться к типу <code>HEAP</code>-таблиц или дисковых <code>MyISAM</code>. See section <A HREF="manual.ru.html#Table_types">7  Типы  таблиц MySQL</A>.

<LI>

MySQL может работать с двумя поддерживающими транзакции
обработчиками таблиц, а именно - <code>InnoDB</code> и <code>BerkeleyDB</code>. Так как все
системы поддержки транзакций в разных условиях работают по-разному,
это дает разработчику возможность найти наилучшее решение для условий,
в которых будет работать его система. See section <A HREF="manual.ru.html#Table_types">7  Типы  таблиц MySQL</A>.

<LI>

Команда слияния таблиц MERGE предоставляет в ваше распоряжение
уникальную возможность создать представление нескольких идентичных
таблиц и работать с ними как с одной. Это особенно удобно для работы с
журналами, разбитыми, например, по месяцам. See section <A HREF="manual.ru.html#MERGE">7.2  Таблицы <code>MERGE</code></A>.

<LI>

Возможность сжатия доступных только для чтения таблиц, не отменяющая
прямого доступа к их записям, повышает производительность системы,
снижая количество операций считывания с диска. Это особенно полезно
при архивировании. See section <A HREF="manual.ru.html#myisampack">4.7.4  <code>myisampack</code>, MySQL-генератор сжатых таблиц (только для чтения)</A>.

<LI>

В MySQL реализован полнотекстовый поиск. See section <A HREF="manual.ru.html#Fulltext_Search">6.8  Полнотекстовый поиск в MySQL</A>.

<LI>

Имеется возможность работы с несколькими базами через одно соединение
(разумеется, в зависимости от привилегий пользователя).

<LI>

Система MySQL с самого начала разрабатывалась в расчете на
многопоточность, а PostgreSQL использует процессы. Переключение
контекстов и доступ к общим данным несколькими потоками осуществляется
значительно быстрее, нежели отдельными процессами. Таким образом MySQL
Server в многопользовательских приложениях получает неплохое
преимущество в производительности, а кроме того, таким образом MySQL
Server удается значительно эффективней пользоваться преимуществами,
предоставляемыми симметричными мультипроцессорными системами (SMP).

<LI>

В MySQL реализована значительно более мощная система
привилегий, нежели в PostgreSQL. В то время как PostgreSQL
обеспечивает лишь привилегии <code>INSERT</code>, <code>SELECT</code> и <code>UPDATE</code>/<code>DELETE</code> над базой
или таблицей, MySQL предоставляет возможность определения
полного набора разнообразных привилегий на уровне базы, таблицы и
столбца. Кроме того, MySQL позволяет задавать привилегии для
комбинаций хост/пользователь. See section <A HREF="manual.ru.html#GRANT">4.3.1  Синтаксис команд <code>GRANT</code> и <code>REVOKE</code></A>.

<LI>

В MySQL используется протокол связи между клиентом и сервером
со сжатием данных, что увеличивает производительность системы в
условиях низкоскоростных каналов связи.

<LI>

Насколько нам известно, только в реляционной системе баз данных MySQL
Server используется концепция ``обработчика таблиц''. Благодаря этому
создается возможность работы с различными низкоуровневыми типами
таблиц из ядра MySQL, причем каждая таблица может быть оптимизирована
для различных характеристик производительности.

<LI>

Все типы таблиц в MySQL (кроме <code>InnoDB</code>) реализованы в виде файлов (по
одной таблице в файле), что значительно облегчает создание резервных
копий, перенос, удаление и даже создание символьных ссылок между
базами данных и таблицами, даже если сервер находится в нерабочем
состоянии.

<LI>

Наличие утилиты для восстановления и оптимизации таблиц <code>MyISAM</code>
(наиболее распространенного типа таблиц в MySQL). Ее использование
требуется только в случае физического повреждения файла данных
(например, в результате аппаратного сбоя). Позволяет восстановить
большую часть данных.

<LI>

Обновление (апгрейд) MySQL проходит совершенно ``безболезненно''. При
модернизации MySQL нет нужды в сохранении/восстановлении
данных, что приходится делать при установке большинства обновлений
PostgreSQL.
</UL>

<P>
Недостатки MySQL по сравнению с PostgreSQL:

</P>

<UL>
<LI>

Поддержка транзакций в MySQL пока что не настолько хорошо
проверена, как в системе PostgreSQL.

<LI>

Так как MySQL основан на использовании потоков (threads), пока
что еще не безошибочно работающих в некоторых ОС, для обеспечения
стабильной работы приходится либо использовать один из
откомпилированных пакетов, доступных по адресу
<a HREF="http://www.mysql.com/downloads/">http://www.mysql.com/downloads/</a>, либо точно выполнять содержащиеся в
section <A HREF="manual.ru.html#Installing_source">2.3  Установка исходного дистрибутива MySQL</A> инструкции.

<LI>

Блокировка таблиц, применяющаяся в нетранзакционных таблицах <code>MyISAM</code>,
во многих случаях работает быстрее, нежели блокировки на уровне
страниц, строк или контроль версий. Недостаток этого подхода в том,
что если не учитывать механизм работы блокирования таблиц, один
длительный запрос может надолго заблокировать таблицу. Обычно этого
эффекта можно избежать, приняв соответствующие меры при разработке
приложения. Если это не удастся, всегда можно изменить тип таблицы и
сделать ее транзакционной. See section <A HREF="manual.ru.html#Table_locking">5.3.2  Вопросы блокирования таблиц</A>.

<LI>

При помощи <code>UDF</code> (<code>user-defined functions</code>, определяемые пользователем
функции) возможности MySQL можно расширить и дополнить обычными
SQL-функциями или их объединениями. Но это сделать не так просто, да и
система не настолько гибка в этом отношении, как PostgreSQL. See section <A HREF="manual.ru.html#Adding_functions">9.2  Добавление новых функций в MySQL</A>.

<LI>

В MySQL сложнее организовывались обновления, затрагивающие
несколько таблиц сразу. Впрочем, это было исправлено в MySQL 4.0.2
реализацией многотабличного <code>UPDATE</code> и в MySQL 4.1 - с помощью
подзапросов. В MySQL 4.0 можно одновременно удалять данные из
нескольких таблиц. See section <A HREF="manual.ru.html#DELETE">6.4.6  Синтаксис оператора <code>DELETE</code></A>.
</UL>

<P>
Ниже перечислены преимущества PostgreSQL по сравнению с MySQL на
сегодняшний день.

</P>
<P>
Так как нам известен план разработки новых версий MySQL, мы включили в
приведенную ниже таблицу версии MySQL, в которых будет реализована
поддержка соответствующих возможностей. К сожалению, в сопоставлении мы
сделать этого не могли, так как план разработки PostgreSQL нам неизвестен.

</P>
<TABLE BORDER>
<TR><TD><strong>Возможность</strong> </TD><TD> <strong>Версия MySQL</strong>
</TD></TR>
<TR><TD>Подзапросы </TD><TD> 4.1
</TD></TR>
<TR><TD>Внешние ключи </TD><TD> 5.0 (3.23 с InnoDB)
</TD></TR>
<TR><TD>Представления </TD><TD> 5.0
</TD></TR>
<TR><TD>Хранимые процедуры </TD><TD> 5.0
</TD></TR>
<TR><TD>Триггеры </TD><TD> 5.0
</TD></TR>
<TR><TD>Объединения </TD><TD> 4.0
</TD></TR>
<TR><TD>Полные связи </TD><TD> 4.1
</TD></TR>
<TR><TD>Ограничения </TD><TD> 4.1 или 5.0
</TD></TR>
<TR><TD>Курсоры </TD><TD> 4.1 или 5.0
</TD></TR>
<TR><TD>R-деревья </TD><TD> 4.1 (для таблиц MyISAM)
</TD></TR>
<TR><TD>Наследование таблиц </TD><TD> Не планируется
</TD></TR>
<TR><TD>Расширяемая система типов </TD><TD> Не планируется
</TD></TR>
</TABLE>

<P>
Другие причины, по которым можно предпочесть PostgreSQL:

</P>

<UL>
<LI>

В некоторых случаях PostgreSQL оказывается ближе к ANSI SQL.

<LI>

Работу PostgreSQL можно ускорить, выполняя код в виде хранимых
процедур.

<LI>

При хранении географических данных R-деревья дают PostgreSQL
преимущество перед MySQL (примечание: в MySQL версии 4.1 для
таблиц <code>MyISAM</code> реализована поддержка R-деревьев).

<LI>

Оптимизатор PostgreSQL в некоторых случаях способен дать лучший в
сравнении с существующим на сегодняшний день оптимизатором MySQL
результат. Особенно это заметно при слиянии таблиц без соответствующих
ключей или при слиянии с использованием разных ключей в сочетании с
логическим оператором <code>OR</code>. Набор результатов тестов скорости MySQL,
расположенный по адресу
<a HREF="http://www.mysql.com/information/benchmarks.html">http://www.mysql.com/information/benchmarks.html</a> покажет, каких
конструкций следует избегать при работе с различными базами данных.

<LI>

Команда разработчиков PostgreSQL, пишущих код для сервера, больше.
</UL>

<P>
Недостатки PostgreSQL по сравнению с MySQL:

</P>

<UL>
<LI>

<code>VACUUM</code> затрудняет использование PostgreSQL в постоянно работающих
системах.

<LI>

Наличие только транзакционных таблиц.

<LI>

Значительно более медленная работа команд <code>INSERT</code>, <code>DELETE</code> и <code>UPDATE</code>.
</UL>

<P>
Полный список недостатков приведен в первой таблице настоящего раздела.

</P>


<H4><A NAME="MySQL-PostgreSQL_benchmarks" HREF="manual.ru_toc.html#MySQL-PostgreSQL_benchmarks">1.11.2.3  Тестирование скорости работы MySQL и PostgreSQL</A></H4>

<P>
<A NAME="IDX169"></A>

</P>
<P>
Единственная тестовая система с открытым кодом, способная тестировать
скорость работы как MySQL  Server, так и PostgreSQL (а также других СУБД),
о существовании которой нам известно, - наша собственная разработка. Ее
можно найти по адресу <a HREF="http://www.mysql.com/information/benchmarks.html">http://www.mysql.com/information/benchmarks.html</a>.

</P>
<P>
Мы много раз просили разработчиков PostgreSQL и некоторых пользователей
PostgreSQL помочь нам расширить эту систему и превратить ее в совершенный
инструмент тестирования скорости работы СУБД, но, к сожалению,
безрезультатно.

</P>
<P>
По этой причине разработчики MySQL потратили много времени, пытаясь выжать
(для тестирования) из PostgreSQL все возможное, но из-за недостаточно
совершенного знания PostgreSQL мы наверняка что-то упустили. На страничке
тестов производительности проведенное нами исследование полностью
задокументировано, так что любой может легко повторить его и проверить
результаты.

</P>
<P>
Обычно тесты запускаются без ключа <code>--fast</code>. При запуске с этим ключом
используются все трюки, позволяющие заставить сервер работать как можно
быстрее. Идея состоит в том, чтобы в обычном режиме тест показал, как
сервер будет работать при настройках по умолчанию, в режиме <code>--fast</code>, - как
производительность изменится, если разработчик приложения воспользуется
расширениями сервера для ускорения его работы.

</P>
<P>
При тестировании PostgreSQL в режиме <code>--fast</code> мы запускаем <code>VACUUM</code> после
каждой операции <code>UPDATE</code> и <code>DROP TABLE</code>, чтобы обеспечить отличное состояние
базы для последующих операторов <code>SELECT</code>. Время, уходящее на работу <code>VACUUM</code>,
измеряется отдельно.

</P>
<P>
Однако при тестировании PostgreSQL 7.1.1 мы не смогли запустить программу
в режиме <code>--fast</code>, так как во время теста <code>INSERT</code>, <code>postmaster</code> (демон
PostgreSQL) дал сбой и база данных была повреждена настолько, что
перезапустить демон не удалось. Когда это случилось дважды, мы решили
отложить тестирование в режиме <code>--fast</code> до выхода следующей версии
PostgreSQL. Подробную информацию о компьютере, на котором выполнялись
тесты, вы найдете на странице тестов.

</P>
<P>
Перед тем как переходить к описанию других известных нам тестов, мы дадим
побольше информации о таких тестах вообще.

</P>
<P>
Нет ничего проще, чем написать тест, доказывающий, что любая СУБД является
лучшей в мире, для этого достаточно ограничиться измерением результатов
операций, с которыми эта СУБД справляется хорошо, и деликатно забыть об
остальных. А если еще после этого выдать обобщенный график, то все
становится еще проще.

</P>
<P>
Это то же самое, если бы мы решили сравнить скорость работы MySQL  Server
и PostgreSQL просто сравнив общие результаты тестов MySQL, приведенных на
нашей странице. По таким результатам MySQL  Server оказался бы более чем в
40 раз быстрее PostgreSQL, а это, конечно, неверно. Можно было бы подлить
масла в огонь, избрав для тестирования PostgreSQL тесты, на которые эта
система тратит больше всего времени, - и утверждать что MySQL  Server
более чем в 2000 раз быстрее PostgreSQL.

</P>
<P>
Дело тут в том, что MySQL оптимизирует многое из того, чего не
оптимизирует PostgreSQL. И наоборот. SQL-оптимизатор вообще очень сложная
штука, и можно потратить годы исключительно на его улучшение.

</P>
<P>
Исследуя результаты тестов, нужно искать задачи, которые должно выполнять
ваше приложение, и результаты их выполнения использовать для принятия
решения о выборе СУБД. Результаты тестов позволяют определить и задачи, с
решением которых выбранная СУБД справляется не слишком хорошо, - таким
образом можно определить, чего следует избегать и обходить в своих
программах.

</P>
<P>
Нам известно о двух тестах, утверждающих, что PostgreSQL по
производительности превосходит MySQL  Server. Оба они -
многопользовательские, а у сотрудников MySQL  AB пока что не нашлось
времени написать такой тест. Основная причина - довольно сложно сделать
это так, чтобы не поставить ни одну из СУБД в заведомо проигрышное
положение.

</P>
<P>
Один из этих тестов был заказан компанией Great Bridge, которая в течение
16 месяцев пыталась построить бизнес на основе PostgreSQL, но в конце
концов прекратила свою деятельность. Вероятно, это худший из когда-либо
проводившихся кем-либо тестов. Он не только принимает во внимание лишь те
области, в которых PostgreSQL оказывается ``на коне'', но и ставит
абсолютно все остальные СУБД в заведомо проигрышное положение.

</P>
<P>
<strong>Примечание</strong>: Нам стало известно о том, что даже некоторым ключевым
разработчикам PostgreSQL отнюдь не понравилось то, как фирма Great  Bridge
проводила свое тестирование, так что команду разработчиков PostgreSQL мы в
связи с этим тестом ни в чем не обвиняем.

</P>
<P>
Упомянутый тест осуждался во многих сообщениях и телеконференциях, так что
мы просто коротко перечислим его недостатки.

</P>

<UL>
<LI>

Тесты выполнялись дорогой коммерческой программой, что сделало задачу
проверки их результатов невыполнимой для <code>Open Source</code>-компании,
каковой мы являемся; мы даже не можем выяснить, как же на самом деле
проводились эти тесты. Причем сама программа, даже не является
специализированной утилитой для тестирования производительности - она
представляет из себя универсальный инструмент для настройки и
тестирования приложений. Называть ее ``стандартным'' тестом - это уж
слишком большая натяжка.

<LI>

Компания Great Bridge признала, что база данных PostgreSQL была
оптимизирована (а перед проведением теста была запущена программа
<code>VACUUM</code>) и специально настроена для проведения тестов, чего не делалось
ни для одной другой СУБД, участвовавшей в тестировании. Они заявили
буквально следующее: ``Этот процесс оптимизирует индексы и
высвобождает немного дискового пространства. Оптимизированные индексы
в некоторой степени повышают производительность.'' Проведенные нами
тесты недвусмысленно свидетельствуют о том, что разница в скорости
выполнения большого количества выборок (SELECT'ов) из базы данных,
прошедшей чистку <code>VACUUM</code>, и не прошедшей ее, может быть десятикратной.

<LI>

Результаты тестов тоже вызывают сомнения. В тестовой документации
<code>AS3AP</code> упоминается о том, что при тестировании выполняются ``выборки,
простые связи, проекции, аггрегация, обновления с одним набором
значений для атрибута и массовые обновления''.

PostgreSQL отлично выполняет операции <code>SELECT</code> и <code>JOIN</code> (особенно после
<code>VACUUM</code>), но отнюдь не здорово справляется с <code>INSERT</code> или <code>UPDATE</code>. А
результаты показывают, что выполнялись только операции <code>SELECT</code> (или
операций обновления выполнялось очень мало). Это правдоподобно объясняет
отличные результаты, показанные PostgreSQL в данном тесте. А причина, по
которой MySQL показал неважные результаты, станет понятной несколько ниже.

<LI>

Так называемый тест запускался с компьютера, работающего под
управлением Windows и связывавшегося с Linux через ODBC, а такая
конфигурация никакому нормальному пользователю СУБД, особенно при
работе с многопользовательским приложением, даже в голову не придет. В
этом случае тестируется не СУБД, а ODBC-драйвер и Windows-протокол,
связывающие клиентов.

<LI>

При связи базы с Oracle и MS-SQL (Great  Bridge косвенно указала на
примененные в тесте СУБД) использовался не соответствующий им
протокол, а ODBC. Любой, кто когда-либо имел дело с Oracle, знает, что
во всех настоящих приложениях используется не ODBC, а ``родной''
интерфейс. Проводить тесты через ODBC и утверждать, что они имеют
какое-либо отношение к использованию СУБД в реальной работе, попросту
нечестно. Нужно было провести два теста, с ODBC и без него, чтобы
получить истинные факты (причем все СУБД перед проведением тестов
должны были бы настраиваться специалистами).

<LI>

Представители компании постоянно говорят о TPC-C тестах, но нигде не
упоминают о том, что проведенный ими тест вовсе не относился к TPC-C,
а проводить TPC-C они просто не имели права. TPC-C может проводиться
только по правилам, утвержденным комитетом TPC Council
(<a HREF="http://www.tpc.org/">http://www.tpc.org/</a>). Great Bridge в комитет не обращалась. Не
сделав этого, она не только вступила в конфликт с торговой маркой TPC,
но и дискредитировала свои тесты. Установленные комитетом TPC  Council
правила очень строги, чтобы никто не мог выдавать ложных результатов
или делать недоказуемые заявления. Очевидно, у Great  Bridge не было
желания следовать этим правилам.

<LI>

После проведения первого теста мы связались с Great  Bridge и сообщили
ее представителям о наиболее очевидных из допущенных при тестировании
MySQL  Server ошибок:


<UL>
<LI>

Использование отладочной версии нашего ODBC-драйвера

<LI>

Запуск сервера под управлением ОС Linux, не оптимизированной для
работы с потоками.

<LI>

Использование старой версии MySQL, хотя уже существовала более
современная

<LI>

Отказ от запуска MySQL  Server с соответствующими настройками для
работы с большим количеством пользователей (по умолчанию после
установки MySQL  Server настраивается для минимального использования
ресурсов)
</UL>

Great  Bridge провела новый тест, с нашим оптимизированным драйвером ODBC
и лучшей настройкой MySQL  Server, но отказалась применить обновленную 
библиотеку <code>glibc</code> или нашу стандартную бинарную поставку (ее используют 80%
наших пользователей), которая была статически слинкована с конкретной
glibc. Насколько нам известно, компания Great  Bridge не сделала абсолютно
ничего для правильной настройки других СУБД при тестировании. Впрочем, мы
уверены, что в Oracle или Microsoft они за советом не обращались. ;)

<LI>

Тестирование было оплачено Great  Bridge, и эта компания решила
опубликовать не все результаты, а только выборочно - те, что были ей
выгодны.
</UL>

<P>
Тим Пердью (Tim  Perdue), преданный обожатель PostgreSQL и не слишком
большой любитель MySQL, опубликовал свое сравнение на сайте PHPbuilder
(<a HREF="http://www.phpbuilder.com/columns/tim20001112.php3">http://www.phpbuilder.com/columns/tim20001112.php3</a>).

</P>
<P>
Узнав об этом, мы связались с Тимом по телефону с тем, чтобы обсудить
некоторые странности в полученных им результатах. Он, например, утверждал,
что MySQL  Server в его тестах с трудом справлялся с обслуживанием пяти
пользователей, хотя нам были известны пользователи с примерно такими же,
как у Тима, компьютерами, работающие с MySQL  Server при 2000 активных
соединениях, выдающих до 400 запросов в секунду (причем в данном случае
производительность ограничивалась каналом связи с web, а не базой данных).

</P>
<P>
Похоже было, что Тим работал с ядром Linux, не умеющим нормально
обрабатывать большое количество потоков, как, например, ядра до версии
2.4, у которых возникали серьезные проблемы с обработкой большого
количества потоков на мультипроцессорных компьютерах. В настоящем
руководстве мы описали решение этой проблемы, и Тим должен был об этом
знать.

</P>
<P>
Существует еще одна возможная причина возникновения проблем: Тим мог
воспользоваться старой библиотекой <code>glibc</code> или не загрузить
откомпилированный исполняемый файл MySQL (слинкованный с исправленной
библиотекой <code>glibc</code>) с нашего сайта, но скомпилировал его сам. В любом из
этих случаев симптомы были бы именно такими, как описал Тим.

</P>
<P>
Мы спросили Тима, может ли он предоставить нам его данные с тем, чтобы мы
могли повторить тест, а также попросили его проверить свою версию MySQL и
сообщить нам. Пока что он этого не сделал.

</P>
<P>
Из за этого его тесту мы тоже не можем доверять. :(

</P>
<P>
Все течет, все изменяется, и старые тесты теряют актуальность. Теперь
MySQL обзавелся парой новых обработчиков таблиц, которые
обеспечивают совершенно разные характеристики в разрезе
скорости/параллелизма. See section <A HREF="manual.ru.html#Table_types">7  Типы  таблиц MySQL</A>. Было бы интересно
узнать, какие результаты показали бы вышеупомянутые тесты с разными типами
транзакционных таблиц в MySQL. Конечно, в PostgreSQL с тех пор тоже
появились новые возможности. Так как эти тесты недоступны общественности,
выяснить, как СУБД показала бы себя в них сегодня, мы не можем.

</P>
<P>
Заключение:

</P>
<P>
Единственные существующие на сегодня тесты, позволяющие сравнить MySQL 
Server и PostgreSQL, которые любой может загрузить и запустить, - это
тесты из комплекта MySQL. Мы, сотрудники MySQL  AB, считаем, что Open 
Source-СУБД должны тестироваться при помощи Open  Source-инструментов!
Только так можно получить гарантии того, что никто не сможет провести
невоспроизводимые тесты и на основе их результатов утверждать, что одна
СУБД лучше другой. Не зная всех фактов, подтвердить или опровергнуть
подобные утверждения просто невозможно.

</P>
<P>
Нам кажется странным, что невоспроизводимые тесты с участием PostgreSQL
показывают преимущество этой системы, в то время как наши тесты, которые
может повторить любой, четко доказывают обратное. Этим мы вовсе не хотим
сказать, что PostgreSQL не годится для решения многих задач (еще как
годится!) или что при определенных условиях эта система не обгонит MySQL 
Server. Но нам просто хотелось бы для разнообразия увидеть честный тест, в
котором PostgreSQL покажет отличные результаты, - исключительно с целью
поддержания товарищеской конкуренции!

</P>
<P>
Дополнительную информацию о нашей тестовой системе вы можете получить из
раздела section <A HREF="manual.ru.html#MySQL_Benchmarks">5.1.4  Набор тестов MySQL (The MySQL Benchmark Suite)</A>.

</P>
<P>
Мы занимаемся разработкой еще лучшего комплекса тестов, в состав которого
будут включены многопользовательские тесты, а также более подробное
описание того, что собственно делает каждый отдельный тест и как расширить
комплекс.


<H1><A NAME="Installing" HREF="manual.ru_toc.html#Installing">2  Установка MySQL</A></H1>

<P>
<A NAME="IDX170"></A>
<A NAME="IDX171"></A>

</P>

<P>
В этом разделе описаны получение и установка MySQL:

</P>

<UL>
<LI>

Список сайтов, с которых можно получить MySQL, See section <A HREF="manual.ru.html#Getting_MySQL">2.2.1  Как получить MySQL</A>.
<LI>

Чтобы узнать о поддерживаемых платформах, See section <A HREF="manual.ru.html#Which_OS">2.2.5  Операционные системы, поддерживаемые MySQL</A>. Необходимо иметь в виду, что не все поддерживаемые
системы одинаково хорошо подходят для запуска MySQL: одни из них
гораздо устойчивее и эффективнее, чем другие (за более подробной
информацией следует обращаться к разделу section <A HREF="manual.ru.html#Which_OS">2.2.5  Операционные системы, поддерживаемые MySQL</A>).
<LI>

Некоторые версии MySQL доступны как в виде бинарного дистрибутива, так
и в виде дистрибутива исходного кода. Помимо этого, всем, кто желает
ознакомиться с нашими последними разработками и помочь нам тестировать
новый код, мы обеспечиваем открытый доступ к нашему текущему дереву
исходных кодов. Чтобы определить, какую версию и тип дистрибутива вам
следует использовать, See section <A HREF="manual.ru.html#Which_version">2.2.6  Какую версию MySQL использовать</A>. Если вы сомневаетесь в том, какую
версию выбрать, лучше предпочесть бинарный дистрибутив.
<LI>

Инструкции по установке для бинарного дистрибутива и для дистрибутива
исходного кода находятся в разделах section <A HREF="manual.ru.html#Installing_binary">2.2.10  Установка бинарного дистрибутива MySQL</A> и See section <A HREF="manual.ru.html#Installing_source">2.3  Установка исходного дистрибутива MySQL</A>. В каждый набор инструкций
включен раздел с описанием специфичных для различных операционных
систем проблем, с которыми вы можете столкнуться.
<LI>

Чтобы ознакомиться с послеустановочными процедурами, See section <A HREF="manual.ru.html#Post-installation">2.4  Послеустановочные настройка и тестирование</A>. Эти
действия применимы при установке MySQL с использованием как бинарного
дистрибутива, так и дистрибутива исходного кода.
</UL>



<H2><A NAME="Quick_Standard_Installation" HREF="manual.ru_toc.html#Quick_Standard_Installation">2.1  Быстрая стандартная установка MySQL</A></H2>



<H3><A NAME="Linux-RPM" HREF="manual.ru_toc.html#Linux-RPM">2.1.1  Установка MySQL на Linux</A></H3>

<P>
<A NAME="IDX172"></A>
<A NAME="IDX173"></A>
<A NAME="IDX174"></A>

</P>
<P>
Для установки MySQL на Linux рекомендуется применять пакеты RPM. В
настоящее время RPM для MySQL создаются на операционной системе SuSE Linux 7.3,
но они должны работать также и для других версий Linux,
которые поддерживают <code>rpm</code> и используют <code>glibc</code>.

</P>
<P>
В случае возникновения проблем с файлом RPM (например, если вы получили
ошибку ``<code>Sorry, the host 'xxxx' could not be looked up</code>''), обращайтесь к
разделу See section <A HREF="manual.ru.html#Binary_notes-Linux">2.6.1.1  Примечания к бинарным дистрибутивам Linux</A>.

</P>
<P>
Доступны для использования следующие RPM-файлы:

</P>

<UL>
<LI><code>MySQL-server-VERSION.i386.rpm</code>.

Сервер MySQL. Если вам нужно только подключаться к серверу MySQL, запущенному
на другом компьютере, этот файл не требуется. Обратите внимание, что выхода
4.0.10 этот пакет назывался <code>MySQL-VERSION.i386.RPM</code>.

<LI><code>MySQL-client-VERSION.i386.rpm</code>.

Стандартные клиентские программы MySQL.
Установка этого пакета требуется всегда.

<LI><code>MySQL-bench-VERSION.i386.rpm</code>.

Тесты и контрольные задачи. Для файла
требуется наличие модулей Perl и msql-mysql-modules.

<LI><code>MySQL-devel-VERSION.i386.rpm</code>.

Библиотеки и включаемые файлы,
необходимые для компилирования других клиентов MySQL, таких как модули
Perl.

<LI><code>MySQL-shared-VERSION.i386.rpm</code>

Этот пакет содержит динамические библиотеки (<code>libmysqlclient.so*</code>), 
нужные для некоторых языков программирования или приложений для того, чтобы
работать с MySQL.

<LI><code>MySQL-embedded-VERSION.i386.rpm</code>

Встраиваемая библиотека сервера MySQL (MySQL 4.x и более новые).

<LI><code>MySQL-VERSION.src.rpm</code>.

Этот файл содержит исходный код для всех
предыдущих пакетов. Файл также можно использовать для создания файлов
RPM для других архитектур (например Alpha или SPARC).
</UL>

<P>
Для просмотра всех файлов в пакете RPM выполните команду:

</P>

<PRE>
shell&#62; rpm -qpl MySQL-VERSION.i386.rpm
</PRE>

<P>
Для выполнения стандартной минимальной установки запустите команду:

</P>

<PRE>
shell&#62; rpm -i MySQL-server-VERSION.i386.rpm MySQL-client-VERSION.i386.rpm
</PRE>

<P>
Для установки только клиентского пакета выполните команду:

</P>

<PRE>
shell&#62; rpm -i MySQL-client-VERSION.i386.rpm
</PRE>

<P>
RPM помещает данные в <tt>`/var/lib/mysql'</tt> и создает соответствующие вхождения
в <tt>`/etc/init.d/'</tt> для автоматического запуска сервера во время начальной
загрузки (в случае, если у вас имеется предыдущая инсталляция, можно
создать копию ранее установленного файла запуска MySQL, чтобы изменения в
нем не были утеряны.)

</P>
<P>
Если вы хотите установить MySQL RPM на старших версиях Linux, которые не поддерживают
init-скрипты в <tt>`/etc/init.d'</tt> (непосредственно или посредством символической ссылки),
вам следует создать символическую ссылку на старое расположение перед тем, как устанавливать 
RPM: 

</P>

<PRE>
shell&#62; cd /etc ; ln -s rc.d/init.d .
</PRE>

<P>
Однако, все современные поставки Linux должны поддерживать эту схему каталогов, т.к. 
это требование стандарта LSB (Linux Standard Base). 

</P>
<P>
После установки RPM, <code>mysqld</code> должен заработать и вы можете сразу приступать к
использованию MySQL.

</P>

<P>
See section <A HREF="manual.ru.html#Post-installation">2.4  Послеустановочные настройка и тестирование</A>.

</P>
<P>
Если при установке возникнут проблемы, то за более подробной информацией
следует обращаться к главе, в которой описывается установка из бинарного
дистрибутива. See section <A HREF="manual.ru.html#Installing_binary">2.2.10  Установка бинарного дистрибутива MySQL</A>.

</P>


<H3><A NAME="Windows_installation" HREF="manual.ru_toc.html#Windows_installation">2.1.2  Установка MySQL на Windows</A></H3>

<P>
Имеются два следующих типа дистрибутивов сервера MySQL для Windows:

</P>

<OL>
<LI>

Бинарный дистрибутив, в состав которого входит программа установки;
она устанавливает все, что нужно, так что можно сразу же запускать
сервер.
<LI>

Дистрибутив исходного кода, в котором содержится весь код и файлы
поддержки для создания исполняемых файлов с использованием компилятора
VC++ 6.0. See section <A HREF="manual.ru.html#Windows_source_build">2.3.7  Дистрибутив исходного кода для Windows</A>.
</OL>

<P>
В общем случае следует отдавать предпочтение бинарному дистрибутиву.

</P>
<P>
Вам потребуется:

<UL>
<LI>

32-разрядная операционная система Windows, такая как 9x, Me, NT, 2000
или XP. Под управлением семейства NT (NT, Windows 2000 и XP) сервер
MySQL можно запускать как сервис. See section <A HREF="manual.ru.html#NT_start">2.6.2.2  Запуск MySQL на Windows NT, 2000 или XP</A>. Если предполагается работать с таблицами
размером более 4 Гб, необходимо установить MySQL на файловую систему
NTFS или более новую. При создании таблиц не забывайте использовать
<code>MAX_ROWS</code> и <code>AVG_ROW_LENGTH</code>. See section <A HREF="manual.ru.html#CREATE_TABLE">6.5.3  Синтаксис оператора <code>CREATE TABLE</code></A>.
<LI>

Поддержка протокола TCP/IP.
<LI>

Копия бинарного кода MySQL или дистрибутив для Windows, который может
быть загружен с <a HREF="http://www.mysql.com/downloads/">http://www.mysql.com/downloads/</a>.

Примечание:
дистрибутив поставляется в виде архивных файлов, сжатых архиватором
ZIP. Во избежание повреждения файлов в процессе загрузки мы
рекомендуем использовать адекватный клиент FTP с возможностью
возобновления загрузки.
<LI>

Архиватор <code>ZIP</code> для распаковки файла дистрибутива.
<LI>

Достаточно места на жестком диске для распаковки, установки и создания
баз данных в соответствии с вашими требованиями.
<LI>

Если вы планируете подключаться к серверу MySQL через <code>ODBC</code>, то
понадобится драйвер <code>MyODBC</code>. See section <A HREF="manual.ru.html#ODBC">8.3  Поддержка ODBC в MySQL</A>.
</UL>



<H4><A NAME="Windows_binary_installation" HREF="manual.ru_toc.html#Windows_binary_installation">2.1.2.1  Установка бинарного кода</A></H4>


<OL>
<LI>

Если вы работаете на сервере NT/2000/XP, войдите в систему как
пользователь с привилегиями администратора.
<LI>

Если вы производите модернизацию более ранней установки MySQL, то
необходимо остановить сервер. Если сервер работает как сервис, то
применяйте следующую команду:


<PRE>
C:\&#62; NET STOP MySQL
</PRE>

В остальных случаях используйте:


<PRE>
C:\mysql\bin&#62; mysqladmin -u root shutdown
</PRE>

<LI>

Если вы хотите изменить исполняемый файл сервера (т.е. -max или -nt),
необходимо также удалить сервис:


<PRE>
C:\mysql\bin&#62; mysqld-max-nt --remove
</PRE>

<LI>

Разархивируйте файл дистрибутива во временном каталоге.
<LI>

Запустите файл <tt>`setup.exe'</tt>, чтобы начать процесс установки. Если вы
хотите установить программу в иной каталог, чем заданный по умолчанию
<tt>`c:\mysql'</tt>, то используйте кнопку <code>Browse</code> для указания выбранного вами
каталога.
<LI>

Завершите процесс установки.
</OL>



<H4><A NAME="Windows_prepare_environment" HREF="manual.ru_toc.html#Windows_prepare_environment">2.1.2.2  Подготовка конфигурации MySQL для Windows</A></H4>

<P>
Начиная с версии MySQL 3.23.38, дистрибутив для Windows включает в себя
как обычный бинарный код, так и бинарный код сервера <code>MySQL-Max</code>. Ниже
приводится список различных серверов MySQL, которые можно использовать:

</P>
<TABLE BORDER>
<TR><TD><strong>Бинарный код</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD><code>mysqld</code> </TD><TD> Скомпилирован с полным набором возможностей отладки и автоматической проверки выделения памяти, символических ссылок, таблиц InnoDB и BDB.
</TD></TR>
<TR><TD><code>mysqld-opt</code> </TD><TD> Оптимизированный бинарный код без поддержки транзакционных таблиц.
</TD></TR>
<TR><TD><code>mysqld-nt</code> </TD><TD> Оптимизированный бинарный код для NT/2000/XP с поддержкой именованных каналов. Можно запустить эту версию на Windows 9x/Me, но в этом случае не создаются именованные каналы и необходимо иметь установленный протокол TCP/IP.
</TD></TR>
<TR><TD><code>mysqld-max</code> </TD><TD> Оптимизированный бинарный код с поддержкой символических ссылок и таблиц InnoDB и BDB.
</TD></TR>
<TR><TD><code>mysqld-max-nt</code> </TD><TD> Подобен <code>mysqld-max</code>, но скомпилирован с поддержкой именованных каналов.
</TD></TR>
</TABLE>

<P>
Начиная с версии 3.23.50, именованные каналы доступны только при запуске
mysqld с <code>--enable-named-pipe</code>.

</P>
<P>
Все бинарные коды оптимизированы под процессор Pentium Pro, но должны
работать на любом процессоре Intel &#62;= i386.

</P>
<P>
При следующих обстоятельствах для того чтобы задать вашу конфигурацию
MySQL будет необходимо использовать файл опций:

<UL>
<LI>

Если каталоги установки или данных отличаются от заданных по умолчанию
местоположений (<tt>`c:\mysql'</tt> и <tt>`c:\mysql\data'</tt>).
<LI>

Если вы хотите использовать один из следующих серверов:

<UL>
<LI>mysqld.exe

<LI>mysqld-max.exe

<LI>mysqld-max-nt.exe

</UL>

<LI>

Если вам требуется выполнить настройку установочных параметров
сервера.
</UL>

<P>
Обычно для редактирования файла опций <tt>`my.ini'</tt> можно использовать инструмент
<code>WinMySQLAdmin</code>. В этом случае остальную часть данного раздела вы можете
пропустить.

</P>
<P>
Существует два файла опций с одинаковыми функциями: <tt>`my.cnf'</tt> и <tt>`my.ini'</tt>.
Однако во избежание недоразумений лучше всего использовать только один из
них. Оба файла представляют собой простой текст. Если вы собираетесь
использовать файл <tt>`my.cnf'</tt>, то его следует создать в корневом каталоге
диска C, если <tt>`my.ini'</tt> - то в системном каталоге Windows (это обычно
что-либо вроде <tt>`C:\WINDOWS'</tt> или <tt>`C:\WINNT'</tt>; его точное местоположение
можно определить по значению переменной окружения <code>windir</code>). MySQL сначала
ищет файл <tt>`my.ini'</tt>, а затем <tt>`my.cnf'</tt>.

</P>
<P>
Если на вашем компьютере используется начальный загрузчик, в котором диск
C не является загрузочным диском, то следует работать только с файлом
<tt>`my.ini'</tt>. Инструментальная программа <code>WinMySQLAdmin</code>, если она у вас
применяется, также использует только файл <tt>`my.ini'</tt> (файл помощи с
инструкциями по использованию этого инструмента находится в каталоге
<tt>`\mysql\bin'</tt>).

</P>
<P>
Используя <code>notepad.exe</code>, создайте файл опций и отредактируйте раздел
<code>[mysqld]</code>, указав значения параметров <code>basedir</code> и <code>datadir</code>:

<PRE>
[mysqld]
# set basedir to installation path, e.g., c:/mysql
basedir=the_install_path
# set datadir to location of data directory,
# e.g., c:/mysql/data or d:/mydata/data
datadir=the_data_path
</PRE>

<P>
Следует учитывать, что в Windows имена путей должны указываться в файле
опций с использованием предпочтительно прямых слешей, а не обратных. Если
вы применяете обратные слеши, то их необходимо дублировать.

</P>
<P>
Чтобы использовать каталог данных, отличный от заданного по умолчанию
<tt>`c:\mysql\data'</tt>, необходимо скопировать все содержимое каталога
<tt>`c:\mysql\data'</tt> в новое местоположение.

</P>
<P>
Если вы хотите работать с транзакционными таблицами <code>InnoDB</code>, то необходимо
вручную создать два новых каталога для хранения данных таблиц <code>InnoDB</code> и
журнальных файлов - т.е. <tt>`c:\ibdata'</tt> и <tt>`c:\iblogs'</tt>. Помимо этого
потребуется добавить несколько дополнительных строк в файле опций. См.
раздел See section <A HREF="manual.ru.html#InnoDB_start">7.5.2  Параметры запуска InnoDB</A>.

</P>
<P>
Если же работу с таблицами <code>InnoDB</code> вы не планируете, следует в файле опций
добавьте опцию <code>skip-innodb</code>.

</P>
<P>
Теперь вы готовы тестировать запуск сервера.

</P>


<H4><A NAME="Windows_server_first_start" HREF="manual.ru_toc.html#Windows_server_first_start">2.1.2.3  Первый запуск сервера</A></H4>

<P>
Тестирование лучше всего производить из окна оболочки DOS, поскольку
сообщения о состоянии, которые выводит сервер, появляются в окне DOS. Если
с вашей конфигурацией что-нибудь не так, то при помощи этих сообщений
будет легче идентифицировать и устранить любые проблемы.

</P>
<P>
Убедитесь, что находитесь в каталоге, где расположен сервер, затем введите
следующую команду:

</P>

<PRE>
C:\mysql\bin&#62; mysqld-max --standalone
</PRE>

<P>
При запуске сервера вы должны увидеть следующие сообщения:

</P>

<PRE>
InnoDB: The first specified datafile c:\ibdata\ibdata1 did not exist:
InnoDB: a new database to be created!
InnoDB: Setting file c:\ibdata\ibdata1 size to 209715200
InnoDB: Database physically writes the file full: wait...
InnoDB: Log file c:\iblogs\ib_logfile0 did not exist: new to be created
InnoDB: Setting log file c:\iblogs\ib_logfile0 size to 31457280
InnoDB: Log file c:\iblogs\ib_logfile1 did not exist: new to be created
InnoDB: Setting log file c:\iblogs\ib_logfile1 size to 31457280
InnoDB: Log file c:\iblogs\ib_logfile2 did not exist: new to be created
InnoDB: Setting log file c:\iblogs\ib_logfile2 size to 31457280
InnoDB: Doublewrite buffer not found: creating new
InnoDB: Doublewrite buffer created
InnoDB: creating foreign key constraint system tables
InnoDB: foreign key constraint system tables created
011024 10:58:25 InnoDB: Started
</PRE>

<P>
Чтобы получить дальнейшую информацию о работе MySQL под Windows,
обращайтесь к разделу See section <A HREF="manual.ru.html#Windows">2.6.2  Примечания к Windows</A>.

</P>



<H3><A NAME="Mac_OS_X_installation" HREF="manual.ru_toc.html#Mac_OS_X_installation">2.1.3  Установка MySQL на MacOS X</A></H3>

<P>
<A NAME="IDX175"></A>
<A NAME="IDX176"></A>

</P>
<P>
Начиная с MySQL 4.0.11, вы можете поставить MySQL на Mac OS X 10.2 ("Jaguar") используя
родной формат пакетов <code>PKG</code> вместо бинарного tar-архива. Обратите внимание, что
более старые версии Mac OS X (скажем, 10.1.x) не поддерживаются этим пакетом. 

</P>
<P>
Пакет находится внутри файла образа диска (<code>.dmg</code>), который вам сначала
следует смонтировать двойным щелчком мышки на его иконке в Finder. Образ должен
быть смонтирован и вы увидите его содержимое. 

</P>
<P>
<strong>Внимание</strong>: Перед тем как продолжить инсталляцию, убедитесь, что другие сервера 
MySQL не работают на этом компьютере!

</P>
<P>
Пожалуйста, остановите все запущенные копии MySQL перед тем, как продолжать. Для этого используйте
или приложение MySQL Manager (на Mac OS X Server) или с помощью
<code>mysqladmin shutdown</code> в командной строке.

</P>
<P>
Для того чтобы поставить MySQL PKG, дважды щелкните мышкой на иконке пакета. Это действие
запустит инсталлятор пакетов Mac OS, который и проведет вас через процесс установки MySQL. 

</P>
<P>
Пакет поставит себя в 
<tt>`/usr/local/mysql-&#60;версия&#62;'</tt> и также поставит символическую ссылку 
<tt>`/usr/local/mysql'</tt>, указывающую на новое месторасположение. Если каталог с именем
<tt>`/usr/local/mysql'</tt> уже существует, он будет вначале переименован в 
<tt>`/usr/local/mysql.bak'</tt>. Кроме того, будут установлены таблицы привилегий MySQL путем
выполнения <code>mysql_install_db</code> после инсталляции.

</P>
<P>
Схема инсталляции похожа на ту, которая используется в бинарной поставке: все
исполняемые файлы MySQL будут расположены по пути <tt>`/usr/local/mysql/bin'</tt>,
сокет будет расположен в <tt>`/etc/mysql.sock'</tt>.  See section <A HREF="manual.ru.html#Installation_layouts">2.2.7  Схемы установки</A>.

</P>
<P>
Необходимо чтобы существовал пользователь с именем <code>mysql</code> (который должен существовать 
по умолчанию в каждой поставке Mac OS X 10.2 и выше).

</P>
<P>
Если вы используете Mac OS X Server, у вас уже есть работающая копия MySQL: 

</P>

<UL>
<LI>

Mac OS X Server 10.2-10.2.2 идет с MySQL 3.23.51 в поставке
<LI>

Mac OS X Server 10.2.3 и 10.2.4 поставляется с MySQL 3.23.53
</UL>

<P>
Этот раздел руководства покрывает вопросы инсталляции только  официального
пакета PKG для Mac OS X.  Сначала прочитайте руководство Apple по установке
MySQL, пожалуйста (запустите приложение "Help View", выберите "Mac OS X
Server", сделайте поиск слова "MySQL" и прочитайте раздел под названием
"Installing MySQL"). 

</P>
<P>
Учтите, что преинсталлированные пакеты MySQL на Mac OS X Server запускаются с
помощью команды <code>safe_mysqld</code> вместо <code>mysqld_safe</code>!

</P>
<P>
Если вы ранее использовали пакеты MySQL Марка Лиянажа (Marc Liyanage) с сайта
<a HREF="http://www.entropy.ch">http://www.entropy.ch</a>, вы можете просто следовать инструкциям по
обновлению пакетов используя схему расположения, как указано на его страничках. 

</P>
<P>
Если вы обновляете MySQL с версии, собранной Марком или с предустановленной
версии из поставки Mac OS X Server, на официальную сборку от MySQL - вам
следует также преобразовать существующие таблицы привилегий MySQL.
See section <A HREF="manual.ru.html#Upgrading-from-3.23">2.5.2  Модернизация с версии 3.23 до версии 4.0</A>.

</P>
<P>
После инсталляции вы можете запустить MySQL выполняя следующие команды в терминальном
окне. Обратите внимание, что вам нужны привилегии администратора для выполнения этой
задачи. 

</P>

<PRE>
shell&#62; cd /usr/local/mysql
shell&#62; sudo ./bin/mysqld_safe
(Введите ваш пароль)
(Нажмите CTRL+Z)
shell&#62; bg
(Нажмите CTRL+D для выхода из оболочки)
</PRE>

<P>
Теперь вы сможете подключиться к серверу MySQL, скажем, запустив 
<tt>`/usr/local/mysql/bin/mysql'</tt>.

</P>
<P>
Для того, чтобы MySQL автоматически запускался при загрузке, вы можете 
взять MySQL StartupItem Марка по этому адресу: 

</P>
<P>
<a HREF="http://www2.entropy.ch/download/mysql-startupitem.pkg.tar.gz">http://www2.entropy.ch/download/mysql-startupitem.pkg.tar.gz</a>

</P>
<P>
Мы планируем в ближайшее время добавить StartupItem в официальный пакет 
MySQL в ближайшее время. 

</P>
<P>
Заметьте, что инсталляция нового пакета MySQL не удаляет каталог более старой
инсталляции. К сожалению, инсталлятор в Mac OS X еще не предоставляет нужной 
функциональности для того, чтобы корректно обновить существующие в системе
пакеты.

</P>
<P>
После того, как вы скопировали файлы данных MySQL с предыдущего месторасположения,
и успешно запустили новую версию, вы можете удалить старую инсталляцию. 
Кроме того, вы можете удалить старые каталоги Package Receipt, 
расположенные здесь: <tt>`/Library/Receipts/mysql-&#60;version&#62;.pkg'</tt>.

</P>



<H2><A NAME="General_Installation_Issues" HREF="manual.ru_toc.html#General_Installation_Issues">2.2  Общие вопросы инсталляции</A></H2>



<H3><A NAME="Getting_MySQL" HREF="manual.ru_toc.html#Getting_MySQL">2.2.1  Как получить MySQL</A></H3>

<P>
<A NAME="IDX177"></A>
<A NAME="IDX178"></A>
<A NAME="IDX179"></A>
<A NAME="IDX180"></A>
<A NAME="IDX181"></A>
<A NAME="IDX182"></A>
<A NAME="IDX183"></A>

</P>
<P>
Информацию о текущей версии и инструкции по ее загрузке можно получить на
домашней странице MySQL (<a HREF="http://www.mysql.com/">http://www.mysql.com/</a>).

</P>
<P>
Наш главный зеркальный сайт - <a HREF="http://mirrors.sunsite.dk/mysql/">http://mirrors.sunsite.dk/mysql/</a> 

</P>
<P>
Если вы заинтересованы в организации зеркального сайта MySQL, то можете
анонимно зеркалировать нас программой rsync с адреса
<code>rsync://sunsite.dk/ftp/mirrors/mysql/</code>. Просьба отправить нам письмо по
адресу <code>webmaster@mysql.com</code>, чтобы уведомить нас о том, что ваш зеркальный
сайт следует добавить в представленный ниже список.

</P>
<P>
Если возникнут проблемы с загрузкой с нашего главного сайта, пробуйте
использовать один из следующих зеркальных сайтов.

</P>
<P>
О недействительных или устаревших зеркальных сайтах просьба сообщать по
адресу <code>webmaster@mysql.com</code>.

</P>
<P>
For a complete upto-date list of MySQL web/download mirrors, see
<a HREF="http://www.mysql.com/downloads/mirrors.html">http://www.mysql.com/downloads/mirrors.html</a>.
There you will also find information about becoming a MySQL mirror
site and how to report a bad or out-of-date mirror.

</P>



<H3><A NAME="Verifying_Package_Integrity" HREF="manual.ru_toc.html#Verifying_Package_Integrity">2.2.2  Проверка целостности пакетов с помощью <code>MD5 Checksums</code> или <code>GnuPG</code></A></H3>

<P>
После того, как вы загрузили нужный вам пакет MySQL, и перед тем как вы будете
его устанавливать, вам следует убедиться в том, что он в сохранности и не был 
кем-либо изменен.

</P>
<P>
MySQL AB предоставляет два способа проверить пакет: контрольная сумма <code>MD5</code> 
и криптографическая подпись с использованиемп <code>GnuPG</code>, <code>GNU Privacy Guard</code>.

</P>

<H3>2.2.3  Проверка контрольной суммы <code>MD5</code></H3>

<P>
После того как вы загрузили пакет, вы должны проверить, соответствует ли
контрольная сумма MD5 загруженного пакета той, что указана на страничке
загрузки пакетов. У каждого пакета своя контрольная сумма, которую вы можете
проверить такой командой:

</P>

<PRE>
shell&#62; md5sum &#60;пакет&#62;
</PRE>

<P>
Однако не все операционные системы поддерживают команду <code>md5sum</code> - на некоторых
она просто называется <code>md5</code>, а в других она вовсе не поставляется. На Linux
эта команда является частью <code>GNU Text Utilities</code>, которые доступны для множества
разных платформ. 

</P>
<P>
Вы можете загрузить исходный код по адресу 
<a HREF="http://www.gnu.org/software/textutils/">http://www.gnu.org/software/textutils/</a>. Если у вас уже установлен 
<code>OpenSSL</code>, вы также можете использовать команду <code>openssl md5
&#60;пакет&#62;</code>. Реализация <code>md5</code> для DOS/Windows доступна по адресу 
<a HREF="http://www.fourmilab.ch/md5/">http://www.fourmilab.ch/md5/</a>.

</P>

<P>
Пример:

<PRE>
shell&#62; md5sum mysql-standard-4.0.10-gamma-pc-linux-i686.tar.gz
155836a7ed8c93aee6728a827a6aa153
                mysql-standard-4.0.10-gamma-pc-linux-i686.tar.gz
</PRE>

<P>
Вы должны удостовериться, что результирующая контрольная сумма соответствует
той, что указана на страничке загрузки возле соответствующего пакета. 

</P>
<P>
Множество зеркальных сайтов также предоставляют файл с именем <tt>`MD5SUMS'</tt>,
который также содержит <code>MD5</code> контрольные суммы всех файлов из каталога
<tt>`Downloads'</tt>.  Однако заметьте, что этот файл достаточно легко изменить и
это не самый надежный метод проверки целостности пакета. Если вы в сомнениях,
вы должны посмотреть на другие зеркала и сравнить увиденное. 

</P>

<H3>2.2.4  Проверка подписи с использованием <code>GnuPG</code></H3>

<P>
Гораздо более надежный метод проверки целостности пакета это использование
криптографически сигнатур. MySQL AB использует ПО <code>GNU Privacy Guard</code>
(<code>GnuPG</code>), открытая альтернатива весьма известному пакету <code>Pretty Good
Privacy</code> (<code>PGP</code>) Фила Циммермана (Phil Zimmermann).
См. <a HREF="http://www.gnupg.org/">http://www.gnupg.org/</a> и <a HREF="http://www.openpgp.org/">http://www.openpgp.org/</a>
для более подробной информации про OpenPGP/GnuPG и как его получить и поставить на 
вашей системе. Большинство поставок Linux уже идут с GnuPG прямо в поставке. 

</P>
<P>
Начиная с MySQL 4.0.10 (Февраль 2003), MySQL AB начала подписывать
загружаемые пакеты с помощью <code>GnuPG</code>.  Криптографические сигнатуры являются 
гораздо более надежным методом проверки целостности и аутентичности файла. 

</P>
<P>
Для проверки подписи конкретного пакета, вам в первую очередь следует
получить копию публичного ключа GPG <a HREF="mailto:build@mysql.com">build@mysql.com</a>. Вы можете
либо взять этот ключ прямо отсюда, либо взять его на 
<a HREF="http://www.keyserver.net/">http://www.keyserver.net/</a>.

</P>

<PRE>
Key ID:
pub  1024D/5072E1F5 2003-02-03
     MySQL Package signing key (www.mysql.com) &#60;build@mysql.com&#62;
Fingerprint: A4A9 4068 76FC BD3C 4567  70C8 8C71 8D3B 5072 E1F5

Public Key (ASCII-armored):

-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: GnuPG v1.0.6 (GNU/Linux)
Comment: For info see http://www.gnupg.org

mQGiBD4+owwRBAC14GIfUfCyEDSIePvEW3SAFUdJBtoQHH/nJKZyQT7h9bPlUWC3
RODjQReyCITRrdwyrKUGku2FmeVGwn2u2WmDMNABLnpprWPkBdCk96+OmSLN9brZ
fw2vOUgCmYv2hW0hyDHuvYlQA/BThQoADgj8AW6/0Lo7V1W9/8VuHP0gQwCgvzV3
BqOxRznNCRCRxAuAuVztHRcEAJooQK1+iSiunZMYD1WufeXfshc57S/+yeJkegNW
hxwR9pRWVArNYJdDRT+rf2RUe3vpquKNQU/hnEIUHJRQqYHo8gTxvxXNQc7fJYLV
K2HtkrPbP72vwsEKMYhhr0eKCbtLGfls9krjJ6sBgACyP/Vb7hiPwxh6rDZ7ITnE
kYpXBACmWpP8NJTkamEnPCia2ZoOHODANwpUkP43I7jsDmgtobZX9qnrAXw+uNDI
QJEXM6FSbi0LLtZciNlYsafwAPEOMDKpMqAK6IyisNtPvaLd8lH0bPAnWqcyefep
rv0sxxqUEMcM3o7wwgfN83POkDasDbs3pjwPhxvhz6//62zQJ7Q7TXlTUUwgUGFj
a2FnZSBzaWduaW5nIGtleSAod3d3Lm15c3FsLmNvbSkgPGJ1aWxkQG15c3FsLmNv
bT6IXQQTEQIAHQUCPj6jDAUJCWYBgAULBwoDBAMVAwIDFgIBAheAAAoJEIxxjTtQ
cuH1cY4AnilUwTXn8MatQOiG0a/bPxrvK/gCAJ4oinSNZRYTnblChwFaazt7PF3q
zIhMBBMRAgAMBQI+PqPRBYMJZgC7AAoJEElQ4SqycpHyJOEAn1mxHijft00bKXvu
cSo/pECUmppiAJ41M9MRVj5VcdH/KN/KjRtW6tHFPYhMBBMRAgAMBQI+QoIDBYMJ
YiKJAAoJELb1zU3GuiQ/lpEAoIhpp6BozKI8p6eaabzF5MlJH58pAKCu/ROofK8J
Eg2aLos+5zEYrB/LsrkCDQQ+PqMdEAgA7+GJfxbMdY4wslPnjH9rF4N2qfWsEN/l
xaZoJYc3a6M02WCnHl6ahT2/tBK2w1QI4YFteR47gCvtgb6O1JHffOo2HfLmRDRi
Rjd1DTCHqeyX7CHhcghj/dNRlW2Z0l5QFEcmV9U0Vhp3aFfWC4Ujfs3LU+hkAWzE
7zaD5cH9J7yv/6xuZVw411x0h4UqsTcWMu0iM1BzELqX1DY7LwoPEb/O9Rkbf4fm
Le11EzIaCa4PqARXQZc4dhSinMt6K3X4BrRsKTfozBu74F47D8Ilbf5vSYHbuE5p
/1oIDznkg/p8kW+3FxuWrycciqFTcNz215yyX39LXFnlLzKUb/F5GwADBQf+Lwqq
a8CGrRfsOAJxim63CHfty5mUc5rUSnTslGYEIOCR1BeQauyPZbPDsDD9MZ1ZaSaf
anFvwFG6Llx9xkU7tzq+vKLoWkm4u5xf3vn55VjnSd1aQ9eQnUcXiL4cnBGoTbOW
I39EcyzgslzBdC++MPjcQTcA7p6JUVsP6oAB3FQWg54tuUo0Ec8bsM8b3Ev42Lmu
QT5NdKHGwHsXTPtl0klk4bQk4OajHsiy1BMahpT27jWjJlMiJc+IWJ0mghkKHt92
6s/ymfdf5HkdQ1cyvsz5tryVI3Fx78XeSYfQvuuwqp2H139pXGEkg0n6KdUOetdZ
Whe70YGNPw1yjWJT1IhMBBgRAgAMBQI+PqMdBQkJZgGAAAoJEIxxjTtQcuH17p4A
n3r1QpVC9yhnW2cSAjq+kr72GX0eAJ4295kl6NxYEuFApmr1+0uUq/SlsQ==
=YJkx
-----END PGP PUBLIC KEY BLOCK-----
</PRE>

<P>
Вы можете импортировать этот ключ в ваш публичный репозитарий ключей (public keyring) 
используя <code>gpg --import</code>. См. документацию на <code>GPG</code> для более подробной информации 
о том, как работать с публичными ключами. 

</P>
<P>
После того, как вы загрузили и импортирлвали публичный ключ сборки, 
вы можете загрузить выбранный вами пакет MySQL и соответствующую подпись, 
доступную на той же страничке загрузки. 

</P>
<P>
Файл сигнатуры имеет расширение <tt>`.asc'</tt>. Например, 
сигнатура для <tt>`mysql-standard-4.0.10-gamma-pc-linux-i686.tar.gz'</tt>
будет <tt>`mysql-standard-4.0.10-gamma-pc-linux-i686.tar.gz.asc'</tt>.
Удостоверьтесь, чтобы оба файла находятся в том же самом каталоге и затем
запустите такую команду для проверки сигнатуры файла: 

</P>

<PRE>
shell&#62; gpg --verify &#60;package&#62;.asc

Example:

shell&#62; gpg --verify mysql-standard-4.0.10-gamma-pc-linux-i686.tar.gz.asc
gpg: Warning: using insecure memory!
gpg: Signature made Mon 03 Feb 2003 08:50:39 PM MET using DSA key ID 5072E1F5
gpg: Good signature from
     "MySQL Package signing key (www.mysql.com) &#60;build@mysql.com&#62;"
</PRE>

<P>
Сообщение "Good signature" сообщает вам о том, что все в порядке. 

</P>
<P>
Для пакетов <code>RPM</code>, отдельного файла подписи не предоставляется - пакеты <code>RPM</code> уже
сами по себе имеют встроенную поддержку подписей <code>GPG</code> и контрольных сумм <code>MD5</code>. Вы можете 
проверить их такой командой: 

</P>

<PRE>
shell&#62; rpm --checksig &#60;package&#62;.rpm
</PRE>

<P>
Пример:

</P>

<PRE>
shell&#62; rpm --checksig MySQL-server-4.0.10-0.i386.rpm
MySQL-server-4.0.10-0.i386.rpm: md5 gpg OK
</PRE>

<P>
<strong>Внимание:</strong> Если вы используете RPM 4.1 и он сообщает следующее: <code>(GPG)
NOT OK (MISSING KEYS: GPG#5072e1f5)</code> (даже несмотря на то, что вы импортировали
ключ в ваш публичный репозиторий ключей GPG, keyring) - вам следует 
импортировать ключ в репозиторий ключей RPM. 
RPM 4.1 больше не использует ваш репозиторий ключей GPG (и GPG вообще), но
поддерживает свой репозиторий, поскольку RPM - это общесистемная утилита, а 
репозиторий ключей GPG - это специфичный для пользователя файл). 
Чтобы импортировать публичный ключ MySQL в RPM, используйте вот такую команду: 

</P>

<PRE>
shell&#62; rpm --import &#60;pubkey&#62;
</PRE>

<P>
Пример:

</P>

<PRE>
shell&#62; rpm --import mysql_pubkey.asc
</PRE>

<P>
Если вдруг вы заметите что контрольные суммы MD5 или подпись GPG не совпадают,
попробуйте в первую очередь загрузить соответствующий пакет еще один раз, может 
быть, даже с другого сервера. Если вы не сможете успешно удостовериться
в целостности пакета, пожалуйста, сообщите нам о подобных инцидентах, включая
полное имя пакета и адрес сайта, с которого вы пытались загрузить пакет, на адрес
<a HREF="mailto:webmaster@mysql.com">webmaster@mysql.com</a> или <a HREF="mailto:build@mysql.com">build@mysql.com</a>.

</P>


<H3><A NAME="Which_OS" HREF="manual.ru_toc.html#Which_OS">2.2.5  Операционные системы, поддерживаемые MySQL</A></H3>

<P>
<A NAME="IDX184"></A>
<A NAME="IDX185"></A>
<A NAME="IDX186"></A>
<A NAME="IDX187"></A>

</P>
<P>
Мы применяем GNU Autoconf, что дает возможность переносить MySQL на все
современные системы с работающими потоками Posix и компилятором C++ (чтобы
скомпилировать только код клиента, требуется только компилятор C++ без
использования потоков). Для себя мы используем и разрабатываем программное
обеспечение в основном на Sun Solaris (версий 2.5 - 2.7) и SuSE Linux
версии 7.x.

</P>
<P>
Следует учитывать, что для многих операционных систем поддержка
собственных потоков работает только в самых последних версиях. Согласно
полученным нами сообщениям, MySQL успешно компилируется на следующих
комбинациях операционных систем и потоковых пакетов:

</P>

<UL>
<LI>

AIX 4.x, 5.x с собственными потоками. См.раздел See section <A HREF="manual.ru.html#IBM-AIX">2.6.6.4  Примечания к IBM-AIX</A>.
<LI>

Amiga.
<LI>

BSDI 2.x с пакетом MIT-pthreads. See section <A HREF="manual.ru.html#BSDI">2.6.4.5  Примечания к BSD/OS версий 2.x</A>.
<LI>

BSDI 3.0, 3.1 и 4.x с собственными потоками. See section <A HREF="manual.ru.html#BSDI">2.6.4.5  Примечания к BSD/OS версий 2.x</A>.
<LI>

DEC Unix 4.x с собственными потоками. See section <A HREF="manual.ru.html#Alpha-DEC-UNIX">2.6.6.6  Примечания к Alpha-DEC-UNIX (Tru64)</A>.
<LI>

FreeBSD 2.x с пакетом MIT-pthreads. See section <A HREF="manual.ru.html#FreeBSD">2.6.4.1  Примечания к FreeBSD</A>.
<LI>

FreeBSD 3.x и 4.x с собственными потоками. See section <A HREF="manual.ru.html#FreeBSD">2.6.4.1  Примечания к FreeBSD</A>.
<LI>

HP-UX 10.20 с пакетом MIT-pthreads или пакетом DCE-threads. See section <A HREF="manual.ru.html#HP-UX_10.20">2.6.6.2  Примечания к HP-UX версии 10.20</A>.
<LI>

HP-UX 11.x с собственными потоками. See section <A HREF="manual.ru.html#HP-UX_11.x">2.6.6.3  Примечания к HP-UX версий 11.x</A>.
<LI>

Linux 2.0+ с  потоками LinuxThreads 0.7.1+ или  glibc 2.0.7+. См.
раздел See section <A HREF="manual.ru.html#Linux">2.6.1  Примечания к Linux (Все версии Linux)</A>.
<LI>

Mac OS X. See section <A HREF="manual.ru.html#Mac_OS_X">2.6.5  Примечания к Mac OS X</A>.
<LI>

NetBSD 1.3/1.4 Intel и NetBSD 1.3 Alpha (требует GNU make). See section <A HREF="manual.ru.html#NetBSD">2.6.4.2  Примечания к NetBSD</A>.
<LI>

OpenBSD &#62; 2.5 с собственными потоками. OpenBSD &#60; 2.5 с 
пакетом MIT-pthreads. See section <A HREF="manual.ru.html#OpenBSD">2.6.4.3  Примечания к OpenBSD 2.5</A>.
<LI>

OS/2 Warp 3, FixPack 29 и OS/2 Warp 4, FixPack 4. See section <A HREF="manual.ru.html#OS_2">2.6.7  Примечания к OS/2</A>.
<LI>

SGI Irix 6.x с собственными потоками. See section <A HREF="manual.ru.html#SGI-Irix">2.6.6.8  Примечания к SGI Irix</A>.
<LI>

Solaris 2.5 и выше с собственными потоками на SPARC и x86. 
See section <A HREF="manual.ru.html#Solaris">2.6.3  Примечания к Solaris</A>.
<LI>

SunOS 4.x с пакетом MIT-pthreads. See section <A HREF="manual.ru.html#Solaris">2.6.3  Примечания к Solaris</A>.
<LI>

Caldera (SCO) OpenServer с последним портом пакета FSU Pthreads.
See section <A HREF="manual.ru.html#Caldera">2.6.6.9  Примечания к Caldera (SCO)</A>.
<LI>

Caldera (SCO) UnixWare 7.0.1. See section <A HREF="manual.ru.html#Caldera_Unixware">2.6.6.10  Примечания к Caldera (SCO) Unixware Version 7.0</A>.
<LI>

Tru64 Unix
<LI>

Windows 9x, Me, NT, 2000 и XP. See section <A HREF="manual.ru.html#Windows">2.6.2  Примечания к Windows</A>.
</UL>

<P>
Следует отметить, что не на всех платформах MySQL функционирует одинаково
хорошо. Насколько  подходит определенная платформа для высоконагружаемого
многоцелевого сервера MySQL, определяется следующими факторами:

</P>

<UL>
<LI>

Общая стабильность потоковой библиотеки. Платформа может иметь
отличную репутацию в других отношениях, но если в коде, который
вызывается MySQL, потоковая библиотека нестабильна, то, даже если все
остальное прекрасно, стабильность MySQL будет определяться
стабильностью потоковой библиотеки.
<LI>

Способность ядра и/или библиотеки потоков пользоваться преимуществом
симметричной многопроцессорной обработки (<code>SMP</code>) на  многопроцессорных
системах. Другими словами, при создании процессом потока для этого
потока должна быть возможность работать на ином центральном процессоре
(CPU), чем исходный процесс.
<LI>

Способность библиотеки ядра и/или потоков запускать много потоков,
которые приобретают/освобождают синхронизирующий флаг в небольшой
критической области, часто без излишних переключений контекста. Иными
словами, если реализация <code>pthread_mutex_lock()</code> является очень 
``уступающей'' время центрального процессора, это значительно 
вредит MySQL. Если не принять во внимание данное обстоятельство, то
использование добавочных центральных процессоров сделает MySQL
существенно медленнее.
<LI>

Общая стабильность/производительность файловой системы.
<LI>

Способность файловой системы работать с большими файлами вообще и
работать с ними эффективно в случае больших таблиц.
<LI>

Наш, т.е. разработчиков, уровень компетенции в том, что касается
данной платформы. Для платформ, которые мы знаем хорошо, мы вводим в
MySQL специфические для платформы оптимизации/исправления, доступные
во время компиляции. Кроме того, мы можем также дать совет по
оптимальной для MySQL конфигурации вашей системы.
<LI>

Выполненный нами у себя объем тестирования подобных конфигураций.
<LI>

Количество пользователей, успешно применяющих MySQL на данной
платформе в подобных конфигурациях. Если это количество велико, то
шансы получить некоторые специфические для данной платформы сюрпризы,
намного меньше.
</UL>

<P>
В соответствии с предыдущими критериями наилучшими платформами с этой
точки зрения для функционирования MySQL являются: x86 под управлением SuSE
Linux 7.1, с ядром 2.4 и ReiserFS (или любой подобный дистрибутив Linux) и
SPARC под управлением Solaris 2.7 или 2.8. FreeBSD оказывается третьей, но
мы в самом деле надеемся, что эта платформа войдет в число лучших, как
только станет совершеннее потоковая библиотека. Мы также надеемся, что, с
некоторого момента, мы сможем включить в высшую категорию все остальные
платформы, на которых MySQL компилируется и функционирует нормально, но не
с тем же уровнем стабильности и производительности. Это потребует
некоторых усилий с нашей стороны в сотрудничестве с разработчиками
компонентов операционных систем и библиотек, от которых зависит MySQL.
Если вы заинтересованы в улучшении тех или иных компонентов, у вас есть
возможность оказать влияние на их разработку и вы нуждаетесь в подробных
инструкциях по поводу того, что нужно MySQL, чтобы работать лучше, пошлите
письмо по адресу <a HREF="mailto:internals@lists.mysql.com">internals@lists.mysql.com</a>.

</P>
<P>
Просьба к вам: на основании приведенных выше сравнительных характеристик
не делать выводов о том, что какая-либо операционная система лучше или
хуже другой в общем. Мы говорим о выборе определенной операционной системы
для конкретной цели - для работы MySQL, и сравниваем платформы только в
таком смысле. С этой точки зрения результат такого сравнения был бы
другим, если бы мы включили в него больше пунктов. И в некоторых случаях
причина того, что одна операционная система лучше, чем другая, может
заключаться всего лишь в том, что в тестирование и оптимизацию этой
конкретной платформы было вложено гораздо больше усилий. Мы просто
констатируем наши наблюдения, чтобы помочь вам принять решение - на какой
платформе использовать MySQL в вашей системе.

</P>


<H3><A NAME="Which_version" HREF="manual.ru_toc.html#Which_version">2.2.6  Какую версию MySQL использовать</A></H3>

<P>
<A NAME="IDX188"></A>
<A NAME="IDX189"></A>
<A NAME="IDX190"></A>
<A NAME="IDX191"></A>

</P>
<P>
Во-первых, нужно принять решение о том, что именно вам требуется - самый
свежий экспериментальный выпуск или последняя устойчивая версия:

<UL>
<LI>

Если вы собираетесь использовать MySQL впервые или пытаетесь выполнить
перенос MySQL на некоторую систему, для которой нет бинарного
дистрибутива, то обычно мы рекомендуем начинать со стабильной версии
(в настоящее время это версия 3.23). Следует иметь в виду, что все
релизы MySQL проверяются с помощью тестов производительности MySQL и
набора всесторонних тестов перед каждым выпуском (даже для
экспериментальных выпусков).
<LI>

Если же вы работаете со старой системой и желаете ее модернизировать,
но хотите избежать возможных нестыковок при модернизации, то
необходимо проводить замену на самую новую версию в той же ветви,
которую вы используете (где только последний номер версии более новый,
чем у вашей). В таких версиях мы стараемся исправлять только
критические ошибки и делать только небольшие, относительно безопасные
изменения.
</UL>

<P>
Во-вторых, нужно принять решение, хотите ли вы использовать дистрибутив
исходного кода или бинарный дистрибутив. В большинстве случаев лучше
остановить свой выбор на бинарном дистрибутиве, если такой существует для
вашей платформы, так как обычно его проще установить, чем дистрибутив
исходного кода.

</P>
<P>
Установка из исходного кода может оказаться более предпочтительной в
следующих случаях:

<UL>
<LI>

Если необходимо инсталлировать MySQL в некотором явно заданном
местоположении (стандартные бинарные поставки являются ``готовыми к
запуску'' в любом месте, но, возможно, вам потребуется еще большая
гибкость).
<LI>

Чтобы удовлетворить различные требования пользователей, мы поставляем
две разных бинарных версии: одна скомпилирована с обработчиками
нетранзакционных таблиц (небольшой, быстрый бинарный код), а вторая
сконфигурирована с наиболее важными возможностями расширения, такими,
как поддерживающие транзакции таблицы. Обе версии компилируются из
одного и того же исходного кода. Все собственные клиенты <code>MySQL</code> могут
подключаться к обеим версиям.

Бинарный дистрибутив расширенной версии
MySQL маркируется суффиксом <code>-max</code> и конфигурируется с теми же опциями,
что и <code>mysqld-max</code>. See section <A HREF="manual.ru.html#mysqld-max">4.7.5  <code>mysqld-max</code>, расширенный сервер <code>mysqld</code></A>.

Если  вы  хотите  использовать  пакет RPM <code>MySQL-Max</code>, то сначала 
следует  установить стандартный пакет <code>MySQL</code> RPM.
<LI>

Если вам нужно сконфигурировать <code>mysqld</code> с некоторыми дополнительными
свойствами, которые отсутствуют в стандартных бинарных дистрибутивах.
Ниже приводится список наиболее распространенных дополнительных опций,
которые, возможно, вы захотите использовать:


<UL>
<LI><code>--with-innodb</code>

<LI><code>--with-berkeley-db</code>

<LI><code>--with-raid</code>

<LI><code>--with-libwrap</code>

<LI><code>--with-named-z-lib (Это делается для некоторых бинарных дистрибутивов)</code>

<LI><code>--with-debug[=full]</code>

</UL>

<LI>

По умолчанию бинарный дистрибутив обычно компилируется с поддержкой
всех кодировок и должен работать на различных процессорах из одного и
того же семейства процессоров.

Если требуется получить более быстрый
сервер MySQL, то можно перекомпилировать его с поддержкой только одной
необходимой вам кодировки, использовать лучший компилятор (наподобие
<code>pgcc</code>) или воспользоваться опциями компилятора, которые лучше
оптимизированы для вашего процессора.
<LI>

Если вы нашли ошибку и сообщили о ней команде разработчиков MySQL, то
вам должны выслать патч, который следует применить к дистрибутиву
исходного кода для исправления ошибки.
<LI>

Если вы хотите читать (и/или модифицировать) исходный код MySQL (на C
и C++), необходимо иметь дистрибутив исходного кода. Исходный код -
это всегда лучшая документация. Дистрибутивы исходного кода также
содержат больше тестов и примеров, чем бинарные дистрибутивы.
</UL>

<P>
<A NAME="IDX192"></A>
<A NAME="IDX193"></A>

</P>
<P>
В системе наименований в MySQL используются номера выпусков, состоящие из
трех чисел и суффикса. Например, выпуск <code>mysql-3.21.17-beta</code> 
интерпретируется следующим образом:

</P>

<UL>
<LI>

Первое число (<code>3</code>) служит для описания формата файлов. Все выпуски
версии <code>3</code> имеют один и тот же формат файлов.
<LI>

Второе число (<code>21</code>) представляет собой уровень выпуска. Обычно
существует выбор из двух возможностей. Одна представляет выпуск
стабильной ветви (в настоящее время <code>23</code>) и вторая - экспериментальную
ветвь (в настоящее время <code>4.0</code>). Обычно обе ветви стабильны, но
экспериментальная версия может обладать некоторыми причудами, возможно
отсутствие документации на новые свойства, либо она может не
компилироваться на некоторых системах.
<LI>

Третье число (<code>17</code>) является номером версии в пределах уровня выпуска.
Это число увеличивается для каждого нового дистрибутива. Обычно имеет
смысл предпочесть самую последнюю версию для выбранного уровня
выпуска.
<LI>

Суффикс (<code>beta</code>) указывает на уровень стабильности данного выпуска.
Возможны следующие суффиксы:


<UL>
<LI>

<code>alpha</code> указывает, что выпуск содержит большие разделы нового кода,
не протестированного на 100%. Обнаруженные ошибки (обычно их нет)
должны быть задокументированы в разделе ``Новости'' (News). См.
раздел See section <A HREF="manual.ru.html#News">C  История изменений и обновлений MySQL</A>. В большинстве выпусков <code>alpha</code>
присутствуют также новые команды и расширения. При работе над
<code>alpha</code>-выпуском может происходить активная разработка, включающая
значительные изменения кода, но перед выпуском все тестируется. В
любом выпуске MySQL не должно быть известных ошибок.
<LI>

<code>beta</code> означает, что весь новый код протестирован. Не добавляются
никакие новые свойства, которые могли бы вызвать повреждения
старого кода. Не должно быть никаких известных ошибок. Версия
изменяется с <code>alpha</code> на <code>beta</code> тогда, когда никаких сообщений о
критических ошибках в <code>alpha</code>-версии не поступает по меньшей мере в
течение месяца и мы не планируем добавлять какие- либо новые
свойства, которые могли бы понизить надежность прежних команд.
<LI>

<code>gamma</code> представляет собой версию <code>beta</code>, которая почти закончена и,
похоже, работает хорошо. Добавляются только незначительные
исправления. Это именно то, что во многих других компаниях
называется релизом.
<LI>

Если нет никакого суффикса, это означает, что данная версия
запускалась на многих различных компьютерных системах без
сообщений об ошибках, кроме ошибок, относящихся к специфике
платформ; для нее допускается только исправление критических
ошибок. Именно поэтому такой выпуск мы называем стабильным.
</UL>

</UL>

<P>
Все версии MySQL пропускаются через наши стандартные тесты и контрольные
задачи, чтобы получить уверенность в том, что они надежны в применении.
Так как стандартные тесты периодически дополняются, чтобы включить
проверку обнаруженных новых ошибок и ситуаций, которые могут их вызвать,
то набор тестов со временем становится лучше и лучше.

</P>
<P>
Отметим, что все выпуски протестированы по меньшей мере со следующими
тестами:

</P>
<P>
<A NAME="IDX194"></A>
<A NAME="IDX195"></A>

</P>
<DL COMPACT>

<DT>Внутренний набор тестов
<DD>
Набор является частью производственной системы для заказчика. Этот набор
включает много таблиц с сотнями мегабайт данных.

<DT>Набор тестов производительности MySQL
<DD>
Эти тесты работают с набором общеупотребительных запросов. Кроме того, они
позволяют увидеть, действительно ли последний пакет оптимизаций делает код
быстрее. See section <A HREF="manual.ru.html#MySQL_Benchmarks">5.1.4  Набор тестов MySQL (The MySQL Benchmark Suite)</A>.

<DT>Тест <code>crash-me</code>
<DD>
Тест пытается определить, какие функциональные возможности поддерживает
база данных и каковы ее возможности и ограничения. See section <A HREF="manual.ru.html#MySQL_Benchmarks">5.1.4  Набор тестов MySQL (The MySQL Benchmark Suite)</A>.
</DL>

<P>
Существует еще один тест. Он заключается в том, что мы используем самую
новую версию MySQL в нашей внутренней производственной среде по крайней
мере на одной машине. Для работы с этой версией у нас есть более чем 100
гигабайт данных.

</P>


<H3><A NAME="Installation_layouts" HREF="manual.ru_toc.html#Installation_layouts">2.2.7  Схемы установки</A></H3>

<P>
<A NAME="IDX196"></A>
<A NAME="IDX197"></A>
<A NAME="IDX198"></A>
<A NAME="IDX199"></A>

</P>
<P>
В этом разделе описывается расположение каталогов, создаваемых по
умолчанию при установке бинарного дистрибутива и дистрибутива исходного
кода.

</P>
<P>
Бинарный дистрибутив устанавливается путем его распаковки в выбранном вами
месте установки (обычно <tt>`/usr/local/mysql'</tt>) и создает следующие каталоги:

</P>
<TABLE BORDER>
<TR><TD><strong>Каталог</strong> </TD><TD> <strong>Содержание каталога</strong>
</TD></TR>
<TR><TD><tt>`bin'</tt> </TD><TD> Клиентские программы и сервер <code>mysqld</code>
</TD></TR>
<TR><TD><tt>`data'</tt> </TD><TD> Файлы журналов, базы данных
</TD></TR>
<TR><TD><tt>`include'</tt> </TD><TD> Включаемые (заголовочные) файлы
</TD></TR>
<TR><TD><tt>`lib'</tt> </TD><TD> Библиотеки
</TD></TR>
<TR><TD><tt>`scripts'</tt> </TD><TD> <code>mysql_install_db</code>
</TD></TR>
<TR><TD><tt>`share/mysql'</tt> </TD><TD> Файлы с текстами сообщений об ошибках
</TD></TR>
<TR><TD><tt>`sql-bench'</tt> </TD><TD> Тесты производительности
</TD></TR>
</TABLE>

<P>
Дистрибутив исходного кода устанавливается после того, как вы
сконфигурируете и скомпилируете его. По умолчанию на этапе установки файлы
инсталлируются в каталог <tt>`/usr/local'</tt> в следующие подкаталоги:

</P>
<TABLE BORDER>
<TR><TD><strong>Каталог</strong> </TD><TD> <strong>Содержание каталога</strong>
</TD></TR>
<TR><TD><tt>`bin'</tt> </TD><TD> Клиентские программы и скрипты
</TD></TR>
<TR><TD><tt>`include/mysql'</tt> </TD><TD> Включаемые (заголовочные) файлы
</TD></TR>
<TR><TD><tt>`info'</tt> </TD><TD> Документация в формате Info
</TD></TR>
<TR><TD><tt>`lib/mysql'</tt> </TD><TD> Библиотеки
</TD></TR>
<TR><TD><tt>`libexec'</tt> </TD><TD> Сервер <code>mysqld</code>
</TD></TR>
<TR><TD><tt>`share/mysql'</tt> </TD><TD> Файлы с текстами сообщений об ошибках
</TD></TR>
<TR><TD><tt>`sql-bench'</tt> </TD><TD> Тесты производительности и тест <code>crash-me</code>
</TD></TR>
<TR><TD><tt>`var'</tt> </TD><TD> Базы данных и файлы журналов
</TD></TR>
</TABLE>

<P>
Внутри каталога установки схема расположения инсталляции исходного кода
отличается от схемы установки бинарного дистрибутива в следующих
отношениях:

<UL>
<LI>

Сервер <code>mysqld</code> устанавливается в каталог <tt>`libexec'</tt>, а не в <tt>`bin'</tt>.
<LI>

Каталогом данных является <tt>`var'</tt>, а не <tt>`data'</tt>.
<LI>

<code>mysql_install_db</code> устанавливается в каталоге <tt>`/usr/local/bin'</tt>, а не в
<tt>`/usr/local/mysql/scripts'</tt>.
<LI>

Каталогами заголовочных файлов и библиотек являются <tt>`include/mysql'</tt> и
<tt>`lib/mysql'</tt>, а не <tt>`include'</tt> и <tt>`lib'</tt>.
</UL>

<P>
Можно создать собственную бинарную установку из скомпилированного
дистрибутива исходного кода. Для этого следует выполнить скрипт
<tt>`scripts/make_binary_distribution'</tt>.

</P>


<H3><A NAME="Many_versions" HREF="manual.ru_toc.html#Many_versions">2.2.8  Как и когда выпускаются обновления</A></H3>

<P>
<A NAME="IDX200"></A>
<A NAME="IDX201"></A>
<A NAME="IDX202"></A>

</P>
<P>
Развитие MySQL в MySQL AB происходит очень быстрыми темпами и мы стремимся
к тому, чтобы результаты нашей работы стали доступны и другим
пользователям MySQL. Мы стараемся сделать новый выпуск сразу же, как
только в продукте появляются очень полезные свойства, которые, по нашему
мнению, необходимы другим пользователям.

</P>
<P>
Помимо этого мы откликаемся на просьбы наших пользователей, если для этого
требуется добавить в продукт легко реализуемые свойства. Мы принимаем во
внимание пожелания наших пользователей, имеющих лицензии, а особенно -
пожелания обширного круга пользователей, охваченных поддержкой при помощи
электронной почты, и стараемся помочь им решить их проблемы.

</P>
<P>
Загружать новый выпуск не обязательно. Информацию о том, действительно ли
новый выпуск представляет собой именно то, что вам требуется, вы
почерпнете из раздела ``Новости'' (News). See section <A HREF="manual.ru.html#News">C  История изменений и обновлений MySQL</A>.

</P>
<P>
Наша политика в вопросах обновления MySQL заключается в следующем:

</P>

<UL>
<LI>

Для каждого небольшого обновления последняя цифра в строке версии
увеличивается. При внесении существенно новых свойств или небольших
несовместимостей с предыдущими версиями увеличивается второе число в
строке версии. Если изменяется формат файлов, то увеличивается первая
цифра.
<LI>

Протестированные на устойчивость версии должны обычно появляться 1-2
раза в год, но если обнаруживаются небольшие ошибки, то выпускаются
версии только с исправлениями ошибок.
<LI>

Рабочие исправления к старым версиям должны появляться примерно каждые
1-8 недель.
<LI>

Бинарные дистрибутивы для некоторых платформ мы будем делать для
значительных выпусков. Бинарные дистрибутивы для других систем иногда
создаются и другими людьми, но, как правило, не так часто.
<LI>

Обычно мы делаем патчи доступными сразу же после локализации и
исправления небольших ошибок. Они посылаются на <a HREF="mailto:bugs@lists.mysql.com">bugs@lists.mysql.com</a> и
включаются в очередной выпуск.
<LI>

Некритические, но досадные ошибки мы будем добавлять в репозиторий
исходного кода MySQL и они будут исправляться в следующем выпуске.
<LI>

Если по какой-либо случайности в выпуске окажется критическая ошибка,
то мы сделаем новый выпуск как можно скорее. Мы хотели бы, чтобы
нашему примеру и следовали и другие компании.
</UL>

<P>
Текущим стабильным выпуском сейчас является версия 3.23; уже начата
активную разработка версии 4.0. Ошибки в стабильной версии по-прежнему
будут исправляться. Мы не верим в полное ``замораживание'', поскольку при
этом упускаются исправления ошибок и вещи, которые ``должны быть
сделаны''. ``Отчасти заморожено'' подразумевает, что мы можем добавить
некоторые вещи, которые ``почти несомненно не окажут влияния ни на что из
того, что уже работает''.

</P>
<P>
В MySQL применяется несколько отличающаяся от большинства других продуктов
система именования. В общем случае достаточно надежно использовать любую
версию, просуществовавшую в течение пары недель без замены ее новой
версией. See section <A HREF="manual.ru.html#Which_version">2.2.6  Какую версию MySQL использовать</A>.

</P>


<H3><A NAME="MySQL_binaries" HREF="manual.ru_toc.html#MySQL_binaries">2.2.9  Бинарные коды MySQL, скомпилированные в MySQL AB</A></H3>

<P>
<A NAME="IDX203"></A>
<A NAME="IDX204"></A>

</P>

<P>
Компания MySQL AB в качестве услуги предоставляет набор бинарных
(скомпилированных) дистрибутивов MySQL - они скомпилированы  на нашем
оборудовании или на вычислительных системах, к которым нам любезно
предоставили доступ  заказчики.

</P>
<P>
Эти дистрибутивы сгенерированы скриптом
<code>Build-tools/Do-compile</code>, который компилирует дерево исходных 
кодов, и создает архив <code>.tar.gz</code> используя <code>scripts/make_binary_distribution</code>

</P>
<P>
Эти бинарники сконфигурированы и собраны с помощью следующих компиляторов и 
опций. 

</P>
<DL COMPACT>

<DT>Linux 2.4.xx i386 с <code>gcc</code> 2.95.3
<DD>
<code>CFLAGS="-O2 -mcpu=pentiumpro" CXX=gcc CXXFLAGS="-O2 -mcpu=pentiumpro -felide-constructors" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile --enable-assembler --disable-shared --with-client-ldflags=-all-static --with-mysqld-ldflags=-all-static</code>

<DT>Linux 2.4.xx ia64 с <code>ecc</code> (Intel C++ Itanium Compiler 7.0)
<DD>
<code>CC=ecc CFLAGS=-tpp1 CXX=ecc CXXFLAGS=-tpp1 ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile</code>

<DT>Linux 2.4.xx alpha с <code>ccc</code> (Compaq C V6.2-505 / Compaq C++ V6.3-006)
<DD>
<code>CC=ccc CFLAGS="-fast -arch generic" CXX=cxx CXXFLAGS="-fast -arch generic -noexceptions -nortti" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile --with-mysqld-ldflags=-non_shared --with-client-ldflags=-non_shared --disable-shared</code>

<DT>Linux 2.2.xx sparc с <code>egcs</code> 1.1.2
<DD>
<code>CC=gcc CFLAGS="-O3 -fno-omit-frame-pointer" CXX=gcc CXXFLAGS="-O3 -fno-omit-frame-pointer -felide-constructors -fno-exceptions -fno-rtti" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile --enable-assembler --disable-shared</code>

<DT>Linux 2.4.xx s390 с <code>gcc</code> 2.95.3
<DD>
<code>CFLAGS="-O2" CXX=gcc CXXFLAGS="-O2 -felide-constructors" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile --disable-shared --with-client-ldflags=-all-static --with-mysqld-ldflags=-all-static</code>

<DT>Sun Solaris 2.8 sparc с <code>gcc</code> 3.2
<DD>
<code>CC=gcc CFLAGS="-O3 -fno-omit-frame-pointer" CXX=gcc CXXFLAGS="-O3 -fno-omit-frame-pointer -felide-constructors -fno-exceptions -fno-rtti" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile --enable-assembler --with-named-z-libs=no --with-named-curses-libs=-lcurses --disable-shared</code>

<DT>Sun Solaris 2.9 sparc с <code>gcc</code> 2.95.3
<DD>
<code>CC=gcc CFLAGS="-O3 -fno-omit-frame-pointer" CXX=gcc CXXFLAGS="-O3 -fno-omit-frame-pointer -felide-constructors -fno-exceptions -fno-rtti" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile --enable-assembler --with-named-curses-libs=-lcurses --disable-shared</code>

<DT>Sun Solaris 2.9 sparc с <code>cc-5.0</code> (Sun Forte 5.0)
<DD>
<code>CC=cc-5.0 CXX=CC ASFLAGS="-xarch=v9" CFLAGS="-Xa -xstrconst -mt -D_FORTEC_ -xarch=v9" CXXFLAGS="-noex -mt -D_FORTEC_ -xarch=v9" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile --enable-assembler --with-named-z-libs=no --enable-thread-safe-client --disable-shared</code>

<DT>IBM AIX 4.3.2 ppc с <code>gcc</code> 3.2.1
<DD>
<code>CFLAGS="-O2 -mcpu=powerpc -Wa,-many " CXX=gcc CXXFLAGS="-O2 -mcpu=powerpc -Wa,-many  -felide-constructors -fno-exceptions -fno-rtti" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile --with-named-z-libs=no --disable-shared</code>

<DT>IBM AIX 5.1.0 ppc с <code>gcc</code> 3.2.1
<DD>
<code>CFLAGS="-O2 -mcpu=powerpc -Wa,-many" CXX=gcc CXXFLAGS="-O2 -mcpu=powerpc -Wa,-many  -felide-constructors -fno-exceptions -fno-rtti" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --with-server-suffix="-pro" --enable-thread-safe-client --enable-local-infile --with-named-z-libs=no --disable-shared --with-innodb</code>

<DT>HP-UX 10.20 pa-risc1.1 с <code>gcc</code> 3.1
<DD>
<code>CFLAGS="-DHPUX -I/opt/dce/include -O3 -fPIC" CXX=gcc CXXFLAGS="-DHPUX -I/opt/dce /include -felide-constructors -fno-exceptions -fno-rtti -O3 -fPIC" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile  --with-pthread --with-named-thread-libs=-ldce --with-lib-ccflags=-fPIC --disable-shared</code>

<DT>HP-UX 11.11 pa-risc2.0 с <code>aCC</code> (HP ANSI C++ B3910B A.03.33)
<DD>
<code>CC=cc CXX=aCC CFLAGS=+DD64 CXXFLAGS=+DD64 ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile --disable-shared</code>

<DT>Apple MacOS X 10.2 powerpc с <code>gcc</code> 3.1
<DD>
<code>CC=gcc CFLAGS="-O3 -fno-omit-frame-pointer" CXX=gcc CXXFLAGS="-O3 -fno-omit-frame-pointer -felide-constructors -fno-exceptions -fno-rtti" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile  --disable-shared</code>

<DT>FreeBSD 4.7 i386 с <code>gcc</code> 2.95.4
<DD>
<code>CFLAGS=-DHAVE_BROKEN_REALPATH ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile --enable-assembler --with-named-z-libs=not-used --disable-shared</code>
</DL>

<P>
Следующие бинарные поставки собраны на системах, предоставленных MySQL AB
пользователями. Заметьте, что эти бинарные поставки предоставляются
исключительно для удобства.  Поскольку у MySQL AB нет полного контроля над
этими системами, мы только можем дать ограниченную поддержку этих бинарных
поставок. 

</P>
<DL COMPACT>

<DT>SCO Unix 3.2v5.0.6 i386 с <code>gcc</code> 2.95.3
<DD>
<code>CFLAGS="-O3 -mpentium" LDFLAGS=-static CXX=gcc CXXFLAGS="-O3 -mpentium -felide-constructors" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile --with-named-z-libs=no --enable-thread-safe-client --disable-shared</code>

<DT>Caldera Open Unix 8.0.0 i386 с <code>CC</code> 3.2
<DD>
<code>CC=cc CFLAGS="-O" CXX=CC ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile --with-named-z-libs=no --enable-thread-safe-client --disable-shared</code>

<DT>Compaq Tru64 OSF/1 V5.1 732 alpha с <code>cc/cxx</code> (Compaq C V6.3-029i / DIGITAL C++ V6.1-027)
<DD>
<code>CC="cc -pthread" CFLAGS="-O4 -ansi_alias -ansi_args -fast -inline speed -speculate all" CXX="cxx -pthread" CXXFLAGS="-O4 -ansi_alias -fast -inline speed -speculate all -noexceptions -nortti" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile --with-prefix=/usr/local/mysql --with-named-thread-libs="-lpthread -lmach -lexc -lc" --disable-shared --with-mysqld-ldflags=-all-static</code>

<DT>SGI Irix 6.5 IP32 с <code>gcc</code> 3.0.1
<DD>
<code>CC=gcc CFLAGS="-O3 -fno-omit-frame-pointer" CXXFLAGS="-O3 -fno-omit-frame-pointer -felide-constructors -fno-exceptions -fno-rtti" ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex --enable-thread-safe-client --enable-local-infile  --disable-shared</code>
</DL>

<P>
Такие опции компиляции использовались для бинарных поставок MySQL AB в прошлом. 
Такие бинарные поставки более не обновляются, но опции компиляции мы сохранили 
здесь как реферативную информацию.

</P>
<DL COMPACT>

<DT>Linux 2.2.x с x686 с <code>gcc</code> 2.95.2
<DD>
<code>CFLAGS="-O3 -mpentiumpro" CXX=gcc CXXFLAGS="-O3 -mpentiumpro -felide-constructors -fno-exceptions -fno-rtti" ./configure --prefix=/usr/local/mysql --enable-assembler --with-mysqld-ldflags=-all-static --disable-shared --with-extra-charsets=complex</code>

<DT>SunOS 4.1.4 2 sun4c с <code>gcc</code> 2.7.2.1
<DD>
<code>CC=gcc CXX=gcc CXXFLAGS="-O3 -felide-constructors" ./configure --prefix=/usr/local/mysql --disable-shared --with-extra-charsets=complex --enable-assembler</code>

<DT>SunOS 5.5.1 (and above) sun4u с <code>egcs</code> 1.0.3a or 2.90.27 or gcc 2.95.2 and newer
<DD>
<code>CC=gcc CFLAGS="-O3" CXX=gcc CXXFLAGS="-O3 -felide-constructors -fno-exceptions -fno-rtti" ./configure --prefix=/usr/local/mysql --with-low-memory --with-extra-charsets=complex --enable-assembler</code>

<DT>SunOS 5.6 i86pc с <code>gcc</code> 2.8.1
<DD>
<code>CC=gcc CXX=gcc CXXFLAGS=-O3 ./configure --prefix=/usr/local/mysql --with-low-memory --with-extra-charsets=complex</code>

<DT>BSDI BSD/OS 3.1 i386 с <code>gcc</code> 2.7.2.1
<DD>
<code>CC=gcc CXX=gcc CXXFLAGS=-O ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex</code>

<DT>BSDI BSD/OS 2.1 i386 с <code>gcc</code> 2.7.2
<DD>
<code>CC=gcc CXX=gcc CXXFLAGS=-O3 ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex</code>

<DT>AIX 2 4 с <code>gcc</code> 2.7.2.2
<DD>
<code>CC=gcc CXX=gcc CXXFLAGS=-O3 ./configure --prefix=/usr/local/mysql --with-extra-charsets=complex</code>
</DL>

<P>
Каждый, кто обладает более оптимальными опциями для любой из
вышеперечисленных конфигураций, в любое время может выслать их в список
рассылки разработчиков по адресу <a HREF="mailto:internals@lists.mysql.com">internals@lists.mysql.com</a>.

</P>
<P>
Дистрибутивы RPM для версии MySQL до 3.22 создавались силами
пользователей. Однако начиная с версии 3.22, пакеты RPM собираются у нас в
MySQL AB.

</P>
<P>
Если вы хотите скомпилировать отладочную версию MySQL, то следует добавить
<code>--with-debug</code> или <code>--with-debug=full</code> к предыдущим строкам конфигурации и
удалить любые опции <code>-fomit-frame-pointer</code>.

</P>
<P>
По вопросам, относящимся к дистрибутиву для Windows, просьба обращаться к
разделу See section <A HREF="manual.ru.html#Windows_installation">2.1.2  Установка MySQL на Windows</A>.

</P>


<H3><A NAME="Installing_binary" HREF="manual.ru_toc.html#Installing_binary">2.2.10  Установка бинарного дистрибутива MySQL</A></H3>

<P>
<A NAME="IDX205"></A>
<A NAME="IDX206"></A>

</P>
<P>
См. также раздел See section <A HREF="manual.ru.html#Windows_binary_installation">2.1.2.1  Установка бинарного кода</A>, раздел section <A HREF="manual.ru.html#Linux-RPM">2.1.1  Установка MySQL на Linux</A> и раздел See section <A HREF="manual.ru.html#Building_clients">8.4.7  Сборка клиентских программ</A>.

</P>
<P>
Для установки бинарного дистрибутива MySQL необходимы следующие
инструментальные средства:

</P>

<UL>
<LI>

GNU <code>gunzip</code> для разархивирования дистрибутива.

<LI>

Подходящий <code>tar</code> для распаковки дистрибутива. GNU <code>tar</code> известен как
работающий, а <code>tar</code> разработки Sun - как имеющий проблемы.
</UL>

<P>
<A NAME="IDX207"></A>

</P>
<P>
Для Linux существует альтернативный метод установки с использованием
дистрибутива RPM (RedHat Package Manager, менеджер пакетов RedHat). См.
раздел See section <A HREF="manual.ru.html#Linux-RPM">2.1.1  Установка MySQL на Linux</A>.

</P>
<P>
Если вам придется столкнуться с проблемами, то, пожалуйста, при отправке
вопросов на <a HREF="mailto:mysql@lists.mysql.com">mysql@lists.mysql.com</a> всегда пользуйтесь <code>mysqlbug</code>. Даже если
ваша проблема не относится к числу ошибок, <code>mysqlbug</code> соберет системную
информацию, которая поможет решать такие проблемы и другим. Без <code>mysqlbug</code>
вы уменьшаете вероятность получить решение своей проблемы! <code>mysqlbug</code> можно
найти в каталоге <tt>`scripts'</tt> после распаковки дистрибутива. See section <A HREF="manual.ru.html#Bug_reports">1.8.1.3  Как отправлять отчеты об ошибках или проблемах</A>.

</P>
<P>
<A NAME="IDX208"></A>
Для установки бинарного дистрибутива MySQL необходимо выполнить следующие
основные команды:

</P>

<PRE>
shell&#62; groupadd mysql
shell&#62; useradd -g mysql mysql
shell&#62; cd /usr/local
shell&#62; gunzip &#60; /path/to/mysql-VERSION-OS.tar.gz | tar xvf -
shell&#62; ln -s full-path-to-mysql-VERSION-OS mysql
shell&#62; cd mysql
shell&#62; scripts/mysql_install_db
shell&#62; chown -R root .
shell&#62; chown -R mysql data
shell&#62; chgrp -R mysql .
shell&#62; bin/safe_mysqld --user=mysql &#38;
</PRE>

<P>
или

</P>

<PRE>
shell&#62; bin/mysqld_safe --user=mysql &#38;
</PRE>

<P>
если вы работаете с MySQL 4.x

</P>
<P>
<A NAME="IDX209"></A>
<A NAME="IDX210"></A>

</P>
<P>
Новых пользователей можно добавить, используя скрипт
<code>bin/mysql_setpermission</code>, если установить модули Perl <code>DBI</code> и
<code>Msql-Mysql-modules</code>.

</P>
<P>
Далее следует более детальное описание.

</P>
<P>
Для установки бинарного дистрибутива выполните приведенные ниже действия,
а затем перейдите к разделу section <A HREF="manual.ru.html#Post-installation">2.4  Послеустановочные настройка и тестирование</A> для
послеустановочной настройки и проверки:

<OL>
<LI>

Выберите каталог, в котором вы хотите распаковать дистрибутив, и
откройте его. В последующих примерах мы распаковываем дистрибутив под
<tt>`/usr/local'</tt> и создаем каталог <tt>`/usr/local/mysql'</tt>, в котором
устанавливается MySQL. (Для выполнения дальнейших инструкций,
следовательно, предполагается, что вы обладаете правами создания
файлов в <tt>`/usr/local'</tt>. Если этот каталог защищен, то вы должны
производить установку как пользователь <code>root</code>.)

<LI>

Получите файл дистрибутива с одного из сайтов, перечисленных в разделе
See section <A HREF="manual.ru.html#Getting_MySQL">2.2.1  Как получить MySQL</A>. Бинарные дистрибутивы MySQL поставляются как сжатые
архивы tar с именами вроде <tt>`mysql-VERSION-OS.tar.gz'</tt>, где <code>VERSION</code>
представляет собой число (например 5.0.0-alpha), а <code>OS</code> указывает тип
операционной системы, для которой предназначен данный дистрибутив
(например <code>pc-linux-gnu-i586</code>).

<LI>

Если бинарный дистрибутив маркирован суффиксом <code>-max</code>, то это означает,
что данный бинарный код поддерживает транзакционные таблицы и другие
свойства. See section <A HREF="manual.ru.html#mysqld-max">4.7.5  <code>mysqld-max</code>, расширенный сервер <code>mysqld</code></A>. Отметим,
что все бинарные дистрибутивы созданы из одного и того же дистрибутива
исходного кода MySQL.

<LI>

Добавьте пользователя и группу для запуска <code>mysqld</code> как:


<PRE>
shell&#62; groupadd mysql
shell&#62; useradd -g mysql mysql
</PRE>

Приведенные команды добавляют группу <code>mysql</code> и пользователя <code>mysql</code>. Данный
синтаксис для <code>useradd</code> и <code>groupadd</code> для различных версиях Unix может иметь
некоторые различия. Эти команды могут также называться <code>adduser</code> и <code>addgroup</code>.
При желании можно дать пользователю и группе вместо <code>mysql</code> другие имена.

<LI>

Задайте предназначенный для установки каталог:


<PRE>
shell&#62; cd /usr/local
</PRE>

<LI>

Распакуйте дистрибутив и создайте каталог установки:


<PRE>
shell&#62; gunzip &#60; /path/to/mysql-VERSION-OS.tar.gz | tar xvf -
shell&#62; ln -s full-path-to-mysql-VERSION-OS mysql
</PRE>

Первая команда создает каталог с именем <code>mysql-VERSION-OS</code>, а вторая -
устанавливает символическую ссылку на данный каталог. Это позволяет более
просто ссылаться на каталог установки - как на <tt>`/usr/local/mysql'</tt>.

<LI>

Измените в каталоге установки:


<PRE>
shell&#62; cd mysql
</PRE>

В каталоге <code>mysql</code> вы найдете несколько файлов и подкаталогов. Наиболее
важными для целей установки являются подкаталоги <tt>`bin'</tt> и <tt>`scripts'</tt>.

<DL COMPACT>

<DT><tt>`bin'</tt>
<DD>
<A NAME="IDX211"></A>
<A NAME="IDX212"></A>

Этот каталог содержит клиентские программы и сервер. Необходимо добавить
полный путь к этому каталогу в переменную окружения  <code>PATH</code>, чтобы оболочка
операционной системы правильно находила программы MySQL. 
See section <A HREF="manual.ru.html#Environment_variables">E  Переменные окружения</A>.

<DT><tt>`scripts'</tt>
<DD>
Этот каталог содержит скрипт <code>mysql_install_db</code>, используемый для
инициализации базы данных <code>mysql</code>, содержащей таблицы привилегий, в которых
хранятся права доступа к серверу.
</DL>

<LI>

Если вы предпочитаете использовать <code>mysqlaccess</code> и установить
дистрибутив MySQL в каком-либо нестандартном месте, то необходимо
изменить место, где <code>mysqlaccess</code> ожидает найти клиента <code>mysql</code>.
Отредактируйте скрипт <tt>`bin/mysqlaccess'</tt> примерно на 18-й строке.
Найдите строку, выглядящую примерно так:


<PRE>
$MYSQL = '/usr/local/bin/mysql'; # путь к исполняемому клиенту mysql
</PRE>

Измените путь для указания того места в системе, где действительно
находится <code>mysql</code>. Если этого не сделать, то возникнет ошибка <code>Broken pipe</code> 
при запуске <code>mysqlaccess</code>.

<LI>

Создайте таблицы привилегий MySQL (необходимы только в том случае,
если ранее MySQL не устанавливался):


<PRE>
shell&#62; scripts/mysql_install_db
</PRE>

Отметим, что в версиях MySQL старше, чем 3.22.10, сервер MySQL запускался
при запуске <code>mysql_install_db</code>. Сейчас это не так!

<LI>

Измените принадлежность бинарного кода пользователю <code>root</code> и
принадлежность каталога данных пользователю, под которым будет
запускаться <code>mysqld</code>, следующим образом:


<PRE>
shell&#62; chown -R root /usr/local/mysql/.
shell&#62; chown -R mysql /usr/local/mysql/data
shell&#62; chgrp -R mysql /usr/local/mysql/.
</PRE>

Первая команда изменяет владельца данного файла на пользователя <code>root</code>,
вторая -  владельца каталога данных на пользователя <code>mysql</code>, а третья -
группу на группу <code>mysql</code>.

<LI>

Если вы хотите установить поддержку интерфейса Perl <code>DBI</code>/<code>DBD</code>, 
See section <A HREF="manual.ru.html#Perl_support">2.7  Замечания по установке Perl</A>.

<LI>

Если вы хотели бы, чтобы работа MySQL начиналась автоматически при
начальной загрузке компьютера, то можно скопировать
<tt>`support-files/mysql.server'</tt> в то место, где находятся файлы запуска
вашей системы. Более подробную информацию можно найти в самом скрипте
<tt>`support-files/mysql.server'</tt> и в разделе See section <A HREF="manual.ru.html#Automatic_start">2.4.3  Автоматический запуск и остановка MySQL</A>.
</OL>

<P>
После того, как все это будет установлено, необходимо инициализировать и
протестировать данный дистрибутив.

</P>
<P>
Запустить сервер MySQL можно с помощью следующей команды:

</P>

<PRE>
shell&#62; bin/safe_mysqld --user=mysql &#38;
</PRE>

<P>
А сейчас следует перейти к разделу section <A HREF="manual.ru.html#safe_mysqld">4.7.2  <code>safe_mysqld</code>, оболочка <code>mysqld</code></A> и просмотреть раздел See section <A HREF="manual.ru.html#Post-installation">2.4  Послеустановочные настройка и тестирование</A>.

</P>


<H2><A NAME="Installing_source" HREF="manual.ru_toc.html#Installing_source">2.3  Установка исходного дистрибутива MySQL</A></H2>

<P>
<A NAME="IDX213"></A>
<A NAME="IDX214"></A>
<A NAME="IDX215"></A>

</P>
<P>
Перед тем как приступить к установке исходного кода, вначале убедитесь,
что наш бинарный дистрибутив подходит для вашей платформы и что он будет
работать на вашей системе. Мы прилагаем много усилий для того, чтобы
снабдить наши бинарные дистрибутивы наилучшими свойствами из возможных.

</P>
<P>
Для сборки и установки MySQL из исходного кода необходимы следующие
инструменты:

</P>

<UL>
<LI>

GNU <code>gunzip</code> для разархивирования дистрибутива.

<LI>

Подходящий <code>tar</code> для распаковки дистрибутива. Известно, что GNU <code>tar</code>
является работоспособным, а <code>tar</code> разработки Sun имеет проблемы.

<LI>

Работающий компилятор ANSI C++. К числу компиляторов, о которых
известно, что они работают, относятся версии <code>gcc</code> &#62;= 2.95.2, <code>egcs</code> &#62;=
1.0.2 или egcs 2.91.66, SGI C++ и SunPro C++. При использовании <code>gcc</code>
нет необходимости в <code>libg++</code>. Версия gcc 2.7.x имеет ошибку, из-за
которой невозможна компиляция некоторых полностью допустимых файлов
C++, таких как <tt>`sql/sql_base.cc'</tt>. Если у вас есть только <code>gcc</code> 2.7.x, то
для того, чтобы можно было провести компиляцию MySQL, необходимо
модернизировать <code>gcc</code>. Компилятор <code>gcc</code> 2.8.1, как известно, также имеет
проблемы на некоторых платформах, так что его лучше не использовать,
если для данной платформы существует новый компилятор. При компиляции
версии MySQL 3.23.x рекомендуется <code>gcc</code> &#62;= 2.95.2.

<LI>

Хорошая программа <code>make</code>. Всегда рекомендуется (а иногда и необходимо)
использовать GNU make. В случае возникновения проблем мы рекомендуем
попробовать работать с версией GNU make 3.75 или более новой.
</UL>

<P>
Очень важно, чтобы вы использовали последнюю версию <code>gcc</code>, достаточно новую,
чтобы ``понимать'' опцию <code>-fno-exceptions</code>. В противном случае не исключена
компиляция бинарного кода, который может неожиданно привести к отказу. Мы
также рекомендуем использовать <code>-felide-constructors</code> и <code>-fno-rtti</code> вместе с
<code>-fno-exceptions</code>. Если вы сомневаетесь, то выполните следующие действия:

</P>

<PRE>
CFLAGS="-O3" CXX=gcc CXXFLAGS="-O3 -felide-constructors -fno-exceptions \
       -fno-rtti" ./configure --prefix=/usr/local/mysql --enable-assembler \
       --with-mysqld-ldflags=-all-static
</PRE>

<P>
На большинстве операционных систем это даст быстрый и стабильный бинарный
код.

</P>
<P>
Если вам придется столкнуться с проблемами, то при отправке вопросов на
<a HREF="mailto:mysql@lists.mysql.com">mysql@lists.mysql.com</a>, пожалуйста, всегда используйте <code>mysqlbug</code>. Даже если
ваша проблема не вызвана какой-либо ошибкой, <code>mysqlbug</code> соберет системную
информацию, которая в поможет решении этой проблемы другим пользователям.
Без <code>mysqlbug</code> уменьшается вероятность того, что вы получите решение своей
проблемы! <code>mysqlbug</code> можно найти в каталоге <tt>`scripts'</tt> после распаковки
дистрибутива. See section <A HREF="manual.ru.html#Bug_reports">1.8.1.3  Как отправлять отчеты об ошибках или проблемах</A>.

</P>



<H3><A NAME="Quick_install" HREF="manual.ru_toc.html#Quick_install">2.3.1  Обзор  быстрой  установки</A></H3>

<P>
Для установки MySQL из исходного кода необходимо выполнить следующие
основные команды:

</P>

<PRE>
shell&#62; groupadd mysql
shell&#62; useradd -g mysql mysql
shell&#62; gunzip &#60; mysql-VERSION.tar.gz | tar -xvf -
shell&#62; cd mysql-VERSION
shell&#62; ./configure --prefix=/usr/local/mysql
shell&#62; make
shell&#62; make install
shell&#62; scripts/mysql_install_db
shell&#62; chown -R root /usr/local/mysql
shell&#62; chown -R mysql /usr/local/mysql/var
shell&#62; chgrp -R mysql /usr/local/mysql
shell&#62; cp support-files/my-medium.cnf /etc/my.cnf
shell&#62; /usr/local/mysql/bin/safe_mysqld --user=mysql &#38;
или
shell&#62; /usr/local/mysql/bin/mysqld_safe --user=mysql &#38;
</PRE>

<P>
если запускается версия MySQL 4.x.

</P>
<P>
Чтобы обеспечить поддержку таблиц InnoDB, следует отредактировать файл
<tt>`/etc/my.cnf'</tt>, удалив символ <code>#</code> перед теми параметрами, которые начинаются с
<code>innodb_....</code> See section <A HREF="manual.ru.html#Option_files">4.1.2  Файлы параметров <tt>`my.cnf'</tt></A>. See section <A HREF="manual.ru.html#InnoDB_start">7.5.2  Параметры запуска InnoDB</A>.

</P>
<P>
Если вы используете исходный код RPM, выполните следующую команду:

</P>

<PRE>
shell&#62; rpm --rebuild --clean MySQL-VERSION.src.rpm
</PRE>

<P>
Эта команда создаст бинарный код RPM, который вы можете установить.

</P>
<P>
Новых пользователей можно добавить, используя скрипт
<code>bin/mysql_setpermission</code>, если установить модули Perl <code>DBI</code> и
<code>Msql-Mysql-modules</code>.

</P>
<P>
Ниже следует более подробное описание установки.

</P>
<P>
Для установки исходного кода нужно выполнить приведенные ниже действия, а
затем перейти к разделу section <A HREF="manual.ru.html#Post-installation">2.4  Послеустановочные настройка и тестирование</A> для
инициализации и послеустановочной проверки:

</P>

<OL>
<LI>

Выберите каталог, в котором вы хотите распаковать дистрибутив, и
откройте его.

Получите файл дистрибутива с одного из сайтов, перечисленных в разделе
See section <A HREF="manual.ru.html#Getting_MySQL">2.2.1  Как получить MySQL</A>.

<LI>

Если вы заинтересованы в том, чтобы использовать с MySQL таблицы
Berkeley DB, то необходимо получить версию исходного кода таблиц
Berkeley DB с патчами. Кроме того, прежде чем предпринимать какие-либо
действия, ознакомьтесь, пожалуйста, с разделом, посвященным таблицам
Berkeley DB (see section <A HREF="manual.ru.html#BDB">7.6  Таблицы <code>BDB</code> или BerkeleyDB</A>). Дистрибутивы
исходного кода MySQL поставляются в виде сжатых архивов tar с именами
наподобие <tt>`mysql-VERSION.tar.gz'</tt>, где <code>VERSION</code> представляет собой число.

<LI>

Добавьте пользователя и группу для запуска <code>mysqld</code> следующим образом:


<PRE>
shell&#62; groupadd mysql
shell&#62; useradd -g mysql mysql
</PRE>

Эти команды добавляют группу <code>mysql</code> и пользователя <code>mysql</code>. Данный синтаксис
для <code>useradd</code> и <code>groupadd</code> в различных версиях Unix может иметь некоторые
отличия. Приведенные выше команды могут также иметь другие названия -
<code>adduser</code> и <code>addgroup</code> соответственно. Пользователю и группе можно назначить
какие-нибудь иные, отличные от <code>mysql</code> имена.

<LI>

Распакуйте дистрибутив в текущем каталоге:


<PRE>
shell&#62; gunzip &#60; /path/to/mysql-VERSION.tar.gz | tar xvf -
</PRE>

Эта команда создает каталог с именем <tt>`mysql-VERSION'</tt>.

<LI>

Перейдите из каталога распакованного дистрибутива в каталог высшего
уровня:


<PRE>
shell&#62; cd mysql-VERSION
</PRE>

Учтите, что теперь необходимо конфигурировать и компоновать MySQL из этого
каталога высшего уровня. Построить  MySQL в другом каталоге нельзя.

<LI>

Сформируйте релиз и скомпилируйте весь код:


<PRE>
shell&#62; ./configure --prefix=/usr/local/mysql
shell&#62; make
</PRE>

При запуске configure вам, возможно, понадобится указать некоторые опции.
Чтобы получить список опций, запустите <code>./configure --help</code>. Некоторые
наиболее полезные опции рассмотрены в разделе See section <A HREF="manual.ru.html#configure_options">2.3.3  Типичные опции <code>configure</code></A>.
Если <code>configure</code> не работает и вы собираетесь посылать письмо с просьбой о
помощи на <a HREF="mailto:mysql@lists.mysql.com">mysql@lists.mysql.com</a>, то просьба включить в него те строки из
<tt>`config.log'</tt>, которые, по вашему мнению, могут помочь решить данную
проблему. Кроме того, если выполнение <code>configure</code> преждевременно
прекращается, в письмо следует включить несколько последних строк вывода
из <code>configure</code>. Для отсылки отчета об ошибке используйте скрипт <code>mysqlbug</code>
(see section <A HREF="manual.ru.html#Bug_reports">1.8.1.3  Как отправлять отчеты об ошибках или проблемах</A>). Если компиляция не
выполняется, то обращайтесь к разделу See section <A HREF="manual.ru.html#Compilation_problems">2.3.5  Проблемы с компиляцией?</A>, в котором
содержатся рекомендации по решению ряда часто встречающихся проблем.

<LI>

Установите весь код:


<PRE>
shell&#62; make install
</PRE>

Возможно, необходимо запустить эту команду как <code>root</code>.

<LI>

Создайте таблицы привилегий MySQL (это необходимо только в случае,
если нет ранее установленной версии MySQL ):


<PRE>
shell&#62; scripts/mysql_install_db
</PRE>

Учтите, что в версиях MySQL до 3.22.10 работа сервера MySQL начиналась при
запуске <code>mysql_install_db</code>. Сейчас это не так!

<LI>

Измените принадлежность бинарного кода <code>root</code> и принадлежность каталога
данных, назначив их пользователю, под именем которого будет
запускаться <code>mysqld</code>. Это делается следующим образом:


<PRE>
shell&#62; chown -R root /usr/local/mysql
shell&#62; chown -R mysql /usr/local/mysql/var
shell&#62; chgrp -R mysql /usr/local/mysql
</PRE>

Первая команда изменяет атрибут owner данного файла на пользователя <code>root</code>,
вторая - атрибут owner каталога данных на пользователя <code>mysql</code>, а третья -
атрибут group на группу <code>mysql</code>.

<LI>

Если вы хотите установить поддержку интерфейса Perl <code>DBI</code>/<code>DBD</code>,
обращайтесь к разделу See section <A HREF="manual.ru.html#Perl_support">2.7  Замечания по установке Perl</A>.

<LI>

Если вы хотели бы, чтобы работа MySQL начиналась автоматически при
начальной загрузке компьютера, то можно скопировать
<tt>`support-files/mysql.server'</tt> в то место, где находятся файлы запуска
вашей системы. Более подробную информацию можно найти в самом скрипте
<tt>`support-files/mysql.server'</tt> и в разделе See section <A HREF="manual.ru.html#Automatic_start">2.4.3  Автоматический запуск и остановка MySQL</A>.
</OL>

<P>
После завершения установки данный дистрибутив необходимо
проинициализировать и протестировать:

</P>

<PRE>
shell&#62; /usr/local/mysql/bin/safe_mysqld --user=mysql &#38;
</PRE>

<P>
Если эта команда прекращает работу немедленно после останова демона
<code>mysqld</code>, то некоторую информацию можно найти в файле
<tt>`mysql-data-directory/'hostname'.err'</tt>. Причина, возможно, заключается в том,
что уже запущен другой сервер <code>mysqld</code> (see section <A HREF="manual.ru.html#Multiple_servers">4.1.4  Запуск нескольких серверов MySQL на одном компьютере</A>).

</P>
<P>
Теперь приступайте к разделу See section <A HREF="manual.ru.html#Post-installation">2.4  Послеустановочные настройка и тестирование</A>.

</P>


<H3><A NAME="Applying_patches" HREF="manual.ru_toc.html#Applying_patches">2.3.2  Применение патчей</A></H3>

<P>
<A NAME="IDX216"></A>
<A NAME="IDX217"></A>

</P>
<P>
Патчи иногда присутствуют в списке рассылки или помещаются в папке патчей
на веб-сайте MySQL (<a HREF="http://www.mysql.com/downloads/patches.html">http://www.mysql.com/downloads/patches.html</a>).

</P>
<P>
Для применения патча из списка рассылки сохраните сообщение, содержащее
патч, в файле, поместите его в каталог высшего уровня, в котором находится
дерево исходных кодов MySQL, и запустите следующие команды:

</P>

<PRE>
shell&#62; patch -p1 &#60; patch-file-name
shell&#62; rm config.cache
shell&#62; make clean
</PRE>

<P>
Патчи с FTP-сайта распространяются как файлы с простым текстом или как
файлы, сжатые с помощью <code>gzip</code>. Патч в виде простого текста следует
применять, как показано выше для патчей из списка рассылки. Чтобы
применить сжатый патч, поместите его в каталог высшего уровня, в котором
находится дерево исходных кодов MySQL, и запустите следующие команды:

</P>

<PRE>
shell&#62; gunzip &#60; patch-file-name.gz | patch -p1
shell&#62; rm config.cache
shell&#62; make clean
</PRE>

<P>
После применения патча следуйте инструкциям для обычной установки
исходного кода, начиная с этапа <code>./configure</code>. После запуска этапа <code>make
install</code> перезапустите свой сервер MySQL.

</P>
<P>
Возможно, перед запуском <code>make install</code> потребуется остановить любые
запущенные в это время серверы (используйте для этого <code>mysqladmin
shutdown</code>). В некоторых системы не разрешается устанавливать новую версию
какой-либо программы, если она замещает запущенную в данное время версию.

</P>


<H3><A NAME="configure_options" HREF="manual.ru_toc.html#configure_options">2.3.3  Типичные опции <code>configure</code></A></H3>

<P>
<A NAME="IDX218"></A>
<A NAME="IDX219"></A>
<A NAME="IDX220"></A>
<A NAME="IDX221"></A>
<A NAME="IDX222"></A>
<A NAME="IDX223"></A>

</P>
<P>
Скрипт <code>configure</code> обеспечивает широкие возможности управления конфигурацией
дистрибутива MySQL. Обычно такое управление осуществляется путем
использования опций в командной строке <code>configure</code>. На работу <code>configure</code>
можно также воздействовать при помощи соответствующих переменных окружения
(see section <A HREF="manual.ru.html#Environment_variables">E  Переменные окружения</A>). Чтобы получить список поддерживаемых
configure опций, запустите следующую команду:

</P>

<PRE>
shell&#62; ./configure --help
</PRE>

<P>
Ниже описаны некоторые из наиболее часто используемых опций <code>configure</code>:

</P>

<UL>
<LI>

Для компиляции только клиентских библиотек MySQL и клиентских программ
(без серверной части) используйте опцию <code>--without-server</code>:


<PRE>
shell&#62; ./configure --without-server
</PRE>

При отсутствии компилятора C++ не будет компилироваться <code>mysql</code> (именно для
данной клиентской программы требуется C++). В этом случае можно удалить из
configure код, который проверяет наличие компилятора C++, а затем
запустить <code>./configure</code> с опцией <code>--without-server</code>. На этапе компиляции и
после этого будет предпринята попытка скомпилировать <code>mysql</code>, но любые
предупреждения насчет <tt>`mysql.cc'</tt> можно игнорировать (если <code>make</code> остановится,
попробуйте запустить <code>make -k</code> - чтобы  компиляция остального кода
продолжалась даже в случае возникновения ошибок).

<LI>

Если необходимо получить встраиваемую библиотеку MySQL (<tt>`libmysqld.a'</tt>),
используйте опцию <code>--with-embedded-server</code>.

<LI>

Если вы не хотите, чтобы ваши системные журналы и каталоги баз данных
располагались в каталоге <tt>`/usr/local/var'</tt>, то используйте команду
<code>configure</code> наподобие одной из приведенных ниже:


<PRE>
shell&#62; ./configure --prefix=/usr/local/mysql
shell&#62; ./configure --prefix=/usr/local \
      --localstatedir=/usr/local/mysql/data
</PRE>

Первая команда изменяет установочный префикс, в результате чего весь код
будет установлен в каталоге <tt>`/usr/local/mysql'</tt> вместо принятого по умолчанию
<tt>`/usr/local'</tt>. Вторая команда сохраняет принятый по умолчанию установочный
префикс, но переопределяет принятое по умолчанию местоположение каталогов
базы данных (обычно <tt>`/usr/local/var'</tt>) и изменяет его на
<tt>`/usr/local/mysql/data'</tt>. После завершения компиляции MySQL эти опции можно
изменить с помощью файлов опций (see section <A HREF="manual.ru.html#Option_files">4.1.2  Файлы параметров <tt>`my.cnf'</tt></A>)

<A NAME="IDX224"></A>
<A NAME="IDX225"></A>
<A NAME="IDX226"></A>

<LI>

Если вы работаете под Unix и хотите, чтобы сокет MySQL находился в
каком-либо другом, отличном от принятого по умолчанию, месте (обычно
по умолчанию задается каталог <tt>`/tmp'</tt> или <tt>`/var/run'</tt>), используйте команду
configure, подобную следующей:


<PRE>
shell&#62; ./configure --with-unix-socket-path=/usr/local/mysql/tmp/mysql.sock
</PRE>

Следует учитывать, что данный файл должен представлять собой полный путь к
каталогу! Позже местоположение mysql.sock можно также изменить, используя
файлы опций MySQL (see section <A HREF="manual.ru.html#Problems_with_mysql.sock">A.4.5  Как защитить или изменить сокет-файл MySQL <tt>`/tmp/mysql.sock'</tt></A>).

<A NAME="IDX227"></A>
<A NAME="IDX228"></A>

<LI>

Если необходимо компилировать статически линкованные программы
(например, чтобы создать бинарный дистрибутив, или чтобы повысить
скорость, или чтобы обойти проблемы некоторых дистрибутивов RedHat
Linux), запустите <code>configure</code> так, как показано ниже:


<PRE>
shell&#62; ./configure --with-client-ldflags=-all-static \
      --with-mysqld-ldflags=-all-static
</PRE>

<A NAME="IDX229"></A>
<A NAME="IDX230"></A>
<A NAME="IDX231"></A>
<A NAME="IDX232"></A>
<A NAME="IDX233"></A>
<A NAME="IDX234"></A>
<A NAME="IDX235"></A>

<LI>

При использовании <code>gcc</code> без установленной библиотеки <code>libg++</code> или
<code>libstdc++</code> можно предписать <code>configure</code> в качестве компилятора C++
использовать <code>gcc</code>:


<PRE>
shell&#62; CC=gcc CXX=gcc ./configure
</PRE>

Если <code>gcc</code> используется как компилятор C++, то он не будет пробовать
линковаться с <code>libg++</code> или <code>libstdc++</code>. Это может оказаться полезным даже если
такие библиотеки установлены, поскольку при использовании некоторых версий
вышеназванных библиотек в прошлом у пользователей MySQL возникали
непонятные проблемы.

Ниже приводятся установки некоторых общих
переменных окружения в зависимости от используемого компилятора:

<A NAME="IDX236"></A>
<A NAME="IDX237"></A>

<TABLE BORDER>
<TR><TD><strong>Компилятор</strong> </TD><TD> <strong>Рекомендуемые опции</strong>
</TD></TR>
<TR><TD>gcc 2.7.2.1 </TD><TD>
CC=gcc CXX=gcc CXXFLAGS="-O3 -felide-constructors"
</TD></TR>
<TR><TD>egcs 1.0.3a </TD><TD>
CC=gcc CXX=gcc CXXFLAGS="-O3 -felide-constructors -fno-exceptions -fno-rtti"
</TD></TR>
<TR><TD>gcc 2.95.2 </TD><TD>
CFLAGS="-O3 -mpentiumpro" CXX=gcc CXXFLAGS="-O3 -mpentiumpro \
-felide-constructors -fno-exceptions -fno-rtti"
</TD></TR>
<TR><TD>pgcc 2.90.29 or newer </TD><TD>
CFLAGS="-O3 -mpentiumpro -mstack-align-double" CXX=gcc \
CXXFLAGS="-O3 -mpentiumpro -mstack-align-double -felide-constructors \
-fno-exceptions -fno-rtti"
</TD></TR>
</TABLE>

В большинстве случаев можно получить достаточно оптимальный бинарный код
MySQL путем использования опций предыдущей таблицы и добавления в
командной строке следующих опций:


<PRE>
--prefix=/usr/local/mysql --enable-assembler \
--with-mysqld-ldflags=-all-static
</PRE>

Другими словами, полная строка конфигурации для всех последних версий gcc
должна быть подобна приведенной ниже:


<PRE>
CFLAGS="-O3 -mpentiumpro" CXX=gcc CXXFLAGS="-O3 -mpentiumpro \
-felide-constructors -fno-exceptions -fno-rtti" ./configure \
--prefix=/usr/local/mysql --enable-assembler \
--with-mysqld-ldflags=-all-static
</PRE>

Все бинарные коды, которые мы поставляем с веб-сайта MySQL на
<a HREF="http://www.mysql.com/">http://www.mysql.com/</a>, компилируются с максимальной оптимизацией и должны
быть идеальными для большинства пользователей (see section <A HREF="manual.ru.html#MySQL_binaries">2.2.9  Бинарные коды MySQL, скомпилированные в MySQL AB</A>). Существуют некоторые настройки, позволяющие сделать
бинарный код даже еще быстрее, но их могут выполнять только опытные
пользователи (see section <A HREF="manual.ru.html#Compile_and_link_options">5.5.3  Как компиляция и линкование влияет на скорость MySQL</A>).

Если создать код не удается и при этом выдаются ошибки с указанием
на компилятор или если компоновщик не в состоянии создать совместную
библиотеку <tt>`libmysqlclient.so.#'</tt> (<samp>`#'</samp> представляет собой номер версии), то
эту проблему можно обойти путем добавления к <code>configure</code> опции
<code>--disable-shared</code>. В этом случае <code>configure</code> не будет создавать совместную
библиотеку <tt>`libmysqlclient.so.#'</tt>.

<A NAME="IDX238"></A>
<A NAME="IDX239"></A>

<LI>

Можно сконфигурировать MySQL таким образом, чтобы не использовать
величины <code>DEFAULT</code> на столбцах не-<code>NULL</code> (т.е. на столбцах, которые не
могут принимать значение <code>NULL</code>). При указании этой опции команды <code>INSERT</code>
будут генерировать ошибку в случае, если явно не указаны  величины для
всех столбцов, которые не могут принимать значение <code>NULL</code>. Чтобы
запретить использование величин по умолчанию, запустите <code>configure</code>, как
показано ниже:

<A NAME="IDX240"></A>
<A NAME="IDX241"></A>

<PRE>
shell&#62; CXXFLAGS=-DDONT_USE_DEFAULT_FIELDS ./configure
</PRE>

<A NAME="IDX242"></A>
<A NAME="IDX243"></A>
<A NAME="IDX244"></A>

<LI>

По умолчанию в MySQL используется кодировка ISO-8859-1 (Latin1). Для
изменения кодировки, принятой по умолчанию, следует применить опцию
<code>--with-charset</code>:


<PRE>
shell&#62; ./configure --with-charset=CHARSET
</PRE>

<code>CHARSET</code> может принимать одно из следующих значений: <code>big5</code>, <code>cp1251</code>,
<code>cp1257</code>, <code>czech</code>, <code>danish</code>, <code>dec8</code>, <code>dos</code>, <code>euc_kr</code>, <code>gb2312</code>, <code>gbk</code>, <code>german1</code>, <code>hebrew</code>,
<code>hp8</code>, <code>hungarian</code>, <code>koi8_ru</code>, <code>koi8_ukr</code>, <code>latin1</code>, <code>latin2</code>, <code>sjis</code>, <code>swe7</code>, <code>tis620</code>,
<code>ujis</code>, <code>usa7</code> или <code>win1251ukr</code> (see section <A HREF="manual.ru.html#Character_sets">4.6.1  Набор символов, применяющийся для записи данных и сортировки</A>). Если требуется преобразовывать символы между сервером и
клиентом, следует рассмотреть команду <code>SET CHARACTER SET</code> (see section <A HREF="manual.ru.html#SET_OPTION">5.5.6  Синтаксис команды <code>SET</code></A>).

<A NAME="IDX245"></A>
<strong>Предупреждение</strong>: если набор символов изменяется после создания
таблиц, необходимо запустить <code>myisamchk -r -q --set-characted-set=charset</code> на каждой таблице. В
противном случае индексы могут сортироваться неправильно (такое может
случиться, если вы установите MySQL, создадите ряд таблиц, затем
переконфигурируете MySQL с целью использования другого набора символов и
заново установите MySQL).

С помощью опции <code>--with-extra-charsets=LIST</code> можно
определить, какие дополнительные кодировки необходимо скомпилировать в
данном сервере.

Здесь <code>LIST</code> либо представляет собой разделенный пробелами
список кодировок, либо имеет значение <code>complex</code> для включения всех символов,
которые не могут быть загружены динамически, либо имеет значение <code>all</code> для
включения всех кодировок в бинарники.

<LI>

Для конфигурации MySQL с кодом отладки используйте опцию <code>--with-debug</code>:


<PRE>
shell&#62; ./configure --with-debug
</PRE>

Задание этой опции вызывает подключение надежного распределителя памяти,
который может найти некоторые ошибки и обеспечить вывод информации о том,
что происходит (see section <A HREF="manual.ru.html#Debugging_server">D.1  Отладка сервера MySQL</A>).

<LI>

Если клиентские программы используют потоки, то необходимо также
скомпилировать поддерживающую потоки версию клиентской библиотеки
MySQL с опцией конфигурации <code>--enable-thread-safe-client</code>. При указании
этой опции будет создана библиотека <code>libmysqlclient_r</code>, с которой
следует линковать потоковые приложения (see section <A HREF="manual.ru.html#Threaded_clients">8.4.8  Как создать клиентскую программу с потоками</A>).

<LI>

Опции, относящиеся к конкретным системам, можно найти в разделах
данного руководства, в которых описываются особенности различных
операционных систем (see section <A HREF="manual.ru.html#Operating_System_Specific_Notes">2.6  Заметки по операционным системам</A>).
</UL>



<H3><A NAME="Installing_source_tree" HREF="manual.ru_toc.html#Installing_source_tree">2.3.4  Установка из экспериментального набора исходных кодов</A></H3>

<P>
<A NAME="IDX246"></A>
<A NAME="IDX247"></A>
<A NAME="IDX248"></A>

</P>
<P>
<strong>Предупреждение</strong>: этот раздел необходимо читать только в том случае, если вы
хотите помочь нам в тестировании нового кода. Пользователи, которые просто
хотят установить MySQL и запустить его на своей системе, должны
использовать стандартную версию дистрибутива (либо исходный код, либо
бинарный дистрибутив).

</P>
<P>
Чтобы получить самый последний из разработанных наборов исходных кодов,
используйте следующие инструкции:

</P>

<OL>
<LI>

Загрузите программу <code>BitKeeper</code> с
<a HREF="http://www.bitmover.com/cgi-bin/download.cgi">http://www.bitmover.com/cgi-bin/download.cgi</a>. Для доступа к нашему
хранилищу вам понадобится версия <code>Bitkeeper</code> 3.0 или более новая.

<LI>

Выполните инструкции по установке этой программы.

<LI>

После установки <code>BitKeeper</code> сначала перейдите в каталог, из которого
собираетесь работать, затем используйте одну из приведенных ниже команд, 
для получения желаемой копии ветви MySQL. 

Чтобы клонировать ветку 3.23:


<PRE>
shell&#62; bk clone bk://mysql.bkbits.net/mysql-3.23 mysql-3.23
</PRE>

Чтобы клонировать ветку 4.0:


<PRE>
shell&#62; bk clone bk://mysql.bkbits.net/mysql-4.0 mysql-4.0
</PRE>

Чтобы клонировать ветку 4.1:


<PRE>
shell&#62; bk clone bk://mysql.bkbits.net/mysql-4.1 mysql-4.1
</PRE>

В предыдущих примерах набор исходных кодов будет установлен в подкаталогах
<tt>`mysql-3-23/'</tt>, <tt>`mysql-4.0/'</tt> или <tt>`mysql-4.1/'</tt> вашего текущего каталога. 

Если вы находитесь за брендмауером, и можете только делать HTTP-запросы, вы можете
также использовать BitKeeper по HTTP. 

Если вы используете прокси-сервер, просто установите переменную окружения 
<code>http_proxy</code>: 


<PRE>
shell&#62; export http_proxy="http://your.proxy.server:8080/"
</PRE>

И теперь просто замените <code>bk://</code> на <code>http://</code> когда будете делать клонирование. Например: 


<PRE>
shell&#62; bk clone http://mysql.bkbits.net/mysql-4.1 mysql-4.1
</PRE>

Первоначальная загрузка набора исходных кодов может потребовать времени в
зависимости от скорости вашего соединения; будьте терпеливы.

<LI>

Чтобы запустить следующий набор команд, вам понадобятся программы GNU
<code>make</code>, <code>autoconf 2.53</code> (или новее), <code>automake 1.5</code>,
<code>libtool 1.4</code> и <code>m4</code>. Программа <code>automake 1.7</code> (или новее) еще
не работает. 

Если вы хотите настроить MySQL 4.1, вам также потребуется <code>bison 1.75</code>.
Более старые версии <code>bison</code> могут давать такую ошибку:
<code>sql_yacc.yy:#####: fatal error: maximum table size (32767) exceeded</code>. На
самом деле максимальный размер таблиц не превышается, как утверждает это
сообщение, но просто-напросто такое сообщение есть следствие ошибки в более
ранних версиях <code>bison</code>. 

Типичные команды к выполнению в оболочке: 


<PRE>
cd mysql-4.0
bk -r get -Sq
aclocal; autoheader; autoconf; automake
(cd innobase ; aclocal; autoheader; autoconf; automake) # для InnoDB
(cd bdb/dist ; sh s_all ) # для Berkeley DB
./configure  # Ваши любимые опции здесь
make
</PRE>

Если вы получаете некие странные сообщения на этом этапе  - удостоверьтесь,
что у вас действительно стоит <code>libtool</code>! 

Собрание наших стандартных конфигурационных скриптов находится в
подкаталоге <tt>`BUILD/'</tt>. Если вы предпочитаете наиболее легкий путь, можно
использовать скрипт <tt>`BUILD/compile-pentium-debug'</tt>. При компилировании с
использованием другой архитектуры модифицируйте этот скрипт путем удаления
флагов, относящихся к Pentium.

<LI>

После выполнения компиляции запустите <code>make install</code>. Следует проявлять
осторожность при работе на машине, находящейся в эксплуатации; данная
команда может выполнить установку поверх вашей существующей
установленной версии. Если у вас уже установлена иная версия MySQL, мы
рекомендуем запускать <code>./configure</code> со значениями для опций <code>prefix</code>,
<code>with-tcp-port</code> и <code>unix-socket-path</code>, отличными от тех, что были
использованы для сервера, находящегося в эксплуатации.

<LI>

Усиленно нагружая свою новую инсталляцию, попытайтесь добиться отказа
новых возможностей. Начинайте с запуска <code>make test</code> (see section <A HREF="manual.ru.html#MySQL_test_suite">9.1.2  Пакет тестирования MySQL</A>).

<LI>

Если вам удастся дойти до этапа <code>make</code> и дистрибутив не будет
компилироваться, просьба сообщить нам об этом по адресу
<a HREF="mailto:bugs@lists.mysql.com">bugs@lists.mysql.com</a>. Просьба информировать нас и в том случае, если
вы установили последнюю версию требуемых инструментальных средств GNU
и они терпят крах при попытке обработать наш конфигурационный файл.
Однако если при выполнении <code>aclocal</code> вы получите ошибку <code>command not
found</code> или возникнет аналогичная проблема, об этом сообщать не надо. В
таком случае следует убедиться, что у вас установлены все необходимые
инструментальные программы и что ваша переменная <code>PATH</code> указана
правильно, чтобы оболочка могла найти их.

<LI>

Для того чтобы получить набор исходных кодов после начальной операции
<code>bk clone</code>, необходимо периодически запускать <code>bk pull</code> для получения
обновлений.

<LI>

Вы можете изучить историю изменений дерева исходных кодов, чтобы
увидеть все отличия в них - для этого следует использовать <code>bk
sccstool</code>. При обнаружении каких-либо отличий, которые покажутся вам
странными, или кода, по которому возникают вопросы, не раздумывайте -
посылайте письмо на <a HREF="mailto:internals@lists.mysql.com">internals@lists.mysql.com</a>. Кроме того, если вы
считаете, что у вас есть лучшие идеи по разработке, отправьте по тому
же адресу сообщение со своим патчем. <code>bk diffs</code> создает патч после
внесения изменений в исходный код. Если у вас нет времени написать
код, реализующий вашу идею, просто пришлите ее описание.

<LI>

BitKeeper имеет хорошую вспомогательную программу, которая доступна
посредством <code>bk helptool</code>.

<LI>

Внимание: любой commit (<code>bk ci</code> или <code>bk citool</code>) инициирует постинг 
сообщения с изменениями в наш внутренний список рассылки (internals).
В общем случае, вам не нужно использовать commit (поскольку публично-доступное
дерево не допустит <code>bk push</code>), но скорее, метод <code>bk diffs</code>, описанный ранее. 
</OL>

<P>
Вы также можете просматривать изменения, комментарии и исходный код в онлайн, например,
по адресу <a HREF="http://mysql.bkbits.net:8080/mysql-4.1">http://mysql.bkbits.net:8080/mysql-4.1</a> для MySQL 4.1.

</P>
<P>
Руководство находится в отдельном дереве, которое можно клонировать так: 

</P>

<PRE>
shell&#62; bk clone bk://mysql.bkbits.net/mysqldoc mysqldoc
</PRE>



<H3><A NAME="Compilation_problems" HREF="manual.ru_toc.html#Compilation_problems">2.3.5  Проблемы с компиляцией?</A></H3>

<P>
<A NAME="IDX249"></A>
<A NAME="IDX250"></A>
<A NAME="IDX251"></A>
<A NAME="IDX252"></A>
<A NAME="IDX253"></A>

</P>
<P>
На Solaris или Linux с использованием компилятора <code>gcc</code> все программы MySQL у нас
компилируются чисто и без каких-либо предупреждений. В других системах
могут возникать предупреждения из-за различий включаемых системных файлов
(по поводу предупреждений, которые могут возникать при использовании
потоков <code>MIT-pthreads</code>, обращайтесь к разделу see section <A HREF="manual.ru.html#MIT-pthreads">2.3.6  Замечания по потокам MIT-pthreads</A>).
Относительно других проблем сверьтесь с приведенным ниже списком.

</P>
<P>
Решение многих проблем предполагает выполнение переконфигурирования. В
случаях, когда переконфигурирование действительно необходимо, следует
учитывать следующее:

</P>
<P>
<A NAME="IDX254"></A>
<A NAME="IDX255"></A>
<A NAME="IDX256"></A>

</P>

<UL>
<LI>

Если <code>configure</code> запускается после того, как эта команда уже
запускалась, то можно использовать информацию, которая была собрана во
время предыдущего вызова команды (такая информация хранится в
<tt>`config.cache'</tt>). При запуске <code>configure</code> ищет данный файл и, если он
существует, читает его содержимое, исходя из предположения, что данная
информация все еще правильна. При выполнении переконфигурации это
предположение является некорректным.

<LI>

Каждый раз при запуске <code>configure</code> необходимо опять запускать <code>make</code> для
перекомпилирования. Однако, возможно, вначале вам потребуется удалить
старые объектные файлы из предыдущих компоновок, поскольку они были
скомпилированы с использованием других опций конфигурации.

Чтобы не допустить использования старой конфигурационной информации или
объектных файлов, перед перезапуском <code>configure</code> запустите следующие
команды:


<PRE>
shell&#62; rm config.cache
shell&#62; make clean
</PRE>

В качестве альтернативного варианта можно использовать команду <code>make
distclean</code>.

В следующем списке представлены некоторые проблемы компилирования MySQL,
которые, как оказалось, возникают наиболее часто:

<A NAME="IDX257"></A>
<A NAME="IDX258"></A>
<A NAME="IDX259"></A>
<A NAME="IDX260"></A>
<A NAME="IDX261"></A>
<A NAME="IDX262"></A>

<LI>

Если при компиляции <tt>`sql_yacc.cc'</tt> вы получаете ошибки, подобные
представленным ниже, то, возможно, произошел выход за пределы памяти
или пространства подкачки (свопинга):


<PRE>
Internal compiler error: program cc1plus got fatal signal 11
или
Out of virtual memory
или
Virtual memory exhausted
</PRE>

Проблема заключается в том, что для компиляции <tt>`sql_yacc.cc'</tt> со
встраиваемыми функциями компилятору <code>gcc</code> требуется значительное количество
памяти. Попробуйте произвести запуск <code>configure</code> с опцией <code>--with-low-memory</code>:


<PRE>
shell&#62; ./configure --with-low-memory
</PRE>

Данная опция вызывает добавление <code>-fno-inline</code> к компилируемой строке для
<code>gcc</code> и <code>-O0</code> - при использовании какого-либо другого компилятора. Даже если у
вас столько памяти и пространства для свопинга, что, по вашему мнению,
невозможно выйти за их пределы, все же стоит попытаться использовать опцию
<code>with-low-memory</code>. Эта проблема, по нашим наблюдениям, возникала даже на
системах с аппаратными реализациями, обладающими широкими возможностями;
обычно она устраняется с помощью опции <code>--with-low-memory</code>.

<LI>

По умолчанию <code>configure</code> выбирает c++ как имя компилятора и GNU c++
линкуется с <code>-lg++</code>. При использовании <code>gcc</code> этот режим работы может
вызывать такие проблемы в процессе конфигурации, как:

<A NAME="IDX263"></A>


<PRE>
configure: error: installation or configuration problem:
C++ compiler cannot create executables.
</PRE>

<A NAME="IDX264"></A>
<A NAME="IDX265"></A>

Во время компиляции могут также возникать проблемы, относящиеся к <code>g++</code>,
<code>libg++</code> или <code>libstdc++</code>. Одна из причин их возникновения заключается в том,
что, возможно, у вас нет <code>g++</code> или есть <code>g++</code>, но нет библиотеки <code>libg++</code> или
<code>libstdc++</code>. Следует изучить файл <tt>`config.log'</tt> - по нему вы должны точно
определить причину, по которой не работал компилятор c++ ! Чтобы обойти
эти проблемы, можно в качестве компилятора C++ использовать gcc.
Попробуйте установить переменную окружения <code>CXX</code> в <code>gcc -O3</code>. Например:

<A NAME="IDX266"></A>
<A NAME="IDX267"></A>


<PRE>
shell&#62; CXX="gcc -O3" ./configure
</PRE>

Эта команда работает, поскольку gcc компилирует исходные коды C++ так же
хорошо, как и <code>g++</code>, но по умолчанию не линкует <code>libg++</code> или <code>libstdc++</code>.
Есть, конечно, и другая возможность устранения этих проблем, которая
заключается в установке <code>g++</code>, <code>libg++</code> и <code>libstdc++</code>. Однако мы не
рекомендовали бы использовать <code>libg++</code> или <code>libstdc++</code> с MySQL, поскольку это
только увеличит размер бинарного кода <code>mysqld</code> без предоставления каких-либо
преимуществ. Некоторые версии этих библиотек в прошлом также вызывали
непонятные проблемы у пользователей MySQL.

<LI>

Если процесс компиляции завершается аварийно и выводятся такие ошибки,
как приведены ниже, то вам следует сделать апгрейд своей версии <code>make</code>
до GNU <code>make</code>:


<PRE>
making all in mit-pthreads
make: Fatal error in reader: Makefile, line 18:
Badly formed macro assignment
или
make: file `Makefile' line 18: Must be a separator (:
или
pthread.h: No such file or directory
</PRE>

<A NAME="IDX268"></A>
<A NAME="IDX269"></A>
<A NAME="IDX270"></A>
<A NAME="IDX271"></A>

Операционные системы Solaris и FreeBSD, как известно, имеют ненадежные
программы <code>make</code>. 

Известно также, что версия GNU <code>make</code> 3.75 работает.

<A NAME="IDX272"></A>
<A NAME="IDX273"></A>
<A NAME="IDX274"></A>
<A NAME="IDX275"></A>
<A NAME="IDX276"></A>
<A NAME="IDX277"></A>
<A NAME="IDX278"></A>
<A NAME="IDX279"></A>

<LI>

Если вы хотите определить флаги для использования их компиляторами C
или C++, следует добавить флаги к переменным окружения <code>CFLAGS</code> и
<code>CXXFLAGS</code>. Точно так же можно также указать имена компиляторов,
используя <code>CC</code> и <code>CXX</code>. Например:


<PRE>
shell&#62; CC=gcc
shell&#62; CFLAGS=-O3
shell&#62; CXX=gcc
shell&#62; CXXFLAGS=-O3
shell&#62; export CC CFLAGS CXX CXXFLAGS
</PRE>

В разделе section <A HREF="manual.ru.html#MySQL_binaries">2.2.9  Бинарные коды MySQL, скомпилированные в MySQL AB</A> приведен список полезных для
различных систем определений флагов.

<LI>

При получении сообщения об ошибке, подобного приведенному ниже,
необходимо модернизировать ваш компилятор <code>gcc</code>:


<PRE>
client/libmysql.c:273: parse error before `__attribute__'
</PRE>

Компилятор <code>gcc</code> 2.8.1 известен как работающий, но мы рекомендуем вместо
него использовать <code>gcc</code> 2.95.2 или <code>egcs</code> 1.0.3a.

<LI>

Если при компиляции <code>mysqld</code> вы получаете ошибки, подобные приведенным
ниже, то это означает, что команда <code>configure</code> некорректно определила
тип последнего аргумента в функциях <code>accept()</code>, <code>getsockname()</code> или
<code>getpeername()</code>:


<PRE>
cxx: Error: mysqld.cc, line 645: In this statement, the referenced
type of the pointer value "&#38;length" is "unsigned long", which
is not compatible with "int".
new_sock = accept(sock, (struct sockaddr *)&#38;cAddr, &#38;length);
</PRE>

Чтобы устранить эту ошибку, отредактируйте файл <tt>`config.h'</tt> (который
генерируется <code>configure</code>). Найдите в нем следующие строки:


<PRE>
/* Define as the base type of the last arg to accept */
#define SOCKET_SIZE_TYPE XXX
</PRE>

и измените <code>XXX</code> на <code>size_t</code> или <code>int</code> - в зависимости от своей операционной
системы (учтите, что эти действия необходимо будет повторять каждый раз
при запуске <code>configure</code>, поскольку configure восстанавливает файл
<tt>`config.h'</tt>).

<LI>

Файл <tt>`sql_yacc.cc'</tt> генерируется из <tt>`sql_yacc.yy'</tt>. Обычно в процессе сборки
не требуется создавать <tt>`sql_yacc.cc'</tt>, поскольку MySQL поставляется с уже
сгенерированной копией. Однако если действительно необходимо создать
этот файл заново, то можно столкнуться со следующей ошибкой:


<PRE>
"sql_yacc.yy", line xxx fatal: default action causes potential...
</PRE>

Это признак того, что ваша версия <code>yacc</code> является неполной. Возможно,
следует установить <code>bison</code> (GNU-версия yacc) и использовать вместо <code>yacc</code>.

<LI>

При необходимости отладки <code>mysqld</code> или клиента MySQL запустите <code>configure</code>
с опцией <code>--with-debug</code>, затем перекомпилируйте и слинкуйте эти
программы с новой клиентской библиотекой (see section <A HREF="manual.ru.html#Debugging_client">D.2  Отладка клиента MySQL</A>).
</UL>



<H3><A NAME="MIT-pthreads" HREF="manual.ru_toc.html#MIT-pthreads">2.3.6  Замечания по потокам MIT-pthreads</A></H3>

<P>
<A NAME="IDX280"></A>
<A NAME="IDX281"></A>
<A NAME="IDX282"></A>

</P>

<P>
В этом разделе описываются некоторые аспекты использования потоков
MIT-pthreads.

</P>
<P>
Следует иметь в виду, что под Linux использовать потоки MIT-pthreads
нельзя, для этого необходимо установить LinuxThreads! See section <A HREF="manual.ru.html#Linux">2.6.1  Примечания к Linux (Все версии Linux)</A>.

</P>
<P>
Если ваша система сама по себе не обеспечивает поддержку потоков, то
необходимо скомпоновать MySQL, используя пакет поддержки MIT-pthreads. К
таким системам относятся старые системы FreeBSD, SunOS 4.x, Solaris 2.4 и
более ранние, а также некоторые другие (see section <A HREF="manual.ru.html#Which_OS">2.2.5  Операционные системы, поддерживаемые MySQL</A>).

</P>
<P>
Заметьте, с версии MySQL 4.0.2 потоки MIT более не присутствуют в поставке исходных
текстов. Если вам действительно нужен этот пакет, вы можете его забрать с 
http://www.mysql.com/Downloads/Contrib/pthreads-1_60_beta6-mysql.tar.gz

</P>
<P>
После загрузки, распакуйте этот архив в каталог исходных текстов MySQL.
Создастся новый каталог <code>mit-pthreads</code>.

</P>


<UL>
<LI>

Для большинства систем можно обеспечить использование потоков
MIT-pthreads при помощи запуска <code>configure</code> с опцией <code>--with-mit-threads</code>:


<PRE>
shell&#62; ./configure --with-mit-threads
</PRE>

При использовании потоков MIT-pthreads не поддерживается возможность
сборки MySQL в каталоге, не содержащем исходный код, поскольку мы хотим
минимизировать наши изменения в данном коде.

<LI>

Проверки, определяющие, используются ли потоки MIT-pthreads,
производятся только во время этапа конфигурационного процесса,
относящегося к серверному коду. Если дистрибутив сконфигурирован с
использованием <code>--without-server</code> для сборки только клиентского кода,
то клиенты не будут знать, применяются ли потоки MIT-pthreads, и будут
использовать подключения через сокеты Unix по умолчанию. Поскольку сокеты Unix
не работают с потоками MIT-pthreads на некоторых платформах, то при запуске
клиентских программ следует использовать <code>-h</code> или <code>--host</code>.

<LI>

При компиляции MySQL с использованием потоков MIT-pthreads
блокирование системы отключено по умолчанию из соображений
производительности. Можно предписать серверу использовать системную
блокировку с помощью опции <code>--use-external-locking</code>. Это только
необходимо если вы собираетесь использовать два MySQL-сервера на одних
и тех же файлах данных (не рекомендуется!).

<LI>

Иногда потоковой команде <code>bind()</code> не удается подсоединить сокет без
какого-либо сообщения об ошибке (по крайней мере, под Solaris). В
результате все подключения к серверу обрываются. Например:


<PRE>
shell&#62; mysqladmin version
mysqladmin: connect to server at '' failed;
error: 'Can't connect to mysql server on localhost (146)'
</PRE>

Для решения этой проблемы следует завершить выполнение сервера <code>mysqld</code> и
перезапустить его. У нас это происходило только в тех случаях, когда мы
прерывали работу сервера и сразу же снова его запускали.

<LI>

При использовании потоков MIT-pthreads системный вызов функции <code>sleep()</code> 
не прерывается с помощью <code>SIGINT</code> (<code>break</code>). Это заметно только в том
случае, если запускать <code>mysqladmin --sleep</code>. Следует ждать окончания
работы <code>sleep()</code>, прежде чем прерывание будет обслужено и процесс
завершит работу.

<LI>

При линковании можно получить предупреждающие сообщения, подобные
приведенным ниже (по крайней мере под Solaris); их можно игнорировать:


<PRE>
ld: warning: symbol `_iob' has differing sizes:
    (file /my/local/pthreads/lib/libpthread.a(findfp.o) value=0x4;
file /usr/lib/libc.so value=0x140);
    /my/local/pthreads/lib/libpthread.a(findfp.o) definition taken
ld: warning: symbol `__iob' has differing sizes:
    (file /my/local/pthreads/lib/libpthread.a(findfp.o) value=0x4;
file /usr/lib/libc.so value=0x140);
    /my/local/pthreads/lib/libpthread.a(findfp.o) definition taken
</PRE>

<LI>

Некоторые другие предупреждения также можно игнорировать:


<PRE>
implicit declaration of function `int strtoll(...)'
implicit declaration of function `int strtoul(...)'
</PRE>

<LI>

Нам не удалось добиться совместной работы <code>readline</code> с потоками
MIT-pthreads (это не является необходимым, но для кого-то может
представлять интерес).
</UL>



<H3><A NAME="Windows_source_build" HREF="manual.ru_toc.html#Windows_source_build">2.3.7  Дистрибутив исходного кода для Windows</A></H3>

<P>
Вам потребуются следующие средства:

</P>

<UL>
<LI>

Компилятор VC++ 6.0 (усовершенствованный с помощью служебных пакетов 4
SP или 5 SP и пакета предварительной обработки) Пакет предварительной
обработки необходим для макроассемблера. Более подробная информация
находится на: <a HREF="http://msdn.microsoft.com/vstudio/sp/vs6sp5/faq.asp">http://msdn.microsoft.com/vstudio/sp/vs6sp5/faq.asp</a>.
<LI>

Дистрибутив исходного кода MySQL для Windows, который может быть
загружен с <a HREF="http://www.mysql.com/downloads/">http://www.mysql.com/downloads/</a>.
</UL>

<P>
Сборка MySQL

</P>

<OL>
<LI>

Создайте рабочий каталог (т.е. <code>workdir</code>).
<LI>

Распакуйте дистрибутив исходного кода в вышеупомянутом каталоге.
<LI>

Запустите компилятор VC++ 6.0.
<LI>

В меню <code>File</code> выберите <code>Open Workspace</code>.
<LI>

Откройте рабочую область <code>mysql.dsw</code>, находящуюся в рабочем каталоге.
<LI>

В меню <code>Build</code> выберите подменю <code>Set Active Configuration</code>.
<LI>

Выберите в появившемся окне <code>mysqld</code> - <code>Win32 Debug</code> и нажмите <code>OK</code>.
<LI>

Нажмите клавишу <code>F7</code>, чтобы начать процесс построения отладочных версий
сервера, библиотек и некоторых клиентских приложений.
<LI>

По окончании компиляции скопируйте библиотеки и исполняемые файлы в
отдельный каталог.
<LI>

Тем же способом скомпилируйте рабочие версии (релизы), которые вам
нужны.
<LI>

Создайте каталог для всего, что нужно MySQL, т.е. <tt>`c:\mysql'</tt> 
<LI>

Из каталога <code>workdir</code> скопируйте в каталог <tt>`c:\mysql'</tt> следующие
подкаталоги:


<UL>
<LI>Data (данные)

<LI>Docs (документация)

<LI>Share (совместно используемые ресурсы)

</UL>

<LI>

Создайте каталог <tt>`c:\mysql\bin'</tt> и скопируйте в него все скомпилированные
перед этим серверы и клиенты.
<LI>

При желании можете также создать каталог <tt>`lib'</tt> и скопировать в него
скомпилированные ранее библиотеки.
<LI>

Произведите очистку, используя Visual Studio.

Установите и запустите сервер тем же способом, что и для бинарного
дистрибутива для Windows (see section <A HREF="manual.ru.html#Windows_prepare_environment">2.1.2.2  Подготовка конфигурации MySQL для Windows</A>).
</OL>



<H2><A NAME="Post-installation" HREF="manual.ru_toc.html#Post-installation">2.4  Послеустановочные настройка и тестирование</A></H2>

<P>
<A NAME="IDX283"></A>
<A NAME="IDX284"></A>
<A NAME="IDX285"></A>

</P>

<P>
После установки MySQL (из бинарного дистрибутива или исходного кода)
необходимо проинициализировать таблицы привилегий, запустить сервер и
убедиться, что сервер работает нормально. Можно также организовать
автоматический запуск и остановку сервера, когда операционная система
соответственно начинает и прекращает работу.

</P>
<P>
Обычно при установке из исходного кода для установки таблиц привилегий и
запуска сервера нужно выполнить следующие команды:

</P>
<P>
<A NAME="IDX286"></A>

</P>

<PRE>
shell&#62; ./scripts/mysql_install_db
shell&#62; cd mysql_installation_directory
shell&#62; ./bin/safe_mysqld --user=mysql &#38;
</PRE>

<P>
Для бинарного дистрибутива (но не для пакетов RPM или pkg) сделайте так:

</P>

<PRE>
shell&#62; cd mysql_installation_directory
shell&#62; ./scripts/mysql_install_db
shell&#62; ./bin/safe_mysqld --user=mysql &#38;
</PRE>

<P>
или

</P>

<PRE>
shell&#62; ./bin/mysqld_safe --user=mysql &#38;
</PRE>

<P>
Если вы используете MySQL 4.x.

</P>
<P>
Эти операции создают базу данных <code>mysql</code>, которая будет поддерживать все
привилегии доступа к базе данных, базу данных <code>test</code>, которую можно
использовать для тестирования MySQL, а также записи привилегий для
пользователя, который запускает <code>mysql_install_db</code> и для пользователя <code>root</code>
(без каких-либо паролей). При этом также запускается сервер <code>mysqld</code>.

</P>
<P>
<code>mysql_install_db</code> не перезаписывает старые таблицы привилегий, так что ее
запуск будет безопасным в любом случае. Если вам не нужна база данных
<code>test</code>, ее можно удалить с помощью <code>mysqladmin -u root drop test</code>.

</P>
<P>
Тестирование проще всего выполнить из каталога наивысшего уровня
дистрибутива MySQL. Для бинарного дистрибутива таковым является ваш
каталог инсталляции (обычно что-нибудь вроде <tt>`/usr/local/mysql'</tt>). Для
дистрибутива в виде исходного кода это - главный каталог вашего набора
исходных кодов MySQL.

</P>
<P>
<A NAME="IDX287"></A>

</P>
<P>
В командах, представленных в настоящем разделе и последующих подразделах,
<code>BINDIR</code> представляет собой путь к тому местоположению, где устанавливаются
программы вроде <code>mysqladmin</code> и <code>safe_mysqld</code>. Для бинарного дистрибутива это
каталог <tt>`bin'</tt> внутри дистрибутива. Для дистрибутива в виде исходного кода
<code>BINDIR</code> может представлять собой <tt>`/usr/local/bin'</tt>, если при запуске
<code>configure</code> не указан иной, чем <tt>`/usr/local'</tt> инсталляционный каталог.
<code>EXECDIR</code> - место, где устанавливается сервер <code>mysqld</code>. Для бинарного
дистрибутива это то же самое, что и <code>BINDIR</code>. Для дистрибутива в виде
исходного кода <code>EXECDIR</code> может представлять собой <tt>`/usr/local/libexec'</tt>.

</P>
<P>
Подробное описание тестирования:
<A NAME="IDX288"></A>

</P>

<OL>
<LI>

Если необходимо, запустите сервер <code>mysqld</code> и установите исходные
таблицы привилегий MySQL, содержащие те привилегии, которые
определяют, каким способом пользователям разрешено подключаться к
серверу. Обычно это делается с помощью скрипта <code>mysql_install_db</code>:


<PRE>
shell&#62; scripts/mysql_install_db
</PRE>

Как правило, <code>mysql_install_db</code> требует запуска только первый раз при
установке MySQL. Таким образом, если производится модернизация
существующей установки, то данный этап можно пропустить (однако скрипт
<code>mysql_install_db</code> совершенно безопасен для использования и не обновляет
никаких уже существующих таблицы; поэтому если у вас нет уверенности в
том, как поступать, то всегда можно запустить <code>mysql_install_db</code>). Скрипт
<code>mysql_install_db</code> создает шесть таблиц (<code>user</code>, <code>db</code>, <code>host</code>, <code>tables_priv</code>,
<code>columns_priv</code>, and <code>func</code>) в базе данных <code>mysql</code>. Описание исходных привилегий
дается в разделе See section <A HREF="manual.ru.html#Default_privileges">4.3.4  Задание изначальных привилегий MySQL</A>. Если в двух
словах, то эти привилегии позволяют пользователю root MySQL делать все,
что угодно, и любому пользователю позволяют создавать или использовать
базы данных с именем <code>test</code> или начинающимся с <code>test_</code>. Если таблицы
привилегий не установлены, то в системном журнале при запуске сервера
появится следующая ошибка:

<A NAME="IDX289"></A>

<PRE>
mysqld: Can't find file: 'host.frm'
</PRE>

Такая ошибка может появиться и в случае бинарного дистрибутива MySQL,
если вы не начали работу MySQL с точного выполнения команды 
<tt>`./bin/safe_mysqld'</tt>! See section <A HREF="manual.ru.html#safe_mysqld">4.7.2  <code>safe_mysqld</code>, оболочка <code>mysqld</code></A>.
Возможно, вам потребуется запускать <code>mysql_install_db</code> как <code>root</code>. Однако при
желании вы можете запускать сервер MySQL как непривилегированный (не-<code>root</code>)
пользователь, при условии, что этот пользователь может только читать файлы
из каталога базы данных и записывать в него файлы. Инструкции по запуску
MySQL в качестве непривилегированного пользователя даются в разделе See section <A HREF="manual.ru.html#Changing_MySQL_user">A.3.2  Запуск MySQL от обычного пользователя</A>. Если возникнут проблемы с 
<code>mysql_install_db</code>, обращайтесь к разделу See section <A HREF="manual.ru.html#mysql_install_db">2.4.1  Проблемы при запуске <code>mysql_install_db</code></A>. Дистрибутив MySQL обеспечивает несколько вариантов
запуска скрипта <code>mysql_install_db</code>:


<UL>
<LI>

Чтобы изменить исходные привилегии, которые устанавливаются в
таблицах привилегий, вам, возможно, потребуется отредактировать 
<code>mysql_install_db</code> перед запуском. Это полезно, если нужно установить
MySQL на нескольких машинах с одними и теми же привилегиями. В
таком случае вам, возможно, потребуется только добавить несколько
дополнительных команд <code>INSERT</code> к таблицам <code>mysql.user</code> и <code>mysql.db</code>!
<LI>

Если необходимо изменить записи в таблицах привилегий после их
установки, то можно запустить <code>mysql_install_db</code>, затем использовать
<code>mysql -u root mysql</code> для доступа к таблицам привилегий как
пользователь MySQL с привилегиями <code>root</code> и применять команды SQL для
модификации таблиц привилегий напрямую.
<LI>

Можно также создать таблицы привилегий полностью заново после того,
как они были уже созданы. Это можно сделать после установки таблиц,
а затем воссоздать после редактирования <code>mysql_install_db</code>.
</UL>

Более подробная информация о приведенных выше альтернативах находится в
разделе See section <A HREF="manual.ru.html#Default_privileges">4.3.4  Задание изначальных привилегий MySQL</A>.

<LI>

Запустите сервер MySQL как показано ниже:


<PRE>
shell&#62; cd mysql_installation_directory
shell&#62; bin/safe_mysqld &#38;
</PRE>

Если возникнут проблемы с запуском сервера, See section <A HREF="manual.ru.html#Starting_server">2.4.2  Проблемы при запуске сервера MySQL</A>.

<LI>

Используйте <code>mysqladmin</code> для проверки, что сервер работает. Простую
проверку того, что сервер функционирует и отвечает на подключения,
обеспечивают следующие команды:


<PRE>
shell&#62; BINDIR/mysqladmin version
shell&#62; BINDIR/mysqladmin variables
</PRE>

Вывод из <code>mysqladmin version</code> будет иметь небольшие различия в зависимости
от используемой платформы и версии MySQL, но должен быть похож на
приведенный ниже:


<PRE>
shell&#62; BINDIR/mysqladmin version
mysqladmin  Ver 8.14 Distrib 3.23.32, for linux on i586
Copyright (C) 2000 MySQL AB &#38; MySQL Finland AB &#38; TCX DataKonsult AB
This software comes with ABSOLUTELY NO WARRANTY. This is free software,
and you are welcome to modify and redistribute it under the GPL license.

Server version          3.23.32-debug
Protocol version        10
Connection              Localhost via Unix socket
TCP port                3306
UNIX socket             /tmp/mysql.sock
Uptime:                 16 sec

Threads: 1  Questions: 9  Slow queries: 0
Opens: 7  Flush tables: 2  Open tables: 0
Queries per second avg: 0.000
Memory in use: 132K  Max memory used: 16773K
</PRE>

Чтобы получить представление о том, что еще можно делать с помощью
<code>BINDIR/mysqladmin</code>, запустите эту команду с опцией <code>--help</code>.

<LI>

Убедитесь, что можете остановить сервер:
<A NAME="IDX290"></A>


<PRE>
shell&#62; BINDIR/mysqladmin -u root shutdown
</PRE>

<LI>

Убедитесь, что можете перезапустить сервер. Делайте это, используя
<code>safe_mysqld</code> или путем прямого вызова <code>mysqld</code>. Например:

<A NAME="IDX291"></A>
<A NAME="IDX292"></A>
<A NAME="IDX293"></A>


<PRE>
shell&#62; BINDIR/safe_mysqld --log &#38;
</PRE>

Если <code>safe_mysqld</code> терпит неудачу, попытайтесь запустить команду из каталога
установки MySQL (если вы уже не там). Если команда по-прежнему не
работает, см. раздел See section <A HREF="manual.ru.html#Starting_server">2.4.2  Проблемы при запуске сервера MySQL</A>.

<LI>

Запустите несколько простых тестов, чтобы  убедиться, что  сервер 
работает. Вывод  должен  быть  похож  на  приведенный  ниже:


<PRE>
shell&#62; BINDIR/mysqlshow
+-----------+
| Databases |
+-----------+
| mysql     |
+-----------+

shell&#62; BINDIR/mysqlshow mysql
Database: mysql
+--------------+
|    Tables    |
+--------------+
| columns_priv |
| db           |
| func         |
| host         |
| tables_priv  |
| user         |
+--------------+

shell&#62; BINDIR/mysql -e "SELECT host,db,user FROM db" mysql
+------+--------+------+
| host | db     | user |
+------+--------+------+
| %    | test   |      |
| %    | test_% |      |
+------+--------+------+
</PRE>

В подкаталоге <tt>`sql-bench'</tt> каталога установки MySQL находится набор тестов
производительности, который можно использовать для сравнения работы MySQL
на различных платформах. Каталог <tt>`sql-bench/Results'</tt> содержит результаты
большого количества запусков для различных баз данных и платформ. Чтобы
запустить все тесты, выполните следующие команды:


<PRE>
shell&#62; cd sql-bench
shell&#62; run-all-tests
</PRE>

Если у вас отсутствует каталог <tt>`sql-bench'</tt>, то, вероятно, вы работаете с
пакетом RPM для бинарного дистрибутива (в пакеты RPM с дистрибутивами
исходного кода включается каталог тестов производительности). В этом
случае прежде чем использовать набор тестов производительности, необходимо
его установить. Начиная с версии MySQL 3.22, существуют RPM-файлы тестов
производительности, <tt>`mysql-bench-VERSION-i386.rpm'</tt>, которые содержат код
тестов производительности и данные. Имея дистрибутив исходного кода, можно
также запустить эти тесты в подкаталоге <tt>`tests'</tt>. Например, чтобы запустить
<tt>`auto_increment.tst'</tt>, сделайте следующее:


<PRE>
shell&#62; BINDIR/mysql -vvf test &#60; ./tests/auto_increment.tst
</PRE>

Результаты будут выводиться в файл <tt>`./tests/auto_increment.res'</tt>.
</OL>



<H3><A NAME="mysql_install_db" HREF="manual.ru_toc.html#mysql_install_db">2.4.1  Проблемы при запуске <code>mysql_install_db</code></A></H3>

<P>
<A NAME="IDX294"></A>
<A NAME="IDX295"></A>

</P>
<P>
Скрипт <code>mysql_install_db</code> предназначен только для создания новых таблиц
привилегий MySQL. Он не влияет ни на какие другие данные! А если таблицы
привилегий MySQL уже установлены, этот скрипт ничего не будет делать!

</P>
<P>
Для того чтобы создать таблицы привилегий заново, необходимо остановить
сервер <code>mysqld</code>, если он работает, и затем выполнить что-нибудь вроде:

</P>

<PRE>
mv mysql-data-directory/mysql mysql-data-directory/mysql-old
mysql_install_db
</PRE>

<P>
В этом разделе перечислены проблемы, с которыми можно столкнуться при
запуске <code>mysql_install_db</code>:

</P>
<DL COMPACT>

<DT><strong><code>mysql_install_db</code> не устанавливает таблицы привилегий</strong>
<DD>
Может оказаться, что <code>mysql_install_db</code> не в состоянии установить таблицы
привилегий и заканчивает свою работу после вывода следующих сообщений:


<PRE>
starting mysqld daemon with databases from XXXXXX
mysql daemon ended
</PRE>

В таком случае необходимо очень тщательно изучить системный журнал! Этот
журнал должен находиться в каталоге <tt>`XXXXXX'</tt>, указанном в данном сообщении
об ошибке. В нем содержится информация о том, почему не запустился <code>mysqld</code>.
Если вам не удалось разобраться в том, что произошло, при посылке отчета
об ошибке включите в него данный журнал, используя <code>mysqlbug</code>! См.раздел 
See section <A HREF="manual.ru.html#Bug_reports">1.8.1.3  Как отправлять отчеты об ошибках или проблемах</A>.

<DT><strong>Уже существует работающий демон <code>mysqld</code></strong>
<DD>
В таком случае вам вообще не следует запускать <code>mysql_install_db</code>. Скрипт
<code>mysql_install_db</code> должен запускаться только однажды при установке MySQL
первый раз.

<DT><strong>При работающем демоне <code>mysqld</code> установка второго демона не работает</strong>
<DD>
Это может случиться, когда уже существует установленный сервер MySQL, но
вы хотите произвести новую инсталляцию в другом месте (например, для
тестирования или, возможно, вам просто требуется запустить две инсталляции
в одно и то же время). Вообще говоря, такая проблема, которая возникает
при попытке запустить второй сервер, заключается в том, что второй сервер
пытается использовать тот же сокет и порт, что и старый. В этом случае 
вы можете получить следующее сообщение об ошибке: <code>Can't start
server: Bind on TCP/IP port: Address already in use</code> или <code>Can't start server:
Bind on unix socket...</code>. See section <A HREF="manual.ru.html#Installing_many_servers">4.1.3  Установка нескольких серверов на один компьютер</A>.

<DT><strong>Нет доступа для записи в <tt>`/tmp'</tt></strong>
<DD>
<A NAME="IDX296"></A>
<A NAME="IDX297"></A>
<A NAME="IDX298"></A>

Если у вас нет доступа для создания файла сокета в принятом по умолчанию
месте (в <tt>`/tmp'</tt>) или разрешения создавать временные файлы в каталоге
<tt>`/tmp'</tt>, то вы получите ошибку при запуске <code>mysql_install_db</code> или при
запуске или использовании <code>mysqld</code>. Необходимо указать другой каталог для
сокета и временных файлов следующим образом:

<A NAME="IDX299"></A>
<A NAME="IDX300"></A>
<A NAME="IDX301"></A>
<A NAME="IDX302"></A>


<PRE>
shell&#62; TMPDIR=/some_tmp_dir/
shell&#62; MYSQL_UNIX_PORT=/some_tmp_dir/mysqld.sock
shell&#62; export TMPDIR MYSQL_UNIX_PORT
</PRE>

See section <A HREF="manual.ru.html#Problems_with_mysql.sock">A.4.5  Как защитить или изменить сокет-файл MySQL <tt>`/tmp/mysql.sock'</tt></A>. Путь <tt>`some_tmp_dir'</tt> должен указывать на некоторый
каталог, для которого у вас есть доступ для записи. 
See section <A HREF="manual.ru.html#Environment_variables">E  Переменные окружения</A>. После этого у вас должна появиться возможность
запустить <code>mysql_install_db</code> и начать работу сервера с помощью следующих
команд:


<PRE>
shell&#62; scripts/mysql_install_db
shell&#62; BINDIR/safe_mysqld &#38;
</PRE>

<DT><strong>Немедленный аварийный отказ <code>mysqld</code></strong>
<DD>
Если вы работаете на версии RedHat 5.0 с версией <code>glibc</code> более старой, чем
2.0.7-5, следует позаботиться о том, чтобы установить все патчи для <code>glibc</code>!
В архивах рассылки MySQL имеется большое количество писем об этом. Ссылки
на архивы писем доступны в онлайновом режиме на <a HREF="http://lists.mysql.com/">http://lists.mysql.com/</a>.
Обращайтесь также к разделу See section <A HREF="manual.ru.html#Linux">2.6.1  Примечания к Linux (Все версии Linux)</A>. Можно
также запустить <code>mysqld</code> вручную, используя опцию <code>--skip-grant-tables</code>, и
самостоятельно добавить информацию о привилегиях, при помощи <code>mysql</code>:


<PRE>
shell&#62; BINDIR/safe_mysqld --skip-grant-tables &#38;
shell&#62; BINDIR/mysql -u root mysql
</PRE>

Из <code>mysql</code> в ручном режиме выполните команды SQL в <code>mysql_install_db</code>.
Удостоверьтесь, что после этого вы запустили <code>mysqladmin flush-privileges</code> 
или <code>mysqladmin reload</code>, чтобы сервер перегрузил таблицы привилегий.
</DL>



<H3><A NAME="Starting_server" HREF="manual.ru_toc.html#Starting_server">2.4.2  Проблемы при запуске сервера MySQL</A></H3>

<P>
<A NAME="IDX303"></A>
<A NAME="IDX304"></A>

</P>
<P>
Если вы собираетесь использовать таблицы, поддерживающие транзакции
(InnoDB, BDB), следует прежде всего создать файл <tt>`my.cnf'</tt> и установить опции
запуска для тех типов таблиц, с которыми планируется работать. 
See section <A HREF="manual.ru.html#Table_types">7  Типы  таблиц MySQL</A>.

</P>
<P>
В общем случае сервер <code>mysqld</code> запускается одним из следующих способов:

</P>

<UL>
<LI>

Вызовом <code>mysql.server</code>. Этот скрипт используется преимущественно для
запуска и останова системы. Более подробно он описан в разделе 
See section <A HREF="manual.ru.html#Automatic_start">2.4.3  Автоматический запуск и остановка MySQL</A>.

<LI>

Вызовом команды <code>safe_mysqld</code>, которая определяет соответствующие опции
для <code>mysqld</code> и затем запускает <code>mysqld</code> с этими опциями. 
See section <A HREF="manual.ru.html#safe_mysqld">4.7.2  <code>safe_mysqld</code>, оболочка <code>mysqld</code></A>.

<LI>

Относительно Windows NT/2000/XP просьба  обращаться  к  разделу 
See section <A HREF="manual.ru.html#NT_start">2.6.2.2  Запуск MySQL на Windows NT, 2000 или XP</A>.

<LI>

Вызовом <code>mysqld</code> напрямую.
</UL>

<P>
При своем запуске демон <code>mysqld</code> изменяет свой каталог на каталог данных
(<code>datadir</code>). В нем он ожидает найти журнальные файлы, файлы pid (ID
процессов) и собственно базы данных.

</P>
<P>
Местоположение каталога данных жестко устанавливается при компиляции
дистрибутива. Однако если <code>mysqld</code> ожидает найти каталог данных где-либо в
другом месте, а не там, где он действительно расположен в вашей системе,
то демон <code>mysqld</code> не будет работать правильно. Если есть проблемы с
неправильными путями, то, вызывая <code>mysqld</code> с опцией <code>--help</code>, вы можете найти
информацию о том, что разрешают опции <code>mysqld</code> и какие установки путей
приняты по умолчанию. Можно переопределить установки по умолчанию
указанием правильных имен путей как аргументов <code>mysqld</code> в командной строке
(эти опции также можно использовать с <code>safe_mysqld</code>).

</P>
<P>
Обычно требуется указывать <code>mysqld</code> только каталог, в котором
устанавливается MySQL. Это можно сделать с помощью опции <code>--basedir</code>. Можно
также использовать <code>--help</code> для проверки эффекта от изменения опций путей
(учтите, что <code>--help</code> должна быть последней опцией в команде <code>mysqld</code>).
Например:

</P>

<PRE>
shell&#62; EXECDIR/mysqld --basedir=/usr/local --help
</PRE>

<P>
После определения требуемых установок путей запускайте сервер без опции
<code>--help</code>.

</P>
<P>
Какой бы метод вы ни использовали для запуска сервера, если его неудачный
запуск завершается корректно, то проверьте журнальный файл, чтобы узнать,
почему запуск происходит неудачно. Журнальные файлы находятся в каталоге
данных (обычно <tt>`/usr/local/mysql/data'</tt> для бинарного дистрибутива,
<tt>`/usr/local/var'</tt> для дистрибутива исходного кода и <tt>`\mysql\data\mysql.err'</tt>
под Windows). В каталоге данных следует искать файлы с именами в виде
<tt>`host_name.err'</tt> и <tt>`host_name.log'</tt>, где <code>host_name</code> - имя вашего серверного
хоста. Затем проверьте последние несколько строк этих файлов:

</P>

<PRE>
shell&#62; tail host_name.err
shell&#62; tail host_name.log
</PRE>

<P>
В журнальном файле нужно искать что-нибудь похожее на следующее:

</P>

<PRE>
000729 14:50:10 bdb: Recovery function for LSN 1 27595 failed
000729 14:50:10 bdb: warning: ./test/t1.db: No such file or directory
000729 14:50:10 Can't init databases
</PRE>

<P>
Это означает, что вы не запустили <code>mysqld</code> с <code>--bdb-no-recover</code> и база данных
Berkeley DB нашла что-то ошибочное в своих журнальных файлах при попытке
восстановить ваши базы данных. Чтобы иметь возможность продолжить,
необходимо переместить старый журнальный файл Berkeley DB из каталога баз
данных в некоторое другое место, где позже можно будет изучить его.
Журнальные файлы имеют имена <tt>`log.0000000001'</tt> и т.д.; номер возрастает
при каждом запуске.

</P>
<P>
Если вы запускаете <code>mysqld</code> работает с поддержкой таблиц BDB и <code>mysqld</code> при
старте выводит дамп оперативной памяти (coredump), то причиной этого это
могут быть какие-либо проблемы с журналом восстановления BDB. В этом
случае можно попробовать запуск mysqld с <code>--bdb-no-recover</code>. Если это
помогает, то следует удалить все файлы <tt>`log.*'</tt> из каталога данных и
попробовать запустить <code>mysqld</code> опять.

</P>
<P>
Если выдается приведенная ниже ошибка, то это означает, что некоторая
другая программа (или другой сервер <code>mysqld</code>) уже использует данный TCP/IP
порт или сокет, на которых <code>mysqld</code> пытается слушать:

</P>

<PRE>
Can't start server: Bind on TCP/IP port: Address already in use
или
Can't start server : Bind on unix socket...
</PRE>

<P>
Чтобы убедиться, что другого работающего сервера <code>mysqld</code> нет, используйте
<code>ps</code>. Если другой работающий сервер не найден, то можно попробовать
выполнить команду <code>telnet your-host-name tcp-ip-port-number</code> и нажать пару
раз клавишу ``Enter''. Если вы не получаете сообщения об ошибке вроде
следующего <code>telnet: Unable to connect to remote host: Connection refused</code>,
значит, что порт TCP/IP порт, который <code>mysqld</code> пытается использовать, уже
занят другой программой. section <A HREF="manual.ru.html#mysql_install_db">2.4.1  Проблемы при запуске <code>mysql_install_db</code></A> и 
раздел See section <A HREF="manual.ru.html#Multiple_servers">4.1.4  Запуск нескольких серверов MySQL на одном компьютере</A>.

</P>
<P>
Если <code>mysqld</code> в настоящее время работает, то можно найти используемые им
установки путей при помощи следующей команды:

</P>

<PRE>
shell&#62; mysqladmin variables
или
shell&#62; mysqladmin -h 'your-host-name' variables
</PRE>

<P>
Если при запуске <code>mysqld</code> вы получили ошибку <code>Errcode 13</code>, что значит
<code>Permission denied</code>, это означает, что у вас не было прав читать/создавать
файлы в базе данных MySQL или в журнальном каталоге. В таком случае вам
следует либо запускать <code>mysqld</code> как пользователь <code>root</code>, либо изменить права
доступа к упомянутым файлам и каталогам, чтобы иметь права использовать
их.

</P>
<P>
Если <code>safe_mysqld</code> запускает сервер, но вы не можете подключиться к нему, то
следует убедиться, что в <tt>`/etc/hosts'</tt> есть запись, которая выглядит
примерно так:

</P>

<PRE>
127.0.0.1 localhost
</PRE>

<P>
Эта проблема возникает только в системах, не имеющих рабочей библиотеки
потоков, и для которых MySQL следует конфигурировать для использования
потоков MIT-pthreads.

</P>
<P>
Если вы не можете запустить <code>mysqld</code>, то можно попробовать создать
трассировочный файл, чтобы обнаружить данную проблему. 
See section <A HREF="manual.ru.html#Making_trace_files">D.1.2  Создание трассировочных файлов</A>.

</P>
<P>
При использовании таблиц InnoDB следует указывать опции запуска,
специфические для InnoDB. See section <A HREF="manual.ru.html#InnoDB_start">7.5.2  Параметры запуска InnoDB</A>.

</P>
<P>
При использовании таблиц BDB (Berkeley DB) необходимо хорошо знать
различные специфические для BDB опции запуска. See section <A HREF="manual.ru.html#BDB_start">7.6.3  Параметры запуска <code>BDB</code></A>.

</P>


<H3><A NAME="Automatic_start" HREF="manual.ru_toc.html#Automatic_start">2.4.3  Автоматический запуск и остановка MySQL</A></H3>

<P>
<A NAME="IDX305"></A>
<A NAME="IDX306"></A>
<A NAME="IDX307"></A>
<A NAME="IDX308"></A>
<A NAME="IDX309"></A>

</P>
<P>
Скрипты <code>mysql.server</code> и <code>safe_mysqld</code> могут применяться для автоматического
запуска сервера во время загрузки операционной системы. Скрипт
<code>mysql.server</code> можно также использовать для остановки сервера.

</P>
<P>
Чтобы применять скрипт <code>mysql.server</code> для запуска или остановки сервера, его
следует вызывать с аргументами <code>start</code> или <code>stop</code> соответственно:

</P>

<PRE>
shell&#62; mysql.server start
shell&#62; mysql.server stop
</PRE>

<P>
<code>mysql.server</code> можно найти в подкаталоге <tt>`share/mysql'</tt> 
инсталляционного каталога MySQL или в каталоге <tt>`support-files'</tt> набора
исходных кодов MySQL.

</P>
<P>
Перед тем как скрипт <code>mysql.server</code> запустит сервер, он изменяет данный
каталог на инсталляционный каталог MySQL, затем вызывает <code>safe_mysqld</code>.
Возможно, понадобится отредактировать скрипт <code>mysql.server</code>, если бинарный
дистрибутив установлен вами не в стандартном месте. Модифицируйте его,
указав <code>cd</code> в соответствующий каталог перед тем, как он запустит
<code>safe_mysqld</code>. Если вы хотите запустить сервер от определенного
пользователя, то добавьте соответствующую строку <code>user</code> к файлу
<tt>`/etc/my.cnf'</tt> как показано далее в этом разделе.

</P>
<P>
<code>mysql.server stop</code> останавливает сервер путем посылки ему сигнала.
Можно остановить сервер вручную - при помощи команды <code>mysqladmin shutdown</code>.

</P>
<P>
Вам следует добавить эти команды запуска и остановки в соответствующее место в 
файлах <tt>`/etc/rc*'</tt>, если вы хотите автоматически запускать MySQL на вашем сервере. 

</P>
<P>
На современных поставках Linux, достаточно скопировать файл <code>mysql.server</code>
в каталог <tt>`/etc/init.d'</tt> (или <tt>`/etc/rc.d/init.d'</tt> на более старших
системах Red Hat). После этого, выполните такую команду, чтобы включить
автоматический запуск MySQL при загрузке системы: 

</P>

<PRE>
shell&#62; chkconfig --add mysql.server
</PRE>

<P>
В качестве альтернативы, в некоторых ОС также используются <tt>`/etc/rc.local'</tt> или <tt>`/etc/init.d/boot.local'</tt> для 
запуска дополнительных сервисов при загрузке. Для того, чтобы MySQL стартовал с использованием этого метода, 
вы можете добавить нечто вроде этого к указанным файлам: 

</P>

<PRE>
/bin/sh -c 'cd /usr/local/mysql ; ./bin/safe_mysqld --user=mysql &#38;'
</PRE>

<P>
<A NAME="IDX310"></A>

</P>
<P>
Можно также добавить опции для скрипта <code>mysql.server</code> в глобальный  файл 
<tt>`/etc/my.cnf'</tt>. Типовой файл <tt>`/etc/my.cnf'</tt> может выглядеть следующим
образом:

</P>

<PRE>
[mysqld]
datadir=/usr/local/mysql/var
socket=/var/tmp/mysql.sock
port=3306
user=mysql

[mysql_server]
basedir=/usr/local/mysql
</PRE>

<P>
Скрипт <code>mysql.server</code> понимает следующие опции: <code>datadir</code>, <code>basedir</code> и 
<code>pid-file</code>.

</P>
<P>
В таблице представлены группы опций, которые каждый из 
перечисленных запускающих скриптов читает из файлов опций:

</P>
<TABLE BORDER>
<TR><TD><strong>Скрипт</strong> </TD><TD> <strong>Группы опций</strong>
</TD></TR>
<TR><TD><code>mysqld</code> </TD><TD> <code>mysqld</code> и <code>server</code>
</TD></TR>
<TR><TD><code>mysql.server</code> </TD><TD> <code>mysql.server</code>, <code>mysqld</code>, и <code>server</code>
</TD></TR>
<TR><TD><code>safe_mysqld</code> </TD><TD> <code>mysql.server</code>, <code>mysqld</code>, и <code>server</code>
</TD></TR>
</TABLE>

<P>
See section <A HREF="manual.ru.html#Option_files">4.1.2  Файлы параметров <tt>`my.cnf'</tt></A>.

</P>


<H2><A NAME="Upgrade" HREF="manual.ru_toc.html#Upgrade">2.5  Апгрейд/даунгрейд MySQL</A></H2>

<P>
<A NAME="IDX311"></A>
<A NAME="IDX312"></A>

</P>
<P>
Файлы MySQL, содержащие структуру и данные, всегда можно перемещать между
различными версиями одной и той же архитектуры, если используется одна и
та же базовая версия MySQL. В настоящее время базовой является версия с
номером 3. При изменении кодировки во время работы MySQL (при этом также
может измениться порядок сортировки) необходимо запустить <code>myisamchk -r -q --set-character-set=charset</code> 
на всех таблицах. В противном случае индексы могут сортироваться
неправильно.

</P>
<P>
В случае недоверия к новым версиям всегда можно переименовать старую
версию <code>mysqld</code>, изменив ее имя на что-нибудь вроде
<code>mysqld-old-version-number</code>. Если после этого <code>mysqld</code> новой версии начнет
вести себя не так, как ожидалось, то можно просто прекратить работу новой
версии и перезапустить старую!

</P>
<P>
И, разумеется, при модернизации следует также сделать резервную копию
старых баз данных.

</P>
<P>
После модернизации у вас могут возникнуть проблемы с перекомпилированными
клиентскими программами, такими как <code>Commands out of sync</code>, или произойти
неожиданная смерть приложения (coredump). Причина может быть в том, что
при компиляции программ были использованы старые заголовочные или
библиотечные файлы. В этом случае следует проверить даты создания вашего
файла <tt>`mysql.h'</tt> и библиотеки <tt>`libmysqlclient.a'</tt>, чтобы убедиться, что они
из нового дистрибутива MySQL. Если это не так, то программы нужно
перекомпилировать!

</P>
<P>
Если возникнут проблемы с запуском нового сервера <code>mysqld</code> или трудности с
подключением без пароля, то нужно убедиться, что вы не используете старый
файл <tt>`my.cnf'</tt> из старой установки! Это можно проверить с помощью
<code>program-name --print-defaults</code>. Если эта программа вместо имени программы
выводит что-нибудь иное, то ваш файл <tt>`my.cnf'</tt> является активным и
оказывает влияние на ход событий!

</P>
<P>
Каждый раз при установке нового релиза MySQL есть смысл создавать наново и
переустанавливать дистрибутив <code>Msql-Mysql-modules</code>, особенно если вы
замечаете симптомы того, что ваши скрипты <code>DBI</code> умирают после модернизации
MySQL.

</P>

<P>
<A NAME="IDX313"></A>
<A NAME="IDX314"></A>


<H3><A NAME="Upgrading-from-4.0" HREF="manual.ru_toc.html#Upgrading-from-4.0">2.5.1  Модернизация с версии 4.0</A></H3>

<P>
В общем случае, чтобы выполнить апгрейд до версии 4.1 с более ранней: 

</P>

<UL>
<LI>

Выполните скрипт <code>mysql_fix_privilege_tables</code> 
для создания новых столбцов с паролями. Это нужно для более безопасной работы
с паролями. 
</UL>

<P>
Далее идет более подробный список вещей, на которые следует обратить внимание
при апгрейде на 4.1:

</P>

<UL>
<LI>

Функции, что возвращают DATE, DATETIME или TIME теперь фиксируются при отдаче клиенту. 


<PRE>
mysql&#62; SELECT cast("2001-1-1" as DATE)
    -&#62; '2001-01-01'
</PRE>

<LI>

Все столбцы и таблицы теперь имеют кодировку, которая показывается в выводе
<code>SHOW CREATE TABLE</code> и <code>mysqldump</code>.
(MySQL 4.0.6 и выше могут читать новые dump-файлы, но не прежние версии MySQL).
<LI>

Временная метка (timestamp) теперь возвращается как строка вида <code>'YYYY-MM-DD HH:MM:DD'</code>.
Если вы хотите получить ее как число - вам следует добавить <code>+0</code> к столбцу <code>timestamp</code>.
Различные длины временных меток теперь не поддерживаются. 
<LI>

Если вы используете несколько серверов на одном и том же компьютере под управлением
Windows, вам следует использовать различные опции 
<code>--shared_memory_base_name</code>.
</UL>

<P>
<strong>Обратите внимание</strong> что формат определения таблиц (.frm) поменялся в 4.1. MySQL 4.0.11 может 
читать новый файл формата, но более старые версии не могут. Если вам нужно перемещать таблицы с 4.1 
на более старшие версии MySQL, вам следует использовать <code>mysqldump</code>. See section <A HREF="manual.ru.html#mysqldump">4.8.5  <code>mysqldump</code>, Получение дампов данных и структуры таблицы</A>. 

</P>

<P>
<A NAME="IDX315"></A>

</P>


<H3><A NAME="Upgrading-from-3.23" HREF="manual.ru_toc.html#Upgrading-from-3.23">2.5.2  Модернизация с версии 3.23 до версии 4.0</A></H3>

<P>
В общем случае, вот что вам следует сделать для апгрейда к версии 4.0 с более старой: 

</P>

<UL>
<LI>

Выполнить скрипт <code>mysql_fix_privilege_tables</code>  чтобы добавить новые
привилегии и возможности в таблицы привилегий MySQL.
<LI>

Подредактировать скрипты запуска MySQL или конфигурационные файлы, чтобы не использовать 
устаревшие опции, описанные ниже. 
<LI>

Преобразовать ваши старые ISAM-файлы в формат MyISAM следующей командой: 
<code>mysql_convert_table_format база данных</code>.
Обратите внимание, это нужно делать только если все таблицы в базе данных
являются таблицами типа ISAM или MyISAM. Если это не тот случай, вам тогда
следует выполнить <code>ALTER TABLE имя_таблицы TYPE=MyISAM</code> для всех
ISAM-таблиц. 

<LI>

Удостоверьтесь, что у вас не используется никакие клиенты MySQL, что используют
динамические библиотеки (например, Perl Msql-Mysql-modules). Если у вас есть
такие, их следует перекомпилировать, т.к. структуры в <tt>`libmysqlclient.so'</tt>
изменились. 
</UL>

<P>
MySQL 4.0 будет работать, даже если вы не выполните эти шагы, но у вас 
не будет возможности использовать новые привилегии, которые предоставляет MySQL 4.0, 
и у вас могут быть проблемы при дальнейшем апгрейде к 4.1 или более новым серверам. 
Формат ISAM в MySQL 4.0 все еще работает, но он уже морально устарел и будет исключен
из версии MySQL 5.0.

</P>
<P>
Старые клиенты должны работать с версией 4.0 без каких-либо проблем. 

</P>
<P>
И даже если вы выполните эти шаги, вы сможете произвести даунгрейд к
MySQL 3.23.52 или более новой, если у вас возникнут проблемы с MySQL 4.0. В этом
случае вам потребуется выполнить mysqldump на всех таблицах, использующих полнотекстовые
индексы и восстановить dump на версии 3.23. Причина заключается в том, что MySQL 4.0 
использует новый формат полнотекстовых индексов. 

</P>
<P>
Вот подробный список того, на что следует обратить внимание при апгрейде к 4.0:

</P>

<UL>
<LI>

В MySQL 4.0 появилось большое количество новых привилегий в таблице
<code>mysql.user</code>. See section <A HREF="manual.ru.html#GRANT">4.3.1  Синтаксис команд <code>GRANT</code> и <code>REVOKE</code></A>. 

Чтобы заставить эти
новые привилегии работать, следует запустить скрипт
<code>mysql_fix_privilege_tables</code>. До выполнения данного скрипта у всех
пользователей будут привилегии <code>SHOW DATABASES</code>, <code>CREATE TEMPORARY TABLES</code>
и <code>LOCK TABLES</code>. Значения для привилегий <code>SUPER</code> и <code>EXECUTE</code> берутся
из <code>PROCESS</code>, для <code>REPLICATION SLAVE</code> и <code>REPLICATION CLIENT</code> - из <code>FILE</code>.

Чтобы скрипты, создающие новых пользователей, могли использовать новые
привилегии, их нужно модифицировать. Если в этих скриптах не
используется команда <code>GRANT</code>, то сейчас самое время изменить их. 

В версии
4.0.2 опция <code>--safe-show-database</code> устарела и не рекомендуется (и она
больше ничего не делает). See section <A HREF="manual.ru.html#Privileges_options">4.2.3  Опции запуска <code>mysqld</code>, относящиеся к безопасности</A>. 

Если в версии 4.0.2 для новых пользователей
возникают ошибки отказа в доступе, то следует проверить, не требуются
ли вам некоторые новые привилегии, которые не были нужны раньше. В
частности, для новых репликаций понадобится <code>REPLICATION SLAVE</code> (вместо
<code>FILE</code>).

<LI>

Параметры запуска <code>myisam_max_extra_sort_file_size</code> и
<code>myisam_max_extra_sort_file_size</code> теперь указываются в байтах (до 4.0.3
указывались в мегабайтах).

Внешняя блокировка файлов MyISAM/ISAM теперь выключена по умолчанию. Можно
включить ее обратно опцией <code>--external-locking</code>.  Для большинства
пользователей этого никогда не потребуется делать. 

<LI>

Следующие переменные/опции были переименованы: 
<TABLE BORDER>
<TR><TD><strong>Из</strong> </TD><TD> <strong>В</strong>.
</TD></TR>
<TR><TD><code>myisam_bulk_insert_tree_size</code> </TD><TD> <code>bulk_insert_buffer_size</code>
</TD></TR>
<TR><TD><code>query_cache_startup_type</code> </TD><TD> <code>query_cache_type</code>
</TD></TR>
<TR><TD><code>record_buffer</code> </TD><TD> <code>read_buffer_size</code>
</TD></TR>
<TR><TD><code>record_rnd_buffer</code> </TD><TD> <code>read_rnd_buffer_size</code>
</TD></TR>
<TR><TD><code>sort_buffer</code> </TD><TD> <code>sort_buffer_size</code>
</TD></TR>
<TR><TD><code>warnings</code> </TD><TD> <code>log-warnings</code>
</TD></TR>
<TR><TD><code>err-log</code> </TD><TD> <code>--log-error</code> (для <code>mysqld_safe</code>)
</TD></TR>
</TABLE>

Опции запуска <code>record_buffer</code>, <code>sort_buffer</code> и <code>warnings</code> все
еще работают в MySQL 4.0, но считаются уже морально устаревшими. 

<LI>

Следующие SQL-переменные переименованы.
<TABLE BORDER>
<TR><TD><strong>Из</strong> </TD><TD> <strong>В</strong>.
</TD></TR>
<TR><TD><code>SQL_BIG_TABLES</code> </TD><TD> <code>BIG_TABLES</code>
</TD></TR>
<TR><TD><code>SQL_LOW_PRIORITY_UPDATES</code> </TD><TD> <code>LOW_PRIORITY_UPDATES</code>
</TD></TR>
<TR><TD><code>SQL_MAX_JOIN_SIZE</code> </TD><TD> <code>MAX_JOIN_SIZE</code>
</TD></TR>
<TR><TD><code>QUERY_CACHE_TYPE</code> </TD><TD> <code>QUERY_CACHE_TYPE</code>
</TD></TR>
</TABLE>
Старые имена в MySQL 4.0 работают, но уже не рекомендованы к использованию.
<LI>

Вы должны использовать <code>SET GLOBAL SQL_SLAVE_SKIP_COUNTER=#</code> вместо 
<code>SET SQL_SLAVE_SKIP_COUNTER=#</code>.
<LI>

Переименовали опцию запуска <code>mysqld</code> <code>--skip-locking</code> в
<code>--skip-external-locking</code> и <code>--enable-locking</code> в
<code>--external-locking</code>.
<LI>

<code>SHOW MASTER STATUS</code> теперь возвращает пустой результат если двоичный журнал обновлений
не включен. 
<LI>

<code>SHOW SLAVE STATUS</code> возвращает пустой результат если подчиненный сервер не инициализирован. 
<LI>

mysqld теперь обладает опцией <code>--temp-pool</code> включенной по умолчанию, т.к. это 
дает лучшую производительность на некоторых ОС (в основном, на Linux). 
<LI>

Столбцы <code>DOUBLE</code> и <code>FLOAT</code> теперь учитывают флаг
<code>UNSIGNED</code> при хранении (раньше <code>UNSIGNED</code> игнорировался для этих столбцов).
<LI>

<code>ORDER BY столбец DESC</code> теперь сортирует величины <code>NULL</code> 
в первую очередь; в 3.23 это было не всегда так. Внимание: в MySQL 4.0.11 восстановлено
оригинальное поведение. 
<LI>

<code>SHOW INDEX</code> имеет на 2 столбца больше (<code>Null</code> и <code>Index_type</code>), чем в версии
3.23.
<LI>

<code>CHECK</code>, <code>SIGNED</code>, <code>LOCALTIME</code> и <code>LOCALTIMESTAMP</code>
теперь являются зарезервированными словами.
<LI>

Результат работы всех поразрядных операторов <code>|</code>, <code>&#38;</code>, <code>&#60;&#60;</code>, <code>&#62;&#62;</code> и <code>~</code> сейчас
является беззнаковым. Это может вызвать проблемы при использовании их
в контексте, где желателен результат со знаком. See section <A HREF="manual.ru.html#Cast_Functions">6.3.5  Функции приведения типов</A>.

<LI>

<strong>Замечание</strong>: результат операции вычитания между целыми величинами, одна
из которых имеет тип <code>UNSIGNED</code>, будет беззнаковым! Другими словами,
перед модернизацией до MySQL 4.0 вы должны проверить свои приложения
для случаев, где производится вычитание величины из беззнакового
объекта и предполагается ответ с отрицательным знаком, или вычитание
беззнаковой величины из целочисленного столбца. Данный режим можно
заблокировать, используя опцию <code>--sql-mode=NO_UNSIGNED_SUBTRACTION</code> при
запуске <code>mysqld</code>. See section <A HREF="manual.ru.html#Cast_Functions">6.3.5  Функции приведения типов</A>.

<LI>

Для того чтобы использовать <code>MATCH ... AGAINST (... IN BOOLEAN MODE)</code> на
таблицах, следует перестроить их заново при помощи <code>REPAIR TABLE table_name USE_FRM</code>.

<LI>

<code>LOCATE()</code> и <code>INSTR()</code> чувствительны к регистру, если один из аргументов
является двоичной строкой. В противном случае они не зависят от
регистра.
<LI>

<code>STRCMP()</code> при выполнении сравнений сейчас использует текущий набор
символов; это означает, что операция сравнения по умолчанию начиная с
данной версии является независимой от регистра.

<LI>

<code>HEX(string)</code> сейчас возвращает символы строки, преобразованные в
шестнадцатеричные. Если необходимо преобразовать число в
шестнадцатеричное представление, убедитесь, что <code>HEX()</code> вызывается с
числовым аргументом.

<LI>

В версии 3.23 в команде <code>INSERT INTO ... SELECT</code> параметр <code>IGNORE</code> всегда
был разрешен. В версии 4.0.1 MySQL остановится (и, возможно,
произойдет откат) в случае ошибки, если <code>IGNORE</code> не задан явно.

<LI>

Скрипт <code>safe_mysqld</code> переименован в <code>mysqld_safe</code>. Некоторое время
мы будем включать <code>safe_mysqld</code> в дистрибутив как символическую ссылку на <code>mysqld_safe</code>. 

<LI>

Старые функции C API <code>mysql_drop_db</code>, <code>mysql_create_db</code> и <code>mysql_connect</code>
больше не будут поддерживаться, если вы не скомпилируете MySQL с
<code>CFLAGS=-DUSE_OLD_FUNCTIONS</code>). Вместо перекомпиляции лучше пересобрать
клиента для использования нового 4.0 API.

<LI>

В структуре <code>MYSQL_FIELD</code> величины <code>length</code> и <code>max_length</code> изменены с
<code>unsigned int</code> на <code>unsigned long</code>. Это не должно вызывать проблем, за
исключением того, что при использовании величин с такими типами в
качестве аргументов в функциях класса <code>printf()</code> могут генерироваться
предупреждающие сообщения.

<LI>

Если необходимо удалить из таблицы все строки, но вам не нужно знать,
сколько строк было удалено, следует использовать <code>TRUNCATE TABLE</code> при
(поскольку <code>TRUNCATE TABLE</code> значительно быстрее, чем <code>DELETE FROM
table_name</code>).

<LI>

При попытке выполнить <code>TRUNCATE TABLE</code> или <code>DROP DATABASE</code> при наличии
активной команды <code>LOCK TABLES</code> или транзакции вы получите ошибку. 

<LI>

Для хранения величин в столбцах <code>BIGINT</code> необходимо использовать целые
числа (вместо строк, как было в MySQL 3.23). Возможность использования
строк для данного случая пока еще работает, но применение целых чисел
более эффективно.

<LI>

Изменен формат <code>SHOW OPEN TABLE</code>.

<LI>

Многопоточные клиенты должны использовать <code>mysql_thread_init()</code> и
<code>mysql_thread_end()</code>. See section <A HREF="manual.ru.html#Threaded_clients">8.4.8  Как создать клиентскую программу с потоками</A>.

<LI>

При желании перекомпилировать модуль Perl <code>DBD::mysql</code> необходимо
получить версию <code>Msql-Mysql-modules</code> 1.2218 или более новую, поскольку в
более старых модулях <code>DBD</code> использовался не поддерживаемый вызов функции
<code>drop_db()</code>.

<LI>

В версии 4.0 <code>RAND(seed)</code> возвращает иные последовательности случайных
чисел, чем в 3.23; это сделано для того, чтобы лучше различать
<code>RAND(seed)</code> и <code>RAND(seed+1)</code>.

<LI>

Тип результата, возвращаемый  <code>IFNULL(A,B)</code> теперь по умолчанию
устанавливается более "общий" по отношению к типам <code>A</code> и <code>B</code>. Порядок
выбора - <code>STRING</code>, <code>REAL</code> или <code>INTEGER</code>.

</UL>



<H3><A NAME="Upgrading-from-3.22" HREF="manual.ru_toc.html#Upgrading-from-3.22">2.5.3  Модернизация с версии 3.22 до версии 3.23</A></H3>

<P>
<A NAME="IDX316"></A>
<A NAME="IDX317"></A>

</P>
<P>
В версии MySQL 3.23 поддерживаются таблицы нового типа <code>MyISAM</code> и старого
типа <code>ISAM</code>. Старые таблицы не нуждаются в преобразовании для использования
их в версии 3.23. По умолчанию все новые таблицы будут создаваться с типом
<code>MyISAM</code> (если вы не запускаете <code>mysqld</code> с опцией <code>--default-table-type=isam</code>).
Можно преобразовать таблицу <code>ISAM</code> в таблицу <code>MyISAM</code> при помощи команды
<code>ALTER TABLE table_name TYPE=MyISAM</code> или при помощи Perl-скрипта 
<code>mysql_convert_table_format</code>.

</P>
<P>
Клиенты версий 3.22 и 3.21 должны работать с сервером версии 3.23 без
каких-либо проблем.

</P>
<P>
Ниже перечислены моменты, на которые следует обратить внимание при
модернизации до версии 3.23:

<UL>
<LI>

Все таблицы, в которых используется кодировка <code>tis620</code>, должны быть
исправлены с помощью <code>myisamchk -r</code> или <code>REPAIR TABLE</code>.

<LI>

При выполнении команды <code>DROP DATABASE</code> над базой данных, связанной
символической ссылкой, удаляются как данная ссылка, так и исходная
база данных (в 3.22 это было не так, поскольку программа <code>configure</code> не
распознавала системный вызов <code>readlink</code>).

<LI>

<code>OPTIMIZE TABLE</code> сейчас работает только с таблицами <code>MyISAM</code>. Для других
типов таблиц можно использовать команду <code>ALTER TABLE</code> для оптимизации
таблицы. Во время выполнения команды <code>OPTIMIZE TABLE</code> оптимизируемая
таблица сейчас заблокирована для других потоков.

<LI>

Клиент <code>mysql</code> сервера MySQL сейчас по умолчанию начинает свою работу с
опцией <code>--no-named-commands</code> (<code>-g</code>). Данную опцию можно отключить с
помощью <code>--enable-named-commands</code> (<code>-G</code>). В некоторых случаях это может
вызывать проблемы несовместимости, например, в скриптах SQL, в которых
названные команды используются без точки с запятой! Команды большого
формата пока еще работают с начала строки.

<LI>

Функции даты, работающие с частью представления даты (такие как
<code>MONTH()</code>), сейчас будут возвращать <code>0</code> для даты <code>0000-00-00</code> (в версии
MySQL 3.22 возвращалась величина <code>NULL</code>).

<LI>

При использовании порядка сортировки символов german необходимо
исправить все таблицы с помощью <code>isamchk -r</code>, так как в порядке
сортировки произведены некоторые изменения!

<LI>

Возвращаемый по умолчанию тип выражения <code>IF</code> теперь зависит от обоих
аргументов, а не только от первого.

<LI>

<code>AUTO_INCREMENT</code> теперь не будет работать с отрицательными числами;
причина в том, что отрицательные числа вызывали проблемы при переходе
от <code>-1</code> к <code>0</code>. Для таблиц <code>MyISAM</code> <code>AUTO_INCREMENT</code> не обрабатывается на более
низком уровне и работает намного быстрее, чем раньше. Для таблиц
<code>MyISAM</code> старые автоинкрементные номера также не используются повторно,
даже при удалении из таблицы строк.

<LI>

<code>CASE</code>, <code>DELAYED</code>, <code>ELSE</code>, <code>END</code>, <code>FULLTEXT</code>, <code>INNER</code>, <code>RIGHT</code>, <code>THEN</code> и <code>WHEN</code> 
сейчас  являются  зарезервированными  словами.

<LI>

<code>FLOAT(X)</code> сейчас является настоящим типом данных с плавающей точкой, а
не величиной с фиксированным числом десятичных знаков.

<LI>

При объявлении <code>DECIMAL(length,dec)</code> аргумент <code>length</code> больше не включает
в себя место для знака или десятичной точки.

<LI>

Строка <code>TIME</code> теперь должна представлять собой один из следующих
форматов: <code>[[[DAYS] [H]H:]MM:]SS[.fraction]</code> или
<code>[[[[[H]H]H]H]MM]SS[.fraction]</code>.

<LI>

<code>LIKE</code> сейчас сравнивает строки, используя те же правила сравнения
символов, что и <code>=</code>. Если необходим старый режим работы, то можно
скомпилировать MySQL с флагом <code>CXXFLAGS=-DLIKE_CMP_TOUPPER</code>.

<LI>

Выражение <code>REGEXP</code> сейчас является независимым от регистра символов для
нормальных (не двоичных) строк.

<LI>

При проверке/исправлении таблиц необходимо использовать <code>CHECK TABLE</code> 
или <code>myisamchk</code> для таблиц <code>MyISAM</code> (<tt>`.MYI'</tt>) и <code>isamchk</code> для таблиц <code>ISAM</code>
(<tt>`.ISM'</tt>).

<LI>

Чтобы обеспечить совместимость файлов <code>mysqldump</code> между версией MySQL
3.22 и версией 3.23, не следует использовать опцию <code>--opt</code> или <code>--all</code> 
для <code>mysqldump</code>.

<LI>

Проверьте все ваши вызовы функции <code>DATE_FORMAT()</code>, чтобы убедиться, что
перед каждым символом формата имеется <samp>`%'</samp> (в версии MySQL 3.22 и более
поздних этот синтаксис уже допускается).

<LI>

<code>mysql_fetch_fields_direct</code> сейчас является функцией (был макрос) и
возвращает указатель на <code>MYSQL_FIELD</code> вместо <code>MYSQL_FIELD</code>.

<LI>

Функцию <code>mysql_num_fields()</code> больше нельзя использовать на объектах
<code>MYSQL*</code> (сейчас это функция, принимающая <code>MYSQL_RES*</code> в качестве
аргумента, так что вместо нее следует применять <code>mysql_field_count()</code>).

<LI>

В версии MySQL 3.22 вывод <code>SELECT DISTINCT ...</code> почти всегда был
отсортированным. Чтобы получить отсортированный вывод в версии 3.23,
необходимо использовать <code>GROUP BY</code> или <code>ORDER BY</code>.

<LI>

Функция <code>SUM()</code> сейчас возвращает <code>NULL</code> вместо <code>0</code> при отсутствии
сопоставляемых строк: это сделано для соответствия с ANSI SQL.

<LI>

Операторы <code>AND</code> или <code>OR</code> с величинами <code>NULL</code> теперь будут возвращать <code>NULL</code>
вместо <code>0</code>. В основном, это влияет на запросы, в которых используется
<code>NOT</code> на выражениях <code>AND</code>/<code>OR</code>, так как <code>NOT NULL = NULL</code>. <code>LPAD()</code> и <code>RPAD()</code> 
будут укорачивать результирующую строку, если она длиннее, чем
аргумент длины.
</UL>



<H3><A NAME="Upgrading-from-3.21" HREF="manual.ru_toc.html#Upgrading-from-3.21">2.5.4  Модернизация с версии 3.21 до версии 3.22</A></H3>

<P>
<A NAME="IDX318"></A>
<A NAME="IDX319"></A>

</P>
<P>
В версии 3.21 по сравнению с 3.22 не было сделано никаких изменений,
влияющих на совместимость. Единственный подводный камень - это то, что для
новых таблиц, создающихся  со столбцами типа <code>DATE</code>, будет применяться новый
способ хранения даты. При использовании старой версии <code>mysqld</code> получить
доступ к этим новым полям будет нельзя.

</P>
<P>
После установки версии MySQL 3.22 необходимо запустить новый сервер, а
затем выполнить скрипт <code>mysql_fix_privilege_tables</code>. В результате будут
добавлены новые привилегии, необходимые для использования команды <code>GRANT</code>.
Если вы забудете выполнить эти действия, то получите <code>Access denied</code> при
попытке использовать <code>ALTER TABLE</code>, <code>CREATE INDEX</code> или <code>DROP INDEX</code>. Если для
вашего привилегированного (<code>root</code>) пользователя MySQL требуется пароль, то
следует указать его как аргумент в <code>mysql_fix_privilege_tables</code>.

</P>
<P>
Изменен интерфейс C API к функции <code>mysql_real_connect()</code>.Если вы
располагаете старой клиентской программой, вызывающей данную функцию, то
необходимо задать значение <code>0</code> для нового аргумента <code>db</code> (или перекодировать
данный клиент, чтобы посылать значение элемента <code>db</code> для более быстрых
подключений). Необходимо также вызывать <code>mysql_init()</code> перед вызовом функции
<code>mysql_real_connect()</code>! Это изменение было проведено для того, чтобы дать
возможность новой функции <code>mysql_options()</code> сохранять опции в структуре
обработчика <code>MYSQL</code>.

</P>
<P>
Имя относящейся к <code>mysqld</code> переменной <code>key_buffer</code> изменено на
<code>key_buffer_size</code>, однако старое имя можно использовать по-прежнему.

</P>


<H3><A NAME="Upgrading-from-3.20" HREF="manual.ru_toc.html#Upgrading-from-3.20">2.5.5  Модернизация с версии 3.20 до версии 3.21</A></H3>

<P>
<A NAME="IDX320"></A>
<A NAME="IDX321"></A>

</P>
<P>
Если вы работаете с версией выше, чем 3.20.28, и хотите перейти к 3.21, то
необходимо сделать следующее:

</P>
<P>
Можно запустить сервер <code>mysqld</code> версии 3.21 с опцией <code>safe_mysqld
--old-protocol</code>, чтобы использовать его с клиентами из дистрибутива версии
3.20. В этом случае функция <code>mysql_errno()</code> нового клиента не возвращает
никаких серверных ошибок, кроме <code>CR_UNKNOWN_ERROR</code> (она предназначена для
клиентских ошибок), при этом сервер использует не новую, а старую функцию
проверки <code>password()</code>.

</P>
<P>
Если вы не собираетесь использовать опцию <code>--old-protocol</code> к <code>mysqld</code>, то
необходимо будет выполнить следующие изменения:

</P>

<UL>
<LI>

Весь клиентский код следует перекомпилировать. Для использования ODBC
необходимо приобрести новый драйвер <code>MyODBC</code> 2.x.
<LI>

Необходимо запустить скрипт <tt>`scripts/add_long_password'</tt> для
преобразования поля <code>Password</code> в таблице <code>mysql.user</code> к <code>CHAR(16)</code>.
<LI>

Все пароли в таблице <code>mysql.user</code> должны быть переназначены (чтобы
получить 62- разрядные пароли вместо 31- разрядных).
<LI>

Формат таблиц не изменялся, следовательно, в преобразовании каких-либо
таблиц необходимости нет.
</UL>

<P>
Версия MySQL 3.20.28 и выше может обрабатывать новый формат таблиц <code>user</code>
так, что это не отражается на клиентах. В более ранних, чем 3.20.28,
версиях MySQL пароли больше не будут работать с клиентами, если таблица
<code>user</code> преобразована. Для уверенности следует прежде провести апгрейд по
меньшей мере до версии 3.20.28 и затем модернизировать до версии 3.21.

</P>
<P>
<A NAME="IDX322"></A>

</P>
<P>
Новый код клиента работает с сервером <code>mysqld</code> версии 3.20.x, так что в
случае каких-либо проблем с версией 3.21.x можно использовать старый
сервер 3.20.x без необходимости повторной перекомпиляции клиентов.

</P>
<P>
Если не применить опцию <code>--old-protocol</code> для <code>mysqld</code>, то старые клиенты
выдадут следующее сообщение об ошибке:

</P>

<PRE>
ERROR: Protocol mismatch. Server Version = 10 Client Version = 9
</PRE>

<P>
Новый интерфейс Perl <code>DBI</code>/<code>DBD</code> также поддерживает старый интерфейс
<code>mysqlperl</code>. Единственное изменение, которое следует произвести при
использовании <code>mysqlperl</code>, модифицировать аргументы в функции <code>connect()</code>.
Новыми аргументами являются: <code>host</code>, <code>database</code>, <code>user</code>, и <code>password</code> (аргументы
<code>user</code> и <code>password</code> поменялись местами). See section <A HREF="manual.ru.html#Perl_DBI_Class">8.2.2  Интерфейс <code>DBI</code></A>.

</P>
<P>
Ниже перечислены изменения, которые могут повлиять на запросы в старых
приложениях:

</P>

<UL>
<LI>

<code>HAVING</code> теперь необходимо указывать перед любым выражением <code>ORDER BY</code>.
<LI>

Произведена замена параметров в <code>LOCATE()</code>.
<LI>

Появилось несколько новых зарезервированных слов. Наиболее значимыми
из них являются <code>DATE</code>, <code>TIME</code> и <code>TIMESTAMP</code>.
</UL>



<H3><A NAME="Upgrading-to-arch" HREF="manual.ru_toc.html#Upgrading-to-arch">2.5.6  Модернизация к иной архитектуре</A></H3>

<P>
<A NAME="IDX323"></A>
<A NAME="IDX324"></A>

</P>

<P>
При использовании MySQL 3.23 можно копировать файлы <tt>`.frm'</tt>, <tt>`.MYI'</tt> и
<tt>`.MYD'</tt> между различными архитектурами, поддерживающими одинаковый формат
чисел с плавающей точкой (все проблемы, связанные с перестановкой байтов,
берет на себя MySQL).

</P>
<P>
Имеющиеся в MySQL файлы данных и индексные файлы типа <code>ISAM</code> (<tt>`.ISD'</tt> и
<tt>`*.ISM'</tt> соответственно) являются архитектурно-независимыми, а в ряде
случаев - зависимыми от операционной системы. Для переноса приложений на
компьютер с архитектурой или операционной системой, которые отличаются от
используемых на исходном компьютере, не следует пытаться перенести базу
данных путем простого копирования файлов на другой компьютер. Используйте
вместо этого <code>mysqldump</code>.

</P>
<P>
По умолчанию <code>mysqldump</code> создаст файл со всеми командами SQL. После этого
данный файл можно перенести на другой компьютер и подать его на вход
клиента <code>mysql</code>.

</P>
<P>
Используя <code>mysqldump --help</code>, просмотрите все доступные опции. При
перемещении данных на более новую версию MySQL следует применять <code>mysqldump
--opt</code> более новой версии, чтобы получить быструю и компактную копию.

</P>
<P>
Самый простой (хотя и не самый быстрый) способ перемещения базы данных с
компьютера на компьютер - запустить на компьютере, где размещается
исходная база данных, следующие команды:

</P>

<PRE>
shell&#62; mysqladmin -h 'other hostname' create db_name
shell&#62; mysqldump --opt db_name \
      | mysql -h 'other hostname' db_name
</PRE>

<P>
Если вы хотите скопировать базу данных с удаленного компьютера через
медленную сеть, то можно использовать:

</P>

<PRE>
shell&#62; mysqladmin create db_name
shell&#62; mysqldump -h 'other hostname' --opt --compress db_name \
      | mysql db_name
</PRE>

<P>
Можно также сохранять результат в файле, затем передавать этот файл на
требуемый компьютер и загружать этот файл в расположенную там базу данных.
Например, можно скопировать базу данных в файл на исходном компьютере как
показано ниже:

</P>

<PRE>
shell&#62; mysqldump --quick db_name | gzip &#62; db_name.contents.gz
</PRE>

<P>
(Созданный в данном примере файл сжимается). Передайте этот файл с
содержимым базы данных на требуемый компьютер и запустите там эти команды:

</P>

<PRE>
shell&#62; mysqladmin create db_name
shell&#62; gunzip &#60; db_name.contents.gz | mysql db_name
</PRE>

<P>
<A NAME="IDX325"></A>
<A NAME="IDX326"></A>

</P>
<P>
Для выполнения передачи базы данных можно также использовать <code>mysqldump</code> и
<code>mysqlimport</code>. В случае больших таблиц это намного более быстрый способ, чем
простое применение <code>mysqldump</code>. В следующих командах <code>DUMPDIR</code> представляет
собой полный путь к каталогу, используемому для хранения вывода из
<code>mysqldump</code>.

</P>
<P>
Во-первых, создайте каталог для файлов вывода и дампа базы данных:

</P>

<PRE>
shell&#62; mkdir DUMPDIR
shell&#62; mysqldump --tab=DUMPDIR db_name
</PRE>

<P>
Затем передайте эти файлы в каталог <code>DUMPDIR</code> некоторого соответствующего
каталога на требуемом компьютере и загрузите там данные файлы в MySQL:

</P>

<PRE>
shell&#62; mysqladmin create db_name # создание  базы  данных
shell&#62; cat DUMPDIR/*.sql | mysql db_name # создание  таблиц  в  базе данных
shell&#62; mysqlimport db_name DUMPDIR/*.txt # загрузка  данных  в  таблицы
</PRE>

<P>
Помимо этого, не забудьте скопировать базу данных <code>mysql</code>, поскольку в ней
хранятся таблицы привилегий (<code>user</code>, <code>db</code>, <code>host</code>). Возможно, на новом
компьютере будет нужно запустить команды в качестве пользователя <code>root</code>
MySQL, пока база данных <code>mysql</code> не займет свое место.

</P>
<P>
После импорта базы данных <code>mysql</code> на новый компьютер выполните <code>mysqladmin
flush-privileges</code>, чтобы сервер перезагрузил информацию в таблицах
привилегий.

</P>


<H2><A NAME="Operating_System_Specific_Notes" HREF="manual.ru_toc.html#Operating_System_Specific_Notes">2.6  Заметки по операционным системам</A></H2>



<H3><A NAME="Linux" HREF="manual.ru_toc.html#Linux">2.6.1  Примечания к Linux (Все версии Linux)</A></H3>

<P>
Приведенные ниже замечания о <code>glibc</code> будут полезны только для случая, когда
вы собираете MySQL самостоятельно. Но обычно, если Linux работает на
машине с архитектурой x86, гораздо лучше использовать наши бинарные файлы.
Они линкуются с <code>glibc</code>, к которой применены наиболее удачные патчи, и с
наиболее удачными опциями компилятора - все это сделано для того, чтобы
программа была пригодной для работы на сильно нагруженном сервере. Поэтому
если после прочтения данного раздела у вас возникнут сомнения относительно
дальнейших действий, попробуйте сначала использовать бинарные файлы -
возможно, они удовлетворят вашим требованиям. Если же окажется, что
бинарные файлы вас не устраивают, то можно попробовать заняться
собственноручной сборкой. Мы будем очень признательны за сообщение о том,
почему вам пришлось отказаться от работы с нашими бинарниками, - это
поможет нам в следующий раз собрать более удачную версию программы. Что же
касается обычных пользователей, то для них даже при установке,
рассчитанной на большое количество параллельных соединений и/или таблиц,
превосходящих по объему ограничение в 2 Гб, наши бинарные файлы будут
наилучшим вариантом выбора.

</P>
<P>
В операционной системе Linux MySQL использует LinuxThreads. Если у вас
старая система Linux, в которой отсутствует <code>glibc2</code>, то прежде чем
предпринимать попытку компиляции MySQL, необходимо установить
LinuxThreads. Получить LinuxThreads можно по адресу
<a HREF="http://www.mysql.com/downloads/os-linux.html">http://www.mysql.com/downloads/os-linux.html</a>.

</P>
<P>
<strong>Примечание</strong>: на Linux 2.2.14 и MySQL, установленных на многопроцессорных
(SMP) системах, могут возникать некоторые непонятные проблемы. В таком
случае мы рекомендуем как можно быстрее сделать апгрейд версии ядра до
2.4: оно станет гораздо более быстрым и устойчивым.

</P>
<P>
Необходимо отметить, что версии <code>glibc</code> до 2.1.1 включительно содержат
фатальную ошибку в обработке <code>pthread_mutex_timedwait</code>, которая проявляется
при использовании <code>INSERT DELAYED</code>. Поэтому мы рекомендуем не использовать
<code>INSERT DELAYED</code>, пока не будет сделан апгрейд <code>glibc</code>.

</P>
<P>
Если планируется использовать более 1000 одновременных соединений,
необходимо сделать некоторые изменения в LinuxThreads, пересобрать их и
перелинковать MySQL с новой <tt>`libpthread.a'</tt>. Следует увеличить
<code>PTHREAD_THREADS_MAX</code> в файле <tt>`sysdeps/unix/sysv/linux/bits/local_lim.h'</tt> до
4096 и уменьшить <code>STACK_SIZE</code> в <tt>`linuxthreads/internals.h'</tt> до 256 Kб.

</P>
<P>
Пути указаны относительно корневого каталога <code>glibc</code>. Заметим, что MySQL не
будет устойчиво работать при 600-1000 соединениях, если размер <code>STACK_SIZE</code>
останется по умолчанию 2 Mб.

</P>
<P>
Если MySQL не может открыть достаточное количество файлов или принять
достаточное количество соединений, то это значит, что в Linux не
сконфигурирована возможность открытия необходимого количества файлов.

</P>
<P>
В Linux 2.2 и более свежих версиях можно получить значение максимального
количества файлов, которые можно открыть одновременно. Для этого
необходимо выполнить:

</P>

<PRE>
cat /proc/sys/fs/file-max
cat /proc/sys/fs/dquot-max
cat /proc/sys/fs/super-max
</PRE>

<P>
В случае, если на машине установлено более 16 Mб памяти, к загрузочному
скрипту (<tt>`/etc/init.d/boot.local'</tt> на SuSE) необходимо добавить записи
наподобие следующих:

</P>

<PRE>
echo 65536 &#62; /proc/sys/fs/file-max
echo 8192 &#62; /proc/sys/fs/dquot-max
echo 1024 &#62; /proc/sys/fs/super-max
</PRE>

<P>
Эти команды можно также запустить из командной строки от имени
пользователя

</P>
<P>
<code>root</code>, но в таком случае при перезагрузке компьютера будут использоваться
старые ограничения.

</P>
<P>
Альтернативно, вы можете установить эти параметры при загрузке, используя
утилиту <code>sysctl</code>, которая используется во множестве поставок Linux (SuSE также добавила
ее, начиная с SuSE 8.0). Просто напишите такие значения в файл <tt>`/etc/sysctl.conf'</tt>:

</P>

<PRE>
# увеличить некоторые значения для MySQL
fs.file-max = 65536
fs.dquot-max = 8192
fs.super-max = 1024
</PRE>

<P>
Кроме того, необходимо добавить в <tt>`/etc/my.cnf'</tt>:

</P>

<PRE>
[safe_mysqld]
open-files-limit=8192
</PRE>

<P>
Добавление такой записи позволит MySQL создавать до 8192 соединений и
файлов.

</P>
<P>
Размером стеков потоков в адресном пространстве управляет константа
<code>STACK_SIZE</code> в LinuxThreads. Ее значение должно быть достаточно большим,
чтобы хватило места стеку каждого потока, но достаточно малым, чтобы
предотвратить попадание стеков некоторых потоков в область общих данных
<code>mysqld</code>. К сожалению, опытным путем нам удалось обнаружить, что реализация
<code>mmap()</code> на Linux в случае поступления запроса на выделение адреса, который
уже используется, вместо возвращения сообщения об ошибке успешно
освобождает все ранее выделенные области и обнуляет данные на всей
странице. Поэтому безопасность использования <code>mysqld</code> или любого другого
потокового приложения зависит от "джентльменского" поведения кода,
создающего потоки. Пользователь должен принять меры для обеспечения
достаточно малого количества выполняемых потоков в любой момент времени,
чтобы стеки потоков не пересекались с динамически выделяемой памятью. В
случае <code>mysqld</code> необходимо навязать это "джентльменское" поведение
установкой переменной <code>max_connection</code> в разумных пределах.

</P>
<P>
Если вы собираете MySQL самостоятельно и не хотите заниматься патчами
LinuxThreads, то необходимо установить значение <code>max_connections</code> так, чтобы
оно не превышало 500. Это значение должно быть еще меньше, если у вас
достаточно велик буфер ключей, большая таблица динамически выделяемой
памяти или имеются другие причины, по которым <code>mysqld</code> занимает большие
объемы памяти, а также в случае, если вы используете ядро 2.2 с патчами
для 2 Гб. Если используются наши бинарные файлы или RPM версии не старше
3.23.25, то можно безопасно устанавливать <code>max_connections</code> равным 1500 -
при условии, что буфер ключей или таблицы динамически выделяемой памяти
имеют небольшие размеры. Чем меньше <code>STACK_SIZE</code> в LinuxThreads, тем больше
потоков можно безопасно создать. Рекомендуемая нами величина составляет от
128K до 256K.

</P>
<P>
При использовании множества одновременных соединений вы можете пострадать
от одной "особенности" ядра 2.2. Данная особенность заключается в том, что
процесс штрафуется за ветвление или порождение дочерних процессов - чтобы
предотвратить атаки ветвлением. Это приводит к неудачному масштабированию
MySQL при увеличении количества одновременных соединений. По нашим данным,
на однопроцессорных машинах из-за данной особенности создание потоков
происходит очень медленно, что может привести к большим затратам времени
на соединение с MySQL (до 1 минуты), и столько же может занять завершение
соединения. Что же касается многопроцессорных систем, то на них
наблюдалось постепенное снижение скорости по мере роста числа клиентов.
Пока мы пытались найти решение проблемы, один из пользователей прислал
патч к ядру, утверждая, что патч заметно улучшил работу его сайта. Патч
доступен по адресу
<a HREF="http://www.mysql.com/Downloads/Patches/linux-fork.patch">http://www.mysql.com/Downloads/Patches/linux-fork.patch</a>. Мы провели
достаточно обширное тестирование этого патча как на развивающейся, так и
на промышленной версиях системы. Применение патча заметно улучшило
производительность <code>MySQL</code>, не вызвав при этом никаких проблем, поэтому
теперь мы рекомендуем его пользователям, которые до сих пор используют
ядро 2.2 на сильно нагруженных серверах. Кроме того, эта проблема была
решена в ядре 2.4, поэтому если вас не устраивает производительность
системы, то, по-видимому, проще сделать ее апгрейд до 2.4, чем
использовать патчи к ядру 2.2. При обновлении системы, помимо исправления
этой ошибки, вы также получите возможность воспользоваться преимуществами
SMP.

</P>
<P>
При тестировании MySQL на двухпроцессорной машине с ядром 2.4 мы
обнаружили, что MySQL масштабируется <strong>гораздо</strong> лучше - фактически
отсутствовало замедление обработки запросов вплоть до 1000 соединений, а
фактор масштабируемости MySQL (который вычисляется как отношение
максимальной производительности к производительности при работе с одним
клиентом) достигал 180%. Подобные результаты мы наблюдали на
четырехпроцессорной системе - фактическое отсутствие замедления при росте
количества соединений до 1000 при факторе масштабируемости в 300%. Поэтому
для интенсивно нагруженных серверов мы настоятельно рекомендуем ядро 2.4.
Оказалось также, что для достижения максимума производительности на ядре
2.4 весьма важно запускать <code>mysqld</code> с наибольшим возможным приоритетом. Для
этого следует добавить в скрипт <code>safe_mysqld</code> команду <code>renice -20 $$</code>. В наших
тестах на четырехпроцессорной машине увеличение приоритета привело к
повышению производительности на 60% при работе 400 клиентов.

</P>
<P>
В дополнение к этому мы сейчас занимаемся сбором информации о
производительности MySQL с ядром 2.4 на четырех- и восьмипроцессорных
системах. Если у вас есть доступ к таким системам и вы тестировали их
производительность, пожалуйста, отправьте сообщение с результатами по
адресу <a HREF="mailto:docs@mysql.com">docs@mysql.com</a> - мы добавим эти результаты в документацию.

</P>
<P>
Существует еще один нюанс, заметно влияющий на производительность

</P>
<P>
MySQL, особенно на многопроцессорных системах. В LinuxThreads в <code>glibc-2.1</code> 
очень плохо реализованы mutex'ы для программ со множеством потоков, в
которых mutex хранится непродолжительное время. Парадоксально, но факт: в
случае, если на многопроцессорных системах собрать MySQL с
немодифицированными LinuxThreads, то при удалении процессора во много раз
увеличивается производительность. Для решения этой проблемы мы предлагаем
патч к <code>glibc 2.1.</code>3
<a HREF="http://www.mysql.com/Downloads/Linux/linuxthreads-2.1-patch">http://www.mysql.com/Downloads/Linux/linuxthreads-2.1-patch</a>.

</P>
<P>
В <code>glibc-2.2.2</code> MySQL версии 3.23.36 использует адаптивный mutex, который
гораздо лучше даже ``патченного'' в <code>glibc-2.3.1</code>. Однако предупреждаем, что
при некоторых условиях код mutex'а в <code>glibc-2.2.2</code> "закручивается"
(overspin), а это ухудшает производительность MySQL. Шансы возникновения
такого события можно понизить, если повысить приоритет выполнения <code>mysqld</code>.
Можно также исправить "закручивание" с помощью патча, доступного по адресу
<a HREF="http://www.mysql.com/Downloads/Linux/linuxthreads-2.2.2.patch">http://www.mysql.com/Downloads/Linux/linuxthreads-2.2.2.patch</a>. Он содержит
в себе коррекцию "закручивания", максимальное количество потоков и размеры
стека - все вместе. Необходимо применить его в каталоге <code>linuxthreads</code>
командой patch <code>-p0 &#60;/tmp/linuxthreads-2.2.2.patch</code>. Мы надеемся, что данный
патч будет в некотором виде включен в следующие выпуски <code>glibc-2.2</code>. В любом
случае - если вы линкуете с использованием библиотеки <code>glibc-2.2.2</code>, то пока
что необходимо исправлять <code>STACK_SIZE</code> и <code>PTHREAD_THREADS_MAX</code>. Мы не теряем
надежду, что в будущем значения по умолчанию будут приведены к более
приемлемым для сборки интенсивно нагруженного MySQL величинам, так что
самостоятельная сборка сведется к выполнению <code>./configure; make; make
install</code>.

</P>
<P>
Вышеупомянутые патчи мы рекомендуем использовать только для создания
специальной статической версии <tt>`libpthread.a'</tt>, а последнюю - применять
только для статического линкования MySQL. Мы уверены, что для MySQL эти
патчи безопасны и заметно улучшают его производительность, но относительно
других приложений данных нет. Линкуя другие приложения с ``патченной''
версией библиотеки или собирая ее динамическую версию и устанавливая ее на
свою систему, вы осознанно идете на риск по отношению к другим
приложениям, использующим LinuxThreads.

</P>
<P>
В случае, если вам придется столкнуться с непонятными проблемами при
инсталляции MySQL или при работе утилит, то причина, вероятнее всего,
связана с библиотеками или компилятором. В таком случае проблему должно
решить использование наших бинарных файлов.

</P>
<P>
Существует одна известная проблема с бинарным дистрибутивом, касающаяся
старых систем Linux, в которых используется <code>libc</code> (таких как RedHat 4.x или
Slackware). Она проявляется в виде некоторых некритичных проблем с
разрешением  имен (see section <A HREF="manual.ru.html#Binary_notes-Linux">2.6.1.1  Примечания к бинарным дистрибутивам Linux</A>).

</P>
<P>
При использовании LinuxThreads одновременно работают как минимум три
процесса. По сути это потоки. Один поток управляет LinuxThreads, один -
обрабатывает соединения и еще один - обрабатывает различные сигналы.

</P>
<P>
Заметим, что ядро Linux и библиотека LinuxThreads по умолчанию могут
поддерживать только 1024 потока. Это значит, что может существовать не
более 1021 соединения с MySQL на системе, к которой не применялись патчи.
Информацию о том, как обойти это ограничение, можно найти на странице 
<a HREF="http://www.volano.com/linuxnotes.html">http://www.volano.com/linuxnotes.html</a>.

</P>
<P>
Если по результату работы команды ps вы видите, что <code>mysqld</code> прекратил
работу,

</P>
<P>
то обычно причиной этого является либо обнаружение ошибки в MySQL, либо
испорченная таблица (see section <A HREF="manual.ru.html#Crashing">A.4.1  Что делать, если работа MySQL сопровождается постоянными сбоями</A>).

</P>
<P>
Если при получении сигнала <code>SIGSEGV</code> <code>mysqld</code> просто умирает, то для получения
образа памяти (core dump) на Linux можно запустить <code>mysqld</code> с опцией
<code>--core-file</code>. Заметим, что при этом вам, возможно, придется увеличить
размер допустимого объема файла образа памяти путем добавления строки
<code>ulimit -c 1000000</code> в <code>safe_mysqld</code> или запуском <code>safe_mysqld</code> с опцией
<code>--core-file-size=1000000</code> (see section <A HREF="manual.ru.html#safe_mysqld">4.7.2  <code>safe_mysqld</code>, оболочка <code>mysqld</code></A>).

</P>
<P>
Если при линковании собственного MySQL-клиента возникла ошибка:

</P>

<PRE>
ld.so.1: ./my: fatal: libmysqlclient.so.4:
open failed: No such file or directory
</PRE>

<P>
то проблему можно обойти одним из следующих способов:

</P>

<UL>
<LI>

линковать клиент с одним из флагов: <code>-Wl,r/path-libmysqlclient.so</code>. (вместо <code>-Lpath</code>);

<LI>

скопировать <tt>`libmysqclient.so'</tt> в <tt>`/usr/lib'</tt>;

<A NAME="IDX327"></A>
<A NAME="IDX328"></A>

<LI>

добавить путь к каталогу, в котором находится <tt>`libmysqlclient.so'</tt>, к переменной окружения <code>LD_RUN_PATH</code> перед запуском клиента.
</UL>

<P>
Если вы используете компилятор Fujitsu (<code>fcc / FCC</code>), то возможны некоторые
проблемы компиляции MySQL поскольку заголовки в Linux в значительной
степени ориентированы на <code>gcc</code>.

</P>
<P>
Данная конфигурация должна работать с <code>fcc/FCC</code>:

</P>

<PRE>
CC=fcc CFLAGS="-O -K fast -K lib -K omitfp -Kpreex -D_GNU_SOURCE \
-DCONST=const -DNO_STRTOLL_PROTO" CXX=FCC CXXFLAGS="-O -K fast -K lib \
-K omitfp -K preex --no_exceptions --no_rtti -D_GNU_SOURCE -DCONST=const \
-Dalloca=__builtin_alloca -DNO_STRTOLL_PROTO \
'-D_EXTERN_INLINE=static __inline'" ./configure --prefix=/usr/local/mysql\
--enable-assembler --with-mysqld-ldflags=-all-static --disable-shared \
--with-low-memory
</PRE>



<H4><A NAME="Binary_notes-Linux" HREF="manual.ru_toc.html#Binary_notes-Linux">2.6.1.1  Примечания к бинарным дистрибутивам Linux</A></H4>

<P>
<A NAME="IDX329"></A>

</P>
<P>
Для работы MySQL необходим Linux версии не ниже 2.0.

</P>
<P>
<strong>Предупреждение</strong>:
По данным, полученным нами от некоторых пользователей
MySQL, на Linux с ядром 2.2.14 имеются серьезные проблемы с устойчивостью
работы MySQL. Если вы используете это ядро, необходимо обновить его до
версии 2.2.19 или выше, либо до ядра версии 2.4. Аргументы в пользу 2.4
становятся еще более весомыми при использовании многопроцессорной системы,
поскольку переход на эту версию ядра приводит к заметному увеличению
скорости.

</P>
<P>
Как правило, бинарный дистрибутив линкуется с опцией <code>-static</code>, а это
значит, что обычно нет необходимости беспокоиться о том, какая версия
системных библиотек у вас установлена. Не требуется также устанавливать
LinuxThreads. Размер программы, слинкованной с опцией <code>-static</code>, обычно
больше в сравнении с версией, собранной динамически, однако скорость
работы у нее выше (3-5%). Существует, однако, одна проблема. Она
заключается в том, что со статически слинкованными программами невозможно
использовать определяемые пользователем функции (user-definable function,
UDF). Если вы собираетесь писать или использовать UDF'ы (это информация,
касающаяся только программистов на C или C++), вам следует собственноручно
собрать MySQL с использованием динамического линкования.

</P>
<P>
При использовании систем, базирующихся на <code>libc</code> (в отличие от
<code>glibc2</code>-систем), могут возникать некоторые проблемы с разрешением имен
удаленных компьютеров и использованием <code>getpwnam()</code> с бинарной версией (это
происходит из-за того, что, к сожалению, <code>glibc</code> зависит от некоторых
внешних библиотек при разрешении имен и использовании <code>getpwent()</code>, даже при
сборке с опцией <code>-static</code>). В таком случае при запуске <code>mysql_install_db</code>
возможно появление следующего сообщения об ошибке:

</P>

<PRE>
Sorry, the host 'xxxx' could not be looked up
</PRE>

<P>
Или же - при запуске <code>mysqld</code> с опцией <code>--user</code> - сообщение об ошибке может
быть таким:

</P>

<PRE>
getpwnam: No such file or directory
</PRE>

<P>
Эту проблему можно решить одним из следующих способов:

</P>

<UL>
<LI>

загрузить и установить дистрибутив MySQL с исходными текстами (RPM или
дистрибутив <code>tar.gz</code>).
<LI>

Запустить <code>mysql_install_db --force</code>, чтобы избежать проверки
<code>resolveip</code> в <code>mysql_install_db</code>. Оборотной стороной такого подхода
является невозможность работать с именами машин в таблицах прав
доступа - вместо них следует должны использовать IP-адреса (за
исключением <code>localhost</code>). Если у вас старая поставка MySQL,
которая не поддерживает ключ <code>--force</code>, то нужно просто удалить в редакторе
проверку <code>resolveip</code> из <code>mysql_install</code>.
<LI>

Запускать <code>mysqld</code> с помощью команды su вместо использования опции <code>--user</code>.
</UL>

<P>
RPM и бинарные файлы MySQL для Linux на архитектуре Intel оптимизированы
для достижения наибольшей возможной скорости работы. Мы всегда стараемся
использовать компиляторы, которые дают наиболее быстрый и устойчивый код.

</P>
<P>
Поддержка Perl в MySQL требует Perl версии не ниже 5.004_03.

</P>
<P>
На некоторых Linux версии 2.2 при попытке создать большое количество новых
соединений с сервером mysqld через TCP/IP вы можете получить сообщение об
ошибке <code>Resource temporarily unavailable</code> (Ресурс временно недоступен).

</P>
<P>
Проблема заключается в задержке между закрытием сокета TCP/IP и реальным
его освобождением системой в Linux. Поскольку существует ограниченное
количество областей для поддержки TCP/IP, вы получите вышеназванную
ошибку, если попытаетесь создать слишком много новых соединений TCP/IP на
протяжении короткого отрезка времени (нечто подобное происходит при
запуске теста на производительность MySQL <tt>`test-connect'</tt> поверх TCP/IP).

</P>
<P>
Об этой проблеме мы несколько раз сообщали в различные списки рассылки по
Linux, однако удачного решения получить не удалось.

</P>
<P>
Единственное известное 'решение' данной проблемы заключается в том, что
ваши клиенты должны работать с постоянными соединениями или использовать
сокеты (в случае, если клиентская и серверная части находятся на одной
машине). Остается надеяться, что эта проблема будет решена в ядре Linux
2.4.

</P>


<H4><A NAME="Linux-x86" HREF="manual.ru_toc.html#Linux-x86">2.6.1.2  Заметки по поводу Linux x86</A></H4>

<P>
Для MySQL необходимо наличие <code>libc</code> версии 5.4.12 или выше. Известно, что
MySQL работает с <code>libc</code> 5.4.46, а также с <code>glibc</code> версии 2.0.6 и более новыми.
Существуют некоторые проблемы с <code>glibc</code> из пакетов в RedHat, поэтому в
случае возникновения проблем следует проверить, нет ли обновлений данной
версии! Известно, что <code>glibc</code> из RPM версий 2.0.7-19 и 2.0.7-29
работоспособны.

</P>
<P>
Если вы используете Red Hat 8.0 или новую glibc 2.2.x вам следует запускать
mysqld с опцией <code>--thread-stack=192K</code>. Если вы этого не сделаете, то
mysqld будет умирать в <code>gethostbyaddr()</code> потому что новая glibc требует &#62;
128Кбайт памяти стека для этого вызова.  Такой размер стека установлен по
умолчанию в MySQL 4.0.10 и более новых. 

</P>
<P>
При использовании для сборки MySQL gcc 3.0 и выше библиотеку libstdc++v3
необходимо установить до сборки; если вы не сделаете этого, то получите
сообщение об отсутствии символа <code>__cxa_pure_virtual</code> во время линкования!

</P>
<P>
На некоторых старых версиях Linux <code>configure</code> может приводить к ошибкам
такого типа:

</P>

<PRE>
Syntax error in sched.h. Change _P to __P in the /usr/include/sched.h file.
See the Installation chapter in the Reference Manual.
</PRE>

<P>
Сделайте именно то, о чем говорится в сообщении об ошибке - добавьте дополнительный символ подчеркивания к имени макроса <code>_P</code>, которое имеет
только один символ подчеркивания в начале, и попробуйте выполнить те же
действия еще раз.

</P>
<P>
При компиляции могут выводиться некоторые предупреждения. Ниже приведены
те из них, которые можно проигнорировать:

</P>

<PRE>
mysqld.cc -o objs-thread/mysqld.o
mysqld.cc: In function `void init_signals()':
mysqld.cc:315: warning: assignment of negative value `-1' to `long unsigned int'
mysqld.cc: In function `void * signal_hand(void *)':
mysqld.cc:346: warning: assignment of negative value `-1' to `long unsigned int'
</PRE>

<P>
<code>mysql.server</code> находится либо в каталоге <tt>`share/mysql'</tt> каталога инсталляции MySQL, либо в каталоге <tt>`support-files'</tt> каталога дерева исходных текстов
MySQL.

</P>
<P>
Возникновение следующей ошибки при линковании <code>mysqld</code> говорит о
некорректной установке <code>libg++.a</code>:

</P>

<PRE>
/usr/lib/libc.a(putc.o): In function `_IO_putc':
putc.o(.text+0x0): multiple definition of `_IO_putc'
</PRE>

<P>
Использования <code>libg++.a</code> можно избежать путем запуска <code>configure</code> следующим
образом:

</P>

<PRE>
shell&#62; CXX=gcc ./configure
</PRE>



<H4><A NAME="Linux-SPARC" HREF="manual.ru_toc.html#Linux-SPARC">2.6.1.3  Примечания к Linux SPARC</A></H4>

<P>
В некоторых версиях Linux SPARC испорчена функция <code>readdir_r()</code>. Это
проявляется в том, что <code>SHOW DATABASES</code> всегда возвращает пустой набор.
Проблема может быть решена удалением <code>HAVE_READDIR_R</code> из <tt>`config.h'</tt> - это
нужно делать после конфигурирования, но до компиляции.

</P>



<H4><A NAME="Linux-Alpha" HREF="manual.ru_toc.html#Linux-Alpha">2.6.1.4  Примечания к Linux Alpha</A></H4>

<P>
MySQL версии 3.23.12 - первая версия MySQL, протестированная на
Linux-Alpha. Поэтому если вы собираетесь использовать MySQL на
Linux-Alpha, следует прежде всего убедиться, что вы используете либо эту
версию, либо более свежую.

</P>
<P>
Мы тестировали MySQL на Alpha при помощи наших тестов на
производительность и все работает превосходно. 

</P>
<P>
При компиляции стандартных бинарных файлов MySQL мы использовали SuSE
7.0 для AXP с ядром 2.4.4-SMP, компилятор Compaq C (6.2-505) и компилятор Compaq
C++ (6.3-006) на компьютере Compaq DS20 с процессором Alpha EV6.

</P>
<P>
Вышеупомянутый компилятор можно найти на
<a HREF="http://www.support.compaq.com/alpha-tools/">http://www.support.compaq.com/alpha-tools/</a>. Использование этого
компилятора вместо gcc привело к улучшению производительности MySQL на
9-14%.

</P>
<P>
Отметим, что до версии MySQL 3.23.52 и 4.0.2 мы оптимизировали исполняемые файлы
только для единственной модели процессора (используя опцию компиляции <code>-fast</code>); это означало 
что вы можете использовать наши двоичные файлы только если у вас процессор Alpha EV6. 

</P>
<P>
Для всех следующих версий мы добавили флаг <code>-arch generic</code> к нашим опциям 
компиляции, что позволяет работать бинарному файлу на всех процессорах Alpha. 
Мы также собираем MySQL статически - во избежание проблем. 

</P>

<PRE>
CC=ccc CFLAGS="-fast -arch generic" CXX=cxx \
CXXFLAGS="-fast -arch generic -noexceptions -nortti" \
./configure --prefix=/usr/local/mysql --disable-shared \
--with-extra-charsets=complex --enable-thread-safe-client \
--with-mysqld-ldflags=-non_shared --with-client-ldflags=-non_shared
</PRE>

<P>
Если вы хотите использовать <code>egcs</code>, то у нас применялась следующая командная
строка конфигурирования:

</P>

<PRE>
CFLAGS="-O3 -fomit-frame-pointer" CXX=gcc \
CXXFLAGS="-O3 -fomit-frame-pointer -felide-constructors \
-fno-exceptions -fno-rtti" ./configure --prefix=/usr/local/mysql \
--disable-shared
</PRE>

<P>
Некоторые известные проблемы при запуске MySQL на Linux-Alpha:

</P>

<UL>
<LI>

отладка потоковых приложений, подобных MySQL, не работает с <code>gdb 4.18</code>.
Вместо него необходимо установить и использовать gdb 5.1!

<LI>

при попытке статического линкования <code>mysqld</code> с использованием <code>gcc</code>
результирующий файл при попытке запуска сбрасывает образ памяти на
диск (core dump) и умирает. Иными словами, не следует использовать с
<code>gcc</code> опцию <code>--with-mysqld-ldflags=-all-static</code>.
</UL>



<H4><A NAME="Linux-PowerPC" HREF="manual.ru_toc.html#Linux-PowerPC">2.6.1.5  Примечания к Linux PowerPC</A></H4>

<P>
MySQL должен работать на MkLinux при наличии самого свежего пакета <code>glibc</code>
(проверено с <code>glibc</code> 2.0.7).

</P>


<H4><A NAME="Linux-MIPS" HREF="manual.ru_toc.html#Linux-MIPS">2.6.1.6  Примечания к Linux MIPS</A></H4>

<P>
Для того чтобы MySQL работал на Qube2 (Linux Mips), необходима самая
свежая версия библиотеки <code>glibc</code> (известно, что MySQL работает с
<code>glibc-2.0.7-29C2</code>). Помимо этого, следует использовать компилятор <code>egcs</code> C++
(<code>egcs-1.0.2-9</code>, <code>gcc 2.95.2</code> или выше).

</P>


<H4><A NAME="Linux-IA64" HREF="manual.ru_toc.html#Linux-IA64">2.6.1.7  Примечания к Linux IA64</A></H4>

<P>
Для компиляции MySQL на Linux IA64 мы применяем следующую команду

</P>
<P>
конфигурирования: используется <code>gcc-2.96</code>:

</P>

<PRE>
CC=gcc CFLAGS="-O3 -fno-omit-frame-pointer" CXX=gcc \
CXXFLAGS="-O3 -fno-omit-frame-pointer -felide-constructors \
-fno-exceptions -fno-rtti" ./configure --prefix=/usr/local/mysql \
"--with-comment=Official MySQL binary" --with-extra-charsets=complex
</PRE>

<P>
На IA64 бинарные файлы MySQL-клиента используют динамические библиотеки.
Это значит, что при установке нашего бинарного дистрибутива куда-либо,
кроме <tt>`/usr/local/mysql'</tt>, необходимо либо модифицировать <tt>`/etc/ld.so.conf'</tt>,
либо добавить путь к каталогу, в котором находится <tt>`libmysqlclient.so'</tt>, к
переменной окружения <code>LD_LIBRARY_PATH</code>.

</P>
<P>
See section <A HREF="manual.ru.html#Link_errors">A.3.1  Проблемы при линковании с клиентской библиотекой MySQL</A>.

</P>


<H3><A NAME="Windows" HREF="manual.ru_toc.html#Windows">2.6.2  Примечания к Windows</A></H3>

<P>
В данном разделе описывается использование MySQL в среде Windows. Эта
информация также находится в файле <tt>`README'</tt>, поставляемом с дистрибутивом
MySQL Windows. See section <A HREF="manual.ru.html#Windows_installation">2.1.2  Установка MySQL на Windows</A>.

</P>



<H4><A NAME="Win95_start" HREF="manual.ru_toc.html#Win95_start">2.6.2.1  Запуск MySQL на Windows 95, 98 или Me</A></H4>

<P>
В MySQL для соединения клиента с сервером используется TCP/IP (это
обеспечивает для любого компьютера в сети возможность соединиться с вашим
MySQL-сервером). Поэтому TCP/IP необходимо установить на машине до запуска
MySQL. TCP/IP, в частности, имеется на CD-диске с дистрибутивом Windows.

</P>
<P>
Обратите внимание: если вы используете один из старых выпусков Windows 95
(например OSR2), то вполне вероятно, что у вас установлен старый пакет
Winsock; а для работы MySQL необходим Winsock 2! Самую свежую версию
Winsock можно получить по адресу http://www.microsoft.com/. Windows 98
содержит новую библиотеку Winsock 2, поэтому данное замечание к ней не
относится.

</P>
<P>
Для запуска <code>mysqld</code> необходимо открыть окно MS-DOS и выполнить:

</P>

<PRE>
C:\&#62; C:\mysql\bin\mysqld
</PRE>

<P>
Это позволит запустить <code>mysqld</code> в фоновом режиме без окна.

</P>
<P>
Работу MySQL-сервера можно остановить командой:

</P>

<PRE>
C:\&#62; C:\mysql\bin\mysqladmin -u root shutdown
</PRE>

<P>
Это вызов программы администрирования MySQL от имени пользователя <code>root</code>,
который по умолчанию соответствует пользователю <code>Administrator</code> в системе
привилегий MySQL. Обратите внимание: система привилегий MySQL абсолютно
независима от каких-либо аккаунтов пользователей в среде Windows.

</P>
<P>
Заметим, что в Windows 95/98/Me не поддерживается создание именованных
каналов. Таким образом, именованные каналы вы можете использовать для
соединения с MySQL-сервером, работающем в системе Windows NT/2000/XP.
(Разумеется, MySQL-сервер также должен поддерживать именованные каналы.
Например, при работе <code>mysqld-opt</code> в системе NT/2000/XP нельзя создавать
соединения с использованием именованных каналов; следует применять либо
<code>mysqld-nt</code>, либо <code>mysqld-max-nt</code>.)

</P>
<P>
Если <code>mysqld</code> не запускается, следует проверить файл <tt>`\mysql\data\mysql.err'</tt>,
на предмет записей, сделанных сервером, - они содержат объяснения причин,
вызвавших проблему. Можно также попробовать запустить сервер командой
<code>mysqld --standalone</code>; в этом случае на экран будет выводиться некоторая
полезная информация, которая может помочь решить проблему.

</P>
<P>
В качестве последней попытки можно попробовать запустить <code>mysqld</code> с флагами
<code>--standalone --debug</code>. В этом случае <code>mysqld</code> будет помещать записи в файл
отладки <tt>`C:\mysqld.trace'</tt>. Возможно, по содержимому этого файла вы сумеете
определить причину, по которой  не запускается <code>mysqld</code>. 
See section <A HREF="manual.ru.html#Making_trace_files">D.1.2  Создание трассировочных файлов</A>.

</P>
<P>
Для вывода всех флагов, которые ``понимает'' <code>mysqld</code>, используйте команду
<code>mysqld --help</code>.

</P>


<H4><A NAME="NT_start" HREF="manual.ru_toc.html#NT_start">2.6.2.2  Запуск MySQL на Windows NT, 2000 или XP</A></H4>

<P>
Для того чтобы MySQL работал с TCP/IP на Windows NT 4, необходимо
установить Service Pack 3 (или выше)!

</P>
<P>
Обычно MySQL устанавливается на Windows NT/2000/XP как сервис. В случае,
если сервер уже работает, необходимо сначала завершить его работу при
помощи следующей команды:

</P>

<PRE>
C:\mysql\bin&#62; mysqladmin -u root shutdown
</PRE>

<P>
Это вызов программы администрирования MySQL от имени пользователя <code>root</code>,
который по умолчанию соответствует пользователю <code>Administrator</code> в системе
привилегий MySQL. Обратите внимание: система привилегий MySQL абсолютно
независима от каких-либо аккаунтов пользователей в системе Windows.

</P>
<P>
Теперь установим сервис сервера:

</P>

<PRE>
C:\mysql\bin&#62; mysqld-max-nt --install
</PRE>

<P>
Если требуются какие-либо опции, они должны быть определены, как ``<code>Start
parameters</code>'' в инструментальной программе <code>Services</code> системы Windows перед
запуском сервиса MySQL.

</P>
<P>
Доступ к инструментальной программе <code>Services</code> (<code>Windows Service Control
Manager</code>) можно получить в <code>Control Panel</code> (в <code>Administrative Tools</code> в Windows
2000). Рекомендуется закрывать <code>Services</code> при выполнении операций <code>--instal</code> 
или <code>--remove</code> - это предотвратит возникновение некоторых ошибок неизвестной
природы.

</P>
<P>
За информацией о том, какие бинарные файлы следует использовать для
запуска сервера, обращайтесь к разделу See section <A HREF="manual.ru.html#Windows_prepare_environment">2.1.2.2  Подготовка конфигурации MySQL для Windows</A>.

</P>
<P>
Отметим, что начиная с версии 3.23.44 MySQL имеется возможность
альтернативной установки сервиса - в режиме <code>Manual</code> (если вам не требуется
автоматический запуск сервиса при загрузке операционной системы):

</P>

<PRE>
C:\mysql\bin&#62; mysqld-max-nt --install-manual
</PRE>

<P>
Сервис устанавливается под именем MySQL. Сразу же после установки он может
быть запущен при помощи инструментальной программы <code>Services</code> или командой
<code>NET START MySQL</code>.

</P>
<P>
После запуска работа <code>mysqld-max-nt</code> может быть завершена при помощи
mysqladmin из инструментальной программы <code>Services</code> или командой <code>NET STOP
MySQL</code>.

</P>
<P>
Если MySQL функционирует в качестве сервиса, то операционная система
автоматически завершает работу <code>MySQL</code>-сервиса при программном завершении
работы компьютера. В версиях MySQL &#60; 3.23.47 Windows ожидает всего лишь
несколько секунд завершения остановки, после чего уничтожает процесс
сервера базы данных, если превышено время ожидания (что может быть
потенциальной причиной возникновения проблем). Например, при следующем
запуске обработчик таблицы <code>InnoDB</code> должен выполнять восстановление после
аварийного завершения. Начиная с MySQL версии 3.23.48, Windows ожидает
завершения процесса MySQL-сервера дольше. Если вы считаете, что этого
времени для вашей версии недостаточно, безопаснее запускать MySQL-сервер
не как сервис, а из командной строки и завершать его работу командой
<code>mysqladmin shutdown</code>.

</P>
<P>
В Windows NT (но не в Windows 2000/XP) существует проблема, которая
заключается в том, что система по умолчанию ожидает окончания работы
сервиса только 20 секунд, после чего уничтожает процесс сервиса. Это
заданное по умолчанию значение можно увеличить с помощью редактора
Registry (Реестра), запустив <tt>`\winnt\system32\regedt32.exe'</tt> и отредактировав
значение <code>WaitToKillServiceTimeout</code> в записи
<code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control</code>. Следует задать
другое, большее значение в миллисекундах, например 120000, чтобы Windows
NT ожидала 120 секунд.

</P>
<P>
Необходимо заметить, что при работе в качестве сервиса <code>mysqld-max-nt</code> не
имеет доступа к консоли, а следовательно, невозможно увидеть его
сообщения. Информация об ошибках находится в файле
<tt>`c:\mysql\data\mysql.err'</tt>.

</P>
<P>
Если вы столкнулись с проблемами установки <code>mysqld-max-nt</code> в качестве
сервиса, попробуйте запустить его с указанием полного пути:

</P>

<PRE>
C:\&#62; C:\mysql\bin\mysqld-max-nt --install
</PRE>

<P>
Если это не поможет, можно принудить <code>mysqld-max-nt</code> стартовать
соответствующим образом, исправив путь в Registry!

</P>
<P>
Если вы не хотите запускать <code>mysqld-max-nt</code> в качестве сервиса, его можно
запустить следующим образом:

</P>

<PRE>
C:\&#62; C:\mysql\bin\mysqld-max-nt --standalone
или
C:\&#62; C:\mysql\bin\mysqld --standalone --debug
</PRE>

<P>
В случае последнего варианта вы получите отладочную информацию в
<tt>`C:\mysqld.trace'</tt>. See section <A HREF="manual.ru.html#Making_trace_files">D.1.2  Создание трассировочных файлов</A>.

</P>


<H4><A NAME="Windows_running" HREF="manual.ru_toc.html#Windows_running">2.6.2.3  Работа MySQL в среде Windows</A></H4>

<P>
<A NAME="IDX330"></A>
<A NAME="IDX331"></A>

</P>
<P>
MySQL поддерживает TCP/IP на всех Windows-системах и именованные каналы в
среде NT/2000/XP. По умолчанию MySQL использует именованные каналы для
соединений с локальной машиной в среде NT/2000/XP и TCP/IP - во всех
остальных случаях, если на клиентской машине установлен TCP/IP. Имя машины
определяет используемый протокол:

</P>
<TABLE BORDER>
<TR><TD><strong>Имя машины</strong> </TD><TD> <strong>Протокол</strong>
</TD></TR>
<TR><TD>NULL(отсутствует) </TD><TD>
На NT/2000/XP пытается установить соединение через именованные каналы; если это не работает, используется TCP/IP. На 9x/Me используется TCP/IP.
</TD></TR>
<TR><TD>. </TD><TD> Именованные каналы.
</TD></TR>
<TR><TD>localhost </TD><TD> Соединение TCP/IP с локальной машиной
</TD></TR>
<TR><TD>имя удаленной машины </TD><TD> TCP/IP
</TD></TR>
</TABLE>

<P>
Чтобы заставить MySQL-клиента использовать именованные каналы, следует
добавить опцию <code>--pipe</code> или задать <code>.</code> в качестве имени машины для
соединения. Для определения имени канала используйте опцию <code>--socket</code>.
В MySQL 4.1  вам следует использовать опцию <code>--protocol=PIPE</code>.

</P>
<P>
Отметим, что начиная с версии 3.23.50 именованные каналы применяются
только в случае, если <code>mysqld</code> запущен с опцией <code>--enable-named-pipe</code>. Это
вызвано тем, что у некоторых пользователей применение именованных каналов
приводило к прекращению работы сервера MySQL.

</P>
<P>
Для проверки работоспособности MySQL нужно выполнить следующие команды:

</P>

<PRE>
C:\&#62; C:\mysql\bin\mysqlshow
C:\&#62; C:\mysql\bin\mysqlshow -u root mysql
C:\&#62; C:\mysql\bin\mysqladmin version status proc
C:\&#62; C:\mysql\bin\mysql test
</PRE>

<P>
Если при ответе <code>mysqld</code> на входящие соединения под Windows 9x/Me возникают
задержки, то это, скорее всего, вызвано проблемами с вашим DNS. В таком
случае следует запускать mysqld с опцией <code>--skip-name-resolve</code> и в таблицах
привилегий MySQL использовать только <code>localhost</code> и IP-адреса. Избежать
работы с DNS при соединении с MySQL-сервером <code>mysqld-nt</code>, работающим под
NT/2000/XP, можно путем применения опции <code>--pipe</code>, которая задает
использование именованных каналов. Сказанное выше справедливо для
большинства клиентов MySQL.

</P>
<P>
Существует две версии программы работы с MySQL из командной строки:

</P>
<TABLE BORDER>
<TR><TD><strong>Бинарный файл</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD><code>mysql</code> </TD><TD> Собран ``родными'' средствами Windows, обеспечивает весьма ограниченные возможности редактирования текста.
</TD></TR>
<TR><TD><code>mysqlc</code> </TD><TD> Собран с использованием компилятора и библиотек Cygnus GNU, которые обеспечивают редактор <code>readline</code>.
</TD></TR>
</TABLE>

<P>
Если вы хотите использовать <tt>`mysqlc.exe'</tt>, сначала необходимо скопировать
<tt>`C:\mysql\lib\cygwinb19.dll'</tt> в системный каталог Windows (<tt>`\windows\system'</tt> 
или в другое аналогичное место).

</P>
<P>
По умолчанию всем пользователям Windows предоставляются полные права
доступа ко всем базам данных без ввода пароля. Чтобы обеспечить большую
безопасность MySQL, необходимо задать пароль для каждого пользователя и
удалить запись в таблице <code>mysql.user</code>, содержащую <code>Host='localhost'</code> и <code>User='
`</code>.

</P>
<P>
Необходимо также установить пароль для пользователя <code>root</code>. Приведенный ниже
пример начинается с удаления возможности анонимного доступа, который может
быть использован любым пользователем для установки пароля для пользователя 
<code>root</code>:

</P>

<PRE>
C:\&#62; C:\mysql\bin\mysql mysql
mysql&#62; DELETE FROM user WHERE Host='localhost' AND User=' ';
mysql&#62; QUIT
C:\&#62; C:\mysql\bin\mysqladmin reload
C:\&#62; C:\mysql\bin\mysqladmin -u root password your_password
</PRE>

<P>
Если вы хотите остановить сервер <code>mysqld</code> после того, как установлен пароль
для пользователя <code>root</code>, нужно использовать команду:

</P>

<PRE>
C:\&#62; mysqladmin --user=root --password=your_password shutdown
</PRE>

<P>
Если у вас работает старая испытательная версия MySQL 3.21 под Windows,
вышеприведенная команда не выполнится и приведет к сообщению об ошибке:
<code>parse error near `SET password'</code>. Для решения этой проблемы следует
выполнить загрузку и обновление до последней доступной бесплатно версии
MySQL.

</P>
<P>
В текущей версии MySQL вы можете легко добавлять новых пользователей и
изменять их привилегии при помощи команд <code>GRANT</code> и <code>REVOKE</code> (see section <A HREF="manual.ru.html#GRANT">4.3.1  Синтаксис команд <code>GRANT</code> и <code>REVOKE</code></A>).

</P>


<H4><A NAME="Windows_and_SSH" HREF="manual.ru_toc.html#Windows_and_SSH">2.6.2.4  Соединение с MySQL на удаленной машине под Windows с использованием SSH</A></H4>

<P>
<A NAME="IDX332"></A>
<A NAME="IDX333"></A>

</P>
<P>
В этом разделе приведены замечания относительно получения безопасного
соединения с удаленным MySQL-сервером с использованием SSH. Автором этих
замечаний является Дэвид Карлсон (David Carlson) - <a HREF="mailto:dcarlson@mplcomm.com">dcarlson@mplcomm.com</a>:

</P>

<UL>
<LI>

Установите SSH-клиент на своей Windows-системе. С точки зрения
пользователя, лучшим небесплатным клиентом из числа мне известных является
клиент <code>SecureCRT</code> по адресу <a HREF="http://www.vandyke.com/">http://www.vandyke.com/</a>. Другой возможный
вариант - <code>f-secure</code> от <a HREF="http://www.f-secure.com/">http://www.f-secure.com/</a>. Есть и бесплатные версии -
их можно получить на <code>Google</code> по адресу
<a HREF="http://directory.google.com/Top/Computers/Security/Products_and_Tools/CryptographySSH/Clients/Windows/">http://directory.google.com/Top/Computers/Security/Products_and_Tools/CryptographySSH/Clients/Windows/</a> 

<LI>

Запустите Windows-клиент SSH. Установите
<code>Host_Name=адрес_своего_MySQL-сервера</code>. Задайте <code>userid=свой_userid</code> для
соединения со своим сервером (может отличатся от вашего имени
пользователя/пароля для MySQL).

<LI>

Задайте перенаправление портов или организуйте удаленный форвардинг
(нужно сделать следующие установки: <code>локальный порт - 3306</code>, <code>удаленный хост
- адреса_вашего_mysql_сервера</code>, <code>удаленный порт - 3306</code>) либо локальный
форвардинг (<code>порт - 3306</code>, <code>хост - localhost</code>, <code>удаленный порт - 3306</code>).

<LI>

Сохраните выполненные установки, иначе вам придется в следующий раз
делать все заново.

<LI>

Соединитесь со своим сервером, используя только что созданный вами
SSH-сеанс.

<LI>

Запустите в Windows какое-либо ODBC-приложение (например Access).

<LI>

Создайте в Windows новый файл и ссылку на MySQL, используя ODBC-драйвер
обычным образом, за исключением того, что вместо имени вашего
MySQL-сервера следует указывать <code>localhost</code>, а не <code>yourmysqlservername</code>.
</UL>

<P>
В результате этих действий вы должны получить ODBC-соединение со своим
MySQL-сервером, защищенное при помощи SSH-кодирования.

</P>


<H4><A NAME="Windows_symbolic_links" HREF="manual.ru_toc.html#Windows_symbolic_links">2.6.2.5  Распределение данных в Windows между несколькими различными дисками</A></H4>

<P>
<A NAME="IDX334"></A>
<A NAME="IDX335"></A>
<A NAME="IDX336"></A>

</P>
<P>
Начиная с MySQL версии 3.23.16 серверы <code>mysqld-max</code> и <code>mysql-max-nt</code> в
дистрибутиве MySQL компилируются с флагом <code>-DUSE_SYMDIR</code>. Это обеспечивает
возможность устанавливать базу данных на другом диске путем добавления
символической ссылки на нее (подобно тому, как работают символические
ссылки в Unix).

</P>
<P>
В Windows для создания символической ссылки на базу данных создается файл,
содержащий путь к каталогу, на который указывает ссылка. Этот файл
сохраняется в каталоге <tt>`mysql_data'</tt> под именем <tt>`database.sym'</tt>. Отметим, что
такая символическая ссылка будет работать только в случае отсутствия
каталога <tt>`mysql_data_dir\database'</tt>.

</P>
<P>
Например, если каталог данных MySQL находится в <tt>`C:\mysql\data'</tt>, а вы хотите
разместить базу данных <code>foo</code> в каталоге <tt>`D:\data\foo'</tt>, необходимо создать файл
<tt>`C:\mysql\data\foo.sym'</tt>, содержащий текст <tt>`D:\data\foo\'</tt>. После этого все
таблицы, создаваемые в базе данных <code>foo</code>, будут создаваться в <tt>`D:\data\foo'</tt>.

</P>
<P>
Отметим, что из-за потерь в скорости при открытии каждой таблицы в MySQL
не включается использование символических ссылок по умолчанию, даже если
вы собрали MySQL с поддержкой данной возможности. Чтобы обеспечить
возможность разрешения символических ссылок, вы должны поместить в свой
файл <tt>`my.cnf'</tt> или <tt>`my.ini'</tt> следующие строки:

</P>

<PRE>
[mysqld]
use-symbolic-links
</PRE>

<P>
В MySQL 4.0 использование символических ссылок по умолчанию будет
включено. Если вы хотите запретить эту возможность, то для данной версии
MySQL необходимо использовать опцию <code>skip-symlink</code>.

</P>


<H4><A NAME="Windows_client_compiling" HREF="manual.ru_toc.html#Windows_client_compiling">2.6.2.6  Компиляция MySQL-клиентов в среде Windows</A></H4>

<P>
<A NAME="IDX337"></A>
<A NAME="IDX338"></A>

</P>
<P>
В файлах исходных текстов следует перед <tt>`mysql.h'</tt> включить <tt>`windows.h'</tt>:

</P>

<PRE>
#if defined(_WIN32) || defined(_WIN64)
#include &#60;windows.h&#62;
#endif
#include &#60;mysql.h&#62;
</PRE>

<P>
Линковать свою программу можно либо с использованием динамической
библиотеки <tt>`libmysql.lib'</tt>, которая является просто оболочкой для загрузки
<tt>`libmysql.dll'</tt> по требованию, либо со статической библиотекой
<tt>`mysqlclient.lib'</tt>.

</P>
<P>
Отметим, что поскольку библиотеки <code>mysqlclient</code> компилируются как потоковые
библиотеки, следует скомпилировать вашу программу так, чтобы была
разрешена многопочность!

</P>


<H4><A NAME="Windows_vs_Unix" HREF="manual.ru_toc.html#Windows_vs_Unix">2.6.2.7  Сравнительные характеристики MySQL под Windows и под Unix</A></H4>

<P>
<A NAME="IDX339"></A>
<A NAME="IDX340"></A>

</P>
<P>
На настоящий момент версия MySQL под Windows зарекомендовала себя как
весьма устойчивая. Возможности этой версии и версии под Unix аналогичны,
за исключением следующих моментов:

</P>
<DL COMPACT>

<DT><strong>Windows 95 и потоки</strong>
<DD>
При создании каждого потока в Windows 95 теряется приблизительно 200
байтов основной памяти. А поскольку каждое соединение с MySQL создает
новый поток, на Windows 95 не следует запускать <code>mysqld</code> на продолжительное
время, если ваш сервер обрабатывает много соединений! Другие версии
Windows не подвержены этой ошибке.

<DT><strong>Параллельное чтение</strong>
<DD>
Для обработки смешанных запросов <code>SELECT</code> и <code>INSERT</code> в MySQL используются
функции <code>pread()</code> и <code>pwrite()</code>. В настоящее время для эмуляции
<code>pread()</code>/<code>pwrite()</code> мы применяем mutex'ы. Однако в наши планы на будущее
входит замена интерфейса файлового уровня виртуальным интерфейсом, чтобы
иметь возможность использовать интерфейс <code>readfile()</code>/<code>writefile()</code> на
NT/2000/XP - с целью ускорения работы. В текущей реализации число
одновременно открытых в MySQL файлов не может быть больше 1024; это
означает, что вы не сможете создать такое же количество одновременных
соединений с MySQL в NT/2000/XP, как в Unix.

<DT><strong>Чтение с блокировкой</strong>
<DD>
В MySQL для каждого соединения используется чтение с блокировкой. Это
означает, что:


<UL>
<LI>

Соединение не будет автоматически закрыто по истечении 8 часов, как в
случае Unix-версии MySQL.

<LI>

В случае ``зависания'' соединения невозможно оборвать его без остановки
MySQL.

<LI>

<code>mysqladmin kill</code> не работает для ``спящих'' соединений

<LI>

<code>mysqladmin shutdown</code> не может отработать до тех пор, пока существуют
``спящие'' соединения.
</UL>

Перечисленные проблемы мы планируем решить, когда наши разработчики под
Windows придумают изящный способ их решения.

<DT><strong>DROP DATABASE</strong>
<DD>
Нельзя удалить базу данных, если она используется каким-либо потоком.

<DT><strong>Остановка MySQL из диспетчера задач</strong>
<DD>
В Windows 95 нельзя остановить MySQL из диспетчера задач или с помощью
инструментальной программы <code>shutdown</code>; это можно сделать с помощью
<code>mysqladmin shutdown</code>.

<DT><strong>Имена, не зависящие от регистра символов</strong>
<DD>
Имена файлов в Windows не зависят от регистра символов, поэтому имена
таблиц и баз данных в MySQL под Windows также не зависимы от регистра.
Единственное ограничение заключается в том, что имена баз данных и таблиц
в пределах одного выражения должны задаваться с использованием одинакового
регистра символов (see section <A HREF="manual.ru.html#Name_case_sensitivity">6.1.3  Чувствительность имен к регистру</A>).

<DT><strong>Символ каталогов <samp>`\'</samp></strong>
<DD>
Компоненты путей в Windows 95 разделяются символом <samp>`\'</samp>, который также
является символом экранирования в MySQL. Если вы используете <code>LOAD DATA
INFILE</code> или <code>SELECT ... INTO OUTFILE</code>, символ <samp>`\'</samp> необходимо вводить дважды:


<PRE>
mysql&#62; LOAD DATA INFILE "C:\\tmp\\skr.txt" INTO TABLE skr;
mysql&#62; SELECT * INTO OUTFILE 'C:\\tmp\\skr.txt' FROM skr;
</PRE>

В качестве альтернативы можно использовать имена файлов Unix-стиля:


<PRE>
mysql&#62; LOAD DATA INFILE "C:/tmp/skr.txt" INTO TABLE skr;
mysql&#62; SELECT * INTO OUTFILE 'C:/tmp/skr.txt' FROM skr;
</PRE>

<DT><strong>Ошибка <code>can't open named pipe</code> (невозможно открыть именованный канал)</strong>
<DD>
При использовании MySQL версии 3.22 на NT с самым свежим клиентом <code>mysql</code>
можно получить следующее сообщение об ошибке:


<PRE>
error 2017: can't open named pipe to host: . pipe...
</PRE>

<A NAME="IDX341"></A>
Это происходит из-за того, что в данной версии MySQL на NT именованные
каналы применяются по умолчанию. Чтобы избежать таких ошибок, следует
использовать с новым клиентом MySQL флаг <code>--host=localhost</code> или создать файл
флагов <tt>`C:\my.cnf'</tt>, содержащий следующие строки:


<PRE>
[client]
host = localhost
</PRE>

Начиная с версии 3.23.50 именованные каналы используются только в случае,
если <code>mysqld</code> запущен с флагом <code>--enable-named-pipe</code>.

<DT><strong>Ошибка <code>access denied for user</code> (доступ пользователю запрещен)</strong>
<DD>
Если вы получили сообщение об ошибке <code>Access denied for user:
`some-user@unknown' to database `mysql'</code> при попытке доступа к
MySQL-серверу, находящемуся на той же машине, с которой происходит доступ,
это значит, что MySQL не может правильно определить адрес вашей машины.
Для решения данной проблемы следует создать файл <tt>`\windows\hosts'</tt>,
содержащий:


<PRE>
127.0.0.1 localhost
</PRE>

<DT><strong><code>ALTER TABLE</code></strong>
<DD>
При выполнении оператора <code>ALTER TABLE</code> доступ к таблице для других потоков
блокируется. Именно поэтому Windows не может удалить файл, который
используется другим потоком (возможно, в будущем мы найдем какой-нибудь
способ обойти эту проблему). Выполнение <code>DROP TABLE</code> над таблицей, входящей
в состав сводной таблицы <code>MERGE</code>, не будет работать в Windows, так как
отображение таблицы, которое выполняет обработчик <code>MERGE</code>, скрыто от
верхнего уровня MySQL. Поскольку в Windows нельзя удалять открытые файлы,
вначале следует сбросить все <code>MERGE</code>-таблицы (используя <code>FLUSH TABLES</code>) или
удалить все <code>MERGE</code>-таблицы перед удалением таблицы. Мы исправим эту ошибку
одновременно с введением оператора <code>VIEW</code>. Операторы <code>DATA DIRECTORY</code> и <code>INDEX
DIRECTORY</code> в <code>CREATE TABLE</code> в Windows игнорируются, поскольку Windows не
поддерживает символические ссылки.
</DL>

<P>
Ниже приведены некоторые открытые вопросы для всех, кто захочет помочь нам в работе над выпусками под Windows:

</P>
<P>
<A NAME="IDX342"></A>

</P>

<UL>
<LI>

Требуется создать однопользовательский сервер <tt>`MYSQL.DLL'</tt>. Он должен
включать все возможности стандартного MySQL-сервера, за исключением
потоков. Это заметно упростит использование MySQL в приложениях, которые
не нуждаются в настоящем клиент-серверном взаимодействии и в доступе к
базе с других машин.
<LI>

Нужно было бы добавить в инсталляционный пакет нескольких симпатичных
иконок для старта и остановки MySQL.
<LI>

При регистрации <code>mysqld</code> в качестве сервиса с флагом <code>--install</code> (на NT)
было бы неплохо иметь возможность добавлять флаги по умолчанию к командной
строке. Сейчас эта проблема решается путем записи списка параметров в файл
<tt>`C:\my.cnf'</tt>.
<LI>

Было бы удобно останавливать <code>mysqld</code> из диспетчера задач. Сейчас для
этого нужно применять <code>mysqladmin shutdown</code>.
<LI>

Требуется перенести <code>readline</code> в Windows для использования с
инструментальной программой, запускаемой из командной строки <code>mysql</code>.
<LI>

GUI версия стандартных MySQL-клиентов (<code>mysql</code>, <code>mysqlshow</code>, <code>mysqladmin</code> и
<code>mysqldump</code>) будет очень полезна.
<LI>

Было бы хорошо, если бы чтение и запись сокетов из <tt>`net.c'</tt> можно было бы
прерывать. Это позволило бы останавливать открытые потоки командой
<code>mysqladmin kill</code> в Windows.
<LI>

<code>mysqld</code> всегда стартует в местоположении "C", а не в местоположении,
установленном по умолчанию. С благодарностью будет принято исправление,
позволяющее использование программой <code>mysqld</code> текущего значения
местоположения для порядка сортировки.
<LI>

Требуется добавить макрос для ускорения безопасного для потоков метода
инкремента/декремента, обеспечиваемого Windows.
<LI>

Остальные, специфические для Windows вопросы, можно найти в файле <code>README</code>,
который находится в поставке MySQL-Windows.
</UL>



<H3><A NAME="Solaris" HREF="manual.ru_toc.html#Solaris">2.6.3  Примечания к Solaris</A></H3>

<P>
<A NAME="IDX343"></A>
<A NAME="IDX344"></A>
<A NAME="IDX345"></A>
<A NAME="IDX346"></A>

</P>
<P>
В системе Solaris проблемы подстерегают вас еще до распаковки дистрибутива
MySQL! Программа tar в Solaris ``не умеет'' работать с длинными именами
файлов, поэтому при попытке распаковать MySQL вы можете увидеть сообщение
об ошибке, подобное следующему:

</P>

<PRE>
x mysql-3.22.12-beta/bench/Results/ATIS-mysql_odbc-NT_4.0-cmp-db2,\
informix,ms-sql,mysql,oracle,solid,sybase, 0 bytes, 0 tape blocks
tar: directory checksum error
</PRE>

<P>
В этом случае для распаковки дистрибутива необходимо использовать
GNU-версию программы <code>tar</code> (<code>gtar</code>). Скомпилированную версию данной программы
для Solaris можно загрузить с <a HREF="http://www.mysql.com/downloads/os-solaris.html">http://www.mysql.com/downloads/os-solaris.html</a>.

</P>
<P>
Собственные потоки Sun работают только начиная с версии Solaris 2.5. Для
версии 2.4 и более ранних MySQL автоматически использует MIT-pthreads (see section <A HREF="manual.ru.html#MIT-pthreads">2.3.6  Замечания по потокам MIT-pthreads</A>).

</P>
<P>
Следующее сообщение об ошибке конфигурации:

</P>

<PRE>
checking for restartable system calls... configure: error can not run test
programs while cross compiling
</PRE>

<P>
означает, что имели место какие-то ошибки в установке компилятора! В этом
случае необходимо обновить ваш компилятор до более свежей версии. Эту
проблему можно также решить, вставив в файл <tt>`config.cache'</tt> следующую строку:

</P>

<PRE>
ac_cv_sys_restartable_syscalls=${ac_cv_sys_restartable_syscalls='no'}
</PRE>

<P>
При использовании Solaris на SPARC мы рекомендуем компилятор <code>gcc</code> 2.95.2.
Его можно получить по адресу <a HREF="http://gcc.gnu.org/">http://gcc.gnu.org/</a>. Отметим, что <code>egcs</code> 1.1.1
и <code>gcc</code> 2.8.1 работают на SPARC ненадежно!

</P>
<P>
Рекомендуемая строка для <code>configure</code> при использовании <code>gcc</code> 2.95.2:

</P>

<PRE>
CC=gcc CFLAGS="-O3" \
CXX=gcc CXXFLAGS="-O3 -felide-constructors -fno-exceptions -fno-rtti" \
./configure --prefix=/usr/local/mysql --with-low-memory --enable-assembler
</PRE>

<P>
Если используется UltraSPARC, то при добавлении строки "-mcpu=v8
-Wa,-xarch=v8plusa" к переменным CFLAGS и CXXFLAGS можно получить
повышение производительности на 4%.

</P>
<P>
При использовании компилятора Sun Fortre версии 5.0 (или выше)
можно запускать <code>configure</code> следующим образом:

</P>

<PRE>
CC=cc CFLAGS="-Xa -fast -xO4 -native -xstrconst -mt" \
CXX=CC CXXFLAGS="-noex -xO4 -mt" \
./configure --prefix=/usr/local/mysql --enable-assembler
</PRE>

<P>
Можно создать 64-разрядный исполняемый код с помощью: 

</P>

<PRE>
CC=cc CFLAGS="-Xa -fast -native -xstrconst -mt -xarch=v9" \
CXX=CC CXXFLAGS="-noex -mt -xarch=v9" ASFLAGS="-xarch=v9" \
./configure --prefix=/usr/local/mysql --enable-assembler
</PRE>

<P>
В тестах на производительность MySQL с Sun Fortre 5.0 мы получили 4%-ное
ускорение на UltraSPARC по сравнению с gcc 3.2 с опцией -mcpu.

</P>
<P>
Если вы создаете 64-разрядный код, он на 4% медленнее чем 32-разрядный, но 
mysqld можно обслуживать больше потоков и использовать больше памяти. 

</P>
<P>
В случае возникновения проблем с <code>fdatasync</code> или <code>sched_yield</code> их можно решить
путем добавления <code>LIBS=-lrt</code> к командной строке запуска конфигурирования.

</P>
<P>
Последующий абзац относится только к более ранним, чем WorkShop 5.3,
компиляторам:

</P>
<P>
Отредактировать скрипт configure можно, заменив строку:

</P>

<PRE>
#if !defined(__STDC__) || __STDC__ != 1
</PRE>

<P>
строкой:

</P>

<PRE>
#if !defined(__STDC__)
</PRE>

<P>
При включении <code>__STDC__</code> с помощью опции <code>-Xc</code> компилятор Sun не сможет
откомпилировать программу с файлом <tt>`pthread.h'</tt> из системы Solaris. Это
ошибка Sun (испорченный компилятор или испорченный включаемый файл).

</P>
<P>
Если при запуске <code>mysqld</code> выдает приведенное ниже сообщение об ошибке:

</P>

<PRE>
libc internal error: _rmutex_unlock: rmutex not held
</PRE>

<P>
необходимо попробовать собрать MySQL, используя компилятор Sun с опцией
запрещения многопоточности (<code>-mt</code>). Добавьте опцию <code>-mt</code> к <code>CFLAGS</code> и <code>CXXFLAGS</code> и
попробуйте запустить <code>mysqld</code> еще раз.

</P>
<P>
При использовании SFW версии gcc (поставляемой с Solaris 8) необходимо к
переменной окружения <code>LD_LIBRARY_PATH</code> перед конфигурированием добавить
<tt>`/opt/sfw/lib'</tt>.

</P>
<P>
При работе с <code>gcc</code> от <code>sunfreeware</code>.com может возникнуть множество
неприятностей. Во избежание проблем необходимо перекомпилировать gcc и
бинарные инструментальные программы GNU в той системе, где вы собираетесь
их использовать.

</P>
<P>
Получение нижеследующей ошибки при компиляции MySQL компилятором <code>gcc</code>
означает, что <code>gcc</code> не сконфигурирован под вашу версию Solaris:

</P>

<PRE>
shell&#62; gcc -O3 -g -O2 -DDBUG_OFF -o thr_alarm ...
./thr_alarm.c: In function `signal_hand':
./thr_alarm.c:556: too many arguments to function `sigwait'
</PRE>

<P>
В этом случае нужно взять самую свежую версию <code>gcc</code> и скомпилировать ее
установленным <code>gcc</code>-компилятором! Почти все бинарные версии <code>gcc</code> (по крайней
мере для Solaris 2.5) содержат старые, непригодные к использованию
включаемые файлы, которые портят все программы, использующие потоки (а
возможно, и другие программы)!

</P>
<P>
В Solaris не обеспечиваются статические версии всех системных библиотек
(<code>libpthreads</code> и <code>libdl</code>), поэтому компилировать MySQL с опцией <code>-static</code> 
нельзя. При попытке такой компиляции вы получите одно из приведенных ниже
сообщений об ошибке:

</P>

<PRE>
ld: fatal: library -ldl: not found
или
undefined reference to `dlopen'
или
cannot find -lrt
</PRE>

<P>
Если слишком много процессов одновременно пытаются установить соединение с
<code>mysqld</code>, то в файле протокола MySQL появится следующее сообщение об ошибке:

</P>

<PRE>
Error in accept: Protocol error
</PRE>

<P>
Для решения этой проблемы можно попытаться запустить сервер с опцией
<code>--set-variable back_log=50</code>. Внимание: <code>--set-variable</code> 
не используется в MySQL 4.0. Просто используйте <code>--back_log=50</code>.
See section <A HREF="manual.ru.html#Command-line_options">4.1.1  Параметры командной строки <code>mysqld</code></A>.

</P>

<P>
Если вы линкуете собственный MySQL-клиент, то при попытке его запустить
может выдаваться следующее сообщение об ошибке:

</P>

<PRE>
ld.so.1: ./my: fatal: libmysqlclient.so.#:
open failed: No such file or directory
</PRE>

<P>
Проблему можно решить одним из следующих способов:

</P>

<UL>
<LI>

Линковать клиент со следующими опциями (вместо <code>-Lpath</code>):
<code>-Wl,r/полный-путь-к-libmysqlclient.so</code>.

<LI>

Скопировать <tt>`libmysqclient.so'</tt> в <tt>`/usr/lib'</tt>.

<A NAME="IDX347"></A>
<A NAME="IDX348"></A>

<LI>

Перед запуском своего клиента добавить путь к каталогу, в котором
находится <tt>`libmysqclient.so'</tt>, к переменной окружения <code>LD_RUN_PATH</code>.
</UL>

<P>
Если вы столкнулись с проблемами конфигурирования, пытаясь линковать с
опцией <code>-lz</code> и у вас не установлена <code>zlib</code>, существует два варианта:

</P>

<UL>
<LI>

Если вы хотите иметь возможность использовать протокол взаимодействия со
сжатием, необходимо получить и установить zlib с ftp.gnu.org.
<LI>

Сконфигурировать с <code>--with-named-z-libs=no</code>.
</UL>

<P>
Если при использовании <code>gcc</code> вы столкнулись с проблемами загрузки
UDF-функций в MySQL, попробуйте добавить <code>-lgcc</code> к строке, отвечающей за
линкование UDF-функций.

</P>
<P>
Для того чтобы MySQL-сервер стартовал автоматически, можно скопировать
<tt>`support-files/mysql.server'</tt> в <tt>`/etc/init.d'</tt> и создать на него символическую
ссылку <tt>`/etc/rc3.d/S99mysql.server'</tt>.

</P>
<P>
Поскольку Solaris не поддерживает файлы образа памяти для приложений,
использующих <code>setuid()</code>, невозможно получить файл образа памяти программы
<code>mysqld</code> при использовании опции <code>--user</code>.

</P>



<H4><A NAME="Solaris_2.7" HREF="manual.ru_toc.html#Solaris_2.7">2.6.3.1  Примечания к Solaris 2.7/2.8</A></H4>

<P>
На Solaris 2.7 и 2.8 можно нормально использовать бинарные файлы для
Solaris 2.6. Большинство вопросов по работе с Solaris 2.6 относятся также
и к Solaris 2.7 и 2.8.

</P>
<P>
Необходимо отметить, что MySQL версии 3.23.4 и последующих может
автоматически определять новые версии Solaris и избегать описанных ниже
проблем!

</P>
<P>
В Solaris 2.7/2.8 имеются некоторые ошибки во включаемых файлах. При
использовании gcc вы можете получить следующие сообщения об ошибках:

</P>

<PRE>
/usr/include/widec.h:42: warning: `getwc' redefined
/usr/include/wchar.h:326: warning: this is the location of the previous definition
</PRE>

<P>
В этом случае для исправления ошибки нужно выполнить следующие действия:

</P>
<P>
Скопируйте <code>/usr/include/widec.h</code> в <code>.../lib/gcc-lib/os/gcc-version/include</code> и
измените строку с номером 41, содержащую:

</P>

<PRE>
#if !defined(lint) &#38;&#38; !defined(__lint)

на

#if !defined(lint) &#38;&#38; !defined(__lint) &#38;&#38; !defined(getwc)
</PRE>

<P>
Есть и альтернативный вариант - отредактировать <tt>`/usr/include/widec.h'</tt> 
непосредственно на месте. В любом случае после исправления необходимо
удалить <tt>`config.cache'</tt> и запустить <code>configure</code> повторно!

</P>
<P>
Если при запуске <code>make</code> выдаются сообщения об ошибках наподобие упомянутых
ниже, причина в том, что программа <code>configure</code> не обнаружила файл <tt>`curses.h'</tt> 
(возможно, из-за ошибок в <tt>`/usr/include/widec.h'</tt>):

</P>

<PRE>
In file included from mysql.cc:50:
/usr/include/term.h:1060: syntax error before `,'
/usr/include/term.h:1081: syntax error before `;'
</PRE>

<P>
Решить эту проблему можно одним из способов:

</P>

<UL>
<LI>

Конфигурировать с <code>CFLAGS=-DHAVE_CURSES_H CXXFLAGS=-DHAVE_CURSES_H ./configure</code> (эта запись должна быть цельной строкой, без пробелов).

<LI>

Отредактировать <tt>`/usr/include/widec.h'</tt>, как описано выше, и перезапустить
<code>configure</code>.

<LI>

Удалить строку <code>#define HAVE_TERM</code> из <tt>`config.h'</tt> и запустить <code>make</code> повторно.
</UL>

<P>
Если редактор связей не может обнаружить <code>-lz</code> при линковании вашей
клиентской программы, то проблема, возможно, заключается в том, что файл
<tt>`libz.so'</tt> установлен в <tt>`/usr/local/lib'</tt>. Данную проблему можно решить любым из
приведенных выше способов:

</P>

<UL>
<LI>

Добавить <tt>`/usr/local/lib'</tt> к <code>LD_LIBRARY_PATH</code>.

<LI>

Создать ссылку на <tt>`libz.so'</tt> из <tt>`/lib'</tt>.

<LI>

Если используется Solaris 8, можно установить необязательную библиотеку
zlib с CD-диска с дистрибутивом Solaris 8.

<LI>

Конфигурировать MySQL с опцией <code>--with-named-z-libs=no</code>.
</UL>



<H4><A NAME="Solaris_x86" HREF="manual.ru_toc.html#Solaris_x86">2.6.3.2  Примечания к Solaris x86</A></H4>

<P>
На Solaris 2.8 на x86-й архитектуре <code>mysqld</code> аварийно завершится с
сохранением образа памяти на диске, если он обработан программой <code>strip</code>.

</P>
<P>
Если при использовании <code>gcc</code> или <code>egcs</code> на Solaris x86 при большой нагрузке вы
столкнетесь с проблемой аварийного завершения программы с сохранением
образа памяти на диске, используйте при сборке команду <code>configure</code> со
следующими параметрами:

</P>

<PRE>
CC=gcc CFLAGS="-O3 -fomit-frame-pointer -DHAVE_CURSES_H" \
CXX=gcc \
CXXFLAGS="-O3 -fomit-frame-pointer -felide-constructors -fno-exceptions \
-fno-rtti -DHAVE_CURSES_H" \
./configure --prefix=/usr/local/mysql
</PRE>

<P>
Это позволит избежать проблем с библиотекой <code>libstdc++</code> и исключительными
ситуациями в C++.

</P>
<P>
Если приведенные рекомендации не помогают, соберите версию с отладочной
информацией и запустите программу с созданием трассировочного файла или в
отладчике <code>gdb</code> (see section <A HREF="manual.ru.html#Using_gdb_on_mysqld">D.1.3  Отладка mysqld при помощи gdb</A>).

</P>


<H3><A NAME="BSD_Notes" HREF="manual.ru_toc.html#BSD_Notes">2.6.4  Примечания к BSD</A></H3>

<P>
В этом разделе находится информация относительно различных BSD-систем, а
также конкретных версий этих систем.

</P>



<H4><A NAME="FreeBSD" HREF="manual.ru_toc.html#FreeBSD">2.6.4.1  Примечания к FreeBSD</A></H4>

<P>
Для работы Mysql рекомендуется FreeBSD версий 3.x, поскольку версия с
потоками является намного более интегрированной.

</P>
<P>
Простейшим, а поэтому и более предпочтительным способом установки является
использование портов <code>mysql-server</code> и <code>mysql-client</code> из коллекции портов
FreeBSD, которая доступна по адресу <a HREF="http://www.freebsd.org/">http://www.freebsd.org/</a>.

</P>
<P>
Использование этих портов обеспечивает:

<UL>
<LI>

работоспособный MySQL со всеми возможностями оптимизации, доступными на
данной версии FreeBSD;
<LI>

автоматическую конфигурацию и сборку;
<LI>

установку скриптов, запускающих MySQL, в <tt>`/usr/local/etc/rc.d'</tt>;
<LI>

возможность получения списка установленных файлов по команде <code>pkg_info -L</code> 
и удаления их при помощи команды <code>pkg_delete</code> в случае, если вы более не
нуждаетесь в MySQL на данной машине.
</UL>

<P>
Рекомендуется использовать MIT-pthreads на FreeBSD версий 2.x и
собственные потоки для 3.x и более поздних версий FreeBSD. На некоторых
последних версиях 2.2.x возможно применение собственных потоков, но при
этом не исключены проблемы с остановкой <code>mysqld</code>.

</P>
<P>
Для сборки MySQL в соответствии с <code>Makefile</code>'ом необходима программа GNU
make (<code>gmake</code>). Прежде чем выполнять сборку MySQL, следует установить GNU
make.

</P>
<P>
Удостоверьтесь, что используемый вами сервер имен работает корректно. В
противном случае возможны задержки или ошибки при соединении с <code>mysqld</code>.

</P>
<P>
Убедитесь в корректности записи <code>localhost</code> в файле <tt>`/etc/hosts'</tt> (при
отсутствии или ошибочности этой записи возникнут проблемы соединения с
базой). Файл <tt>`/etc/hosts'</tt> должен начинаться с записи:

</P>

<PRE>
127.0.0.1 localhost localhost.your.domain
</PRE>

<P>
Предлагаемый способ сборки и установки MySQL на FreeBSD с использованием
<code>gcc</code> (версии 2.95.2 или более поздней):

</P>

<PRE>
CC=gcc CFLAGS="-O2 -fno-strength-reduce" \
CXX=gcc CXXFLAGS="-O2 -fno-rtti -fno-exceptions -felide-constructors \
-fno-strength-reduce" \
./configure --prefix=/usr/local/mysql --enable-assembler
gmake
gmake install
./scripts/mysql_install_db
cd /usr/local/mysql
./bin/mysqld_safe &#38;
</PRE>

<P>
Если программа <code>configure</code> решила  использовать MIT-pthreads, необходимо 
ознакомится с примечаниями по MIT-pthreads (see section <A HREF="manual.ru.html#MIT-pthreads">2.3.6  Замечания по потокам MIT-pthreads</A>).

</P>
<P>
Если при выполнении <code>make install</code> возникла ошибка, сообщающая о
невозможности нахождения <tt>`/usr/include/pthreads'</tt> (can't find
`/usr/include/pthreads'), это значит, что <code>configure</code> не определил
необходимость использования MIT-pthreads. Для исправления данной ошибки
необходимо выполнить следующие команды:

</P>

<PRE>
shell&#62; rm config.cache
shell&#62; ./configure --with-mit-threads
</PRE>

<P>
Как известно, в FreeBSD по умолчанию установлено очень небольшое значение
для количества одновременно открытых файлов (see section <A HREF="manual.ru.html#Not_enough_file_handles">A.2.16  Не найден файл (<code>File not found</code>)</A>).
Чтобы исправить положение, следует раскомментировать секцию <code>ulimit -n</code> в
скрипте <code>safe_mysqld</code> или повысить ограничение для пользователя <code>mysqld</code> в
<tt>`/etc/login.conf'</tt> (не забудьте перестроить его командой <code>cap_mkdb</code>
<tt>`/etc/login.conf'</tt>). Помимо этого, имеет смысл проверить установку
подходящего класса для этого пользователя в файле паролей, если не
используется значение по умолчанию (при помощи <code>chpass mysqld-user-name</code>).
See section <A HREF="manual.ru.html#safe_mysqld">4.7.2  <code>safe_mysqld</code>, оболочка <code>mysqld</code></A>.

</P>
<P>
При наличии значительного объема оперативной памяти можно рассмотреть
вариант перестройки ядра, чтобы разрешить MySQL использовать более чем
512Mб оперативной памяти. Чтобы получить больше информации, обратитесь к
<code>option MAXDSIZ</code> в конфигурационном файле LINT.

</P>
<P>
В случае возникновения проблем с текущей датой в MySQL ситуацию может
исправить правильная установка переменной <code>TZ</code>. See section <A HREF="manual.ru.html#Environment_variables">E  Переменные окружения</A>.

</P>
<P>
Для получения безопасной и устойчивой системы следует использовать
только те ядра системы FreeBSD, которые обозначены как <code>-RELEASE</code>.

</P>


<H4><A NAME="NetBSD" HREF="manual.ru_toc.html#NetBSD">2.6.4.2  Примечания к NetBSD</A></H4>

<P>
Для компиляции на NetBSD необходимо, чтобы была установлена программа GNU
<code>make</code>. В противном случае компиляция завершится аварийно при попытке <code>make</code>
запустить <code>lint</code> на файлах C++.

</P>


<H4><A NAME="OpenBSD" HREF="manual.ru_toc.html#OpenBSD">2.6.4.3  Примечания к OpenBSD 2.5</A></H4>

<P>
На OpenBSD версии 2.5 можно компилировать MySQL с использованием
собственных потоков. Необходимо указать следующие опции:

</P>

<PRE>
CFLAGS=-pthread CXXFLAGS=-pthread ./configure -with-mit-threads=no
</PRE>



<H4><A NAME="OpenBSD_2.8" HREF="manual.ru_toc.html#OpenBSD_2.8">2.6.4.4  Примечания к OpenBSD 2.8</A></H4>

<P>
По сообщениям наших пользователей, OpenBSD 2.8 содержит ошибку в
реализации потоков, которая вызывает проблемы с MySQL. Разработчики
OpenBSD устранили эту ошибку, но к 25 января 2001 года исправленная версия
доступна только в ветви ``-current''. Симптомы этой ошибки реализации потоков
следующие: медленный ответ, высокая загрузка, большая загрузка процессора
и аварийная остановка программы.

</P>
<P>
Получение сообщения об ошибке вроде <code>Error in accept:: Bad file
descriptor</code> или ошибки 9 при попытке открыть таблицу либо каталог
означает, что вы не заказали достаточно дескрипторов файлов для MySQL.

</P>
<P>
В этом случае попробуйте запустить <code>safe_mysqld</code> от имени пользователя <code>root</code>
с опциями:

</P>

<PRE>
--user=mysql --open-files-limit=2048
</PRE>



<H4><A NAME="BSDI" HREF="manual.ru_toc.html#BSDI">2.6.4.5  Примечания к BSD/OS версий 2.x</A></H4>

<P>
Получение приведенной ниже ошибки при компиляции MySQL означает, что
установленное с помощью <code>ulimit</code> значение размера виртуальной памяти слишком
мало:

</P>

<PRE>
item_func.h: In method `Item_func_ge::Item_func_ge(const Item_func_ge &#38;)':
item_func.h:28: virtual memory exhausted
make[2]: *** [item_func.o] Error 1
</PRE>

<P>
Попробуйте выполнить <code>ulimit -v 80000</code> и запустить <code>make</code> еще раз. Если это не
поможет, а в качестве оболочки используется <code>bash</code>, попробуйте перейти на
<code>csh</code> или <code>sh</code>: некоторые пользователи BSDI сообщали нам о проблемах с <code>bash</code> и
<code>ulimit</code>.

</P>
<P>
Если вы используете <code>gcc</code>, то, возможно, необходимо добавить флаг
<code>--with-low-memory</code> при запуске <code>configure</code>, чтобы обеспечить возможность
компиляции <tt>`sql_yacc.cc'</tt>.

</P>
<P>
При возникновении проблем с текущей датой в MySQL может помочь установка
переменной <code>TZ</code> (see section <A HREF="manual.ru.html#Environment_variables">E  Переменные окружения</A>).

</P>


<H4><A NAME="BSDI3" HREF="manual.ru_toc.html#BSDI3">2.6.4.6  Примечания к BSD/OS версий 3.x</A></H4>

<P>
Для конфигурирования MySQL следует использовать следующую команду:

</P>

<PRE>
shell&#62; env CXX=shlicc++ CC=shlicc2 \
       ./configure \
           --prefix=/usr/local/mysql \
	   --localstatedir=/var/mysql \
	   --without-perl \
	   --with-unix-socket-path=/var/mysql/mysql.sock
</PRE>

<P>
Сработает и следующая командная строка:

</P>

<PRE>
shell&#62; env CC=gcc CXX=gcc CXXFLAGS=-O3 \
       ./configure \
           --prefix=/usr/local/mysql \
	   --with-unix-socket-path=/var/mysql/mysql.sock
</PRE>

<P>
При желании вы можете изменить местоположение каталогов или использовать
значения по умолчанию, не определяя никаких путей.

</P>
<P>
Если возникнут проблемы с производительностью при большой нагрузке,
попробуйте при запуске <code>mysqld</code> использовать опцию <code>--skip-thread-priority</code>!
Применение данной опции приведет к тому, что все потоки будут работать с
одинаковым приоритетом; на BSDI версии 3.1 это обеспечивало повышение
производительности (по крайней мере, пока не был исправлен планировщик
потоков).

</P>
<P>
В случае получения сообщения об ошибке <code>virtual memory exhausted</code> во время
компиляции попробуйте выполнить <code>ulimit -v 80000</code> и запустить <code>make</code> повторно.
Если это не поможет, а в качестве оболочки у вас используется <code>bash</code>,
попробуйте перейти на <code>csh</code> или <code>sh</code>: некоторые пользователи BSDI сообщали о
проблемах с <code>bash</code> и <code>ulimit</code>.

</P>


<H4><A NAME="BSDI4" HREF="manual.ru_toc.html#BSDI4">2.6.4.7  Примечания к BSD/OS версий 4.x</A></H4>

<P>
BSDI версий 4.x содержит ошибку, имеющую отношение к потокам. Если вы
планируете использовать MySQL на этой системе, необходимо предварительно
установить все патчи, относящиеся к реализации потоков. По крайней мере,
должен быть установлен M400-023.

</P>
<P>
На некоторых системах BSDI версий 4.x вы можете столкнуться с проблемами
при использовании динамических библиотек. Проявляется это как
невозможность выполнить какую-либо клиентскую программу, например
<code>mysqladmin</code>. В данном случае необходимо переконфигурировать MySQL с
запретом использовать динамические библиотеки, указав для скрипта
configure опцию <code>--disable-shared</code>.

</P>
<P>
Некоторые пользователи сообщали нам о проблемах на BSDI 4.0.1, которые
проявляются в том, что через некоторое время после начала работы <code>mysqld</code> не
может открыть таблицы. Это происходит потому, что из-за какой-то системной
или библиотечной ошибки <code>mysqld</code> изменяет текущий каталог без какого-либо
запроса!

</P>
<P>
Для решения проблемы необходимо либо обновить MySQL до версии 3.23.34,
либо после запуска <code>configure</code> удалить строку <code>#define HAVE_REALPATH</code> из файла
<tt>`config.h'</tt> перед запуском <code>make</code>.

</P>
<P>
Отметим, что вышеописанные действия приведут к невозможности создать
символическую ссылку из одних каталогов базы данных на другой каталог базы
данных или символическую ссылку на таблицу в другой базе данных на BSDI!
(Создание символической ссылки на другой диск допускается.)

</P>


<H3><A NAME="Mac_OS_X" HREF="manual.ru_toc.html#Mac_OS_X">2.6.5  Примечания к Mac OS X</A></H3>



<H4><A NAME="Mac_OS_X_10.x" HREF="manual.ru_toc.html#Mac_OS_X_10.x">2.6.5.1  Mac OS X 10.x</A></H4>

<P>
На  Mac OS X 10.x MySQL должен работать без каких-либо проблем. Для этой
операционной системы нет необходимости в патчах к pthread!

</P>
<P>
Это также касается Mac OS X 10.x Server. Компиляция для серверной платформы
ничем не отличается от компиляции для клиентской версии. Однако учтите, что 
Mac OS X Server поставляется с предустановленным MySQL. 

</P>
<P>
See section <A HREF="manual.ru.html#Mac_OS_X_installation">2.1.3  Установка MySQL на MacOS X</A>.

</P>



<H4><A NAME="Mac_OS_X_Server" HREF="manual.ru_toc.html#Mac_OS_X_Server">2.6.5.2  Mac OS X Server 1.2 (Rhapsody)</A></H4>

<P>
Прежде чем попытаться отконфигурировать MySQL на сервере Mac OS X,
необходимо установить пакет <code>pthread</code>, который находится по адресу
<a HREF="http://www.prnet.de/RegEx/mysql.html">http://www.prnet.de/RegEx/mysql.html</a>.

</P>
<P>
Наши бинарные файлы для Mac OS X компилируются на Rhapsody 6.3 со
следующими конфигурационными параметрами:

</P>

<PRE>
CC=gcc CFLAGS="-O3 -fno-omit-frame-pointer" CXX=gcc \
CXXFLAGS="-O3 -fno-omit-frame-pointer -felide-constructors \
-fno-exceptions -fno-rtti" ./configure --prefix=/usr/local/mysql \
--with-extra-charsets=complex --enable-thread-safe-client \
--enable-local-infile --disable-shared
</PRE>

<P>
Возможно, вам понадобится добавить псевдонимы в файл ресурсов оболочки -
для доступа к <code>mysql</code> и <code>mysqladmin</code> из командной строки:

</P>

<PRE>
alias mysql '/usr/local/mysql/bin/mysql'
alias mysqladmin '/usr/local/mysql/bin/mysqladmin'
</PRE>

<P>
Или же вы можете просто добавить путь <code>/usr/local/mysql/bin</code> к переменной окружения 
<code>PATH</code>, скажем, путем добавления в файл 
<tt>`$HOME/.tcshrc'</tt>:

</P>

<PRE>
setenv PATH $PATH:/usr/local/bin
</PRE>



<H3><A NAME="Other_Unix_Notes" HREF="manual.ru_toc.html#Other_Unix_Notes">2.6.6  Примечания к другим Unix-системам</A></H3>



<H4><A NAME="Binary_notes-HP-UX" HREF="manual.ru_toc.html#Binary_notes-HP-UX">2.6.6.1  Примечания к бинарному дистрибутиву HP-UX</A></H4>

<P>
<A NAME="IDX349"></A>
<A NAME="IDX350"></A>

</P>
<P>
Некоторые бинарные поставки MySQL для HP-UX распространяются как файлы HP
depot и tar. Для использования файла depot у вас должна быть установлена
версия HP-UX не выше 10.x - для того, чтобы обеспечить возможность работы
с HP-инструментарием работы с depot-файлами.

</P>
<P>
Версия MySQL для HP была скомпилирована на сервере HP 9000/8xx в системе
HP-UX 10.20 с использованием MIT-pthreads. Известно, что она хорошо
работает в этой конфигурации. MySQL версии 3.22.26 и выше можно также
собрать с использованием собственных потоков HP.

</P>
<P>
Другие конфигурации, на которых возможна работа MySQL:

</P>

<UL>
<LI>

HP 9000/7xx running HP-UX 10.20+
<LI>

HP 9000/8xx running HP-UX 10.30
</UL>

<P>
На следующих конфигурациях MySQL, скорее всего, работать не будет:

</P>

<UL>
<LI>

HP 9000/7xx or 8xx running HP-UX 10.x where x &#60; 2
<LI>

HP 9000/7xx or 8xx running HP-UX 9.x
</UL>

<P>
Для установки дистрибутива используйте одну из представленных ниже команд;
здесь <code>/path/to/depot</code> - полный путь к depot-файлу:

</P>

<UL>
<LI>

Для полной установки, включая сервер, клиент и инструментарий
разработчика:


<PRE>
shell&#62; /usr/sbin/swinstall -s /path/to/depot mysql.full
</PRE>

<LI>

Для установки только сервера:


<PRE>
shell&#62; /usr/sbin/swinstall -s /path/to/depot mysql.server
</PRE>

<LI>

Для установки только клиентского пакета:


<PRE>
shell&#62; /usr/sbin/swinstall -s /path/to/depot mysql.client
</PRE>

<LI>

Для установки только инструментария разработчика:


<PRE>
shell&#62; /usr/sbin/swinstall -s /path/to/depot mysql.developer
</PRE>

</UL>

<P>
depot помещает бинарные исполняемые файлы и библиотеки в <tt>`/opt/mysql'</tt>, а
данные - в <tt>`/var/opt/mysql'</tt>. depot также создает соответствующие строки в
<tt>`/etc/init.d'</tt> и <tt>`/etc/rc2.d'</tt> для автоматического запуска сервера при загрузке
машины. Очевидно, что для установки необходимо обладать правами
пользователя <code>root</code>.

</P>
<P>
Для установки на HP-UX дистрибутива tar.gz на машине должен быть
установлен GNU <code>tar</code>.

</P>


<H4><A NAME="HP-UX_10.20" HREF="manual.ru_toc.html#HP-UX_10.20">2.6.6.2  Примечания к HP-UX версии 10.20</A></H4>

<P>
При компиляции MySQL на HP-UX существует пара небольших проблем. Мы
рекомендуем применять вместо собственного компилятора HP-UX <code>gcc</code>, потому
что код, созданный <code>gcc</code>, лучше!

</P>
<P>
Для HP-UX рекомендуется использование gcc 2.95. Не следует применять
высокие уровни оптимизации (наподобие -O6), поскольку на HP-UX это может
быть небезопасно.

</P>
<P>
Должна работать следующая строка конфигурации для gcc 2.95:

</P>

<PRE>
CFLAGS="-DHPUX -I/opt/dce/include -fpic" \
CXXFLAGS="-DHPUX -I/opt/dce/include -felide-constructors -fno-exceptions \
-fno-rtti" CXX=gcc ./configure --with-pthread \
--with-named-thread-libs='-ldce' --prefix=/usr/local/mysql
--disable-shared
</PRE>

<P>
Следующая строка конфигурации должна работать для gcc 3.1:

</P>

<PRE>
CFLAGS="-DHPUX -I/opt/dce/include -O3 -fPIC" CXX=gcc \
CXXFLAGS="-DHPUX -I/opt/dce/include -felide-constructors -fno-exceptions \
-fno-rtti -O3 -fPIC" ./configure --prefix=/usr/local/mysql \
--with-extra-charsets=complex --enable-thread-safe-client \
--enable-local-infile  --with-pthread \
--with-named-thread-libs=-ldce --with-lib-ccflags=-fPIC
--disable-shared
</PRE>



<H4><A NAME="HP-UX_11.x" HREF="manual.ru_toc.html#HP-UX_11.x">2.6.6.3  Примечания к HP-UX версий 11.x</A></H4>

<P>
Для HP-UX версий 11.x мы рекомендуем использовать MySQL не ниже 3.23.15.

</P>
<P>
Из-за некоторых критических ошибок в стандартных библиотеках HP-UX до
попытки запуска MySQL на HP-UX 11.0 необходимо установить следующие патчи:

</P>

<PRE>
PHKL_22840 Streams cumulative
PHNE_22397 ARPA cumulative
</PRE>

<P>
Применение данных патчей решит проблему получения <code>EWOULDBLOCK</code> от <code>recv()</code> и
<code>EBADF</code> от <code>accept()</code> в потоковых приложениях.

</P>
<P>
При использовании <code>gcc</code> 2.95.1 в системе, к которой не были применены патчи,
возникнет ошибка:

</P>

<PRE>
In file included from /usr/include/unistd.h:11,
		 from ../include/global.h:125,
		 from mysql_priv.h:15,
		 from item.cc:19:
/usr/include/sys/unistd.h:184: declaration of C function ...
/usr/include/sys/pthread.h:440: previous declaration ...
In file included from item.h:306,
		 from mysql_priv.h:158,
		 from item.cc:19:
</PRE>

<P>
Проблема заключается в том, что HP-UX существуют несовместимые определения
функции <code>pthreads_atfork()</code>. Конфликтующие прототипы находятся в
<tt>`/usr/include/sys/unistd.h'</tt>:184 и в <tt>`/usr/include/sys/pthread.h'</tt>:440
(подробности приведены ниже).

</P>
<P>
Одно из возможных решений заключается в том, чтобы скопировать
<tt>`/usr/include/sys/unistd.h'</tt> в <tt>`mysql/include'</tt> и отредактировать <tt>`unistd.h'</tt> так,
чтобы определение совпадало с определением из <tt>`pthread.h'</tt>. Ниже приведен
результат работы <code>diff</code>:

</P>

<PRE>
183,184c183,184
&#60;      extern int pthread_atfork(void (*prepare)(), void (*parent)(),
&#60;                                                void (*child)());
---
&#62;      extern int pthread_atfork(void (*prepare)(void), void (*parent)(void),
&#62;                                                void (*child)(void));
</PRE>

<P>
После этого должна работать конфигурационная программа со следующими
параметрами:

</P>

<PRE>
CFLAGS="-fomit-frame-pointer -O3 -fpic" CXX=gcc \
CXXFLAGS="-felide-constructors -fno-exceptions -fno-rtti -O3" \
./configure --prefix=/usr/local/mysql --disable-shared
</PRE>

<P>
Если вы используете MySQL 4.0.5 с компилятором HP-UX, то вам подойдет (проверено 
на cc B.11.11.04):

</P>


<PRE>
CC=cc CXX=aCC CFLAGS=+DD64 CXXFLAGS=+DD64 ./configure --with-extra-character-set=complex
</PRE>

<P>
Вы можете игнорировать ошибки, подобные этой: 

</P>

<PRE>
aCC: warning 901: unknown option: `-3': use +help for online documentation
</PRE>

<P>
При получении следующего сообщения об ошибке при работе <code>configure</code>

<PRE>
checking for cc option to accept ANSI C... no
configure: error: MySQL requires a ANSI C compiler (and a C++ compiler).
Try gcc. See the Installation chapter in the Reference Manual.
</PRE>

<P>
следует удостовериться, что путь к компилятору K&#38;R не указан раньше, чем
путь к компиляторам HP-UX C и C++.

</P>
<P>
Еще одна причина, по которой вы не сможете скомпилировать MySQL, заключается
в том, что вы забыли указать флаг <code>+DD64</code>, описанный выше. 

</P>


<H4><A NAME="IBM-AIX" HREF="manual.ru_toc.html#IBM-AIX">2.6.6.4  Примечания к IBM-AIX</A></H4>

<P>
<A NAME="IDX351"></A>

</P>
<P>
В Autoconf пропущено автоматическое определение <code>xlC</code>, поэтому при
компиляции MySQL следует задавать команду <code>configure</code> наподобие следующей (в
этом примере используется компилятор IBM):

</P>

<PRE>
export CC="xlc_r -ma -O3 -qstrict -qoptimize=3 -qmaxmem=8192 "
export CXX="xlC_r -ma -O3 -qstrict -qoptimize=3 -qmaxmem=8192"
export CFLAGS="-I /usr/local/include"
export LDFLAGS="-L /usr/local/lib"
export CPPFLAGS=$CFLAGS
export CXXFLAGS=$CFLAGS

./configure --prefix=/usr/local \
		--localstatedir=/var/mysql \
		--sysconfdir=/etc/mysql \
		--sbindir='/usr/local/bin' \
		--libexecdir='/usr/local/bin' \
		--enable-thread-safe-client \
		--enable-large-files
</PRE>

<P>
Здесь указаны опции, используемые для компиляции дистрибутива MySQL,
который находится по адресу <a HREF="http://www-frec.bull.com/">http://www-frec.bull.com/</a>.

</P>
<P>
Если в приведенных выше строках конфигурации вы изменяете <code>-O3</code> на <code>-O2</code>,
следует также удалить опцию <code>-qstrict</code> (это ограничение компилятора IBM C).

</P>
<P>
При использовании <code>gcc</code> или <code>egcs</code> для компиляции MySQL следует применять флаг
<code>-fno-exceptions</code>, потому что обработчик исключительных ситуаций в <code>gcc</code>/<code>egcs</code>
не безопасен в реализации потоков! (Это проверено на <code>egcs</code> 1.1.) Существуют
также некоторые известные проблемы с ассемблером IBM, которые могут
привести к генерации неудачного кода при использовании его с <code>gcc</code>.

</P>
<P>
Для использования <code>egcs</code> или <code>gcc</code> 2.95 на AIX мы рекомендуем следующую строку
конфигурирования:

</P>

<PRE>
CC="gcc -pipe -mcpu=power -Wa,-many" \
CXX="gcc -pipe -mcpu=power -Wa,-many" \
CXXFLAGS="-felide-constructors -fno-exceptions -fno-rtti" \
./configure --prefix=/usr/local/mysql --with-low-memory
</PRE>

<P>
Для того чтобы компиляция была успешной, здесь необходимо указывать ключи
<code>-Wa</code>,<code>-many</code>. В IBM известно о существовании данной проблемы, но ее
специалисты не торопятся исправлять ошибку, поскольку существует способ
обхода. Нам неизвестно, необходимо ли использование <code>-fno-exceptions</code> с <code>gcc</code>
2.95, но поскольку в MySQL нет обработчика исключительных ситуаций, а эта
опция способствует созданию более быстрого кода, мы рекомендуем всегда
использовать ее с <code>egcs</code>/<code>gcc</code>.

</P>
<P>
В случае возникновения проблем в программах на ассемблере необходимо
привести -mcpu=xxx в соответствие со своим процессором. Обычно достаточно
использовать power2, power или powerpc, но, возможно, необходимо будет
указать 604 или 604e. Хотя это и не приветствуется, но использование
"power" будет безопасным почти всегда, даже на power2-машинах.

</P>
<P>
Если вы не знаете, какой у вас процессор, следует запустить uname -m.
Данная команда возвращает строку наподобие "000514676700", формат которой
xxyyyyyymmss, где xx и ss всегда 0, yyyyyy - уникальный идентификатор
системы и mm - идентификатор процессора Planar. Карта этих значений
находится по адресу
<a HREF="http://publib.boulder.ibm.com/doc_link/en_US/a_doc_lib/cmds/aixcmds5/uname.htm">http://publib.boulder.ibm.com/doc_link/en_US/a_doc_lib/cmds/aixcmds5/uname.htm</a>.

</P>
<P>
В соответствии с данной картой можно узнать тип и модель машины, а уже по
ним -определить тип процессора.

</P>
<P>
Возникновение проблем с сигналами (MySQL неожиданно умирает при большой
нагрузке) может означать, что вы столкнулись с ошибкой операционной
системы в работе с потоками и сигналами. В этом случае можно запретить
MySQL использовать сигналы при помощи следующей строки конфигурации:

</P>

<PRE>
shell&#62; CFLAGS=-DDONT_USE_THR_ALARM CXX=gcc \
       CXXFLAGS="-felide-constructors -fno-exceptions -fno-rtti \
       -DDONT_USE_THR_ALARM" \
       ./configure --prefix=/usr/local/mysql --with-debug --with-low-memory
</PRE>

<P>
Это не повлияет на производительность MySQL, но приведет к побочному
эффекту, состоящему в невозможности оборвать работу клиента со спящим
соединением при помощи команд <code>mysqladmin kill</code> или <code>mysqladmin shutdown</code>.
Вместо этого клиент завершит работу при попытке послать следующую команду.

</P>
<P>
На некоторых версиях AIX линкование с <code>libbind.a</code> приводит к тому, что
getservbyname вызывает аварийную остановку программы с сохранением образа
памяти на диск (core dump). Это ошибка AIX и о ней следует сообщить в IBM.

</P>
<P>
Для AIX 4.2.1 и gcc необходимо сделать следующие изменения:

</P>
<P>
После конфигурации следует отредактировать файлы <tt>`config.h'</tt> и
<tt>`include/my_config.h'</tt>, а также изменить строку, содержащую

</P>

<PRE>
#define HAVE_SNPRINTF 1
</PRE>

<P>
на

</P>

<PRE>
#undef HAVE_SNPRINTF
</PRE>

<P>
И напоследок необходимо в файле <tt>`mysqld.cc'</tt> добавить прототип функции
<code>initgoups</code>.

</P>

<PRE>
#ifdef _AIX41
extern "C" int initgroups(const char *,int);
#endif
</PRE>

<P>
Если вам нужно выделить много памяти процессу mysqld, недостаточно 
указать <code>ulimit -d unlimited</code>. Вам также потребуется в <code>mysqld_safe</code> 
установить что-то вроде: 

</P>

<PRE>
export LDR_CNTRL='MAXDATA=0x80000000'
</PRE>

<P>
Больше информации об использовании большого количества памяти - здесь:
<a HREF="http://publib16.boulder.ibm.com/pseries/en_US/aixprggd/genprogc/lrg_prg_support.htm">http://publib16.boulder.ibm.com/pseries/en_US/aixprggd/genprogc/lrg_prg_support.htm</a>.

</P>



<H4><A NAME="SunOS" HREF="manual.ru_toc.html#SunOS">2.6.6.5  Примечания к SunOS 4</A></H4>

<P>
На SunOS 4 для компиляции MySQL необходимо использовать MIT-pthreads, что,
в свою очередь, влечет за собой необходимость в GNU <code>make</code>.

</P>
<P>
На некоторых SunOS 4 возникают проблемы с динамическими библиотеками и
<code>libtool</code>. Во избежание этих проблем можно использовать приведенную ниже
строку <code>configure</code>:

</P>

<PRE>
shell&#62; ./configure --disable-shared --with-mysqld-ldflags=-all-static
</PRE>

<P>
При компиляции <code>readline</code> могут выдаваться предупреждения о дублирующихся
определениях. На них можно не обращать внимания.

</P>
<P>
При компиляции <code>mysqld</code> возникают предупреждения об <code>implicit declaration of
function</code>. На них также можно не обращать внимания.

</P>


<H4><A NAME="Alpha-DEC-UNIX" HREF="manual.ru_toc.html#Alpha-DEC-UNIX">2.6.6.6  Примечания к Alpha-DEC-UNIX (Tru64)</A></H4>

<P>
При использовании egcs на Digital Unix необходимо обновить свою версию до
gcc 2.95.2, поскольку известно о нескольких серьезных ошибках в egcs для
DEC!

</P>
<P>
В документации рекомендуется для компиляции потоковых программ под Digital
Unix использовать опцию <code>-pthread</code> для <code>cc</code> и <code>cxx</code>, а также библиотеки <code>-lmach</code> 
<code>-lexc</code> (в дополнение к <code>-lpthread</code>). Запускать <code>configure</code> нужно в следующей
форме:

</P>

<PRE>
CC="cc -pthread" CXX="cxx -pthread -O" \
./configure --with-named-thread-libs="-lpthread -lmach -lexc -lc"
</PRE>

<P>
При компиляции <code>mysqld</code> может быть выдано несколько предупреждений наподобие
следующих:

</P>

<PRE>
mysqld.cc: In function void handle_connections()':
mysqld.cc:626: passing long unsigned int *' as argument 3 of
accept(int,sockadddr *, int *)'
</PRE>

<P>
На них можно не обращать внимания. Они возникают из-за того, что <code>configure</code>
может обнаруживать только ошибки, но не предупреждения.

</P>
<P>
При запуске сервера непосредственно из командной строки могут возникнуть
проблемы с тем, что он прекращает работу при выходе из системы (при выходе
из системы все процессы, запущенные вами во время работы, получают сигнал
<code>SIGHUP</code>). Если такое происходит, следует запускать сервер командой:

</P>

<PRE>
shell&#62; nohup mysqld [options] &#38;
</PRE>

<P>
При указании <code>nohup</code> следующая за ней команда будет игнорировать все сигналы
<code>SIGHUP</code>, посланные терминалом. В качестве альтернативного варианта можно
запускать сервер командой <code>safe_mysqld</code>, которая при запуске <code>mysqld</code> выполнит
вызов <code>nohup</code> вместо вас (see section <A HREF="manual.ru.html#safe_mysqld">4.7.2  <code>safe_mysqld</code>, оболочка <code>mysqld</code></A>).

</P>
<P>
Если вы столкнулись с проблемами компиляции <tt>`mysys/get_opt.c'</tt>, следует
просто удалить строку <code>#define _NO_PROTO</code> в начале этого файла!

</P>
<P>
Для компилятора CC от Compaq используйте следующий код:

</P>

<PRE>
CC="cc -pthread"
CFLAGS="-O4 -ansi_alias -ansi_args -fast -inline speed all -arch host"
CXX="cxx -pthread"
CXXFLAGS="-O4 -ansi_alias -ansi_args -fast -inline speed all -arch host \
-noexceptions -nortti"
export CC CFLAGS CXX CXXFLAGS
./configure \
--prefix=/usr/local/mysql \
--with-low-memory \
--enable-large-files \
--enable-shared=yes \
--with-named-thread-libs="-lpthread -lmach -lexc -lc"
gnumake
</PRE>

<P>
В случае возникновения проблем с libtool при компиляции с динамическими
библиотеками (как показано выше), при линковании <code>mysql</code> вы можете избежать
этих проблем с помощью:

</P>

<PRE>
cd mysql
/bin/sh ../libtool --mode=link cxx -pthread -O3 -DDBUG_OFF \
-O4 -ansi_alias -ansi_args -fast -inline speed \
-speculate all \ -arch host -DUNDEF_HAVE_GETHOSTBYNAME_R \
-o mysql mysql.o readline.o sql_string.o completion_hash.o \
../readline/libreadline.a -lcurses \
../libmysql/.libs/libmysqlclient.so -lm
cd ..
gnumake
gnumake install
scripts/mysql_install_db
</PRE>



<H4><A NAME="Alpha-DEC-OSF1" HREF="manual.ru_toc.html#Alpha-DEC-OSF1">2.6.6.7  Примечания к Alpha-DEC-OSF/1</A></H4>

<P>
В случае проблем компиляции при установленных DEC <code>CC</code> и <code>gcc</code> попробуйте
запустить <code>configure</code> следующим образом:

</P>

<PRE>
CC=cc CFLAGS=-O CXX=gcc CXXFLAGS=-O3 \
./configure --prefix=/usr/local/mysql
</PRE>

<P>
Если возникнут проблемы с файлом <tt>`c_asm.h'</tt>, можно создать и использовать
``фиктивный'' <tt>`c_asm.h'</tt> при помощи следующих команд:

</P>

<PRE>
touch include/c_asm.h
CC=gcc CFLAGS=-I./include \
CXX=gcc CXXFLAGS=-O3 \
./configure --prefix=/usr/local/mysql
</PRE>

<P>
Отметим, что перечисленные ниже проблемы с программой <code>ld</code> могут быть решены
путем загрузки последнего набора патчей от DEC (Compaq) с
<a HREF="http://ftp.support.compaq.com/public/unix/">http://ftp.support.compaq.com/public/unix/</a>.

</P>
<P>
При использовании OSF/1 4.0D и компилятора DEC C V5.6-071 на Digital Unix
V4.0 (Rev. 878) компилятор начинает вести себя странно (неопределенные
asm-символы). Кроме того, <code>/bin/ld</code> также, похоже, содержит ошибки (проблемы
с ошибками <code>_exit undefined</code> возникающими при линковании <code>mysqld</code>). На этих
системах нам удалось организовать компиляцию MySQL с помощью следующей
строки <code>configure</code>, заменив <code>/bin/ld</code> аналогичным файлом из версии OSF 4.0C:

</P>

<PRE>
CC=gcc CXX=gcc CXXFLAGS=-O3 ./configure --prefix=/usr/local/mysql
</PRE>

<P>
С Digital-компилятором "C++ V6.1-029" должно работать:

</P>

<PRE>
CC=cc -pthread
CFLAGS=-O4 -ansi_alias -ansi_args -fast -inline speed -speculate all \
       -arch host
CXX=cxx -pthread
CXXFLAGS=-O4 -ansi_alias -ansi_args -fast -inline speed -speculate all \
         -arch host -noexceptions -nortti
export CC CFLAGS CXX CXXFLAGS
./configure --prefix=/usr/mysql/mysql
	    --with-mysqld-ldflags=-all-static \
            --disable-shared --with-named-thread-libs="-lmach -lexc -lc"
</PRE>

<P>
В некоторых версиях OSF/1 испорчена функция <code>alloca()</code>. Ситуацию можно
поправить удалением из файла <tt>`config.h'</tt> строки, в которой определяется
<code>HAVE_ALLOCA</code>.

</P>
<P>
Может также существовать некорректный прототип для функции <code>alloca()</code> в
<tt>`/usr/include/alloca.h'</tt>. Предупреждение, вызванное этим, можно игнорировать.

</P>
<P>
<code>configure</code> будет автоматически использовать следующие потоковые библиотеки:
<code>--with-named-thread-libs="-lpthread -lmach -lexc -lc"</code>.

</P>
<P>
При использовании gcc можно попробовать запустить <code>configure</code> следующей
строкой:

</P>

<PRE>
shell&#62; CFLAGS=-D_PTHREAD_USE_D4 CXX=gcc CXXFLAGS=-O3 ./configure ...
</PRE>

<P>
Возникновение проблем с сигналами (MySQL неожиданно аварийно завершает
работу при большой нагрузке), может означать, что вы обнаружили ошибку при
работе операционной системы с потоками и сигналами. В данном случае можно
запретить MySQL использовать сигналы путем конфигурации его следующим
образом:

</P>

<PRE>
shell&#62; CFLAGS=-DDONT_USE_THR_ALARM \
       CXXFLAGS=-DDONT_USE_THR_ALARM \
       ./configure ...
</PRE>

<P>
Это не повлияет на производительность MySQL, но приведет к побочному
эффекту, который проявляется как невозможность оборвать работу клиента со
спящим соединением командами <code>mysqladmin kill</code> или <code>mysqladmin shutdown</code>.
Вместо этого клиент завершит работу при попытке послать следующую команду.

</P>
<P>
При использовании <code>gcc</code> 2.95.2 может возникать следующая ошибка компиляции:

</P>

<PRE>
sql_acl.cc:1456: Internal compiler error in `scan_region', at except.c:2566
Please submit a full bug report.
</PRE>

<P>
Чтобы выйти из положения в этом случае, следует перейти в каталог <tt>`sql'</tt> и
выполнить последнюю строку <code>gcc</code> (просто выделите ее, например, мышкой и
вставьте в терминал), изменив в ней <code>-O3</code> на <code>-O0</code> (или добавьте <code>-O0</code> 
непосредственно после <code>gcc</code>, если у вас в строке компиляции отсутствует
какая-либо опция <code>-O</code>). После выполнения указанных действий вернитесь в
каталог верхнего уровня и запустите <code>make</code> повторно.

</P>


<H4><A NAME="SGI-Irix" HREF="manual.ru_toc.html#SGI-Irix">2.6.6.8  Примечания к SGI Irix</A></H4>

<P>
При использовании Irix 6.5.3 или выше <code>mysqld</code> может создавать потоки только
в случае, если он запущен от имени пользователя с привилегиями
<code>CAP_SCHED_MGT</code> (подобными тем, что у <code>root</code>) или если такие привилегии даются
серверу <code>mysqld</code> следующей командой:

</P>

<PRE>
shell&#62; chcap "CAP_SCHED_MGT+epi" /opt/mysql/libexec/mysqld
</PRE>

<P>
Возможно, вам придется убрать некоторые определения из <tt>`config.h'</tt>. Это
делается после выполнения <code>configure</code>, но до компиляции.

</P>
<P>
В некоторых реализациях Irix неправильно реализована функция <code>alloca()</code>.
Если сервер <code>mysqld</code> аварийно завершает работу при выполнении некоторых
выражений <code>SELECT</code>, удалите из <tt>`config.h'</tt> строки, в которых определяются
<code>HAVE_ALLOC</code> и <code>HAVE_ALLOCA_H</code>. Если не работает <code>mysqladmin create</code>, удалите из
<tt>`config.h'</tt> строку, определяющую <code>HAVE_READDIR_R</code>. Можно также удалить строку,
содержащую <code>HAVE_TERM_H</code>.

</P>
<P>
SGI рекомендует установить все патчи, как указано на странице

</P>
<P>
<a HREF="http://support.sgi.com/surfzone/patches/patchset/6.2_indigo.rps.html">http://support.sgi.com/surfzone/patches/patchset/6.2_indigo.rps.html</a>.

</P>
<P>
Вам следует, как минимум, установить последние обновления (rollup) ядра,
последние обновления <code>rld</code> и последние обновления <code>libc</code>.

</P>
<P>
Для поддержки pthreads обязательно следует установить все патчи POSIX со
страницы:

</P>
<P>
<a HREF="http://support.sgi.com/surfzone/patches/patchset/6.2_posix.rps.html">http://support.sgi.com/surfzone/patches/patchset/6.2_posix.rps.html</a> 

</P>
<P>
Если при компиляции <tt>`mysql.cc'</tt> вы получили сообщение об ошибке наподобие:

</P>

<PRE>
"/usr/include/curses.h", line 82: error(1084): invalid combination of type
</PRE>

<P>
то необходимо выполнить следующие команды в каталоге верхнего уровня
дерева каталогов исходных текстов MySQL:

</P>

<PRE>
shell&#62; extra/replace bool curses_bool &#60; /usr/include/curses.h \
     &#62; include/curses.h
shell&#62; make
</PRE>

<P>
Мы получали также сообщения о проблемах управления. Если выполняется
только один поток, то работа идет очень медленно. Однако если запустить
еще одну программу-клиент, то можно получить ускорение в несколько раз (от
двукратного до десятикратного соответственно) и для других потоков.
Причины описанной проблемы с потоками в Irix пока неясны; возможно, вам
удастся найти временное решение, пока она не будет решена.

</P>
<P>
При компиляции с помощью <code>gcc</code> можно использовать следующую команду
<code>configure</code>:

</P>

<PRE>
CC=gcc CXX=gcc CXXFLAGS=-O3 \
./configure --prefix=/usr/local/mysql --enable-thread-safe-client \
--with-named-thread-libs=-lpthread
</PRE>

<P>
Сообщают, что для Irix 6.5.11 с собственными Irix C и C++ компиляторами
версии 7.3.1.2, должно работать:

</P>

<PRE>
CC=cc CXX=CC CFLAGS='-O3 -n32 -TARG:platform=IP22 -I/usr/local/include \
-L/usr/local/lib' CXXFLAGS='-O3 -n32 -TARG:platform=IP22 \
-I/usr/local/include -L/usr/local/lib' ./configure \
--prefix=/usr/local/mysql --with-innodb --with-berkeley-db \
--with-libwrap=/usr/local \
--with-named-curses-libs=/usr/local/lib/libncurses.a
</PRE>



<H4><A NAME="Caldera" HREF="manual.ru_toc.html#Caldera">2.6.6.9  Примечания к Caldera (SCO)</A></H4>

<P>
В настоящее время пакет тестировался только на системах ``sco3.2v5.0.4'' и
``sco3.2v5.0.5''. Заметный прогресс отмечается в отношении пакета на ``sco3.2v4.2''.

</P>
<P>
В настоящее время в качестве компилятора под OpenServer мы рекомендуем gcc
2.95.2. Используя его, можно скомпилировать MySQL при помощи следующей
строки:

</P>

<PRE>
CC=gcc CXX=gcc ./configure ... (опции)
</PRE>


<OL>
<LI>

На OpenServer 5.0.X необходимо использовать gcc-2.95.2p1 или более 
свежую версию от Skunkware - <a HREF="http://www.caldera.com/skunkware/">http://www.caldera.com/skunkware/</a> и 
выбрать пакет для OpenServer или получить его по ftp по адресу 
ftp2.caldera.com в каталоге pub/skunkware/osr5/devtools/gcc.

<LI>

Следует использовать портированную версию GCC 2.5.x для этого продукта
и систему Development. Они необходимы для данной версии Caldera (SCO)
Unix. Использовать просто систему GCC Dev нельзя.

<LI>

Необходимо загрузить пакет FSU Pthreads и установить его. Его можно
найти по адресу
<a HREF="http://www.cs.wustl.edu/~schmidt/ACE_wrappers/FSU-threads.tar.gz">http://www.cs.wustl.edu/~schmidt/ACE_wrappers/FSU-threads.tar.gz</a>. Можно
также получить уже скомпилированный пакет на 
<a HREF="http://www.mysql.com/Downloads/SCO/FSU-threads-3.5c.tar.gz">http://www.mysql.com/Downloads/SCO/FSU-threads-3.5c.tar.gz</a>.

<LI>

FSU Pthreads могут быть скомпилированы на Caldera (SCO) Unix 4.2 c
tcpip. На OpenServer 3.0 или Open Desktop 3.0 (OS 3.0 ODT 3.0) с
использованием Caldera (SCO) Development System вам понадобится хороший
пакет GCC 2.5.x ODT или OS 3.0. Однако при отсутствии хорошо портированной
версии возникнет масса проблем. Для портирования этой программы требуется
система SCO Unix Development. Без нее у вас не будет необходимых библиотек
и редактора связей.

<LI>

Для сборки FSU Pthreads в своей системе нужно выполнить следующие
действия:


<OL>
<LI>

Запустите <code>./configure</code> в каталоге <code>threads/src</code> и выберите опцию SCO
OpenServer. Эта команда скопирует <code>Makefile.SCO5</code> в <code>Makefile</code>.
<LI>

Запустите <code>make</code>.
<LI>

Для установки в каталог по умолчанию - <tt>`/usr/include'</tt> войдите в систему с
правами пользователя <code>root</code>, перейдите в каталог <code>thread/src</code> и запустите <code>make
install</code>.
</OL>

<LI>

Не забудьте использовать GNU <code>make</code> при сборке MySQL.

<LI>

При запуске <code>safe_mysqld</code> не с правами пользователя <code>root</code> вы получите
разрешение открывать одновременно только 110 файлов на процесс (это
значение установлено по умолчанию). <code>mysqld</code> сообщит об этом в файле
протокола.

<LI>

На SCO 3.2V5.0.5 вы должны использовать FSU Pthreads версии 3.5c или
выше, а также gcc 2.95.2 или более новую версию! Приведенная ниже команда
<code>configure</code> должна выполняться корректно:


<PRE>
shell&#62; ./configure --prefix=/usr/local/mysql --disable-shared
</PRE>

<LI>

На SCO 3.2V4.2 следует использовать FSU Pthreads версии 3.5c или выше.
Приведенная ниже команда <code>configure</code> должна выполняться корректно:


<PRE>
shell&#62; CFLAGS="-D_XOPEN_XPG4" CXX=gcc CXXFLAGS="-D_XOPEN_XPG4" \
       ./configure \
       --prefix=/usr/local/mysql \
       --with-named-thread-libs="-lgthreads -lsocket -lgen -lgthreads" \
       --with-named-curses-libs="-lcurses"
</PRE>

У вас могут возникнуть проблемы с некоторыми включаемыми файлами. В таком
случае новые, специфические для SCO включаемые файлы можно найти по адресу
<a HREF="http://www.mysql.com/Downloads/SCO/SCO-3.2v4.2-includes.tar.gz">http://www.mysql.com/Downloads/SCO/SCO-3.2v4.2-includes.tar.gz</a>. Этот архив
следует распаковать в каталог дерева исходных текстов MySQL с именем
<code>include</code>
</OL>

<P>
Замечания по разработке под Caldera (SCO):

</P>

<UL>
<LI>

MySQL должен автоматически обнаруживать FSU Pthreads и линковать <code>mysqld</code>
с использованием <code>-lgthreads -lsocket -lgthreads</code>.

<LI>

Библиотеки разработки в Caldera (SCO) реентрантны в FSU Pthreads.
Специалисты Caldera утверждают, что библиотечные функции Caldera
реентрантны, поэтому они должны быть реентрантны с FSU Pthreads. FSU
Pthreads на OpenServer пытаются использовать SCO-схему, чтобы создать
реентрантные библиотеки.

<LI>

FSU Pthreads (по крайней мере версия на <a HREF="http://www.mysql.com/">http://www.mysql.com/</a>)
поставляется как линкованная с GNU <code>malloc</code>. При возникновении проблем с
использованием памяти, убедитесь, что <tt>`gmalloc.o'</tt> включен в <tt>`libgthreads.a'</tt> и
<tt>`libgthreads.so'</tt>.

<LI>

В FSU Pthreads используют pthread следующие системные вызовы: <code>read()</code>,
<code>write()</code>, <code>getmsg()</code>, <code>connect()</code>, <code>accept()</code>, <code>select()</code>, and <code>wait()</code>.

<LI>

CSSA-2001-SCO.35.2 (в списках заказов патч упоминается как патч по
системе безопасности erg711905-dscr_remap) (версия 2.0.0) портит
FSU-потоки и вызывает неустойчивую работу <code>mysqld</code>. Если вы собираетесь
запускать <code>mysqld</code> на машине с установленным OpenServer 5.0.6, этот патч
применять не следует.
</UL>

<P>
Если необходимо установить DBI на Caldera (SCO), следует отредактировать
<code>Makefile</code> в DBI-xxx и каждом подкаталоге.

</P>
<P>
Для приведенного ниже кода подразумевается использование gcc 2.95.2 или
более новой версии:

</P>

<PRE>
СТАРЫЙ:                               НОВЫЙ:
CC = cc                               CC = gcc
CCCDLFLAGS = -KPIC -W1,-Bexport       CCCDLFLAGS = -fpic
CCDLFLAGS = -wl,-Bexport              CCDLFLAGS =

LD = ld                               LD = gcc -G -fpic
LDDLFLAGS = -G -L/usr/local/lib       LDDLFLAGS = -L/usr/local/lib
LDFLAGS = -belf -L/usr/local/lib      LDFLAGS = -L/usr/local/lib

LD = ld                               LD = gcc -G -fpic
OPTIMISE = -Od                        OPTIMISE = -O1

OLD:
CCCFLAGS = -belf -dy -w0 -U M_XENIX -DPERL_SCO5 -I/usr/local/include

НОВЫЙ:
CCFLAGS = -U M_XENIX -DPERL_SCO5 -I/usr/local/include
</PRE>

<P>
Это вызвано тем, что <code>dynaloader</code> из Perl не загружает DBI-модулей, если они
скомпилированы компиляторами <code>icc</code> или <code>cc</code>.

</P>
<P>
Perl будет работать лучше, если его скомпилировать компилятором <code>cc</code>.

</P>


<H4><A NAME="Caldera_Unixware" HREF="manual.ru_toc.html#Caldera_Unixware">2.6.6.10  Примечания к Caldera (SCO) Unixware Version 7.0</A></H4>

<P>
Вы должны использовать MySQL версий не ниже 3.22.13, поскольку в этой
версии исправлены некоторые проблемы, связанные с переносимостью под
Unixware.

</P>
<P>
Нам удалось скомпилировать MySQL следующей командой <code>configure</code> на Unixware
версии 7.0.1:

</P>

<PRE>
CC=cc CXX=CC ./configure --prefix=/usr/local/mysql
</PRE>

<P>
Если вы хотите использовать <code>gcc</code>, необходимо использовать <code>gcc</code> версии 2.95.2
или новее.

</P>
<P>
Caldera поставляет libsocket.so.2 с
<a HREF="ftp://stage.caldera.com/pub/security/tools">ftp://stage.caldera.com/pub/security/tools</a> для исправлений безопасности в
более ранних, чем OSR506, системах. Кроме того, исправление telnetd на
<a HREF="ftp://stage.caldera.com/pub/security/openserver/CSSA-2001-SCO.10/">ftp://stage.caldera.com/pub/security/openserver/CSSA-2001-SCO.10/</a> 
предназначено и для libsocket.so.2, и для libresolv.so.1. Там же
находятся инструкции для установки на более ранние, чем OSR506, системы.

</P>
<P>
Устанавливать вышеупомянутые патчи лучше до попытки
компиляции/использования MySQL.

</P>


<H3><A NAME="OS_2" HREF="manual.ru_toc.html#OS_2">2.6.7  Примечания к OS/2</A></H3>

<P>
В MySQL используется достаточно много открытых файлов. Поэтому в свой файл
<tt>`CONFIG.SYS'</tt> вам нужно добавить код вроде приведенного ниже:

</P>

<PRE>
SET EMXOPT=-c -n -h1024
</PRE>

<P>
В противном случае вы можете столкнуться со следующей ошибкой:

</P>

<PRE>
File 'xxxx' not found (Errcode: 24)
</PRE>

<P>
При использовании MySQL с OS/2 Warp 3 требуется FixPack 29 или выше, а с
OS/2 Warp 4 -FixPack 4 или выше. Это требуется для библиотеки Pthreads.
MySQL может быть установлен на файловой системе, поддерживающей длинные
имена, такой как HPFS, FAT32, и т.п.

</P>
<P>
Скрипт <tt>`INSTALL.CMD'</tt> должен запускаться из собственной оболочки OS/2 -
<tt>`CMD.EXE'</tt>; и может не работать в заменяющих ее оболочках, таких как
<tt>`4OS2.EXE'</tt>.

</P>
<P>
Скрипт <tt>`scripts/mysql-install-db'</tt> был переименован. Теперь он называется
<tt>`install'</tt>.cmd и является REXX-скриптом, который задает установки
безопасности MySQL по умолчанию и создает иконку WorkPlace Shell для
MySQL.

</P>
<P>
Поддержка динамических модулей скомпилирована, но полностью не проверена.
Динамические модули должны быть скомпилированы с использованием
динамической библиотеки Pthreads.

</P>

<PRE>
gcc -Zdll -Zmt -Zcrtdll=pthrdrtl -I../include -I../regex -I.. \
    -o example udf_example.cc -L../lib -lmysqlclient udf_example.def
mv example.dll example.udf
</PRE>

<P>
<strong>Примечание</strong>: в соответствии с ограничениями OS/2 размер основной части имен
модулей UDF не должен превышать 8-ми символов. Модули хранятся в каталоге
<tt>`/mysql2/udf'</tt>; скрипт s<tt>`afe-mysqld.cmd'</tt> помещает путь к этому каталогу в
переменную окружения <code>BEGINLIBPATH</code>. При использовании UDF-модулей
определенные расширения игнорируются - они все принимаются как <tt>`.udf'</tt>.
Например, в Unix динамический модуль может иметь имя <tt>`example.so'</tt> и функция
из него будет загружаться следующим образом:

</P>

<PRE>
mysql&#62; CREATE FUNCTION metaphon RETURNS STRING SONAME "example.so";
</PRE>

<P>
В OS/2 модуль будет иметь имя <tt>`example.udf'</tt>, но вы не должны определять
расширение модуля:

</P>

<PRE>
mysql&#62; CREATE FUNCTION metaphon RETURNS STRING SONAME "example";
</PRE>



<H3><A NAME="BeOS" HREF="manual.ru_toc.html#BeOS">2.6.8  Примечания к BeOS</A></H3>

<P>
Мы заинтересованы в том, чтобы MySQL работал в BeOS, но, к сожалению,
среди нас нет никого, кто знал бы BeOS или обладал временем для создания
портированной версии.

</P>
<P>
Если найдутся желающие создать портированную версию, то мы готовы оказать
им помощь в решении любых технических вопросов, которые могут возникнуть
при создании портированной версии.

</P>
<P>
У нас было предварительное общение с некоторыми разработчиками BeOS,
утверждавших, что на 80% создана портированная версия MySQL под BeOS,
однако уже на протяжении длительного времени мы не получали от них никаких
известий.

</P>


<H3><A NAME="Novell_Netware" HREF="manual.ru_toc.html#Novell_Netware">2.6.9  Примечания к Novell NetWare</A></H3>

<P>
Мы заинтересованы в том, чтобы MySQL работал на Novell NetWare, но, к
сожалению, среди нас нет никого, кто достаточно хорошо разбирался бы в
NetWare или обладал временем для создания портированной версии.

</P>
<P>
Мы хотели бы найти желающих создать портированную версию и готовы помочь
им в решении любых технических вопросов, которые могут возникнуть при
работе над ней.

</P>


<H2><A NAME="Perl_support" HREF="manual.ru_toc.html#Perl_support">2.7  Замечания по установке Perl</A></H2>

<P>
<A NAME="IDX352"></A>
<A NAME="IDX353"></A>

</P>



<H3><A NAME="Perl_installation" HREF="manual.ru_toc.html#Perl_installation">2.7.1  Установка Perl на Unix</A></H3>

<P>
Поддержка Perl для MySQL обеспечивается средствами клиентского интерфейса
<code>DBI</code>/<code>DBD</code>. See section <A HREF="manual.ru.html#Perl">8.2  Интерфейс Perl  API для MySQL</A>. Для клиентского кода Perl <code>DBD</code>/<code>DBI</code>
требуется версия Perl 5.004 или выше. При использовании более старой
версии Perl данный интерфейс <strong>не будет работать</strong>.

</P>
<P>
Для поддержки Perl в MySQL также требуется, чтобы была установлена
программная поддержка клиентов MySQL. Если вы установили MySQL из файлов
RPM, то клиентские программы находятся в RPM-пакете <code>MySQL-client</code>, а их
программная поддержка - в RPM-пакете <code>MySQL-devel</code>. Убедитесь, что у вас
установлена последняя версия RPM.

</P>
<P>
С версии 3.22.8 поддержка Perl поставляется отдельно от основного
дистрибутива MySQL. Если вы хотите установить поддержку Perl, то
необходимые файлы можно получить с
<a HREF="http://www.mysql.com/downloads/api-dbi.html">http://www.mysql.com/downloads/api-dbi.html</a>.

</P>
<P>
Дистрибутивы Perl поставляются  как  сжатые tar-архивы  с  именами 
наподобие <tt>`MODULE-VERSION.tar.gz'</tt>, где <code>MODULE</code> - имя модуля и <code>VERSION</code>
- номер  версии. Необходимо взять дистрибутивы <code>Data-Dumper</code>, <code>DBI</code> и
<code>Msql-Mysql-modules</code> и установить их в указанном порядке. Процедура
установки приведена ниже. Показанный пример приведен для модуля
<code>Data-Dumper</code>, но сама процедура одинакова для всех трех дистрибутивов:

</P>

<OL>
<LI>

Распакуйте дистрибутив в текущем каталоге:

<PRE>
shell&#62; gunzip &#60; Data-Dumper-VERSION.tar.gz | tar xvf -
</PRE>

Эта команда создает каталог с именем <tt>`Data-Dumper-VERSION'</tt>.

Перейдите в каталог, куда распаковался дистрибутив:

<PRE>
shell&#62; cd Data-Dumper-VERSION
</PRE>

Соберите дистрибутив и скомпилируйте:

<PRE>
shell&#62; perl Makefile.PL
shell&#62; make
shell&#62; make test
shell&#62; make install
</PRE>

</OL>

<P>
Команда <code>make test</code> является важной, поскольку она проверяет, работает ли
модуль. Следует учитывать, что если эта команда выполняется во время
установки <code>Msql-Mysql-modules</code> для проверки кода интерфейса, то сервер MySQL
при этом должен работать, или же данный тест потерпит неудачу.

</P>
<P>
Каждый раз при установке нового выпуска MySQL полезно создать заново и
переустановить дистрибутив <code>Msql-Mysql-modules</code>, особенно если замечаются
такие симптомы, как смерть скриптов <code>DBI</code> после модернизации MySQL (имеется
в виду coredump).

</P>
<P>
Если вы не обладаете правами установки модулей Perl в системном каталоге
или локальных модулей Perl, то для вас окажется полезной следующая ссылка:

</P>
<P>
<a HREF="http://www.iserver.com/support/contrib/perl5/modules.html">http://www.iserver.com/support/contrib/perl5/modules.html</a> 

</P>
<P>
Следует смотреть в рубрике <code>Installing New Modules that Require Locally
Installed Modules</code>.

</P>


<H3><A NAME="ActiveState_Perl" HREF="manual.ru_toc.html#ActiveState_Perl">2.7.2  Установка ActiveState Perl на Windows</A></H3>

<P>
<A NAME="IDX354"></A>
<A NAME="IDX355"></A>
<A NAME="IDX356"></A>

</P>
<P>
Для установки модуля <code>DBD</code> для MySQL под ActiveState Perl на Windows
необходимо выполнить следующие действия:

</P>

<UL>
<LI>

Получить ActiveState Perl с 
<a HREF="http://www.activestate.com/Products/ActivePerl/">http://www.activestate.com/Products/ActivePerl/</a> и установить его.
<LI>

Открыть оболочку DOS.
<LI>

Если это необходимо, то установить переменную HTTP_proxy. Например,
можно попытаться сделать следующее:


<PRE>
set HTTP_proxy=my.proxy.com:3128
</PRE>

<LI>

Запустить программу PPM:


<PRE>
C:\&#62; c:\perl\bin\ppm.pl
</PRE>

<LI>

Установить <code>DBI</code>, если этого еще не сделано:


<PRE>
ppm&#62; install DBI
</PRE>

<LI>

Если все прошло успешно, то запустить следующую команду:


<PRE>
install \
ftp://ftp.de.uu.net/pub/CPAN/authors/id/JWIED/DBD-mysql-1.2212.x86.ppd
</PRE>

</UL>

<P>
Эти команды должны работать по крайней мере с версией ActiveState Perl
5.6.

</P>
<P>
Если приведенные выше команды у вас не работают, то вместо этого
необходимо установить драйвер <code>MyODBC</code> и подключить сервер MySQL через ODBC:

</P>

<PRE>
use DBI;
$dbh= DBI-&#62;connect("DBI:ODBC:$dsn","$user","$password") ||
  die "Got error $DBI::errstr when connecting to $dsn\n";
</PRE>



<H3><A NAME="Windows_Perl" HREF="manual.ru_toc.html#Windows_Perl">2.7.3  Установка дистрибутива Perl для MySQL на Windows</A></H3>

<P>
Дистрибутив Perl для MySQL содержит <code>DBI</code>, <code>DBD:MySQL</code> и <code>DBD:ODBC</code>.

</P>

<UL>
<LI>

Загрузите дистрибутив Perl для Windows с
<a HREF="http://www.mysql.com/downloads/os-win32.html">http://www.mysql.com/downloads/os-win32.html</a>.
<LI>

Разархивируйте дистрибутив в <code>C:</code>, в результате чего вы получите
каталог <tt>`C:\PERL'</tt>.
<LI>

Добавьте в ваш путь каталог <tt>`C:\PERL\BIN'</tt>.
<LI>

Добавьте в ваш путь каталог <tt>`C:\PERL\BIN\MSWIN32-x86-thread'</tt> или
<tt>`C:\PERL\BIN\MSWIN32-x86'</tt>.
<LI>

Протестируйте работу <code>perl</code>, выполнив  команду <code>perl -v</code> в оболочке DOS.
</UL>



<H3><A NAME="Perl_support_problems" HREF="manual.ru_toc.html#Perl_support_problems">2.7.4  Проблемы использования интерфейса Perl <code>DBI</code>/<code>DBD</code></A></H3>

<P>
<A NAME="IDX357"></A>
<A NAME="IDX358"></A>

</P>
<P>
Если Perl сообщает, что не может найти модуль <tt>`../mysql/mysql.so'</tt>, то
проблема, возможно, заключается в том, что Perl не может найти
динамическую библиотеку <tt>`libmysqlclient.so'</tt>.

</P>
<P>
Эту проблему можно устранить, используя любой из следующих методов:

</P>

<UL>
<LI>

Для сборки дистрибутива <code>Msql-Mysql-modules</code> используйте <code>perl
Makefile.PL -static -config</code> вместо <code>perl Makefile.PL</code>.
<LI>

Скопируйте <tt>`libmysqlclient.so'</tt> в каталог, где находятся другие
динамические библиотеки (<tt>`/usr/lib'</tt> или <tt>`/lib'</tt>).
<LI>

Под Linux можно добавить путь к каталогу, где находится
<tt>`libmysqlclient.so'</tt> в файл <tt>`/etc/ld.so.conf'</tt>.

<A NAME="IDX359"></A>
<A NAME="IDX360"></A>

<LI>

Добавьте каталог, в котором находится <tt>`libmysqlclient.so'</tt>, в
переменную окружения <code>LD_RUN_PATH</code>.
</UL>

<P>
Если вы получаете от <code>DBD-mysql</code> представленные ниже ошибки, то, скорее
всего, у вас используется компилятор <code>gcc</code> (или старый бинарный код,
скомпилированный с <code>gcc</code>):

</P>

<PRE>
/usr/bin/perl: can't resolve symbol '__moddi3'
/usr/bin/perl: can't resolve symbol '__divdi3'
</PRE>

<P>
Добавьте  в  команду  линкования  при  сборке  библиотеки <tt>`mysql.so'</tt>, 
<code>-L/usr/lib/gcc-lib/... -lgcc</code> (нужно проверить вывод из <code>make</code> для 
<tt>`mysql.so'</tt> при компиляции клиента Perl). Опция <code>-L</code> должна указывать путь
к каталогу, где находится <tt>`libgcc.a'</tt> в вашей системе.

</P>
<P>
Еще одна причина появления ошибок может заключаться в том, что оба модуля
- Perl и MySQL не скомпилированы вместе компилятором <code>gcc</code>. В этом случае
данное несоответствие можно устранить, скомпилировав оба модуля
компилятором <code>gcc</code>.

</P>
<P>
Если при выполнении тестов вы получаете от модуля <code>Msql-Mysql-modules</code> 
следующие ошибки:

</P>

<PRE>
t/00base............install_driver(mysql) failed:
Can't load '../blib/arch/auto/DBD/mysql/mysql.so' for module DBD::mysql:
../blib/arch/auto/DBD/mysql/mysql.so: undefined symbol:
uncompress at /usr/lib/perl5/5.00503/i586-linux/DynaLoader.pm line 169,
</PRE>

<P>
то это означает, что в строку линкования необходимо включить библиотеку
сжатия <code>-lz</code>. Для этого необходимо внести следующее изменение в файл
<tt>`lib/DBD/mysql/Install.pm'</tt>:

</P>

<PRE>
$sysliblist .= " -lm";

на

$sysliblist .= " -lm -lz";
</PRE>

<P>
После этого необходимо выполнить команду <code>make realclean</code> и затем
повторить процесс инсталляции сначала.

</P>
<P>
Если вы хотите использовать эти модули в системе, которая не поддерживает
динамического линкования (вроде Caldera/SCO), то можно сгенерировать
статическую версию Perl, включающую <code>DBI</code> и <code>DBD-mysql</code>. Она будет работать
следующим образом: нужно создать версию Perl, слинкованную с кодом <code>DBI</code>, и
установить ее поверх текущего Perl. Затем эта версия используется для
сборки версии Perl, которая дополнительно включает слинкованный код DBD, <code>и</code>
устанавливается уже она.

</P>
<P>
В операционной системе Caldera (SCO) необходимо иметь следующий набор
переменных окружения:

</P>

<PRE>
shell&#62; LD_LIBRARY_PATH=/lib:/usr/lib:/usr/local/lib:/usr/progressive/lib
или
shell&#62; LD_LIBRARY_PATH=/usr/lib:/lib:/usr/local/lib:/usr/ccs/lib:\
       /usr/progressive/lib:/usr/skunk/lib
shell&#62; LIBPATH=/usr/lib:/lib:/usr/local/lib:/usr/ccs/lib:\
       /usr/progressive/lib:/usr/skunk/lib
shell&#62; MANPATH=scohelp:/usr/man:/usr/local1/man:/usr/local/man:\
       /usr/skunk/man:
</PRE>

<P>
Вначале следует создать модуль Perl, включающий статически слинкованный
<code>DBI</code>. Это делается  путем выполнения следующих команд в каталоге, где
располагается дистрибутив <code>DBI</code>:

</P>

<PRE>
shell&#62; perl Makefile.PL -static -config
shell&#62; make
shell&#62; make install
shell&#62; make perl
</PRE>

<P>
Затем необходимо установить новый модуль Perl. Вывод команды <code>make perl</code> 
укажет точную команду <code>make</code>, которую необходимо будет выполнить для
завершения установки. Для Caldera (SCO) это  будет  команда  <code>make -f 
Makefile.aperl inst_perl MAP_TARGET=perl</code>.

</P>
<P>
Затем нужно использовать только что созданный модуль Perl для создания еще
одного модуля Perl, который также включает в себя статически слинкованный
модуль <code>DBD::mysql</code>. Это делается путем выполнения следующих команд в
каталоге, где располагается дистрибутив <code>Msql-Mysql-modules</code>:

</P>

<PRE>
shell&#62; perl Makefile.PL -static -config
shell&#62; make
shell&#62; make install
shell&#62; make perl
</PRE>

<P>
И в завершение осталось установить этот новый модуль Perl. Какую команду
для этого использовать, вы опять узнаете из вывода <code>make perl</code>.


<H1><A NAME="Tutorial" HREF="manual.ru_toc.html#Tutorial">3  Учебное пособие по MySQL</A></H1>

<P>
<A NAME="IDX361"></A>
<A NAME="IDX362"></A>
<A NAME="IDX363"></A>
<A NAME="IDX364"></A>

</P>

<P>
Эта глава представляет собой обучающий курс по MySQL: в ней
демонстрируется использование клиентской программы <code>mysql</code> для создания
несложной базы данных и работы с ней. Утилита <code>mysql</code> (иногда называемая
также ``терминальным монитором'' или просто ``монитором'') представляет
собой интерактивную программу, позволяющую подсоединяться к MySQL-серверу,
запускать запросы, и просматривать результаты. Программа <code>mysql</code> может
работать и в пакетном режиме: для этого необходимо записать все запросы в
файл, а затем передать его содержимое на исполнение <code>mysql</code>. Ниже описаны
оба способа использования <code>mysql</code>.

</P>
<P>
Увидеть список команд программы <code>mysql</code> можно, запустив ее с параметром
<code>--help</code>:

</P>

<PRE>
shell&#62; mysql --help
</PRE>

<P>
Текст главы построен с расчетом на то, что на вашем компьютере установлен
<code>mysql</code> и существует связь с сервером MySQL. Если это не так, свяжитесь со
своим администратором MySQL (если вы и есть администратор, обратитесь к
другим разделам настоящего руководства).

</P>
<P>
В этой главе дано подробное описание всего процесса установки и
использования базы данных. Если вы хотите лишь работать с ранее созданной
базой, можете пропустить разделы, посвященные созданию базы и содержащихся
в ней таблиц.

</P>
<P>
Так как эта глава задумывалась как учебное пособие, многие детали пришлось
опустить. Дополнительную информацию о раскрытых в этой главе темах можно
почерпнуть из соответствующих разделов руководства.

</P>



<H2><A NAME="Connecting-disconnecting" HREF="manual.ru_toc.html#Connecting-disconnecting">3.1  Подсоединение к серверу и отсоединение от него</A></H2>

<P>
<A NAME="IDX365"></A>
<A NAME="IDX366"></A>
<A NAME="IDX367"></A>
<A NAME="IDX368"></A>

</P>
<P>
При подключении к серверу с помощью <code>mysql</code> обычно нужно ввести имя
пользователя MySQL и, в большинстве случаев, пароль. Если сервер запущен
не на том компьютере, с которого вы вошли в систему, необходимо также
указать имя хоста. Параметры соединения (а именно - соответствующее имя
хоста, пользователя и пароль) вы сможете узнать у администратора. Получив
соответствующие параметры, подсоединиться к серверу можно следующим
образом:

</P>

<PRE>
shell&#62; mysql -h host -u user -p
Enter password: ********
</PRE>

<P>
Символы ******** обозначают ваш пароль; введите его, когда <code>mysql</code> выведет
на экран запрос <code>Enter password:</code>.

</P>
<P>
Если все сработает, на экране должна появиться следующая информация и
метка командной строки <code>mysql&#62;</code>:

</P>

<PRE>
shell&#62; mysql -h host -u user -p
Enter password: ********

Welcome to the MySQL monitor. Commands end with ; or \g.
Your MySQL connection id is 459 to server version: 3.22.20a-log

Type 'help' for help.

mysql&#62;
</PRE>

<P>
Метка обозначает, что программа <code>mysql</code> готова к вводу команд.

</P>
<P>
В некоторых вариантах установки MySQL возможно подсоединение к запущенному
на локальном хосте серверу без ввода имени пользователя (пользователь
anonymous). Если ваша система настроена именно так, подсоединиться к
серверу вы сможете, запустив <code>mysql</code> со следующими параметрами:

</P>

<PRE>
shell&#62; mysql
</PRE>

<P>
После установки соединения можно в любой момент отключиться от сервера,
набрав в командной строке <code>mysql&#62;</code> команду <code>QUIT</code>:

</P>

<PRE>
mysql&#62; QUIT
Bye
</PRE>

<P>
Отсоединиться от сервера можно и при помощи сочетания клавиш Control-D.

</P>
<P>
Большая часть приведенных ниже примеров построена с учетом того, что
соединение с сервером уже установлено. Это видно по наличию в них
командной строки <code>mysql&#62;</code>.

</P>



<H2><A NAME="Entering_queries" HREF="manual.ru_toc.html#Entering_queries">3.2  Ввод запросов</A></H2>

<P>
<A NAME="IDX369"></A>
<A NAME="IDX370"></A>
<A NAME="IDX371"></A>

</P>
<P>
Подсоединитесь к серверу, как было описано выше. Таким образом  никакая
база выбрана не будет, но это не страшно. На данном этапе нам гораздо
важней разобраться с созданием запросов, нежели сразу усложнять себе жизнь
созданием таблиц, загрузкой в них данных и извлечением их оттуда. В этом
разделе разъясняются основные принципы ввода команд; на примере нескольких
запросов вы можете поближе познакомиться с работой <code>mysql</code>.

</P>
<P>
Ниже приведена простая команда, запрашивающая у сервера информацию об его
версии и текущей дате. Введите ее в командной строке <code>mysql&#62;</code> и нажмите
Enter:

</P>

<PRE>
mysql&#62; SELECT VERSION(), CURRENT_DATE;

+--------------+--------------+
| VERSION()    | CURRENT_DATE |
+--------------+--------------+
| 3.22.20a-log | 1999-03-19   |
+--------------+--------------+
1 row in set (0.01 sec)
mysql&#62;
</PRE>

<P>
Этот запрос иллюстрирует следующие особенности <code>mysql</code>:

</P>

<UL>

<LI>

Команда обычно состоит из SQL-выражения, за которым следует точка с
запятой. (Из этого правила есть и исключения - команды без точки с
запятой. Одним из них является упомянутая выше команда <code>QUIT</code>, остальные
мы рассмотрим позднее.)

<LI>

Когда пользователь вводит команду, <code>mysql</code> отправляет ее серверу для
выполнения и выводит на экран сначала результаты, а затем - новую
строку <code>mysql&#62;</code>, что означает готовность к выполнению новых команд.

<LI>

mysql выводит результаты работы запроса в виде таблицы (строк и
столбцов). В первой строке этой таблицы содержатся заголовки столбцов,
а в следующих строках - собственно результаты. Обычно заголовками
столбцов становятся имена, полученные из таблиц базы. Если же
извлекается не столбец таблицы, а значение выражения (как это
происходит в приведенном выше примере), <code>mysql</code> дает столбцу имя
запрашиваемого выражения.

<LI>

mysql сообщает количество возвращаемых строк и время выполнения
запроса, что позволяет в некоторой степени составить представление о
производительности сервера. Эти значения обычно весьма впечатляют, так
как представляют обычное (а не машинное время), кроме того, на них
оказывает влияние загрузка сервера и скорость работы сети (для
сокращения размеров листингов в остальных примерах этой главы строка
"rows in set" удалена).

</UL>

<P>
Для ввода ключевых слов можно использовать любой регистр символов.
Приведенные ниже запросы абсолютно идентичны:

</P>

<PRE>
mysql&#62; SELECT VERSION(), CURRENT_DATE;
mysql&#62; select version(), current_date;
mysql&#62; SeLeCt vErSiOn(), current_DATE;
</PRE>

<P>
А это - еще один запрос. В нем демонстрируется использование <code>mysql</code> в
качестве несложного калькулятора:

</P>

<PRE>
mysql&#62; SELECT SIN(PI()/4), (4+1)*5;
+-------------+---------+
| SIN(PI()/4) | (4+1)*5 |
+-------------+---------+
|    0.707107 |      25 |
+-------------+---------+
</PRE>

<P>
Все команды, представленные выше, были относительно короткими и состояли
из одной строки. В одну строку можно поместить и несколько команд. Но
каждая из них должна заканчиваться точкой с запятой:

</P>

<PRE>
mysql&#62; SELECT VERSION(); SELECT NOW();
+--------------+
| VERSION()    |
+--------------+
| 3.22.20a-log |
+--------------+

+---------------------+
| NOW()               |
+---------------------+
| 1999-03-19 00:15:33 |
+---------------------+
</PRE>

<P>
Втискивать все команды в одну строку совсем не обязательно, так что
создание длинных команд, занимающих несколько строк, никаких проблем не
вызывает. Для <code>mysql</code> признаком завершения выражения является точка с
запятой, а не конец строки (другими словами, <code>mysql</code> принимает команды без
форматирования: строки с командами собираются, но не исполняются до тех
пор, пока программа не обнаружит точку с запятой).

</P>
<P>
Вот пример несложного выражения, занимающего несколько строк:

</P>

<PRE>
mysql&#62; SELECT
    -&#62; USER()
    -&#62; ,
    -&#62; CURRENT_DATE;
+--------------------+--------------+
| USER()             | CURRENT_DATE |
+--------------------+--------------+
| joesmith@localhost | 1999-03-18   |
+--------------------+--------------+
</PRE>

<P>
Обратите внимание на то, как изменилась метка командной строки (с <code>mysql&#62;</code>
на <code>-&#62;</code>) после ввода первой строки этого запроса. Таким образом программа
mysql показывает, что завершенного выражения она пока что не получила и
ожидает его полного ввода. Эта метка очень полезна, так как предоставляет
весьма ценную информацию о состоянии программы. С ее помощью всегда можно
узнать, чего ждет <code>mysql</code>.

</P>
<P>
Если вы решите отменить исполнение набираемой команды, наберите <code>\c</code>:

</P>

<PRE>
mysql&#62; SELECT
    -&#62; USER()
    -&#62; \c
mysql&#62;
</PRE>

<P>
Обратите внимание на метку: после ввода команды <code>\c</code> она снова принимает вид
mysql&#62;, показывая, что программа <code>mysql</code> перешла в режим ожидания указаний.

</P>
<P>
В этой таблице приведены все возможные варианта вида метки командной
строки и соответствующие им состояния <code>mysql</code>:

</P>
<P>
<A NAME="IDX372"></A>
<TABLE BORDER>
<TR><TD><strong>Метка</strong> </TD><TD> <strong>Значение</strong>
</TD></TR>
<TR><TD><code>mysql&#62;</code> </TD><TD> Ожидание новой команды.
</TD></TR>
<TR><TD><code>    -&#62;</code> </TD><TD> Ожидание следующей строки многострочной команды.
</TD></TR>
<TR><TD><code>    '&#62;</code> </TD><TD> Ожидание следующей строки, сбор строкового выражения,
начинающегося с одиночной кавычки (<samp>`''</samp>).
</TD></TR>
<TR><TD><code>    "&#62;</code> </TD><TD> Ожидание следующей строки, сбор строкового выражения,
начинающегося с двойной кавычки (<samp>`"'</samp>).
</TD></TR>
</TABLE>

</P>
<P>
Обычно многострочные команды получаются случайно, когда хочешь создать
обычную команду, но забываешь поставить завершающую точку с запятой. В
таком случае <code>mysql</code> ожидает продолжения:

</P>

<PRE>
mysql&#62; SELECT USER()
    -&#62;
</PRE>

<P>
Если с вами произошло подобное (вы думаете, что завершили команду, но
программа выдает только метку <code>-&#62;</code>), то <code>mysql</code>, вероятнее всего, ждет точки с
запятой. Не обратив внимание на метку командной строки, можно довольно
долго ждать выполнения команды, не понимая в чем дело. А достаточно лишь
поставить точку с запятой, завершив команду, которую <code>mysql</code> и выполнит:

</P>

<PRE>
mysql&#62; SELECT USER()
    -&#62; ;
+--------------------+
| USER()             |
+--------------------+
| joesmith@localhost |
+--------------------+
</PRE>

<P>
Метки <code>'&#62;</code> и <code>"&#62;</code> используются при сборе строк. В MySQL строки можно заключать
как в одинарные (<samp>`''</samp>), так и в двойные (<samp>`"'</samp>) кавычки (можно, например,
написать <code>'hello'</code> или <code>"goodbye"</code>), к тому же, <code>mysql</code> позволяет вводить
строковые выражения, состоящие из нескольких строчек текста. Метка <code>'&#62;</code> или
<code>"&#62;</code> обозначает, что вы ввели строку, открывающуюся символом кавычек <samp>`''</samp> или
<samp>`"'</samp>, но еще не ввели завершающую строковое выражение закрывающую кавычку.

</P>
<P>
Это, конечно, нормально, если вы собираетесь создать большое строковое
выражение из нескольких строчек. Но это не слишком частый случай. Гораздо
чаще оказывается, что вы просто забыли поставить закрывающую кавычку.
Например:

</P>

<PRE>
mysql&#62; SELECT * FROM my_table WHERE name = "Smith AND age &#60; 30;
    "&#62;
</PRE>

<P>
Если ввести такую команду <code>SELECT</code>, нажать Enter и подождать результатов,
ничего не произойдет. Тут-то и нужно обратить внимание на метку командной
строки, выглядящую вот так: <code>"&#62;</code>. Это значит, что <code>mysql</code> ждет ввода
завершающей части строки. (Теперь заметили ошибку в команде? В строке
<code>"Smith</code> нет закрывающей кавычки.)

</P>
<P>
Что делать в этом случае? Проще всего было бы отменить команду. Однако
теперь просто набрать <code>\c</code> нельзя, так как <code>mysql</code> примет эти символы за часть
собираемой строки! Вместо этого нужно ввести закрывающие кавычки (тем
самым дав <code>mysql</code> понять, что строка закончилась) и лишь затем набрать <code>\c</code>:

</P>

<PRE>
mysql&#62; SELECT * FROM my_table WHERE name = "Smith AND age &#60; 30;
    "&#62; "\c
mysql&#62;
</PRE>

<P>
Метка командной строки снова примет вид <code>mysql&#62;</code>, показывая готовность mysql
к выполнению команд.

</P>
<P>
Знать значение меток <code>'&#62;</code> и <code>"&#62;</code> необходимо, так как при вводе незавершенной
строки все последующие строки будут игнорироваться <code>mysql</code> - включая строку
с командой <code>QUIT</code>! Это может основательно сбить с толку, особенно если не
знать, что для отмены команды перед соответствующей последовательностью
символов необходимо поставить закрывающую кавычку.

</P>



<H2><A NAME="Database_use" HREF="manual.ru_toc.html#Database_use">3.3  Создание и использование базы данных</A></H2>

<P>
<A NAME="IDX373"></A>
<A NAME="IDX374"></A>
<A NAME="IDX375"></A>

</P>

<P>
Теперь, когда вы знаете, как вводить команды, пора начать работу с базой
данных.

</P>
<P>
Предположим, у вас дома (или в вольере) живет несколько домашних любимцев
и вы хотите создать систему для хранения разнообразной информации о своем
живом уголке. Для того чтобы это сделать, нужно просто создать таблицы и
записать в них информацию. После этого любые данные можно будет получить,
извлекая данные из таблиц. В этом разделе вы научитесь:

</P>


<UL>
<LI>

создавать базу данных
<LI>

создавать таблицу
<LI>

записывать в таблицу данные
<LI>

извлекать данные из таблицы различными способами
<LI>

работать с несколькими таблицами сразу
</UL>

<P>
Наша база данных будет чрезвычайно проста (это мы сделали намеренно), но
совсем несложно придумать реальные задачи, решение которых потребовало бы
применения подобной базы данных. Такая база, например, может пригодиться
скотоводу для хранения информации о поголовье или ветеринару - для учета
пациентов. Готовая база данных <code>menagerie</code>, в которой содержатся некоторые
из запросов и данные из приведенных ниже разделов, находится на web-сайте
MySQL. Ее можно загрузить в виде сжатого <code>tar</code>-файла 
(<a HREF="http://www.mysql.com/Downloads/Contrib/Examples/menagerie.tar.gz">http://www.mysql.com/Downloads/Contrib/Examples/menagerie.tar.gz</a>) или Zip
(<a HREF="http://www.mysql.com/Downloads/Contrib/Examples/menagerie.zip">http://www.mysql.com/Downloads/Contrib/Examples/menagerie.zip</a>).

</P>
<P>
Узнать, какие базы существуют в настоящее время на сервере, можно при
помощи команды <code>SHOW</code>:

</P>

<PRE>
mysql&#62; SHOW DATABASES;
+----------+
| Database |
+----------+
| mysql    |
| test     |
| tmp      |
+----------+
</PRE>

<P>
На вашем компьютере список баз, вероятно, будет другим, но в нем все
равно, скорее всего, будут присутствовать базы <code>mysql</code> и <code>test</code>. База данных
<code>mysql</code> просто необходима, так как в ней она описываются пользовательские
права доступа. База <code>test</code> часто применяется для экспериментов.

</P>
<P>
Впрочем, всех баз вы можете и не увидеть, если у вас нет привилегии <code>SHOW
DATABASES</code>. See section <A HREF="manual.ru.html#GRANT">4.3.1  Синтаксис команд <code>GRANT</code> и <code>REVOKE</code></A>.

</P>
<P>
Если база данных <code>test</code> существует, попробуйте обратиться к ней:

</P>

<PRE>
mysql&#62; USE test
Database changed
</PRE>

<P>
В команде <code>USE</code>, как и <code>QUIT</code>, точка с запятой не нужна (конечно, данные
команды тоже можно завершать точкой с запятой - никакого вреда от этого не
будет). Команда <code>USE</code> отличается от остальных и кое-чем еще: она должна
задаваться одной строкой.

</P>
<P>
Базу данных <code>test</code> (если, конечно, у вас есть доступ к ней) можно
использовать для работы с приведенными ниже примерами, но все созданное в
ней может быть уничтожено любым другим пользователем, имеющим к ней
доступ. Поэтому вам лучше попросить у своего администратора MySQL
разрешение на создание собственной базы. Предположим, вы захотите назвать
ее menagerie (``зверинец''). В таким случае администратору нужно будет
набрать примерно такую команду:

</P>

<PRE>
mysql&#62; GRANT ALL ON menagerie.* TO your_mysql_name;
</PRE>

<P>
где your_mysql_name - присвоенное вам имя MySQL.

</P>



<H3><A NAME="Creating_database" HREF="manual.ru_toc.html#Creating_database">3.3.1  Создание и выбор базы данных</A></H3>

<P>
<A NAME="IDX376"></A>
<A NAME="IDX377"></A>

</P>
<P>
Если администратор при выдаче разрешения создаст для вас базу, с ней можно
сразу начинать работу. В противном случае вам придется создать ее
самостоятельно:

</P>


<PRE>
mysql&#62; CREATE DATABASE menagerie;
</PRE>

<P>
В Unix имеет значение регистр символов в именах баз данных (в отличие от
ключевых слов SQL), так что в этой ОС вам всегда придется называть свою
базу <code>menagerie</code>, а не <code>Menagerie</code>, <code>MENAGERIE</code> или еще как-нибудь. Это же
правило распространяется и на имена таблиц (в Windows данное ограничение
не действует, однако при обращении к базам и таблицам в пределах одного
запроса, тем не менее, можно использовать только один регистр).

</P>
<P>
При создании базы данных она автоматически не выбирается; выбирать ее
нужно отдельно. Сделать menagerie текущей базой можно с помощью следующей
команды:

</P>

<PRE>
mysql&#62; USE menagerie
Database changed
</PRE>

<P>
Создавать базу нужно только однажды, но выбирать ее приходится в каждом
сеансе работы с <code>mysql</code>. Делать это можно с помощью команды USE,
представленной выше. А можно выбирать базу и из командной строки при
запуске <code>mysql</code>. Для этого достаточно лишь ввести ее имя после параметров
соединения, которые нужно вводить в любом случае. Например:

</P>

<PRE>
shell&#62; mysql -h host -u user -p menagerie
Enter password: ********
</PRE>

<P>
Обратите внимание: в вышеприведенной команде <code>menagerie</code> не является
паролем. Ввести пароль в командной строке после параметра -p можно без
пробела (например, <code>-pmypassword</code>, а не <code>-p mypassword</code>). Впрочем, пароль в
командной строке все равно лучше не вводить, так как таким образом его
могут и подсмотреть.

</P>



<H3><A NAME="Creating_tables" HREF="manual.ru_toc.html#Creating_tables">3.3.2  Создание таблицы</A></H3>

<P>
<A NAME="IDX378"></A>
<A NAME="IDX379"></A>

</P>
<P>
Как вы уже успели убедиться, создать базу данных было просто. Однако пока
что в ней ничего нет - в этом можно удостовериться при помощи команды <code>SHOW
TABLES</code>:

</P>

<PRE>
mysql&#62; SHOW TABLES;
Empty set (0.00 sec)
</PRE>

<P>
Гораздо труднее определиться со структурой своей базы, т.е. с тем, какие
могут понадобиться таблицы, и какие столбцы должны содержаться в каждой из
них.

</P>
<P>
Вам обязательно будет нужна таблица, содержащая по записи на каждое из
животных. Назвать ее можно <code>pet</code>, и храниться в ней будут, как минимум,
имена. Но так как само по себе имя неинформативно, в таблице должны будут
присутствовать и другие данные. Например, если домашние животные есть
более чем у одного члена вашей семьи, в таблицу можно добавить и имя
владельца каждого животного. Кроме того, в базу стоит внести и
описательную информацию - например, вид и пол животного.

</P>
<P>
Но вот как быть с возрастом? Эта информация тоже может оказаться полезной,
но хранить такие данные в базе неудобно. Возраст со временем меняется, а
это значит, что придется довольно часто обновлять записи. Значительно
удобнее хранить фиксированные значения - например, даты рождения. В таком
случае возраст всегда можно получить, вычислив разницу между текущей датой
и датой рождения. В MySQL есть функции для арифметических действий над
данными, так что это совсем несложно. Хранение даты рождения имеет и
другие преимущества:

</P>

<UL>
<LI>

Базу данных можно использовать для выдачи напоминаний о приближающихся
днях рождения животных (не спешите улыбаться: та же задача может
возникнуть и при работе с деловой базой данных, которая должна уметь
напоминать о днях рождения клиентов, облегчая таким образом рассылку
поздравлений).

<LI>

Возраст можно подсчитывать относительно любой даты, а не только для
текущей. Например, если записать в базу и дату смерти животного,
всегда можно будет узнать, сколько лет ему было на момент смерти.
</UL>

<P>
Можно было бы придумать и еще какие-нибудь данные, которые неплохо было бы
хранить в таблице pet, но пока что мы ограничимся уже выбранными: именем
(<code>name</code>), именем владельца (<code>owner</code>), видом (<code>species</code>), полом (<code>sex</code>), датой
рождения (<code>birth</code>) и датой смерти (<code>death</code>).

</P>
<P>
При помощи команды <code>CREATE TABLE</code> определим структуру новой таблицы:

</P>

<PRE>
mysql&#62; CREATE TABLE pet (name VARCHAR(20), owner VARCHAR(20),
    -&#62; species VARCHAR(20), sex CHAR(1), birth DATE, death DATE);
</PRE>

<P>
Тип <code>VARCHAR</code> отлично подойдет для хранения имени животного, имени владельца
и названия вида, так как длина данных этого типа может варьироваться.
Конечно, длины таких столбцов вовсе не должны совпадать и не должны быть
равны 20 - можно выбрать любое значение в пределах от 1 до 255 (если при
выборе длины столбца вы ошибетесь, и при работе с базой окажется, что
столбец маловат, можно будет исправить ошибку при помощи команды <code>ALTER
TABLE</code>).

</P>
<P>
Пол животного можно обозначать несколькими способами, например буквами "m"
и "f", или словами male (мужской) и female (женский). С буквами "m" и "f"
будет проще.

</P>
<P>
Применение типа данных <code>DATE</code> для хранения дат рождения и смерти вполне
очевидно.

</P>
<P>
Теперь, когда таблица создана, команда <code>SHOW TABLES</code> должна вывести
следующее:

</P>

<PRE>
mysql&#62; SHOW TABLES;
+---------------------+
| Tables in menagerie |
+---------------------+
| pet                 |
+---------------------+
</PRE>

<P>
Проверить, правильно была ли таблица создана в соответствии с планом,
можно при помощи команды <code>DESCRIBE</code>:

</P>

<PRE>
mysql&#62; DESCRIBE pet;
+---------+-------------+------+-----+---------+-------+
| Field   | Type        | Null | Key | Default | Extra |
+---------+-------------+------+-----+---------+-------+
| name    | varchar(20) | YES  |     | NULL    |       |
| owner   | varchar(20) | YES  |     | NULL    |       |
| species | varchar(20) | YES  |     | NULL    |       |
| sex     | char(1)     | YES  |     | NULL    |       |
| birth   | date        | YES  |     | NULL    |       |
| death   | date        | YES  |     | NULL    |       |
+---------+-------------+------+-----+---------+-------+
</PRE>

<P>
Использовать команду <code>DESCRIBE</code> можно в любое время, например, если вы
забудете имена столбцов или типы, к которым они относятся.

</P>



<H3><A NAME="Loading_tables" HREF="manual.ru_toc.html#Loading_tables">3.3.3  Загрузка данных в таблицу</A></H3>

<P>
<A NAME="IDX380"></A>
<A NAME="IDX381"></A>
<A NAME="IDX382"></A>

</P>
<P>
Создав таблицу, нужно позаботиться об ее заполнении. Для этого
предназначены команды <code>LOAD DATA</code> и <code>INSERT</code>.

</P>
<P>
Предположим, ваши записи соответствуют приведенным в этой таблице
(обратите внимание: MySQL принимает даты в формате <code>ГГГГ-ММ-ДД</code>; возможно, к
такой записи вы не привыкли).

</P>
<TABLE BORDER>
<TR><TD><strong>name</strong> </TD><TD> <strong>owner</strong> </TD><TD> <strong>species</strong> </TD><TD> <strong>sex</strong> </TD><TD> <strong>birth</strong> </TD><TD> <strong>death</strong>
</TD></TR>
<TR><TD>Fluffy </TD><TD> Harold </TD><TD> cat </TD><TD> f </TD><TD> 1993-02-04 </TD><TD>
</TD></TR>
<TR><TD>Claws </TD><TD> Gwen </TD><TD> cat </TD><TD> m </TD><TD> 1994-03-17 </TD><TD>
</TD></TR>
<TR><TD>Buffy </TD><TD> Harold </TD><TD> dog </TD><TD> f </TD><TD> 1989-05-13 </TD><TD>
</TD></TR>
<TR><TD>Fang </TD><TD> Benny </TD><TD> dog </TD><TD> m </TD><TD> 1990-08-27 </TD><TD>
</TD></TR>
<TR><TD>Bowser </TD><TD> Diane </TD><TD> dog </TD><TD> m </TD><TD> 1998-08-31 </TD><TD> 1995-07-29
</TD></TR>
<TR><TD>Chirpy </TD><TD> Gwen </TD><TD> bird </TD><TD> f </TD><TD> 1998-09-11 </TD><TD>
</TD></TR>
<TR><TD>Whistler </TD><TD> Gwen </TD><TD> bird </TD><TD> </TD><TD> 1997-12-09 </TD><TD>
</TD></TR>
<TR><TD>Slim </TD><TD> Benny </TD><TD> snake </TD><TD> m </TD><TD> 1996-04-29 </TD><TD>
</TD></TR>
</TABLE>

<P>
Так как вы начинаете работу с пустой таблицей, заполнить ее будет проще
всего, если создать текстовый файл, содержащий по строке на каждое из
животных, а затем загрузить его содержимое в таблицу одной командой.

</P>
<P>
Создайте текстовый файл с именем <tt>`pet.txt'</tt>, содержащий по одной записи в
каждой строке (значения столбцов должны быть разделены символами табуляции
и даны в том порядке, который был определен командой <code>CREATE TABLE</code>).
Незаполненным полям (например, неизвестный пол или даты смерти живых на
сегодняшний день животных), можно присвоить значение <code>NULL</code>. В текстовом
файле это значение представляется символами <code>\N</code>. Например, запись для птицы
<code>Whistler</code> должна выглядеть примерно так (между значениями должны
располагаться одиночные символы табуляции):

</P>
<TABLE BORDER>
<TR><TD><strong>name</strong> </TD><TD> <strong>owner</strong> </TD><TD> <strong>species</strong> </TD><TD> <strong>sex</strong> </TD><TD> <strong>birth</strong> </TD><TD> <strong>death</strong>
</TD></TR>
<TR><TD><code>Whistler</code> </TD><TD> <code>Gwen</code> </TD><TD> <code>bird</code> </TD><TD> <code>\N</code> </TD><TD> <code>1997-12-09</code> </TD><TD> <code>\N</code>
</TD></TR>
</TABLE>

<P>
Загрузить файл <tt>`pet.txt'</tt> в таблицу можно с помощью следующей команды:

</P>

<PRE>
mysql&#62; LOAD DATA LOCAL INFILE "pet.txt" INTO TABLE pet;
</PRE>

<P>
Маркер конца строки и символ, разделяющий значения столбцов, можно
специально задать в команде <code>LOAD DATA</code>, но по умолчанию используются
символы табуляции и перевода строки. Воспринимая их, команда сможет
корректно прочитать файл <tt>`pet.txt'</tt>.

</P>
<P>
При добавлении одиночных записей используется команда <code>INSERT</code>. В самом
простом варианте ее применения необходимо задать значения каждого столбца,
в том порядке, в каком они были перечислены в команде <code>CREATE TABLE</code>.
Предположим, Диана (Diane) купила хомячка по имени Puffball.
Соответствующую запись в таблицу с можно внести с помощью команды <code>INSERT</code>
примерно так:

</P>

<PRE>
mysql&#62; INSERT INTO pet
    -&#62; VALUES ('Puffball','Diane','hamster','f','1999-03-30',NULL);
</PRE>

<P>
Обратите внимание на то, что здесь строковые выражения и даты представлены
в виде ограниченных кавычками строк. Кроме того, в команде <code>INSERT</code>
отсутствующие данные можно прямо заменять на <code>NULL</code>. Пользоваться эвфемизмом
<code>\N</code>, как в команде <code>LOAD DATA</code>, нужды нет.

</P>
<P>
Этот пример наглядно показывает, что если бы с самого начала все данные
вносились в базу при помощи нескольких команд <code>INSERT</code>, а не одной команды
<code>LOAD DATA</code>, то набирать пришлось бы гораздо больше текста.

</P>


<H3><A NAME="Retrieving_data" HREF="manual.ru_toc.html#Retrieving_data">3.3.4  Выборка информации из таблицы</A></H3>

<P>
<A NAME="IDX383"></A>
<A NAME="IDX384"></A>
<A NAME="IDX385"></A>
<A NAME="IDX386"></A>

</P>

<P>
Информация извлекается из таблиц при помощи команды <code>SELECT</code>. Вызывается она
так:

</P>

<PRE>
SELECT what_to_select
FROM which_table
WHERE conditions_to_satisfy
</PRE>

<P>
где <code>what_to_select</code> обозначает нужные данные. Это может быть список
столбцов или символ <code>*</code> (``все столбцы''). which_table указывает таблицу, из
которой должны быть извлечены данные. Условие <code>WHERE</code> использовать
необязательно, но если оно все же присутствует в вызове команды, то
параметр <code>conditions_to_satisfy</code> задает условия, которым должны
соответствовать нужные строки.

</P>


<H4><A NAME="Selecting_all" HREF="manual.ru_toc.html#Selecting_all">3.3.4.1  Выборка всех данных</A></H4>

<P>
В самом простом варианте вызова <code>SELECT</code> из таблицы извлекаются сразу все
данные:

</P>

<PRE>
mysql&#62; SELECT * FROM pet;
+----------+--------+---------+------+------------+------------+
| name     | owner  | species | sex  | birth      | death      |
+----------+--------+---------+------+------------+------------+
| Fluffy   | Harold | cat     | f    | 1993-02-04 | NULL       |
| Claws    | Gwen   | cat     | m    | 1994-03-17 | NULL       |
| Buffy    | Harold | dog     | f    | 1989-05-13 | NULL       |
| Fang     | Benny  | dog     | m    | 1990-08-27 | NULL       |
| Bowser   | Diane  | dog     | m    | 1998-08-31 | 1995-07-29 |
| Chirpy   | Gwen   | bird    | f    | 1998-09-11 | NULL       |
| Whistler | Gwen   | bird    | NULL | 1997-12-09 | NULL       |
| Slim     | Benny  | snake   | m    | 1996-04-29 | NULL       |
| Puffball | Diane  | hamster | f    | 1999-03-30 | NULL       |
+----------+--------+---------+------+------------+------------+
</PRE>

<P>
Использовать <code>SELECT</code> таким образом удобно, когда нужно просмотреть всю
таблицу, например, после того, как в нее была загружена первая порция
данных. Как часто случается, в выведенных на экран данных сразу можно
увидеть ошибку в таблице: <code>Bowser</code>, оказывается, успел умереть еще до того,
как родился! Заглянув в его родословную обнаруживаем, что пес родился в
1989, а не в 1998 году.

</P>
<P>
Исправить ошибку можно как минимум двумя способами:

</P>

<UL>
<LI>

Отредактировать файл pet.txt, затем очистить таблицу и снова заполнить
ее командами DELETE и LOAD DATA:


<PRE>
mysql&#62; SET AUTOCOMMIT=1;  # Used for quick re-create of the table
mysql&#62; DELETE FROM pet;
mysql&#62; LOAD DATA LOCAL INFILE "pet.txt" INTO TABLE pet;
</PRE>

Однако в таком случае придется снова ввести запись о Puffball.

<LI>

Исправить только ошибочно введенные данные при помощи команды <code>UPDATE</code>:


<PRE>
mysql&#62; UPDATE pet SET birth = "1989-08-31" WHERE name = "Bowser";
</PRE>

</UL>

<P>
Как видно из приведенного выше примера, загрузить всю таблицу сразу очень
просто. Но на практике обычно этого не требуется, особенно когда таблица
достигает значительных размеров. Чаще всего нужно просто ответить на
какой-нибудь вопрос, для чего необходимо ввести ограничения, указывающие,
какая же информация вам нужна. Давайте рассмотрим несколько запросов с
точки зрения вопросов, на которые они отвечают.

</P>



<H4><A NAME="Selecting_rows" HREF="manual.ru_toc.html#Selecting_rows">3.3.4.2  Выборка определенных строк</A></H4>

<P>
<A NAME="IDX387"></A>
<A NAME="IDX388"></A>

</P>
<P>
Из таблицы можно выбрать и только нужные строки. Например, если вы хотите
проверить правильность внесенных в дату рождения собаки Bowser изменений,
соответствующую запись можно получить следующим способом:

</P>

<PRE>
mysql&#62; SELECT * FROM pet WHERE name = "Bowser";
+--------+-------+---------+------+------------+------------+
| name   | owner | species | sex  | birth      | death      |
+--------+-------+---------+------+------------+------------+
| Bowser | Diane | dog     | m    | 1989-08-31 | 1995-07-29 |
+--------+-------+---------+------+------------+------------+
</PRE>

<P>
Теперь видно, что год рождения теперь записан правильно -1989, а не 1998.

</P>
<P>
В операции сравнения строк обычно не учитывается регистр символов, так что
имя можно записать как <code>"bowser"</code>, <code>"BOWSER"</code> и т.п. Результаты запросов будут
идентичными.

</P>
<P>
В условиях может указываться любой из столбцов, а не только <code>name</code>. Если,
например, вам нужно узнать, какие их животных родились после 1998 года, в
условие вводится значение столбца <code>birth</code>:

</P>

<PRE>
mysql&#62; SELECT * FROM pet WHERE birth &#62;= "1998-1-1";
+----------+-------+---------+------+------------+-------+
| name     | owner | species | sex  | birth      | death |
+----------+-------+---------+------+------------+-------+
| Chirpy   | Gwen  | bird    | f    | 1998-09-11 | NULL  |
| Puffball | Diane | hamster | f    | 1999-03-30 | NULL  |
+----------+-------+---------+------+------------+-------+
</PRE>

<P>
Условия можно и комбинировать, например для того, чтобы выделить всех
собак женского пола:

</P>

<PRE>
mysql&#62; SELECT * FROM pet WHERE species = "dog" AND sex = "f";
+-------+--------+---------+------+------------+-------+
| name  | owner  | species | sex  | birth      | death |
+-------+--------+---------+------+------------+-------+
| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |
+-------+--------+---------+------+------------+-------+
</PRE>

<P>
В предыдущем запросе использован оператор <code>AND</code>. Существует еще и оператор
<code>OR</code>:

</P>

<PRE>
mysql&#62; SELECT * FROM pet WHERE species = "snake" OR species = "bird";
+----------+-------+---------+------+------------+-------+
| name     | owner | species | sex  | birth      | death |
+----------+-------+---------+------+------------+-------+
| Chirpy   | Gwen  | bird    | f    | 1998-09-11 | NULL  |
| Whistler | Gwen  | bird    | NULL | 1997-12-09 | NULL  |
| Slim     | Benny | snake   | m    | 1996-04-29 | NULL  |
+----------+-------+---------+------+------------+-------+
</PRE>

<P>
Операторы <code>AND</code> и <code>OR</code> можно использовать совместно. В таком случае с помощью
скобок можно указать порядок группировки условий:

</P>

<PRE>
mysql&#62; SELECT * FROM pet WHERE (species = "cat" AND sex = "m")
    -&#62; OR (species = "dog" AND sex = "f");
+-------+--------+---------+------+------------+-------+
| name  | owner  | species | sex  | birth      | death |
+-------+--------+---------+------+------------+-------+
| Claws | Gwen   | cat     | m    | 1994-03-17 | NULL  |
| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |
+-------+--------+---------+------+------------+-------+
</PRE>



<H4><A NAME="Selecting_columns" HREF="manual.ru_toc.html#Selecting_columns">3.3.4.3  Выборка определенных столбцов</A></H4>

<P>
<A NAME="IDX389"></A>
<A NAME="IDX390"></A>

</P>
<P>
Если строки целиком вам не нужны, достаточно просто перечислить имена
нужных столбцов, разделив их запятыми. Например, если вы хотите узнать,
когда родились животные, выберите столбцы с именами и датами рождения:

</P>

<PRE>
mysql&#62; SELECT name, birth FROM pet;
+----------+------------+
| name     | birth      |
+----------+------------+
| Fluffy   | 1993-02-04 |
| Claws    | 1994-03-17 |
| Buffy    | 1989-05-13 |
| Fang     | 1990-08-27 |
| Bowser   | 1989-08-31 |
| Chirpy   | 1998-09-11 |
| Whistler | 1997-12-09 |
| Slim     | 1996-04-29 |
| Puffball | 1999-03-30 |
+----------+------------+
</PRE>

<P>
Получить имена владельцев животных можно с помощью следующего запроса:

</P>

<PRE>
mysql&#62; SELECT owner FROM pet;
+--------+
| owner  |
+--------+
| Harold |
| Gwen   |
| Harold |
| Benny  |
| Diane  |
| Gwen   |
| Gwen   |
| Benny  |
| Diane  |
+--------+
</PRE>

<P>
<A NAME="IDX391"></A>
Однако этот запрос просто загружает поля с именем владельца из каждой
записи, а некоторые имена встречаются более одного раза. Сократить
количество выводимых строк можно, воспользовавшись ключевым словом
<code>DISTINCT</code> - тогда будут выводиться только уникальные записи:

</P>


<PRE>
mysql&#62; SELECT DISTINCT owner FROM pet;
+--------+
| owner  |
+--------+
| Benny  |
| Diane  |
| Gwen   |
| Harold |
+--------+
</PRE>

<P>
При помощи выражения <code>WHERE</code> можно комбинировать выбор строк и столбцов.
Например для того, чтобы загрузить даты рождения только кошек и собак,
можно воспользоваться следующим запросом:

</P>

<PRE>
mysql&#62; SELECT name, species, birth FROM pet
    -&#62; WHERE species = "dog" OR species = "cat";
+--------+---------+------------+
| name   | species | birth      |
+--------+---------+------------+
| Fluffy | cat     | 1993-02-04 |
| Claws  | cat     | 1994-03-17 |
| Buffy  | dog     | 1989-05-13 |
| Fang   | dog     | 1990-08-27 |
| Bowser | dog     | 1989-08-31 |
+--------+---------+------------+
</PRE>



<H4><A NAME="Sorting_rows" HREF="manual.ru_toc.html#Sorting_rows">3.3.4.4  Сортировка строк</A></H4>

<P>
<A NAME="IDX392"></A>
<A NAME="IDX393"></A>
<A NAME="IDX394"></A>
<A NAME="IDX395"></A>

</P>
<P>
Вы уже, наверное, заметили, что результаты, выдававшиеся запросами из
предыдущих примеров, выводились без какой-либо сортировки. Но ведь часто
разобраться в результатах легче, если они отсортированы. Для этого
используется выражение <code>ORDER BY</code>.

</P>
<P>
Так выглядят даты рождения животных в отсортированном виде:

</P>

<PRE>
mysql&#62; SELECT name, birth FROM pet ORDER BY birth;
+----------+------------+
| name     | birth      |
+----------+------------+
| Buffy    | 1989-05-13 |
| Bowser   | 1989-08-31 |
| Fang     | 1990-08-27 |
| Fluffy   | 1993-02-04 |
| Claws    | 1994-03-17 |
| Slim     | 1996-04-29 |
| Whistler | 1997-12-09 |
| Chirpy   | 1998-09-11 |
| Puffball | 1999-03-30 |
+----------+------------+
</PRE>

<P>
Над столбцами с символьными значениями операция сортировки - как и все
другие операции сравнения - обычно проводится без учета регистра символов.
Это значит, что порядок расположения столбцов, совпадающих во всем, кроме
регистра символов, относительно друг друга будет не определен. Провести
сортировку с учетом регистра символов можно при помощи команды <code>BINARY</code>:
<code>ORDER BY BINARY(поле)</code>.

</P>
<P>
Для сортировки в обратном порядке к имени столбца следует добавить
ключевое слово <code>DESC</code> (по убыванию):

</P>

<PRE>
mysql&#62; SELECT name, birth FROM pet ORDER BY birth DESC;
+----------+------------+
| name     | birth      |
+----------+------------+
| Puffball | 1999-03-30 |
| Chirpy   | 1998-09-11 |
| Whistler | 1997-12-09 |
| Slim     | 1996-04-29 |
| Claws    | 1994-03-17 |
| Fluffy   | 1993-02-04 |
| Fang     | 1990-08-27 |
| Bowser   | 1989-08-31 |
| Buffy    | 1989-05-13 |
+----------+------------+
</PRE>

<P>
Сортировку можно проводить по нескольким столбцам сразу. Например для
того, чтобы отсортировать таблицу сначала по типу животного, потом - по
дате рождения и затем - расположить наиболее молодых животных определенного
типа в начале списка, выполните следующий запрос:

</P>

<PRE>
mysql&#62; SELECT name, species, birth FROM pet ORDER BY species, birth DESC;
+----------+---------+------------+
| name     | species | birth      |
+----------+---------+------------+
| Chirpy   | bird    | 1998-09-11 |
| Whistler | bird    | 1997-12-09 |
| Claws    | cat     | 1994-03-17 |
| Fluffy   | cat     | 1993-02-04 |
| Fang     | dog     | 1990-08-27 |
| Bowser   | dog     | 1989-08-31 |
| Buffy    | dog     | 1989-05-13 |
| Puffball | hamster | 1999-03-30 |
| Slim     | snake   | 1996-04-29 |
+----------+---------+------------+
</PRE>

<P>
Обратите внимание: действие ключевого слова <code>DESC</code> распространяется только
на тот столбец, имя которого располагается в запросе прямо перед этим
словом (в данном случае - <code>birth</code>); значения поля species по-прежнему
отсортированы в возрастающем порядке.

</P>



<H4><A NAME="Date_calculations" HREF="manual.ru_toc.html#Date_calculations">3.3.4.5  Вычисление  дат</A></H4>

<P>
<A NAME="IDX396"></A>
<A NAME="IDX397"></A>
<A NAME="IDX398"></A>
<A NAME="IDX399"></A>

</P>
<P>
В MySQL имеется несколько функций, реализующих арифметические операции над
датами. Эти функции позволяют, например, вычислять возраст или получать
части даты.

</P>
<P>
Определить возраст любого из животных в базе можно, если вычислить разницу
между текущим годом и годом его рождения, а из результата вычесть единицу,
если текущий день находится к началу календаря ближе, нежели день рождения
животного. Приведенный ниже запрос выводит дату рождения каждого
животного, его возраст и текущую дату.

</P>

<PRE>
mysql&#62; SELECT name, birth, CURRENT_DATE,
    -&#62; (YEAR(CURRENT_DATE)-YEAR(birth))
    -&#62; - (RIGHT(CURRENT_DATE,5)&#60;RIGHT(birth,5))
    -&#62; AS age
    -&#62; FROM pet;
+----------+------------+--------------+------+
| name     | birth      | CURRENT_DATE | age  |
+----------+------------+--------------+------+
| Fluffy   | 1993-02-04 | 2001-08-29   |    8 |
| Claws    | 1994-03-17 | 2001-08-29   |    7 |
| Buffy    | 1989-05-13 | 2001-08-29   |   12 |
| Fang     | 1990-08-27 | 2001-08-29   |   11 |
| Bowser   | 1989-08-31 | 2001-08-29   |   11 |
| Chirpy   | 1998-09-11 | 2001-08-29   |    2 |
| Whistler | 1997-12-09 | 2001-08-29   |    3 |
| Slim     | 1996-04-29 | 2001-08-29   |    5 |
| Puffball | 1999-03-30 | 2001-08-29   |    2 |
+----------+------------+--------------+------+
</PRE>

<P>
В этом примере функция <code>YEAR()</code> выделяет из даты год, а <code>RIGHT()</code> - пять
крайних справа символов, представляющих календарный день (MM-DD). Часть
выражения, сравнивающая даты, выдает 1 или 0, что позволяет уменьшить
результат на единицу, если текущий день (<code>CURRENT_DATE</code>) находится к началу
календаря ближе, нежели день рождения животного. Все выражение смотрится
несколько неуклюже, поэтому вместо него в заголовке соответствующего
столбца результатов выводится псевдоним (<code>age</code> - "возраст").

</P>
<P>
Запрос неплохо работает, но разобраться в результатах было бы проще, если
бы строки располагались в определенном порядке. Этого можно достичь,
добавив в запрос выражение <code>ORDER BY</code> name и отсортировав таким образом
результаты по имени:

</P>

<PRE>
mysql&#62; SELECT name, birth, CURRENT_DATE,
    -&#62; (YEAR(CURRENT_DATE)-YEAR(birth))
    -&#62; - (RIGHT(CURRENT_DATE,5)&#60;RIGHT(birth,5))
    -&#62; AS age
    -&#62; FROM pet ORDER BY name;
+----------+------------+--------------+------+
| name     | birth      | CURRENT_DATE | age  |
+----------+------------+--------------+------+
| Bowser   | 1989-08-31 | 2001-08-29   |   11 |
| Buffy    | 1989-05-13 | 2001-08-29   |   12 |
| Chirpy   | 1998-09-11 | 2001-08-29   |    2 |
| Claws    | 1994-03-17 | 2001-08-29   |    7 |
| Fang     | 1990-08-27 | 2001-08-29   |   11 |
| Fluffy   | 1993-02-04 | 2001-08-29   |    8 |
| Puffball | 1999-03-30 | 2001-08-29   |    2 |
| Slim     | 1996-04-29 | 2001-08-29   |    5 |
| Whistler | 1997-12-09 | 2001-08-29   |    3 |
+----------+------------+--------------+------+
</PRE>

<P>
Отсортировать результаты по возрасту также можно при помощи выражения
<code>ORDER BY</code>:

</P>

<PRE>
mysql&#62; SELECT name, birth, CURRENT_DATE,
    -&#62; (YEAR(CURRENT_DATE)-YEAR(birth))
    -&#62; - (RIGHT(CURRENT_DATE,5)&#60;RIGHT(birth,5))
    -&#62; AS age
    -&#62; FROM pet ORDER BY age;
+----------+------------+--------------+------+
| name     | birth      | CURRENT_DATE | age  |
+----------+------------+--------------+------+
| Chirpy   | 1998-09-11 | 2001-08-29   |    2 |
| Puffball | 1999-03-30 | 2001-08-29   |    2 |
| Whistler | 1997-12-09 | 2001-08-29   |    3 |
| Slim     | 1996-04-29 | 2001-08-29   |    5 |
| Claws    | 1994-03-17 | 2001-08-29   |    7 |
| Fluffy   | 1993-02-04 | 2001-08-29   |    8 |
| Fang     | 1990-08-27 | 2001-08-29   |   11 |
| Bowser   | 1989-08-31 | 2001-08-29   |   11 |
| Buffy    | 1989-05-13 | 2001-08-29   |   12 |
+----------+------------+--------------+------+
</PRE>

<P>
подобный же запрос поможет определить возраст, которого достигли умершие
животные на момент смерти. Выделить умерших животных можно, проверив
значение поля <code>death</code> на предмет равенства <code>NULL</code>. Затем для записей, значения
поля <code>death</code> которых не равно <code>NULL</code>, можно вычислить разницу между датами
смерти и рождения:

</P>


<PRE>
mysql&#62; SELECT name, birth, death,
    -&#62; (YEAR(death)-YEAR(birth)) - (RIGHT(death,5)&#60;RIGHT(birth,5))
    -&#62; AS age
    -&#62; FROM pet WHERE death IS NOT NULL ORDER BY age;
+--------+------------+------------+------+
| name   | birth      | death      | age  |
+--------+------------+------------+------+
| Bowser | 1989-08-31 | 1995-07-29 |    5 |
+--------+------------+------------+------+
</PRE>

<P>
В этом запросе используется выражение <code>death IS NOT NULL</code>, а не death &#60;&#62;
<code>NULL</code>, так как <code>NULL</code> - особое значение (более подробные пояснения приведены
в разделе see section <A HREF="manual.ru.html#Working_with_NULL">3.3.4.6  Работа с значениями NULL</A>).

</P>
<P>
А как поступать, если потребуется определить, дни рождения каких животных
наступят в следующем месяце? Для таких расчетов день и год значения не
имеют; из столбца, содержащего дату рождения, нас интересует только месяц.
В MySQL предусмотрено несколько функций для получения частей дат - <code>YEAR()</code>,
<code>MONTH()</code>, и <code>DAYOFMONTH()</code>. В данном случае нам подойдет функция <code>MONTH()</code>.
Увидеть работу этой функции можно с помощью простого запроса, выводящего
дату рождения <code>birth</code> и <code>MONTH(birth)</code>:

</P>

<PRE>
mysql&#62; SELECT name, birth, MONTH(birth) FROM pet;
+----------+------------+--------------+
| name     | birth      | MONTH(birth) |
+----------+------------+--------------+
| Fluffy   | 1993-02-04 |            2 |
| Claws    | 1994-03-17 |            3 |
| Buffy    | 1989-05-13 |            5 |
| Fang     | 1990-08-27 |            8 |
| Bowser   | 1989-08-31 |            8 |
| Chirpy   | 1998-09-11 |            9 |
| Whistler | 1997-12-09 |           12 |
| Slim     | 1996-04-29 |            4 |
| Puffball | 1999-03-30 |            3 |
+----------+------------+--------------+
</PRE>

<P>
Найти животных, дни рождения которых наступят в следующем месяце, тоже
несложно. Предположим, что сейчас на дворе апрель. Тогда номер текущего
месяца - 4, а искать надо животных, родившихся в мае (5-м месяце), таким
образом:

</P>

<PRE>
mysql&#62; SELECT name, birth FROM pet WHERE MONTH(birth) = 5;
+-------+------------+
| name  | birth      |
+-------+------------+
| Buffy | 1989-05-13 |
+-------+------------+
</PRE>

<P>
Конечно, в декабре возникают некоторые осложнения. Если просто добавить
единицу к номеру месяца (12) и поискать животных, родившихся в тринадцатом
месяце, найти что-нибудь вряд ли удастся. Вместо этого нужно искать
животных, родившихся в январе (1-м месяце).

</P>
<P>
Можно даже написать небольшой запрос, который будет работать вне
зависимости от того, какой нынче месяц. Функция <code>DATE_ADD()</code> позволяет
прибавить к дате некоторый интервал времени. Если добавить к значению,
возвращаемому функцией <code>NOW()</code>, месяц, а затем извлечь из получившейся даты
номер месяца при помощи функции <code>MONTH()</code>, мы получим именно тот месяц,
который нам нужен:

</P>

<PRE>
mysql&#62; SELECT name, birth FROM pet
    -&#62; WHERE MONTH(birth) = MONTH(DATE_ADD(NOW(), INTERVAL 1 MONTH));
</PRE>

<P>
Ту же задачу можно решить и другим методом - для этого нужно прибавить
единицу к номеру месяца, следующего за текущим (воспользовавшись функцией
расчета по модулю (MOD) для перехода к 0, если номер текущего месяца равен
12):

</P>

<PRE>
mysql&#62; SELECT name, birth FROM pet
    -&#62; WHERE MONTH(birth) = MOD(MONTH(NOW()), 12) + 1;
</PRE>

<P>
Функция <code>MONTH</code> возвращает число от 1 до 12, а выражение <code>MOD(число,12)</code> -
число от 0 до 11. Поэтому операцию сложения нужно проводить после <code>MOD()</code>,
иначе результат перепрыгнет с ноября (11) сразу на январь (1).

</P>


<H4><A NAME="Working_with_NULL" HREF="manual.ru_toc.html#Working_with_NULL">3.3.4.6  Работа с значениями NULL</A></H4>

<P>
<A NAME="IDX400"></A>
<A NAME="IDX401"></A>

</P>
<P>
К <code>NULL</code>-значениям нужно привыкнуть. По идее, <code>NULL</code> обозначает отсутствующее
или неизвестное значение и обрабатывается отличным от других значений
образом. Проверить значение на равенство <code>NULL</code> с помощью обычных
арифметических операторов сравнения (=, &#60; или &#60;&#62;) нельзя. Это отлично
иллюстрирует следующий запрос:

</P>

<PRE>
mysql&#62; SELECT 1 = NULL, 1 &#60;&#62; NULL, 1 &#60; NULL, 1 &#62; NULL;
+----------+-----------+----------+----------+
| 1 = NULL | 1 &#60;&#62; NULL | 1 &#60; NULL | 1 &#62; NULL |
+----------+-----------+----------+----------+
|     NULL |      NULL |     NULL |     NULL |
+----------+-----------+----------+----------+
</PRE>

<P>
Очевидно, что от таких сравнений значащих результатов ожидать нечего.
Вместо этого нужно пользоваться операторами <code>IS NULL</code> и <code>IS NOT NULL</code>:

</P>

<PRE>
mysql&#62; SELECT 1 IS NULL, 1 IS NOT NULL;
+-----------+---------------+
| 1 IS NULL | 1 IS NOT NULL |
+-----------+---------------+
|         0 |             1 |
+-----------+---------------+
</PRE>

<P>
Отметим: в MySQL 0 или <code>NULL</code> приравнивается к логическому false, а все остальное - к
true. По умолчанию значение "истина" для булевого оператора равно 1.

</P>
<P>
Именно из-за того, что при работе с <code>NULL</code> действуют особые правила, в
предыдущем разделе для поиска умерших животных использовалось выражение
<code>death IS NOT NULL</code>, а не <code>death &#60;&#62; NULL</code>.

</P>
<P>
Два <code>NULL</code>-значения считаются одинаковыми в <code>GROUP BY</code>.

</P>
<P>
При выполнении <code>ORDER BY</code>, <code>NULL</code>-значения идут в первую очередь если вы выполняете
<code>ORDER ... ASC</code> и в последнюю - если <code>ORDER BY ... DESC</code>.

</P>
<P>
Обратите внимание, что в MySQL 4.0.2 - 4.0.10, <code>NULL</code>-значения всегда возвращались в первую
очередь, вне зависимости от сортировки. 

</P>


<H4><A NAME="Pattern_matching" HREF="manual.ru_toc.html#Pattern_matching">3.3.4.7  Сравнение по шаблонам</A></H4>

<P>
<A NAME="IDX402"></A>
<A NAME="IDX403"></A>
<A NAME="IDX404"></A>

</P>
<P>
В MySQL реализовано стандартное для SQL сравнение по шаблонам, а также
особый тип такого сравнения - он основан на использовании выражений,
подобных применяющимся в служебных программах Unix (таких, как vi, grep и
sed).

</P>
<P>
В SQL при сравнении по шаблону символ <samp>`_'</samp> обозначает любой одиночный
символ, а <samp>`%'</samp> - определенное количество символов (включая ноль символов).
В MySQL в SQL-шаблонах по умолчанию не учитывается регистр символов. При
работе с шаблонами SQL использование операторов <code>=</code> или <code>&#60;&#62;</code> не допускается,
вместо этого применяются операторы сравнения <code>LIKE</code> или <code>NOT LIKE</code>.

</P>
<P>
Найти все имена, начинающиеся с <samp>`b'</samp>, можно следующим образом:

</P>

<PRE>
mysql&#62; SELECT * FROM pet WHERE name LIKE "b%";
+--------+--------+---------+------+------------+------------+
| name   | owner  | species | sex  | birth      | death      |
+--------+--------+---------+------+------------+------------+
| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL       |
| Bowser | Diane  | dog     | m    | 1989-08-31 | 1995-07-29 |
+--------+--------+---------+------+------------+------------+
</PRE>

<P>
Найти все имена, заканчивающиеся на <samp>`fy'</samp>, можно следующим образом:

</P>

<PRE>
mysql&#62; SELECT * FROM pet WHERE name LIKE "%fy";
+--------+--------+---------+------+------------+-------+
| name   | owner  | species | sex  | birth      | death |
+--------+--------+---------+------+------------+-------+
| Fluffy | Harold | cat     | f    | 1993-02-04 | NULL  |
| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL  |
+--------+--------+---------+------+------------+-------+
</PRE>

<P>
Найти все имена, содержащие <samp>`w'</samp>, можно следующим образом:

</P>

<PRE>
mysql&#62; SELECT * FROM pet WHERE name LIKE "%w%";
+----------+-------+---------+------+------------+------------+
| name     | owner | species | sex  | birth      | death      |
+----------+-------+---------+------+------------+------------+
| Claws    | Gwen  | cat     | m    | 1994-03-17 | NULL       |
| Bowser   | Diane | dog     | m    | 1989-08-31 | 1995-07-29 |
| Whistler | Gwen  | bird    | NULL | 1997-12-09 | NULL       |
+----------+-------+---------+------+------------+------------+
</PRE>

<P>
Найти все имена, содержащие ровно пять символов, можно при помощи
шаблонного символа <samp>`_'</samp>:

</P>

<PRE>
mysql&#62; SELECT * FROM pet WHERE name LIKE "_____";
+-------+--------+---------+------+------------+-------+
| name  | owner  | species | sex  | birth      | death |
+-------+--------+---------+------+------------+-------+
| Claws | Gwen   | cat     | m    | 1994-03-17 | NULL  |
| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |
+-------+--------+---------+------+------------+-------+
</PRE>

<P>
Во втором типе шаблонов, предусмотренных в MySQL, используются расширенные
регулярные выражения. При поиске совпадений на основе такого шаблона
шаблоном нужно пользоваться операторами <code>REGEXP</code> и <code>NOT REGEXP</code> (или их
синонимами - <code>RLIKE</code> и <code>NOT RLIKE</code>).

</P>
<P>
Ниже приведены некоторые характеристики расширенных регулярных выражений:

</P>

<UL>
<LI>

<samp>`.'</samp> обозначает любой символ.

<LI>

Класс символов <samp>`[...]'</samp> обозначает любой из символов в скобках.
Например, <samp>`[abc]'</samp> обозначает <samp>`a'</samp>, <samp>`b'</samp> или <samp>`c'</samp>. Набор символов можно
обозначить с помощью дефиса. <samp>`[a-z]'</samp> обозначает любую букву нижнего
регистра, а <samp>`[0-9]'</samp> - любую цифру.

<LI>

<samp>`*'</samp> обозначает ноль или более экземпляров символа, стоящего перед ним.
Например, <samp>`x*'</samp> обозначает любое количество символов <samp>`x'</samp>, <samp>`[0-9]*'</samp>
обозначает любое количество цифр, а <samp>`.*'</samp> - любое количество любых
символов.

<LI>

Для шаблона выдается совпадение, если поисковый контекст обнаружен в
любой из частей значения, в котором производится поиск (для шаблонов
SQL совпадение выдается только в случае, если совпадает все значение).

<LI>

``Закрепить'' шаблон так, чтобы проверять совпадения с началом или
концом значения можно с помощью символов <samp>`^'</samp> (начало) или <samp>`$'</samp> (конец),
которые располагаются в начале или в конце шаблона соответственно.
</UL>

<P>
Чтобы продемонстрировать работу регулярных выражений, приведенные выше
запросы <code>LIKE</code> здесь переписаны с использованием <code>REGEXP</code>.

</P>
<P>
Найти все имена, начинающиеся с <samp>`b'</samp>, можно при помощи символа <samp>`^'</samp>,
привязывающего шаблон к началу имени:

</P>

<PRE>
mysql&#62; SELECT * FROM pet WHERE name REGEXP "^b";
+--------+--------+---------+------+------------+------------+
| name   | owner  | species | sex  | birth      | death      |
+--------+--------+---------+------+------------+------------+
| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL       |
| Bowser | Diane  | dog     | m    | 1989-08-31 | 1995-07-29 |
+--------+--------+---------+------+------------+------------+
</PRE>

<P>
В версиях MySQL до 3.23.4 <code>REGEXP</code> учитывает регистр символов, и приведенный
запрос не возвратит никаких результатов. Для поиска символов <samp>`b'</samp> верхнего
или нижнего регистра воспользуйтесь следующим запросом:

</P>

<PRE>
mysql&#62; SELECT * FROM pet WHERE name REGEXP "^[bB]";
</PRE>

<P>
Начиная с версии MySQL 3.23.4, заставить <code>REGEXP</code> учитывать регистр символов
можно с помощью ключевого слова <code>BINARY</code>. В этом запросе положительный
результат поиска будет получен только при обнаружении символа 'b' нижнего
регистра в начале имени:

</P>

<PRE>
mysql&#62; SELECT * FROM pet WHERE name REGEXP BINARY "^b";
</PRE>

<P>
Найти все имена, заканчивающиеся на <samp>`fy'</samp>, можно при помощи символа <samp>`$'</samp>,
привязывающего шаблон к концу имени:

</P>

<PRE>
mysql&#62; SELECT * FROM pet WHERE name REGEXP "fy$";
+--------+--------+---------+------+------------+-------+
| name   | owner  | species | sex  | birth      | death |
+--------+--------+---------+------+------------+-------+
| Fluffy | Harold | cat     | f    | 1993-02-04 | NULL  |
| Buffy  | Harold | dog     | f    | 1989-05-13 | NULL  |
+--------+--------+---------+------+------------+-------+
</PRE>

<P>
Найти все имена, содержащие символ <samp>`w'</samp> любого регистра, можно так:

</P>

<PRE>
mysql&#62; SELECT * FROM pet WHERE name REGEXP "w";
+----------+-------+---------+------+------------+------------+
| name     | owner | species | sex  | birth      | death      |
+----------+-------+---------+------+------------+------------+
| Claws    | Gwen  | cat     | m    | 1994-03-17 | NULL       |
| Bowser   | Diane | dog     | m    | 1989-08-31 | 1995-07-29 |
| Whistler | Gwen  | bird    | NULL | 1997-12-09 | NULL       |
+----------+-------+---------+------+------------+------------+
</PRE>

<P>
Поскольку регулярное выражение выдает положительный результат при
совпадении шаблона с любым фрагментом значения, в приведенном выше примере
привязывать поиск к любому из концов имени для сравнения полного значения
с шаблоном, как это пришлось бы делать для шаблона SQL, не нужно.

</P>
<P>
Найти все имена, содержащие ровно пять символов, можно, если привязать
поиск к началу и концу имени с помощью символов <samp>`^'</samp> и <samp>`$'</samp> и поставить пять
символов <samp>`.'</samp> между ними:

</P>

<PRE>
mysql&#62; SELECT * FROM pet WHERE name REGEXP "^.....$";
+-------+--------+---------+------+------------+-------+
| name  | owner  | species | sex  | birth      | death |
+-------+--------+---------+------+------------+-------+
| Claws | Gwen   | cat     | m    | 1994-03-17 | NULL  |
| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |
+-------+--------+---------+------+------------+-------+
</PRE>

<P>
Предыдущий запрос можно записать и при помощи оператора <samp>`{n}'</samp>
(``повторить-<code>n</code>-раз''):

</P>

<PRE>
mysql&#62; SELECT * FROM pet WHERE name REGEXP "^.{5}$";
+-------+--------+---------+------+------------+-------+
| name  | owner  | species | sex  | birth      | death |
+-------+--------+---------+------+------------+-------+
| Claws | Gwen   | cat     | m    | 1994-03-17 | NULL  |
| Buffy | Harold | dog     | f    | 1989-05-13 | NULL  |
+-------+--------+---------+------+------------+-------+
</PRE>



<H4><A NAME="Counting_rows" HREF="manual.ru_toc.html#Counting_rows">3.3.4.8  Подсчет строк</A></H4>

<P>
<A NAME="IDX405"></A>
<A NAME="IDX406"></A>
<A NAME="IDX407"></A>

</P>
<P>
Базы данных часто используются для получения ответа на вопросы типа:
``как часто данные определенного типа встречаются в таблице?'' Вам,
например, может понадобиться узнать общее количество животных, или то,
сколько животных имеется у каждого из владельцев, или провести
статистические исследования на базе хранящейся информации.

</P>
<P>
Процедура подсчета количества животных в сущности идентична подсчету
количества строк в таблице, так как на каждое животное приходится по одной
записи. Функция <code>COUNT()</code> подсчитает количество непустых результатов, и с ее
помощью можно составить следующий запрос для определения числа животных:

</P>


<PRE>
mysql&#62; SELECT COUNT(*) FROM pet;
+----------+
| COUNT(*) |
+----------+
|        9 |
+----------+
</PRE>

<P>
Ранее мы уже извлекали из таблицы имена владельцев животных. При помощи
функции <code>COUNT()</code> можно узнать, сколько животных принадлежит каждому из
владельцев:

</P>

<PRE>
mysql&#62; SELECT owner, COUNT(*) FROM pet GROUP BY owner;
+--------+----------+
| owner  | COUNT(*) |
+--------+----------+
| Benny  |        2 |
| Diane  |        2 |
| Gwen   |        3 |
| Harold |        2 |
+--------+----------+
</PRE>

<P>
Обратите внимание на использование команды <code>GROUP BY</code> для объединения всех
записей по каждому из владельцев. Без этой команды запрос выдал бы только
сообщение об ошибке:

</P>

<PRE>
mysql&#62; SELECT owner, COUNT(owner) FROM pet;
ERROR 1140 at line 1: Mixing of GROUP columns (MIN(),MAX(),COUNT()...)
with no GROUP columns is illegal if there is no GROUP BY clause
</PRE>

<P>
Команды <code>COUNT()</code> и <code>GROUP BY</code> очень помогают характеризовать данные
различными способами. В примерах, приведенных ниже, вы увидите и другие
способы проведения статистических подсчетов.

</P>
<P>
Количество животных каждого вида:

</P>

<PRE>
mysql&#62; SELECT species, COUNT(*) FROM pet GROUP BY species;
+---------+----------+
| species | COUNT(*) |
+---------+----------+
| bird    |        2 |
| cat     |        2 |
| dog     |        3 |
| hamster |        1 |
| snake   |        1 |
+---------+----------+
</PRE>

<P>
Количество животных каждого пола:

</P>

<PRE>
mysql&#62; SELECT sex, COUNT(*) FROM pet GROUP BY sex;
+------+----------+
| sex  | COUNT(*) |
+------+----------+
| NULL |        1 |
| f    |        4 |
| m    |        4 |
+------+----------+
</PRE>

<P>
(в этой таблице результатов <code>NULL</code> обозначает, что пол животного неизвестен)

</P>
<P>
Количество животных каждого вида с учетом пола:

</P>

<PRE>
mysql&#62; SELECT species, sex, COUNT(*) FROM pet GROUP BY species, sex;
+---------+------+----------+
| species | sex  | COUNT(*) |
+---------+------+----------+
| bird    | NULL |        1 |
| bird    | f    |        1 |
| cat     | f    |        1 |
| cat     | m    |        1 |
| dog     | f    |        1 |
| dog     | m    |        2 |
| hamster | f    |        1 |
| snake   | m    |        1 |
+---------+------+----------+
</PRE>

<P>
При использовании функции <code>COUNT()</code> вовсе не обязательно загружать всю
таблицу. Например, предыдущий запрос, в котором учитываются только кошки и
собаки, выглядит следующим образом:

</P>

<PRE>
mysql&#62; SELECT species, sex, COUNT(*) FROM pet
    -&#62; WHERE species = "dog" OR species = "cat"
    -&#62; GROUP BY species, sex;
+---------+------+----------+
| species | sex  | COUNT(*) |
+---------+------+----------+
| cat     | f    |        1 |
| cat     | m    |        1 |
| dog     | f    |        1 |
| dog     | m    |        2 |
+---------+------+----------+
</PRE>

<P>
Можно узнать и количество животных каждого пола с учетом только тех
экземпляров, пол которых известен:

</P>

<PRE>
mysql&#62; SELECT species, sex, COUNT(*) FROM pet
    -&#62; WHERE sex IS NOT NULL
    -&#62; GROUP BY species, sex;
+---------+------+----------+
| species | sex  | COUNT(*) |
+---------+------+----------+
| bird    | f    |        1 |
| cat     | f    |        1 |
| cat     | m    |        1 |
| dog     | f    |        1 |
| dog     | m    |        2 |
| hamster | f    |        1 |
| snake   | m    |        1 |
+---------+------+----------+
</PRE>



<H4><A NAME="Multiple_tables" HREF="manual.ru_toc.html#Multiple_tables">3.3.4.9  Использование нескольких таблиц</A></H4>

<P>
<A NAME="IDX408"></A>

</P>
<P>
В таблице <code>pet</code> хранятся только основные данные о животных. Если же нужно
держать в базе какую-либо дополнительную информацию о них (скажем, записи
о событиях наподобие посещения ветеринара или рождения потомства),
понадобится еще одна таблица. Давайте определимся с ее структурой. Эта
таблица должна содержать:

</P>

<UL>
<LI>

имена животных, чтобы не путаться с тем, к какому животному относится
какое событие

<LI>

дата события

<LI>

поле для описания события

<LI>

поле, отражающее тип события, для того, чтобы можно было распределить
их по категориям
</UL>

<P>
С учетом всех приведенных выше требований можно составить примерно такую
команду <code>CREATE TABLE</code>:

</P>

<PRE>
mysql&#62; CREATE TABLE event (name VARCHAR(20), date DATE,
    -&#62; type VARCHAR(15), remark VARCHAR(255));
</PRE>

<P>
Как и в случае с таблицей <code>pet</code>, начальные данные в таблицу проще всего
загрузить, создав текстовый файл с информацией, разделенной символами
табуляции:

</P>
<TABLE BORDER>
<TR><TD><strong>name</strong> </TD><TD> <strong>date</strong> </TD><TD> <strong>type</strong> </TD><TD> <strong>remark</strong>
</TD></TR>
<TR><TD>Fluffy </TD><TD> 1995-05-15 </TD><TD> litter </TD><TD> 4 kittens, 3 female, 1 male
</TD></TR>
<TR><TD>Buffy </TD><TD> 1993-06-23 </TD><TD> litter </TD><TD> 5 puppies, 2 female, 3 male
</TD></TR>
<TR><TD>Buffy </TD><TD> 1994-06-19 </TD><TD> litter </TD><TD> 3 puppies, 3 female
</TD></TR>
<TR><TD>Chirpy </TD><TD> 1999-03-21 </TD><TD> vet </TD><TD> needed beak straightened
</TD></TR>
<TR><TD>Slim </TD><TD> 1997-08-03 </TD><TD> vet </TD><TD> broken rib
</TD></TR>
<TR><TD>Bowser </TD><TD> 1991-10-12 </TD><TD> kennel </TD><TD>
</TD></TR>
<TR><TD>Fang </TD><TD> 1991-10-12 </TD><TD> kennel </TD><TD>
</TD></TR>
<TR><TD>Fang </TD><TD> 1998-08-28 </TD><TD> birthday </TD><TD> Gave him a new chew toy
</TD></TR>
<TR><TD>Claws </TD><TD> 1998-03-17 </TD><TD> birthday </TD><TD> Gave him a new flea collar
</TD></TR>
<TR><TD>Whistler </TD><TD> 1998-12-09 </TD><TD> birthday </TD><TD> First birthday
</TD></TR>
</TABLE>

<P>
Загрузите записи с помощью следующей команды:

</P>

<PRE>
mysql&#62; LOAD DATA LOCAL INFILE "event.txt" INTO TABLE event;
</PRE>

<P>
Используя знания, усвоенные при работе с таблицей <code>pet</code>, вы сможете
загружать данные из таблицы <code>event</code>; принципы здесь те же. Но что если самой
по себе таблицы <code>event</code> перестанет хватать для получения нужных вам ответов?

</P>
<P>
Предположим, нужно узнать, в каком возрасте животные давали приплод. В
таблице <code>event</code> указаны даты родов, но для того, чтобы рассчитать возраст
матери, нужно знать и дату ее рождения. Так как даты рождения хранятся в
таблице <code>pet</code>, в этом запросе нужно использовать обе таблицы:

</P>

<PRE>
mysql&#62; SELECT pet.name,
    -&#62; (TO_DAYS(date) - TO_DAYS(birth))/365 AS age,
    -&#62; remark
    -&#62; FROM pet, event
    -&#62; WHERE pet.name = event.name AND type = "litter";
+--------+------+-----------------------------+
| name   | age  | remark                      |
+--------+------+-----------------------------+
| Fluffy | 2.27 | 4 kittens, 3 female, 1 male |
| Buffy  | 4.12 | 5 puppies, 2 female, 3 male |
| Buffy  | 5.10 | 3 puppies, 3 female         |
+--------+------+-----------------------------+
</PRE>

<P>
На некоторые аспекты этого запроса следует обратить особое внимание:

</P>

<UL>
<LI>

В выражении <code>FROM</code> указаны две таблицы, так как запрос будет получать
информацию из обеих.

<LI>

При комбинировании (объединении) информации из нескольких таблиц
необходимо указать, как строки одной таблицы связываются с записями
другой. Это просто, так как в обеих таблицах есть столбец с именами. В
этом запросе выражение <code>WHERE</code> используется для сопоставления записей из
двух таблиц по значениям имен.

<LI>

Так как столбец name присутствует в обеих таблицах, нужно явно
указать, какую именно таблицу вы имеете в виду, ссылаясь на данный
столбец. Это можно сделать, связав имя таблицы с именем столбца.
</UL>

<P>
Для объединения не  обязательно иметь две отдельные таблицы; иногда можно
объединить таблицу с самой собой - если нужно сравнить одни записи таблицы
с другими записями той же таблицы. Например, для того, чтобы обнаружить
среди животных ``семейные пары'', можно объединить таблицу <code>pet</code> с ней
самой, составив пары животных разного пола, но одного вида:

</P>

<PRE>
mysql&#62; SELECT p1.name, p1.sex, p2.name, p2.sex, p1.species
    -&#62; FROM pet AS p1, pet AS p2
    -&#62; WHERE p1.species = p2.species AND p1.sex = "f" AND p2.sex = "m";
+--------+------+--------+------+---------+
| name   | sex  | name   | sex  | species |
+--------+------+--------+------+---------+
| Fluffy | f    | Claws  | m    | cat     |
| Buffy  | f    | Fang   | m    | dog     |
| Buffy  | f    | Bowser | m    | dog     |
+--------+------+--------+------+---------+
</PRE>

<P>
В этом запросе мы указываем псевдонимы имен таблицы, для обращения к
столбцам и определения, к какой из таблиц относится каждая ссылка на
столбец.

</P>


<H2><A NAME="Getting_information" HREF="manual.ru_toc.html#Getting_information">3.4  Получение информации о базах данных и таблицах</A></H2>

<P>
<A NAME="IDX409"></A>
<A NAME="IDX410"></A>
<A NAME="IDX411"></A>

</P>
<P>
Как быть, если вы забыли имя базы или таблицы, или структуру какой-либо из
таблиц (например имена столбцов)? В MySQL эта проблема  решается при
помощи нескольких команд, выводящих информацию о базе данных и
содержащихся в ней таблицах.

</P>
<P>
Вы уже познакомились с командой <code>SHOW DATABASES</code>, выводящей список
управляемых сервером баз данных. Определить, какая из них выбрана в данный
момент, можно с помощью функции <code>DATABASE()</code>:

</P>

<PRE>
mysql&#62; SELECT DATABASE();
+------------+
| DATABASE() |
+------------+
| menagerie  |
+------------+
</PRE>

<P>
Если ни одна из баз не выбрана, результат будет пуст.

</P>
<P>
Выяснить, какие таблицы содержит текущая база данных (что необходимо,
если, например, никак не получается вспомнить имя нужной таблицы), можно
при помощи следующей команды:

</P>

<PRE>
mysql&#62; SHOW TABLES;
+---------------------+
| Tables in menagerie |
+---------------------+
| event               |
| pet                 |
+---------------------+
</PRE>

<P>
Узнать структуру таблицы можно при помощи команды <code>DESCRIBE</code>, которая
выводит информацию о каждом из столбцов таблицы:

</P>

<PRE>
mysql&#62; DESCRIBE pet;
+---------+-------------+------+-----+---------+-------+
| Field   | Type        | Null | Key | Default | Extra |
+---------+-------------+------+-----+---------+-------+
| name    | varchar(20) | YES  |     | NULL    |       |
| owner   | varchar(20) | YES  |     | NULL    |       |
| species | varchar(20) | YES  |     | NULL    |       |
| sex     | char(1)     | YES  |     | NULL    |       |
| birth   | date        | YES  |     | NULL    |       |
| death   | date        | YES  |     | NULL    |       |
+---------+-------------+------+-----+---------+-------+
</PRE>

<P>
<code>Field</code> - имя столбца, <code>Type</code> - тип данных, к которому относится этот столбец,
<code>NULL</code> указывает, может ли данный столбец содержать значения <code>NULL</code>, Key -
является ли этот столбец индексным, и, наконец, <code>Default</code> указывает значение
данного столбца по умолчанию.

</P>
<P>
Если для таблицы созданы индексы, информацию о них можно получить с
помощью команды <code>SHOW INDEX FROM tbl_name</code>.

</P>



<H2><A NAME="Examples" HREF="manual.ru_toc.html#Examples">3.5  Примеры стандартных запросов</A></H2>

<P>
<A NAME="IDX412"></A>
<A NAME="IDX413"></A>

</P>
<P>
Здесь представлены примеры решения некоторых стандартных задач средствами
MySQL.

</P>
<P>
В некоторых из примеров используется таблица <code>shop</code> (магазин), в которой
содержатся цены по каждому изделию (<code>item number</code>)для определенных
продавцов (<code>dealer</code>). Предположим, что каждый продавец имеет одну
фиксированную цену для каждого изделия; тогда пара изделие-продавец
(<code>article, dealer</code>) является первичным ключом для записей таблицы.

</P>
<P>
Запустите клиента <code>mysql</code>:

</P>

<PRE>
mysql имя-вашей-базы-данных
</PRE>

<P>
(Для большинства инсталляций MySQL можно использовать базу данных '<code>test</code>'.)

</P>
<P>
Таблицу примера можно создать таким образом:

</P>


<PRE>
CREATE TABLE shop (
 article INT(4) UNSIGNED ZEROFILL DEFAULT '0000' NOT NULL,
 dealer  CHAR(20)                 DEFAULT ''     NOT NULL,
 price   DOUBLE(16,2)             DEFAULT '0.00' NOT NULL,
 PRIMARY KEY(article, dealer));

INSERT INTO shop VALUES
(1,'A',3.45),(1,'B',3.99),(2,'A',10.99),(3,'B',1.45),(3,'C',1.69),
(3,'D',1.25),(4,'D',19.95);
</PRE>

<P>
Ну и, скажем, данные для примера будут такими:

</P>

<PRE>
mysql&#62; SELECT * FROM shop;

+---------+--------+-------+
| article | dealer | price |
+---------+--------+-------+
|    0001 | A      |  3.45 |
|    0001 | B      |  3.99 |
|    0002 | A      | 10.99 |
|    0003 | B      |  1.45 |
|    0003 | C      |  1.69 |
|    0003 | D      |  1.25 |
|    0004 | D      | 19.95 |
+---------+--------+-------+
</PRE>



<H3><A NAME="example-Maximum-column" HREF="manual.ru_toc.html#example-Maximum-column">3.5.1  Максимальное значение столбца</A></H3>

<P>
"Как определить наибольшее значение в столбце?"

</P>

<PRE>
SELECT MAX(article) AS article FROM shop

+---------+
| article |
+---------+
|       4 |
+---------+
</PRE>



<H3><A NAME="example-Maximum-row" HREF="manual.ru_toc.html#example-Maximum-row">3.5.2  Строка, содержащая максимальное значение некоторого столбца</A></H3>

<P>
"Как определить номер, дилера и цену самого дорогого изделия?"

</P>
<P>
В ANSI SQL (и MySQL 4.1) это легко делается при помощи вложенного запроса:

</P>

<PRE>
SELECT article, dealer, price
FROM   shop
WHERE  price=(SELECT MAX(price) FROM shop)
</PRE>

<P>
В версиях MySQL до 4.1 такая задача выполняется в два этапа:

</P>

<OL>
<LI>

Следует получить максимальное значение цены из таблицы при помощи
оператора SELECT.

<LI>

Используя это значение, необходимо составить следующий запрос:


<PRE>
SELECT article, dealer, price
FROM   shop
WHERE  price=19.95
</PRE>

</OL>

<P>
Существует еще одно решение: отсортировать все строки по убыванию цен и
после этого получить первую строку, используя специальный оператор <code>LIMIT</code>:

</P>

<PRE>
SELECT article, dealer, price
FROM   shop
ORDER BY price DESC
LIMIT 1
</PRE>

<P>
<strong>Примечание:</strong> если существует несколько самых дорогих изделий (например,
каждое из них стоит 19,95), запрос, использующий <code>LIMIT</code>, возвращает лишь
одно из них!

</P>


<H3><A NAME="example-Maximum-column-group" HREF="manual.ru_toc.html#example-Maximum-column-group">3.5.3  Максимальное значение столбца для группы</A></H3>

<P>
"Как определить наибольшую цену по каждому изделию?"

</P>

<PRE>
SELECT article, MAX(price) AS price
FROM   shop
GROUP BY article

+---------+-------+
| article | price |
+---------+-------+
|    0001 |  3.99 |
|    0002 | 10.99 |
|    0003 |  1.69 |
|    0004 | 19.95 |
+---------+-------+
</PRE>



<H3><A NAME="example-Maximum-column-group-row" HREF="manual.ru_toc.html#example-Maximum-column-group-row">3.5.4  Строка, содержащая максимальное значение некоторого столбца</A></H3>

<P>
"Для каждого изделия, как определить дилер(ов) с самыми высокими ценами?"

</P>
<P>
В ANSI SQL (и MySQL 4.1) это легко делается при помощи вложенного запроса:

</P>

<PRE>
SELECT article, dealer, price
FROM   shop s1
WHERE  price=(SELECT MAX(s2.price)
              FROM shop s2
              WHERE s1.article = s2.article);
</PRE>

<P>
В MySQL до 4.1 такая задача выполняется в два этапа:

</P>

<OL>
<LI>

Следует получить список (изделие, максимальная цена)

<LI>

Для каждого изделия, получить соответствующие записи, в которых цена соответствует 
максимальной. 
</OL>

<P>
Это легко делается с помощью временной таблицы: 

</P>


<PRE>
CREATE TEMPORARY TABLE tmp (
        article INT(4) UNSIGNED ZEROFILL DEFAULT '0000' NOT NULL,
        price   DOUBLE(16,2)             DEFAULT '0.00' NOT NULL);

LOCK TABLES shop read;

INSERT INTO tmp SELECT article, MAX(price) FROM shop GROUP BY article;

SELECT shop.article, dealer, shop.price FROM shop, tmp
WHERE shop.article=tmp.article AND shop.price=tmp.price;

UNLOCK TABLES;

DROP TABLE tmp;
</PRE>

<P>
Если вы не используете ключевое слово <code>TEMPORARY</code>, вам также следует поставить блокировку
на таблицу <code>tmp</code>.

</P>
<P>
"А можно ли это сделать одним запросом?"

</P>

<P>
Да, но только используя совершенно неэффективный трюк, который я называю "Трюк MAX-CONCAT": 

</P>

<PRE>
SELECT article,
       SUBSTRING( MAX( CONCAT(LPAD(price,6,'0'),dealer) ), 7) AS dealer,
  0.00+LEFT(      MAX( CONCAT(LPAD(price,6,'0'),dealer) ), 6) AS price
FROM   shop
GROUP BY article;

+---------+--------+-------+
| article | dealer | price |
+---------+--------+-------+
|    0001 | B      |  3.99 |
|    0002 | A      | 10.99 |
|    0003 | C      |  1.69 |
|    0004 | D      | 19.95 |
+---------+--------+-------+
</PRE>

<P>
Разумеется, последний пример можно сделать чуть эффективнее, если разбиение катенизированной
строки делать на стороне клиента. 

</P>


<H3><A NAME="example-user-variables" HREF="manual.ru_toc.html#example-user-variables">3.5.5  Использование пользовательских переменных</A></H3>

<P>
В MySQL для хранения результатов, чтобы не держать их во временных
переменных на клиенте, можно применять пользовательские переменные (see section <A HREF="manual.ru.html#Variables">6.1.4  Переменные пользователя</A>).

</P>
<P>
Например, для того чтобы найти изделия с максимальной или минимальной
ценой, можно выполнить следующие действия:

</P>


<PRE>
mysql&#62; SELECT @min_price:=MIN(price),@max_price:=MAX(price) FROM shop;
mysql&#62; SELECT * FROM shop WHERE price=@min_price OR price=@max_price;
+---------+--------+-------+
| article | dealer | price |
+---------+--------+-------+
|    0003 | D      |  1.25 |
|    0004 | D      | 19.95 |
+---------+--------+-------+
</PRE>



<H3><A NAME="example-Foreign_keys" HREF="manual.ru_toc.html#example-Foreign_keys">3.5.6  Использование внешних ключей</A></H3>

<P>
<A NAME="IDX414"></A>
<A NAME="IDX415"></A>

</P>
<P>
В MySQL 3.23.44 и выше в таблицах <code>InnoDB</code> осуществляется проверка
ограничений целостности внешних ключей (обратитесь к разделам 
section <A HREF="manual.ru.html#InnoDB">7.5  Таблицы <code>InnoDB</code></A> и section <A HREF="manual.ru.html#ANSI_diff_Foreign_Keys">1.9.4.5  Внешние ключи</A>).

</P>
<P>
Фактически для соединения двух таблиц внешние ключи не нужны.

</P>
<P>
Единственное, что MySQL в настоящее время не осуществляет (в типах таблиц,
отличных от <code>InnoDB</code>), это проверку (<code>CHECK</code>) что ключи, которые вы
используете, действительно существуют в таблице(ах) на которые вы
ссылаетесь, и не удаляет автоматически записи из таблиц с определением
внешних ключей. Если же ключи используются обычным образом, все будет
работать просто чудесно:

</P>


<PRE>
CREATE TABLE person (
    id SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,
    name CHAR(60) NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE shirt (
    id SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT,
    style ENUM('t-shirt', 'polo', 'dress') NOT NULL,
    color ENUM('red', 'blue', 'orange', 'white', 'black') NOT NULL,
    owner SMALLINT UNSIGNED NOT NULL REFERENCES person(id),
    PRIMARY KEY (id)
);

INSERT INTO person VALUES (NULL, 'Antonio Paz');

INSERT INTO shirt VALUES
(NULL, 'polo', 'blue', LAST_INSERT_ID()),
(NULL, 'dress', 'white', LAST_INSERT_ID()),
(NULL, 't-shirt', 'blue', LAST_INSERT_ID());

INSERT INTO person VALUES (NULL, 'Lilliana Angelovska');

INSERT INTO shirt VALUES
(NULL, 'dress', 'orange', LAST_INSERT_ID()),
(NULL, 'polo', 'red', LAST_INSERT_ID()),
(NULL, 'dress', 'blue', LAST_INSERT_ID()),
(NULL, 't-shirt', 'white', LAST_INSERT_ID());

SELECT * FROM person;
+----+---------------------+
| id | name                |
+----+---------------------+
|  1 | Antonio Paz         |
|  2 | Lilliana Angelovska |
+----+---------------------+

SELECT * FROM shirt;
+----+---------+--------+-------+
| id | style   | color  | owner |
+----+---------+--------+-------+
|  1 | polo    | blue   |     1 |
|  2 | dress   | white  |     1 |
|  3 | t-shirt | blue   |     1 |
|  4 | dress   | orange |     2 |
|  5 | polo    | red    |     2 |
|  6 | dress   | blue   |     2 |
|  7 | t-shirt | white  |     2 |
+----+---------+--------+-------+

SELECT s.* FROM person p, shirt s
 WHERE p.name LIKE 'Lilliana%'
   AND s.owner = p.id
   AND s.color &#60;&#62; 'white';

+----+-------+--------+-------+
| id | style | color  | owner |
+----+-------+--------+-------+
|  4 | dress | orange |     2 |
|  5 | polo  | red    |     2 |
|  6 | dress | blue   |     2 |
+----+-------+--------+-------+
</PRE>



<H3><A NAME="Searching_on_two_keys" HREF="manual.ru_toc.html#Searching_on_two_keys">3.5.7  Поиск по двум ключам</A></H3>

<P>
<A NAME="IDX416"></A>
<A NAME="IDX417"></A>
<A NAME="IDX418"></A>

</P>
<P>
MySQL пока не осуществляет оптимизации, если поиск производится по двум
различным ключам, которые связаны при помощи оператора <code>OR</code> (поиск по одному
ключу с различными частями <code>OR</code>  оптимизируется хорошо):

</P>

<PRE>
SELECT field1_index, field2_index FROM test_table WHERE field1_index = '1'
OR  field2_index = '1'
</PRE>

<P>
Причина заключается в том, что у нас не было времени, чтобы придумать
эффективный способ обработки этого случая (сравните: обработка оператора
<code>AND</code> теперь работает хорошо)

</P>
<P>
В настоящее время данную проблему очень эффективно можно решить при помощи
временной таблицы. Этот способ оптимизации также хорошо подходит, если вы
запускаете очень сложные запросы, когда SQL-сервер делает оптимизацию в
неправильном порядке.

</P>

<PRE>
CREATE TEMPORARY TABLE tmp
SELECT field1_index, field2_index FROM test_table WHERE field1_index = '1';
INSERT INTO tmp
SELECT field1_index, field2_index FROM test_table WHERE field2_index = '1';
SELECT * from tmp;
DROP TABLE tmp;
</PRE>

<P>
Вышеупомянутый способ выполнения этого запроса - это фактически <code>UNION</code>
(объединение) двух запросов. See section <A HREF="manual.ru.html#UNION">6.4.1.2  Синтаксис оператора  <code>UNION</code></A>.

</P>


<H3><A NAME="Calculating_days" HREF="manual.ru_toc.html#Calculating_days">3.5.8  Подсчет посещений за день</A></H3>

<P>
<A NAME="IDX419"></A>
<A NAME="IDX420"></A>
<A NAME="IDX421"></A>
<A NAME="IDX422"></A>

</P>
<P>
В этом разделе представлен пример использования групповых побитовых
функций для вычисления дней месяца, когда пользователь заходил на
веб-сайт.

</P>

<PRE>
CREATE TABLE t1 (year YEAR(4), month INT(2) UNSIGNED ZEROFILL,
             day INT(2) UNSIGNED ZEROFILL);
INSERT INTO t1 VALUES(2000,1,1),(2000,1,20),(2000,1,30),(2000,2,2),
            (2000,2,23),(2000,2,23);
SELECT year,month,BIT_COUNT(BIT_OR(1&#60;&#60;day)) AS days FROM t1
       GROUP BY year,month;

Which returns:

+------+-------+------+
| year | month | days |
+------+-------+------+
| 2000 |    01 |    3 |
| 2000 |    02 |    2 |
+------+-------+------+
</PRE>

<P>
Этот запрос подсчитывает, сколько различных дней входит в данную
комбинацию год/месяц, автоматически исключая дублирующиеся значения.

</P>


<H3><A NAME="example-AUTO_INCREMENT" HREF="manual.ru_toc.html#example-AUTO_INCREMENT">3.5.9  Использование атрибута AUTO_INCREMENT</A></H3>

<P>
<A NAME="IDX423"></A>

</P>
<P>
Атрибут <code>AUTO_INCREMENT</code> может использоваться для генерации уникального
идентификатора для новых строк:

</P>

<PRE>
CREATE TABLE animals (
             id MEDIUMINT NOT NULL AUTO_INCREMENT,
             name CHAR(30) NOT NULL,
             PRIMARY KEY (id)
             );
INSERT INTO animals (name) VALUES ("dog"),("cat"),("penguin"),
                                  ("lax"),("whale");
SELECT * FROM animals;
</PRE>

<P>
Что вернет: 

</P>

<PRE>
+----+---------+
| id | name    |
+----+---------+
|  1 | dog     |
|  2 | cat     |
|  3 | penguin |
|  4 | lax     |
|  5 | whale   |
+----+---------+
</PRE>

<P>
Вы можете получить <code>AUTO_INCREMENT</code> ключ с помощью функции SQL <code>LAST_INSERT_ID()</code> или
с помощью функции <code>mysql_insert_id()</code> интерфейса C. 

</P>
<P>
Для многострочной вставки, <code>LAST_INSERT_ID()</code>/<code>mysql_insert_id()</code> на самом деле вернут
<code>AUTO_INCREMENT</code> значение для первой вставленной записи. Это сделано для того, чтобы
многострочные вставки можно было повторить на других серверах. 

</P>
<P>
В таблицах <code>MyISAM</code> и <code>BDB</code> можно определить <code>AUTO_INCREMENT</code> для вторичного 
столбца составного ключа. В этом случае значение, генерируемое для 
автоинкрементного столбца, вычисляется как 
<code>MAX(auto_increment_column)+1) WHERE prefix=given-prefix</code>. Столбец с
атрибутом <code>AUTO_INCREMENT</code> удобно использовать, когда данные нужно помещать
в упорядоченные группы.

</P>


<PRE>
CREATE TABLE animals (
             grp ENUM('fish','mammal','bird') NOT NULL,
             id MEDIUMINT NOT NULL AUTO_INCREMENT,
             name CHAR(30) NOT NULL,
             PRIMARY KEY (grp,id)
             );
INSERT INTO animals (grp,name) VALUES("mammal","dog"),("mammal","cat"),
                  ("bird","penguin"),("fish","lax"),("mammal","whale");
SELECT * FROM animals ORDER BY grp,id;
</PRE>

<P>
Что вернет: 

</P>

<PRE>
+--------+----+---------+
| grp    | id | name    |
+--------+----+---------+
| fish   |  1 | lax     |
| mammal |  1 | dog     |
| mammal |  2 | cat     |
| mammal |  3 | whale   |
| bird   |  1 | penguin |
+--------+----+---------+
</PRE>

<P>
Обратите внимание, что в этом случае значение <code>AUTO_INCREMENT</code> будет
использоваться повторно, если в какой-либо группе удаляется строка,
содержащая наибольшее значение <code>AUTO_INCREMENT</code>.

</P>


<H2><A NAME="Batch_mode" HREF="manual.ru_toc.html#Batch_mode">3.6  Использование <code>mysql</code> в пакетном режиме</A></H2>

<P>
<A NAME="IDX424"></A>
<A NAME="IDX425"></A>
<A NAME="IDX426"></A>
<A NAME="IDX427"></A>
<A NAME="IDX428"></A>

</P>
<P>
В предыдущих разделах было показано, как использовать <code>mysql</code> в
интерактивном режиме, вводя запросы и тут же просматривая результаты.
Запускать <code>mysql</code> можно и в пакетном режиме. Для этого нужно собрать все
команды в один файл и передать его на исполнение <code>mysql</code>:

</P>

<PRE>
shell&#62; mysql &#60; batch-file
</PRE>

<P>
Если вы работаете с <code>mysql</code> в ОС Windows, и некоторые из специальных
символов, содержащихся в пакетном файле, могут вызвать проблемы,
воспользуйтесь следующей командой:

</P>

<PRE>
dos&#62; mysql -e "source batch-file"
</PRE>

<P>
Если необходимо указать параметры соединения в командной строке, она может
иметь следующий вид:

</P>

<PRE>
shell&#62; mysql -h host -u user -p &#60; batch-file
Enter password: ********
</PRE>

<P>
Работая с <code>mysql</code> таким образом, вы, в сущности, создаете сценарий и затем
исполняете его.

</P>
<P>
Если нужно продолжать обработку сценария даже при обнаружении в нем
ошибок, воспользуйтесь параметром командной строки <code>--force</code>.

</P>
<P>
Зачем вообще нужны сценарии? Причин тому несколько:

</P>

<UL>
<LI>

При необходимости частого (ежедневного или хотя бы еженедельного)
запуска одного и того же запроса сценарий позволяет избавиться от
многократного набора этого запроса.

<LI>

Можно создавать новые запросы, подобные уже существующим, просто
копируя и затем изменяя файлы сценариев.

<LI>

Пакетный режим может пригодиться и при разработке особенно длинных
запросов, а именно - многострочных команд или больших
последовательностей команд. В таком деле одна допущенная ошибка может
привести к необходимости повторного набора большого количества текста.
Зато при работе со сценарием легко исправить ошибку  и запустить
запрос на повторное исполнение.

<LI>

Если ваш запрос выводит на экран много текста, его можно просмотреть
постранично, не мучаясь догадками относительно убежавшей за край
экрана части результатов:


<PRE>
shell&#62; mysql &#60; batch-file | more
</PRE>

<LI>

Выводимые запросом результаты можно сохранить в файле для последующей
обработки:


<PRE>
shell&#62; mysql &#60; batch-file &#62; mysql.out
</PRE>

<LI>

Свой сценарий вы можете дать кому-нибудь еще, чтобы он тоже мог
воспользоваться содержащимися в сценарии командами.

<LI>

В некоторых случаях работать в интерактивном режиме просто не
получается. И здесь без пакетного режима не обойтись.
</UL>

<P>
По умолчанию при работе с <code>mysql</code> в пакетном режиме используется более
сжатый формат вывода результатов, чем при интерактивной работе. В
интерактивном режиме результаты работы запроса <code>SELECT DISTINCT species
FROM pet</code> выглядят так:

</P>


<PRE>
+---------+
| species |
+---------+
| bird    |
| cat     |
| dog     |
| hamster |
| snake   |
+---------+
</PRE>

<P>
А в пакетном - вот так:

</P>

<PRE>
species
bird
cat
dog
hamster
snake
</PRE>

<P>
Если вам нужно, чтобы в пакетном режиме программа выводила данные так же,
как и в интерактивном, воспользуйтесь ключом <code>mysql -t</code>. Включить "эхо"
исполняемых команд можно с помощью ключа <code>mysql -vvv</code>.

</P>
<P>
В командную строку <code>mysql</code> можно включать и сценарии - при помощи команды
<code>source</code>:

</P>

<PRE>
mysql&#62; source filename;
</PRE>



<H2><A NAME="Twin" HREF="manual.ru_toc.html#Twin">3.7  Запросы проекта "Близнецы" (Twin Project)</A></H2>

<P>
<A NAME="IDX429"></A>
<A NAME="IDX430"></A>

</P>
<P>
В Analytikerna и Lentus мы проводили сбор и систематизацию данных в рамках
крупного исследовательского проекта. Этот проект разрабатывается совместно
Институтом экологической медицины Karolinska Institutet, Стокгольм и
отделением клинических исследований в области старения и психологии
университета Южной Калифорнии.

</P>
<P>
В проекте предусмотрен этап опросов, на котором происходит опрос по
телефону всех проживающих в Швеции близнецов старше 65 лет. Близнецы,
отвечающие критериям отбора, переходят на следующий этап. На этом этапе
желающих участвовать в проекте близнецов посещает врач с медсестрой.
Проводятся физические и нейропсихологические исследования, лабораторные
анализы, неврологическое обследование, оценка психологического состояния,
а также собираются данные по истории семьи. Кроме того, осуществляется
сбор информации о медицинских и экологических факторах риска.

</P>
<P>
Дополнительную информацию о проекте вы можете получить по адресу:
<a HREF="http://www.imm.ki.se/TWIN/TWINUKW.HTM">http://www.imm.ki.se/TWIN/TWINUKW.HTM</a>

</P>
<P>
На поздних этапах администрирование проекта осуществляется с помощью
web-интерфейса, написанного на <code>Perl</code> и <code>MySQL</code>.

</P>
<P>
Каждую ночь собранные во время интервью данные заносятся в базу данных
MySQL.

</P>



<H3><A NAME="Twin_pool" HREF="manual.ru_toc.html#Twin_pool">3.7.1  Поиск нераспределенных близнецов</A></H3>

<P>
Этот запрос определяет, которые из близнецов переходят во второй этап
проекта:

</P>

<PRE>
SELECT
        CONCAT(p1.id, p1.tvab) + 0 AS tvid,
        CONCAT(p1.christian_name, " ", p1.surname) AS Name,
        p1.postal_code AS Code,
        p1.city AS City,
        pg.abrev AS Area,
        IF(td.participation = "Aborted", "A", " ") AS A,
        p1.dead AS dead1,
        l.event AS event1,
        td.suspect AS tsuspect1,
        id.suspect AS isuspect1,
        td.severe AS tsevere1,
        id.severe AS isevere1,
        p2.dead AS dead2,
        l2.event AS event2,
        h2.nurse AS nurse2,
        h2.doctor AS doctor2,
        td2.suspect AS tsuspect2,
        id2.suspect AS isuspect2,
        td2.severe AS tsevere2,
        id2.severe AS isevere2,
        l.finish_date
FROM
        twin_project AS tp
        /* For Twin 1 */
        LEFT JOIN twin_data AS td ON tp.id = td.id
                  AND tp.tvab = td.tvab
        LEFT JOIN informant_data AS id ON tp.id = id.id
                  AND tp.tvab = id.tvab
        LEFT JOIN harmony AS h ON tp.id = h.id
                  AND tp.tvab = h.tvab
        LEFT JOIN lentus AS l ON tp.id = l.id
                  AND tp.tvab = l.tvab
        /* For Twin 2 */
        LEFT JOIN twin_data AS td2 ON p2.id = td2.id
                  AND p2.tvab = td2.tvab
        LEFT JOIN informant_data AS id2 ON p2.id = id2.id
                  AND p2.tvab = id2.tvab
        LEFT JOIN harmony AS h2 ON p2.id = h2.id
                  AND p2.tvab = h2.tvab
        LEFT JOIN lentus AS l2 ON p2.id = l2.id
                  AND p2.tvab = l2.tvab,
        person_data AS p1,
        person_data AS p2,
        postal_groups AS pg
WHERE
        /* p1 gets main twin and p2 gets his/her twin. */
        /* ptvab is a field inverted from tvab */
        p1.id = tp.id AND p1.tvab = tp.tvab AND
        p2.id = p1.id AND p2.ptvab = p1.tvab AND
        /* Just the sceening survey */
        tp.survey_no = 5 AND
        /* Skip if partner died before 65 but allow emigration (dead=9) */
        (p2.dead = 0 OR p2.dead = 9 OR
         (p2.dead = 1 AND
          (p2.death_date = 0 OR
           (((TO_DAYS(p2.death_date) - TO_DAYS(p2.birthday)) / 365)
            &#62;= 65))))
        AND
        (
        /* Twin is suspect */
        (td.future_contact = 'Yes' AND td.suspect = 2) OR
        /* Twin is suspect - Informant is Blessed */
        (td.future_contact = 'Yes' AND td.suspect = 1
                                   AND id.suspect = 1) OR
        /* No twin - Informant is Blessed */
        (ISNULL(td.suspect) AND id.suspect = 1
                            AND id.future_contact = 'Yes') OR
        /* Twin broken off - Informant is Blessed */
        (td.participation = 'Aborted'
         AND id.suspect = 1 AND id.future_contact = 'Yes') OR
        /* Twin broken off - No inform - Have partner */
        (td.participation = 'Aborted' AND ISNULL(id.suspect)
                                      AND p2.dead = 0))
        AND
        l.event = 'Finished'
        /* Get at area code */
        AND SUBSTRING(p1.postal_code, 1, 2) = pg.code
        /* Not already distributed */
        AND (h.nurse IS NULL OR h.nurse=00 OR h.doctor=00)
        /* Has not refused or been aborted */
        AND NOT (h.status = 'Refused' OR h.status = 'Aborted'
        OR h.status = 'Died' OR h.status = 'Other')
ORDER BY
        tvid;
</PRE>

<P>
Дадим к этому запросу некоторые пояснения:

</P>
<DL COMPACT>

<DT><code>CONCAT(p1.id, p1.tvab) + 0 AS tvid</code>
<DD>
Сортируем по взаимосвязи <code>id</code> и <code>tvab</code> в числовом порядке. Прибавление нуля к
результату заставляет MySQL обращаться с результатом как с числом.

<DT>column <code>id</code>
<DD>
Определяет пару близнецов. Является ключевым полем всех таблиц.

<DT>column <code>tvab</code>
<DD>
Определяет близнеца в паре. Принимает значение 1 или 2.

<DT>column <code>ptvab</code>
<DD>
Отрицание <code>tvab</code>. Если значение <code>tvab</code> равно 1, значение этого поля - 2, и
наоборот. Данное поле облегчает MySQL задачу оптимизации запроса и
экономит время ввода данных.
</DL>

<P>
Этот запрос иллюстрирует, помимо всего прочего, сравнение значений одной
таблицы с помощью команды <code>JOIN (p1 и p2)</code>. В этом примере таким образом
проверяется, не умер ли один из близнецов до достижения им 65-летнего
возраста. Если так и произошло, строка не попадает в список возвращаемых.

</P>
<P>
Все вышеприведенные поля имеются во всех таблицах, в которых хранится
относящаяся к близнецам информация. Ключевыми полями для ускорения работы
запросов назначены <code>id,tvab</code> (во всех таблицах), а также <code>id,ptvab
(person_data)</code>.

</P>
<P>
На нашем рабочем компьютере (200МГц UltraSPARC) этот запрос возвращает
150-200 строк, и его выполнение занимает менее секунды.

</P>
<P>
Текущее количество строк в таблицах, использовавшихся выше:
<TABLE BORDER>
<TR><TD><strong>Таблица</strong> </TD><TD> <strong>Строки</strong>
</TD></TR>
<TR><TD><code>person_data</code> </TD><TD> 71074
</TD></TR>
<TR><TD><code>lentus</code> </TD><TD> 5291
</TD></TR>
<TR><TD><code>twin_project</code> </TD><TD> 5286
</TD></TR>
<TR><TD><code>twin_data</code> </TD><TD> 2012
</TD></TR>
<TR><TD><code>informant_data</code> </TD><TD> 663
</TD></TR>
<TR><TD><code>harmony</code> </TD><TD> 381
</TD></TR>
<TR><TD><code>postal_groups</code> </TD><TD> 100
</TD></TR>
</TABLE>

</P>



<H3><A NAME="Twin_event" HREF="manual.ru_toc.html#Twin_event">3.7.2  Вывод таблицы состояний пар близнецов</A></H3>

<P>
Каждый опрос оканчивается кодом состояния, называющимся <code>event</code>
(``событие''). Приведенный здесь запрос выводит данные обо всех парах
близнецов, объединенные по полю <code>event</code>. Таблица наглядно показывает, с
каким количеством пар близнецов работа полностью завершена, а в каком
количестве пар работа с одним близнецом завершена, а с другим - нет и т.п.

</P>

<PRE>
SELECT
        t1.event,
        t2.event,
        COUNT(*)
FROM
        lentus AS t1,
        lentus AS t2,
        twin_project AS tp
WHERE
        /* We are looking at one pair at a time */
        t1.id = tp.id
        AND t1.tvab=tp.tvab
        AND t1.id = t2.id
        /* Just the sceening survey */
        AND tp.survey_no = 5
        /* This makes each pair only appear once */
        AND t1.tvab='1' AND t2.tvab='2'
GROUP BY
        t1.event, t2.event;
</PRE>



<H2><A NAME="Apache" HREF="manual.ru_toc.html#Apache">3.8  Использование MySQL совместно с Apache</A></H2>

<P>
<A NAME="IDX431"></A>

</P>
<P>
Существуют программы, позволяющие проводить идентификацию пользователей с
помощью базы данных MySQL, а также записывать журналы в таблицу MySQL.

</P>
<P>
Формат записи журналов Apache можно привести в легко понятную MySQL форму,
введя в файл настроек Apache следующие строки:

</P>

<PRE>
LogFormat \
        "\"%h\",%{%Y%m%d%H%M%S}t,%&#62;s,\"%b\",\"%{Content-Type}o\",  \
        \"%U\",\"%{Referer}i\",\"%{User-Agent}i\""
</PRE>

<P>
В MySQL же можно сделать примерно следующее:

</P>

<PRE>
LOAD DATA INFILE '/local/access_log' INTO TABLE table_name
FIELDS TERMINATED BY ',' OPTIONALLY ENCLOSED BY '"' ESCAPED BY '\\'
</PRE>



<H1><A NAME="MySQL_Database_Administration" HREF="manual.ru_toc.html#MySQL_Database_Administration">4  Администрирование баз данных</A></H1>



<H2><A NAME="Configuring_MySQL" HREF="manual.ru_toc.html#Configuring_MySQL">4.1  Конфигурирование MySQL</A></H2>



<H3><A NAME="Command-line_options" HREF="manual.ru_toc.html#Command-line_options">4.1.1  Параметры командной строки <code>mysqld</code></A></H3>

<P>
<A NAME="IDX432"></A>
<A NAME="IDX433"></A>
<A NAME="IDX434"></A>

</P>
<P>
В большинстве случаев управление параметрами mysqld осуществляется при
помощи файлов параметров (see section <A HREF="manual.ru.html#Option_files">4.1.2  Файлы параметров <tt>`my.cnf'</tt></A>).

</P>
<P>
<code>mysqld</code> и <code>mysqld.server</code> считывают параметры из групп <code>mysqld</code> и <code>server</code>.
<code>mysqld_safe</code> считывает параметры из групп <code>mysqld</code>, <code>server</code>, <code>mysqld_safe</code> и
<code>safe_mysqld</code>. Встроенный сервер MySQL обычно считывает параметры из <code>server</code>,
<code>embedded</code> и  <code>xxxxx_SERVER</code>, где <code>xxxxx</code> - имя приложения.

</P>
<P>
mysqld принимает следующие параметры командной строки (для получения полного
списка выполните <code>mysqld --help</code>):

</P>
<DL COMPACT>

<DT><code>--ansi</code>
<DD>
Использовать синтаксис ANSI SQL вместо синтаксиса MySQL (see section <A HREF="manual.ru.html#ANSI_mode">1.9.2  Запуск MySQL в режиме ANSI</A>).

<DT><code>-b, --basedir=path</code>
<DD>
Путь к каталогу установки. Все остальные пути обычно определяются
относительно этого пути.

<DT><code>--big-tables</code>
<DD>
Позволяет использовать наборы результатов большого объема за счет
сохранения всех временных файлов в одном. Данный параметр позволяет
устранить большинство ошибок 'table full' (таблица переполнена), но
замедляет обработку запросов, для которых было бы достаточно таблиц,
расположенных в памяти. Начиная с версии 3.23.2 в MySQL эта проблема
решается автоматически: память используется для небольших временных
таблиц, а при необходимости происходит переключение на таблицы,
расположенные на диске.

<DT><code>--bind-address=IP</code>
<DD>
IP-адрес, с которым необходимо установить связь.

<DT><code>--console</code>
<DD>
Писать журнал сообщений/ошибок в stderr/stdout даже если <code>--log-error</code> указана.
На Windows mysqld просто не будет закрывать консольное окно если указана эта
опция. 

<DT><code>--character-sets-dir=path</code>
<DD>
Каталог, в  котором  расположены  наборы  символов (see section <A HREF="manual.ru.html#Character_sets">4.6.1  Набор символов, применяющийся для записи данных и сортировки</A>).

<DT><code>--chroot=path</code>
<DD>
Изменяет корневой каталог программы mysqld во время запуска.
Рекомендуемая мера безопасности для MySQL 4.0 (MySQL 3.23 не вполне в состоянии предоставить
100% измененную среду запуска). Эта опция некоторым образом ограничивает
использование функций <code>LOAD DATA INFILE</code> и <code>SELECT ... INTO OUTFILE</code>.

<DT><code>--core-file</code>
<DD>
Записывает файл ядра, если происходит аварийное прекращение работы <code>mysqld</code>.
В некоторых системах также необходимо указать <code>--core-file-size</code> для
safe_mysqld (see section <A HREF="manual.ru.html#safe_mysqld">4.7.2  <code>safe_mysqld</code>, оболочка <code>mysqld</code></A>). Обратите
внимание на то, что в некоторых системах, таких как Solaris, не удастся
записать файл ядра, если используется параметр <code>--user</code>.

<DT><code>-h, --datadir=path</code>
<DD>
Путь к корневому каталогу базы данных.

<DT><code>--debug[...]=</code>
<DD>
Если MySQL настроен при помощи <code>--with-debug</code>, то этот параметр позволяет
получить файл трассировки, в котором отражена работа <code>mysqld</code> (see section <A HREF="manual.ru.html#Making_trace_files">D.1.2  Создание трассировочных файлов</A>).

<DT><code>--default-character-set=charset</code>
<DD>
Задает набор символов, принятый по умолчанию (see section <A HREF="manual.ru.html#Character_sets">4.6.1  Набор символов, применяющийся для записи данных и сортировки</A>).

<DT><code>--default-table-type=type</code>
<DD>
Задает тип таблиц, принятый по умолчанию (see section <A HREF="manual.ru.html#Table_types">7  Типы  таблиц MySQL</A>).

<DT><code>--delay-key-write[= OFF | ON | ALL]</code>
<DD>
Указывает, как на MyISAM <code>DELAYED KEYS</code> должен обрабатываться. 
See section <A HREF="manual.ru.html#Server_parameters">5.5.2  Настройка параметров сервера</A>.

<DT><code>--delay-key-write-for-all-tables; В MySQL 4.0.3 следует использовать <code>--delay-key-write=ALL</code>.</code>
<DD>
Отмена сброса на диск ключевых буферов для всех таблиц <code>MyISAM</code> между
записями. See section <A HREF="manual.ru.html#Server_parameters">5.5.2  Настройка параметров сервера</A>.

<DT><code>--des-key-file=filename</code>
<DD>
Задает считывание из файла filename принятых по умолчанию ключей, которые
используются для <code>DES_ENCRYPT()</code> и <code>DES_DECRYPT()</code>.

<DT><code>--enable-external-locking (было --enable-locking)</code>
<DD>
Включает блокировку доступа к системе. Обратите внимание на то, что если
этот параметр используется в системе, где функция <code>lockd</code> полностью не
работает (например, в Linux), это может привести к зависанию mysqld.

<DT><code>--enable-named-pipe</code>
<DD>
Включает поддержку для именованных каналов (только в NT/Win2000/XP).

<DT><code>-T, --exit-info</code>
<DD>
Побитовое маскирование различных флагов, которое применяется для отладки
сервера mysqld; не следует использовать этот параметр, если вы хорошо не
разбираетесь в том, что именно он делает!

<DT><code>--flush</code>
<DD>
Задает сброс на диск всех изменений после каждой команды SQL. Обычно MySQL
только направляет все изменения на диск после каждой команды SQL,
делегируя управление синхронизацией записи на диск операционной системе
(see section <A HREF="manual.ru.html#Crashing">A.4.1  Что делать, если работа MySQL сопровождается постоянными сбоями</A>).

<DT><code>-?, --help</code>
<DD>
Вывод сокращенной справки и завершение выполнения.

<DT><code>--init-file=file</code>
<DD>
Задает считывание команды SQL из файла file при запуске.

<DT><code>-L, --language=...</code>
<DD>
Вывод сообщений об ошибках клиента на указанном языке. Может быть задан в
виде полного пути (see section <A HREF="manual.ru.html#Languages">4.6.2  Сообщения об ошибках на языках, отличных от английского</A>).

<DT><code>-l, --log[=file]</code>
<DD>
Задает занесение в файл журнала соединений и запросов (see section <A HREF="manual.ru.html#Query_log">4.9.2  Общий журнал запросов</A>).

<DT><code>--log-bin=[file]</code>
<DD>
Двоичный журнал обновлений. Сохранение всех запросов, изменяющих данные, в
файл. Используется для архивного копирования и репликации. See section <A HREF="manual.ru.html#Binary_log">4.9.4  Бинарный журнал обновлений</A>.

<DT><code>--log-bin-index[=file]</code>
<DD>
Имя индексного файла для двоичного журнала обновлений. 
See section <A HREF="manual.ru.html#Binary_log">4.9.4  Бинарный журнал обновлений</A>.

<DT><code>--log-error[=file]</code>
<DD>
Писать ошибки и сообщения в этот файл. See section <A HREF="manual.ru.html#Error_log">4.9.1  Журнал ошибок</A>.

<DT><code>--log-isam[=file]</code>
<DD>
Заносит в файл журнала все изменения <code>ISAM</code>/<code>MyISAM</code> (используется только при
отладке <code>ISAM</code>/<code>MyISAM</code>).

<DT><code>--log-slow-queries[=file]</code>
<DD>
Заносит в файл журнала все запросы, выполнение которых заняло больше, чем
<code>long_query_time</code> секунд (see section <A HREF="manual.ru.html#Slow_query_log">4.9.5  Журнал медленных запросов</A>).

<DT><code>--log-update[=file]</code>
<DD>
Заносит в файл журнала обновления <code>file.#</code> где <code>#</code> представляет собой уникальный
номер, если он не был задан (see section <A HREF="manual.ru.html#Update_log">4.9.3  Журнал обновлений (update)</A>).

<DT><code>--log-long-format</code>
<DD>
Заносит в файл журнала обновлений некоторую дополнительную информацию.
Если задано <code>--log-slow-queries</code>, то запросы, не использующие индексов,
будут заноситься в журнал медленных запросов.

<DT><code>--low-priority-updates</code>
<DD>
Операциям по изменению таблиц (<code>INSERT</code>/<code>DELETE</code>/<code>UPDATE</code>) будет назначен более
низкий приоритет, чем операциям выбора. Это также можно реализовать при
помощи <code>{INSERT | REPLACE | UPDATE | DELETE} LOW_PRIORITY ...</code>, чтобы
понизить приоритет только одного запроса, или через <code>SET 
LOW_PRIORITY_UPDATES=1</code>, чтобы изменить приоритет в одном потоке (see section <A HREF="manual.ru.html#Table_locking">5.3.2  Вопросы блокирования таблиц</A>).

<DT><code>--memlock</code>
<DD>
Фиксирует процесс <code>mysqld</code> в памяти. Этот параметр работает только в том
случае, если ваша система поддерживает системный вызов <code>mlockall()</code>,
например Solaris. Такая мера может быть полезной, если операционная
система записывает <code>mysqld</code> в файл подкачки на диск.

<DT><code>--myisam-recover [=параметр[,параметр...]]]</code>
<DD>
Параметр - это любое сочетание <code>DEFAULT</code>, <code>BACKUP</code>, <code>FORCE</code> или <code>QUICK</code>. Если
необходимо отключить данную функцию, укажите вместо набора параметров явно
<code>""</code>. Если эта функция используется, <code>mysqld</code> проверит таблицу на предмет
того, была ли она отмечена как сбойная или не была закрыта надлежащим
образом (последний вариант действует только в том случае, если был включен
параметр <code>--skip-external-locking</code>). В любом из этих случаев <code>mysqld</code> произведет полную
проверку таблицы. Если таблица была повреждена, <code>mysqld</code> попытается ее
восстановить. Приведенные ниже параметры влияют на работу процесса
восстановления.

<TABLE BORDER>
<TR><TD><strong>Параметр</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD>DEFAULT </TD><TD> Аналогично отсутствию каких-либо параметров для функции
		    <code>--myisam-recover</code>.                                      
</TD></TR>
<TR><TD>BACKUP </TD><TD> Если во время восстановления таблица данных была изменена,
                   сохраняется резервная копия файла данных <tt>`table_name.MYD'</tt> под
		   именем <tt>`table_name-datetime.BAK'</tt>.     
</TD></TR>
<TR><TD>FORCE </TD><TD> Запуск восстановления, даже если будет утрачено более одной
		   строки из файла <tt>`.MYD'</tt>.                            
</TD></TR>
<TR><TD>QUICK </TD><TD> Не проверять строки в таблице, в которых отсутствуют удаленные блоки.
</TD></TR>
</TABLE>

Перед автоматическим восстановлением таблицы MySQL добавит запись об этом
в журнал ошибок. Если необходимо, чтобы восстановление после большинства
ошибок осуществлялось без вмешательства пользователя, следует установить
параметры <code>BACKUP</code> и <code>FORCE</code>. Тогда восстановление будет производиться даже в
случае, если некоторые строки будут удалены, но файл данных будет
сохраняться в виде резервной копии, поэтому впоследствии всегда можно
будет определить, что произошло.

<DT><code>--pid-file=path</code>
<DD>
Путь к pid-файлу используется функцией <code>safe_mysqld</code>.

<DT><code>-P, --port=...</code>
<DD>
Номер порта для прослушивания соединений TCP/IP.

<DT><code>-o, --old-protocol</code>
<DD>
Использовать протокол 3.20 для совместимости с некоторыми очень старыми
клиентами (see section <A HREF="manual.ru.html#Upgrading-from-3.20">2.5.5  Модернизация с версии 3.20 до версии 3.21</A>).

<DT><code>--one-thread</code>
<DD>
Использовать только один поток (для отладки в системе Linux) (see section <A HREF="manual.ru.html#Debugging_server">D.1  Отладка сервера MySQL</A>).

<DT><code>-O, --set-variable var=option</code>
<DD>
Задает значение для переменной. <code>--help</code> - выводит список переменных.
Подробное описание всех переменных можно найти в разделе <code>SHOW VARIABLES</code>
этого руководства (see section <A HREF="manual.ru.html#SHOW_VARIABLES">4.5.6.4  <code>SHOW VARIABLES</code></A>). 

Обратите внимание, <code>--set-variable</code> морально устарела с версии MySQL 4.0. Просто используйте
<code>--var=option</code>. See section <A HREF="manual.ru.html#Server_parameters">5.5.2  Настройка параметров сервера</A>.

В MySQL 4.0.2 вы можете устанавливать переменную непосредственно с помощью
<code>--variable-name=option</code>, и <code>set-variable</code> больше не нужна в файлах
опций. 

Если вы хотите ограничить максимальное значение, в которое может быть установлена
пемеременная при помощи <code>SET</code>, определите это значение с помощью опции <code>--maximum-variable-name</code> 
See section <A HREF="manual.ru.html#SET_OPTION">5.5.6  Синтаксис команды <code>SET</code></A>.

Когда переменная будет устанавливаться в какое-либо значение, MySQL
автоматически будет корректировать его, чтобы оно оставалось в указананных
рамках; также MySQL может немного корректировать установленное значение с тем,
чтобы эффективнее использовались внутренние алгоритмы. 

Раздел по настройке
параметров сервера включает информацию по их оптимизации (see section <A HREF="manual.ru.html#Server_parameters">5.5.2  Настройка параметров сервера</A>).

<DT><code>--safe-mode</code>
<DD>
Пропуск некоторых этапов оптимизации. 

<DT><code>--safe-show-database</code>
<DD>
При использовании этого параметра команда <code>SHOW DATABASES</code> выдает только те
базы данных, для которых у пользователя есть какие-либо привилегии.
Начиная с версии 4.0.2 этот параметр является недействительным и больше ни
на что не влияет (его значение установлено по умолчанию), так как в новой
версии появилась привилегия <code>SHOW DATABASES</code> (see section <A HREF="manual.ru.html#GRANT">4.3.1  Синтаксис команд <code>GRANT</code> и <code>REVOKE</code></A>).

<DT><code>--safe-user-create</code>
<DD>
Когда этот параметр включен, пользователь не может создавать новых
пользователей при помощи команды <code>GRANT</code>, если он не имеет привилегии <code>INSERT</code>
для таблицы <code>mysql.user</code> или для любого столбца этой таблицы.

<DT><code>--skip-bdb</code>
<DD>
Запретить использование таблиц BDB. Это сэкономит память и может ускорить работу.

<DT><code>--skip-concurrent-insert</code>
<DD>
Отключает возможность одновременного выбора и вставки данных для таблиц
<code>MyISAM</code> (используется только в том случае, если в этой функции найдена
ошибка).

<DT><code>--skip-delay-key-write; в MySQL 4.0.3 следует использовать --delay-key-write=OFF</code>
<DD>
Игнорирует  параметр  <code>DELAY_KEY_WRITE</code>  для  всех  таблиц (see section <A HREF="manual.ru.html#Server_parameters">5.5.2  Настройка параметров сервера</A>).

<DT><code>--skip-grant-tables</code>
<DD>
Включение данного параметра приводит к тому, что сервер совсем не
использует систему привилегий - таким образом полный доступ ко всем базам
данных получают все! (Можно дать серверу команду снова использовать
таблицы доступа, запустив <code>mysqladmin flush-privileges</code> или <code>mysqladmin
reload</code>.)

<DT><code>--skip-host-cache</code>
<DD>
Никогда не использовать кэш имени главного компьютера для быстрого
разрешения соответствий имен и IP-адресов, а вместо этого всегда
запрашивать DNS-сервер по каждому соединению (see section <A HREF="manual.ru.html#DNS">5.5.5  Как MySQL использует DNS</A>).

<DT><code>--skip-innodb</code>
<DD>
Запретить использование таблиц InnoDB. Это сэкономит память и может ускорить работу. 

<DT><code>--skip-external-locking (было --skip-locking)</code>
<DD>
Не использовать средства системных блокировок. Чтобы воспользоваться функциями
<code>isamchk</code> или <code>myisamchk</code>, необходимо выключить сервер
(see section <A HREF="manual.ru.html#Stability">1.4.3  Насколько стабильным является MySQL?</A>). Обратите внимание на то, что в MySQL версии 3.23 для
восстановления или проверки таблиц <code>MyISAM</code> можно использовать
<code>REPAIR</code> и <code>CHECK</code>.

<DT><code>--skip-name-resolve</code>
<DD>
Не производится разрешения имен хостов. Все значения в столбце Host в
таблицах привилегий должны быть IP-адресами или значениями localhost (see section <A HREF="manual.ru.html#DNS">5.5.5  Как MySQL использует DNS</A>).

<DT><code>--skip-networking</code>
<DD>
Прослушивание соединений TCP/IP не производится. Связь с <code>mysqld</code> должна
осуществляться через сокеты Unix. Этот параметр рекомендуется для систем,
в которых разрешены только локальные запросы (see section <A HREF="manual.ru.html#DNS">5.5.5  Как MySQL использует DNS</A>).

<DT><code>--skip-new</code>
<DD>
Не использовать новые (возможно, неправильные) операции. 

<DT><code>--skip-symlink</code>
<DD>
Не удалять и не переименовывать файлы, на которые указывает файл <code>symlinked</code>
в каталоге данных.

<DT><code>--skip-safemalloc</code>
<DD>
Если MySQL настроен при помощи <code>--with-debug=full</code>, все программы будут
проверять память на наличие выхода за границы области памяти при каждом
заполнении и освобождении памяти. Поскольку такая проверка осуществляется
довольно медленно, от нее можно отказаться, воспользовавшись этим
параметром.

<DT><code>--skip-show-database</code>
<DD>
Не позволяет использовать команду <code>SHOW DATABASES</code>, если пользователь не
имеет привилегии <code>SHOW DATABASES</code>. Начиная с версии 4.0.2 этот параметр
больше не нужен, поскольку доступ теперь может быть разрешен при помощи
привилегии <code>SHOW DATABASES</code>.

<DT><code>--skip-stack-trace</code>
<DD>
Не записывать трассировку стеков. Этот параметр может оказаться полезным,
когда <code>mysqld</code> запущен под отладчиком. В некоторых системах данный параметр
также необходимо использовать для получения файла ядра (see section <A HREF="manual.ru.html#Debugging_server">D.1  Отладка сервера MySQL</A>).

<DT><code>--skip-thread-priority</code>
<DD>
Отключает использование приоритетов потока, чтобы уменьшить время ожидания
ответа.

<DT><code>--socket=path</code>
<DD>
Файл канала, который используется для локального соединения вместо файла,
принятого по умолчанию, <code>/tmp/mysql.sock</code>.

<DT><code>--sql-mode=параметр[,параметр[,параметр...]]</code>
<DD>
Параметр  может  представлять  собой  любое  сочетание  из: <code>REAL_AS_FLOAT</code>,
<code>PIPES_AS_CONCAT</code>, <code>ANSI_QUOTES</code>, <code>IGNORE_SPACE</code>, <code>SERIALIZE</code>, <code>ONLY_FULL_GROUP_BY</code>.
Если нужно произвести сброс значения, параметр может быть пустым (<code>"")</code>.
Указание всех приведенных выше параметров аналогично использованию <code>--ansi</code>.
При помощи этого параметра можно включать только необходимые режимы SQL
(see section <A HREF="manual.ru.html#ANSI_mode">1.9.2  Запуск MySQL в режиме ANSI</A>).

<DT><code>--temp-pool</code>
<DD>
При указании данного параметра для создаваемых временных файлов будет
использоваться ограниченный набор имен вместо создания уникального имени
для каждого нового файла. Данная функция предназначена для устранения
проблемы ядра Linux, возникающей при создании большого количества новых
файлов с разными именами. По старой схеме в Linux как бы происходит
'утечка' памяти, так как она распределяется для кэша каталогов вместо
дискового кэша.

<DT><code>--transaction-isolation= { READ-UNCOMMITTED | READ-COMMITTED |</code>
<DD>
REPEATABLE-READ | SERIALIZABLE }
Задает принятый по умолчанию уровень изоляции транзакции (see section <A HREF="manual.ru.html#SET_TRANSACTION">6.7.3  Синтаксис команды <code>SET TRANSACTION</code></A>).

<DT><code>-t, --tmpdir=path</code>
<DD>
Путь для временных файлов. Может быть полезен, если принятый по умолчанию
каталог <code>/tmp</code> расположен на слишком маленьком диске и не может вместить все
временные таблицы.
Начиная с MySQL 4.1, эта опция поддержает указание нескольких путей, разделенных 
двоеточием <code>:</code> (на Windows - точкой с запятой <code>;</code>). Эти пути будут использованы в 
ротации. 

<DT><code>-u, --user= [user_name | userid]</code>
<DD>
Запуск демона  <code>mysqld</code> от имени пользователя <code>user_name</code> или <code>userid</code> (число).
Этот параметр является <strong>обязательным</strong> при запуске <code>mysqld</code> в качестве главной
программы.

Начиная с MySQL 3.23.56 и 4.0.12:

Для того, чтобы избежать возможного пробоя в безопасности когда пользователь 
добавляет опцию <code>--user=root</code> в один из файлов <tt>`my.cnf'</tt>, <code>mysqld</code>
лишь только будет использовать первую указанную опцию <code>--user</code> и давать предупреждение
если указано множество таких опций.
Имейте в виду, что <tt>`/etc/my.cnf'</tt> и <tt>`datadir/my.cnf'</tt> могут перекрыть опцию командной строки - 
таким образом, рекомендовано указывать эту опцию именно в <tt>`/etc/my.cnf'</tt>. 

<DT><code>-V, --version</code>
<DD>
Вывод информации по версии программы и завершение выполнения.

<DT><code>-W, --log-warnings (было --warnings)</code>
<DD>
Задает  запись  таких  предупреждений, как <code>Aborted connection...</code>  в 
файл  <tt>`.err'</tt> (see section <A HREF="manual.ru.html#Communication_errors">A.2.9  Коммуникационные ошибки / Оборванные соединения</A>.
</DL>

<P>
Большая часть значений может быть изменена в процессе работы сервера
с помощью команды <code>SET</code>. See section <A HREF="manual.ru.html#SET_OPTION">5.5.6  Синтаксис команды <code>SET</code></A>.

</P>


<H3><A NAME="Option_files" HREF="manual.ru_toc.html#Option_files">4.1.2  Файлы параметров <tt>`my.cnf'</tt></A></H3>

<P>
<A NAME="IDX435"></A>
<A NAME="IDX436"></A>
<A NAME="IDX437"></A>
<A NAME="IDX438"></A>

</P>
<P>
Начиная с версии 3.22 MySQL может считывать принятые по умолчанию
параметры запуска для сервера и клиентов из файлов параметров.

</P>
<P>
В Unix считывание принятых по умолчанию параметров MySQL производится из
следующих файлов:

</P>
<P>
<A NAME="IDX439"></A>
<TABLE BORDER>
<TR><TD><strong>Имя файла</strong> </TD><TD> <strong>Назначение</strong>
</TD></TR>
<TR><TD><code>/etc/my.cnf</code> </TD><TD> Общие параметры
</TD></TR>
<TR><TD><code>DATADIR/my.cnf</code> </TD><TD> Параметры для сервера
</TD></TR>
<TR><TD><code>defaults-extra-file</code> </TD><TD> Файл, указанный при помощи -defaults-extra-file=#
</TD></TR>
<TR><TD><code>~/.my.cnf</code> </TD><TD> Параметры для пользователя
</TD></TR>
</TABLE>

</P>
<P>
<code>DATADIR</code> является каталогом данных MySQL (обычно <tt>`/usr/local/mysql/data'</tt> для
бинарной установки или <tt>`/usr/local/var'</tt> для установки из исходных текстов).
Обратите внимание, что это тот каталог, который был задан во время
настройки, а не указанный при помощи <code>--datadir</code> при запуске <code>mysqld</code>!
(<code>--datadir</code> не оказывает влияния на просмотр файлов параметров сервером,
так как их просмотр происходит до обработки аргументов командной строки).

</P>
<P>
В Windows считывание принятых по умолчанию параметров MySQL производится
из следующих файлов:

</P>
<TABLE BORDER>
<TR><TD><strong>Имя файла</strong> </TD><TD> <strong>Назначение</strong>
</TD></TR>
<TR><TD><code>windows-system-directory\my.ini</code> </TD><TD> Общие параметры
</TD></TR>
<TR><TD><code>C:\my.cnf</code> </TD><TD> Общие параметры
</TD></TR>
</TABLE>

<P>
Обратите внимание на то, что в Windows все пути необходимо указывать при
помощи <code>/</code> вместо <code>\.</code> Если необходимо использовать <code>\,</code> то его нужно указать
дважды, так как <code>\</code> является знаком перехода в MySQL.

</P>
<P>
<A NAME="IDX440"></A>
MySQL пытается прочитать файлы параметров в указанном выше порядке. Если
существует несколько таких файлов, то параметр, указанный в файле, идущем
позже, имеет преимущество над таким же параметром, указанным в файле,
расположенном ранее. Параметры, указанные в командной строке, обладают
более высоким приоритетом по отношению к параметрам, указанным в любом из
файлов параметров. Некоторые параметры можно задавать при помощи
переменных окружения. Параметры, указанные в командной строке или в файлах
параметров, обладают преимуществом по отношению к переменным окружения
(see section <A HREF="manual.ru.html#Environment_variables">E  Переменные окружения</A>).

</P>
<P>
Приводим список программ, поддерживающих файлы параметров: <code>mysql</code>,
<code>mysqladmin</code>, <code>mysqld</code>, <code>mysqld_safe</code>, <code>mysql.server</code>, <code>mysqldump</code>, <code>mysqlimport</code>,
<code>mysqlshow</code>, <code>mysqlcheck</code>, <code>myisamchk</code> и <code>myisampack</code>.

</P>
<P>
Любой параметр, который может быть задан в командной строке при запуске
программы MySQL, может быть также задан в файле параметров (без
предваряющего двойного слэша). Чтобы получить список доступных параметров,
следует запустить программу с параметром <code>--help</code>.

</P>
<P>
Файлы параметров могут содержать строки следующего вида:

</P>
<DL COMPACT>

<DT><code>#comment</code>
<DD>
Строки комментариев начинаются с символа <samp>`#'</samp> или <samp>`;'</samp>. Пустые строки
игнорируются.

<DT><code>[group]</code>
<DD>
группа представляет собой имя программы или группы, для которой необходимо
задать параметры. Любые параметры или строки, задающие значения
переменных, которые указаны после строки группы, будут относиться к
названной группе, пока не закончится файл параметров или же не будет
указана другая строка группы.

<DT><code>option</code>
<DD>
Эквивалент <code>--option</code> в командной строке.

<DT><code>option=value</code>
<DD>
Эквивалент <code>--option=value</code> в командной строке.

<DT><code>set-variable = variable=value</code>
<DD>
Эквивалент <code>--set-variable variable=value</code> в командной строке. Данный
синтаксис необходимо использовать для задания переменных <code>mysqld</code>.
Заметьте, <code>--set-variable</code> не используется с MySQL 4.0. Просто используйте
<code>--variable=value</code>.

</DL>

<P>
Группа <code>client</code> обеспечивает возможность задавать параметры, относящиеся ко
всем клиентам MySQL (кроме самого <code>mysqld</code>). Эта группа великолепно подходит
для указания пароля, используемого при подсоединении к серверу (но при
этом следует убедиться, что разрешение на чтение и запись этого файла есть
только у вас).

</P>
<P>
Обратите внимание на то, что для параметров и значений все введенные перед
ними и после них пробелы автоматически удаляются. В строках значений можно
использовать такие экранирующие секвенции: <samp>`\b'</samp>, <samp>`\t'</samp>, <samp>`\n'</samp>, <samp>`\r'</samp>, <samp>`\\'</samp> и
<samp>`\s'</samp> (<samp>`\s'</samp> - это пробел).

</P>
<P>
Пример типичного глобального файла параметров:

</P>

<PRE>
[client]
port=3306
socket=/tmp/mysql.sock

[mysqld]
port=3306
socket=/tmp/mysql.sock
set-variable = key_buffer_size=16M
set-variable = max_allowed_packet=1M

[mysqldump]
quick
</PRE>

<P>
Пример типичного файла параметров пользователя:

</P>

<PRE>
[client]
# Указанный пароль будет направлен всем стандартным клиентам MySQL
password=my_password

[mysql]
no-auto-rehash
set-variable = connect_timeout=2

[mysqlhotcopy]
interactive-timeout
</PRE>

<P>
<A NAME="IDX441"></A>
Если у вас дистрибутив исходного кода, то примеры конфигурационных файлов
с именами <tt>`my-xxxx.cnf'</tt> можно найти в каталоге <tt>`support-files'</tt>. В случае
бинарного дистрибутива следует обратиться к каталогу <tt>`DIR/support-files'</tt>,
где <code>DIR</code> - имя каталога установки MySQL (обычно <tt>`/usr/local/mysql'</tt>). На
данный момент там приведены примеры файлов конфигурации для малых,
средних, больших и очень больших систем. Чтобы поэкспериментировать с
файлом, можно скопировать <tt>`my-xxxx.cnf'</tt> в свой домашний каталог
(переименуйте копию в <tt>`.my.cnf'</tt>).

</P>
<P>
Все поддерживающие файлы параметров клиенты MySQL принимают следующие
параметры:

</P>
<TABLE BORDER>
<TR><TD><strong>Параметр</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD>--no-defaults </TD><TD> Не читать информацию из файлов параметров.
</TD></TR>
<TR><TD>--print-defaults </TD><TD> Вывести имя программы и все параметры, которые ей передаются.
</TD></TR>
<TR><TD>--defaults-file=full-path-to-default-file </TD><TD> Использовать только указанный файл конфигурации.
</TD></TR>
<TR><TD>--defaults-extra-file=full-path-to-default-file </TD><TD> Прочитать этот файл конфигурации после глобального файла конфигурации, но перед файлом конфигурации пользователя.
</TD></TR>
</TABLE>

<P>
Обратите внимание на то, что указанные выше параметры должны идти первыми
в командной строке! Однако параметр <code>--print-defaults</code> может использоваться
сразу после команд <code>--defaults-xxx-file</code>.

</P>
<P>
Примечание для разработчиков: обработка файла параметров происходит
следующим образом: все совпадающие параметры (т.е. параметры в
соответствующих группах) обрабатываются перед любыми аргументами командной
строки. Этот алгоритм хорошо подходит для программ, которые в случае, если
один и тот же параметр указывается несколько раз, используют последний
экземпляр параметра. Если же вы работаете со старой программой, которая
считывает заданные несколько раз параметры указанным образом, но не читает
файлы параметров, необходимо добавить только две строки, чтобы у нее
появилась эта возможность. Чтобы увидеть, как это делается, достаточно
ознакомиться с исходным кодом любого стандартного клиента MySQL.

</P>
<P>
В скриптах оболочки для анализа файлов <code>config</code> можно использовать команду
<tt>`my_print_defaults'</tt>:

</P>

<PRE>
shell&#62; my_print_defaults client mysql
--port=3306
--socket=/tmp/mysql.sock
--no-auto-rehash
</PRE>

<P>
Приведенные выше выходные данные содержат все параметры для групп <code>client</code> и
<code>mysql</code>.

</P>


<H3><A NAME="Installing_many_servers" HREF="manual.ru_toc.html#Installing_many_servers">4.1.3  Установка нескольких серверов на один компьютер</A></H3>

<P>
<A NAME="IDX442"></A>
<A NAME="IDX443"></A>
<A NAME="IDX444"></A>
<A NAME="IDX445"></A>

</P>
<P>
В некоторых случаях необходимо, чтобы на одном компьютере работало
несколько различных серверов <code>mysqld</code>: например, если нужно  запустить для
тестирования новую версию MySQL совместно со старой версией, которая
находится в работе, или когда разным пользователям нужно предоставить
доступ к различным серверам <code>mysqld</code>, с которыми они умеют обращаться
самостоятельно.

</P>
<P>
Один из способов запустить новый сервер -- указать ему другой канал и
порт, например, таким образом:

</P>
<P>
<A NAME="IDX446"></A>
<A NAME="IDX447"></A>
<A NAME="IDX448"></A>
<A NAME="IDX449"></A>

<PRE>
shell&#62; MYSQL_UNIX_PORT=/tmp/mysqld-new.sock
shell&#62; MYSQL_TCP_PORT=3307
shell&#62; export MYSQL_UNIX_PORT MYSQL_TCP_PORT
shell&#62; scripts/mysql_install_db
shell&#62; bin/safe_mysqld &#38;
</PRE>

<P>
Приложение, в котором описаны переменные окружения, включает список других
переменных окружения, которые можно использовать для управления <code>mysqld</code>
(see section <A HREF="manual.ru.html#Environment_variables">E  Переменные окружения</A>).

</P>
<P>
В приведенном выше примере представлен грубый быстрый метод, который
обычно применяется для тестирования. Преимуществом данного метода является
то, что все соединения, которые устанавливаются в указанной выше оболочке,
автоматически направляются на новый запущенный сервер!

</P>
<P>
Если работать с несколькими серверами необходимо постоянно, то нужно
создать файл параметров для каждого сервера (see section <A HREF="manual.ru.html#Option_files">4.1.2  Файлы параметров <tt>`my.cnf'</tt></A>). В скрипте запуска, который выполняется при каждой загрузке,
следует указать оба сервера:

</P>
<P>
<code>safe_mysqld --defaults-file=path-to-option-file</code>

</P>
<P>
Для серверов должны быть различными по крайней мере следующие параметры:

</P>

<UL>
<LI>port=#

<LI>socket=path

<LI>pid-file=path

</UL>

<P>
Приведенные ниже параметры, если они используются, также должны
различаться:

</P>

<UL>
<LI>log=path

<LI>log-bin=path

<LI>log-update=path

<LI>log-isam=path

<LI>bdb-logdir=path

<LI>shared-memory-base-name (Новое в MySQL 4.1)

</UL>

<P>
Если требуется увеличить производительность, необходимо также задать
разные значения для следующих параметров:

</P>

<UL>
<LI>tmpdir=path

<LI>bdb-tmpdir=path

</UL>

<P>
See section <A HREF="manual.ru.html#Command-line_options">4.1.1  Параметры командной строки <code>mysqld</code></A>.
Начиная с MySQL 4.1, в <code>tmpdir</code> могут быть указаны несколько путей, разделенных
двоеточием <code>:</code> (точкой с запятой на Windows <code>;</code>). Эти пути будут 
использованы в ротации. Эта функция может быть использована для того, чтобы распределить
данные между разными физическими дисками. 

</P>
<P>
Если производится установка бинарной версии MySQL (файлы .tar), которая
запускается из <code>./bin/safe_mysqld</code>, то в большинстве случаев единственными
параметрами, которые необходимо добавить/изменить, являются аргументы
<code>socket</code> и <code>port</code> для <code>safe_mysqld</code>.

</P>
<P>
See section <A HREF="manual.ru.html#Multiple_servers">4.1.4  Запуск нескольких серверов MySQL на одном компьютере</A>.

</P>


<H3><A NAME="Multiple_servers" HREF="manual.ru_toc.html#Multiple_servers">4.1.4  Запуск нескольких серверов MySQL на одном компьютере</A></H3>

<P>
<A NAME="IDX450"></A>
<A NAME="IDX451"></A>
<A NAME="IDX452"></A>

</P>
<P>
Иногда возникают обстоятельства, когда необходимо запустить несколько
серверов на одном компьютере. Например, может понадобиться произвести
тестирование новой версии MySQL, не изменяя текущей установки программы.
Или еще вариант: вы являетесь поставщиком услуг Internet, который хочет
предоставить независимые установки MySQL для различных клиентов.

</P>
<P>
Если необходимо запустить несколько серверов, то проще всего
скомпилировать серверы с различными портами TCP/IP и файлами сокетов (see section <A HREF="manual.ru.html#mysqld_multi">4.7.3  <code>Mysqld_multi</code>, программа для управления множеством серверов MySQL</A>).

</P>
<P>
Предположим, что существующий сервер настроен на принятые по умолчанию
номер порта и файл сокета. Настроим новый сервер при помощи команды
<code>configure</code> следующим образом:

</P>

<PRE>
shell&#62; ./configure --with-tcp-port=port_number \
             --with-unix-socket-path=file_name \
             --prefix=/usr/local/mysql-3.22.9
</PRE>

<P>
Здесь <code>port_number</code> и <code>file_name</code> должны отличаться от принятого по умолчанию
номера порта и пути файла сокета, а значение <code>--prefix</code> должно указывать
каталог установки, который отличается от того, в котором установлен
текущий MySQL.

</P>
<P>
Проверить сокет, используемый установленным на данный момент сервером
MySQL, можно при помощи следующей команды:

</P>

<PRE>
shell&#62; mysqladmin -h hostname --port=port_number variables
</PRE>

<P>
Обратите внимание: если указать ``<code>localhost</code>'' как имя удаленного компьютера,
<code>mysqladmin</code> по умолчанию будет использовать сокеты Unix вместо TCP/IP.

</P>
<P>
В MySQL 4.1  вы также можете указать протокол, который надлежит использовать с помощью опции 
<code>--protocol=(TCP | SOCKET | PIPE | MEMORY)</code>.

</P>
<P>
Если на используемом порту находится сервер MySQL, то будет выдан список
самых важных настраиваемых переменных в MySQL, включая имя сокета.

</P>
<P>
Повторно компилировать новый сервер MySQL нет необходимости, его просто
нужно запустить с другими параметрами для порта и сокета. Используемые
порт и сокет можно изменить, указав их как параметры запуска для
<code>safe_mysqld</code>:

</P>

<PRE>
shell&#62; /path/to/safe_mysqld --socket=file_name --port=port_number
</PRE>

<P>
Модуль <code>mysqld_multi</code> может также в качестве аргумента принимать <code>safe_mysqld</code>
(или <code>mysqld</code>) и передавать параметры из файла конфигурации для <code>safe_mysqld</code>
и дальше для <code>mysqld</code>.

</P>
<P>
Если новый сервер запускается на том же каталоге базы данных, что и другой
сервер с включенной записью в журналы, необходимо также указать имена
файлов журналов для <code>safe_mysqld</code> при помощи параметров <code>--log</code>, <code>--log-update</code> 
или <code>--log-slow-queries</code>. Иначе оба сервера могут попытаться осуществить
запись в один и тот же файл журнала.

</P>
<P>
<strong>Предупреждение</strong>: обычно нельзя допускать, чтобы два сервера одновременно
заносили данные в одну и ту же базу данных! Если ваша операционная система
не поддерживает безотказную блокировку доступа, это может привести к
возникновению неприятных сюрпризов!

</P>
<P>
Если для второго сервера понадобится использовать другой каталог базы
данных, можно воспользоваться параметром <code>--datadir=path</code> для <code>safe_mysqld</code>.

</P>
<P>
<strong>Обратите внимание</strong>: запуск нескольких серверов MySQL (<code>mysqlds</code>) на различных
компьютерах с доступом к одному каталогу данных через сетевую файловую
систему обычно  не приводит ни к чему хорошему! Проблема состоит в том,
что сетевая файловая система становится узким местом для передачи данных.
Она не предназначена для такого использования. И даже в этом случае
придется искать решение, которое позволит обеспечить отсутствие конфликтов
между двумя или более модулями <code>mysqld</code>. На данный момент не существует
платформы, которая обеспечивает на 100% надежную блокировку доступа к
файлам (обычно демон <code>lockd</code>) во всех возможных ситуациях. Кроме того,
существует еще одна опасность при использовании сетевой файловой системы:
эта система может еще больше усложнить работу программы <code>lockd</code>. Поэтому
лучше смотреть на вещи проще и забыть об этой идее. Оптимальным решением
будет использование одного компьютера с несколькими центральными
процессорами и с операционной системой, которая эффективно управляет
потоками.

</P>
<P>
Если нужно подсоединиться к серверу MySQL, который работает с портом,
отличным от того, с которым откомпилирован ваш клиент, можно
воспользоваться одним из следующих методов:

</P>

<UL>
<LI>

Запустите клиент с параметрами <code>--host 'hostname' --port=port_number</code>,
чтобы подсоединиться через TCP/IP, или <code>[--host localhost
--socket=file_name]</code>, чтобы подсоединиться через сокет Unix.

<LI>

Запускайте ваш клиент с <code>--protocol=tcp</code> для подключения по TCP/IP и 
<code>--protocol=socket</code> для подключения через сокет Unix. 

<LI>

В своей программе на языке C или Perl можно задать аргументы порта или
сокета при подсоединении к серверу MySQL.

<LI>

При использовании модуля Perl <code>DBD::mysql</code> можно прочитать параметры из
файлов параметров MySQL (see section <A HREF="manual.ru.html#Option_files">4.1.2  Файлы параметров <tt>`my.cnf'</tt></A>).


<PRE>
$dsn = "DBI:mysql:test;mysql_read_default_group=client;
mysql_read_default_file=/usr/local/mysql/data/my.cnf"
$dbh = DBI-&#62;connect($dsn, $user, $password);
</PRE>

<A NAME="IDX453"></A>
<A NAME="IDX454"></A>
<A NAME="IDX455"></A>
<A NAME="IDX456"></A>
<LI>

Задайте переменные окружения <code>MYSQL_UNIX_PORT</code> и <code>MYSQL_TCP_PORT</code>, чтобы
указать на сокет Unix и порт TCP/IP до запуска клиентов. Если обычно
используются конкретные сокет или порт, команды для задания этих
переменных окружения необходимо поместить в свой файл <tt>`.login'</tt> (see section <A HREF="manual.ru.html#Environment_variables">E  Переменные окружения</A>).

<LI>

<A NAME="IDX457"></A>
Укажите принятые по умолчанию сокет и порт TCP/IP в файле <tt>`.my.cnf'</tt> в своем
домашнем каталоге (see section <A HREF="manual.ru.html#Option_files">4.1.2  Файлы параметров <tt>`my.cnf'</tt></A>).
</UL>



<H2><A NAME="Privilege_system" HREF="manual.ru_toc.html#Privilege_system">4.2  Общие проблемы безопасности и система привилегий доступа MySQL</A></H2>

<P>
<A NAME="IDX458"></A>
<A NAME="IDX459"></A>
<A NAME="IDX460"></A>
<A NAME="IDX461"></A>
<A NAME="IDX462"></A>
<A NAME="IDX463"></A>
<A NAME="IDX464"></A>

</P>
<P>
MySQL имеет развитую, но нестандартную систему обеспечения безопасности и
привилегий доступа. В этом разделе дается описание ее работы.

</P>



<H3><A NAME="General_security" HREF="manual.ru_toc.html#General_security">4.2.1  Общие принципы обеспечения безопасности</A></H3>

<P>
С данным разделом должны ознакомиться все, кто использует MySQL на
компьютерах, подключенных к Internet, - чтобы избежать наиболее
распространенных ошибок, приводящих к нарушению безопасности системы.

</P>
<P>
При обсуждении вопросов безопасности мы акцентируем внимание на
необходимости защиты всего серверного хоста (а не одного лишь сервера
MySQL) от всех возможных типов атак: перехвата, внесения изменений,
считывания и отказа в обслуживании. Данный раздел не охватывает всех
аспектов готовности к работе и отказоустойчивости.

</P>
<P>
Используемая в MySQL система безопасности для всех подключений, запросов и
иных операций, которые может пытаться выполнить пользователь, базируется
на списках контроля доступа ACLs (Access Control Lists). Обеспечивается
также некоторая поддержка SSL-соединений между клиентами и серверами
MySQL. Многие из рассматриваемых здесь концепций не относятся
исключительно к MySQL; те же общие соображения применимы практически ко
всем приложениям.

</P>
<P>
При работе в MySQL старайтесь следовать приведенным ниже инструкциям:

</P>

<UL>
<LI>

<strong>Не предоставляйте никому (за исключением пользователя <code>mysql</code> под именем
<code>root</code>) доступа к таблице <code>user</code> в базе данных <code>mysql</code>! Это чрезвычайно
важно</strong>. <strong>В MySQL зашифрованный пароль является реальным паролем</strong>. Узнав
пароль, занесенный в таблицу <code>user</code>, и имея доступ к удаленному
компьютеру, занесенному в соответствующую учетную запись, <strong>войти в
систему под именем зарегистрированного владельца пароля  легко может
кто угодно</strong>.

<LI>

Изучите систему прав доступа MySQL. Для управления доступом к MySQL
служат команды <code>GRANT</code> и <code>REVOKE</code>. Предоставляйте ровно столько прав,
сколько необходимо, и не больше. Никогда не предоставляйте права всем
хостам. Полезно проводить следующие контрольные проверки:


<UL>
<LI>

Выполните команду <code>mysql -u root</code>. Если удается успешно установить
соединение с сервером без получения запроса пароля, значит, у вас
имеются проблемы. Это означает, что кто угодно может
подсоединиться к вашему серверу MySQL как клиент MySQL под именем
<code>root</code>, получая таким образом право неограниченного доступа!
Проанализируйте инструкцию по инсталляции MySQL, обращая особое
внимание на ту часть, которая касается задания пароля
пользователя <code>root</code>.

<LI>

С помощью команды <code>SHOW GRANTS</code> проверьте, кто и к каким ресурсам
имеет доступ. Воспользуйтесь командой <code>REVOKE</code>, отмените права
доступа, которые не являются необходимыми.
</UL>

<LI>

Не храните в базе данных незашифрованных паролей. Если злоумышленнику
удастся получить доступ на ваш компьютер, то в его руках окажется
полный список паролей, которыми он может воспользоваться. Применяйте
для шифрования <code>MD5()</code>, <code>SHA1()</code> или другие односторонние хеш-функции.

<LI>

Не используйте в качестве пароля слова из словарей. Для взлома такого
рода паролей имеются специальные программы. Даже слова типа
``xfish98'' - это очень плохие пароли. Куда лучше ``duag98'': здесь
используется то же слово ``fish'', но при этом буквы в нем заменены
ближайшими к ним слева буквами клавиатуры QWERTY. Еще один метод -
составить парольное слово из первых букв слов какого либо
словосочетания, например ``Mhall'' - по фразе ``Mary had a little
lamb.'' Такой пароль легко запоминается и его легко вводить. А вот
разгадать его тому, кто не знает ключевой фразы, будет непросто.

<LI>

Приобретите брандмауэр. Эта мера обеспечит защиту как минимум от
половины всех видов несанкционированного использования любого ПО, с
которым вы работаете. Разместите MySQL за брандмауэром или в
демилитаризованной зоне (demilitarised zone - DMZ). Полезно проводить
следующие контрольные проверки:

<LI>

Попробуйте просканировать ваши порты из Internet с помощью
утилиты типа <code>nmap</code>. MySQL использует по умолчанию порт 3306. Этот
порт должен быть недоступен с неблагонадежных компьютеров. Еще
один простой способ проверить, открыт или нет ваш MySQL-порт, -
попытаться выполнить с какой либо удаленной машины следующую
команду, где <code>server_host</code> - имя хоста, на котором установлен ваш
сервер MySQL:


<PRE>
shell&#62; telnet server_host 3306
</PRE>

Если соединение будет установлено, и вы получите какие-либо бессмысленные
символы, это будет означать, что порт открыт, и его нужно закрыть на
брандмауэре или маршрутизаторе (если, конечно, нет действительно веских
причин держать его открытым). Если же <code>telnet</code> просто зависнет или в
подсоединении будет отказано, тогда все в порядке: порт заблокирован.

<LI>

Не доверяйте никаким данным, которые вводят пользователи. Возможны
попытки перехитрить вашу программу путем ввода последовательностей
специальных или экранированных символов в веб-формы, URL-ы или любое
приложение, созданное вами. Убедитесь, что защита вашего приложения не
будет нарушена, если пользователь введет что-нибудь типа "<code>'; DROP
DATABASE mysql;</code>''. Это крайний случай, но действия хакеров,
использующих подобную технологию, могут привести к потере информации и
появлению брешей в системе безопасности, если вы не готовы к ним. Не
следует также забывать о необходимости проверки цифровых данных
(распространенной ошибкой является защита только строк). Некоторые
полагают, что если в базе данных хранятся только открытые данные, то в
ее защите нет необходимости. Это неверно. Такие базы могут стать
объектом успешных атак типа отказа от обслуживания. Простейший способ
защиты от взломов такого типа - заключать числовые константы в
кавычки: <code>SELECT * FROM table WHERE ID='234'</code>, а не <code>SELECT * FROM table
WHERE ID=23</code>4. MySQL автоматически преобразует эту строку в число и
выбросит из нее все нецифровые символы. Полезно проводить следующие
контрольные проверки:


<UL>
<LI>

Для всех веб-приложений:

<UL>
<LI>

Попробуйте ввести во все ваши веб-формы одинарные и двойные
кавычки - <samp>`''</samp> и <samp>`"'</samp>. Если MySQL выдаст любое сообщение об
ошибке, немедленно разберитесь, в чем дело.

<LI>

Попробуйте видоизменять динамические URL, добавляя в них <code>%22</code> 
(<samp>`"'</samp>), <code>%23</code> (<samp>`#'</samp>), и <code>%27</code> (<samp>`''</samp>).

<LI>

Попробуйте модифицировать типы данных в динамических URL -
замените числовые на символьные, используя символы из
предыдущих примеров. Ваше приложение должно быть устойчиво к
подобного рода атакам.

<LI>

Попробуйте вводить в числовые поля вместо цифр буквы,
пробелы и специальные символы. Ваше приложение должно либо
удалять их до передачи в MySQL, либо выдавать сообщение об
ошибке. Пропускать в MySQL значения без проверки очень
опасно!

<LI>

Проверяйте размер данных перед тем, как они будут переданы в
MySQL.

<LI>

При подключении приложения к базе данных лучше использовать
имя пользователя, отличное от того, которое вы используете
для целей администрирования. Не предоставляйте своим
приложениям больше прав доступа, чем это необходимо.
</UL>

<LI>

Пользователям PHP:

<UL>
<LI>Проверьте функцию <code>addslashes()</code>. Что касается PHP 4.0.3, то в

нем имеется функция <code>mysql_escape_string()</code>, базирующаяся на
функции с тем же именем из MySQL C API.
</UL>

<LI>

Пользователям MySQL C API:

<UL>
<LI>Проверьте API-вызов  <code>mysql_real_escape_string()</code>.

</UL>

<LI>

Пользователям MySQL++:

<UL>
<LI>Проверьте такие модификаторы, как <code>escape</code> и <code>quote</code>, - для

потоков запросов.
</UL>

<LI>

Пользователям Perl DBI:

<UL>
<LI>Проверьте метод <code>quote()</code> или используйте для проверки

заполнители.
</UL>

<LI>

Пользователям Java JDBC:

<UL>
<LI>Используйте для проверки объект <code>PreparedStatement</code> и

символы-заполнители.
</UL>

</UL>

<LI>

Не передавайте по Internet открытые (незашифрованные) данные. Они
могут оказаться у кого угодно, имеющего достаточно времени и
возможностей для того, чтобы перехватить их и использовать в своих
целях. Используйте вместо этого протоколы с шифрованием данных, такие
как SSL и SSH. MySQL, начиная с версии 4.0.0, поддерживает собственные
SSL-соединения. Пересылка по SSH (SSH Port Forwarding) может быть
использована для создания туннеля передачи данных с шифрованием и
сжатием.

<LI>

Научитесь пользоваться утилитами <code>tcpdump</code> и <code>strings</code>. В большинстве
случаев проверить, являются ли потоки данных MySQL зашифрованными,
можно с помощью команды, подобной той, которая приведена ниже:


<PRE>
shell&#62; tcpdump -l -i eth0 -w - src or dst port 3306 | strings
</PRE>

(Она работает под Linux, и будет, с незначительными изменениями, работать
под другими системами.) Предупреждение: если вы не видите данных, это еще
не гарантирует того, что они зашифрованы. Если требуется высокий уровень
безопасности, обратитесь к экспертам в этой области.
</UL>



<H3><A NAME="Security" HREF="manual.ru_toc.html#Security">4.2.2  Как обезопасить MySQL от хакеров</A></H3>

<P>
<A NAME="IDX465"></A>
<A NAME="IDX466"></A>

</P>
<P>
При подключении к серверу MySQL используется, как правило, пароль. По
линии связи пароль не передается в виде открытого текста, но алгоритм
шифрования не очень сложный. Толковый хакер, если ему удастся перехватить
трафик между клиентом и сервером, при определенной настойчивости может
взломать пароль. Поэтому если связь между клиентом и сервером
осуществляется по ненадежной сети, для шифрования связи следует
использовать SSH-туннель.

</P>
<P>
Вся остальная информация передается в текстовом виде и может быть
прочитана кем угодно, кто в состоянии отлеживать подключение. Если это вас
беспокоит, можно воспользоваться протоколом со сжатием данных (в MySQL
3.22 и последующих версиях), что значительно затруднит подобные действия.
Чтобы еще более повысить безопасность связи, следует использовать протокол
<code>ssh</code>. <code>Open source</code>-клиент <code>ssh</code> доступен на веб-сайте <a HREF="http://www.openssh.org/">http://www.openssh.org/</a>,
а коммерческий <code>ssh</code>-клиент можно получить на веб-сайте 
<a HREF="http://www.ssh.com/">http://www.ssh.com/</a>. С помощью такого протокола можно обеспечить
зашифрованную связь по протоколу TCP/IP между сервером MySQL и клиентом
MySQL.

</P>
<P>
Если вы используете MySQL 4.0, то можете также использовать
предусмотренную в этой версии поддержку протокола OpenSSL. Обратитесь  к 
разделу See section <A HREF="manual.ru.html#Secure_connections">4.3.9  Использование безопасных соединений</A>.

</P>
<P>
Для обеспечения безопасности MySQL-системы необходимо строго
придерживаться следующих рекомендаций:

</P>

<UL>
<LI>

У всех пользователей MySQL должны быть пароли. Для приложений
клиент/сервер является общепринятым, что клиент может указывать любое
имя пользователя, но если для <code>other_user</code> не задан пароль, то кто
угодно может зайти под любым именем, просто введя <code>mysql -u other_user
db_name</code>. Чтобы этого избежать, можно изменить пароль для всех
пользователей, отредактировав скрипт <code>mysql_install_db</code> перед запуском
приложения, или только пароль для <code>root</code>-пользователя MySQL, как это
показано ниже:


<PRE>
shell&#62; mysql -u root mysql
mysql&#62; UPDATE user SET Password=PASSWORD('new_password')
		   WHERE user='root';
mysql&#62; FLUSH PRIVILEGES;
</PRE>

<LI>

Не запускайте демон MySQL от имени пользователя Unix <code>root</code>. Это очень
опасно, потому что любой пользователь, имеющий привилегию <code>FILE</code>, будет
в состоянии создавать файлы как пользователь <code>root</code> (например
<code>~root/.bashrc</code>). Чтобы предотвратить это, <code>mysqld</code> откажется запускаться
от имени пользователя <code>root</code>, если это не будет задано напрямую с
помощью опции <code>--user=root</code>. В то же время <code>mysqld</code> может быть запущена от
имени обычного непривилегированного пользователя. Можно также, в целях
еще большего укрепления безопасности, создать новый аккаунт
Unix-пользователя <code>mysql</code>. При запуске <code>mysqld</code> от имени другого
пользователя Unix у вас отпадает необходимость заменять имя
пользователя <code>root</code> в таблице <code>user</code>, так как имена пользователя в MySQL
не имеют ничего общего с аккаунтами пользователей Unix. Для запуска
<code>mysqld</code> от имени другого пользователя Unix добавьте в группу <code>[mysqld]</code> 
файла опций <tt>`/etc/my.cnf'</tt> или файла опций <tt>`my.cnf'</tt>, находящегося в
каталоге данных сервера, строку <code>user</code>, задающую имя пользователя.
Например:


<PRE>
[mysqld]
user=mysql
</PRE>

В результате сервер будет запущен от имени назначенного пользователя,
независимо от того, производится запуск вручную или посредством
<code>safe_mysqld</code> или <code>mysql.server</code>. Для получения дополнительной информации
обратитесь к разделу See section <A HREF="manual.ru.html#Changing_MySQL_user">A.3.2  Запуск MySQL от обычного пользователя</A>.

<LI>

Откажитесь от поддержки символических ссылок на таблицы (ее можно
запретить с помощью опции <code>--skip-symlink</code>). Это особенно важно в том
случае, если вы запускаете <code>mysqld</code> от имени пользователя <code>root</code>,
поскольку у того, кто имеет право доступа для записи в каталоги данных
<code>mysqld</code>, появляется возможность стереть любой файл в системе!
Обратитесь к разделу See section <A HREF="manual.ru.html#Symbolic_links_to_tables">5.6.1.2  Использование символических ссылок для таблиц</A>.

<LI>

Удостоверьтесь, что пользователь Unix, от имени которого запускается
mysqld, является единственным пользователем, имеющим привилегии
чтения/записи в директории базы данных.

<LI>

Не предоставляйте привилегии <code>PROCESS</code> всем пользователям. Команда
<code>mysqladmin processlist</code> выводит текст запросов, обрабатываемых в данный
момент. Следовательно, любой пользователь, имеющий право на выполнение
этой команды, получает возможность прочитать, например, такой запрос
другого пользователя, как <code>UPDATE</code> user <code>SET
password=PASSWORD('not_secure')</code>. <code>mysqld</code> резервирует добавочное
подключение для пользователей, имеющих привилегию <code>PROCESS</code>, так что
пользователь MySQL под именем <code>root</code> может подключиться и осуществлять
контроль даже в том случае, когда все обычные подключения заняты.

<LI>

Не предоставляйте привилегии <code>FILE</code> всем пользователям. Любой
пользователь, имеющий такую привилегию, может записать в любом месте
файловой системы файл с привилегиями демона <code>mysqld</code>! Чтобы обеспечить
здесь хоть минимальную защиту, все файлы создаваемые с помощью команды
<code>SELECT ... INTO OUTFILE</code>, сделаны общедоступными для записи, но
перезаписать существующие файлы нельзя. 

Привилегия <code>FILE</code> может быть
также использована для чтения любого файла, доступного пользователю
Unix, от имени которого запускается сервер. 

Можно также прочитать любой файл в текущую базу данных.  Это может быть
использовано в корыстных целях. Возможно, например, с помощью команды
<code>LOAD DATA</code> загрузить <tt>`/etc/passwd'</tt> в таблицу и прочесть ее позже с
помощью <code>SELECT</code>.

<LI>

Если вы не доверяете своему DNS-серверу, используйте в таблицах
привилегий вместо имен хостов IP-адреса. В любом случае следует очень
осторожно относиться к внесению в таблицы привилегий записей, в
которых значения имени хоста содержат шаблонные символы!

<LI>

Чтобы ограничить число подключений, доступных для отдельного
пользователя, можно в <code>mysqld</code> задать значение переменной
<code>max_user_connections</code>.
</UL>



<H3><A NAME="Privileges_options" HREF="manual.ru_toc.html#Privileges_options">4.2.3  Опции запуска <code>mysqld</code>, относящиеся к безопасности</A></H3>

<P>
К безопасности имеют отношение следующие опции <code>mysqld</code>:

</P>
<DL COMPACT>

<DT><code>--local-infile[=(0|1)]</code>
<DD>
При установке опции <code>--local-infile=0</code> теряется возможность выполнять
команду <code>LOAD DATA LOCAL INFILE</code>.

<DT><code>--safe-show-database</code>
<DD>
Если установлена эта опция, команда <code>SHOW DATABASES</code> возвращает только те
базы данных, для которых пользователь имеет какую-либо привилегию. Начиная
с версии 4.0.2 эта опция отменена и не служит ни для чего (она включена по
умолчанию), т.к. сейчас у нас имеется привилегия <code>SHOW DATABASES</code>.
Обратитесь к разделу See section <A HREF="manual.ru.html#GRANT">4.3.1  Синтаксис команд <code>GRANT</code> и <code>REVOKE</code></A>.

<DT><code>--safe-user-create</code>
<DD>
При установке этой опции пользователь не может создавать новых
пользователей с помощью команды <code>GRANT</code>, если у него отсутствует привилегия
<code>INSERT</code> для таблицы <code>mysql.user</code>. Чтобы предоставить пользователю доступ
именно для создания новых пользователей с теми привилегиями, которые он
имеет право предоставлять, для этого пользователя следует установить
следующую привилегию:


<PRE>
mysql&#62; GRANT INSERT(user) ON mysql.user TO 'user'&hacute;ostname';
</PRE>

Задание такой привилегии гарантирует, что этот пользователь не сможет
непосредственно вносить изменения ни в одном из столбцов привилегий, а для
предоставления привилегий другим пользователям должен будет использовать
команду <code>GRANT</code>.

<DT><code>--skip-grant-tables</code>
<DD>
Установка этой опции запрещает серверу вообще использовать систему
привилегий. Это открывает кому бы то ни было полный доступ ко всем базам
данных! (После запуска сервера можно заставить его снова использовать
таблицы привилегий с помощью команды mysqladmin <code>flush-privileges</code> или
<code>mysqladmin reload</code>.)

<DT><code>--skip-name-resolve</code>
<DD>
При установке данной опции имена хостов не разрешены. Все значения в
столбцах <code>Host</code> таблиц привилегий должны быть либо IP-адресами, либо
<code>localhost</code>.

<DT><code>--skip-networking</code>
<DD>
Не разрешает осуществлять подсоединений по протоколу TCP/IP через сеть
(данная опция запрещает такие подсоединения). Все подсоединения к <code>mysqld</code>
должны осуществляться посредством сокетов Unix. Для MySQL старше 3.23.27 эта опция 
непригодна для систем, в которых используются MIT-потоки, так как MIT-потоки на тот
момент не поддерживали сокеты Unix.

<DT><code>--skip-show-database</code>
<DD>
Разрешает выполнение команды <code>SHOW DATABASES</code> только в том случае, если
пользователь имеет привилегию <code>SHOW DATABASES</code>. Начиная с версии 4.0.2 в
этой опции больше нет необходимости, т.к. теперь доступ может
предоставляться избирательно с помощью привилегии <code>SHOW DATABASES</code>.
</DL>



<H3><A NAME="LOAD_DATA_LOCAL" HREF="manual.ru_toc.html#LOAD_DATA_LOCAL">4.2.4  Вопросы безопасности, относящиеся к команде LOAD DATA LOCAL</A></H3>

<P>
Чтобы решить проблемы безопасности, которые могут возникнуть при
использовании команды <code>LOAD DATA LOCAL</code>,в MySQL 3.23.49 и MySQL 4.0.2 были
добавлены новые опции.

</P>
<P>
При поддержке этой команды могут возникнуть две проблемы:

</P>
<P>
Первая: поскольку чтение файла инициируется сервером, теоретически имеется
возможность создать ``доработанный'' при помощи патча сервер MySQL,
способный читать любые файлы на клиентской машине, к которой текущий
пользователь имеет доступ для чтения, в то время, когда клиент направляет
запрос к таблице.

</P>
<P>
Вторая: в веб-среде, в которой подсоединение клиентов осуществляется с
веб-сервера, пользователь может использовать команду <code>LOAD DATA LOCAL</code> для
чтения любых файлов, к которым процесс веб-сервера имеет доступ для чтения
(если предположить, что пользователь может выполнять на сервере SQL любые
команды).

</P>
<P>
Эти проблемы решаются с помощью двух следующих исправлений:

</P>
<P>
Если вы конфигурируете MySQL без опции <code>--enable-local-infile</code>, то команда
<code>LOAD DATA LOCAL</code> будет запрещена для всех клиентов, если, конечно, они не
будут вызывать <code>mysql_options (... MYSQL_OPT_LOCAL_INFILE, 0)</code>. Обратитесь
к разделу See section <A HREF="manual.ru.html#mysql_options">8.4.3.39  <code>mysql_options()</code></A>.

</P>
<P>
В случае клиента mysql, <code>LOAD DATA LOCAL</code> может быть разблокирована заданием
опции <code>--local-infile[=1]</code> или заблокирована с помощью опции
<code>--local-infile=0</code>.

</P>
<P>
По умолчанию все MySQL-клиенты и библиотеки компилируются с опцией
<code>--enable-local-infile</code> для обеспечения совместимости с MySQL 3.23.48 и
более старыми версиями.

</P>
<P>
Блокировку всех команд <code>LOAD DATA LOCAL</code> на MySQL-сервере можно осуществить
путем запуска <code>mysqld</code> с опцией <code>--local-infile=0</code>.

</P>
<P>
В случае, если команда <code>LOAD DATA LOCAL INFILE</code> заблокирована на сервере или
клиенте, вы получите следующее сообщение об ошибке (1148):

</P>

<PRE>
The used command is not allowed with this MySQL version
</PRE>



<H3><A NAME="What_Privileges" HREF="manual.ru_toc.html#What_Privileges">4.2.5  Функции, выполняемые системой привилегий</A></H3>

<P>
<A NAME="IDX467"></A>
<A NAME="IDX468"></A>
<A NAME="IDX469"></A>
<A NAME="IDX470"></A>

</P>
<P>
Основной функцией системы привилегий MySQL является аутентификация
пользователя, подключающегося с указанного хоста, и ассоциирование его с
привилегиями базы данных, такими как <code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code> и <code>DELETE</code>.

</P>
<P>
К дополнительным функциональным возможностям системы привилегий относятся
следующие: возможность обслуживания анонимного пользователя и
предоставление привилегий для таких специфических для MySQL функций, как
<code>LOAD DATA INFILE</code> и функции администрирования.

</P>


<H3><A NAME="Privileges" HREF="manual.ru_toc.html#Privileges">4.2.6  Как работает система привилегий</A></H3>

<P>
<A NAME="IDX471"></A>

</P>
<P>
Система привилегий MySQL обеспечивает пользователям возможность выполнять
только те действия, которые им разрешены в соответствии с их
обязанностями. Когда вы подсоединяетесь к серверу MySQL, ваша личность
устанавливается по имени <strong>хоста, с которого вы подсоединяетесь</strong>, и <strong>имени
пользователя, которое вы указываете</strong>. Система предоставляет привилегии в
соответствии с вашей личностью и <strong>тем, что вы хотите делать</strong>.

</P>
<P>
MySQL идентифицирует пользователя как по имени хоста, так и по имени
пользователя, т.к. нет оснований полагать что данное имя пользователя
принадлежит во всей Сети единственному человеку. Например, пользователь
<code>joe</code>, устанавливающий соединение с <code>office.com</code>, вовсе не обязательно один и
тот же человек, что и пользователь <code>joe</code>, подсоединяющийся с <code>elsewhere.com</code>.
MySQL решает эту проблему, обеспечивая возможность различать
пользователей, подсоединяющихся с различных хостов под одним и тем же
именем пользователя: вы можете предоставлять <code>joe</code> один набор привилегий,
если он подсоединяется с <code>office.com</code>, и другой набор привилегий, если <code>joe</code>
подсоединяется с <code>elsewhere.com</code>.

</P>
<P>
Управление доступом в MySQL осуществляется в два этапа:

</P>

<UL>
<LI>

Этап 1: сервер проверяет, имеется ли у вас вообще разрешение на
подсоединение.

2item
Этап 2: если таковое имеется, сервер проверяет каждый из ваших
запросов, чтобы убедиться в том, что у вас имеется достаточно
привилегий для его выполнения. Например, если вы пытаетесь выбрать
строки в таблице базы данных или удалить таблицу из базы данных,
сервер в первом случае проверяет, имеется ли у вас для этой таблицы
привилегия <code>SELECT</code>, а во втором - имеется ли у вас для этой базы данных
привилегия <code>DROP</code>.
</UL>

<P>
На обеих стадиях управления доступом сервер использует таблицы <code>user</code>, <code>db</code> и 
<code>host</code> из базы данных <code>mysql</code>. Ниже перечислены поля этих таблиц привилегий:

</P>
<TABLE BORDER>
<TR><TD><strong>Имя таблицы</strong> </TD><TD> <code>user</code> </TD><TD> <code>db</code> </TD><TD> <code>host</code>

</TD></TR>
<TR><TD><strong>Поля контекста</strong> </TD><TD> <code>Host</code> </TD><TD> <code>Host</code> </TD><TD> <code>Host</code>
</TD></TR>
<TR><TD></TD><TD> <code>User</code> </TD><TD> <code>Db</code> </TD><TD> <code>Db</code>
</TD></TR>
<TR><TD></TD><TD> <code>Password</code> </TD><TD> <code>User</code> </TD><TD>

</TD></TR>
<TR><TD><strong>Поля привилегий</strong> </TD><TD> <code>Select_priv</code> </TD><TD> <code>Select_priv</code> </TD><TD> <code>Select_priv</code>
</TD></TR>
<TR><TD></TD><TD> <code>Insert_priv</code> </TD><TD> <code>Insert_priv</code> </TD><TD> <code>Insert_priv</code>
</TD></TR>
<TR><TD></TD><TD> <code>Update_priv</code> </TD><TD> <code>Update_priv</code> </TD><TD> <code>Update_priv</code>
</TD></TR>
<TR><TD></TD><TD> <code>Delete_priv</code> </TD><TD> <code>Delete_priv</code> </TD><TD> <code>Delete_priv</code>
</TD></TR>
<TR><TD></TD><TD> <code>Index_priv</code> </TD><TD> <code>Index_priv</code> </TD><TD> <code>Index_priv</code>
</TD></TR>
<TR><TD></TD><TD> <code>Alter_priv</code> </TD><TD> <code>Alter_priv</code> </TD><TD> <code>Alter_priv</code>
</TD></TR>
<TR><TD></TD><TD> <code>Create_priv</code> </TD><TD> <code>Create_priv</code> </TD><TD> <code>Create_priv</code>
</TD></TR>
<TR><TD></TD><TD> <code>Drop_priv</code> </TD><TD> <code>Drop_priv</code> </TD><TD> <code>Drop_priv</code>
</TD></TR>
<TR><TD></TD><TD> <code>Grant_priv</code> </TD><TD> <code>Grant_priv</code> </TD><TD> <code>Grant_priv</code>
</TD></TR>
<TR><TD></TD><TD> <code>References_priv</code> </TD><TD> </TD><TD> 
</TD></TR>
<TR><TD></TD><TD> <code>Reload_priv</code> </TD><TD> </TD><TD> 
</TD></TR>
<TR><TD></TD><TD> <code>Shutdown_priv</code> </TD><TD> </TD><TD> 
</TD></TR>
<TR><TD></TD><TD> <code>Process_priv</code> </TD><TD> </TD><TD> 
</TD></TR>
<TR><TD></TD><TD> <code>File_priv</code> </TD><TD> </TD><TD> 
</TD></TR>
</TABLE>

<P>
На втором этапе управления доступом (верификация запросов) сервер может (в
случае, если запрос относится к таблицам базы данных) дополнительно
обратиться к таблицам <code>tables_priv</code> и <code>columns_priv</code>. Поля этих таблиц
привилегий перечислены ниже:

</P>
<TABLE BORDER>
<TR><TD><strong>Имя  таблицы</strong> </TD><TD> <code>tables_priv</code> </TD><TD> <code>columns_priv</code>

</TD></TR>
<TR><TD><strong>Поля контекста</strong> </TD><TD> <code>Host</code> </TD><TD> <code>Host</code>
</TD></TR>
<TR><TD></TD><TD> <code>Db</code> </TD><TD> <code>Db</code>
</TD></TR>
<TR><TD></TD><TD> <code>User</code> </TD><TD> <code>User</code>
</TD></TR>
<TR><TD></TD><TD> <code>Table_name</code> </TD><TD> <code>Table_name</code>
</TD></TR>
<TR><TD></TD><TD> </TD><TD> <code>Column_name</code>

</TD></TR>
<TR><TD><strong>Поля привилегий</strong> </TD><TD> <code>Table_priv</code> </TD><TD> <code>Column_priv</code>
</TD></TR>
<TR><TD></TD><TD> <code>Column_priv</code> </TD><TD>

</TD></TR>
<TR><TD><strong>Иные  поля</strong> </TD><TD> <code>Timestamp</code> </TD><TD> <code>Timestamp</code>
</TD></TR>
<TR><TD></TD><TD> <code>Grantor</code> </TD><TD>
</TD></TR>
</TABLE>

<P>
Каждая таблица привилегий включает в себя поля контекста и поля
привилегий.

</P>
<P>
Поля контекста определяют область действия каждой из записей в таблицах,
т.е. контекст, к которому имеет отношение та или иная запись. Например,
запись в таблице <code>user</code>, в полях <code>Host</code> и <code>User</code> которой указаны значения
<code>'thomas.loc.gov'</code>  <code>'bob'</code>, предназначена для аутентификации подсоединений к
серверу с хоста <code>thomas.loc.gov</code> под именем пользователя <code>bob</code>. Аналогично
запись в таблице <code>db</code>, в полях <code>Host</code>, <code>User</code> и <code>Db</code> которой указаны значения
<code>'thomas.loc.gov'</code>, <code>'bob'</code> и <code>'reports'</code>,  будет использоваться при попытке
пользователя по именем <code>bob</code> подсоединиться с хоста <code>thomas.loc.gov</code> и
получить доступ к базе данных <code>reports</code>. В полях контекста в таблицах
<code>tables_priv</code> и <code>columns_priv</code> указаны таблицы или комбинации таблиц/столбцов,
к которым применяется каждая запись.

</P>
<P>
<A NAME="IDX472"></A>
При контроле доступа сравнение значений в полях <code>Host</code> осуществляется без
учета регистра. Значения в полях <code>User</code>, <code>Password</code>, <code>Db</code> и <code>Table_name</code> также
являются независимыми от регистра символов. Значения в поле <code>Column_name</code>
являются независимыми от регистра символов, начиная с MySQL 3.22.12.

</P>
<P>
В полях привилегий указываются привилегии, предоставляемые записью в
таблице, т.е. то, какие операции разрешено выполнять. Сервер формирует
полное описание привилегий пользователя, комбинируя информацию, хранящуюся
в разных таблицах привилегий. Это осуществляется по правилам, которые
описаны в разделе See section <A HREF="manual.ru.html#Request_access">4.2.10  Управление доступом, этап 2: верификация запросов</A>.

</P>
<P>
Поля контекста - это строковые значения, объявленные, как показано ниже;
устанавливаемым по умолчанию значением для каждого из них является пустая
строка:

</P>
<TABLE BORDER>
<TR><TD><strong>Имя поля</strong> </TD><TD> <strong>Тип</strong> </TD><TD> <strong>Примечания</strong>
</TD></TR>
<TR><TD><code>Host</code> </TD><TD> <code>CHAR(60)</code> </TD><TD>
</TD></TR>
<TR><TD><code>User</code> </TD><TD> <code>CHAR(16)</code> </TD><TD>
</TD></TR>
<TR><TD><code>Password</code> </TD><TD> <code>CHAR(16)</code> </TD><TD>
</TD></TR>
<TR><TD><code>Db</code> </TD><TD> <code>CHAR(64)</code> </TD><TD> (<code>CHAR(60)</code> для  таблиц
<code>tables_priv</code> и <code>columns_priv</code> tables)
</TD></TR>
<TR><TD><code>Table_name</code> </TD><TD> <code>CHAR(60)</code> </TD><TD>
</TD></TR>
<TR><TD><code>Column_name</code> </TD><TD> <code>CHAR(60)</code> </TD><TD>
</TD></TR>
</TABLE>

<P>
В таблицах <code>user</code>, <code>db</code> и <code>host</code> все поля привилегий имеют объявленный тип
<code>ENUM('N','Y')</code>, т.е. возможно одно из двух значений - <code>'N'</code> и <code>'Y'</code>, а
устанавливаемым по умолчанию является <code>'N'</code>.

</P>
<P>
В таблицах <code>tables_priv</code> and <code>columns_priv</code> поля привилегий объявляются как
<code>SET</code>:

</P>
<TABLE BORDER>
<TR><TD><strong>Имя таблицы</strong>
 </TD><TD> <strong>Имя поля</strong>
 </TD><TD> <strong>Допустимые элементы набора</strong>
</TD></TR>
<TR><TD><code>tables_priv</code>
 </TD><TD> <code>Table_priv</code>
 </TD><TD> <code>'Select', 'Insert', 'Update', 'Delete', 'Create', 'Drop', 'Grant', 'References', 'Index', 'Alter'</code>
</TD></TR>
<TR><TD><code>tables_priv</code>
 </TD><TD> <code>Column_priv</code>
 </TD><TD> <code>'Select', 'Insert', 'Update', 'References'</code>
</TD></TR>
<TR><TD><code>columns_priv</code>
 </TD><TD> <code>Column_priv</code>
 </TD><TD> <code>'Select', 'Insert', 'Update', 'References'</code>
</TD></TR>
</TABLE>

<P>
Если кратко, то сервер использует таблицы привилегий следующим образом:

</P>

<UL>
<LI>

Поля контекста таблицы <code>user</code> определяют, разрешить входящее
подсоединение или отказать в нем. Для разрешенных подсоединений любые
привилегии, предоставленные в таблице <code>user</code>, означают глобальные
привилегии пользователя (привилегии суперпользователя). Эти привилегии
распространяются на все базы данных, размещенные на сервере.

<LI>

Таблицы <code>db</code> и <code>host</code> используются совместно:


<UL>
<LI>

Поля контекста таблицы <code>db</code> определяют, каким пользователям, при
подсоединении с каких хостов разрешен доступ к каким базам
данных. Поля привилегий определяют разрешенные операции.

<LI>

Таблица <code>host</code> используется в качестве расширения таблицы <code>db</code> в
случае, если необходимо применить некоторую запись из таблицы db
к разным хостам. Например, если вы хотите предоставить
пользователю возможность обращаться к базе данных с различных
хостов сети, оставьте пустым поле в записи этого пользователя в
таблице <code>db</code>, а затем внесите в таблицу <code>host</code> запись для каждого из
этих хостов. Более подробно данный механизм описан в разделе
See section <A HREF="manual.ru.html#Request_access">4.2.10  Управление доступом, этап 2: верификация запросов</A>.
</UL>

<LI>

Таблицы <code>tables_priv</code> и <code>columns_priv</code> подобны таблице <code>db</code>, но областью их
действия является уже уровень таблиц и столбцов, а не баз данных.
</UL>

<P>
Заметим, что привилегии администрирования (<code>RELOAD</code>, <code>SHUTDOWN</code> и т.д..)
задаются только в таблице <code>user</code>. Это связано с тем, что операции
администрирования являются операциями над самим сервером, а не над базами
данных, поэтому не смысла перечислять такие привилегии в других таблицах
привилегий. Фактически для того, чтобы выяснить, имеете ли вы привилегии
выполнять операции администрирования, достаточно обратиться только к
таблице <code>user</code>.

</P>
<P>
Привилегия <code>FILE</code> также задается только в таблице <code>user</code>. Она не является
привилегией администрирования как таковой, но возможность производить
чтение или запись файлов на серверном хосте не связана с базой данных, к
которой вы получаете доступ.

</P>
<P>
Сервер <code>mysqld</code> считывает содержимое таблиц привилегий единожды, при его
запуске. О том, каким образом изменения, вносимые в таблицы привилегий,
вступают в силу, рассказывается в разделе See section <A HREF="manual.ru.html#Privilege_changes">4.3.3  Когда изменения в привилегиях вступают в силу</A>.

</P>
<P>
При внесении изменений в таблицы привилегий стоит убедиться в том, что
ваши изменения задают привилегии именно так, как задумано вами. Помощь по
диагностике проблем вы найдете в разделе See section <A HREF="manual.ru.html#Access_denied">4.2.11  Причины появления ошибок <code>Access denied</code> ("в доступе отказано")</A>. По вопросам, связанным с безопасностью, следует обращаться к разделу See section <A HREF="manual.ru.html#Security">4.2.2  Как обезопасить MySQL от хакеров</A>.

</P>
<P>
Полезным диагностическим инструментом является скрипт <code>mysqlaccess</code>,
которым Ив Карлье (Yves Carlier) укомплектовал дистрибутив MySQL.
Запустите <code>mysqlaccess</code> с опцией <code>--help</code> чтобы посмотреть, как он работает.
Заметим, что <code>mysqlaccess</code> контролирует доступ, используя только таблицы
<code>user</code>, <code>db</code> и <code>host</code>. Он не проверяет привилегии на уровне таблиц или
столбцов.

</P>


<H3><A NAME="Privileges_provided" HREF="manual.ru_toc.html#Privileges_provided">4.2.7  Привилегии, предоставляемые MySQL</A></H3>

<P>
<A NAME="IDX473"></A>

</P>
<P>
Информация о привилегиях пользователя хранится в таблицах <code>user</code>, <code>db</code>, <code>host</code>,
<code>tables_priv</code> и <code>columns_priv</code> базы данных <code>mysql</code> (т.е. в базе данных с именем
mysql). Сервер MySQL считывает содержимое этих таблиц во время запуска, и
в случаях, указанных в разделе See section <A HREF="manual.ru.html#Privilege_changes">4.3.3  Когда изменения в привилегиях вступают в силу</A>.

</P>
<P>
Ниже приведены имена, используемые в данном руководстве для ссылок на
привилегии, предоставляемые в MySQL 4.0.2. Здесь же указаны имена
табличных столбцов, ассоциированных с каждой из привилегий в таблицах
привилегий, наряду с контекстом, в котором эти привилегии имеют силу:

</P>
<TABLE BORDER>
<TR><TD><strong>Привилегия</strong> </TD><TD> <strong>Столбец</strong> </TD><TD> <strong>Контекст</strong>
</TD></TR>
<TR><TD><code>ALTER</code> </TD><TD> <code>Alter_priv</code> </TD><TD> таблицы
</TD></TR>
<TR><TD><code>DELETE</code> </TD><TD> <code>Delete_priv</code> </TD><TD> таблицы
</TD></TR>
<TR><TD><code>INDEX</code> </TD><TD> <code>Index_priv</code> </TD><TD> таблицы
</TD></TR>
<TR><TD><code>INSERT</code> </TD><TD> <code>Insert_priv</code> </TD><TD> таблицы
</TD></TR>
<TR><TD><code>SELECT</code> </TD><TD> <code>Select_priv</code> </TD><TD> таблицы
</TD></TR>
<TR><TD><code>UPDATE</code> </TD><TD> <code>Update_priv</code> </TD><TD> таблицы
</TD></TR>
<TR><TD><code>CREATE</code> </TD><TD> <code>Create_priv</code> </TD><TD> базы данных, таблицы или индексы
</TD></TR>
<TR><TD><code>DROP</code> </TD><TD> <code>Drop_priv</code> </TD><TD> базы данных или таблицы
</TD></TR>
<TR><TD><code>GRANT</code> </TD><TD> <code>Grant_priv</code> </TD><TD> базы данных или таблицы
</TD></TR>
<TR><TD><code>REFERENCES</code> </TD><TD> <code>References_priv</code> </TD><TD> базы данных или таблицы
</TD></TR>
<TR><TD><code>CREATE TEMPORARY TABLES</code> </TD><TD> <code>Create_tmp_table_priv</code> </TD><TD> администрирование сервера
</TD></TR>
<TR><TD><code>EXECUTE</code> </TD><TD> <code>Execute_priv</code> </TD><TD> администрирование сервера
</TD></TR>
<TR><TD><code>FILE</code> </TD><TD> <code>File_priv</code> </TD><TD> доступ к файлам на сервере
</TD></TR>
<TR><TD><code>LOCK TABLES</code> </TD><TD> <code>Lock_tables_priv</code> </TD><TD> администрирование сервера
</TD></TR>
<TR><TD><code>PROCESS</code> </TD><TD> <code>Process_priv</code> </TD><TD> администрирование сервера
</TD></TR>
<TR><TD><code>RELOAD</code> </TD><TD> <code>Reload_priv</code> </TD><TD> администрирование сервера
</TD></TR>
<TR><TD><code>REPLICATION CLIENT</code> </TD><TD> <code>Repl_client_priv</code> </TD><TD> администрирование сервера
</TD></TR>
<TR><TD><code>REPLICATION SLAVE</code> </TD><TD> <code>Repl_slave_priv</code> </TD><TD> администрирование сервера
</TD></TR>
<TR><TD><code>SHOW DATABASES</code> </TD><TD> <code>Show_db_priv</code> </TD><TD> администрирование сервера
</TD></TR>
<TR><TD><code>SHUTDOWN</code> </TD><TD> <code>Shutdown_priv</code> </TD><TD> администрирование сервера
</TD></TR>
<TR><TD><code>SUPER</code> </TD><TD> <code>Super_priv</code> </TD><TD> администрирование сервера
</TD></TR>
</TABLE>

<P>
Привилегии <code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code> и  <code>DELETE</code> позволяют выполнять операции
над строками таблиц баз данных.

</P>
<P>
Для операторов <code>SELECT</code> привилегия <code>SELECT</code> требуется только в том случае,
если они действительно извлекают строки из таблицы.. В ряде случае можно
выполнять операторы <code>SELECT</code>, даже не имея разрешения на доступ ни к одной
базе данных на сервере. Например: клиент <code>mysql</code> вы можете использовать в
качестве обычного калькулятора:

</P>

<PRE>
mysql&#62; SELECT 1+1;
mysql&#62; SELECT PI()*2;
</PRE>

<P>
Привилегия <code>INDEX</code> позволяет создавать или уничтожать (удалять) индексы.

</P>
<P>
Привилегия <code>ALTER</code> позволяет использовать команду <code>ALTER TABLE</code>.

</P>
<P>
Привилегии <code>CREATE</code> и <code>DROP</code> позволяют создавать новые базы данных и таблицы
или уничтожать (удалять) существующие базы данных и таблицы.

</P>
<P>
Заметим, что в случае, если пользователю предоставляется привилегия <code>DROP</code>
по отношению к базе данных <code>mysql</code>, он может уничтожить базу данных, в
которой хранятся привилегии доступа в MySQL!

</P>
<P>
Привилегия <code>GRANT</code> позволяет вам предоставлять другим пользователям
привилегии, которыми обладаете вы сами.

</P>
<P>
Привилегия <code>FILE</code> дает вам право читать и записывать файлы на сервере с
помощью операторов <code>LOAD DATA INFILE</code> и <code>SELECT ... INTO OUTFILE</code>. Любой
пользователь, которому предоставлена такая привилегия, имеет право
прочитать или записать любой файл, который может прочитать или записать
сервер MySQL. Пользователь также может прочитать любой файл в каталоге текущей базы данных. 
Однако существующие файлы перезаписывать нельзя.

</P>
<P>
Остальные привилегии используются для операций администрирования,
выполняемых с помощью программы <code>mysqladmin</code>. В таблице, приведенной ниже,
для каждой из привилегий администрирования показано, какие команды
<code>mysqladmin</code> она позволяет выполнять.

</P>
<TABLE BORDER>
<TR><TD><strong>Привилегия</strong> </TD><TD> <strong>Команды, разрешенные обладателю привилегии</strong>
</TD></TR>
<TR><TD><code>RELOAD</code> </TD><TD> <code>reload</code>, <code>refresh</code>,
<code>flush-privileges</code>, <code>flush-hosts</code>, <code>flush-logs</code>, and
<code>flush-tables</code>
</TD></TR>
<TR><TD><code>SHUTDOWN</code> </TD><TD> <code>shutdown</code>
</TD></TR>
<TR><TD><code>PROCESS</code> </TD><TD> <code>processlist</code>
</TD></TR>
<TR><TD><code>SUPER</code> </TD><TD> <code>kill</code>
</TD></TR>
</TABLE>

<P>
Команда <code>reload</code> заставляет сервер перечитать таблицы привилегий. Команда
<code>refresh</code> очищает все таблицы, а также открывает и закрывает файлы журналов.
<code>flush-privileges</code> является синонимом <code>reload</code>. Остальные команды <code>flush-*</code> 
выполняют функции, аналогичные функциям команды <code>refresh</code>, но с более узкой
областью действия. В некоторых случаях такие команды могут оказаться более
предпочтительными. Например, если вы хотите очистить только системные
журналы, команда <code>flush-logs</code> лучше, чем <code>refresh</code>.

</P>
<P>
Команда <code>shutdown</code> завершает работу сервера.

</P>
<P>
Команда <code>processlist</code> выводит информацию о задачах, выполняющихся на
сервере. Команда <code>kill</code> уничтожает серверные потоки. Собственные потоки
всегда можно просмотреть или уничтожить, но для отображения потоков,
запущенных другими пользователями, нужна привилегия <code>PROCESS</code>,а для
уничтожения потоков, запущенных другими пользователями, потребуется
привилегия <code>SUPER</code>. Обратитесь к разделу See section <A HREF="manual.ru.html#KILL">4.5.5  Синтаксис команды <code>KILL</code></A>. 

</P>
<P>
В общем случае идея предоставлять привилегии только тем пользователям,
которым они необходимы, хорошая, но к предоставлению некоторых из них
следует относиться особенно внимательно:

</P>

<UL>
<LI>

Привилегия <code>GRANT</code> позволяет пользователям передавать свои привилегии
другим пользователям. Два пользователя с неодинаковыми привилегиями,
имея привилегию <code>GRANT</code>, способны объединить свои привилегии.

<LI>

Привилегия <code>ALTER</code> может быть использована для переименования таблиц и
разрушения таким образом всей системы привилегий.

<LI>

Привилегия <code>FILE</code> может использоваться злонамеренно для считывания
любого доступного файла, хранящегося на сервере, или любого файла в каталоге
текущей базы данных в таблицу, к содержимому которой можно затем получить
доступ с помощью команды <code>SELECT</code>. 

<LI>

Привилегия <code>SHUTDOWN</code> может использоваться злонамеренно для полного
прекращения работы сервера и, таким образом, полного запрещения
обслуживания других пользователей.

<LI>

Привилегия <code>PROCESS</code> может быть использована для просмотра открытого
текста запросов выполняющихся в данный момент, включая запросы на
установку или изменение паролей.

<LI>

Привилегии доступа к базе данных <code>mysql</code> могут быть использованы для
изменения паролей и другой информации, относящейся к привилегиям
доступа. (Пароли хранятся в зашифрованном виде, поэтому злоумышленник
не сможет просто прочесть их, чтобы получить пароли в виде обычного
текста). Получив доступ к столбцу паролей <code>mysql.user</code>, любой
пользователь может войти на сервер MySQL под именем другого
пользователя (имея достаточные привилегии, тот же самый пользователь
может заменить пароль на другой).
</UL>

<P>
Есть вещи, которые система привилегий MySQL делать не может:

</P>

<UL>
<LI>

Нельзя явно указать, что данному пользователю должен быть закрыт
доступ. Т.е. вы не можете явно выбрать пользователя и затем отказать
ему в подключении.

<LI>

Нельзя указать, что некий пользователь имеет привилегии создавать или
удалять таблицы в базе данных, но не имеет привилегий создавать или
удалять саму базу данных.
</UL>



<H3><A NAME="Connecting" HREF="manual.ru_toc.html#Connecting">4.2.8  Соединение с сервером MySQL</A></H3>

<P>
<A NAME="IDX474"></A>
<A NAME="IDX475"></A>
<A NAME="IDX476"></A>
<A NAME="IDX477"></A>

</P>
<P>
Обычно для получения доступа к серверу MySQL необходимо сообщить
клиентской программе параметры подсоединения: указать хост, с которым вы
хотите соединиться, ваши имя пользователя и пароль. Например, клиент <code>mysql</code>
можно запустить следующим образом (необязательные аргументы заключены в
квадратные скобки <samp>`['</samp> и <samp>`]'</samp>):

</P>

<PRE>
shell&#62; mysql [-h host_name] [-u user_name] [-pyour_pass]
</PRE>

<P>
Альтернативной  формой  опций  <code>-h</code>, <code>-u</code>, и  <code>-p</code>  являются  <code>--host=host_name</code>,
<code>--user=user_name</code> и <code>--password=your_pass</code>. Заметим, что между <code>-p</code> или
<code>--password=</code> и следующим за ними паролем <em>пробела нет</em>.

</P>
<P>
<strong>Внимание</strong>: Указывать пароль в командной строке небезопасно! Любой
пользователь в вашей системе может впоследствии отыскать ваш пароль, введя
команду типа <code>ps auxww</code>. Обратитесь к разделу See section <A HREF="manual.ru.html#Option_files">4.1.2  Файлы параметров <tt>`my.cnf'</tt></A>.

</P>
<P>
В <code>mysql</code> используются следующие значения по умолчанию для параметров
подсоединения, пропущенных в командной строке:

</P>

<UL>
<LI>

Значением по умолчанию для имени хоста является <code>localhost</code>.

<LI>

Значением по умолчанию для имени пользователя является ваш
Unix-аккаунт.

<LI>

При отсутствии префикса <code>-p</code> никакого пароля не указывается.
</UL>

<P>
Таким образом, для Unix-пользователя <code>joe</code> следующие команды являются
эквивалентными:

</P>

<PRE>
shell&#62; mysql -h localhost -u joe
shell&#62; mysql -h localhost
shell&#62; mysql -u joe
shell&#62; mysql
</PRE>

<P>
Другие клиенты MySQL ведут себя подобным же образом.

</P>
<P>
В Unix-системах можно задавать различные значения по умолчанию, которые
будут использоваться при соединении с сервером, чтобы избавиться от
необходимости каждый раз при вызове клиентской программы вводить их в
командной строке. Это можно сделать двумя способами:

</P>

<UL>
<LI>

Параметры подсоединения можно задать в разделе <code>[client]</code> файла
конфигурации <tt>`my.cnf'</tt>, который находится в вашей домашней директории.
Соответствующий раздел этого файла может иметь следующий вид:


<PRE>
[client]
host=host_name
user=user_name
password=your_pass
</PRE>

Обратитесь к разделу See section <A HREF="manual.ru.html#Option_files">4.1.2  Файлы параметров <tt>`my.cnf'</tt></A>.
<LI>

<A NAME="IDX478"></A>
<A NAME="IDX479"></A>
<A NAME="IDX480"></A>
<A NAME="IDX481"></A>
<A NAME="IDX482"></A>
<A NAME="IDX483"></A>
Параметры соединения можно задавать через переменные окружения. Для
<code>mysql</code> можно задать хост при помощи <code>MYSQL_HOST</code>. Для задания имени
пользователя для MySQL можно использовать <code>USER</code> (это относится только к
ОС Windows). Пароль может быть задан с помощью <code>MYSQL_PWD</code> (но это
небезопасно, см. следующий раздел). Обратитесь к разделу See section <A HREF="manual.ru.html#Environment_variables">E  Переменные окружения</A>.
</UL>



<H3><A NAME="Connection_access" HREF="manual.ru_toc.html#Connection_access">4.2.9  Управление доступом, этап 1: верификация подсоединения</A></H3>

<P>
<A NAME="IDX484"></A>
<A NAME="IDX485"></A>
<A NAME="IDX486"></A>
<A NAME="IDX487"></A>

</P>
<P>
При попытке соединения с сервером MySQL он либо устанавливает соединение,
либо отказывает в нем - на основе данных о вашей личности и того, можете
ли вы подтвердить их соответствующим паролем. Если нет, сервер полностью
отказывает вам в доступе. В противном случае сервер устанавливает
соединение, затем переходит ко второму этапу и ожидает запросов.

</P>
<P>
Личность задается двумя порциями информации:

</P>

<UL>
<LI>

хостом, с которого вы подсоединяетесь

<LI>

вашим именем пользователя MySQL
</UL>

<P>
Проверка личности осуществляется с помощью трех полей контекста таблицы
<code>user</code> (<code>Host</code>, <code>User</code> и <code>Password</code>). Сервер устанавливает соединение только в том
случае, если находит в таблице <code>user</code> запись, в которой имя хоста и имя
пользователя совпадают с введенными вами, и вы указываете правильный
пароль.

</P>
<P>
Значения в полях контекста таблицы <code>user</code> могут задаваться следующим
образом:

</P>

<UL>
<LI>

В поле <code>Host</code> может указываться имя хоста, либо его IP-адрес, либо
<code>'localhost'</code> для обозначения локального хоста.

<LI>

В поле Host разрешается использовать шаблонные символы <samp>`%'</samp> и <samp>`_'</samp>.

<LI>

Значение <code>'%'</code> в поле <code>Host</code> означает любое имя хоста.

<LI>

Пустое значение в поле <code>Host</code> означает, что к этой привилегии должна
быть добавлена запись в таблице <code>host</code>, совпадающая с заданным именем
хоста. Дополнительную информацию по данной теме вы найдете в следующем
разделе.

<A NAME="IDX488"></A>
<LI>

Начиная с версии MySQL 3.23 для значений в поле в поле <code>Host</code>,
определенных в виде IP-адресов, можно задавать сетевую маску,
указывающую, сколько разрядов адреса будет использоваться для указания
номера сети. Например:


<PRE>
mysql&#62; GRANT ALL PRIVILEGES ON db.*
    -&#62; TO david&1acute;92.58.197.0/255.255.255.0';
</PRE>

В этом случае все IP-адреса, для которых выполняется следующее условие:


<PRE>
user_ip &#38; netmask = host_ip.
</PRE>

являются разрешенными для подсоединения. В предыдущем примере все
IP-адреса в диапазоне от 192.58.197.0 до 192.58.197.255 являются
разрешенными для подсоединения к серверу MySQL.

<LI>

<A NAME="IDX489"></A>
В поле <code>User</code> запрещено использовать шаблонные символы, но пустое
значение разрешено, и оно соответствует любому имени. Если запись в
таблице <code>user</code>, соответствующая входящему подсоединению, содержит пустое
имя пользователя, данный пользователь считается анонимным
пользователем (пользователем без имени), а заданное клиентом имя
пользователя игнорируется. Это означает, что при всех последующих
проверках доступа, осуществляемых на протяжении данного соединения
(т.е. на этапе 2), будет использоваться пустое имя пользователя.

<LI>

Поле <code>Password</code> может быть пустым. Это не означает, что в данном случае
подходит любой пароль. Если поле пароля пусто, пользователь должен
быть подсоединен без указания какого либо пароля.
</UL>

<P>
<A NAME="IDX490"></A>
Непустые значения в поле <code>Password</code> представляют собой зашифрованные пароли.
В MySQL пароли не хранятся в виде открытого текста, который может
прочитать кто угодно. Напротив, пароль, который вводится пользователем при
попытке подсоединения, шифруется (с помощью функции <code>PASSWORD()</code>). В
дальнейшем зашифрованный пароль используется клиентом/сервером в процессе
проверки его правильности (это делается вообще без пересылки пароля во
время подсоединения). Заметим, что с MySQL считает зашифрованный пароль
РЕАЛЬНЫМ паролем, поэтому не следует допускать к нему кого бы то ни было!
В частности, не разрешайте обычным пользователям доступ для чтения к
таблицам в базе <code>mysql</code>!

</P>
<P>
Примеры, приведенные ниже, показывают, каким входящим подсоединениям
соответствуют различные комбинации значений, указанных в полях <code>Host</code> и <code>User</code>
таблицы  <code>user</code>:

</P>
<TABLE BORDER>
<TR><TD><strong>Значение в поле</strong> <code>Host</code> </TD><TD> <strong>Значение в поле</strong> <code>User</code> </TD><TD> <strong>Подсоединения, которым соответствует запись</strong>
</TD></TR>
<TR><TD><code>'thomas.loc.gov'</code> </TD><TD> <code>'fred'</code> </TD><TD> <code>fred</code>, подключающийся  с <code>thomas.loc.gov</code>
</TD></TR>
<TR><TD><code>'thomas.loc.gov'</code> </TD><TD> <code>''</code> </TD><TD> Любой пользователь, подключающийся с <code>thomas.loc.gov</code>
</TD></TR>
<TR><TD><code>'%'</code> </TD><TD> <code>'fred'</code> </TD><TD> <code>fred</code>, подключающийся с любого хоста
</TD></TR>
<TR><TD><code>'%'</code> </TD><TD> <code>''</code> </TD><TD> Любой пользователь, подключающийся с любого хоста
</TD></TR>
<TR><TD><code>'%.loc.gov'</code> </TD><TD> <code>'fred'</code> </TD><TD> <code>fred</code>, подключающийся с любого хоста, принадлежащего домену <code>loc.gov</code>
</TD></TR>
<TR><TD><code>'x.y.%'</code> </TD><TD> <code>'fred'</code> </TD><TD> <code>fred</code>, подключающийся с <code>x.y.net</code>, <code>x.y.com</code>,<code>x.y.edu</code>, и т.д. (это, по-видимому, бесполезный вариант)
</TD></TR>
<TR><TD><code>'144.155.166.177'</code> </TD><TD> <code>'fred'</code> </TD><TD> <code>fred</code>, подключающийся с хоста, имеющего IP-адрес <code>144.155.166.177</code>
</TD></TR>
<TR><TD><code>'144.155.166.%'</code> </TD><TD> <code>'fred'</code> </TD><TD> <code>fred</code>, подключающийся с любого хоста в подсети <code>144.155.166</code> класса C
</TD></TR>
<TR><TD><code>'144.155.166.0/255.255.255.0'</code> </TD><TD> <code>'fred'</code> </TD><TD> То же самое, что и в предыдущем примере
</TD></TR>
</TABLE>

<P>
Поскольку в IP-адресе, указываемом в поле <code>Host</code>, могут использоваться
шаблонные символы (например <code>'144.155.166.%'</code> - данное значение
соответствует всем без исключения хостам указанной подсети), возникает
опасность, что кто-нибудь может попытаться воспользоваться этой
возможностью, указав имя хоста, например, как <code>144.155.166.somewhere.com</code>.
Чтобы ``поставить заслон'' таким попыткам, в MySQL не разрешены имена
хостов, начинающиеся с цифр и точки. Другими словами, имени хоста типа
<code>1.2.foo.com</code>, никогда не найдется соответствия в столбцах <code>Host</code> таблиц
привилегий. IP-адресу с шаблонными символами может соответствовать только
IP-адрес.

</P>
<P>
Входящее подсоединение может совпадать с несколькими записями в таблице
user. Например, как было показано выше, подсоединению с <code>thomas.loc.gov by</code> 
<code>fred</code> могут подходить разные записи. Каким образом сервер определяет, какую
из записей использовать, при совпадении с более чем одной из них? Для
этого после считывания таблицы <code>user</code> во время запуска сервер производит ее
сортировку, а затем, когда пользователь пытается установить соединение,
записи таблицы просматриваются в порядке их упорядочения,. Используется
первая подошедшая запись.

</P>
<P>
Сортировка таблицы user осуществляется следующим образом. Предположим,
таблица <code>user</code> имеет следующий вид:

</P>

<PRE>
+-----------+----------+-
| Host      | User     | ...
+-----------+----------+-
| %         | root     | ...
| %         | jeffrey  | ...
| localhost | root     | ...
| localhost |          | ...
+-----------+----------+-
</PRE>

<P>
При считывании этой таблицы сервер упорядочивает записи, начиная с
наиболее конкретных значений в столбце <code>Host</code> (<code>'%'</code> в столбце <code>Host</code> означает
``любой хост'' и является наименее конкретным). Записи с одинаковым
значением в столбце <code>Host</code> упорядочиваются между собой начиная с наиболее
конкретных значений в столбце <code>User</code> (пустое значение в столбце <code>User</code>
означает ``любой пользователь'' и является наименее конкретным).
Окончательно отсортированная таблица <code>user</code> имеет следующий вид:

</P>

<PRE>
+-----------+----------+-
| Host      | User     | ...
+-----------+----------+-
| localhost | root     | ...
| localhost |          | ...
| %         | jeffrey  | ...
| %         | root     | ...
+-----------+----------+-
</PRE>

<P>
<A NAME="IDX491"></A>
<A NAME="IDX492"></A>
<A NAME="IDX493"></A>

</P>
<P>
При попытке подсоединения сервер просматривает отсортированные записи и
использует первую подходящую запись. Для подсоединения с <code>localhost</code>
пользователя  <code>jeffrey</code> первыми подходящими записями являются записи со
значением <code>'localhost'</code> в столбце <code>Host</code>. Из них запись с пустым значением
имени пользователя соответствует и имени подсоединяющегося хоста и имени
пользователя. (запись <code>'%'/'jeffrey'</code> тоже подошла бы, но она -- не первая
подходящая в этой таблице).

</P>
<P>
Рассмотрим другой пример. Пусть таблица <code>user</code> имеет вид:

</P>

<PRE>
+----------------+----------+-
| Host           | User     | ...
+----------------+----------+-
| %              | jeffrey  | ...
| thomas.loc.gov |          | ...
+----------------+----------+-
</PRE>

<P>
Отсортированная таблица выглядит следующим образом:

</P>

<PRE>
+----------------+----------+-
| Host           | User     | ...
+----------------+----------+-
| thomas.loc.gov |          | ...
| %              | jeffrey  | ...
+----------------+----------+-
</PRE>

<P>
Для подсоединения пользователя <code>jeffrey</code> с <code>thomas.loc.gov</code> подходит первая
запись, в то время как для подсоединения <code>jeffrey</code> с <code>whitehouse.gov</code> -
вторая.

</P>
<P>
Существует распространенное заблуждение: иногда думают, что при поиске
записей для данного имени пользователя, соответствующих определенному
подсоединению, сервер первыми будет использовать записи, в которых этот
пользователь указан явно. Это абсолютно неверно, как и продемонстрировано
в предыдущем примере: для подсоединения пользователя <code>jeffrey</code> с
<code>thomas.loc.gov</code> первой подходящей записью является не запись, содержащая
значение <code>'jeffrey'</code> в поле <code>User</code>, а запись, не содержащая имени пользователя
вовсе!

</P>
<P>
Если у вас возникают проблемы с подсоединением к серверу, выведите
таблицу <code>user</code> и отсортируйте ее вручную, чтобы увидеть, где
происходит первое совпадение.

</P>
<P>
Если соединение было успешно, но ваши привилегии - не те, что вы ожидали
увижеть, вы можете использовать функцию <code>CURRENT_USER()</code> (новшество с
MySQL 4.0.6) чтобы узнать, какой комбинации пользователь/компьютер ваше
соединение соответствует. See section <A HREF="manual.ru.html#Miscellaneous_functions">6.3.6.2  Разные функции</A>.

</P>


<H3><A NAME="Request_access" HREF="manual.ru_toc.html#Request_access">4.2.10  Управление доступом, этап 2: верификация запросов</A></H3>

<P>
После установления соединения сервер приступает к выполнению второго
этапа. Для каждого поступающего запроса сервер проверяет, имеется ли у вас
достаточно привилегий для его выполнения, основываясь при этом на типе
операции, которую вы хотите выполнить. Теперь в действие вступают поля
привилегий в таблицах привилегий. Информация о привилегиях может
находиться в любой из таблиц привилегий - <code>user</code>, <code>db</code>, <code>host</code>, <code>tables_priv</code> или
<code>columns_priv</code>. Обработка таблиц привилегий осуществляется с помощью команд
<code>GRANT</code> и <code>REVOKE</code>. Обратитесь к разделу See section <A HREF="manual.ru.html#GRANT">4.3.1  Синтаксис команд <code>GRANT</code> и <code>REVOKE</code></A>. Интерес
может представлять раздел See section <A HREF="manual.ru.html#Privileges">4.2.6  Как работает система привилегий</A>, в котором перечислены поля, имеющиеся в каждой из
таблиц привилегий.

</P>
<P>
Таблица <code>user</code> предоставляет привилегии глобального характера, и их
применение не зависит от того, в какой базе вы работаете в данный момент.
Например, если таблица <code>user</code> предоставляет пользователю привилегию <code>DELETE</code>,
он может удалять строки из любой базы данных на серверном хосте! Иными
словами, привилегии в таблице <code>user</code> - это привилегии суперпользователя.
Поэтому целесообразно предоставлять привилегии в таблице <code>user</code> только
суперпользователям, таким как администраторы сервера или администраторы
баз данных. Что касается других пользователей, для их привилегий в таблице
user следует установить значение <code>'N'</code> и предоставлять им привилегии только
на уровне баз данных, используя для этого таблицы <code>db</code> и <code>host</code>.

</P>
<P>
<A NAME="IDX494"></A>
<A NAME="IDX495"></A>
<A NAME="IDX496"></A>

</P>
<P>
Таблицы <code>db</code> и <code>host</code> предоставляют привилегии на уровне базы данных. Значения
в полях контекста могут задаваться следующим образом:

</P>

<UL>
<LI>

Шаблонные символы <samp>`%'</samp> и <samp>`_'</samp> могут использоваться в полях <code>Host</code>
и <code>Db</code> любой таблицы. Если вы хотите использовать символ <samp>`_'</samp> как
часть имени базы данных, укажите его как <samp>`\_'</samp> в операторе <code>GRANT</code>. 

<LI>

Значение <code>'%'</code> в колонке <code>Host</code> таблицы <code>db</code> означает ``любой хост''. Пустое
значение в поле <code>Host</code> таблицы <code>db</code> означает ``за дополнительной
информацией следует обратиться к таблице <code>host</code>''.

<LI>

Значение <code>'%'</code> или пустое значение в поле <code>Host</code> таблицы <code>host</code> означает
``любой хост''.

<LI>

Значение <code>'%'</code> или пустое значение в поле <code>Db</code> любой из таблиц означает
``любая база данных''.

<LI>

Пустое значение в поле <code>User</code> любой из таблиц соответствует анонимному
пользователю.
</UL>

<P>
<A NAME="IDX497"></A>
<A NAME="IDX498"></A>
<A NAME="IDX499"></A>
<A NAME="IDX500"></A>
Таблицы <code>db</code> и <code>host</code> считываются и сортируются при запуске сервера (тогда же,
когда он считывает таблицу <code>user</code>). Таблица <code>db</code> сортируется по полям
контекста <code>Host</code>, <code>Db</code> и <code>User</code>, а таблица <code>host</code> - по полям контекста <code>Host</code> и <code>Db</code>.
Как и в случае таблицы <code>user</code>, при сортировке первыми отбираются наиболее
конкретные значения, а последними - наименее конкретные, а когда сервер
производит поиск совпадающих записей, используется первая совпадающая
запись, которую он находит.

</P>
<P>
<A NAME="IDX501"></A>
<A NAME="IDX502"></A>
Таблицы <code>tables_priv</code> и <code>columns_priv</code> предоставляют привилегии соответственно
на уровне таблиц и столбцов. Значения в полях контекста задаются следующим
образом:

</P>

<UL>
<LI>

В обеих таблицах в поле <code>Host</code> можно использовать шаблонные символы <samp>`%'</samp>
и <samp>`_'</samp>.

<LI>

В обеих таблицах <code>'%'</code> или пустое значение в поле <code>Host</code> означает ``любой
хост''.

В обеих таблицах в полях <code>Db</code>, <code>Table_name</code> и <code>Column_name</code> запрещено
использовать шаблонные символы или пустое значение.
</UL>

<P>
<code>Таблицы_priv</code> и <code>columns_priv</code> сортируются по полям <code>Host</code>, <code>Db</code> и <code>User</code>. Эта
сортировка проводится так же, как и в таблице <code>db</code>, хотя в данном случае
задача несколько упрощается, т.к. шаблонные символы могут встретиться
только в поле <code>Host</code>.

</P>
<P>
Ниже описывается процесс верификации запроса. (Если вы хорошо знакомы с
исходным кодом проверки доступа, то заметите некоторые отличия:
приведенное здесь описание несколько упрощено, чтобы сделать его более
понятным, однако оно соответствует тому, что в действительности делает
код).

</P>
<P>
Для запросов на администрирование (<code>SHUTDOWN</code>, <code>RELOAD</code>, etc.) сервер
проверяет запись только в таблице <code>user</code>, т.к. это единственная таблица,
которая определяет привилегии администрирования. Доступ предоставляется
при условии, что выбранная запись разрешает затребованные операции, и
запрещается в противном случае. Например, вы хотите завершить работу <code>mysql</code>
с помощью <code>mysqladmin shutdown</code>, но ваша запись в таблице <code>user</code> не
предоставляет вам привилегию <code>SHUTDOWN</code>. В этом случае в доступе будет
отказано без дальнейшей проверки таблицы <code>db</code> и <code>host</code> (поскольку в них
отсутствует столбец <code>Shutdown_priv</code>, в такой проверке нет необходимости).

</P>
<P>
В случае запросов, относящихся к базам данных (<code>INSERT</code>, <code>UPDATE</code> и т.д.),
сервер сначала проверяет глобальные привилегии пользователя (привилегии
суперпользователя), просматривая запись в таблице <code>user</code>. Если эта запись
разрешает затребованную операцию, доступ предоставляется. Если глобальные
привилегии, указанные в таблице <code>user</code>, недостаточны, сервер проверяет
таблицы <code>db</code> и <code>host</code> и определяет привилегии пользователя на уровне баз
данных:

</P>

<OL>
<LI>

Сервер просматривает таблицу <code>db</code> в поисках записи с подходящими
значениями в полях <code>Host</code>, <code>Db</code> и <code>User</code>. Поля <code>Host</code> и <code>User</code> сравниваются с
именем подключающегося хоста и именем пользователя MySQL. Поле <code>Db</code>
сравнивается с именем базы данных, к которой пользователь хочет
получить доступ. Если запись с подходящими значениями в полях <code>Host</code> и
<code>User</code> отсутствует, в доступе будет отказано.

<LI>

Если же в таблице <code>db</code> имеется подходящая запись и значение в поле <code>Host</code>
- не пустое, эта запись определяет привилегии пользователя, касающиеся
базы данных.

<LI>

Если же в подходящей записи, выбранной в таблице <code>db</code>, значение в поле
Host пустое, это означает, что перечень хостов, которым разрешен
доступ к требуемой базе данных, приведен в таблице <code>host</code>. В этом случае
дальнейший поиск производится в таблице <code>host</code>, где ищется запись с
подходящими значениями в полях <code>Host</code> и <code>Db</code>. Если ни одной подходящей
записи в таблице <code>host</code> нет, в доступе будет отказано. Если такая запись
имеется, привилегии пользователя на уровне базы данных вычисляются
путем логического умножения (не логического сложения!) привилегий,
найденных в записях, которые выбраны в таблицах <code>db</code> и <code>host</code>. Другими
словами, пользователю назначаются те привилегии, для которых в обеих
записях установлено значение <code>'Y'</code>. (Этот способ можно использовать
следующим образом: предоставить всеобщие привилегии в записи,
хранящейся в таблице <code>db</code>, а затем выборочно ограничить их отдельно по
каждому хосту, используя для этого записи в таблице <code>host</code>.)
</OL>

<P>
Определив привилегии на уровне базы данных, предоставляемые записями в
таблицах <code>db</code> и <code>host</code>, сервер добавляет их к глобальным привилегиям, заданным
в таблице <code>user</code>. Если в результате привилегий оказывается достаточно для
выполнения затребованной операции, доступ предоставляется. В противном
случае сервер проверяет по таблицам <code>tables_priv</code> и <code>columns_priv</code> привилегии
пользователя на уровне таблиц и столбцов и добавляет их к уже имеющимся
привилегиям. В зависимости от полученного результата доступ либо
предоставляется, либо нет.

</P>
<P>
Если приведенное выше описание вычислений привилегий пользователя
перевести на язык алгебры логики, используя логические операторы, то в
результате получится примерно следующее:

</P>

<PRE>
global privileges
OR (database privileges AND host privileges)
OR table privileges
OR column privileges
</PRE>

<P>
Сам по себе алгоритм определения привилегий на первый взгляд может
показаться неочевидным. И в самом деле, если первоначально глобальных
привилегий, определяемых таблицей <code>user</code>, оказывается недостаточно для
выполнения затребованной операции, то зачем впоследствии эти вроде бы
бесполезные привилегии добавляются к привилегиям на уровне баз данных,
таблиц и столбцов? Смысл такого добавления заключается в том, что для
выполнения запроса может потребоваться не один, а несколько типов
привилегий. Например, для выполнения оператора <code>INSERT ... SELECT</code> вам
потребуется как привилегия <code>INSERT</code>, так и привилегия <code>SELECT</code>. Ваши
привилегии могут быть таковы, что запись в таблице user предоставляет вам
одну привилегию, а запись в таблице <code>db</code> - другую. Другими словами,
привилегии, необходимые для выполнения запроса, у вас есть, но сервер не
может выяснить при просмотре каждой таблицы в отдельности, и поэтому
привилегии, предоставляемые записями из обеих таблиц, должны быть
объединены.

</P>
<P>
<A NAME="IDX503"></A>
<A NAME="IDX504"></A>

</P>
<P>
Таблицу <code>host</code> можно использовать еще для одной цели - для поддержки списка
надежных серверов.

</P>
<P>
В таблицах на TcX <code>host</code> содержит список всех машин локальной сети. Им
предоставляются все привилегии.

</P>
<P>
Таблицу <code>host</code> можно также использовать для регистрации хостов, которые
являются <strong>ненадежными</strong>. Предположим, одна из ваших машин -
<code>public.your.domain</code> находится в общедоступной области, которую вы считаете
незащищенной. В таком случае можно разрешить доступ всем хостам вашей
сети, за исключением одной ``неблагонадежной'' машины, используя записи в
таблице <code>host</code>, подобные приведенным ниже:

</P>

<PRE>
+--------------------+----+-
| Host               | Db | ...
+--------------------+----+-
| public.your.domain | %  | ... (для всех привилегий установлено значение 'N')
| %.your.domain      | %  | ... (для всех привилегий установлено значение 'Y')
+--------------------+----+-
</PRE>

<P>
<A NAME="IDX505"></A>
<A NAME="IDX506"></A>
<A NAME="IDX507"></A>
<A NAME="IDX508"></A>
<A NAME="IDX509"></A>

</P>
<P>
Естественно, всегда нужно протестировать записи в таблицах привилегий
(например, с помощью <code>mysqlaccess</code>), чтобы убедиться в том, что привилегии
доступа установлены вами действительно так, как задумано.

</P>


<H3><A NAME="Access_denied" HREF="manual.ru_toc.html#Access_denied">4.2.11  Причины появления ошибок <code>Access denied</code> ("в доступе отказано")</A></H3>

<P>
Если при попытке подсоединения к серверу MySQL вы сталкиваетесь с ошибкой
<code>Access denied</code>, то воспользуйтесь приведенным ниже списком. В нем
перечислены меры, которые можно принять для решения этой проблемы:

</P>

<UL>
<LI>

Запускали ли вы после инсталляции MySQL скрипт <code>mysql_install_db</code> для
установки начального содержимого таблиц привилегий? Если нет, сделайте
это. Обратитесь к разделу See section <A HREF="manual.ru.html#Default_privileges">4.3.4  Задание изначальных привилегий MySQL</A>.
Проверьте первоначальные привилегии с помощью следующей команды:


<PRE>
shell&#62; mysql -u root test
</PRE>

Подсоединение должно произойти без сбоя. Следует также убедиться, что в
каталоге базы данных MySQL имеется файл <tt>`user.MYD'</tt>. Обычно он находится в
директории <tt>`PATH/var/mysql/user.MYD'</tt>, где <code>PATH</code> - путь к корневому каталогу
инсталляции MySQL.

<LI>

После новой инсталляции следует подсоединиться к серверу и создать
пользователей, а также установить для них права доступа:


<PRE>
shell&#62; mysql -u root mysql
</PRE>

Сервер разрешит подсоединение, т.к. пользователь MySQL с именем
пользователя <code>root</code> исходно не имеет пароля. Но в этом заключается также и
риск нарушения безопасности системы, поэтому при создании остальных
пользователей MySQL, вам, помимо прочего, следует задать пароль для
пользователя <code>root</code>. Если при попытке подсоединения от имени пользователя
root вы получите следующую ошибку:


<PRE>
Access denied for user: '@unknown' to database mysql
</PRE>

это означает, что в таблице <code>user</code> отсутствует запись со значением <code>'root'</code> в
столбце <code>User</code> и <code>mysqld</code> не может определить имя хоста для вашего клиента. В
этом случае необходимо перезапустить сервер с опцией <code>--skip-grant-tables</code> и
отредактировать файл <tt>`/etc/hosts'</tt> или <tt>`\windows\hosts'</tt>, добавив в него запись
для вашего хоста.

<LI>

Если вы столкнетесь с такой ошибкой, как:


<PRE>
shell&#62; mysqladmin -u root -pxxxx ver
Access denied for user: 'root@localhost' (Using password: YES)
</PRE>

это означает, что используется неверный пароль. Обратитесь к разделу
See section <A HREF="manual.ru.html#Passwords">4.3.7  Задание паролей</A>. Если вы забыли пароль для пользователя <code>root</code>, то
перезапустите <code>mysqld</code> с опцией <code>--skip-grant-tables</code> и измените пароль.
Обратитесь к разделу See section <A HREF="manual.ru.html#Resetting_permissions">A.4.2  Как переустановить забытый пароль пользователя <code>root</code></A>. Такая
ошибка может появляться даже в том случае, если вы не задавали пароля
вообще - это значит, что в каком-то файле <tt>`my.ini'</tt> имеется неверный пароль.
Обратитесь к разделу See section <A HREF="manual.ru.html#Option_files">4.1.2  Файлы параметров <tt>`my.cnf'</tt></A>. Отменить использование файлов
опций можно с помощью опции the <code>--no-defaults</code>, как показано ниже:


<PRE>
shell&#62; mysqladmin --no-defaults -u root ver
</PRE>

<LI>

<A NAME="IDX510"></A>
Запускали ли вы скрипт <code>mysql_fix_privilege_tables</code> при обновлении
имеющейся инсталляции MySQL, если установленная версия - более ранняя,
чем 3.22.11, а обновляется она до 3.22.11 или более поздней? Если нет,
сделайте это. Начиная с MySQL 3.22.11, когда оператор <code>GRANT</code> стал
функциональным, структура таблиц привилегий изменилась.

<LI>

Если во время сеанса ваши привилегии изменились, то, возможно, их
изменил суперпользователь. Перезагрузка таблиц привилегий отражается
не только на новых подсоединениях клиентов, но также на уже имеющихся,
как это показано в разделе See section <A HREF="manual.ru.html#Privilege_changes">4.3.3  Когда изменения в привилегиях вступают в силу</A>.

<LI>

Если не удается добиться, чтобы пароль работал, помните, что функция
<code>PASSWORD()</code> должна использоваться, если вы задаете пароль с помощью
операторов <code>INSERT</code>, <code>UPDATE</code> или <code>SET PASSWORD</code>. Если же вы задаете пароль
с помощью оператора <code>GRANT ... INDENTIFIED BY</code> или команды <code>mysqladmin
password</code>, функция <code>PASSWORD()</code> не нужна. Обратитесь к разделу See section <A HREF="manual.ru.html#Passwords">4.3.7  Задание паролей</A>.

<LI>

<code>localhost</code> - это синоним имени вашего локального хоста, и, если хост
явно не задан, также устанавливаемое по умолчанию имя хоста, к
которому клиенты пытаются подключиться. Однако подсоединения к
<code>localhost</code> не действуют, если в вашей рабочей системе используются
MIT-потоки и MySQL старше версии 3.23.27 (подсоединения к <code>localhost</code>
осуществляются с использованием сокетов Unix, а они не поддерживались тогда
технологией MIT-потоков). Чтобы в таких системах эта проблема не возникала,
следует явным образом задать имя серверного хоста с помощью опции
<code>--host</code>. Таким образом будет установлено подсоединение к серверу
<code>mysqld</code> по протоколу TCP/IP.  В этом случае в записях таблицы
<code>user</code>, хранящейся на серверном хосте, должно быть указано реальное имя
хоста. (Это справедливо даже для тех случаев, когда клиентская программа и
сервер запускаются на одном хосте).

<LI>

Если при попытке подсоединения к базе данных с помощью команды <code>mysql
-u user_name db_name</code> возникает ошибка <code>Access denied</code>, причина этого,
возможно, кроется в таблице <code>user</code>. Чтобы проверить это, выполните
команду <code>mysql -u root mysql</code> и введите следующий SQL-оператор:


<PRE>
mysql&#62; SELECT * FROM user;
</PRE>

В результате будет выведена запись со столбцами <code>Host</code> и <code>User</code>,
соответствующими имени вашего компьютера и вашему имени пользователя
MySQL.

<LI>

Сообщение об ошибке <code>Access denied</code> информирует вас о том, под каким
именем вы пытаетесь войти в систему, об имени хоста, с которого вы
пытаетесь установить соединение, и о том, использовали ли вы при этом
пароль или нет. Как правило, в таблице <code>user</code> будет одна запись, точно
соответствующая имени хоста и имени пользователя, указанным в
сообщении об ошибке. Например, если вы получите сообщение об ошибке, в
котором сказано <code>Using password: NO</code>, это означает, что вы пытались
войти в систему, не указав пароль.

<LI>

Если при попытке подсоединения не с того компьютера, на котором
работает сервер MySQL, а с другого, вы получите сообщение об ошибке,
приведенное ниже, то в таблице <code>user</code> отсутствует строка с таким именем
хоста:


<PRE>
Host ... is not allowed to connect to this MySQL server
</PRE>

Чтобы исправить эту ошибку, с помощью утилиты командной строки <code>mysql</code> (на
серверном хосте!) добавьте строку в таблицу <code>user</code>, <code>db</code> или <code>host</code> с
комбинацией имени пользователя/хоста, соответствующей той, которую вы
используете при попытке подсоединения. Затем выполните команду <code>mysqladmin
flush-privileges</code>. Если вы используете MySQL версии, отличной от Version
3.22, и вам неизвестно имя хоста или IP-адрес компьютера, с которого вы
подсоединяетесь, введите в таблицу user запись со значением <code>'%'</code> в поле
<code>Host</code> и перезапустите <code>mysqld</code> на серверной машине с опцией <code>--log</code>. Когда
соединение с клиентской машины будет установлено, вы найдете в журнале
регистрации MySQL информацию об имени хоста, с которого вы подсоединились.
(После этого следует заменить в записи таблицы <code>user</code> значение <code>'%'</code> настоящим
именем хоста, из журнала регистрации. Иначе ваша система останется
незащищенной.)

В Linux причиной такой ошибки может быть то, что бинарная
версия MySQL скомпилирована с версией glibc, отличной от используемой
вами. В этом случае нужно будет либо обновить ОС/glibc, используемые вами,
либо загрузить исходный код MySQL и скомпилировать сервер самостоятельно.
Как правило, исходный RPM компилируется и инсталлируется элементарно, так
что это не составит серьезной проблемы.

<LI>

Если будет выдано сообщение об ошибке, в котором имя хоста не указано
вообще или указан IP-адрес, хотя вы при попытке подсоединения
указывали имя хоста:


<PRE>
shell&#62; mysqladmin -u root -pxxxx -h some-hostname ver
Access denied for user: 'root' (Using password: YES)
</PRE>

то это означает, что ошибка возникает при попытке MySQL сопоставить
IP-адрес с именем хоста. В этом случае вы можете выполнить команду
<code>mysqladmin flush-hosts</code>, чтобы сбросить внутреннюю кэш-память DNS.
Обратитесь к разделу See section <A HREF="manual.ru.html#DNS">5.5.5  Как MySQL использует DNS</A>. Вот некоторые способы решения
этой проблемы:


<UL>
<LI>Попробуйте выяснить, что не так с вашим сервером DNS, и устраните

неисправность.

<LI>Задайте IP-адреса вместо имен хостов таблицах привилегий MySQL.

<LI>Запустите <code>mysqld</code> с опцией <code>--skip-name-resolve</code>.

<LI>Запустите <code>mysqld</code> с опцией <code>--skip-host-cache</code>.

<LI>Подключитесь к <code>localhost</code> если ваш сервер и клиент работают на одном

и том же компьютере.

<LI>Поместите имена клиентских машин в каталог <tt>`/etc/hosts'</tt>.

</UL>

<LI>

Если команда <code>mysql -u root test</code> работает успешно, а команда <code>mysql -h
your_hostname -u root tes</code>t приводит к ошибке <code>Access denied</code>, то,
возможно, в таблице <code>user</code> имя вашего хоста указано неверно. Одна из
распространенных проблем здесь заключается в том, что в поле <code>Host</code>
записи, хранящейся в таблице <code>user</code>, задается только имя хоста, в то
время как процедуры разрешения имен, используемые вашей системой,
возвращают полностью определенное доменное имя (или наоборот).
Например, если в таблице user имеется запись со значением <code>'tcx'</code> в поле
<code>host</code>, а DNS при этом сообщает MySQL, что имя хоста - <code>'tcx.subnet.se'</code>,
эта запись действовать не будет. Попробуйте добавить в таблицу <code>user</code>
запись, указав в колонке <code>Host</code> IP-адрес хоста. (В качестве альтернативы
можно добавить в таблицу <code>user</code> запись со значением в поле <code>Host</code>,
содержащим шаблонный символ, например <code>'tcx.%'</code>. Но использовать имена
хостов, оканчивающиеся на <code>'%'</code> - небезопасно  и делать это не
рекомендуется!)

<LI>

Если команда <code>mysql -u user_name test</code> работает успешно, а команда <code>mysql
-u user_name other_db_nam</code>e - нет, то в таблице <code>db</code> нет записи,
соответствующей <code>other_db_name</code>.

<LI>

Если команда <code>mysql -u user_name db_name</code> выполняется успешно на том
компьютере, где установлен сервер, а <code>mysql -u host_name -u user_name
db_name</code> не работает при выполнении ее на другой клиентской машине, то
в таблицах <code>user</code> или <code>db</code> эта клиентская машина не зарегистрирована.

<LI>

Если не удается выяснить причину ошибки <code>Access denied</code>, удалите из
таблицы <code>user</code> все записи, в которых значение в поле <code>Host</code> включает
шаблонные символы (записи, содержащие символы <samp>`'%''</samp> или <samp>`'_''</samp>). Очень
распространенной ошибкой является следующая: пользователь вставляет
новую запись со значением <code>'%'</code> в поле <code>Host</code> и со значением <code>'some user'</code> -
в поле <code>User</code>, полагая, что после этого для подсоединения с той же самой
машины он сможет использовать <code>localhost</code>. Такой расчет неверен, и
причина здесь в том, что устанавливаемые по умолчанию привилегии
включают запись со значением <code>'localhost'</code> в поле <code>Host</code> и пустым полем
<code>User</code>. И поскольку в этой записи значение <code>'localhost'</code> более конкретно,
чем <code>'%',</code> то именно она при подсоединении с <code>localhost</code> предшествует
новой записи и, соответственно, будет выбрана и сработает! Правильным
в этом случае будет вставить вторую запись со значением <code>'localhost'</code> в
поле <code>Host</code> и значением <code>'some_user'</code> - в поле <code>User</code> или удалить запись со
значением <code>'localhost'</code> в поле <code>Host</code> и пустым полем <code>User</code>.

<LI>

Если вы получите следующую ошибку, то эта проблема, возможно, связана
с таблицей <code>db</code> или таблицей <code>host</code>:


<PRE>
Access to database denied
</PRE>

Если в записи, выбранной из таблицы <code>db</code>, столбец <code>Host</code> - пустой,
удостоверьтесь, что в таблице <code>host</code> имеется по крайней мере одна
соответствующая запись, указывающая, к каким хостам относится запись из
таблицы <code>db</code>. Если ошибка возникает при выполнении SQL-команды <code>SELECT ...
INTO OUTFILE</code> или <code>LOAD DATA INFILE</code>, то в вашей записи из таблицы <code>user</code>,
вероятно, отсутствует разрешение на предоставление привилегии <code>FILE</code>.

<A NAME="IDX511"></A>
<A NAME="IDX512"></A>
<A NAME="IDX513"></A>

<LI>

Помните, что клиентские программы будут использовать параметры
подсоединения, указанные файлах конфигурации или переменных окружения.
Обратитесь к разделу See section <A HREF="manual.ru.html#Environment_variables">E  Переменные окружения</A>. Если есть подозрение, что
клиент отсылает неверные устанавливаемые по умолчанию параметры
подсоединения, в случае, когда вы не задаете их в командной строке,
проверьте ваше окружение и файл <tt>`my.cnf'</tt> в своей домашней директории.
Можете также проверить конфигурационные файлы MySQL относящиеся ко все
системе, хотя параметры клиентского подсоединения вряд ли указаны
именно здесь. Обратитесь к разделу See section <A HREF="manual.ru.html#Option_files">4.1.2  Файлы параметров <tt>`my.cnf'</tt></A>. Если ошибка <code>Access denied</code> возникает при
выполнении вашей клиентской программы без каких-либо опций, убедитесь,
что ни в одном из ваших файлов опций не указан старый пароль!
Обратитесь к разделу See section <A HREF="manual.ru.html#Option_files">4.1.2  Файлы параметров <tt>`my.cnf'</tt></A>.

<LI>

Если вы вносите изменения в таблицы привилегий непосредственно (с
помощью операторов <code>INSERT</code> или <code>UPDATE</code>), а ваши изменения, похоже,
игнорируются, то следует выдать оператор <code>FLUSH PRIVILEGES</code> или
выполнить команду <code>mysqladmin flush-privileges</code> - для того, чтобы
заставить сервер перечитать таблицы привилегий. В противном случае
ваши изменения вступят в силу лишь при последующем перезапуске
сервера. Помните, что после того, как вы зададите пароль от имени
пользователя, вам нужно будет указывать его только после сброса
привилегий, т.к. серверу еще не будет известно о том, что вы изменили
пароль!

<LI>

При возникновении проблемы с доступом при использовании Perl-, PHP-,
Python- или ODBC-программ, попробуйте установить соединение с сервером
при помощи команды <code>mysql -u user_name db_name</code> или команды <code>mysql -u
user_name -pyour_pass db_name</code>. Если ваш клиент <code>mysql</code> обеспечивает
подсоединение, то проблема связана не с привилегиями доступа, а с
вашей программой. (Заметим, что между <code>-p</code> и паролем пробела нет; для
задания пароля можно также использовать синтаксическую структуру
<code>--password=your_pass</code>. Если вы используете только саму опцию <code>-p</code>, MySQL
запросит у вас пароль)

<LI>

При тестировании запускайте демон <code>mysqld</code> с опцией <code>--skip-grant-tables</code>.
Тогда вы сможете изменять таблицы привилегий MySQL и с помощью скрипта
<code>mysqlaccess</code> проверять, произвели ли сделанные вами изменения желаемый
эффект. Если результаты вас устраивают, выполните команду <code>mysqladmin
flush-privileges</code>, чтобы приказать серверу <code>mysqld</code> приступить к
использованию новых таблиц привилегий. <strong>Внимание</strong>: перезагрузка таблиц
привилегий отменяет опцию <code>--skip-grant-tables</code>. Это позволяет заставить
сервер приступить к использованию новых таблиц привилегий без
завершения его работы и перезагрузки.

<LI>

Если ничего не помогает, запустите демон <code>mysqld</code> daemon с опцией
отладки (например <code>--debug=d,general,query</code>). В результате будет
выведена информация о неудачных подсоединениях, с указанием хоста и
пользователя, а также обо всех обработанных командах. Обратитесь к
разделу See section <A HREF="manual.ru.html#Making_trace_files">D.1.2  Создание трассировочных файлов</A>.

<LI>

Если у вас имеется какая-либо проблема с таблицами привилегий MySQL и
вы полагаете, что необходимо сообщить о ней в список рассылки, нужно
обязательно приложить к своему отчету распечатку таблиц привилегий
MySQL. Это можно сделать с помощью команды <code>mysqldump mysql</code>. Отчет о
проблеме, как и в других случаях, отправляется с помощью скрипта
<code>mysqlbug</code>. Обратитесь к разделу See section <A HREF="manual.ru.html#Bug_reports">1.8.1.3  Как отправлять отчеты об ошибках или проблемах</A>. В некоторых случаях для выполнения скрипта <code>mysqldump</code> возможно,
потребуется перезапустить <code>mysqld</code> с опцией <code>--skip-grant-tables</code>.
</UL>



<H2><A NAME="User_Account_Management" HREF="manual.ru_toc.html#User_Account_Management">4.3  Управление учетными записями пользователей MySQL</A></H2>



<H3><A NAME="GRANT" HREF="manual.ru_toc.html#GRANT">4.3.1  Синтаксис команд <code>GRANT</code> и <code>REVOKE</code></A></H3>

<P>
<A NAME="IDX514"></A>
<A NAME="IDX515"></A>

</P>
<P>
<A NAME="IDX516"></A>
<A NAME="IDX517"></A>
<A NAME="IDX518"></A>
<A NAME="IDX519"></A>
<A NAME="IDX520"></A>

</P>

<PRE>
GRANT priv_type [(column_list)] [, priv_type [(column_list)] ...]
    ON {tbl_name | * | *.* | db_name.*}
    TO user_name [IDENTIFIED BY [PASSWORD] 'password']
        [, user_name [IDENTIFIED BY 'password'] ...]
    [REQUIRE
	NONE |
        [{SSL| X509}]
        [CIPHER cipher [AND]]
        [ISSUER issuer [AND]]
        [SUBJECT subject]]
    [WITH [GRANT OPTION | MAX_QUERIES_PER_HOUR # |
                          MAX_UPDATES_PER_HOUR # |
                          MAX_CONNECTIONS_PER_HOUR #]]

REVOKE priv_type [(column_list)] [, priv_type [(column_list)] ...]
    ON {tbl_name | * | *.* | db_name.*}
    FROM user_name [, user_name ...]
</PRE>

<P>
<code>GRANT</code> включен в MySQL начиная с версии 3.22.11 и выше. В более ранних
версиях MySQL оператор <code>GRANT</code> ничего не выполняет.

</P>
<P>
Команды <code>GRANT</code> и <code>REVOKE</code> позволяют системным администраторам создавать
пользователей MySQL, а также предоставлять права пользователям или лишать
их прав на четырех уровнях привилегий:

</P>
<DL COMPACT>

<DT><strong>Глобальный уровень</strong>
<DD>
Глобальные привилегии применяются ко всем базам данных на указанном
сервере. Эти привилегии хранятся в таблице <code>mysql.user</code>.

<DT><strong>Уровень базы данных</strong>
<DD>
Привилегии базы данных применяются ко всем таблицам указанной базы данных.
Эти привилегии хранятся в таблицах <code>mysql.db</code> и <code>mysql.host</code>.

<DT><strong>Уровень таблицы</strong>
<DD>
Привилегии таблицы применяются ко всем столбцам указанной таблицы. Эти
привилегии хранятся в таблице <code>mysql.tables_priv</code>.

<DT><strong>Уровень столбца</strong>
<DD>
Привилегии столбца применяются к отдельным столбцам указанной таблицы. Эти
привилегии хранятся в таблице <code>mysql.columns_priv</code>.
</DL>

<P>
Если привилегии предоставляются пользователю, которого не существует, то
этот пользователь создается. Чтобы просмотреть примеры работы команды
<code>GRANT</code>, см. раздел section <A HREF="manual.ru.html#Adding_users">4.3.5  Добавление новых пользователей в MySQL</A>.

</P>
<P>
В таблице приведен список возможных значений параметра <code>priv_type</code> для
операторов <code>GRANT</code> и <code>REVOKE</code>:

</P>
<TABLE BORDER>
<TR><TD><code>ALL [PRIVILEGES]</code> </TD><TD> Задает все простые привилегии, кроме <code>WITH GRANT OPTION</code>
</TD></TR>
<TR><TD><code>ALTER</code> </TD><TD> Разрешает использование <code>ALTER TABLE</code>
</TD></TR>
<TR><TD><code>CREATE</code> </TD><TD> Разрешает использование <code>CREATE TABLE</code>
</TD></TR>
<TR><TD><code>CREATE TEMPORARY TABLES</code> </TD><TD> Разрешает использование <code>CREATE TEMPORARY TABLE</code>
</TD></TR>
<TR><TD><code>DELETE</code> </TD><TD> Разрешает использование <code>DELETE</code>
</TD></TR>
<TR><TD><code>DROP</code> </TD><TD> Разрешает использование <code>DROP TABLE</code>
</TD></TR>
<TR><TD><code>EXECUTE</code> </TD><TD> Разрешает пользователю запускать хранимые процедуры (для MySQL 5.0)
</TD></TR>
<TR><TD><code>FILE</code> </TD><TD> Разрешает использование <code>SELECT ... INTO OUTFILE</code> и <code>LOAD DATA INFILE</code>
</TD></TR>
<TR><TD><code>INDEX</code> </TD><TD> Разрешает использование <code>CREATE INDEX</code> and <code>DROP INDEX</code>
</TD></TR>
<TR><TD><code>INSERT</code> </TD><TD> Разрешает использование <code>INSERT</code>
</TD></TR>
<TR><TD><code>LOCK TABLES</code> </TD><TD> Разрешает использование <code>LOCK TABLES</code> на таблицах, для которых есть привилегия <code>SELECT</code>
</TD></TR>
<TR><TD><code>PROCESS</code> </TD><TD> Разрешает использование <code>SHOW FULL PROCESSLIST</code>
</TD></TR>
<TR><TD><code>REFERENCES</code> </TD><TD> Зарезервировано для использования в будущем
</TD></TR>
<TR><TD><code>RELOAD</code> </TD><TD> Разрешает использование <code>FLUSH</code>
</TD></TR>
<TR><TD><code>REPLICATION CLIENT</code> </TD><TD> Предоставляет пользователю право запрашивать местонахождение головного и подчиненных серверов
</TD></TR>
<TR><TD><code>REPLICATION SLAVE</code> </TD><TD> Необходимо для подчиненных серверов при репликации (для чтения информации из бинарных журналов головного сервера)
</TD></TR>
<TR><TD><code>SELECT</code> </TD><TD> Разрешает использование <code>SELECT</code>
</TD></TR>
<TR><TD><code>SHOW DATABASES</code> </TD><TD> <code>SHOW DATABASES</code> выводит все базы данных
</TD></TR>
<TR><TD><code>SHUTDOWN</code> </TD><TD> Разрешает использование <code>mysqladmin shutdown</code>
</TD></TR>
<TR><TD><code>SUPER</code> </TD><TD> Позволяет установить одно соединение (один раз), даже если достигнуто значение max_connections, и запускать команды <code>CHANGE MASTER</code>, <code>KILL thread</code>, <code>mysqladmin debug</code>, <code>PURGE MASTER LOGS</code> и <code>SET GLOBAL</code>
</TD></TR>
<TR><TD><code>UPDATE</code> </TD><TD> Разрешает использование <code>UPDATE</code>
</TD></TR>
<TR><TD><code>USAGE</code> </TD><TD> Синоним для ``без привилегий''
</TD></TR>
<TR><TD><code>GRANT OPTION</code> </TD><TD> Синоним для <code>WITH GRANT OPTION</code>
</TD></TR>
</TABLE>

<P>
Значение <code>USAGE</code> можно задавать, если необходимо создать пользователя без
привилегий.

</P>
<P>
Привилегии <code>CREATE TEMPORARY TABLES</code>, <code>EXECUTE</code>, <code>LOCK TABLES</code>, <code>REPLICATION ...</code>,
<code>SHOW DATABASES</code> и <code>SUPER</code> являются новыми для версии 4.0.2. Чтобы
воспользоваться этими новыми привилегиями после обновления до версии
4.0.2, необходимо запустить скрипт <code>mysql_fix_privilege_tables</code>.

</P>
<P>
В боле старых версиях MySQL привилегия <code>PROCESS</code> предоставляет такие же
права, как и новая привилегия <code>SUPER</code>.

</P>
<P>
Чтобы лишить пользователя привилегий, предоставленных командой <code>GRANT</code>,
воспользуйтесь значением <code>priv_type</code> в <code>GRANT OPTION</code>:

</P>

<PRE>
mysql&#62; REVOKE GRANT OPTION ON ... FROM ...;
</PRE>

<P>
Для таблицы можно указать только следующие значения <code>priv_type</code>:
<code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>, <code>CREATE</code>,
<code>DROP</code>, <code>GRANT OPTION</code>, I<code>NDEX</code> и <code>ALTER</code>.

</P>
<P>
Для столбца можно указать только следующие значения <code>priv_type</code> (при
использовании оператора <code>column_list</code>): <code>SELECT</code>, <code>INSERT</code> и <code>UPDATE</code>.

</P>
<P>
Глобальные привилегии можно задать, воспользовавшись синтаксисом <code>ON *.*</code>, а
привилегии базы данных - при помощи синтаксиса <code>ON db_name.*</code>. Если указать
<code>ON *</code> при открытой текущей базе данных, то привилегии будут заданы для этой
базы данных. (<strong>Предупреждение</strong>: если указать <code>ON *</code> при <strong>отсутствии</strong> открытой
текущей базы данных, это повлияет на глобальные привилегии!)

</P>
<P>
<strong>Заметьте:</strong> шаблонные символы <samp>`_'</samp> и <samp>`%'</samp>  не допускаются в определении
имени баз данных в операторе GRANT. Это означает, что если вы хотите
использовать, скажем, символ <samp>`_'</samp> в имени базы данных, то вы должны указать
его как <samp>`\_'</samp> в <code>GRANT</code>, чтобы пользователь не имел возможности
получить доступ к другим базам данных, соответствующих шаблону: <code>GRANT ...
ON `foo\_bar`.* TO ...</code>.

</P>
<P>
С тем, чтобы можно было определять права пользователям с конкретных
компьютеров, в MySQL обеспечивается возможность указывать имя пользователя
(<code>user_name</code>) в форме <code>user@host</code>. Если необходимо указать строку <code>user</code>, в
которой содержатся специальные символы (такие как <samp>`-'</samp>) или строку <code>host</code>, в
которой содержатся специальные или групповые символы (такие как <samp>`%'</samp>),
можно заключить имя удаленного компьютера или пользователя в кавычки
(например, <code>'test-user'@'test-hostname'</code>).

</P>
<P>
В имени удаленного компьютера также можно указывать групповые символы.
Например, <code>user@'%.loc.gov'</code> относится к <code>user</code> всех удаленных компьютеров
домена <code>loc.gov</code>, а <code>user@'144.155.166.%'</code> относится к <code>user</code> всех удаленных
компьютеров подсети <code>144.155.166</code> класс C.

</P>
<P>
Простая форма user является синонимом для <code>user@"%"</code>.

</P>
<P>
В MySQL не поддерживаются групповые символы в именах пользователей.
Анонимные пользователи определяются вставкой записей <code>User=''</code> в таблицу
<code>mysql.user</code> или созданием пользователя с пустым именем при помощи команды
<code>GRANT</code>.

</P>
<P>
<strong>Примечание</strong>: если анонимным пользователям разрешается подсоединяться к
серверу MySQL, необходимо также предоставить привилегии всем локальным
пользователям как <code>user@localhost</code>, поскольку в противном случае при попытке
пользователя зайти в MySQL с локального компьютера в таблице <code>mysql.user</code> 
будет использоваться вход для анонимного пользователя!

</P>
<P>
Чтобы проверить, происходит ли подобное на вашем компьютере, выполните
следующий запрос:

</P>

<PRE>
mysql&#62; SELECT Host,User FROM mysql.user WHERE User='';
</PRE>

<P>
На данный момент команда <code>GRANT</code> поддерживает имена удаленных компьютеров,
таблиц, баз данных и столбцов длиной не более 60 символов. Имя
пользователя должно содержать не более 16 символов.

</P>
<P>
Привилегии для таблицы или столбца формируются при помощи логического
оператора OR из привилегий каждого из четырех уровней. Например, если в
таблице <code>mysql.user</code> указано, что у пользователя есть глобальная привилегия
<code>SELECT</code>, эта привилегия не отменяется на уровне базы данных, таблицы или
столбца.

</P>
<P>
Привилегии для столбца могут быть вычислены следующим образом:

</P>

<PRE>
глобальные привилегии
OR (привилегии базы данных AND привилегии удаленного компьютера)
OR привилегии таблицы
OR привилегии столбца
</PRE>

<P>
В большинстве случаев права пользователя определяются только на одном
уровне привилегий, поэтому обычно эта процедура не настолько сложна, как
описано выше. Подробная информация о последовательности действий проверки
привилегий представлена в разделе section <A HREF="manual.ru.html#Privilege_system">4.2  Общие проблемы безопасности и система привилегий доступа MySQL</A>.

</P>
<P>
Если привилегии предоставляются сочетанию пользователь/удаленный
компьютер, которое отсутствует в таблице <code>mysql.user</code>, то в последнюю
добавляется запись, которая остается в таблице до тех пор, пока не будет
удалена при помощи команды <code>DELETE</code>. Иначе говоря, команда <code>GRANT</code> может
создавать записи <code>user</code> в таблице, но команда <code>REVOKE</code> не может их удалить.
Это необходимо делать при помощи команды <code>DELETE</code>.

</P>
<P>
<A NAME="IDX521"></A>
Если в MySQL версий 3.22.12 и выше создан новый пользователь или
предоставлены глобальные привилегии, пароль пользователя будет назначаться
оператором <code>IDENTIFIED BY</code>, если он указан. Если у пользователя уже есть
пароль, то этот пароль будет заменен новым.

</P>
<P>
Если вы не хотите отправлять пароль открытым текстом, можно
воспользоваться параметром <code>PASSWORD</code> с зашифрованным паролем, полученным
при помощи функции SQL <code>PASSWORD()</code> или функции C API
<code>make_scrambled_password(char *to, const char *password)</code>.

</P>
<P>
<strong>Предупреждение</strong>: если при создании нового пользователя не указать оператор
<code>IDENTIFIED BY</code>, будет создан пользователь без пароля. Это ненадежно с точки
зрения безопасности.

</P>
<P>
Пароли также можно задавать при помощи команды <code>SET PASSWORD</code>. See section <A HREF="manual.ru.html#SET">6.2.3.4  Тип множества <code>SET</code></A>.

</P>
<P>
Если у вас привилегии для базы данных, то при необходимости в таблице
<code>mysql.db</code> создается запись. Данная запись удаляется после удаления всех
привилегий для этой базы данных командой <code>REVOKE</code>.

</P>
<P>
Если у пользователя нет никаких привилегий для таблицы, то таблица не
отображается, когда пользователь запрашивает список таблиц (например, при
помощи оператора <code>SHOW TABLES</code>).

</P>
<P>
Оператор <code>WITH GRANT OPTION</code> предоставляет пользователю возможность наделять
других пользователей любыми привилегиями, которые он сам имеет на
указанном уровне привилегий. При предоставлении привилегии <code>GRANT</code>
необходимо проявлять осмотрительность, так как два пользователя с разными
привилегиями могут объединить свои привилегии!

</P>
<P>
Параметры <code>MAX_QUERIES_PER_HOUR #</code>, <code>MAX_UPDATES_PER_HOUR #</code> и
<code>MAX_CONNECTIONS_PER_HOUR #</code> являются новыми в MySQL версии 4.0.2. Эти
параметры ограничивают количество запросов, обновлений и входов, которые
пользователь может осуществить в течение одного часа. Если установлено
значение 0 (принято по умолчанию), то это означает, что для данного
пользователя нет ограничений. See section <A HREF="manual.ru.html#User_resources">4.3.6  Ограничение ресурсов пользователя</A>.

</P>
<P>
Внимание: чтобы указать любую из этих опция для существующего пользователя, но не
давать никаких дополнительных привилегий, используйте <code>GRANT USAGE ... WITH MAX_...</code>.

</P>
<P>
Нельзя предоставить другому пользователю привилегию, которой нет у вас
самого. Привилегия <code>GRANT</code> позволяет предоставлять только те привилегии,
которыми вы обладаете.

</P>
<P>
Учтите, что если пользователю назначена привилегия <code>GRANT</code> на определенном
уровне привилегий, то все привилегии, которыми этот пользователь уже
обладает (или которые будут ему назначены в будущем!) на этом уровне,
также могут назначаться этим пользователем. Предположим, пользователю
назначена привилегия <code>INSERT</code> в базе данных. Если потом в базе данных
назначить привилегию <code>SELECT</code> и указать <code>WITH GRANT OPTION</code>, пользователь
сможет назначать не только привилегию <code>SELECT</code>, но также и <code>INSERT</code>. Если
затем в базе данных предоставить пользователю привилегию <code>UPDATE</code>,
пользователь сможет после этого назначать <code>INSERT</code>, <code>SELECT</code> и <code>UPDATE</code>.

</P>
<P>
Не следует назначать привилегии <code>ALTER</code> обычным пользователям. Это дает
пользователю возможность разрушить систему привилегий путем переименования
таблиц!

</P>
<P>
Обратите внимание на то, что если используются привилегии для таблицы или
столбца даже для одного пользователя, сервер проверяет привилегии таблиц и
столбцов для всех пользователей, и это несколько замедляет работу MySQL.

</P>
<P>
При запуске <code>mysqld</code> все привилегии считываются в память. Привилегии базы
данных, таблицы и столбца вступают в силу немедленно, а привилегии уровня
пользователя - при следующем подсоединении пользователя. Изменения в
таблицах назначения привилегий, которые осуществляются при помощи команд
<code>GRANT</code> и <code>REVOKE</code>, обрабатываются сервером немедленно. Если изменять таблицы
назначения привилегий вручную (используя команды <code>INSERT</code>, <code>UPDATE</code> и т.д.),
необходимо запустить оператор <code>FLUSH PRIVILEGES</code> или <code>mysqladmin
flush-privileges</code>, чтобы указать серверу на необходимость перезагрузки
таблиц назначения привилегий. See section <A HREF="manual.ru.html#Privilege_changes">4.3.3  Когда изменения в привилегиях вступают в силу</A>.

</P>
<P>
Наиболее значительные отличия команды <code>GRANT</code> версий ANSI SQL и MySQL
следующие:

</P>

<UL>
<LI>

В MySQL привилегии назначаются для сочетания имя пользователя +
удаленный компьютер, а не только для имени пользователя.

<LI>

В ANSI SQL отсутствуют глобальные привилегии и привилегии уровня базы
данных, и ANSI SQL поддерживает не все типы привилегий MySQL. В свою
очередь, в MySQL отсутствует поддержка привилегий ANSI SQL <code>TRIGGER</code>,
<code>UNDER</code>.

<LI>

Структура привилегий ANSI SQL является иерархической. Если удалить
пользователя, то все назначенные этому пользователелю привилегии будут
отменены. В MySQL назначенные привилегии не отменяются автоматически,
их при необходимости требуется удалять самостоятельно.

<LI>

В MySQL пользователь может применять к таблице оператор <code>INSERT</code> при
наличии у него привилегии <code>INSERT</code> только для нескольких столбцов в этой
таблице. Столбцы, для которых отсутствует привилегия <code>INSERT</code>, будут
установлены в свои значения, принятые по умолчанию. В ANSI SQL
требуется наличие привилегии <code>INSERT</code> для всех столбцов.

<LI>

При удалении таблицы в ANSI SQL все привилегии для этой таблицы будут
отменены. Если отменить привилегию в ANSI SQL, то все привилегии,
которые были назначены на основе этой привилегии, также будут
отменены. В MySQL привилегии могут удаляться только при помощи команды
<code>REVOKE</code> или путем изменения таблиц назначения привилегий MySQL.
</UL>

<P>
Чтобы ознакомиться с описанием использования <code>REQUIRE</code>, см. раздел See section <A HREF="manual.ru.html#Secure_connections">4.3.9  Использование безопасных соединений</A>.

</P>


<H3><A NAME="User_names" HREF="manual.ru_toc.html#User_names">4.3.2  Имена пользователей MySQL и пароли</A></H3>

<P>
<A NAME="IDX522"></A>
<A NAME="IDX523"></A>

</P>
<P>
Между MySQL и Unix или Windows существует несколько различий в
использовании имен пользователей и паролей:

</P>

<UL>
<LI>

Имена пользователей, которые применяются в MySQL для авторизации, не
имеют ничего общего с именами пользователей Unix (аккаунты Unix) или
именами пользователей Windows. Большинство клиентов MySQL по умолчанию
пытаются войти в систему, используя текущее имя пользователя Unix в
качестве имени пользователя MySQL, но это сделано только для удобства.
Программы клиентов позволяют указывать различные имена при помощи
параметров <code>-u</code> или <code>--user</code>. Это означает, что невозможно обеспечить
безопасность базы данных, если не все имена пользователей MySQL
снабжены паролями: ведь можно попытаться подсоединиться к серверу,
используя любое имя, а если воспользоваться именем, которому не
назначен пароль, то удастся войти в систему.

<LI>

Имена пользователей MySQL могут содержать до 16 символов. Имена
пользователей Unix обычно ограничены 8 символами.

<LI>

Пароли MySQL не имеют никакого отношения к паролям Unix. Не существует
связи между паролем, который используется для входа в Unix, и паролем,
необходимым для доступа к базе данных.

<LI>

MySQL шифрует пароли при помощи своего алгоритма, который отличается
от алгоритма Unix, используемого во время входа в систему. Описание
функций <code>PASSWORD()</code> и <code>ENCRYPT()</code> можно найти в разделе See section <A HREF="manual.ru.html#Miscellaneous_functions">6.3.6.2  Разные функции</A>. Обратите
внимание: даже если ваш пароль хранится в 'зашифрованном виде', то
знания этого 'зашифрованного' пароля будет достаточно, чтобы
подсоединиться к серверу MySQL!
</UL>

<P>
Пользователи MySQL и их привилегии обычно создаются при помощи команды
<code>GRANT</code>. See section <A HREF="manual.ru.html#GRANT">4.3.1  Синтаксис команд <code>GRANT</code> и <code>REVOKE</code></A>.

</P>
<P>
Если подсоединение к серверу MySQL осуществляется с клиента командной
строки, необходимо указать пароль при помощи параметра
<code>--password=your-password</code>. See section <A HREF="manual.ru.html#Connecting">4.2.8  Соединение с сервером MySQL</A>.

</P>

<PRE>
mysql --user=monty --password=guess database_name
</PRE>

<P>
Если необходимо, чтобы клиент запрашивал пароль, то следует указать
<code>--password</code> без каких-либо аргументов

</P>

<PRE>
mysql --user=monty --password database_name
</PRE>

<P>
или сокращенный вариант этого параметра:

</P>

<PRE>
mysql -u monty -p database_name
</PRE>

<P>
Обратите внимание на то, что в последнем примере <code>database_name</code> не является
паролем.

</P>
<P>
Если необходимо указать пароль при помощи параметра <code>-p</code>, то следует
поступить следующим образом:

</P>

<PRE>
mysql -u monty -pguess database_name
</PRE>

<P>
В некоторых системах вызов библиотеки, который MySQL использует для
запроса пароля, автоматически обрезает пароль до 8 символов. В самом MySQL
не существует никаких ограничений на длину пароля.

</P>


<H3><A NAME="Privilege_changes" HREF="manual.ru_toc.html#Privilege_changes">4.3.3  Когда изменения в привилегиях вступают в силу</A></H3>

<P>
При запуске <code>mysqld</code> все таблицы назначения привилегий загружаются в память
и с этого момента привилегии вступают в силу.

</P>
<P>
Изменения, которые вносятся в таблицы назначения привилегий при помощи
команд <code>GRANT</code>, <code>REVOKE</code> или <code>SET PASSWORD</code>, учитываются сервером немедленно.

</P>
<P>
Если вносить изменения в таблицы назначения привилегий вручную (при помощи
команд <code>INSERT</code>, <code>UPDATE</code> и т.д.), необходимо запускать оператор <code>FLUSH
PRIVILEGES</code>, <code>mysqladmin flush-privileges</code> или <code>mysqladmin reload</code>, чтобы
указать серверу на необходимость перезагрузить эти таблицы. В противном
случае изменения не вступят в силу, пока сервер не будет перезагружен.
Если внести изменения вручную, но не перезагрузить таблицы назначения
привилегий, то останется только удивляться, почему внесенные изменения не
действуют!

</P>
<P>
Когда сервер замечает, что были внесены изменения в таблицы назначения
привилегий, он обрабатывает установленные соединения клиентов следующим
образом:

</P>

<UL>
<LI>

Изменения привилегий таблиц и столбцов вступают в силу при следующем
запросе клиента

<LI>

Изменения привилегий баз данных вступают в силу при следующем
использовании команды <code>USE db_name</code> 

<LI>

Изменения глобальных привилегий и изменения пароля вступают в силу при
следующем подсоединении пользователя.
</UL>



<H3><A NAME="Default_privileges" HREF="manual.ru_toc.html#Default_privileges">4.3.4  Задание изначальных привилегий MySQL</A></H3>

<P>
<A NAME="IDX524"></A>
<A NAME="IDX525"></A>
<A NAME="IDX526"></A>
<A NAME="IDX527"></A>
<A NAME="IDX528"></A>
<A NAME="IDX529"></A>
<A NAME="IDX530"></A>

</P>
<P>
После установки MySQL изначальные привилегии доступа задаются при помощи
<tt>`scripts/mysql_install_db'</tt>. See section <A HREF="manual.ru.html#Quick_install">2.3.1  Обзор  быстрой  установки</A>. Скрипт <code>mysql_install_db</code> запускает
сервер <code>mysqld</code>, а затем инициализирует таблицы предоставления привилегий со
следующим набором привилегий:

</P>

<UL>
<LI>

В качестве суперпользователя создается MySQL <code>root</code> который может делать
все, что угодно. Соединения должны устанавливаться с локального
компьютера.

<strong>Примечание</strong>: Изначально пароль <code>root</code> пуст, поэтому кто
угодно может подсоединиться в качестве <code>root</code> <em>без пароля</em> и получить все
привилегии.

<A NAME="IDX531"></A>
<LI>

Создается анонимный пользователь, который может выполнять любые
операции над базами данных с именами <code>test</code> или начинающимися с <code>test_</code>.
Соединения должны устанавливаться с локального компьютера. Это
означает, что любой локальный пользователь может подключиться без
пароля и будет воспринят сервером как анонимный пользователь.

<LI>

Остальные привилегии запрещены. Например, обычный пользователь не
может использовать команды <code>mysqladmin shutdown</code> или <code>mysqladmin
processlist</code>.
</UL>

<P>
<strong>Примечание</strong>: В Windows принятые по умолчанию привилегии отличаются от
указанных. See section <A HREF="manual.ru.html#Windows_running">2.6.2.3  Работа MySQL в среде Windows</A>.

</P>
<P>
Поскольку сразу после установки программа совершенно не защищена, первым
делом необходимо задать пароль для пользователя MySQL <code>root</code>. Это можно
сделать следующим образом (обратите внимание, что пароль указывается при
помощи функции <code>PASSWORD()</code>):

</P>

<PRE>
shell&#62; mysql -u root mysql
mysql&#62; SET PASSWORD FOR root@localhost=PASSWORD('new_password');
</PRE>

<P>
Опытные пользователи могут работать непосредственно с таблицами назначения
привилегий:

</P>

<PRE>
shell&#62; mysql -u root mysql
mysql&#62; UPDATE user SET Password=PASSWORD('new_password')
    -&#62;     WHERE user='root';
mysql&#62; FLUSH PRIVILEGES;
</PRE>

<P>
Еще один способ задать пароль - воспользоваться командой <code>mysqladmin</code>:

</P>

<PRE>
shell&#62; mysqladmin -u root password new_password
</PRE>

<P>
Изменять пароли других пользователей могут только пользователи с правом
записи/обновления базы данных <code>mysql</code>. Все обычные пользователи (не
анонимные) могут модифицировать только свой собственный пароль при помощи
указанных выше команд или команды <code>SET PASSWORD=PASSWORD('new_password')</code>.

</P>
<P>
Обратите внимание на то, что если пароль в таблице <code>user</code> обновляется
напрямую при помощи первого метода, требуется указать серверу на
необходимость перезагрузки таблиц привилегий (при помощи команды <code>FLUSH
PRIVILEGES</code>), иначе изменения не будут учтены.

</P>
<P>
После того, как был задан пароль <code>root</code>, этот пароль необходимо будет
вводить, подсоединяясь к серверу как <code>root</code>.

</P>
<P>
Можно оставить пароль <code>root</code> пустым, тогда не придется его указывать во
время проведения дополнительных установок и тестирования. Тем не менее,
обязательно укажите его, прежде чем использовать сервер для любой реальной
работы.

</P>
<P>
Ознакомьтесь со скриптом <tt>`scripts/mysql_install_db'</tt>, чтобы увидеть, как
задавать привилегии по умолчанию. Данный скрипт можно использовать как
основу для добавления других пользователей.

</P>
<P>
Если необходимо, чтобы изначальные привилегии отличались от указанных
выше, можно изменить базу <code>mysql_install_db</code> еще до ее запуска.

</P>
<P>
<A NAME="IDX532"></A>
<A NAME="IDX533"></A>
Чтобы полностью заново создать таблицы предоставления привилегий, удалите
все файлы с расширениями <tt>`.frm'</tt>, <tt>`.MYI'</tt> и <tt>`.MYD'</tt> в каталоге, где находится база
данных <code>mysql</code> (это каталог с именем <code>mysql</code> в каталоге базы данных, который
выводится на экран при запуске команды <code>mysqld --help</code>). Затем запустите
скрипт <code>mysql_install_db</code> (возможно, после добавления в него необходимых
привилегий).

</P>
<P>
<strong>Примечание</strong>: в более старых, чем 3.22.10, версиях MySQL файлы с расширением
<tt>`.frm'</tt> удалять не следует. Если же случайно они были удалены, их следует
восстановить, скопировав из дистрибутива MySQL до запуска
<code>mysql_install_db</code>.

</P>


<H3><A NAME="Adding_users" HREF="manual.ru_toc.html#Adding_users">4.3.5  Добавление новых пользователей в MySQL</A></H3>

<P>
<A NAME="IDX534"></A>
<A NAME="IDX535"></A>

</P>
<P>
<A NAME="IDX536"></A>
<A NAME="IDX537"></A>
<A NAME="IDX538"></A>

</P>
<P>
Пользователей можно добавлять двумя различными способами - при помощи
команды <code>GRANT</code> или напрямую в таблицы назначения привилегий MySQL.
Предпочтительнее использовать команду <code>GRANT</code> - этот способ проще и дает
меньше ошибок. See section <A HREF="manual.ru.html#GRANT">4.3.1  Синтаксис команд <code>GRANT</code> и <code>REVOKE</code></A>.

</P>
<P>
Существует также большое количество программ (таких как <code>phpmyadmin</code>),
которые служат для создания и администрирования пользователей. 

</P>
<P>
В приведенных ниже примерах демонстрируется, как использовать клиент <code>mysql</code>
для задания новых пользователей. В примерах предполагается, что привилегии
установлены в соответствии с принятыми по умолчанию значениями, описанными
в предыдущем разделе. Это означает, что для внесения изменений на том же
компьютере, где запущен <code>mysqld</code>, необходимо подсоединиться к серверу как
пользователь MySQL <code>root</code>, и у пользователя <code>root</code> должна быть привилегия
<code>INSERT</code> для базы данных <code>mysql</code>, а также административная привилегия <code>RELOAD</code>.
Кроме того, если был изменен пароль пользователя <code>root</code>, его необходимо
указать здесь для команды <code>mysql</code>.

</P>
<P>
Новых пользователей можно добавлять, используя команду <code>GRANT</code>:

</P>

<PRE>
shell&#62; mysql --user=root mysql
mysql&#62; GRANT ALL PRIVILEGES ON *.* TO monty@localhost
    -&#62;     IDENTIFIED BY 'some_pass' WITH GRANT OPTION;
mysql&#62; GRANT ALL PRIVILEGES ON *.* TO monty@"%"
        -&#62; IDENTIFIED BY 'some_pass' WITH GRANT OPTION;
mysql&#62; GRANT RELOAD,PROCESS ON *.* TO admin@localhost;
mysql&#62; GRANT USAGE ON *.* TO dummy@localhost;
</PRE>

<P>
Эти команды <code>GRANT</code> создают трех новых пользователей:

</P>
<DL COMPACT>

<DT><code>monty</code>
<DD>
Полноценный суперпользователь - он может подсоединяться к серверу откуда
угодно, но должен использовать для этого пароль <code>some_pass</code>. Обратите
внимание на то, что мы должны применить операторы <code>GRANT</code> как для
<code>monty@localhost</code>, так и для <code>monty@"%"</code>. Если не добавить запись с <code>localhost</code>,
запись анонимного пользователя для <code>localhost</code>, которая создается при помощи
<code>mysql_install_db</code>, будет иметь преимущество при подсоединении с локального
компьютера, так как в ней указано более определенное значение для поля
<code>Host</code>, и она расположена раньше в таблице <code>user</code>.

<DT><code>admin</code>
<DD>
Пользователь, который может подсоединяться с <code>localhost</code> без пароля; ему
назначены административные привилегии <code>RELOAD</code> и <code>PROCESS</code>. Эти привилегии
позволяют пользователю запускать команды <code>mysqladmin reload</code>, <code>mysqladmin
refresh</code> и <code>mysqladmin flush-*</code>, а также <code>mysqladmin processlist</code>. Ему не
назначено никаких привилегий, относящихся к базам данных (их можно
назначить позже, дополнительно применив оператор <code>GRANT</code>).

<DT><code>dummy</code>
<DD>
Пользователь, который может подсоединяться к серверу без пароля, но только
с локального компьютера. Все глобальные привилегии установлены в значение
<code>'N'</code>-тип привилегии <code>USAGE</code>, который позволяет создавать пользователей без
привилегий. Предполагается, что относящиеся к базам данных привилегии
будут назначены позже.
</DL>

<P>
<A NAME="IDX539"></A>
<A NAME="IDX540"></A>

</P>
<P>
Можно напрямую добавить точно такую же информацию о пользователе при
помощи оператора <code>INSERT</code>, а затем дать серверу команду перезагрузить
таблицы назначения привилегий:

</P>

<PRE>
shell&#62; mysql --user=root mysql
mysql&#62; INSERT INTO user VALUES('localhost','monty',PASSWORD('some_pass'),
    -&#62;		'Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y');
mysql&#62; INSERT INTO user VALUES('%','monty',PASSWORD('some_pass'),
    -&#62;		'Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y','Y');
mysql&#62; INSERT INTO user SET Host='localhost',User='admin',
    -&#62;		 Reload_priv='Y', Process_priv='Y';
mysql&#62; INSERT INTO user (Host,User,Password)
    -&#62;		 VALUES('localhost','dummy','');
mysql&#62; FLUSH PRIVILEGES;
</PRE>

<P>
В зависимости от версии MySQL в примере, приведенном выше, может
указываться различное количество значений <code>'Y'</code> (в версиях до Version
3.22.11 было меньше столбцов привилегий). Для пользователя <code>admin</code>
используется более удобочитаемый расширенный синтаксис команды <code>INSERT</code>,
который доступен начиная с версии 3.22.11.

</P>
<P>
Обратите внимание: чтобы создать суперпользователя, необходимо создать
запись таблицы <code>user</code> с полями привилегий, установленными в значение <code>'Y'</code>.
Нет необходимости задавать значения в записях таблиц <code>db</code> или <code>host</code>.

</P>
<P>
Столбцы привилегий в таблице user в последнем операторе <code>INSERT</code> (для
пользователя <code>dummy</code>) не были заданы явно, поэтому данным столбцам был
присвоено принятое по умолчанию значение <code>'N'</code>. Точно так же действует
команда <code>GRANT USAGE</code>.

</P>
<P>
В приведенном ниже примере добавляется пользователь <code>custom</code>, который может
подсоединяться с компьютеров <code>localhost</code>, <code>server.domain</code> и <code>whitehouse.gov</code>. Он
хочет получать доступ к базе данных <code>bankaccount</code> только с компьютера
<code>localhost</code>, к базе данных <code>expenses</code> - только с <code>whitehouse.gov</code>, и к базе
данных <code>customer</code> - со всех трех компьютеров, а также использовать пароль
<code>stupid</code> при подсоединении со всех трех компьютеров.

</P>
<P>
Чтобы задать эти привилегии пользователя при помощи оператора <code>GRANT</code>,
выполните следующие команды:

</P>

<PRE>
shell&#62; mysql --user=root mysql
mysql&#62; GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP
    -&#62; 	   ON bankaccount.*
    -&#62; 	   TO custom@localhost
    -&#62;     IDENTIFIED BY 'stupid';
mysql&#62; GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP
    -&#62;     ON expenses.*
    -&#62;     TO custom@whitehouse.gov
    -&#62;     IDENTIFIED BY 'stupid';
mysql&#62; GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP
    -&#62;     ON customer.*
    -&#62;     TO custom@'%'
    -&#62;     IDENTIFIED BY 'stupid';
</PRE>

<P>
Привилегии для пользователя custom мы назначаем потому, что этот
пользователь хочет получать доступ к MySQL как с локального компьютера
через сокеты Unix, так и с удаленного компьютера <code>whitehouse.gov</code> через
протокол TCP/IP.

</P>
<P>
Чтобы задать привилегии пользователя путем непосредственного внесения
изменений в таблицы назначения привилегий, выполните следующие команды
(обратите внимание на команду <code>FLUSH PRIVILEGES</code> в конце примера):

</P>

<PRE>
shell&#62; mysql --user=root mysql
mysql&#62; INSERT INTO user (Host,User,Password)
    -&#62; VALUES('localhost','custom',PASSWORD('stupid'));
mysql&#62; INSERT INTO user (Host,User,Password)
    -&#62; VALUES('server.domain','custom',PASSWORD('stupid'));
mysql&#62; INSERT INTO user (Host,User,Password)
    -&#62; VALUES('whitehouse.gov','custom',PASSWORD('stupid'));
mysql&#62; INSERT INTO db
    -&#62; (Host,Db,User,Select_priv,Insert_priv,Update_priv,Delete_priv,
    -&#62; Create_priv,Drop_priv)
    -&#62; VALUES
    -&#62; ('localhost','bankaccount','custom','Y','Y','Y','Y','Y','Y');
mysql&#62; INSERT INTO db
    -&#62; (Host,Db,User,Select_priv,Insert_priv,Update_priv,Delete_priv,
    -&#62; Create_priv,Drop_priv)
    -&#62; VALUES
    -&#62; ('whitehouse.gov','expenses','custom','Y','Y','Y','Y','Y','Y');
mysql&#62; INSERT INTO db
    -&#62; (Host,Db,User,Select_priv,Insert_priv,Update_priv,Delete_priv,
    -&#62; Create_priv,Drop_priv)
    -&#62; VALUES('%','customer','custom','Y','Y','Y','Y','Y','Y');
mysql&#62; FLUSH PRIVILEGES;
</PRE>

<P>
Первые три оператора <code>INSERT</code> добавляют в таблицу user записи, которые
позволят пользователю <code>custom</code> подключаться с различных компьютеров с
указанным паролем, но не дают ему никаких привилегий (все привилегии
установлены в принятое по умолчанию значение <code>'N'</code>). Следующие три оператора
<code>INSERT</code> добавляют записи в таблицу <code>db</code>, в которой назначаются привилегии для
пользователя <code>custom</code> по отношению к базам данных <code>bankaccount</code>, <code>expenses</code> и
customer, но только если доступ осуществляется с определенных компьютеров.
Как обычно, после внесения изменений непосредственно в таблицы назначения
привилегий серверу необходимо дать команду на перезагрузку этих таблиц
(при помощи <code>FLUSH PRIVILEGES</code>), чтобы внесенные изменения вступили в силу.

</P>
<P>
Если необходимо предоставить определенному пользователю доступ с любого
компьютера к определенному домену, можно воспользоваться оператором <code>GRANT</code>
следующим образом:

</P>

<PRE>
mysql&#62; GRANT ...
    -&#62;	   ON *.*
    -&#62;     TO myusername@"%.mydomainname.com"
    -&#62;     IDENTIFIED BY 'mypassword';
</PRE>

<P>
Чтобы сделать то же самое путем непосредственного внесения изменений в
таблицы назначения привилегий, выполните следующие действия:

</P>

<PRE>
mysql&#62; INSERT INTO user VALUES ('%.mydomainname.com', 'myusername',
    -&#62;		   PASSWORD('mypassword'),...);
mysql&#62; FLUSH PRIVILEGES;
</PRE>



<H3><A NAME="User_resources" HREF="manual.ru_toc.html#User_resources">4.3.6  Ограничение ресурсов пользователя</A></H3>

<P>
Начиная с MySQL версии 4.0.2 можно ограничивать определенные ресурсы,
выделяемые пользователям.

</P>
<P>
До этой версии единственным возможным методом ограничения использования
ресурсов сервера MySQL была установка переменной запуска
<code>max_user_connections</code> в значение, отличное от нуля. Но этот метод действует
только на глобальном уровне и не позволяет управлять отдельными
пользователями. Он может представлять определенный интерес только для
провайдеров услуг Internet.

</P>
<P>
На уровне отдельного пользователя теперь введено управление следующими
тремя ресурсами:

</P>

<UL>
<LI>Количество всех запросов в час: все команды, которые может запускать

пользователь.
<LI>Количество всех обновлений в час: любая команда, которая изменяет

таблицу или базу данных.
<LI>Количество соединений, сделанных за час: новые соединения, открытые за

час.
</UL>

<P>
Пользователь в упомянутом выше контексте представляет собой отдельную
запись в таблице user, которая уникальным образом идентифицируется своими
столбцами <code>user</code> и <code>host</code>.

</P>
<P>
По умолчанию все пользователи не ограничены в использовании указанных выше
ресурсов только в случае, только если эти ограничения не наложены на них.
Данные ограничения могут быть наложены <strong>только</strong> при помощи глобальной
команды <code>GRANT (*.*)</code> с использованием следующего синтаксиса:

</P>

<PRE>
GRANT ... WITH MAX_QUERIES_PER_HOUR N1
	       MAX_UPDATES_PER_HOUR N2
	       MAX_CONNECTIONS_PER_HOUR N3;
</PRE>

<P>
Можно указать любое сочетание приведенных выше ресурсов. N1, N2 и N3
являются целыми числами, представляющими собой значения количеств
запросов/обновлений/соединений в час.

</P>
<P>
Если пользователь в течение часа достигает предела любого из вышеуказанных
значений, его соединение будет прервано с выдачей соответствующего
сообщения об ошибке.

</P>
<P>
Текущие значения для определенного пользователя могут быть сброшены
(установлены в нуль), если воспользоваться оператором <code>GRANT</code> с любым из
приведенных выше пунктов, включая оператор <code>GRANT</code> с текущими значениями.

</P>
<P>
Кроме того, текущие значения для всех пользователей сбрасываются, если
производится перезагрузка привилегий (на сервере или при использовании
команды <code>mysqladmin reload</code>) или если выполняется команда <code>FLUSH
USER_RESOURCES</code>.

</P>
<P>
Эта функция включается сразу после того, как на пользователя будут
наложены ограничения при помощи команды <code>GRANT</code>.

</P>
<P>
Необходимым условием для включения данной функции является наличие в
таблице <code>user</code> базы данных <code>mysql</code> дополнительного столбца, как это определено
в скриптах создания таблиц <code>mysql_install_db</code> и <code>mysql_install_db.sh</code> в
подкаталоге <tt>`scripts'</tt>.

</P>


<H3><A NAME="Passwords" HREF="manual.ru_toc.html#Passwords">4.3.7  Задание паролей</A></H3>

<P>
<A NAME="IDX541"></A>
<A NAME="IDX542"></A>

</P>
<P>
<A NAME="IDX543"></A>
<A NAME="IDX544"></A>

</P>
<P>
В большинстве случаев для задания пользователей и их паролей следует
пользоваться командой <code>GRANT</code>, поэтому приведенная ниже информация
предназначена для опытных пользователей. See section <A HREF="manual.ru.html#GRANT">4.3.1  Синтаксис команд <code>GRANT</code> и <code>REVOKE</code></A>.

</P>
<P>
В примерах, приведенных в предыдущих разделах, демонстрируется важный
принцип, который заключается в следующем: при сохранении непустых паролей
с использованием операторов <code>INSERT</code> или <code>UPDATE</code> для их шифрования должна
применяться функция <code>PASSWORD()</code>. Это делается потому, что в таблице <code>user</code>
пароли хранятся в зашифрованном виде, а не как простой текст. Предположим,
что мы упустили это из виду и задали пароли следующим образом:

</P>

<PRE>
shell&#62; mysql -u root mysql
mysql&#62; INSERT INTO user (Host,User,Password)
    -&#62; VALUES('%','jeffrey','biscuit');
mysql&#62; FLUSH PRIVILEGES;
</PRE>

<P>
В результате выполнения этих команд в таблице user будет сохранено
значение пароля <code>biscuit</code> в виде простого текста. Когда пользователь <code>jeffrey</code>
попытается подсоединиться к серверу, используя этот пароль, клиент <code>mysql</code>
зашифрует его при помощи функции <code>PASSWORD()</code>, сгенерирует вектор
аутентификации, основанный на зашифрованном пароле и случайно выбранном
числе, полученном от сервера, и направит результат на сервер. Сервер
использует значение <code>password</code> из таблицы <code>user</code> (в данном случае, это
незашифрованное значение <code>biscuit</code>), чтобы осуществить точно такие же
вычисления, и сравнит результаты. Результаты не совпадут, и сервер не
позволит установить соединение:

</P>

<PRE>
shell&#62; mysql -u jeffrey -pbiscuit test
Access denied
</PRE>

<P>
Перед занесением в таблицу <code>user</code> пароли необходимо зашифровывать, поэтому
оператор <code>INSERT</code> должен использоваться следующим образом:

</P>

<PRE>
mysql&#62; INSERT INTO user (Host,User,Password)
    -&#62; VALUES('%','jeffrey',PASSWORD('biscuit'));
</PRE>

<P>
При использовании оператора <code>SET PASSWORD</code> также необходимо применять
функцию <code>PASSWORD()</code>:

</P>

<PRE>
mysql&#62; SET PASSWORD FOR jeffrey@"%" = PASSWORD('biscuit');
</PRE>

<P>
Если пароль задается при помощи оператора <code>GRANT ... IDENTIFIED BY</code> или
команды <code>mysqladmin password</code>, нет необходимости использовать функцию
<code>PASSWORD()</code>. Обе эти команды самостоятельно производят шифровку пароля,
поэтому пароль следует указывать как <code>biscuit</code>, например, таким образом:

</P>

<PRE>
mysql&#62; GRANT USAGE ON *.* TO jeffrey@"%" IDENTIFIED BY 'biscuit';
</PRE>

<P>
или

</P>

<PRE>
shell&#62; mysqladmin -u jeffrey password biscuit
</PRE>

<P>
Примечание: Функция <code>PASSWORD()</code> шифрует пароли отличным от Unix образом. Не
следует полагать, что если ваши пароли для Unix и для MySQL совпадают, то
функция <code>PASSWORD()</code> выдаст точно такой же результат шифрования, как и файл
паролей Unix. See section <A HREF="manual.ru.html#User_names">4.3.2  Имена пользователей MySQL и пароли</A>.

</P>


<H3><A NAME="Password_security" HREF="manual.ru_toc.html#Password_security">4.3.8  Обеспечение безопасности своего пароля</A></H3>

<P>
Не рекомендуется указывать пароль таким образом, чтобы его могли подобрать
другие пользователи. Ниже приведены методы, которыми можно пользоваться
при задании своего пароля при запуске указанных клиентских программ, а
также степенью риска для каждого из методов:

</P>

<UL>
<LI>

Никогда не заносите пароль обычного доступа в таблицу <code>mysql.user</code>. Зная
даже зашифрованный пароль пользователя, можно войти в систему под
именем этого пользователя. Пароли шифруются только для того, чтобы
нельзя было увидеть, какой именно пароль используется (если вы
используете один и тот же пароль для разных приложений).

<LI>

Использование параметров <code>-pyour_pass</code> или <code>--password=your_pass</code> в
командной строке удобно, но не очень безопасно, так как ваш пароль
становится видимым для системных статусных утилит (таких как <code>ps</code>), и
другие пользователи могут просмотреть командные строки (во время
запуска клиенты MySQL обычно перезаписывают аргументы командной строки
нулями, но существует небольшой промежуток времени, на протяжении
которого значение остается видимым).

<LI>

Используйте параметр <code>-p</code> или <code>--password</code> (без указания значения
<code>your_pass</code>). В этом случае программа клиента запрашивает пароль с
терминала:
<A NAME="IDX545"></A>
<A NAME="IDX546"></A>
<A NAME="IDX547"></A>
<A NAME="IDX548"></A>


<PRE>
shell&#62; mysql -u user_name -p
Enter password: ********
</PRE>

Ваш пароль будет представлен символами <samp>`*'</samp>.

Вводить пароль таким образом
намного безопаснее, чем из командной строки, поскольку он невидим для
остальных пользователей. Тем не менее, этот метод подходит только для тех
программ, которые вы запускаете самостоятельно. Если клиент требуется
запустить из скрипта, то возможности ввести пароль с терминала не будет. В
некоторых системах первая строка скрипта считывается и неправильно
распознается как ваш пароль!

<LI>

<A NAME="IDX549"></A>
Храните свой файл в файле конфигурации. Например, можно записать свои
пароли в разделе <code>[client]</code> файла <tt>`.my.cnf'</tt> в своем каталоге:


<PRE>
[client]
password=your_pass
</PRE>

Если пароль хранится в <tt>`.my.cnf'</tt>, файл не должен быть доступен для чтения
или записи для всех или для отдельных групп пользователей. Убедитесь, что
права доступа к файлу установлены в 400 или 600. 

<LI>

Можно хранить свой пароль в переменной окружения <code>MYSQL_PWD</code>, но этот
метод считается очень небезопасным и не должен использоваться. В
некоторые версии ps включена возможность отображать переменные
окружения работающего процесса. Поэтому если задать свой пароль при
помощи <code>MYSQL_PWD</code>, он будет виден для всех,. Даже в системах без такой
версии <code>ps</code>, неразумно предполагать, что не существует другого метода
получить информацию по переменным окружения. See section <A HREF="manual.ru.html#Environment_variables">E  Переменные окружения</A>.
</UL>

<P>
Исходя из всего сказанного выше, самыми безопасными методами указания
пароля являются запрос программы клиента на ввод пароля с терминала или
указание пароля в защищенном надлежащим образом файле <tt>`.my.cnf'</tt>.

</P>


<H3><A NAME="Secure_connections" HREF="manual.ru_toc.html#Secure_connections">4.3.9  Использование безопасных соединений</A></H3>

<P>
<A NAME="IDX550"></A>
<A NAME="IDX551"></A>

</P>



<H4><A NAME="Secure_basics" HREF="manual.ru_toc.html#Secure_basics">4.3.9.1  Основные сведения</A></H4>

<P>
MySQL поддерживает шифрованные SSL-соединения. Для лучшего понимания того,
как в MySQL используется SSL, мы приводим здесь основные сведения по SSL и
X509. Пользователи, которые уже знакомы с данным протоколом и стандартом,
эту часть могут пропустить.

</P>
<P>
По умолчанию в MySQL используются незашифрованные соединения между
клиентом и сервером. Это означает, что просматривать все данные,
передаваемые между клиентом и сервером, может кто угодно. На практике
можно даже изменять данные во время передачи их от клиента к серверу и
наоборот. Помимо того, иногда возникает необходимость передать
действительно секретные данные через общедоступную сеть - в таких случаях
использование незашифрованных соединений просто неприемлемо.

</P>
<P>
В протоколе SSL используются различные алгоритмы шифрования,
обеспечивающие безопасность для данных, передаваемых через общедоступные
сети. Этот протокол содержит средства, позволяющие обнаруживать любые
изменения, потери и повторы данных. В протоколе SSL также применяются
алгоритмы для проведения идентификации при помощи стандарта X509.

</P>
<P>
<A NAME="IDX552"></A>
Шифровка - это метод, позволяющий сделать прочтение любых данных
невозможным. Фактически при современном положении дел для алгоритмов
шифрования требуется использование дополнительных элементов безопасности.
Они должны обеспечивать противодействие многим видам известных на
настоящий момент атак, таких как изменение порядка зашифрованных сообщений
или повторение данных.

</P>
<P>
<A NAME="IDX553"></A>
Стандарт X509 позволяет производить идентификацию в Internet. Чаще всего
он используется в приложениях электронной коммерции. Упрощенно схема его
применения выглядит следующим образом: существует некая организация под
названием "Certificate Authority" (можно перевести как ``Сертификационное
Бюро''. - Прим. пер.), которая назначает электронные сертификаты всем,
кому они нужны. Сертификаты основываются на асимметричных алгоритмах
шифрования, содержащих два ключа - публичный и секретный. Владелец
сертификата может подтвердить свою личность, предъявив свой сертификат
другой стороне. Сертификат состоит из публичного ключа владельца. Любые
данные, зашифрованные при помощи этого публичного ключа могут быть
расшифрованы только при помощи соответствующего секретного ключа, который
находится у владельца сертификата.

</P>
<P>
В MySQL по умолчанию не используется шифрование при соединениях, так как
это значительно замедляет обмен данными между клиентом и сервером. Любые
дополнительные функции приводят к дополнительной нагрузке для компьютера,
а шифрование данных требует интенсивной работы процессора, что может
вызвать задержку выполнения основных задач MySQL. По умолчанию MySQL
настроен на максимально быструю работу.

</P>
<P>
Если вы хотите получить дополнительную информацию о SSL/X509/шифровании,
необходимо воспользоваться своим любимым поисковым сервером Internet и
произвести поиск по словам, которые вас интересуют.

</P>


<H4><A NAME="Secure_requirements" HREF="manual.ru_toc.html#Secure_requirements">4.3.9.2  Требования</A></H4>

<P>
Для того чтобы SSL-соединения могли работать с MySQL, необходимо выполнить
следующие действия:

</P>

<OL>
<LI>

Установите библиотеку OpenSSL. Тестирование MySQL производилось с
библиотекой OpenSSL 0.9.6. <a HREF="http://www.openssl.org/">http://www.openssl.org/</a>.
<LI>

Выполните настройку компиляции MySQL (<code>configure</code>) при помощи параметров
<code>--with-vio --with-openssl</code>.
<LI>

Если используется старая версия MySQL, то необходимо обновить таблицу
<code>mysql.user</code> путем добавления в нее определенных новых столбцов. Это
можно сделать, запустив скрипт <code>mysql_fix_privilege_tables.sh</code>.
<LI>

Проверить, скомпилирована ли в запущенном сервере <code>mysqld</code> библиотека
OpenSSL можно, убедившись, что <code>SHOW VARIABLES LIKE 'have_openssl'</code> показывает
<code>YES</code>.
</OL>



<H4><A NAME="Secure_Create_Certs" HREF="manual.ru_toc.html#Secure_Create_Certs">4.3.9.3  Создание SSL-сертификатов</A></H4>

<P>
Вот пример, как создаются SSL-сертификаты для MySQL: 

</P>

<PRE>
DIR=`pwd`/openssl
PRIV=$DIR/private

mkdir $DIR $PRIV $DIR/newcerts
cp /usr/share/ssl/openssl.cnf $DIR
replace ./demoCA $DIR -- $DIR/openssl.cnf

# создаем необходимые файлы: $database, $serial и каталог $new_certs_dir 
# (опционально)

touch $DIR/index.txt
echo "01" &#62; $DIR/serial

#
# Создаем Certificate Authority(CA)
#

openssl req -new -x509 -keyout $PRIV/cakey.pem -out $DIR/cacert.pem \
    -config $DIR/openssl.cnf

# Пример вывода:
# Using configuration from /home/monty/openssl/openssl.cnf
# Generating a 1024 bit RSA private key
# ................++++++
# .........++++++
# writing new private key to '/home/monty/openssl/private/cakey.pem'
# Enter PEM pass phrase:
# Verifying password - Enter PEM pass phrase:
# -----
# You are about to be asked to enter information that will be incorporated
# into your certificate request.
# What you are about to enter is what is called a Distinguished Name or a DN.
# There are quite a few fields but you can leave some blank
# For some fields there will be a default value,
# If you enter '.', the field will be left blank.
# -----
# Country Name (2 letter code) [AU]:FI
# State or Province Name (full name) [Some-State]:.
# Locality Name (eg, city) []:
# Organization Name (eg, company) [Internet Widgits Pty Ltd]:MySQL AB
# Organizational Unit Name (eg, section) []:
# Common Name (eg, YOUR name) []:MySQL admin
# Email Address []:

#
# Создаем server-request и ключ
#
openssl req -new -keyout $DIR/server-key.pem -out \
    $DIR/server-req.pem -days 3600 -config $DIR/openssl.cnf

# Пример вывода:
# Using configuration from /home/monty/openssl/openssl.cnf
# Generating a 1024 bit RSA private key
# ..++++++
# ..........++++++
# writing new private key to '/home/monty/openssl/server-key.pem'
# Enter PEM pass phrase:
# Verifying password - Enter PEM pass phrase:
# -----
# You are about to be asked to enter information that will be incorporated
# into your certificate request.
# What you are about to enter is what is called a Distinguished Name or a DN.
# There are quite a few fields but you can leave some blank
# For some fields there will be a default value,
# If you enter '.', the field will be left blank.
# -----
# Country Name (2 letter code) [AU]:FI
# State or Province Name (full name) [Some-State]:.
# Locality Name (eg, city) []:
# Organization Name (eg, company) [Internet Widgits Pty Ltd]:MySQL AB
# Organizational Unit Name (eg, section) []:
# Common Name (eg, YOUR name) []:MySQL server
# Email Address []:
# 
# Please enter the following 'extra' attributes
# to be sent with your certificate request
# A challenge password []:
# An optional company name []:

#
# Удаляем парольную фразу из ключа (опционально)
#

openssl rsa -in $DIR/server-key.pem -out $DIR/server-key.pem

#
# Подписываем сертификат сервера
#
openssl ca  -policy policy_anything -out $DIR/server-cert.pem \
    -config $DIR/openssl.cnf -infiles $DIR/server-req.pem

# Пример вывода:
# Using configuration from /home/monty/openssl/openssl.cnf
# Enter PEM pass phrase:
# Check that the request matches the signature
# Signature ok
# The Subjects Distinguished Name is as follows
# countryName           :PRINTABLE:'FI'
# organizationName      :PRINTABLE:'MySQL AB'
# commonName            :PRINTABLE:'MySQL admin'
# Certificate is to be certified until Sep 13 14:22:46 2003 GMT (365 days)
# Sign the certificate? [y/n]:y
# 
# 
# 1 out of 1 certificate requests certified, commit? [y/n]y
# Write out database with 1 new entries
# Data Base Updated

#
# Создаем client request и ключ
#
openssl req -new -keyout $DIR/client-key.pem -out \
    $DIR/client-req.pem -days 3600 -config $DIR/openssl.cnf

# Пример вывода:
# Using configuration from /home/monty/openssl/openssl.cnf
# Generating a 1024 bit RSA private key
# .....................................++++++
# .............................................++++++
# writing new private key to '/home/monty/openssl/client-key.pem'
# Enter PEM pass phrase:
# Verifying password - Enter PEM pass phrase:
# -----
# You are about to be asked to enter information that will be incorporated
# into your certificate request.
# What you are about to enter is what is called a Distinguished Name or a DN.
# There are quite a few fields but you can leave some blank
# For some fields there will be a default value,
# If you enter '.', the field will be left blank.
# -----
# Country Name (2 letter code) [AU]:FI
# State or Province Name (full name) [Some-State]:.
# Locality Name (eg, city) []:
# Organization Name (eg, company) [Internet Widgits Pty Ltd]:MySQL AB
# Organizational Unit Name (eg, section) []:
# Common Name (eg, YOUR name) []:MySQL user
# Email Address []:
# 
# Please enter the following 'extra' attributes
# to be sent with your certificate request
# A challenge password []:
# An optional company name []:

#
# Удаляем парольную фразу из ключа (опционально)
#
openssl rsa -in $DIR/client-key.pem -out $DIR/client-key.pem

#
# Подписываем клиентский сертификат
#

openssl ca  -policy policy_anything -out $DIR/client-cert.pem \
    -config $DIR/openssl.cnf -infiles $DIR/client-req.pem

# Пример вывода:
# Using configuration from /home/monty/openssl/openssl.cnf
# Enter PEM pass phrase:
# Check that the request matches the signature
# Signature ok
# The Subjects Distinguished Name is as follows
# countryName           :PRINTABLE:'FI'
# organizationName      :PRINTABLE:'MySQL AB'
# commonName            :PRINTABLE:'MySQL user'
# Certificate is to be certified until Sep 13 16:45:17 2003 GMT (365 days)
# Sign the certificate? [y/n]:y
# 
# 
# 1 out of 1 certificate requests certified, commit? [y/n]y
# Write out database with 1 new entries
# Data Base Updated

#
# Создаем такой my.cnf, который позволит нам протестировать сертификаты
#

cnf=""
cnf="$cnf [client]"
cnf="$cnf ssl-ca=$DIR/cacert.pem"
cnf="$cnf ssl-cert=$DIR/client-cert.pem"
cnf="$cnf ssl-key=$DIR/client-key.pem"
cnf="$cnf [mysqld]"
cnf="$cnf ssl-ca=$DIR/cacert.pem"
cnf="$cnf ssl-cert=$DIR/server-cert.pem"
cnf="$cnf ssl-key=$DIR/server-key.pem"
echo $cnf | replace " " '
' &#62; $DIR/my.cnf

#
# Тестируем MySQL

mysqld --defaults-file=$DIR/my.cnf &#38;

mysql --defaults-file=$DIR/my.cnf
</PRE>

<P>
Вы также можете тестировать сертификаты путем модификации <code>my.cnf</code> таким образом, 
чтобы использовать демонстрационные сертификаты в каталоге <code>mysql-source-dist/SSL</code>. 

</P>


<H4><A NAME="Secure_GRANT" HREF="manual.ru_toc.html#Secure_GRANT">4.3.9.4  Параметры команды <code>GRANT</code></A></H4>

<P>
<A NAME="IDX554"></A>
<A NAME="IDX555"></A>
<A NAME="IDX556"></A>

</P>
<P>
В дополнение к обычной схеме имя пользователя/пароль MySQL может
производить проверку атрибутов сертификата X509. Для этого необходимы
также все обычные параметры (имя пользователя, пароль, маска IP-адреса,
имя базы данных/таблицы).

</P>
<P>
Существует несколько возможностей ограничить соединения:

</P>

<UL>
<LI>

Если не указано никаких параметров SSL/X509, а имя пользователя и
пароль указаны правильно, то разрешены все виды шифрованных и
нешифрованных соединений.

<LI>

Параметр <code>REQUIRE SSL</code> позволяет серверу устанавливать только
зашифрованные при помощи протокола SSL соединения. Обратите внимание,
что этот параметр может быть неприемлемым, если существуют записи ACL,
разрешающие не-SSL соединения.


<PRE>
mysql&#62; GRANT ALL PRIVILEGES ON test.* TO root@localhost
    -&#62; IDENTIFIED BY "goodsecret" REQUIRE SSL;
</PRE>

<LI>

<code>REQUIRE X509</code> означает, что у клиента должен быть действительный
сертификат, но мы не требуем наличия определенного сертификата,
сертификата определенной фирмы или темы. Единственное ограничение -
подпись должна поддаваться проверке при помощи одного из сертификатов
бюро сертификации.


<PRE>
mysql&#62; GRANT ALL PRIVILEGES ON test.* TO root@localhost
    -&#62; IDENTIFIED BY "goodsecret" REQUIRE X509;
</PRE>

<LI>

<code>REQUIRE ISSUER "issuer"</code> делает требования по соединению более
определенными: теперь клиент должен предоставить действительный
сертификат X509, выданный бюро сертификации (CA) <code>"issuer"</code>. Использование
сертификатов X509 всегда означает применение шифрования, поэтому
параметр <code>SSL</code> больше не нужен.


<PRE>
mysql&#62; GRANT ALL PRIVILEGES ON test.* TO root@localhost
    -&#62; IDENTIFIED BY "goodsecret"
    -&#62; REQUIRE ISSUER "C=FI, ST=Some-State, L=Helsinki,
    "&#62; O=MySQL Finland AB, CN=Tonu Samuel/Email=tonu@mysql.com";
</PRE>

<LI>

<code>REQUIRE SUBJECT "subject"</code> требует наличия у клиента действительного
сертификата X509 с содержащейся в нем темой "subject". Если у клиента
есть действительный сертификат, но другой "subject", то соединение не
будет установлено.


<PRE>
mysql&#62; GRANT ALL PRIVILEGES ON test.* TO root@localhost
    -&#62; IDENTIFIED BY "goodsecret"
    -&#62; REQUIRE SUBJECT "C=EE, ST=Some-State, L=Tallinn,
    "&#62; O=MySQL demo client certificate,
    "&#62; CN=Tonu Samuel/Email=tonu@mysql.com";
</PRE>

<LI>

<code>REQUIRE CIPHER "cipher"</code> требуется для обеспечения достаточно сложных
шифра и длины ключа. Протокол SSL сам по себе может быть ненадежным
из-за использования старых алгоритмов с короткими ключами шифрования.
Воспользовавшись этим параметром, мы можем указать определенный метод
шифрования, разрешающий соединение.


<PRE>
mysql&#62; GRANT ALL PRIVILEGES ON test.* TO root@localhost
    -&#62; IDENTIFIED BY "goodsecret"
    -&#62; REQUIRE CIPHER "EDH-RSA-DES-CBC3-SHA";
</PRE>

Разрешается также сочетать <code>SUBJECT</code>, <code>ISSUER</code>, <code>CIPHER</code> в <code>REQUIRE</code>, например, так: 


<PRE>
mysql&#62; GRANT ALL PRIVILEGES ON test.* TO root@localhost
    -&#62; IDENTIFIED BY "goodsecret"
    -&#62; REQUIRE SUBJECT "C=EE, ST=Some-State, L=Tallinn,
    "&#62; O=MySQL demo client certificate,
    "&#62; CN=Tonu Samuel/Email=tonu@mysql.com"
    -&#62; AND ISSUER "C=FI, ST=Some-State, L=Helsinki,
    "&#62; O=MySQL Finland AB, CN=Tonu Samuel/Email=tonu@mysql.com"
    -&#62; AND CIPHER "EDH-RSA-DES-CBC3-SHA";
</PRE>

Начиная с MySQL 4.0.4, слово <code>AND</code> необязательно в опциях <code>REQUIRE</code>. 

Порядок опций не имеет значения, но ни одна опция не может быть указана дважды.

</UL>



<H2><A NAME="Disaster_Prevention" HREF="manual.ru_toc.html#Disaster_Prevention">4.4  Предотвращение катастроф и восстановление</A></H2>



<H3><A NAME="Backup" HREF="manual.ru_toc.html#Backup">4.4.1  Резервное копирование баз данных</A></H3>

<P>
<A NAME="IDX557"></A>
<A NAME="IDX558"></A>

</P>
<P>
Поскольку таблицы MySQL хранятся в виде файлов, то резервное копирование
выполняется легко. Чтобы резервная копия была согласованной, выполните на
выбранных таблицах <code>LOCK TABLES</code>, а затем <code>FLUSH TABLES</code> для этих таблиц (см.
разделы section <A HREF="manual.ru.html#LOCK_TABLES">6.7.2  Синтаксис команд <code>LOCK TABLES/UNLOCK TABLES</code></A> и see section <A HREF="manual.ru.html#FLUSH">4.5.3  Синтаксис команды <code>FLUSH</code></A>). При этом
требуется блокировка только на чтение; поэтому другие потоки смогут
продолжать запросы на таблицах в то время, пока будут создаваться копии
файлов из каталога базы данных. Команда <code>FLUSH TABLE</code> обеспечивает гарантию
того, что все активные индексные страницы будут записаны на диск прежде,
чем начнется резервное копирование.

</P>
<P>
Начиная с 3.23.56 и 4.0.12 <code>BACKUP TABLE</code> не позволит вам перезаписать существующие
файлы, так как это создает потенциальные проблемы в безопасности. 

</P>
<P>
Если есть необходимость провести резервное копирование на уровне SQL, то
можно воспользоваться <code>SELECT INTO OUTFILE</code> или <code>BACKUP TABLE</code> (см. разделы
section <A HREF="manual.ru.html#SELECT">6.4.1  Синтаксис оператора <code>SELECT</code></A> и see section <A HREF="manual.ru.html#BACKUP_TABLE">4.4.2  Синтаксис <code>BACKUP TABLE</code></A>).

</P>
<P>
Существует еще один способ создать резервную копию базы данных -
использовать программу <code>mysqldump</code> или сценарий <code>mysqlhotcopy</code> (см. разделы
section <A HREF="manual.ru.html#mysqldump">4.8.5  <code>mysqldump</code>, Получение дампов данных и структуры таблицы</A> и see section <A HREF="manual.ru.html#mysqlhotcopy">4.8.6  <code>mysqlhotcopy</code>, Копирование баз данных и таблиц MySQL</A>).  Для этого нужно выполнить следующие действия:

</P>

<OL>
<LI>

Сделать полное резервное копирование баз данных:


<PRE>
shell&#62; mysqldump --tab=/path/to/some/dir --opt --all

или

shell&#62; mysqlhotcopy database /path/to/some/dir
</PRE>

Можно также просто скопировать табличные файлы (файлы <tt>`*.frm'</tt>, <tt>`*.MYD'</tt> и
<tt>`*.MYI'</tt>) в тот момент, когда сервер не проводит никаких обновлений. Этот
метод используется в сценарии <code>mysqlhotcopy</code>.

<LI>

<A NAME="IDX559"></A>
<A NAME="IDX560"></A>
Если <code>mysqld</code> выполняется, остановить его, и затем запустить с опцией
<code>--log-update[=file_name]</code> (see section <A HREF="manual.ru.html#Update_log">4.9.3  Журнал обновлений (update)</A>). В файлах журнала
обновлений находится информация, необходимая для того, чтобы повторить
в базе данных последовательность изменений, внесенных с момента
выполнения <code>mysqldump</code>.
</OL>

<P>
Если дело дошло до восстановления, сначала надо попробовать восстановить
таблицы с помощью <code>REPAIR TABLE</code> или <code>myisamchk -r</code> - это должно сработать в
99,9% случаев. Если <code>myisamchk</code> не даст результата, попробуйте применить
следующую процедуру (эти действия применимы только в случае, если MySQL
запускался с <code>--log-update</code> (see section <A HREF="manual.ru.html#Update_log">4.9.3  Журнал обновлений (update)</A>)):

</P>

<OL>
<LI>

Восстановите исходный вариант по копии, сделанной в <code>mysqldump</code>.

<LI>

Выполните следующую команду, чтобы повторить обновления из бинарного
журнала:


<PRE>
shell&#62; mysqlbinlog hostname-bin.[0-9]* | mysql
</PRE>

Если используется журнал обновлений, то можно применить:


<PRE>
shell&#62; ls -1 -t -r hostname.[0-9]* | xargs cat | mysql
</PRE>

</OL>

<P>
<code>ls</code> используется для того, чтобы расположить все файлы журнала обновлений в
правильном порядке.

</P>
<P>
Можно проводить избирательное резервное копирование посредством <code>SELECT *
INTO OUTFILE 'file_name' FROM tbl_name</code>, а восстановление - при помощи <code>LOAD
DATA INFILE 'file_name' REPLACE ...</code> Чтобы избежать повторения записей, в
таблице должен быть <code>первичный</code> или <code>уникальный ключ</code>. Ключевое слово <code>REPLACE</code>
задает замену старых записей новыми в случае, когда новая запись в
значении уникального ключа повторяет старую.

</P>
<P>
Если в системе, где выполняется резервное копирование, возникают проблемы
с производительностью, то решить их можно, установив репликацию и выполняя
резервное копирование на подчиненном сервере вместо головного (see section <A HREF="manual.ru.html#Replication_Intro">4.10.1  Введение</A>).

</P>
<P>
Пользователи файловой системы Veritas могут поступить следующим образом:

</P>

<OL>
<LI>

Из  клиента (или Perl) выполнить: <code>FLUSH TABLES WITH READ LOCK</code>.

<LI>

Из другого shell выполнить: <code>mount vxfs snapshot</code>.

<LI>

Из первого клиента выполнить: <code>UNLOCK TABLES</code>.

<LI>

Скопировать файлы из образа.

<LI>

Демонтировать образ.
</OL>



<H3><A NAME="BACKUP_TABLE" HREF="manual.ru_toc.html#BACKUP_TABLE">4.4.2  Синтаксис <code>BACKUP TABLE</code></A></H3>

<P>
<A NAME="IDX561"></A>

</P>
<P>
<A NAME="IDX562"></A>

</P>

<PRE>
BACKUP TABLE tbl_name[,tbl_name...] TO '/path/to/backup/directory'
</PRE>

<P>
Копирует в каталог резервного копирования тот минимум табличных файлов, который
достаточен для восстановления таблицы, после сброса на диск всех изменений. На
данный момент работает только для таблиц <code>MyISAM</code>. Для таблиц
<code>MyISAM</code> копирует файлы <tt>`.frm'</tt> (определений) и <tt>`.MYD'</tt> (данных).
Индексные файлы могут быть реконструированы по этим двум.

</P>
<P>
Перед использованием этой команды, пожалуйста, ознакомьтесь с разделом
See section <A HREF="manual.ru.html#Backup">4.4.1  Резервное копирование баз данных</A>.

</P>
<P>
В процессе резервного копирования будет установлена блокировка  чтения
отдельно для каждой таблицы на время ее копирования. Если необходимо
сделать резервное копирование в виде мгновенного образа нескольких таблиц,
необходимо сначала запросить <code>LOCK TABLES</code> установки блокировки  чтения для
каждой таблицы в группе.

</P>
<P>
Команда возвращает таблицу со следующими столбцами:

</P>
<TABLE BORDER>
<TR><TD><strong>Столбец</strong> </TD><TD> <strong>Значение</strong>
</TD></TR>
<TR><TD>Table </TD><TD> Имя таблицы
</TD></TR>
<TR><TD>Op </TD><TD> Всегда ``backup''
</TD></TR>
<TR><TD>Msg_type </TD><TD> Одно  из  значений <code>status</code>, <code>error</code>, <code>info</code> или <code>warning</code>.
</TD></TR>
<TR><TD>Msg_text </TD><TD> Само сообщение.
</TD></TR>
</TABLE>

<P>
Заметим, что <code>BACKUP TABLE</code> доступна только в версии MySQL 3.23.25 и выше.

</P>


<H3><A NAME="RESTORE_TABLE" HREF="manual.ru_toc.html#RESTORE_TABLE">4.4.3  Синтаксис <code>RESTORE TABLE</code></A></H3>

<P>
<A NAME="IDX563"></A>

</P>

<PRE>
RESTORE TABLE tbl_name[,tbl_name...] FROM '/path/to/backup/directory'
</PRE>

<P>
Восстанавливает таблицу(ы) из резервной копии, созданной с помощью <code>BACKUP
TABLE</code>. Существующие таблицы не перезаписываются: при попытке
восстановления поверх существующей таблицы будет выдана ошибка.
Восстановление занимает больше времени, нежели <code>BACKUP</code> - из-за
необходимости повторного построения индекса. Чем больше в таблице будет
ключей, тем больше времени заберет реконструкция. Эта команда, так же как
и <code>BACKUP TABLE</code>, в настоящее время работает только для таблиц <code>MyISAM</code>.

</P>
<P>
Команда возвращает таблицу со следующими столбцами:

</P>
<TABLE BORDER>
<TR><TD><strong>Столбец</strong> </TD><TD> <strong>Значение</strong>
</TD></TR>
<TR><TD>Table </TD><TD> Имя таблицы
</TD></TR>
<TR><TD>Op </TD><TD> Всегда ``restore''
</TD></TR>
<TR><TD>Msg_type </TD><TD> Одно  из  значений <code>status</code>, <code>error</code>, <code>info</code> или <code>warning</code>.
</TD></TR>
<TR><TD>Msg_text </TD><TD> Само сообщение.
</TD></TR>
</TABLE>



<H3><A NAME="CHECK_TABLE" HREF="manual.ru_toc.html#CHECK_TABLE">4.4.4  Синтаксис <code>CHECK TABLE</code></A></H3>

<P>
<A NAME="IDX564"></A>

</P>

<PRE>
CHECK TABLE tbl_name[,tbl_name...] [option [option...]]

option = QUICK | FAST | MEDIUM | EXTENDED | CHANGED
</PRE>

<P>
<code>CHECK TABLE</code> работает только на таблицах <code>MyISAM</code> и <code>InnoDB</code>. На таблицах типа
<code>MyISAM</code> команда эквивалентна запуску на таблице <code>myisamchk -m table_name</code>.

</P>
<P>
Если опция не указана, используется <code>MEDIUM</code>.

</P>
<P>
Проверяет таблицу(ы) на наличие ошибок. Для таблиц <code>MyISAM</code> обновляется
статистика ключей. Команда возвращает таблицу со следующими столбцами:

</P>
<TABLE BORDER>
<TR><TD><strong>Столбец</strong> </TD><TD> <strong>Значение</strong>
</TD></TR>
<TR><TD>Table </TD><TD> Имя таблицы.
</TD></TR>
<TR><TD>Op </TD><TD> Всегда ``check''.
</TD></TR>
<TR><TD>Msg_type </TD><TD> Одно из значений <code>status</code>, <code>error</code>, <code>info</code>, или <code>warning</code>.
</TD></TR>
<TR><TD>Msg_text </TD><TD> Само сообщение.
</TD></TR>
</TABLE>

<P>
Заметим, что по каждой проверяемой таблице может быть выдано много строк
информации. Последняя строка будет  представлять <code>Msg_type status</code> и, как
правило, должна содержать <code>OK</code>. Если выдается что-либо отличное от
<code>OK</code> и <code>Not checked</code>, то обычно следует провести ремонт таблицы
(see section <A HREF="manual.ru.html#Table_maintenance">4.4.6  Использование <code>myisamchk</code> для профилактики таблиц и послеаварийного</A>). <code>Table already up to date</code> свидетельствует о
том, что указанный для таблицы тип (<code>TYPE</code>) вернул информацию о том, что
таблица не нуждается в проверке.

</P>
<P>
Различные типы проверки означают следующее:

</P>
<TABLE BORDER>
<TR><TD><strong>Тип</strong> </TD><TD> <strong>Действия</strong>
</TD></TR>
<TR><TD><code>QUICK</code> </TD><TD> Не сканировать строки для проверки на неправильные связи.
</TD></TR>
<TR><TD><code>FAST</code> </TD><TD> Проверять только таблицы, которые не были корректно закрыты.
</TD></TR>
<TR><TD><code>CHANGED</code> </TD><TD> Проверять только таблицы, которые изменились со времени последней
проверки или не были закрыты корректно.
</TD></TR>
<TR><TD><code>MEDIUM</code> </TD><TD> Сканировать строки для проверки того, что уничтоженные связи в                               порядке. При этом также подсчитывается ключевая контрольная сумма для                               строки и сравнивается с подсчитанной контрольной суммой для ключей.
</TD></TR>
<TR><TD><code>EXTENDED</code> </TD><TD> Выполнить полный просмотр ключа для всех ключей для каждой                                 строки. Успех такой проверки гарантирует 100%-ное отсутствие противоречий                           в таблице, но на проверку уйдет немало времени!
</TD></TR>
</TABLE>

<P>
Для таблиц <code>MyISAM</code> с динамическими размерами при запуске проверки всегда
выполняется проверка <code>MEDIUM</code>. Для строк со статическими размерами мы
пропускаем сканирование строк для <code>QUICK</code> и <code>FAST</code>, поскольку повреждение
строк происходит крайне редко.

</P>
<P>
Проверочные опции можно сочетать:

</P>

<PRE>
CHECK TABLE test_table FAST QUICK;
</PRE>

<P>
Эта команда просто вызовет быструю проверку таблицы для выявления того,
была ли она закрыта корректно.

</P>
<P>
<strong>Примечание</strong>: в некоторых случаях <code>CHECK TABLE</code> изменяет таблицу! Это
происходит, если таблица помечена как 'поврежденная/corrupted' или 'не
закрытая корректно/not closed properly', а <code>CHECK TABLE</code> не находит никаких
проблем в таблице. В этом случае <code>CHECK TABLE</code> отметит в таблице, что с ней
все нормально.

</P>
<P>
Если таблица повреждена, то, скорее всего, проблема в индексах, а не в
данных. Проверки всех типов обеспечивают всестороннюю проверку индексов и
тем самым должны обнаруживать большинство ошибок.

</P>
<P>
Если проверяется таблица, с которой предположительно все нормально, то
можно опустить проверочные опции или указать опцию <code>QUICK</code>. Последнюю
возможность следует использовать в случае ограничений по времени и тогда,
когда можно пойти на риск (очень незначительный), что <code>QUICK</code> пропустит
ошибку в файле данных. (В большинстве случаев MySQL должен найти - при
нормальной работе - любые ошибки в файле с данными. Если ошибки найдены,
то таблица будет отмечена как 'поврежденная/corrupted', и в таком случае
ее нельзя будет использовать, пока она не будет исправлена.)

</P>
<P>
<code>FAST</code> и <code>CHANGED</code> главным образом предназначены для использования в сценариях
(например, для запуска из <code>cron</code>), если необходимо время от времени
проверять таблицы. В большинстве случаев следует отдавать предпочтение
<code>FAST</code> перед <code>CHANGED</code> (иначе надо поступать только в случае, когда возникает
подозрение, что найдена ошибка в самом коде <code>MyISAM</code>).

</P>
<P>
Прибегать к <code>EXTENDED</code> следует только тогда, когда после выполнения
нормальной проверки для таблицы по-прежнему выдаются странные ошибки при
попытке MySQL обновить строку или найти строку по ключу (что очень
маловероятно в случае успеха нормальной проверки!).

</P>
<P>
Некоторые проблемы, о которых сообщается при проверке таблицы, нельзя
исправить автоматически:

</P>

<UL>
<LI>

<code>Found row where the auto_increment column has the value 0</code>.

Это означает, что в таблице есть строка, где индексированный столбец
<code>AUTO_INCREMENT</code> содержит значение 0 (строку, в которой столбец
<code>AUTO_INCREMENT</code> имеет значение 0, можно создать, явно установив столбец
в 0 командой <code>UPDATE</code>).

Это само по себе не является ошибкой, но может
вызвать неприятности, если понадобится сделать дамп таблицы или
восстановить ее или выполнить над ней <code>ALTER</code> TABLE. В этом случае
столбец с атрибутом <code>AUTO_INCREMENT</code> изменит значение в соответствии с
правилами для столбцов <code>AUTO_INCREMENT</code>, что может вызвать проблемы,
подобные ошибке дублирования ключа.

Чтобы избавиться от
предупреждения, просто выполните команду <code>UPDATE</code> для установки в
столбце значения, отличного от 0.
</UL>



<H3><A NAME="REPAIR_TABLE" HREF="manual.ru_toc.html#REPAIR_TABLE">4.4.5  Синтаксис <code>REPAIR TABLE</code></A></H3>

<P>
<A NAME="IDX565"></A>

</P>

<PRE>
REPAIR TABLE tbl_name[,tbl_name...] [QUICK] [EXTENDED] [USE_FRM]
</PRE>

<P>
<code>REPAIR TABLE</code> работает только на таблицах типа <code>MyISAM</code> и эквивалентна
выполнению на таблице <code>myisamchk -r table_name</code>.

</P>
<P>
При обыкновенной работе запускать эту команду не приходится, но если
случится катастрофа, то с помощью <code>REPAIR TABLE</code> практически наверняка
удастся вернуть все данные из таблицы <code>MyISAM</code>. Если таблицы сильно
повреждены, то следует постараться выяснить, что послужило этому причиной!
Обращайтесь к разделам section <A HREF="manual.ru.html#Crashing">A.4.1  Что делать, если работа MySQL сопровождается постоянными сбоями</A> и See section <A HREF="manual.ru.html#MyISAM_table_problems">7.1.3  Проблемы с таблицами <code>MyISAM</code>.</A>.

</P>
<P>
<code>REPAIR TABLE</code> ремонтирует таблицу, которая, возможно, повреждена. Команда
возвращает таблицу со следующими столбцами:
<TABLE BORDER>
<TR><TD><strong>Столбец</strong> </TD><TD> <strong>Значение</strong>
</TD></TR>
<TR><TD>Table </TD><TD> Имя таблицы
</TD></TR>
<TR><TD>Op </TD><TD> Всегда ``repair''
</TD></TR>
<TR><TD>Msg_type </TD><TD> Одно из значений <code>status</code>, <code>error</code>, <code>info</code> или <code>warning</code>.
</TD></TR>
<TR><TD>Msg_text </TD><TD> Само сообщение.
</TD></TR>
</TABLE>

</P>
<P>
Заметим, что по каждой ремонтируемой таблице может быть выдано много строк
информации. Последняя строка будет представлять <code>Msg_type status</code> и, как
правило, должна содержать <code>OK</code>. Если выдается что-либо отличное от <code>OK</code>, то
следует попробовать исправить таблицу с помощью <code>myisamchk -o</code>, поскольку в
<code>REPAIR TABLE</code> пока реализованы не все опции <code>myisamchk</code>. В скором будущем мы
сделаем команду более гибкой.

</P>
<P>
Если указан <code>QUICK</code>, то MySQL будет пытаться сделать <code>REPAIR</code> только
индексного дерева.

</P>
<P>
Если используется <code>EXTENDED</code>, то MySQL будет создавать индекс строка за
строкой вместо создания по одному индексу единоразово с помощью
сортировки; такая техника может работать лучше сортировки для ключей
фиксированной длины, если речь идет о хорошо сжимаемых ключах типа <code>CHAR</code> 
большой длины. Это такой же ремонт, как делается с помощью <code>myisamchk --safe-recover</code>.

</P>
<P>
Что касается MySQL 4.0.2, то тут для <code>REPAIR</code> существует режим <code>USE_FRM</code>.
Используйте его, если отсутствует файл <tt>`.MYI'</tt> или поврежден его заголовок. В
этом режиме MySQL воссоздаст таблицу, используя информацию из файла <tt>`.frm'</tt>.
Этот вид исправления в <code>myisamchk</code> недоступен.

</P>


<H3><A NAME="Table_maintenance" HREF="manual.ru_toc.html#Table_maintenance">4.4.6  Использование <code>myisamchk</code> для профилактики таблиц и послеаварийного</A></H3>
<P>
восстановления

</P>
<P>
Начиная с версии MySQL 3.23.13 таблицы <code>MyISAM</code> можно проверять с помощью
команды <code>CHECK TABLE</code> (see section <A HREF="manual.ru.html#CHECK_TABLE">4.4.4  Синтаксис <code>CHECK TABLE</code></A>). Для исправления
таблиц используется команда <code>REPAIR TABLE</code> (see section <A HREF="manual.ru.html#REPAIR_TABLE">4.4.5  Синтаксис <code>REPAIR TABLE</code></A>).

</P>
<P>
Для проверки/ремонта таблиц типа <code>MyISAM</code> (<tt>`.MYI'</tt> и <tt>`.MYD'</tt>) следует использовать
утилиту <code>myisamchk</code>, а для <code>ISAM</code> (<tt>`.ISM'</tt> и <tt>`.ISD'</tt>') - утилиту <code>isamchk</code> (see section <A HREF="manual.ru.html#Table_types">7  Типы  таблиц MySQL</A>).

</P>
<P>
Ниже мы будем говорить о <code>myisamchk</code>, но все сказанное справедливо также и
для более старой <code>isamchk</code>.

</P>
<P>
Утилиту <code>myisamchk</code> можно использовать для получения информации о таблицах
рабочей базы данных, для их проверки и исправления или же оптимизации. В
следующих разделах описывается, как запускать <code>myisamchk</code> (включая описание
ее опций), как настроить график профилактики таблицы и как использовать
myisamchk для выполнения различных функций.

</P>
<P>
В большинстве случаев для оптимизации и исправления таблиц можно также
использовать команду <code>OPTIMIZE</code> TABLES, но этот вариант не такой быстрый и
не такой надежный (в случае действительно фатальных ошибок), как
<code>myisamchk</code>. С другой стороны, <code>OPTIMIZE TABLE</code> проще в использовании и
освобождает от забот со сбросом таблиц на диск (see section <A HREF="manual.ru.html#OPTIMIZE_TABLE">4.5.1  Синтаксис  команды <code>OPTIMIZE TABLE</code></A>).

</P>
<P>
Хотя исправление при помощи <code>myisamchk</code> и достаточно безопасно, никогда не
будет лишним сделать резервную копию прежде, чем выполнять ремонт (или
любые другие действия, которые могут привнести в таблицу значительные
изменения)

</P>



<H4><A NAME="myisamchk_syntax" HREF="manual.ru_toc.html#myisamchk_syntax">4.4.6.1  Синтаксис запуска <code>myisamchk</code></A></H4>

<P>
<code>myisamchk</code> запускается следующим образом:

</P>

<PRE>
shell&#62; myisamchk [options] tbl_name
</PRE>

<P>
Опции options определяют, что должна сделать <code>myisamchk</code>. В данном разделе
дается описание этих опций (список опций можно также получить, запустив
<code>myisamchk --help</code>). Если опции не указаны, <code>myisamchk</code> просто проверяет
таблицу. Чтобы получить дополнительную информацию или указать <code>myisamchk</code>
выполнить корректирующие действия, надо задать опции, как это описано в
этом и в следующих разделах.

</P>
<P>
<code>tbl_name</code> - это таблица базы данных, которую нужно проверить/исправить.
Если <code>myisamchk</code> запускается не из каталога базы данных, то следует задать
путь к файлу, поскольку <code>myisamchk</code> не имеет представления о том, где искать
базу данных. В действительности для <code>myisamchk</code> не важно, где находятся
рабочие файлы - в каталоге базы данных или нет; можно скопировать файлы,
относящиеся к базе данных, в другое место и выполнить операции
восстановления над ними там.

</P>
<P>
При желании в командной строке <code>myisamchk</code> можно перечислить имена
нескольких таблиц. В качестве имени можно также указать имя индексного
файла (с суффиксом <tt>`.MYI'</tt>), что позволит задавать все таблицы в каталоге при
помощи шаблона <tt>`*.MYI'</tt>. Например, находясь в каталоге базы данных, можно
проверить все таблицы этого каталога следующим образом:

</P>

<PRE>
shell&#62; myisamchk *.MYI
</PRE>

<P>
Если каталог базы данных не является текущим, то все таблицы каталога
можно проверить, указав к нему путь:

</P>

<PRE>
shell&#62; myisamchk /path/to/database_dir/*.MYI
</PRE>

<P>
Можно даже проверить все таблицы во всех базах данных, если задать шаблон
вместе с путем к каталогу данных MySQL:

</P>

<PRE>
shell&#62; myisamchk /path/to/datadir/*/*.MYI
</PRE>

<P>
Быстро проверять все таблицы рекомендуется следующим образом:

</P>

<PRE>
myisamchk --silent --fast /path/to/datadir/*/*.MYI
isamchk --silent /path/to/datadir/*/*.ISM
</PRE>

<P>
Если необходимо проверить все таблицы и исправить все поврежденные из них,
можно использовать следующую строку:

</P>

<PRE>
myisamchk --silent --force --fast --update-state -O key_buffer=64M \
	  -O sort_buffer=64M -O read_buffer=1M -O write_buffer=1M \
	  /path/to/datadir/*/*.MYI
isamchk --silent --force -O key_buffer=64M -O sort_buffer=64M \
	-O read_buffer=1M -O write_buffer=1M /path/to/datadir/*/*.ISM
</PRE>

<P>
Эти команды предполагают, что имеется более чем 64 Mб свободного
пространства.

</P>
<P>
Следует отметить, что если выдается ошибка, подобная следующей:

</P>

<PRE>
myisamchk: warning: 1 clients is using or hasn't closed the table properly
</PRE>

<P>
то это означает, что делается попытка проверить таблицу, обновленную
другой программой (такой как <code>mysqld</code>), которая еще не закрыла файл или чье
выполнение было прервано без возможности корректно закрыть файл.

</P>
<P>
Если <code>mysqld</code> запущен, то необходимо принудительно вызвать
синхронизацию/закрытие всех таблиц с помощью <code>FLUSH TABLES</code> и обеспечить,
чтобы никто не использовал таблиц, пока выполняется <code>myisamchk</code>. В версии
MySQL 3.23 самый простой способ избежать этой проблемы заключается в
применении для проверки таблиц команды <code>CHECK TABLE</code> вместо <code>myisamchk</code>.

</P>


<H4><A NAME="myisamchk_general_options" HREF="manual.ru_toc.html#myisamchk_general_options">4.4.6.2  Общие опции для <code>myisamchk</code></A></H4>

<P>
<A NAME="IDX566"></A>
<A NAME="IDX567"></A>
<A NAME="IDX568"></A>
<A NAME="IDX569"></A>

</P>
<P>
<code>myisamchk</code> поддерживает следующие опции.

</P>
<DL COMPACT>

<DT><code>-# или --debug=debug_options</code>
<DD>
Вывод отладочной информации. Часто строка <code>debug_options</code> имеет следующий
вид <code>d:t:o,filename</code>.
<DT><code>-? или --help</code>
<DD>
Отображение справочного сообщения с завершением работы.
<DT><code>-O var=option, --set-variable var=option</code>
<DD>
Устанавливает значение переменной.  Внимание:  <code>--set-variable</code>
морально устарела в MySQL 4.0, просто используйте <code>--var=option</code>.
Вывести список допустимых переменных и
их значений по умолчанию для <code>myisamchk</code> можно с помощью <code>myisamchk --help</code>:

<TABLE BORDER>
<TR><TD><strong>Переменная</strong> </TD><TD> <strong>Значение</strong>
</TD></TR>
<TR><TD>key_buffer_size </TD><TD> 523264
</TD></TR>
<TR><TD>read_buffer_size </TD><TD> 262136
</TD></TR>
<TR><TD>write_buffer_size </TD><TD> 262136
</TD></TR>
<TR><TD>sort_buffer_size </TD><TD> 2097144
</TD></TR>
<TR><TD>sort_key_blocks </TD><TD> 16
</TD></TR>
<TR><TD>decode_bits </TD><TD> 9
</TD></TR>
</TABLE>

<code>sort_buffer_size</code> применяется, когда ключи исправляются посредством
сортировки ключей (обычный случай при указании <code>--recover</code>), а
<code>key_buffer_size</code> - если таблица проверяется с <code>--extended-check</code> или если
ключи исправляются посредством вставки ключей в таблицу построчно (как при
выполнении обычных вставок). Исправление через ключевой буфер применяется
в следующих случаях:


<UL>
<LI>

Если используется <code>--safe-recover</code>.
<LI>

Если размер требуемых для сортировки временных файлов будет более чем
вдвое превышать объем, требующийся при создании ключевого файла
непосредственно. Так часто обстоит дело, когда присутствуют большие ключи
типов <code>CHAR</code>, <code>VARCHAR</code> или <code>TEXT</code>, поскольку при сортировке необходимо
сохранять ключи целиком. Имея временное пространство на диске в избытке,
можно заставить <code>myisamchk</code> делать исправления посредством сортировки, задав
опцию <code>--sort-recover</code>.
</UL>

Ремонт посредством ключевого буфера требует значительно меньше
пространства, чем при использовании сортировки, однако выполняется
значительно медленнее. Когда желательно ускорить выполнение
ремонта/исправления, переменные нужно установить равными приблизительно
1/4 доступной памяти. Можно для обеих переменных задавать большие
значения, поскольку всякий раз будет использоваться только один из
рассматриваемых буферов.

<DT><code>-s или --silent</code>
<DD>
Молчаливый режим. Выдавать сообщения только при возникновении ошибок.
Можно использовать <code>-s</code> дважды (<code>-ss</code>), чтобы предельно ограничить выдачу
сообщений утилитой <code>myisamchk</code>.
<DT><code>-v или --verbose</code>
<DD>
Расширенный режим вывода. Выдается больше информации. Можно использовать с
<code>-d</code> и <code>-e</code>. Можно использовать <code>-v</code> многократно (<code>-vv</code>, <code>-vvv</code>) - чтобы еще более
расширить сводку!
<DT><code>-V или --version</code>
<DD>
Отображение версии <code>myisamchk</code> и завершение работы.
<DT><code>-w или, --wait</code>
<DD>
Если таблица заблокирована, то не выдавать ошибки, а, дождавшись снятия
блокировки с таблицы, продолжить выполнение. Заметим, что если <code>mysqld</code>
выполняется на таблице с <code>--skip-external-locking</code>, то таблица может быть
заблокирована только другой командой <code>myisamchk</code>.
</DL>



<H4><A NAME="myisamchk_check_options" HREF="manual.ru_toc.html#myisamchk_check_options">4.4.6.3  Проверочные опции для <code>myisamchk</code></A></H4>

<P>
<A NAME="IDX570"></A>
<A NAME="IDX571"></A>

</P>
<DL COMPACT>

<DT><code>-c или --check</code>
<DD>
Проверить таблицы на ошибки. Является операцией по умолчанию, если
<code>myisamchk</code> не передаются другие опции, меняющие это поведение.
<DT><code>-e или --extend-check</code>
<DD>
Проверить таблицу очень тщательно (выполняется достаточно медленно в
случае большого количества индексов). Эту опцию следует использовать в
экстремальных ситуациях. В большинстве случаев <code>myisamchk</code> или <code>myisamchk</code>
<code>--medium-check</code> вполне достаточно для выявления ошибок в таблице. Если
используется <code>--extended-check</code> и система располагает приличным объемом
памяти, то следует значительно увеличить значение <code>key_buffer_size</code>!
<DT><code>-F или --fast</code>
<DD>
Проверять только таблицы, которые не были корректно закрыты.
<DT><code>-C или --check-only-changed</code>
<DD>
Проверять только таблицы, изменившиеся с момента последней проверки.
<DT><code>-f или --force</code>
<DD>
Выполнять перезапуск <code>myisamchk</code> с <code>-r</code> (исправить) на таблице, если <code>myisamchk</code>
найдет в ней хоть одну ошибку.
<DT><code>-i или --information</code>
<DD>
Выдавать статистическую информацию о проверяемой таблице.
<DT><code>-m или --medium-check</code>
<DD>
Быстрее, чем расширенная проверка (<code>extended-check</code>), но при этом
обнаруживается только 99,99% из общего числа ошибок (чего, однако, в
большинстве случаев вполне достаточно).
<DT><code>-U или --update-state</code>
<DD>
Отмечать в файле <tt>`.MYI'</tt> факт проверки таблицы и наличие повреждений. Опцию
следует использовать для получения максимального эффекта от опции
<code>--check-only-changed</code>, однако ее применение недопустимо, если <code>mysqld</code>
работает с таблицей и был запущен с опцией <code>--skip-external-locking</code>.
<DT><code>-T или --read-only</code>
<DD>
Не отмечать таблицу как проверенную. Это может пригодиться, когда
myisamchk используется для проверки таблиц, используемых каким-то другим
приложением, и это приложение не выполняет блокировку (как <code>mysqld
--skip-external-locking</code>).
</DL>



<H4><A NAME="myisamchk_repair_options" HREF="manual.ru_toc.html#myisamchk_repair_options">4.4.6.4  Опции исправления для <code>myisamchk</code></A></H4>

<P>
<A NAME="IDX572"></A>
<A NAME="IDX573"></A>

</P>
<P>
Следующие опции используются, если <code>myisamchk</code> запускается с <code>-r</code> или <code>-o</code>:

</P>
<DL COMPACT>

<DT><code></code>
<DD>
-D # или --data-file-length=#
Максимальная длина файла данных (когда файл данных пересоздается при его
``переполнении'').
<DT><code></code>
<DD>
-e или --extend-check
Пробовать исправлять каждую возможную строку из файла данных. Обычно при
этом обнаруживается масса замусоренных строк. Использовать эту опцию
следует только в самом крайнем случае, когда больше ничего не остается.
<DT><code></code>
<DD>
-f или --force
Писать поверх старых временных файлов (<tt>`table_name.TMD'</tt>) вместо аварийного
прекращения.
<DT><code></code>
<DD>
-k # или keys-used=#
Если используется <code>ISAM</code>, то данный параметр предписывает обработчику таблиц
<code>ISAM</code> на необходимость обновить только первые <code>#</code> индексов. Если используется
<code>MyISAM</code>, то определяет, какие ключи использовать, при этом каждый двоичный
бит соответствует одному ключу (первый ключ - это бит 0). Может
использоваться для ускорения вставок! Отключенные индексы можно снова
активизировать с помощью <code>myisamchk -r. keys</code>.
<DT><code></code>
<DD>
-l или --no-symlinks
Не рассматривать символические ссылки. Обычно <code>myisamchk</code> исправляет
таблицы, на которые указывают символические ссылки. Данная опция
отсутствует в MySQL 4.0, в связи с тем, что MySQL 4.0 не удаляет
символические ссылки во время восстановления.
<DT><code></code>
<DD>
-r или --recover
При указании этой опции можно исправить  практически все, кроме уникальных ключей, в которых есть повторения (ошибка, вероятность которой мизерна для таблиц <code>ISAM</code>/<code>MyISAM</code>). Если необходимо восстановить таблицу, то начинать надо с этой опции. Только если <code>myisamchk</code> сообщит, что таблица не может быть восстановлена с помощью <code>-r</code>, тогда следует пытаться применять <code>-o</code> 
(отметим, что в тех маловероятных случаях, когда <code>-r</code> не срабатывает, файл
данных остается неизменным), В случае большого объема памяти следует
увеличить размер <code>sort_buffer_size</code>!
<DT><code>-o или --safe-recover</code>
<DD>
Используется старый метод восстановления (читаются подряд все строки и
обновляются все деревья индексов на основе найденных строк); такой
алгоритм работает на порядок медленнее <code>-r</code>, но метод справляется с
несколькими редкими случаями, непосильными для <code>-r</code>. При этом методе
восстановления также используется значительно меньше дискового
пространства, нежели в случае <code>-r</code>. Обычно всегда следует начинать с
исправления посредством <code>-r</code>, и только если результат не будет достигнут,
использовать <code>-o</code>. Для систем с большим объемом памяти следует увеличить
размер <code>key_buffer_size</code>!
<DT><code>-n или --sort-recover</code>
<DD>
Заставляет <code>myisamchk</code> использовать сортировку при разрешении ключей, даже
если это потребует временных файлов очень большого размера.
<DT><code>--character-sets-dir=...</code>
<DD>
Каталог, где хранятся кодировки.
<DT><code>--set-character-set=name</code>
<DD>
Изменить используемую для индекса кодировку
<DT><code>-t или --tmpdir=path</code>
<DD>
Путь для хранения временных файлов. Если не задан, <code>myisamchk</code> использует
для пути переменную окружения <code>TMPDIR</code>.
Начиная с MySQL 4.1, в <code>TMPDIR</code> могут быть указаны несколько путей, разделенных
двоеточием <code>:</code> (точкой с запятой на Windows <code>;</code>). Эти пути будут 
использованы в ротации. Это используется для того, чтобы распределить
данные между разными физическими дисками. 
<DT><code>-q или --quick</code>
<DD>
Быстрый ремонт без изменения файла данных. Можно добавить вторую <code>-q</code>,
чтобы дать <code>myisamchk</code> санкцию на изменение исходного файла данных в случае
дублирования ключей
<DT><code>-u или --unpack</code>
<DD>
Распаковать файл, упакованный в <code>myisampack</code>.
</DL>



<H4><A NAME="myisamchk_other_options" HREF="manual.ru_toc.html#myisamchk_other_options">4.4.6.5  Другие опции для <code>myisamchk</code></A></H4>

<P>
Кроме ремонта и проверки таблиц, <code>myisamchk</code> может выполнять другие
операции:

</P>
<DL COMPACT>

<DT><code>-a или --analyze</code>
<DD>
Анализировать распределение ключей. Улучшает эффективность операции
связывания  за счет включения оптимизатора связей. Он обеспечивает лучший
порядок связывания таблиц и определяет, какие ключи при этом следует
использовать: <code>myisamchk --describe --verbose table_name</code> или посредством
<code>SHOW KEYS</code> в MySQL.
<DT><code>-d или --description</code>
<DD>
Отображает некоторую информацию о таблице.
<DT><code>-A или --set-auto-increment[=value]</code>
<DD>
Предписывает, чтобы отсчет значений <code>AUTO_INCREMENT</code> начинался с <code>value</code> или
большего значения. Если значение не указано, то в качестве следующего
значения <code>AUTO_INCREMENT</code> берется наибольшее использованное значение для
автоинкрементного ключа + 1.
<DT><code>-S или --sort-index</code>
<DD>
Сортировать блоки индексного дерева в порядке от больших к меньшим
(high-low). Этим оптимизируются операции поиска и повышается скорость
сканирования по ключу.
<DT><code>-R или --sort-records=#</code>
<DD>
Сортирует записи в соответствии с индексом. Это значительно повышает
локализацию данных и может ускорить операции <code>SELECT</code> и <code>ORDER BY</code>, которые
выполняются по индексу и выбирают данные по какому-либо интервалу.
(Возможно, что первая сортировка будет выполняться очень медленно!) Чтобы
узнать номера индексов таблицы, нужно использовать команду <code>SHOW INDEX</code>,
показывающую индексы таблицы в том же порядке, в каком их видит <code>myisamchk</code>.
Индексы нумеруются начиная с 1.
</DL>



<H4><A NAME="myisamchk_memory" HREF="manual.ru_toc.html#myisamchk_memory">4.4.6.6  Использование памяти утилитой <code>myisamchk</code></A></H4>

<P>
<A NAME="IDX574"></A>

</P>
<P>
При работе <code>myisamchk</code> очень важно распределение памяти. Объем используемой
<code>myisamchk</code> памяти не превышает количества, указанного с помощью опций <code>-O</code>.
Когда речь идет о применении <code>myisamchk</code> на очень больших файлах, следует
сначала принять решение о том, какое количество памяти будет при этом
использоваться. По умолчанию для целей исправления ошибок отводится только
около 3Mб. Применяя большие величины, можно достичь большей скорости
работы <code>myisamchk</code>. К примеру, если имеется более 32Mб оперативной памяти, 
то можно задать следующие опции (в дополнение к любым другим указанным опциям):

</P>

<PRE>
shell&#62; myisamchk -O sort=16M -O key=16M -O read=1M -O write=1M ...
</PRE>

<P>
В большинстве случаев достаточно использовать <code>-O sort=16M</code>.

</P>
<P>
Важно понимать, что <code>myisamchk</code> использует временные файлы, для указания на
которые служит <code>TMPDIR</code>. Если <code>TMPDIR</code> указывает на файловую систему с
размещением в памяти, то велика вероятность ошибок нехватки памяти (out of
memory). Если такое произойдет, то в <code>TMPDIR</code> следует поместить имя
некоторого другого каталога с большим пространством и перезапустить
<code>myisamchk</code>.

</P>
<P>
При выполнении ремонта <code>myisamchk</code> также понадобится большое количество
дискового пространства; :

</P>

<UL>
<LI>

Потребуется пространство порядка удвоенного размера файла - для
оригинала и копии файла данных. В этом пространстве нет необходимости,
когда исправление выполняется с <code>--quick</code>, поскольку в этом случае повторно
создается только индексный файл. Дополнительное место необходимо на том же
диске, где находится оригинальный файл записи!

<LI>

Необходимо место для нового индексного файла, заменяющего старый. В
начальной фазе выполнения старый индексный файл усекается, поэтому обычно
данный объем можно не учитывать. Место должно обеспечиваться на диске,
содержащем оригинальный индексный файл!

<LI>

При указании <code>--recover</code> или <code>--sort-recover</code> (но не в случае использования
<code>--safe-recover</code>) потребуется место для буфера сортировки:
(<code>largest_key + row_pointer_length)*number_of_rows * 2</code>.
Можно узнать длину ключей и <code>row_pointer_length</code> с помощью
<code>myisamchk -dv table</code>.
Это пространство выделяется на временном диске (который определяется при помощи <code>TMPDIR</code> либо
<code>--tmpdir=#</code>).
</UL>

<P>
Если возникнут проблемы в связи с нехваткой дискового пространства во
время исправления, можно попробовать использовать <code>--safe-recover</code> вместо
<code>--recover</code>.

</P>


<H4><A NAME="Crash_recovery" HREF="manual.ru_toc.html#Crash_recovery">4.4.6.7  Использование myisamchk для послеаварийного восстановления</A></H4>

<P>
<A NAME="IDX575"></A>
<A NAME="IDX576"></A>

</P>
<P>
При выполнении <code>mysqld</code> со <code>--skip-external-locking</code> (установка по умолчанию в
некоторых системах, подобных Linux) применение <code>myisamchk</code> для проверки
таблицы, когда она используется <code>mysqld</code>, не совсем безопасно. Если есть
уверенность, что никто не обратится к таблицам через <code>mysqld</code> во время
выполнения <code>myisamchk</code>, то достаточно до начала проверки таблиц выполнить
<code>mysqladmin flush-tables</code>, если нет - то на время проверки таблиц необходимо
приостановить <code>mysqld</code>. При запуске <code>myisamchk</code> в то время, когда <code>mysqld</code>
обновляет таблицы, может быть выдано предупреждение о повреждении таблицы
- даже в случае, если этого не произошло.

</P>
<P>
Если <code>--skip-external-locking</code> не используется, то проверять таблицы с помощью
<code>myisamchk</code> можно в любое время. Во время проверки все пытающиеся обновить
таблицу клиенты получат возможность сделать это, только дождавшись
готовности <code>myisamchk</code>.

</P>
<P>
Если <code>myisamchk</code> применяется для ремонта или оптимизации таблиц, то всегда
необходимо обеспечить отсутствие обращений сервера <code>mysqld</code> к таблице (это
также относится к случаю использования <code>--skip-external-locking</code>). Если <code>mysqld</code> не
может быть приостановлен, то до <code>myisamchk</code>, как минимум, надо выполнить
<code>mysqladmin flush-tables</code>. Таблицы могут быть повреждены, если сервер и
<code>myisamchk</code> обратятся к таблицам одновременно.

</P>
<P>
В данном разделе описывается, как выявлять повреждения данных в базах
данных MySQL и что делать с повреждениями дальше. Если таблица
повреждается часто, то надо постараться отыскать причину этих повреждений!
Обращайтесь к разделу See section <A HREF="manual.ru.html#Crashing">A.4.1  Что делать, если работа MySQL сопровождается постоянными сбоями</A>.

</P>
<P>
Причины повреждения таблиц рассматриваются также в разделе по таблицам
<code>MyISAM</code>. Обращайтесь к разделу See section <A HREF="manual.ru.html#MyISAM_table_problems">7.1.3  Проблемы с таблицами <code>MyISAM</code>.</A>.

</P>
<P>
При выполнении послеаварийного восстановления важно понимать, что каждой
таблице <code>tbl_name</code> в базе данных соответствуют три файла в каталоге базы
данных:

</P>
<TABLE BORDER>
<TR><TD><strong>Файл</strong> </TD><TD> <strong>Назначение</strong>
</TD></TR>
<TR><TD><tt>`tbl_name.frm'</tt> </TD><TD> Файл определения таблицы (формы)
</TD></TR>
<TR><TD><tt>`tbl_name.MYD'</tt> </TD><TD> Файл данных
</TD></TR>
<TR><TD><tt>`tbl_name.MYI'</tt> </TD><TD> Индексный файл
</TD></TR>
</TABLE>

<P>
Каждый из этих трех типов файлов ``имеет'' свои виды повреждений, но
наиболее часто проблемы возникают с файлами данных и индексными файлами.

</P>
<P>
Во время своей работы <code>myisamchk</code> построчно создает копию файла (данных)
<tt>`.MYD'</tt>. Стадия исправления завершается тем, что программа удаляет старый
файл <tt>`.MYD'</tt> и переименовывает новый путем присвоения ему имени исходного.
Если используется <code>--quick</code>, <code>myisamchk</code> не создает временного файла <tt>`.MYD'</tt>, а,
исходя из предположения, что файл <tt>`.MYD'</tt> правилен, только формирует новый
индексный файл, никак не меняя файл <tt>`.MYD'</tt>. Это безопасно, поскольку
<code>myisamchk</code> автоматически распознает, что файл <tt>`.MYD'</tt> запорчен, и в этом
случае прерывает исправление. Можно также задавать для <code>myisamchk</code> две опции
<code>--quick</code>. В этом случае <code>myisamchk</code> не прерывается аварийно по некоторым
ошибкам (таким как дублирование ключа), а пытается исправить их путем
модификации файла <tt>`.MYD'</tt>. Обычно использование двух опций <code>--quick</code> имеет
смысл только в случае, если свободного места на диске недостаточно для
выполнения нормального исправления. Тогда перед запуском <code>myisamchk</code> следует
по крайней мере выполнить резервное копирование.

</P>


<H4><A NAME="Check" HREF="manual.ru_toc.html#Check">4.4.6.8  Как проверять таблицы на ошибки</A></H4>

<P>
<A NAME="IDX577"></A>
<A NAME="IDX578"></A>
<A NAME="IDX579"></A>

</P>
<P>
Для проверки таблицы <code>MyISAM</code> используются следующие команды:

</P>
<DL COMPACT>

<DT><code>myisamchk tbl_name</code>
<DD>
Находит 99,99% всех ошибок. Не в состоянии отыскать повреждений,
затрагивающих только файл данных (которые весьма необычны). Если
необходимо только проверить таблицу, то обычно следует выполнить myisamchk
без опций либо с одной из опций -s или --silent.

<DT><code>myisamchk -m tbl_name</code>
<DD>
Находит 99,999% всех ошибок. Сначала на ошибки проверяются все индексные
элементы, а затем читаются все строки подряд. Программа вычисляет
контрольную сумму для всех ключей в строке и проверяет, совпадает ли она с
контрольной суммой в индексном дереве.

<DT><code>myisamchk -e tbl_name</code>
<DD>
В этом случае выполняется полная и тщательная проверка всех данных (<code>-e</code> 
означает ``расширенная проверка''). Происходит тестовое чтение каждого ключа
для каждой строки с целью контроля того, что ключи указывают на нужные
строки. Для большой таблицы с множеством ключей на это может потребоваться
много времени. <code>myisamchk</code> обычно останавливается после обнаружения первой
ошибки, но если желательно получить более подробную информацию, можно
добавить опцию <code>--verbose</code> (<code>-v</code>) - таким образом выполнение <code>myisamchk</code> будет
продолжаться вплоть до максимума в 20 ошибок. При нормальной работе
достаточно просто запустить <code>myisamchk</code> (без аргументов за исключением имени
таблицы).

<DT><code>myisamchk -e -i tbl_name</code>
<DD>
Аналогична предыдущей команде, но опция <code>-i</code> указывает <code>myisamchk</code>
дополнительно отображать некоторую статистическую информацию.
</DL>



<H4><A NAME="Repair" HREF="manual.ru_toc.html#Repair">4.4.6.9  Как ремонтировать таблицы</A></H4>

<P>
<A NAME="IDX580"></A>
<A NAME="IDX581"></A>

</P>
<P>
В данном разделе рассматривается только использование <code>myisamchk</code> на
таблицах <code>MyISAM</code> (расширения <tt>`.MYI'</tt> и <tt>`.MYD'</tt>). Если же в системе применяются
таблицы <code>ISAM</code> (расширения <tt>`.ISM'</tt> и <tt>`.ISD'</tt>), то следует пользоваться <code>isamchk</code>.

</P>
<P>
Начиная с версии MySQL 3.23.14 можно ремонтировать таблицы <code>MyISAM</code> при
помощи команды <code>REPAIR TABLE</code> (see section <A HREF="manual.ru.html#REPAIR_TABLE">4.4.5  Синтаксис <code>REPAIR TABLE</code></A>).

</P>
<P>
К симптомам повреждения таблицы относятся неожиданные прерывания
выполнения запросов и появление следующих ошибок:

</P>

<UL>
<LI>

<tt>`tbl_name.frm'</tt> is locked against change (Файл  заблокирован  для 
изменений)
<LI>

Can't find file <tt>`tbl_name.MYI'</tt> (Errcode: ###) (Не  могу  найти  файл
<tt>`tbl_name.MYI'</tt> (Ошибка: ###))
<LI>

Unexpected end of file (Неожиданно  наступил  конец)
<LI>

Record file is crashed (Файл  записей  испорчен)
<LI>

Got error ### from table handler (Получена  ошибка ### от  дескриптора 
таблицы). Для получения более подробной информации об ошибке можно
выполнить <code>perror</code> ###. Чаще всего о проблемах с таблицей свидетельствуют
следующие ошибки:

<PRE>
shell&#62; perror 126 127 132 134 135 136 141 144 145
126 = Index file is crashed / Wrong file format
127 = Record-file is crashed
132 = Old database file
134 = Record was already deleted (or record file crashed)
135 = No more room in record file
136 = No more room in index file
141 = Duplicate unique key or constraint on write or update
144 = Table is crashed and last repair failed
145 = Table was marked as crashed and should be repaired
</PRE>

Заметим, что ошибка 135 - 'no more room in record file' ('не осталось места в
файле записей'), не может быть исправлена просто выполнением ремонта. В
этом случае необходимо использовать следующую команду:


<PRE>
ALTER TABLE table MAX_ROWS=xxx AVG_ROW_LENGTH=yyy;
</PRE>

</UL>

<P>
В других случаях следует выполнять ремонт таблиц. <code>myisamchk</code> обычно может
обнаружить и исправить большинство неполадок.

</P>
<P>
Процесс ремонтирования включает до четырех описанных здесь стадий. Перед
тем как приступить к ремонту, необходимо выполнить <tt>`cd'</tt> в каталог базы
данных и проверить права доступа к табличным файлам. Файлы должны быть
доступны для чтения Unix-пользователю, от имени которого выполняется
<code>mysqld</code>, (а также выполняющему ремонт, поскольку ему приходится обращаться
к проверяемым файлам). Если появится необходимость изменять файлы, то
проверяющий также должен иметь доступ для записи.

</P>
<P>
Если используется версия MySQL 3.23.16 и выше, то для проверки и ремонта
таблиц <code>MyISAM</code> можно (и нужно) использовать команды <code>CHECK</code> и <code>REPAIR</code> (section <A HREF="manual.ru.html#CHECK_TABLE">4.4.4  Синтаксис <code>CHECK TABLE</code></A> и see section <A HREF="manual.ru.html#REPAIR_TABLE">4.4.5  Синтаксис <code>REPAIR TABLE</code></A>).

</P>
<P>
Раздел руководства, посвященный сопровождению таблиц, содержит опции к
<code>isamchk</code>/<code>myisamchk</code> (see section <A HREF="manual.ru.html#Table_maintenance">4.4.6  Использование <code>myisamchk</code> для профилактики таблиц и послеаварийного</A>).

</P>
<P>
Случаи, когда упомянутые команды не дают результата или желательно
использовать расширенные возможности, представленные в <code>isamchk</code>/<code>myisamchk</code>,
рассматриваются в следующем разделе.

</P>
<P>
Если ремонт таблицы планируется выполнять из командной строки то сначала
требуется остановить сервер. Следует отметить, что при выполнении
<code>mysqladmin shutdown</code> с удаленного сервера <code>mysqld</code> все еще будет некоторое
время работать после завершения <code>mysqladmin</code>, пока не будут остановлены все
запросы и сброшены на диск все ключи.

</P>
<P>
<strong>Стадия 1: проверка таблиц</strong>

</P>
<P>
Выполните <code>myisamchk *.MYI</code> или, если вы располагаете временем, <code>myisamchk -e
*.MYI</code>. Используйте опцию <code>-s</code> (молчаливый режим) для подавления ненужной
информации.

</P>
<P>
Если <code>mysqld</code> остановлен, то следует использовать опцию <code>--update-state</code> для
указания <code>myisamchk</code> отмечать таблицы как 'проверенные'(checked).

</P>
<P>
Ремонтировать следует только те таблицы, для которых <code>myisamchk</code> выдала
ошибки. Для таких таблиц следует перейти к стадии 2.

</P>
<P>
Если во время проверки будут получены странные ошибки (подобные out of
memory), или <code>myisamchk</code> завершится аварийно, то перейдите к стадии 3.

</P>
<P>
<strong>Стадия 2: легкий безопасный ремонт</strong>

</P>
<P>
Примечание: если есть желание ускорить ремонт, рекомендуется добавить: <code>-O
sort_buffer=# -O key_buffer=#</code> (где # примерно 1/4 от имеющейся памяти) во
всех командах <code>isamchk</code>/<code>myisamchk</code>.

</P>

<P>
Сначала надо попробовать запустить <code>myisamchk -r -q tbl_name</code> (<code>-r -q</code> 
означает "режим быстрого восстановления"). При этом будет сделана попытка
исправить индексный файл без изменения файла данных. Если в файле данных
содержится все необходимое, а удаленные связи указывают на правильные
позиции в файле данных, то команда должна дать результат и таблица будет
исправлена. Перейдите к ремонту следующей таблицы. В противном случае
следует выполнить следующие действия:

</P>

<OL>
<LI>

Сделать резервную копию файла данных.

<LI>

Использовать <code>myisamchk -r tbl_name</code> (<code>-r</code> означает "режим
восстановления"). При этом из файла данных будут удалены некорректные
и уничтоженные записи, и будет заново создан индексный файл.

<LI>

Если на предыдущем шаге проблему решить не удастся, то используйте
<code>myisamchk --safe-recover tbl_name</code>. В режиме безопасного восстановления
используется старый метод восстановления, справляющийся с некоторыми
случаями, которые оказываются не под силу для режима обычного
исправления (но работает этот метод медленнее).
</OL>

<P>
Если во время проверки будут получены странные ошибки (подобные out of
memory) или <code>myisamchk</code> аварийно завершается, то перейдите к стадии 3.

</P>
<P>
<strong>Стадия 3: сложный ремонт</strong>

</P>
<P>
До этой стадии дело доходит, только если первый 16-килобайтный блок в
индексном файле разрушен или содержит неверную информацию, либо когда
индексный файл отсутствует. В этом случае необходимо создать новый
индексный файл. Необходимо выполнить следующие действия:

</P>

<OL>
<LI>

Переместить файл данных в какое-нибудь безопасное место.

<LI>

Использовать файл описания таблицы для создания новых (пустых) файлов
- данных и индексного:


<PRE>
shell&#62; mysql db_name
mysql&#62; SET AUTOCOMMIT=1;
mysql&#62; TRUNCATE TABLE table_name;
mysql&#62; quit
</PRE>

Если используемая версия SQL не располагает <code>TRUNCATE TABLE</code>, то взамен
используется <code>DELETE FROM table_name</code>.

<LI>

Скопируйте старый файл данных на место недавно созданного (делать
перемещение старого файла обратно на место нового нецелесообразно,
поскольку в старом файле может снова возникнуть потребность, если
что-то пойдет не так).
</OL>

<P>
Вернитесь к стадии 2. <code>myisamchk -r -q</code> теперь должна сработать (но
бесконечно повторять стадии не следует).

</P>
<P>
Что касается MySQL 4.0.2, то тут можно воспользоваться <code>REPAIR ... USE_FRM</code>,
выполняющей всю эту процедуру автоматически.

</P>
<P>
<strong>Стадия 4: очень сложный ремонт</strong>

</P>
<P>
До этой стадии вы дойдете только в случае, если ко всему прочему запорчен
и файл описания. Такого происходить не должно, поскольку файл описания
после создания таблицы не изменяется. Выполните следующие действия:

</P>

<OL>
<LI>

Восстановите файл описания из резервной копии и перейдите к стадии 3.
Можно также восстановить индексный файл и вернуться к стадии 2. Во
втором случае начинать надо с <code>myisamchk -r</code>.

<LI>

Если резервной копии нет, но точно известно, как таблица создавалась,
то создается копия таблицы в другой базе данных. Новый файл данных
удаляется, затем файл описания с индексным файлом перемещаются из
другой базы данных в поврежденную. Таким образом вы получаете новый
файл описания и индексный файл, не затрагивая при этом файла данных.
Делается возврат к стадии 2 с попыткой воссоздать индексный файл.
</OL>



<H4><A NAME="Optimisation" HREF="manual.ru_toc.html#Optimisation">4.4.6.10  Оптимизация  таблиц</A></H4>

<P>
<A NAME="IDX582"></A>
<A NAME="IDX583"></A>

</P>
<P>
Чтобы объединить фрагментированные записи и избавиться от потерь
пространства, происходящих из-за удаления и обновления записей, нужно
запустить <code>myisamchk</code> в режиме восстановления:

</P>

<PRE>
shell&#62; myisamchk -r tbl_name
</PRE>

<P>
Такую же оптимизацию таблицы можно произвести, используя команду SQL
<code>OPTIMIZE TABLE</code>. <code>OPTIMIZE TABLE</code> выполняет ремонт таблицы и анализ ключей, а
также сортирует дерево индексов для ускорения  поиска ключей. Вдобавок
сводится на нет нежелательное взаимодействие между утилитой и сервером,
поскольку при использовании <code>OPTIMIZE TABLE</code> работу выполняет сам сервер.
Обращайтесь к разделу See section <A HREF="manual.ru.html#OPTIMIZE_TABLE">4.5.1  Синтаксис  команды <code>OPTIMIZE TABLE</code></A>.

</P>
<P>
<code>myisamchk</code> также располагает рядом других опций, которые можно использовать
для повышения производительности таблицы:

</P>

<UL>
<LI><code>-S</code>, <code>--sort-index</code>

<LI><code>-R index_num</code>, <code>--sort-records=index_num</code>

<LI><code>-a</code>, <code>--analyze</code>

</UL>

<P>
Полное  описание опций можно найти в разделе See section <A HREF="manual.ru.html#myisamchk_syntax">4.4.6.1  Синтаксис запуска <code>myisamchk</code></A>.

</P>


<H3><A NAME="Maintenance_regimen" HREF="manual.ru_toc.html#Maintenance_regimen">4.4.7  Настройка режима профилактики таблиц</A></H3>

<P>
<A NAME="IDX584"></A>
<A NAME="IDX585"></A>

</P>
<P>
Начиная с версии MySQL 3.23.13 можно проверять таблицы типа <code>MyISAM</code> с
помощью команды <code>CHECK TABLE</code> (see section <A HREF="manual.ru.html#CHECK_TABLE">4.4.4  Синтаксис <code>CHECK TABLE</code></A>). Для ремонта
таблиц можно использовать команду <code>REPAIR TABLE</code> (see section <A HREF="manual.ru.html#REPAIR_TABLE">4.4.5  Синтаксис <code>REPAIR TABLE</code></A>).

</P>
<P>
Целесообразно выполнять регулярные проверки таблиц, не дожидаясь появления
проблем. В целях профилактики для проверки таблиц  можно использовать
<code>myisamchk -s</code>. Опция <code>-s</code> (сокращение для <code>--silent</code>) задает выполнение
<code>myisamchk</code> в молчаливом режиме с выдачей сообщений только при возникновении
ошибок.

</P>
<P>
<A NAME="IDX586"></A>
Не стоит сбрасывать со счетов и выполнение проверки таблиц при запуске
сервера. Например, всякий раз, когда во время обновления происходит
перезагрузка, необходима проверка всех таблиц, которые могли при этом
пострадать (назовем их "потенциально поврежденными таблицами"). В
<code>safe_mysqld</code> можно добавить тест, запускающий <code>myisamchk</code> для проверки всех
таблиц, измененных за последние 24 часа, в случае, если после перезагрузки
остался старый файл <tt>`.pid'</tt> (ID процесса) (<code>mysqld</code> создает <tt>`.pid'</tt>-файл во время
запуска и удаляет его при нормальном завершении; наличие <tt>`.pid'</tt>-файла во
время запуска системы свидетельствует о том, что mysqld не завершился
нормально).

</P>
<P>
Можно сделать даже более надежный тест - выполнить проверку таблиц с более
поздней, чем у <tt>`.pid'</tt>-файла, датой последней модификации.

</P>
<P>
Таблицы также следует регулярно проверять в ходе нормального
функционирования системы. У себя в <code>MySQL AB</code> мы запускаем задачи по <code>cron</code>
для проверки всех наших важных таблиц раз в неделю, используя следующую
строку в файле <code>crontab</code>:

</P>

<PRE>
35 0 * * 0 /path/to/myisamchk --fast --silent /path/to/datadir/*/*.MYI
</PRE>

<P>
Такая команда отображает информацию о поврежденных таблицах, и мы при
надобности можем их исследовать и исправить.

</P>
<P>
Поскольку за последние пару лет у нас (на самом деле) не было неожиданно
поврежденных таблиц (таблиц, получивших повреждение по причинам, отличным
от неисправностей оборудования), то для нас проверки один раз в неделю
более чем достаточно.

</P>
<P>
Мы рекомендуем для начала выполнять <code>myisamchk -s</code> еженощно на всех
таблицах, обновленных на протяжении последних 24 часов, пока вы не станете
доверять MySQL настолько, насколько доверяем мы.

</P>
<P>
<A NAME="IDX587"></A>
Обычно в таком контроле над таблицами MySQL необходимости нет. При
изменении таблиц с динамическим размером строк (таблиц со столбцами типов
<code>VARCHAR</code>, <code>BLOB</code> или <code>TEXT</code>) или при наличии таблиц с большим числом удаленных
строк может потребоваться время от времени (где-то раз в месяц)
дефрагментировать таблицы.

</P>
<P>
Это можно сделать, используя <code>OPTIMIZE TABLE</code> на аналогичных таблицах, или,
если есть возможность приостановить <code>mysqld</code>, выполняя:

</P>

<PRE>
isamchk -r --silent --sort-index -O sort_buffer_size=16M */*.ISM
myisamchk -r --silent --sort-index -O sort_buffer_size=16M */*.MYI
</PRE>



<H3><A NAME="Table-info" HREF="manual.ru_toc.html#Table-info">4.4.8  Получение информации о таблице</A></H3>

<P>
<A NAME="IDX588"></A>

</P>
<P>
Команды, представленные в этом разделе, используются для получения
описания таблицы или статистики по таблице. Более подробное выборочное
разъяснение вывода этих команд будет приведено ниже:

</P>

<UL>
<LI>myisamchk -d tbl_name

Выполняет myisamchk в "описательном режиме" для
вывода описания таблицы. Если MySQL использует опцию <code>--skip-external-locking</code>, то
<code>myisamchk</code> может сообщить об ошибке для таблицы, обновляемой во время
исполнения утилиты. Однако поскольку <code>myisamchk</code> не меняет таблицы в
описательном режиме, то никакого риска разрушения данных нет.

<LI>myisamchk -d -v tbl_name

Для выдачи дополнительной информации по
действиям, выполняемым утилитой <code>myisamchk</code>, добавляется -v для указания
расширенного режима вывода сообщений.

<LI>myisamchk -eis tbl_name

Отображается только наиболее важная информация
из таблицы. Работает медленно вследствие того, что приходится считывать
всю таблицу.

<LI>myisamchk -eiv tbl_name

То же, что и <code>-eis</code>, но с сообщением о выполняемых
действиях.
</UL>

<P>
<A NAME="IDX589"></A>
<A NAME="IDX590"></A>

</P>
<P>
Пример вывода <code>myisamchk -d</code>:

</P>

<PRE>
MyISAM file:     company.MYI
Record format:   Fixed length
Data records:    1403698  Deleted blocks:         0
Recordlength:    226

table description:
Key Start Len Index   Type
1   2     8   unique  double
2   15    10  multip. text packed stripped
3   219   8   multip. double
4   63    10  multip. text packed stripped
5   167   2   multip. unsigned short
6   177   4   multip. unsigned long
7   155   4   multip. text
8   138   4   multip. unsigned long
9   177   4   multip. unsigned long
    193   1           text
</PRE>

<P>
Пример вывода <code>myisamchk -d -v</code>:

</P>

<PRE>
MyISAM file:         company
Record format:       Fixed length
File-version:        1
Creation time:       1999-10-30 12:12:51
Recover time:        1999-10-31 19:13:01
Status:              checked
Data records:           1403698  Deleted blocks:              0
Datafile parts:         1403698  Deleted data:                0
Datafilepointer (bytes):      3  Keyfile pointer (bytes):     3
Max datafile length: 3791650815  Max keyfile length: 4294967294
Recordlength:               226

table description:
Key Start Len Index   Type                  Rec/key     Root Blocksize
1   2     8   unique  double                      1 15845376      1024
2   15    10  multip. text packed stripped        2 25062400      1024
3   219   8   multip. double                     73 40907776      1024
4   63    10  multip. text packed stripped        5 48097280      1024
5   167   2   multip. unsigned short           4840 55200768      1024
6   177   4   multip. unsigned long            1346 65145856      1024
7   155   4   multip. text                     4995 75090944      1024
8   138   4   multip. unsigned long              87 85036032      1024
9   177   4   multip. unsigned long             178 96481280      1024
    193   1           text
</PRE>

<P>
Пример вывода <code>myisamchk -eis</code>:

</P>

<PRE>
Checking MyISAM file: company
Key:  1:  Keyblocks used:  97%  Packed:    0%  Max levels:  4
Key:  2:  Keyblocks used:  98%  Packed:   50%  Max levels:  4
Key:  3:  Keyblocks used:  97%  Packed:    0%  Max levels:  4
Key:  4:  Keyblocks used:  99%  Packed:   60%  Max levels:  3
Key:  5:  Keyblocks used:  99%  Packed:    0%  Max levels:  3
Key:  6:  Keyblocks used:  99%  Packed:    0%  Max levels:  3
Key:  7:  Keyblocks used:  99%  Packed:    0%  Max levels:  3
Key:  8:  Keyblocks used:  99%  Packed:    0%  Max levels:  3
Key:  9:  Keyblocks used:  98%  Packed:    0%  Max levels:  4
Total:    Keyblocks used:  98%  Packed:   17%

Records:          1403698    M.recordlength:     226
Packed:             0%
Recordspace used:     100%   Empty space:          0%
Blocks/Record:   1.00
Record blocks:    1403698    Delete blocks:        0
Recorddata:     317235748    Deleted data:         0
Lost space:             0    Linkdata:             0

User time 1626.51, System time 232.36
Maximum resident set size 0, Integral resident set size 0
Non physical pagefaults 0, Physical pagefaults 627, Swaps 0
Blocks in 0 out 0, Messages in 0 out 0, Signals 0
Voluntary context switches 639, Involuntary context switches 28966
</PRE>

<P>
Пример вывода <code>myisamchk -eiv</code>:

</P>

<PRE>
Checking MyISAM file: company
Data records: 1403698   Deleted blocks:       0
- check file-size
- check delete-chain
block_size 1024:
index  1:
index  2:
index  3:
index  4:
index  5:
index  6:
index  7:
index  8:
index  9:
No recordlinks
- check index reference
- check data record references index: 1
Key:  1:  Keyblocks used:  97%  Packed:    0%  Max levels:  4
- check data record references index: 2
Key:  2:  Keyblocks used:  98%  Packed:   50%  Max levels:  4
- check data record references index: 3
Key:  3:  Keyblocks used:  97%  Packed:    0%  Max levels:  4
- check data record references index: 4
Key:  4:  Keyblocks used:  99%  Packed:   60%  Max levels:  3
- check data record references index: 5
Key:  5:  Keyblocks used:  99%  Packed:    0%  Max levels:  3
- check data record references index: 6
Key:  6:  Keyblocks used:  99%  Packed:    0%  Max levels:  3
- check data record references index: 7
Key:  7:  Keyblocks used:  99%  Packed:    0%  Max levels:  3
- check data record references index: 8
Key:  8:  Keyblocks used:  99%  Packed:    0%  Max levels:  3
- check data record references index: 9
Key:  9:  Keyblocks used:  98%  Packed:    0%  Max levels:  4
Total:    Keyblocks used:   9%  Packed:   17%

- check records and index references
[кое-что опущено для краткости]

Records:          1403698    M.recordlength:     226   Packed:             0%
Recordspace used:     100%   Empty space:          0%  Blocks/Record:   1.00
Record blocks:    1403698    Delete blocks:        0
Recorddata:     317235748    Deleted data:         0
Lost space:             0    Linkdata:             0

User time 1639.63, System time 251.61
Maximum resident set size 0, Integral resident set size 0
Non physical pagefaults 0, Physical pagefaults 10580, Swaps 0
Blocks in 4 out 0, Messages in 0 out 0, Signals 0
Voluntary context switches 10604, Involuntary context switches 122798
</PRE>

<P>
Для использованной в предыдущих примерах таблицы размеры файла данных и
индексного файла были следующими:

</P>

<PRE>
-rw-rw-r-- 1 monty tcx 317235748 Jan 12 17:30 company.MYD
-rw-rw-r-- 1 davida tcx 96482304 Jan 12 18:35 company.MYM
</PRE>

<P>
Ниже приводятся пояснения по различным типам выдаваемой <code>myisamchk</code>
информации. ``keyfile'' означает индексный файл. ``Record'' (запись) и ``row''
(строка) являются синонимами:

</P>

<UL>
<LI>ISAM file - Имя (индексного) файла ISAM.

<LI>Isam-version - Версия  формата ISAM. На данный момент всегда 2.

<LI>Creation time - Время создания файла данных.

<LI>Recover time - Дата последнего восстановления индексного файла/файла

данных.

<LI>Data records - Количество записей в таблице.

<LI>Deleted blocks - Количество удаленных блоков, пространство для  которых

все еще зарезервировано. Таблицу можно оптимизировать для сведения к
минимуму этого пространства (see section <A HREF="manual.ru.html#Optimisation">4.4.6.10  Оптимизация  таблиц</A>).

<LI>Datafile parts - Для динамического формата записей показывает количество

блоков данных. Для оптимизированной таблицы без фрагментированных записей
совпадает с <code>Data records</code>.

<LI>Deleted data - Количество байтов удаленных данных, которые не были

затребованы. Можно оптимизировать таблицу, чтобы сделать этот объем
минимальным (see section <A HREF="manual.ru.html#Optimisation">4.4.6.10  Оптимизация  таблиц</A>).

<LI>Data file pointer - Размер указателя в файле данных (в байтах). Обычно

это 2, 3, 4 или 5 байтов. Для большинства таблиц достаточно 2 байтов, но
назначение размера пока невозможно контролировать из MySQL. Для
фиксированных таблиц указатель - это адрес записи, а для динамических -
адрес байта.

<LI>Keyfile pointer - Размер указателя индексного файла в байтах. Обычно

составляет 1, 2 или 3 байта. Для большинства таблиц хватает 2 байтов, но
размер автоматически вычисляется MySQL. Указатель всегда является адресом
блока.

<LI>Max datafile length - Максимальный размер файла данных таблицы

(<tt>`.MYD'</tt>-файл) в байтах.

<LI>Max keyfile length - Максимальный размер индексного файла таблицы

(<tt>`.MYI-файла'</tt>) в байтах.

<LI>Recordlength - Размер отдельной записи в байтах.

<LI>Record format - Формат, используемый для хранения строк таблицы. В

примерах, приведенных выше, использовался формат <code>Fixed length</code>. Другие
возможные значения: <code>Compressed</code> и <code>Packed</code>.

<LI>table description - Список всех ключей в таблице. Для каждого ключа

представляется некоторая низкоуровневая информация:


<UL>
<LI>Key

Номер данного ключа.

<LI>Start

Место в записи, где начинается данная часть индекса.

<LI>Len

Длина данной части индекса. Для упакованных чисел длина всегда
должна равняться полной длине для столбца. Для строк длина может быть
меньше полной длины индексированной колонки, поскольку допускается
индексирование префикса столбца со значениями строками.

<LI>Индекс <code>unique</code> или <code>multip</code>. (multiple - повторяющийся/многократный)

Показывает, может ли одно значение встречаться в индексе многократно.

<LI>Type

Тип данных данной части индекса. Это тип данных <code>ISAM</code> с возможными
вариантами - <code>packed</code>, <code>stripped</code> и <code>empty</code>.

<LI>Root

Адрес корневого индексного блока.

<LI>Blocksize

Размер каждого индексного блока. По умолчанию равен 1024, но
значение можно изменить во время компиляции.

<LI>Rec/key

Статистическое значение, используемое оптимизатором. Оно
показывает, сколько записей приходится на одно значение для данного ключа.
Для уникального ключа это соотношение всегда 1. Значение может быть
обновлено после загрузки таблицы (или значительного ее изменения)
посредством <code>myisamchk -a</code>. Если соотношение совсем не обновляется, то по
умолчанию принимается значение 30.
</UL>

<LI>В первом из приведенных примеров 9-й ключ является составным с двумя

частями.

<LI>Keyblocks used - Процент использованных блоков ключей. Поскольку для

примера была взята таблица, совсем недавно реорганизованная при помощи
<code>myisamchk</code>, то значения очень высоки (очень близки к теоретическому
максимуму).

<LI>Packed - MySQL пытается упаковывать ключи с общим суффиксом. Это может

быть использовано только для ключей типа <code>CHAR</code>/<code>VARCHAR</code>/<code>DECIMAL</code>. Для длинных
строк, таких как имена, при помощи упаковки можно значительно уменьшить
занимаемое ими место. В третьем из приведенных примеров 4-й ключ состоит
из 10 символов и для него достигнуто 60%-е уменьшение в объеме.

<LI>Max levels - Глубина B-дерева для данного ключа. В больших таблицах с

длинными ключами значение является большим.

<LI>Records Количество строк в таблице.

<LI>M.recordlength - Средняя длина записи. Для таблиц с фиксированной длиной

записи равняется точной длине записи.

<LI>Packed - MySQL отбрасывает пробелы в конце строк. Значение <code>Packed</code>

указывает на процент достигнутой этим экономии.

<LI>Recordspace used - Процент использования файла данных.

<LI>Empty space - На сколько процентов файл данных не использован.

<LI>Blocks/Record - Среднее число блоков на запись (т.е. из какого числа

связей состоит фрагментированная запись). Отношение всегда 1,0 для таблиц
фиксированного формата. Важно, чтобы это значение было как можно ближе к
1,0. Если значение становится слишком большим, можно реорганизовать
таблицу с помощью <code>myisamchk</code>. Обращайтесь к разделу See section <A HREF="manual.ru.html#Optimisation">4.4.6.10  Оптимизация  таблиц</A>.

<LI>Recordblocks - Количество использованных блоков (связей). Для

фиксированного формата совпадает с количеством записей.

<LI>Deleteblocks - Количество удаленных блоков (связей).

<LI>Recorddata - Количество использованных байтов в файле данных.

<LI>Deleted data - Количество удаленных (неиспользуемых) байтов в файле

данных.

<LI>Lost space - Если запись при обновлении уменьшается, то теряется

некоторое пространство. Данное значение является суммой всех таких потерь
в байтах.

<LI>Linkdata - При использовании динамического формата таблиц фрагменты

записи связываются с помощью указателей (каждый от 4 до 7 байтов).
<code>Linkdata</code> - общий объем памяти, занимаемый всеми такими указателями.
</UL>

<P>
Если таблица была сжата при помощи <code>myisampack</code>, то <code>myisamchk -d</code> выдает
дополнительную информацию о каждом столбце в таблице. Обращайтесь к
разделу See section <A HREF="manual.ru.html#myisampack">4.7.4  <code>myisampack</code>, MySQL-генератор сжатых таблиц (только для чтения)</A>, где
приведен пример такой информации и пояснение к ней.

</P>


<H2><A NAME="Database_Administration" HREF="manual.ru_toc.html#Database_Administration">4.5  Справочник по языку администрирования баз данных</A></H2>



<H3><A NAME="OPTIMIZE_TABLE" HREF="manual.ru_toc.html#OPTIMIZE_TABLE">4.5.1  Синтаксис  команды <code>OPTIMIZE TABLE</code></A></H3>

<P>
<A NAME="IDX591"></A>

</P>
<P>
<A NAME="IDX592"></A>
<A NAME="IDX593"></A>

</P>

<PRE>
OPTIMIZE TABLE tbl_name[,tbl_name]...
</PRE>

<P>
Команда <code>OPTIMIZE TABLE</code> должна использоваться после удаления большей части
таблицы или если в таблице было внесено много изменений в строки
переменной длины (таблицы, в которых есть столбцы <code>VARCHAR</code>, <code>BLOB</code> или <code>TEXT</code>).
Удаленные записи поддерживаются при помощи связного списка, и последующие
операции <code>INSERT</code> повторно используют позиции старых записей. Чтобы
перераспределить неиспользуемое пространство и дефрагментировать файл
данных, можно воспользоваться командой <code>OPTIMIZE TABLE</code>.

</P>
<P>
На данный момент команда <code>OPTIMIZE TABLE</code> работает только с таблицами <code>MyISAM</code>
и <code>BDB</code>. Для таблиц <code>BDB</code> команда <code>OPTIMIZE TABLE</code> выполняет <code>ANALYZE TABLE</code>. См.
раздел See section <A HREF="manual.ru.html#ANALYZE_TABLE">4.5.2  Синтаксис команды <code>ANALYZE TABLE</code></A>.

</P>
<P>
Можно применить <code>OPTIMIZE TABLE</code> к таблицам других типов, запустив 
<code>mysqld</code>  с  параметром  <code>--skip-new</code>  или  <code>--safe-mode</code>, но  в  этом  случае 
<code>OPTIMIZE TABLE</code>  лишь  только  выполняет  <code>ALTER TABLE</code>.

</P>
<P>
Команда <code>OPTIMIZE TABLE</code> работает следующим образом:

</P>

<UL>
<LI>

Если в таблице есть удаленные или разделенные строки, восстанавливает
таблицу.

<LI>

Если индексные страницы не отсортированы - сортирует их.

<LI>

Если статистические данные не обновлены (и восстановление нельзя
осуществить путем сортировки индексов), обновляет их.
</UL>

<P>
Команда <code>OPTIMIZE TABLE</code> для  <code>MyISAM</code> представляет собой эквивалент
выполнения  <code>myisamchk --quick --check-only-changed --sort-index --analyze</code> 
над таблицей.

</P>
<P>
Обратите внимание: во время работы <code>OPTIMIZE TABLE</code> таблица заблокирована!

</P>


<H3><A NAME="ANALYZE_TABLE" HREF="manual.ru_toc.html#ANALYZE_TABLE">4.5.2  Синтаксис команды <code>ANALYZE TABLE</code></A></H3>

<P>
<A NAME="IDX594"></A>

</P>

<PRE>
ANALYZE TABLE tbl_name[,tbl_name...]
</PRE>

<P>
Анализирует и сохраняет распределение ключей для таблицы. Во время
проведения анализа таблица заблокирована для чтения. Эта функция работает
для таблиц <code>MyISAM</code> и <code>BDB</code>.

</P>
<P>
Данная команда является эквивалентом выполнения <code>myisamchk -a</code> для таблицы.

</P>
<P>
Сохраненное распределение ключей в MySQL используется для принятия решения
о том, в каком порядке следует связывать таблицы, когда для связывания
используются не константы, а другая база.

</P>
<P>
Эта команда выдает таблицу со следующими столбцами:

</P>
<TABLE BORDER>
<TR><TD><strong>Столбец</strong> </TD><TD> <strong>Значение</strong>
</TD></TR>
<TR><TD>Table </TD><TD> Имя таблицы
</TD></TR>
<TR><TD>Op </TD><TD> Всегда ``analyze''
</TD></TR>
<TR><TD>Msg_type </TD><TD> Одно из значений <code>status</code>, <code>error</code>, <code>info</code> или <code>warning</code>.
</TD></TR>
<TR><TD>Msg_text </TD><TD> Сообщение.
</TD></TR>
</TABLE>

<P>
Просмотреть сохраненное распределение ключей можно при помощи команды <code>SHOW
INDEX</code>. See section <A HREF="manual.ru.html#SHOW_DATABASE_INFO">4.5.6.1  Получение информации по базам данных, таблицам, столбцам и индексам</A>.

</P>
<P>
Если таблица не изменялась с момента предыдущего запуска команды <code>ANALYZE
TABLE</code>, повторный анализ таблицы проводиться не будет.

</P>


<H3><A NAME="FLUSH" HREF="manual.ru_toc.html#FLUSH">4.5.3  Синтаксис команды <code>FLUSH</code></A></H3>

<P>
<A NAME="IDX595"></A>

</P>
<P>
<A NAME="IDX596"></A>
<A NAME="IDX597"></A>
<A NAME="IDX598"></A>

</P>


<PRE>
FLUSH flush_option [,flush_option] ...
</PRE>

<P>
Команда <code>FLUSH</code> применяется для очистки части кэша, используемого MySQL. Для
запуска <code>FLUSH</code> необходимо обладать привилегиями <code>RELOAD</code>.

</P>
<P>
Параметр <code>flush_option</code> может быть одним из следующих:

</P>
<TABLE BORDER>
<TR><TD><strong>Параметр</strong> </TD><TD> <strong>Описание</strong>

</TD></TR>
<TR><TD><code>HOSTS</code> </TD><TD> Производится очистка таблиц кэша удаленных компьютеров. Сброс таблиц удаленного компьютера следует производить, если один из удаленных компьютеров изменил IP-адрес или если было получено сообщение об ошибке <code>Host ... is blocked</code>. Если во время соединения с сервером MySQL происходит больше ошибок подряд, чем указано в <code>max_connect_errors</code> для определенного удаленного компьютера, то MySQL предполагает, что что-то не в порядке, и блокирует последующие попытки установления соединения со стороны этого удаленного компьютера. Сброс таблиц удаленного компьютера позволяет снова попытаться установить соединение. See section <A HREF="manual.ru.html#Blocked_host">A.2.4  Ошибка <code>Host '...' is blocked</code></A>. Чтобы это сообщение об ошибке не появлялось, запустите <code>mysqld</code> с параметром <code>-O max_connect_errors=999999999</code>.

</TD></TR>
<TR><TD><code>DES_KEY_FILE</code> </TD><TD> Производится перезагрузка ключей <code>DES</code> из файла, указанного параметром <code>--des-key-file</code>, при запуске сервера.

</TD></TR>
<TR><TD><code>LOGS</code> </TD><TD> Закрываются и повторно открывается все файлы журналов. Если файл журнала обновлений или файл бинарного журнала был указан без расширения, номер расширения файла журнала будет увеличен на единицу относительно предыдущего файла. Если в имени файла было указано расширение, MySQL закроет и повторно откроет файл журнала обновлений. See section <A HREF="manual.ru.html#Update_log">4.9.3  Журнал обновлений (update)</A>. Эти действия аналогичны отправке сигнала <code>SIGHUP</code> на сервер <code>mysqld</code>.

</TD></TR>
<TR><TD><code>PRIVILEGES</code> </TD><TD> Производится перезагрузка привилегий из таблиц привилегий в базе данных <code>mysql</code>.

</TD></TR>
<TR><TD><code>QUERY CACHE</code> </TD><TD> Производится дефрагментация кэша запросов, чтобы эффективнее использовать его память. Эта команда не удаляет запросы из кэша, как команда <code>RESET QUERY CACHE</code>.

</TD></TR>
<TR><TD><code>TABLES</code> </TD><TD> Закрываются все открытые таблицы и принудительно закрываются все используемые таблицы. Также сбрасывается кэш запросов.

</TD></TR>
<TR><TD><code>[TABLE | TABLES] tbl_name [,tbl_name...]</code> </TD><TD> Производится сброс только указанных таблиц.

</TD></TR>
<TR><TD><code>TABLES WITH READ LOCK</code> </TD><TD> Закрываются все открытые таблицы и блокируется доступ для чтения всех таблиц для всех баз данных, пока не будет запущена команда <code>UNLOCK TABLES</code>. Это очень удобный способ создавать резервные копии, если у вас файловая система наподобие Veritas, которая может обеспечить моментальные снимки данных в режиме реального времени.

</TD></TR>
<TR><TD><code>STATUS</code> </TD><TD> Большинство переменных состояния сбрасываются в нуль. Эту команду необходимо использовать при отладке запроса.

</TD></TR>
<TR><TD><code>USER_RESOURCES</code> </TD><TD> Все ресурсы пользователя сбрасываются в нулевое значение. Это позволяет заблокированному пользователю подсоединиться еще раз. See section <A HREF="manual.ru.html#User_resources">4.3.6  Ограничение ресурсов пользователя</A>.
</TD></TR>
</TABLE>

<P>
Ко всем приведенным выше командам можно получить доступ при помощи утилиты
<code>mysqladmin</code>, используя команды <code>flush-hosts</code>, <code>flush-logs</code>, <code>reload</code> или
<code>flush-tables</code>.

</P>
<P>
Рекомендуется также ознакомиться с командой <code>RESET</code>, которая применяется с
репликацией. See section <A HREF="manual.ru.html#RESET">4.5.4  Синтаксис команды <code>RESET</code></A>.

</P>


<H3><A NAME="RESET" HREF="manual.ru_toc.html#RESET">4.5.4  Синтаксис команды <code>RESET</code></A></H3>


<PRE>
RESET reset_option [,reset_option] ...
</PRE>

<P>
Команда <code>RESET</code> используется для очистки. Кроме того, она также действует
как более сильная версия команды <code>FLUSH</code>. See section <A HREF="manual.ru.html#FLUSH">4.5.3  Синтаксис команды <code>FLUSH</code></A>.

</P>
<P>
Чтобы запустить команду <code>RESET</code>, необходимо обладать привилегиями <code>RELOAD</code>.

</P>
<TABLE BORDER>
<TR><TD><strong>Параметр</strong> </TD><TD> <strong>Описание</strong>

</TD></TR>
<TR><TD><code>MASTER</code> </TD><TD> Удаляет все бинарные журналы, перечисленные в индексном файле, обнуляет значения индексного файла <code>binlog</code>. В версиях до 3.23.26 - <code>FLUSH MASTER</code> (Master)

</TD></TR>
<TR><TD><code>SLAVE</code> </TD><TD> Сбрасывает положение репликации подчиненного компьютера в журналах головного компьютера. В версиях до 3.23.26 эта команда называлась <code>FLUSH SLAVE</code> (Slave)

</TD></TR>
<TR><TD><code>QUERY CACHE</code> </TD><TD> Удаляет все результаты запросов из кэша запросов.
</TD></TR>
</TABLE>



<H3><A NAME="KILL" HREF="manual.ru_toc.html#KILL">4.5.5  Синтаксис команды <code>KILL</code></A></H3>

<P>
<A NAME="IDX599"></A>

</P>
<P>
<A NAME="IDX600"></A>

</P>

<PRE>
KILL thread_id
</PRE>

<P>
Каждое соединение с <code>mysqld</code> запускается в отдельном потоке. При помощи
команды <code>SHOW PROCESSLIST</code> можно просмотреть список запущенных потоков, а
при помощи команды <code>KILL thread_id</code> - удалить поток.

</P>
<P>
Если у вас есть привилегия <code>PROCESS</code>, можно просмотреть все потоки. Обладая
привилегией <code>SUPER</code>, можно удалять любые потоки. В противном случае можно
просматривать и удалять только свои собственные потоки.

</P>
<P>
Для просмотра и удаления потоков можно также применять команды <code>mysqladmin
processlist</code> и <code>mysqladmin kill</code>.

</P>
<P>
При использовании команды <code>KILL</code> для потока устанавливается специальный флаг
<code>kill flag</code>.

</P>
<P>
В большинстве случаев удаление потока занимает некоторое время, поскольку
этот флаг проверяется с определенным интервалом.

</P>

<UL>
<LI>

В циклах <code>SELECT</code>, <code>ORDER BY</code> и <code>GROUP BY</code> флаг проверяется только после
считывания блока строк. Если установлен флаг удаления, то выполнение
оператора будет отменено.

<LI>

При выполнении команды <code>ALTER TABLE</code> флаг удаления проверяется перед
считыванием каждого блока строк из исходной таблицы. Если флаг
установлен, то выполнение команды отменяется и временная таблица
удаляется. При выполнении команд <code>UPDATE</code> и <code>DELETE</code> флаг
удаления проверяется после каждого считывания блока, а также после
каждого обновления или удаления строки. Если флаг удаления установлен,
то выполнение оператора отменяется. Обратите внимание: если не
используются транзакции, то отменить изменения будет невозможно!

<LI>

<code>GET_LOCK()</code> будет отменен при помощи <code>NULL</code>.

<LI>

Поток <code>INSERT DELAYED</code> быстро сбросит все строки, которые он содержит в
памяти и будет удален.

<LI>

Если поток находится в заблокированной таблице (состояние: <code>Locked</code>), то
блокировка таблицы будет быстро отменена.

<LI>

Если поток ожидает освобождения дискового пространства в запросе
write, запись будет отменена с выдачей сообщения о переполнении диска.
</UL>



<H3><A NAME="SHOW" HREF="manual.ru_toc.html#SHOW">4.5.6  Синтаксис команды <code>SHOW</code></A></H3>

<P>
<A NAME="IDX601"></A>
<A NAME="IDX602"></A>
<A NAME="IDX603"></A>
<A NAME="IDX604"></A>
<A NAME="IDX605"></A>
<A NAME="IDX606"></A>
<A NAME="IDX607"></A>
<A NAME="IDX608"></A>
<A NAME="IDX609"></A>
<A NAME="IDX610"></A>
<A NAME="IDX611"></A>
<A NAME="IDX612"></A>
<A NAME="IDX613"></A>
<A NAME="IDX614"></A>
<A NAME="IDX615"></A>
<A NAME="IDX616"></A>
<A NAME="IDX617"></A>
<A NAME="IDX618"></A>

</P>

<PRE>
SHOW DATABASES [LIKE wild]
или SHOW [OPEN] TABLES [FROM db_name] [LIKE wild]
или SHOW [FULL] COLUMNS FROM tbl_name [FROM db_name] [LIKE wild]
или SHOW INDEX FROM tbl_name [FROM db_name]
или SHOW TABLE STATUS [FROM db_name] [LIKE wild]
или SHOW STATUS [LIKE wild]
или SHOW VARIABLES [LIKE wild]
или SHOW LOGS
или SHOW [FULL] PROCESSLIST
или SHOW GRANTS FOR user
или SHOW CREATE TABLE table_name
или SHOW MASTER STATUS
или SHOW MASTER LOGS
или SHOW SLAVE STATUS
или SHOW WARNINGS [LIMIT #]
или SHOW ERRORS [LIMIT #]
или SHOW TABLE TYPES

</PRE>

<P>
Команда <code>SHOW</code> предоставляет информацию по базам данных, таблицам, столбцам
или о состоянии сервера. Если используется <code>LIKE wild</code>, то строка <code>wild</code> может
содержать в себе шаблонные символы SQL <samp>`%'</samp> и <samp>`_'</samp>.

</P>



<H4><A NAME="SHOW_DATABASE_INFO" HREF="manual.ru_toc.html#SHOW_DATABASE_INFO">4.5.6.1  Получение информации по базам данных, таблицам, столбцам и индексам</A></H4>

<P>
<A NAME="IDX619"></A>

</P>
<P>
Можно использовать два альтернативных синтаксиса - <code>tbl_name FROM db_name</code> и
<code>db_name.tbl_name</code>. Приведенные ниже два оператора эквивалентны:

</P>

<PRE>
mysql&#62; SHOW INDEX FROM mytable FROM mydb;
mysql&#62; SHOW INDEX FROM mydb.mytable;
</PRE>

<P>
Команда <code>SHOW DATABASES</code> выдает список баз данных на компьютере, где
установлен сервер MySQL. Этот список можно также получить,
воспользовавшись инструментом командной строки <code>mysqlshow</code>. В версии 4.0.2
можно увидеть только те базы данных, для которых у вас есть какие-либо
привилегии, если вы не имеете глобальной привилегии <code>SHOW DATABASES</code>.

</P>
<P>
Команда <code>SHOW TABLES</code> выводит список таблиц в указанной базе данных. Этот
список также можно получить, используя команду <code>mysqlshow db_name</code>.

</P>
<P>
<strong>Примечание</strong>: если у пользователя нет никаких привилегий для таблицы,
таблица не будет показана в результатах команды <code>SHOW TABLES</code> или <code>mysqlshow
db_name</code>.

</P>
<P>
Команда <code>SHOW OPEN TABLES</code> выводит список таблиц, которые в настоящий момент
открыты в кэше таблицы. See section <A HREF="manual.ru.html#Table_cache">5.4.7  Открытие и закрытие таблиц в MySQL</A>. В
поле <code>Comment</code> указывается, сколько раз таблица кэшировалась (<code>cached</code>) и
сколько раз использовалась (<code>in_use</code>).

</P>
<P>
Команда <code>SHOW COLUMNS</code> выводит список столбцов в заданной таблице. Если
указать параметр <code>FULL</code>, то будут показаны также ваши привилегии для каждого
столбца. Если типы столбцов отличаются от заданных в параметрах оператора
<code>CREATE TABLE</code>, учтите, что MySQL иногда изменяет типы столбцов. See section <A HREF="manual.ru.html#Silent_column_changes">6.5.3.1  Молчаливые изменения определений столбцов</A>.

</P>
<P>
Оператор <code>DESCRIBE</code> предоставляет почти такую же информацию, что и <code>SHOW
COLUMNS</code>. See section <A HREF="manual.ru.html#DESCRIBE">6.6.2  Синтаксис команды <code>DESCRIBE</code> (Получение информации о столбцах)</A>.

</P>
<P>
Команда <code>SHOW FIELDS</code>  является  синонимом  команды  <code>SHOW COLUMNS</code>, а 
команда  <code>SHOW KEYS</code> - синонимом <code>SHOW INDEX</code>. Список  столбцов  или 
индексов  таблицы  можно  также  вывести  при  помощи  команды  <code>mysqlshow
db_name tbl_name</code> или <code>mysqlshow -k db_name tbl_name</code>.

</P>
<P>
Команда <code>SHOW INDEX</code> выводит информацию по индексу в формате, подобном
формату вывода запроса <code>SQLStatistics в ODBC</code>. Выводятся следующие столбцы:

</P>
<TABLE BORDER>
<TR><TD><strong>Столбец</strong> </TD><TD> <strong>Значение</strong>
</TD></TR>
<TR><TD><code>Table</code> </TD><TD> Имя таблицы.
</TD></TR>
<TR><TD><code>Non_unique</code> </TD><TD> 0 если индекс не может содержать дублирующихся значений.
</TD></TR>
<TR><TD><code>Key_name</code> </TD><TD> Имя индекса.
</TD></TR>
<TR><TD><code>Seq_in_index</code> </TD><TD> Порядковый номер столбца в индексе, начиная с 1.
</TD></TR>
<TR><TD><code>Column_name</code> </TD><TD> Имя  столбца.
</TD></TR>
<TR><TD><code>Collation</code> </TD><TD> Как столбцы отсортированы в индексе. В MySQL в данном столбце могут присутствовать значения <code>'A'</code> (в порядке возрастания) или <code>NULL</code> (не отсортирован).
</TD></TR>
<TR><TD><code>Cardinality</code> </TD><TD> Количество уникальных значений в индексе. Обновляется путем запуска <code>isamchk -a</code>.
</TD></TR>
<TR><TD><code>Sub_part</code> Количество индексированных символов, если столбец индексируется частично. Если проиндексирован весь ключ, то будет содержаться значение <code>NULL</code>.
</TD></TR>
<TR><TD><code>Null</code> </TD><TD> Содержит значение <code>'YES'</code>, если столбец может содержать <code>NULL</code>.
</TD></TR>
<TR><TD><code>Index_type</code> Используемый метод индексирования.
</TD></TR>
<TR><TD><code>Comment</code> </TD><TD> Различные примечания. На данный момент в версиях MySQL &#60; 4.0.2 выдается, является индекс <code>FULLTEXT</code> или нет.
</TD></TR>
</TABLE>

<P>
Обратите внимание на то, что значение <code>Cardinality</code> подсчитывается по
результатам статистики, сохраняющейся в виде целых чисел, которые
недостаточно точны для небольших таблиц.

</P>
<P>
Столбцы <code>Null</code> и <code>Index_type</code> были добавлены начиная с версии MySQL 4.0.2.

</P>


<H4><A NAME="SHOW_TABLE_STATUS" HREF="manual.ru_toc.html#SHOW_TABLE_STATUS">4.5.6.2  <code>SHOW TABLE STATUS</code></A></H4>

<P>
<A NAME="IDX620"></A>
<A NAME="IDX621"></A>
<A NAME="IDX622"></A>

</P>

<PRE>
SHOW TABLE STATUS [FROM db_name] [LIKE wild]
</PRE>

<P>
Команда <code>SHOW TABLE STATUS</code> (новшество версии 3.23) работает как <code>SHOW
STATUS</code>, но предоставляет большое количество информации по каждой таблице.
Приведенный ниже список также можно получить, используя команду <code>mysqlshow
--status db_name</code>. Выводятся следующие столбцы:

</P>
<TABLE BORDER>
<TR><TD><strong>Столбец</strong> </TD><TD> <strong>Значение</strong>
</TD></TR>
<TR><TD><code>Name</code> </TD><TD> Имя таблицы.
</TD></TR>
<TR><TD><code>Type</code> </TD><TD> Тип таблицы. See section <A HREF="manual.ru.html#Table_types">7  Типы  таблиц MySQL</A>.
</TD></TR>
<TR><TD><code>Row_format</code> </TD><TD> Формат хранения строк (Fixed, Dynamic, или Compressed).
</TD></TR>
<TR><TD><code>Rows</code> </TD><TD> Количество строк.
</TD></TR>
<TR><TD><code>Avg_row_length</code> </TD><TD> Средняя длина строки.
</TD></TR>
<TR><TD><code>Data_length</code> </TD><TD> Размер файла данных.
</TD></TR>
<TR><TD><code>Max_data_length</code> </TD><TD> Максимальная длина файла данных.
</TD></TR>
<TR><TD><code>Index_length</code> </TD><TD> Длина индексного файла.
</TD></TR>
<TR><TD><code>Data_free</code> </TD><TD> Количество распределенных, но не используемых байтов.
</TD></TR>
<TR><TD><code>Auto_increment</code> </TD><TD> Следующее значение автоинкремента.
</TD></TR>
<TR><TD><code>Create_time</code> </TD><TD> Время создания таблицы.
</TD></TR>
<TR><TD><code>Update_time</code> </TD><TD> Время последнего обновления файла данных.
</TD></TR>
<TR><TD><code>Check_time</code> </TD><TD> Время последней проверки таблицы.
</TD></TR>
<TR><TD><code>Create_options</code> </TD><TD> Дополнительные параметры, использовавшиеся для команды <code>CREATE TABLE</code>.
</TD></TR>
<TR><TD><code>Comment</code> </TD><TD> Примечания, внесенные при создании таблицы (или информация о причинах, почему MySQL не может получить доступ к данным в таблицах).
</TD></TR>
</TABLE>

<P>
В таблицах <code>InnoDB</code> информация о свободном дисковом пространстве в таблице
заносится в ячейки примечаний к таблице.

</P>


<H4><A NAME="SHOW_STATUS" HREF="manual.ru_toc.html#SHOW_STATUS">4.5.6.3  <code>SHOW STATUS</code></A></H4>

<P>
<A NAME="IDX623"></A>

</P>
<P>
Команда <code>SHOW STATUS</code> предоставляет информацию по состоянию сервера (как
<code>mysqladmin extended-status</code>). Пример выходных данных приведен ниже (формат
и числа могут иметь некоторые отличия):

</P>

<PRE>
+--------------------------+------------+
| Variable_name            | Value      |
+--------------------------+------------+
| Aborted_clients          | 0          |
| Aborted_connects         | 0          |
| Bytes_received           | 155372598  |
| Bytes_sent               | 1176560426 |
| Connections              | 30023      |
| Created_tmp_disk_tables  | 0          |
| Created_tmp_tables       | 8340       |
| Created_tmp_files        | 60         |
| Delayed_insert_threads   | 0          |
| Delayed_writes           | 0          |
| Delayed_errors           | 0          |
| Flush_commands           | 1          |
| Handler_delete           | 462604     |
| Handler_read_first       | 105881     |
| Handler_read_key         | 27820558   |
| Handler_read_next        | 390681754  |
| Handler_read_prev        | 6022500    |
| Handler_read_rnd         | 30546748   |
| Handler_read_rnd_next    | 246216530  |
| Handler_update           | 16945404   |
| Handler_write            | 60356676   |
| Key_blocks_used          | 14955      |
| Key_read_requests        | 96854827   |
| Key_reads                | 162040     |
| Key_write_requests       | 7589728    |
| Key_writes               | 3813196    |
| Max_used_connections     | 0          |
| Not_flushed_key_blocks   | 0          |
| Not_flushed_delayed_rows | 0          |
| Open_tables              | 1          |
| Open_files               | 2          |
| Open_streams             | 0          |
| Opened_tables            | 44600      |
| Questions                | 2026873    |
| Select_full_join         | 0          |
| Select_full_range_join   | 0          |
| Select_range             | 99646      |
| Select_range_check       | 0          |
| Select_scan              | 30802      |
| Slave_running            | OFF        |
| Slave_open_temp_tables   | 0          |
| Slow_launch_threads      | 0          |
| Slow_queries             | 0          |
| Sort_merge_passes        | 30         |
| Sort_range               | 500        |
| Sort_rows                | 30296250   |
| Sort_scan                | 4650       |
| Table_locks_immediate    | 1920382    |
| Table_locks_waited       | 0          |
| Threads_cached           | 0          |
| Threads_created          | 30022      |
| Threads_connected        | 1          |
| Threads_running          | 1          |
| Uptime                   | 80380      |
+--------------------------+------------+
</PRE>

<P>
Приведенные выше переменные состояния имеют следующие значения:

</P>
<P>
<A NAME="IDX624"></A>

</P>
<TABLE BORDER>
<TR><TD><strong>Переменная</strong> </TD><TD> <strong>Значение</strong>
</TD></TR>
<TR><TD><code>Aborted_clients</code> </TD><TD> Количество соединений, отмененных по причине отключения клиента без надлежащего закрытия соединения. See section <A HREF="manual.ru.html#Communication_errors">A.2.9  Коммуникационные ошибки / Оборванные соединения</A>.
</TD></TR>
<TR><TD><code>Aborted_connects</code> </TD><TD> Количество неудачных попыток подсоединения к серверу MySQL. See section <A HREF="manual.ru.html#Communication_errors">A.2.9  Коммуникационные ошибки / Оборванные соединения</A>.
</TD></TR>
<TR><TD><code>Bytes_received</code> </TD><TD> Количество байтов, полученных от всех клиентов.
</TD></TR>
<TR><TD><code>Bytes_sent</code> </TD><TD> Количество байтов, отправленных всем клиентам.
</TD></TR>
<TR><TD><code>Com_xxx</code> </TD><TD> Количество запусков каждой команды xxx.
</TD></TR>
<TR><TD><code>Connections</code> </TD><TD> Количество попыток подсоединения к серверу MySQL.
</TD></TR>
<TR><TD><code>Created_tmp_tables</code> </TD><TD> Количество неявных временных таблиц на диске, созданных во время выполнения операторов.
</TD></TR>
<TR><TD><code>Created_tmp_tables</code> </TD><TD> Количество неявных временных таблиц в памяти, созданных во время выполнения операторов.
</TD></TR>
<TR><TD><code>Created_tmp_files</code> </TD><TD> Количество созданных временных файлов <code>mysqld</code>.
</TD></TR>
<TR><TD><code>Delayed_insert_threads</code> </TD><TD> Количество используемых потоков вставки данных в режиме <code>insert delayed</code>.
</TD></TR>
<TR><TD><code>Delayed_writes</code> </TD><TD> Количество строк, вставленных при помощи команды <code>INSERT DELAYED</code>.
</TD></TR>
<TR><TD><code>Delayed_errors</code> </TD><TD> Количество записанных при помощи команды <code>INSERT DELAYED</code> строк, в которых произошли какие-либо ошибки (возможно, <code>duplicate key</code>).
</TD></TR>
<TR><TD><code>Flush_commands</code> </TD><TD> Количество запущенных команд <code>FLUSH</code>.
</TD></TR>
<TR><TD><code>Handler_commit</code> </TD><TD> Количество внутренних команд <code>COMMIT</code>.
</TD></TR>
<TR><TD><code>Handler_delete</code> </TD><TD> Количество удалений строки из таблицы.
</TD></TR>
<TR><TD><code>Handler_read_first</code> </TD><TD> Количество считываний из индекса первой записи. Если это значение высокое, то, по всей вероятности, сервер осуществляет много полных индексных сканирований, например, <code>SELECT col1 FROM foo</code>, предполагая, что <code>col1</code> проиндексирован.
</TD></TR>
<TR><TD><code>Handler_read_key</code> </TD><TD> Количество запросов на чтение строки, основанных на ключе. Высокое значение переменной говорит о том, что ваши запросы и таблицы проиндексированы надлежащим образом.
</TD></TR>
<TR><TD><code>Handler_read_next</code> </TD><TD> Количество запросов на чтение следующей строки в порядке расположения ключей. Это значение будет увеличиваться, если производится запрос индексного столбца с ограничением по размеру. Значение также увеличивается во время проведения индексного сканирования.
</TD></TR>
<TR><TD><code>Handler_read_prev</code> </TD><TD> Количество запросов на чтение предыдущей строки в порядке расположения ключей. В большинстве случаев используется для оптимизации <code>ORDER BY ... DESC</code>.
</TD></TR>
<TR><TD><code>Handler_read_rnd</code> </TD><TD> Количество запросов на чтение строки, основанных на фиксированной позиции. Значение будет высоким, если выполняется много запросов, требующих сортировки результатов.
</TD></TR>
<TR><TD><code>Handler_read_rnd_next</code> </TD><TD> Количество запросов на чтение следующей строки из файла данных. Данное значение будет высоким, если производится много сканирований таблиц. Обычно это означает, что ваши таблицы не проиндексированы надлежащим образом или ваши запросы не используют преимущества индексов.
</TD></TR>
<TR><TD><code>Handler_rollback</code> </TD><TD> Количество внутренних команд <code>ROLLBACK</code>.
</TD></TR>
<TR><TD><code>Handler_update</code> </TD><TD> Количество запросов на обновление строки в таблице.
</TD></TR>
<TR><TD><code>Handler_write</code> </TD><TD> Количество запросов на вставку строки в таблицу.
</TD></TR>
<TR><TD><code>Key_blocks_used</code> </TD><TD> Количество используемых блоков в кэше ключей.
</TD></TR>
<TR><TD><code>Key_read_requests</code> </TD><TD> Количество запросов на чтение блока ключей из кэша.
</TD></TR>
<TR><TD><code>Key_reads</code> </TD><TD> Количество физических считываний блока ключей с диска.
</TD></TR>
<TR><TD><code>Key_write_requests</code> </TD><TD> Количество запросов на запись блока ключей в кэш.
</TD></TR>
<TR><TD><code>Key_writes</code> </TD><TD> Количество физических записей блоков ключей на диск.
</TD></TR>
<TR><TD><code>Max_used_connections</code> </TD><TD> Максимальное количество одновременно используемых соединений.
</TD></TR>
<TR><TD><code>Not_flushed_key_blocks</code> </TD><TD> Блоки ключей в кэше ключей, которые были изменены, но еще не записаны на диск.
</TD></TR>
<TR><TD><code>Not_flushed_delayed_rows</code> </TD><TD> Количество строк, стоящих в очереди на запись в запросах <code>INSERT DELAY</code>.
</TD></TR>
<TR><TD><code>Open_tables</code> </TD><TD> Количество открытых таблиц.
</TD></TR>
<TR><TD><code>Open_files</code> </TD><TD> Количество открытых файлов.
</TD></TR>
<TR><TD><code>Open_streams</code> </TD><TD> Количество открытых потоков (в основном используется для журналирования).
</TD></TR>
<TR><TD><code>Opened_tables</code> </TD><TD> Количество открывавшихся таблиц.
</TD></TR>
<TR><TD><code>Rpl_status</code> </TD><TD> Статус отказобезопасной репликации (еще не используется).
</TD></TR>
<TR><TD><code>Select_full_join</code> </TD><TD> Количество соединений без ключей (если это значение равно 0, необходимо внимательно проверить индексы своих таблиц).
</TD></TR>
<TR><TD><code>Select_full_range_join</code> </TD><TD> Количество соединений, где был использован поиск по диапазону в справочной таблице.
</TD></TR>
<TR><TD><code>Select_range</code> </TD><TD> Количество соединений, в которых использовались диапазоны в первой таблице. (Обычно это значение не критично, даже если оно велико)
</TD></TR>
<TR><TD><code>Select_scan</code> </TD><TD> Количество соединений, в которых проводилось первое сканирование первой таблицы.
</TD></TR>
<TR><TD><code>Select_range_check</code> </TD><TD> Количество соединений без ключей, в которых проверка использования ключей производится после каждой строки (если это значение равно 0, необходимо внимательно проверить индексы своих таблиц).
</TD></TR>
<TR><TD><code>Questions</code> </TD><TD> Количество запросов, направленных на сервер.
</TD></TR>
<TR><TD><code>Slave_open_temp_tables</code> </TD><TD> Количество временных таблиц, открытых в настоящий момент потоком подчиненного компьютера.
</TD></TR>
<TR><TD><code>Slave_running</code> </TD><TD> Содержит значение <code>ON</code>, если это подчиненный компьютер, подключенный к головному компьютеру.
</TD></TR>
<TR><TD><code>Slow_launch_threads</code> </TD><TD> Количество потоков, создание которых заняло больше, чем указано в <code>slow_launch_time</code>.
</TD></TR>
<TR><TD><code>Slow_queries</code> </TD><TD> Количество запросов, обработка которых заняла больше времени, чем <code>long_query_time</code>. See section <A HREF="manual.ru.html#Slow_query_log">4.9.5  Журнал медленных запросов</A>.
</TD></TR>
<TR><TD><code>Sort_merge_passes</code> </TD><TD> Количество объединений, осуществленных алгоритмом сортировки. Если это значение велико, следует увеличить <code>sort_buffer_size</code>.
</TD></TR>
<TR><TD><code>Sort_range</code> </TD><TD> Количество сортировок, которые осуществлялись в диапазонах.
</TD></TR>
<TR><TD><code>Sort_rows</code> </TD><TD> Количество отсортированных строк.
</TD></TR>
<TR><TD><code>Sort_scan</code> </TD><TD> Количество сортировок, осуществленных путем сканирования таблицы.
</TD></TR>
<TR><TD><code>ssl_xxx</code> </TD><TD> Переменные, используемые SSL; еще не реализовано.
</TD></TR>
<TR><TD><code>Table_locks_immediate</code> </TD><TD> Количество запросов на немедленную блокировку таблицы. Доступно начиная с версии 3.23.33.
</TD></TR>
<TR><TD><code>Table_locks_waited</code> </TD><TD> Количество запросов, когда немедленная блокировка не могла быть осуществлена и требовалось время на ожидание. Если это значение велико, и у вас есть проблемы с производительностью, сначала необходимо оптимизировать свои запросы, а затем либо разделить таблицы, либо использовать репликацию. Доступно начиная с версии 3.23.33.
</TD></TR>
<TR><TD><code>Threads_cached</code> </TD><TD> Количество потоков в кэше потоков.
</TD></TR>
<TR><TD><code>Threads_connected</code> </TD><TD> Количество открытых в настоящий момент соединений.
</TD></TR>
<TR><TD><code>Threads_created</code> </TD><TD> Количество потоков, созданных для управления соединениями.
</TD></TR>
<TR><TD><code>Threads_running</code> </TD><TD> Количество не простаивающих потоков.
</TD></TR>
<TR><TD><code>Uptime</code> </TD><TD> Время в секундах, в течение которого сервер находится в работе.
</TD></TR>
</TABLE>

<P>
Некоторые примечания к приведенной выше информации:

</P>

<UL>
<LI>

Если значение <code>Opened_tables</code> велико, возможно, что значение переменной
<code>table_cache</code> слишком мало.

<LI>

Если значение <code>Key_reads</code> велико, возможно, что значение переменной
<code>key_buffer_size</code> слишком мало. Частоту <strong>неуспешных обращений</strong> к кэшу можно
вычислить так: <code>Key_reads</code>/<code>Key_read_requests</code>.

<LI>

Если значение <code>Handler_read_rnd</code> велико, возможно, поступает слишком
много запросов, требующих от MySQL полного сканирования таблиц или у
вас есть соединения, которые не используют ключи надлежащим образом.

<LI>

Если значение <code>Threads_created</code> велико, возможно, необходимо увеличить
значение переменной <code>thread_cache_size</code>. Частоту успешных обращений к
кэшу можно вычислить при помощи <code>Threads_created</code>/<code>Connections</code>.

<LI>

Если значение <code>Created_tmp_disk_tables</code> велико, возможно, необходимо
увеличить значение переменной <code>tmp_table_size</code>, чтобы временные таблицы
располагались в памяти, а не на жестком диске.
</UL>



<H4><A NAME="SHOW_VARIABLES" HREF="manual.ru_toc.html#SHOW_VARIABLES">4.5.6.4  <code>SHOW VARIABLES</code></A></H4>


<PRE>
SHOW [GLOBAL | SESSION] VARIABLES [LIKE wild]
</PRE>

<P>
Команда <code>SHOW VARIABLES</code> отображает значения некоторых системных переменных
MySQL. Такую же информацию можно получить и при помощи команды <code>mysqladmin
variables</code>. Если установленные по умолчанию значения вам не подходят,
большинство из этих переменных можно задать, используя параметры командной
строки при запуске <code>mysqld</code>. See section <A HREF="manual.ru.html#Command-line_options">4.1.1  Параметры командной строки <code>mysqld</code></A>.

</P>
<P>
Опции <code>GLOBAL</code> и <code>SESSION</code> новы с версии MySQL 4.0.3. С помощью <code>GLOBAL</code> вы получите
значения, использующиеся для новых подключений к MySQL. С помощью <code>SESSION</code> вы 
получите значения, которые действуют прямо сейчас в текущем соединении. Если вы 
не указываете эти опции, подразумевается <code>SESSION</code>. 

</P>
<P>
Вы можете изменить большинство параметров с помощью команды <code>SET</code>. See section <A HREF="manual.ru.html#SET_OPTION">5.5.6  Синтаксис команды <code>SET</code></A>. 

</P>

<P>
Ниже приведен пример выходных данных; формат и числа могут иметь некоторые
отличия:

</P>

<PRE>
+---------------------------------+------------------------------+
| Variable_name                   | Value                        |
+---------------------------------+------------------------------|
| back_log                        | 50                           |
| basedir                         | /usr/local/mysql             |
| bdb_cache_size                  | 8388572                      |
| bdb_log_buffer_size             | 32768                        |
| bdb_home                        | /usr/local/mysql             |
| bdb_max_lock                    | 10000                        |
| bdb_logdir                      |                              |
| bdb_shared_data                 | OFF                          |
| bdb_tmpdir                      | /tmp/                        |
| bdb_version                     | Sleepycat Software: ...	 |
| binlog_cache_size               | 32768                        |
| bulk_insert_buffer_size         | 8388608                      |
| character_set                   | latin1                       |
| character_sets                  | latin1 big5 czech euc_kr	 |
| concurrent_insert               | ON                           |
| connect_timeout                 | 5                            |
| convert_character_set           |                              |
| datadir                         | /usr/local/mysql/data/       |
| delay_key_write                 | ON                           |
| delayed_insert_limit            | 100                          |
| delayed_insert_timeout          | 300                          |
| delayed_queue_size              | 1000                         |
| flush                           | OFF                          |
| flush_time                      | 0                            |
| ft_boolean_syntax               | + -&#62;&#60;()~*:""&#38;|               |
| ft_min_word_len                 | 4                            |
| ft_max_word_len                 | 254                          |
| ft_max_word_len_for_sort        | 20                           |
| ft_stopword_file                | (built-in)                   |
| have_bdb                        | YES                          |
| have_innodb                     | YES                          |
| have_isam                       | YES                          |
| have_raid                       | NO                           |
| have_symlink                    | DISABLED                     |
| have_openssl                    | YES                          |
| have_query_cache                | YES                          |
| init_file                       |                              |
| innodb_additional_mem_pool_size | 1048576                      |
| innodb_buffer_pool_size         | 8388608                      |
| innodb_data_file_path           | ibdata1:10M:autoextend       |
| innodb_data_home_dir            |                              |
| innodb_file_io_threads          | 4                            |
| innodb_force_recovery           | 0                            |
| innodb_thread_concurrency       | 8                            |
| innodb_flush_log_at_trx_commit  | 0                            |
| innodb_fast_shutdown            | ON                           |
| innodb_flush_method             |                              |
| innodb_lock_wait_timeout        | 50                           |
| innodb_log_arch_dir             |                              |
| innodb_log_archive              | OFF                          |
| innodb_log_buffer_size          | 1048576                      |
| innodb_log_file_size            | 5242880                      |
| innodb_log_files_in_group       | 2                            |
| innodb_log_group_home_dir       | ./                           |
| innodb_mirrored_log_groups      | 1                            |
| interactive_timeout             | 28800                        |
| join_buffer_size                | 131072                       |
| key_buffer_size                 | 16773120                     |
| language                        | /usr/local/mysql/share/...   |
| large_files_support             | ON                           |
| local_infile                    | ON                           |
| locked_in_memory                | OFF                          |
| log                             | OFF                          |
| log_update                      | OFF                          |
| log_bin                         | OFF                          |
| log_slave_updates               | OFF                          |
| log_slow_queries                | OFF                          |
| log_warnings                    | OFF                          |
| long_query_time                 | 10                           |
| low_priority_updates            | OFF                          |
| lower_case_table_names          | OFF                          |
| max_allowed_packet              | 1047552                      |
| max_binlog_cache_size           | 4294967295                   |
| max_binlog_size                 | 1073741824                   |
| max_connections                 | 100                          |
| max_connect_errors              | 10                           |
| max_delayed_threads             | 20                           |
| max_heap_table_size             | 16777216                     |
| max_join_size                   | 4294967295                   |
| max_sort_length                 | 1024                         |
| max_user_connections            | 0                            |
| max_tmp_tables                  | 32                           |
| max_write_lock_count            | 4294967295                   |
| myisam_max_extra_sort_file_size | 268435456                    |
| myisam_max_sort_file_size       | 2147483647                   |
| myisam_recover_options          | force                        |
| myisam_sort_buffer_size         | 8388608                      |
| net_buffer_length               | 16384                        |
| net_read_timeout                | 30                           |
| net_retry_count                 | 10                           |
| net_write_timeout               | 60                           |
| open_files_limit                | 0                            |
| pid_file                        | /usr/local/mysql/name.pid    |
| port                            | 3306                         |
| protocol_version                | 10                           |
| read_buffer_size                | 131072                       |
| read_rnd_buffer_size            | 262144                       |
| rpl_recovery_rank               | 0                            |
| query_cache_limit               | 1048576                      |
| query_cache_size                | 0                            |
| query_cache_type                | ON                           |
| safe_show_database              | OFF                          |
| server_id                       | 0                            |
| slave_net_timeout               | 3600                         |
| skip_external_locking           | ON                           |
| skip_networking                 | OFF                          |
| skip_show_database              | OFF                          |
| slow_launch_time                | 2                            |
| socket                          | /tmp/mysql.sock              |
| sort_buffer_size                | 2097116                      |
| sql_mode                        | 0                            |
| table_cache                     | 64                           |
| table_type                      | MYISAM                       |
| thread_cache_size               | 3                            |
| thread_stack                    | 131072                       |
| tx_isolation                    | READ-COMMITTED               |
| timezone                        | EEST                         |
| tmp_table_size                  | 33554432                     |
| tmpdir                          | /tmp/:/mnt/hd2/tmp/          |
| version                         | 4.0.4-beta                   |
| wait_timeout                    | 28800                        |
+---------------------------------+------------------------------+
</PRE>

<P>
<A NAME="IDX625"></A>

</P>
<P>
Ниже описаны все параметры. Значения размеров буферов, длины и размеры
стеков приведены в байтах. Значения можно указать с суффиксом <code>'K'</code> или <code>'M'</code>,
чтобы обозначить килобайты или мегабайты. Например, <code>16M</code> означает <code>16</code>
мегабайт. Регистр буквы суффикса не имеет значения, <code>16M</code> и <code>16m</code> обозначают
одно и то же:

</P>

<UL>
<LI><code>ansi_mode</code>.

Имеет значение <code>ON</code>, если <code>mysqld</code> был запущен с параметром <code>--ansi</code>. See section <A HREF="manual.ru.html#ANSI_mode">1.9.2  Запуск MySQL в режиме ANSI</A>.

<LI><code>back_log</code>

Количество поддерживаемых MySQL запросов на соединение,
находящихся в очереди. Этот параметр начинает играть роль, когда
главный поток MySQL получает очень много запросов на соединение за
короткий промежуток времени. У главного потока уходит некоторое время
(хотя очень небольшое) на проверку соединения и запуск нового потока.
Значение <code>back_log</code> показывает, сколько запросов может находиться в
очереди на этом коротком промежутке времени, прежде чем MySQL
прекратит отвечать на новые запросы. Данное значение необходимо
увеличить только в том случае, если ожидается большое количество
соединений на протяжении короткого промежутка времени. Иначе говоря,
это значение является размером очереди ожидания входящих соединений
TCP/IP. У вашей операционной системы есть свое собственное ограничение
на размер этой очереди. За более подробной информацией обращайтесь на
страницу руководства ОС Unix по системному вызову <code>listen(2)</code>. Чтобы
узнать максимальное значение для этой переменной, обратитесь к
документации по своей операционной системе. Попытка установить
значение <code>back_log</code> выше, чем допускается в вашей операционной системе,
не принесет положительного результата.

<LI><code>basedir</code>

Значение параметра <code>--basedir</code>.

<LI><code>bdb_cache_size</code>

Буфер, выделенный для индекса кэша и строк таблиц <code>BDB</code>.
Если таблицы <code>BDB</code> не используются, необходимо запустить <code>mysqld</code> с
параметром <code>--skip-bdb</code>, чтобы не расходовать память на этот кэш.

<LI><code>bdb_log_buffer_size</code>

Буфер, выделенный для индекса кэша и строк таблиц
<code>BDB</code>. Если таблицы <code>BDB</code> не используются, его значение необходимо
установить в 0 или запустить <code>mysqld</code> с параметром <code>--skip-bdb</code>, чтобы не
расходовать память на этот кэш.

<LI><code>bdb_home</code>

Значение параметра <code>--bdb-home</code>.

<LI><code>bdb_max_lock</code>

Максимальное количество блокировок (по умолчанию 10000),
которые можно установить на таблицу <code>BDB</code>. Этот параметр необходимо
увеличить, если возникают ошибки типа <code>bdb: Lock table is out of
available locks</code> или <code>Got error 12 from ...</code> при выполнении длинных
транзакций или когда <code>mysqld</code> должен просмотреть много строк для
вычисления запроса.

<LI><code>bdb_logdir</code>

Значение параметра <code>--bdb-logdir</code>.

<LI><code>bdb_shared_data</code>

Содержит значение <code>ON</code>, если используется параметр
<code>--bdb-shared-data</code>.

<LI><code>bdb_tmpdir</code>

Значение параметра <code>--bdb-tmpdir</code>.

<LI><code>binlog_cache_size</code>.

Размер кэша для хранения операторов бинарного
журнала SQL во время транзакции. Если часто используются большие
транзакции со значительным количеством операторов, то в целях
повышения производительности значение этого параметра можно увеличить.
See section <A HREF="manual.ru.html#COMMIT">6.7.1  Синтаксис команд <code>BEGIN/COMMIT/ROLLBACK</code></A>.

<LI><code>bulk_insert_buffer_size</code> (был <code>myisam_bulk_insert_tree_size</code>)

MyISAM использует специальный древо-подобный кэш чтобы ускорить многострочные
вставки (которые <code>INSERT ... SELECT</code>, <code>INSERT ... VALUES (...),
(...), ...</code>, и <code>LOAD DATA INFILE</code>). Эта переменная ограничивает размер
такого кэша в каждом потоке (указывается в байтах). Установка в 0 запретит
такую оптимизацию. 

<code>Внимание:</code> этот кэш работает только тогда, когда делается вставка в
непустую таблицу. Значение по умолчанию: 8 Мб. 

<LI><code>character_set</code>

Принятый по умолчанию набор символов.

<LI><code>character_sets</code>

Поддерживаемые наборы символов.

<LI><code>concurrent_inserts</code>

Если установлено значение <code>ON</code> (принятое по
умолчанию), MySQL обеспечивает возможность использовать команду <code>INSERT</code>
на таблицах <code>MyISAM</code> одновременно с выполнением над этими же таблицами
запросов <code>SELECT</code>. Этот параметр можно отключить, запустив <code>mysqld</code> с
параметром <code>--safe</code> или <code>--skip-new</code>.

<LI><code>connect_timeout</code>

Количество времени в секундах, на протяжении которого
сервер <code>mysqld</code> ожидает поступления пакета соединения, после чего
генерирует <code>Bad handshake</code>.

<LI><code>datadir</code>

Значение параметра <code>--datadir</code>.

<LI><code>delay_key_write</code>

Опция для таблиц MyISAM. Может принимать одно из следующих значений: 

<TABLE BORDER>
<TR><TD>OFF </TD><TD> Все CREATE TABLE ... DELAYED_KEY_WRITES игнорируются.
</TD></TR>
<TR><TD>ON </TD><TD> (по умолчанию)  MySQL будет учитывать опцию <code>DELAY_KEY_WRITE</code>
в <code>CREATE TABLE</code>.
</TD></TR>
<TR><TD>ALL </TD><TD> Все вновь открытые таблицы обслуживаются так, будто бы они были созданы с опцией <code>DELAY_KEY_WRITE</code>.
</TD></TR>
</TABLE>

Если <code>DELAY_KEY_WRITE</code> включен, это означает что ключевой буфер для таблиц с этой опцией не будет сбрасываться на диск при каждом обновлении индексов, но только тогда, когда таблица закрывается. Это весьма ускорит записи ключей, но вы должны обязательно реализовать автоматическую проверку всех таких таблиц с помощью <code>myisamchk --fast --force</code> если вы хотите использовать эту опцию. 

<LI><code>delay_key_write</code>

Если включен (по умолчанию - включен), MySQL будет
учитывать параметр <code>DELAY_KEY_WRITE</code> для команды <code>CREATE</code> TABLE. Это
означает, что ключевой буфер таблиц с данным параметром будет
сбрасываться на диск не при каждом обновлении индексов, а только при
закрытии таблицы. Такой режим работы значительно ускоряет запись
ключей, однако в случае использования данного параметра необходимо
будет также добавить автоматическую проверку всех таблиц при помощи
<code>myisamchk --fast --force</code>. Обратите внимание: если запустить <code>mysqld</code> с
параметром <code>--delay-key-write-for-all-tables</code>, то все таблицы будут
обрабатываться таким образом, как будто они были созданы с применением
параметра <code>delay_key_write</code>. Этот флаг можно снять, запустив <code>mysqld</code> с
параметром <code>--skip-new</code> или <code>--safe-mode</code>.

<LI><code>delayed_insert_limit</code>

После вставки строк <code>delayed_insert_limit</code>
обработчик <code>INSERT DELAYED</code> проверит, остались ли незавершенные
операторы <code>SELECT</code>. Если да, то перед тем, как приступить к выполнению
следующих действий, они будут выполнены.

<LI><code>delayed_insert_timeout</code>

Временной промежуток, в течение которого
процесс <code>INSERT DELAYED</code> должен ожидать операторов <code>INSERT</code> до прекращения
выполнения задачи.

<LI><code>delayed_queue_size</code>

Размер очереди (в строках), который должен быть
назначен для обработки команды <code>INSERT DELAYED</code>. При переполнении
очереди все клиенты, выполняющие команду <code>INSERT DELAYED</code>, будут
ожидать, пока в очереди снова появится свободное место.

<LI><code>flush</code>

Значение этой переменной будет <code>ON</code>, если вы запустили MySQL с
параметром <code>--flush</code>.

<LI><code>flush_time</code>

Если значение этой переменной отличается от нуля, то каждые
<code>flush_time</code> секунд все таблицы будут закрываться (чтобы освободить
ресурсы и записать информацию на диск). Мы рекомендуем использовать
этот параметр только для Windows 9x/Me или на системах с ограниченным
количеством ресурсов.

<LI><code>ft_boolean_syntax</code>

Список операторов, поддерживаемых <code>MATCH ... AGAINST(... IN BOOLEAN MODE)</code>.
See section <A HREF="manual.ru.html#Fulltext_Search">6.8  Полнотекстовый поиск в MySQL</A>.

<LI><code>ft_min_word_len</code>

Минимальная длина слова, включаемого в индекс
<code>FULLTEXT</code>. <strong>Примечание: индексы <code>FULLTEXT</code> после изменения этой
переменной должны быть скомпонованы заново (это новый параметр в MySQL
4.0)</strong>.

<LI><code>ft_max_word_len</code>

Максимальная длина слова, включаемого в индекс
<code>FULLTEXT</code>. <strong>Примечание: индексы <code>FULLTEXT</code> после изменения этой переменной
должны быть скомпонованы заново (это новый параметр в MySQL 4.0)</strong>.

<LI><code>ft_max_word_len_for_sort</code>

Максимальная длина слова в индексе <code>FULLTEXT</code>; эта
длина будет использоваться для метода быстрого восстановления индекса
в командах <code>REPAIR</code>, <code>CREATE INDEX</code> или <code>ALTER</code> TABLE. Более длинные слова
вставляются дольше. При увеличении значения <code>ft_max_word_len_for_sort</code> MySQL
будет создавать временные файлы большего размера (таким образом будет
замедляться работа из-за возрастания нагрузки на порт ввода/вывода
диска), а также будет помещать меньше ключей в один блок сортировки
(что, опять же, способствует снижению производительности). Если
значение переменной <code>ft_max_word_len_for_sort</code> слишком мало, MySQL будет
вставлять большое количество слов достаточно медленно, но короткие
слова будут вставляться очень быстро.

<LI><code>ft_stopword_file</code>

Из этого файла читается список стоп-слов для полнотекстового поиска. 
Все слова из этого файла будут использованы, комментарии в этом файле <strong>недопустимы</strong>.
По умолчанию используется встроенный список стоп-слов (определен в файле 
<tt>`myisam/ft_static.c'</tt>).
Установка этого параметра в пустое значение (<code>""</code>) выключает фильтрацию по стоп-словам. 

<strong>Внимание: <code>FULLTEXT</code> индексы должны быть перестроены после того, как эта переменная изменена.</strong>
(Эта опция нова в MySQL 4.0.10)

<LI><code>have_innodb</code>

Значение <code>YES</code>, если <code>mysqld</code> поддерживает  таблицы
<code>InnoDB</code>. Значение <code>DISABLED</code>, если  используется  параметр 
<code>--skip-innodb</code>.

<LI><code>have_bdb</code>

Значение <code>YES</code>, если <code>mysqld</code> поддерживает таблицы <code>Berkeley DB</code>.
Значение <code>DISABLED</code>, если используется параметр <code>--skip-bdb</code>.

<LI><code>have_raid</code>

Значение <code>YES</code>, если <code>mysqld</code> поддерживает параметр <code>RAID</code>.

<LI><code>have_openssl</code>

Значение <code>YES</code>, если <code>mysqld</code> поддерживает SSL (шифрование) в
протоколе клиент/сервер.

<LI><code>init_file</code>

Имя файла, указанного при помощи параметра <code>--init-file</code> при
запуске сервера. Это файл операторов SQL, которые сервер должен
выполнить при запуске.

<LI><code>interactive_timeout</code>

Количество времени в секундах, на протяжении
которого сервер ожидает активности со стороны интерактивного
соединения, прежде чем закрыть его. Интерактивный клиент - это клиент,
который использует параметр <code>CLIENT_INTERACTIVE</code> для
<code>mysql_real_connect</code>(). См. также информацию по <code>wait_timeout</code>.

<LI><code>join_buffer_size</code>

Размер буфера, используемого для полных объединений
(объединения, в которых не применяются индексы). Буфер выделяется один
раз для каждого полного объединения двух таблиц. Если нужно ускорить
полное объединение и невозможно добавить индексы, следует увеличить
это значение (обычно добавление индексов является лучшим способом
добиться быстрых объединений).

<A NAME="IDX626"></A>
<LI><code>key_buffer_size</code>

Блоки индексов буферизированы и доступ к ним разрешен
всем потокам. <code>key_buffer_size</code> - размер буфера, используемого для
блоков индексов. Чтобы улучшить обработку индексов (для всех операций
чтения и записи нескольких элементов), необходимо увеличить это
значение настолько, насколько возможно. Размер 64 Мб для компьютера с
256 Мб (именно такой компьютер в основном используется для работы с
MySQL) - довольно распространенная конфигурация. Тем не менее, если
задать слишком большое значение (например, больше 50% от общего
количества памяти), система может начать сохранять временные файлы на
диске, что значительно снизит производительность. Помните, что,
поскольку MySQL не производит кэширования считываемых данных, нужно
оставлять определенное пространство для кэша файловой системы
операционной системы. Производительность буфера ключей можно
проверить, выполнив команду <code>SHOW STATUS</code> и проверив значения переменных
<code>Key_read_requests</code>, <code>Key_reads</code>, <code>Key_write_requests</code> и <code>Key_writes</code>.
Отношение значений <code>Key_reads</code>/<code>Key_read_request</code> обычно должно быть &#60;
0,01. Отношение <code>Key_write</code>/<code>Key_write_requests</code> примерно равно 1, если в
основном используются обновления/удаления, но может быть и меньше,
если чаще используются обновления сразу многих элементов или если
<code>DELAY_KEY_WRITE</code>. See section <A HREF="manual.ru.html#SHOW">4.5.6  Синтаксис команды <code>SHOW</code></A>. Чтобы еще больше увеличить
скорость при одновременной записи большого количества строк,
используйте команду <code>LOCK TABLES</code>. See section <A HREF="manual.ru.html#LOCK_TABLES">6.7.2  Синтаксис команд <code>LOCK TABLES/UNLOCK TABLES</code></A>.

<LI><code>language</code>

Язык, используемый для вывода сообщений об ошибках.

<LI><code>large_file_support</code>

Если <code>mysqld</code> был откомпилирован с параметрами для
поддержки больших файлов.

<LI><code>locked_in_memory</code>

Если <code>mysqld</code> был заблокирован в памяти при помощи
<code>--memlock</code>

<LI><code>log</code>

Если включено занесение в журнал всех запросов.

<LI><code>log_update</code>

Если включен журнал обновлений.

<LI><code>log_bin</code>

Если включен бинарный журнал.

<LI><code>log_slave_updates</code>

Если обновления от подчиненного компьютера должны
заноситься в журнал.

<LI><code>long_query_time</code>

Если обработка запроса отнимает больше указанного
промежутка времени (в секундах), значение счетчика <code>Slow_queries</code> будет
увеличено. Если используется параметр <code>--log-slow-queries</code>, запрос будет
записан в журнал медленных запросов.
Это значение указывается в единицах реального времени, а не времени занятости процессора (CPU time).
Таким образом, некий запрос, который выполняется быстрее указываемого времени
на слегка загруженном сервере может выполняться больше указанного времени на
более загруженном компьютере. See section <A HREF="manual.ru.html#Slow_query_log">4.9.5  Журнал медленных запросов</A>.

<LI><code>lower_case_table_names</code>

Если установлено значение 1, имена таблиц будут
сохранятся на диск с использованием строчных букв, а имена таблиц не
будут чувствительны к регистру. С версии MySQL 4.0.2 это также 
касается и имен баз данных. See section <A HREF="manual.ru.html#Name_case_sensitivity">6.1.3  Чувствительность имен к регистру</A>.

<LI><code>max_allowed_packet</code>

Максимальный размер одного пакета. Изначально
размер буфера сообщений устанавливается в <code>net_buffer_length</code> байтов, но
при необходимости может возрасти до <code>max_allowed_packet</code> байтов. Это
значение по умолчанию не настолько велико, чтобы отсеивать большие
(возможно ошибочные) пакеты. Если используются большие столбцы <code>BLOB</code>,
его необходимо увеличить. Значение должно быть не меньше самого
большого <code>BLOB</code>, который будет использоваться. Ограничение протокола для
<code>max_allowed_packet</code> составляет 16 Мб в MySQL 3.23 и 1Гб в MySQL 4.0.

<LI><code>max_binlog_cache_size</code>

Если для транзакции с большим количеством
операторов потребуется большее количество памяти, чем указано этим
параметром, будет выдано сообщение об ошибке "Multi-statement
transaction required more than 'max_binlog_cache_size' bytes of
storage" (для транзакции с большим количеством операторов требуется
больше, чем 'max_binlog_cache_size' байтов для хранения).

<LI><code>max_binlog_size</code>

Доступно после версии 3.23.33. Если запись в бинарный
журнал (репликация) превысит данное значение, производится ротация
журнала. Нельзя установить значение, меньшее, чем 1024 байта или
большее, чем 1 Гб. По умолчанию установлено значение 1 Гб.

<LI><code>max_connections</code>

Разрешенное количество одновременно подсоединенных
клиентов. Увеличение этого значения увеличивает количество
дескрипторов файлов, необходимых для <code>mysqld</code>. Ниже приведены примечания
по ограничениям для дескрипторов. See section <A HREF="manual.ru.html#Too_many_connections">A.2.5  Ошибка <code>Too many connections</code></A>.

<LI><code>max_connect_errors</code>

Если количество прерванных соединений с удаленным
компьютером превышает это число, дальнейшие попытки удаленного
компьютера установить соединение будут заблокированы. Блокировку с
удаленного компьютера можно снять при помощи команды <code>FLUSH HOSTS</code>.

<LI><code>max_delayed_threads</code>

Не запускайте больше потоков, чем указано здесь,
для обработки операторов <code>INSERT DELAYED</code>. Если попытаться вставить
данные в новую таблицу, когда все потоки <code>INSERT DELAYED</code> заняты, строка
будет вставлена таким образом, как будто атрибут <code>DELAYED</code> не был
указан.

<LI><code>max_heap_table_size</code>

Не позволяет создавать динамические таблицы,
размер которых превышает указанное значение.

<LI><code>max_join_size</code>

Объединения, которые потенциально могут считывать более
<code>max_join_size</code> записей, будут возвращать ошибку. Это значение нужно
задавать, если ваши пользователи осуществляют объединения, которым
недостает оператора <code>WHERE</code>,  -  такие объединения занимают много
времени, а затем возвращают миллионы строк.

<LI><code>max_sort_length</code>

Параметр определяет, сколько байтов следует
использовать при сортировке значений <code>BLOB</code> или <code>TEXT</code> (обрабатываются
только первые <code>max_sort_length</code> байтов каждого значения, остальные
игнорируются).

<LI><code>max_user_connections</code>

Максимальное количество активных соединений для
одного пользователя (0 = без ограничений).

<LI><code>max_tmp_tables</code>

(Этот параметр пока ни на что не влияет.) Максимальное
количество временных таблиц, которые клиент может открывать
одновременно.

<LI><code>max_write_lock_count</code>

После данного количества блокирования записей
разрешается выполнить между ними несколько блокировок чтения.

<LI><code>myisam_recover_options</code>

Значение  параметра  <code>--myisam-recover</code>.

<LI><code>myisam_sort_buffer_size</code>

Буфер, который выделяется для сортировки
индексов при выполнении команды <code>REPAIR</code> или для создания индексов при
помощи команд <code>CREATE INDEX</code> или <code>ALTER TABLE</code>.

<LI><code>myisam_max_extra_sort_file_size</code>.

Если размер временного файла,
используемого для быстрого создания индексов, превышает на указанный
здесь объем используемый кэш ключей, то лучше отдать предпочтение
методу кэша ключей. Такой метод применяется для того, чтобы для
больших ключей символов в больших таблицах использовался более
медленный метод кэширования ключей при создании таблиц.
<strong>Обратите внимание</strong>: значение этого параметра в байтах, начиная с 4.0.3
(до 4.0.3 параметр указывался в мегабайтах).

<LI><code>myisam_max_sort_file_size</code>

Максимальный размер временного файла,
который в MySQL может использоваться при восстановлении индекса (во
время работы команд <code>REPAIR</code>, <code>ALTER TABLE</code> или <code>LOAD DATA INFILE</code>). Для
файлов, размер которых превышает указанное значение, индекс будет
создаваться при помощи кэша ключей (такой алгоритм работает несколько
медленнее).
<strong>Обратите внимание</strong>: значение этого параметра в байтах, начиная с 4.0.3
(до 4.0.3 параметр указывался в мегабайтах).

<LI><code>net_buffer_length</code>

В данное значение устанавливается в промежутках
между запросами буфер соединения. Обычно это значение не изменяется,
но если у вас очень мало памяти, можно установить его по размеру
ожидаемого запроса (т.е. равным предполагаемой длине операторов SQL,
отправляемых клиентами; если оператор превысит указанную длину, буфер
будет автоматически увеличен как максимум до <code>max_allowed_packet</code>
байтов).

<LI><code>net_read_timeout</code>

Количество времени в секундах, на протяжении которого
ожидаются дополнительные данные от соединения, пока не будет отменено
чтение. Обратите внимание, что мы не ожидаем поступления данных от
соединения, время ожидания определяется по <code>write_timeout</code>. Также см.
<code>slave_net_timeout</code>.

<LI><code>net_retry_count</code>

Если чтение из порта связи было прервано, будет
предпринято указанное количество попыток повторного чтения. Это
значение должно быть достаточно высоким на <code>FreeBSD</code>, так как внутренние
прерывания направляются на все потоки.

<LI><code>net_write_timeout</code>

Время ожидания записи блока через соединение, пока
запись не будет прервана (в секундах).

<LI><code>open_files_limit</code>

Если это значение отлично от 0, то <code>mysqld</code> будет
применять его для резервных дескрипторов файлов, используемых с
<code>setrlimit()</code>. Если это значение равно 0, то <code>mysqld</code> будет резервировать
<code>max_connections*5</code> или <code>max_connections + table_cache*2</code> (в зависимости
от того, какое число больше) файлов. Если <code>mysqld</code> выдает ошибку 'Too
many open files' (слишком много открытых файлов), данное значение
необходимо увеличить.

<LI><code>pid_file</code>

Значение параметра <code>--pid-file</code>.

<LI><code>port</code>

Значение параметра <code>--port</code>.

<LI><code>protocol_version</code>

Версия протокола, используемого сервером MySQL.

<LI><code>read_buffer_size</code> (было <code>record_buffer</code>)

Каждый поток, осуществляющий последовательное
сканирование, выделяет буфер указанного размера для каждой сканируемой
таблицы. Если проводится много последовательных сканирований, это
значение можно увеличить.

<LI><code>record_rnd_buffer_size</code>

При считывании строк после проведения сортировки в
отсортированном порядке строки считываются через буфер, чтобы избежать
операций поиска по диску. Это может улучшить выполнение <code>ORDER BY</code> весьма
и весьма, если параметр установлен в большое значение. Т.к. эта переменная
имеет отношение к потоку, то не устанавливайте слишком большое значение
глобально, но просто меняйте его при выполнении некоторых больших запросов. 

<LI><code>query_cache_limit</code>

Результаты, превышающие это значение, не кэшируются
(по умолчанию - 1Мб).

<LI><code>query_cache_size</code>

Память, выделенная для хранения результатов старых
запросов. Если значение установлено в 0, кэш запросов отключен
(принято по умолчанию).

<LI><code>query_cache_type</code>

Могут быть заданы следующие значения (только
числовые):

<TABLE BORDER>
<TR><TD><strong>Значение</strong> </TD><TD> <strong>Объяснение</strong> </TD><TD> <strong>Примечание</strong>
</TD></TR>
<TR><TD>0 </TD><TD> OFF </TD><TD> Не  кэширует  и  не  извлекает результаты.
</TD></TR>
<TR><TD>1 </TD><TD> ON </TD><TD> Кэширует все результаты, кроме запросов <code>SELECT SQL_NO_CACHE ...</code>.
</TD></TR>
<TR><TD>2 </TD><TD> DEMAND </TD><TD> Кэширует только запросы <code>SELECT SQL_CACHE ...</code>.
</TD></TR>
</TABLE>

<LI><code>safe_show_database</code>

Не отображаются базы данных, для которых у
пользователя нет каких-либо привилегий по базам данных или таблицам.
Таким образом можно увеличить степень безопасности, если вы не хотите
предоставлять посторонним лицам возможность получать информацию о том,
какие базы данных есть у других пользователей. Также  см. <code>skip_show_database</code>.

<LI><code>server_id</code>

Значение параметра <code>--server-id</code>.

<LI><code>skip_locking</code>

Установлено в значение <code>OFF</code>, если <code>mysqld</code> использует
внешнюю блокировку.

<LI><code>skip_networking</code>

Установлено в значение <code>ON</code>, если разрешаются только
локальные соединения (через сокет).

<LI><code>skip_show_database</code>

Эта переменная не позволяет выполнять команду <code>SHOW
DATABASES</code>, если у пользователя нет привилегии <code>PROCESS</code>. Таким образом
можно увеличить степень безопасности, если вы не хотите предоставлять
посторонним лицам возможность получать информацию о том, какие базы
данных есть у других пользователей. Также  см. <code>safe_show_database</code>.

<LI><code>slave_net_timeout</code>

Количество времени в секундах, в течение которого
ожидаются дополнительные данные от подсоединенного головного или
подчиненного компьютера прежде, чем будет отменено чтение.

<LI><code>slow_launch_time</code>

Если создание потока занимает больше, чем указанное
значение (в секундах), значение счетчика <code>Slow_launch_threads</code> будет
увеличено.

<LI><code>socket</code>

Сокет Unix, используемый сервером.

<LI><code>sort_buffer_size</code>

Каждый поток, которому необходимо произвести сортировку,
выделяет буфер данного размера. Увеличение данного значения позволит
ускорить выполнение операторов <code>ORDER BY</code> или <code>GROUP BY</code>. See section <A HREF="manual.ru.html#Temporary_files">A.4.4  Где MySQL хранит временные файлы</A>.

<LI><code>table_cache</code>

Количество открытых таблиц для всех потоков. С увеличением
этого значения увеличивается количество дескрипторов файлов,
необходимых для <code>mysqld</code>. Чтобы узнать, необходимо ли изменять значение
кэша таблиц, следует проверить значение переменной <code>Opened_tables</code>. См.
раздел See section <A HREF="manual.ru.html#Temporary_files">A.4.4  Где MySQL хранит временные файлы</A>. Если у этой переменной
большое значение, а команда <code>FLUSH TABLES</code> (которая закрывает все
таблицы, а потом открывает их повторно) используется не часто, то
необходимо увеличить ее значение. Чтобы получить дополнительную
информацию по кэшу таблиц, см. раздел See section <A HREF="manual.ru.html#Table_cache">5.4.7  Открытие и закрытие таблиц в MySQL</A>.

<LI><code>table_type</code>

Принятый по умолчанию тип таблиц.

<LI><code>thread_cache_size</code>

Определяет, сколько потоков должно сохраняться в
кэше для повторного использования. После отключения клиента потоки
клиента помещаются в кэш, если там не больше потоков, чем
<code>thread_cache_size</code>. Все новые потоки сначала берутся из кэша, и только
когда кэш становится пустым, создаются новые потоки. Значение этой
переменной можно увеличить, чтобы повысить производительность, если
создается много новых соединений (если потоки у вас хорошо
организованы, обычно заметного улучшения производительности не
наблюдается). Насколько эффективен текущий кэш потоков, можно
определить по разнице между <code>Connections</code> и <code>Threads_created</code>.

<LI><code>thread_concurrency</code>

В системе Solaris <code>mysqld</code> вызывает функцию
<code>thr_setconcurrency()</code> с этим значением. <code>thr_setconcurrency()</code> позволяет
приложению дать системе потоков подсказку по необходимому количеству
потоков, которые должны быть запущены в одно и то же время.

<LI><code>thread_stack</code>

Размер стека для каждого потока. От данного значения
зависит большое количество ограничений, обнаруживаемых при помощи
теста <code>crash</code>-me. По умолчанию этот размер достаточен для нормальной
работы. See section <A HREF="manual.ru.html#MySQL_Benchmarks">5.1.4  Набор тестов MySQL (The MySQL Benchmark Suite)</A>.

<LI><code>timezone</code>

Часовой пояс, в котором находится сервер.

<LI><code>tmp_table_size</code>

Если находящаяся в памяти временная таблица превысит
этот размер, MySQL автоматически преобразует ее в дисковую таблицу
<code>MyISAM</code>. Значение <code>tmp_table_size</code> следует увеличить, если выполняется
много расширенных запросов <code>GROUP BY</code> и в вашей системе установлено
значительное количество оперативной памяти.

<LI><code>tmpdir</code>

Каталог, используемый для временных файлов и временных таблиц.
Начиная с MySQL 4.1, в <code>tmpdir</code> могут быть указаны несколько путей, разделенных
двоеточием <code>:</code> (точкой с запятой на Windows <code>;</code>). Эти пути будут 
использованы в ротации. 

<LI><code>version</code>

Номер версии сервера.

<LI><code>wait_timeout</code>

Время в секундах, на протяжении которого сервер наблюдает неактивность в
неинтерактивном соединения прежде, чем закрыть его.  Когда запускается поток,
<code>SESSION.WAIT_TIMEOUT</code> инициализируется исходя из
<code>GLOBAL.WAIT_TIMEOUT</code> или <code>GLOBAL.INTERACTIVE_TIMEOUT</code>, в зависимости
от типа клиента (как определяется в <code>CLIENT_INTERACTIVE</code> опции
соединения).

См. также <code>interactive_timeout</code>.
</UL>

<P>
Раздел руководства, в котором описывается настройка MySQL содержит
некоторую информацию по настройке приведенных выше переменных. 
See section <A HREF="manual.ru.html#Server_parameters">5.5.2  Настройка параметров сервера</A>.

</P>


<H4><A NAME="SHOW_LOGS" HREF="manual.ru_toc.html#SHOW_LOGS">4.5.6.5  <code>SHOW LOGS</code></A></H4>

<P>
<code>SHOW LOGS</code> отображает информацию по состоянию существующих файлов журналов.
На данный момент выводится информация только по файлам журналов Berkeley
DB.

</P>

<UL>
<LI><code>File</code> отображает полный путь к файлу журнала

<LI><code>Type</code> отображает тип файла журнала (<code>BDB</code> для файлов журналов Berkeley

DB)
<LI><code>Status</code> отображает состояние файла журнала (<code>FREE</code> - если файл может быть

удален, или <code>IN USE</code>, если файл необходим подсистеме транзакций).
</UL>



<H4><A NAME="SHOW_PROCESSLIST" HREF="manual.ru_toc.html#SHOW_PROCESSLIST">4.5.6.6  <code>SHOW PROCESSLIST</code></A></H4>

<P>
<A NAME="IDX627"></A>
<A NAME="IDX628"></A>
<A NAME="IDX629"></A>

</P>
<P>
<A NAME="IDX630"></A>
<A NAME="IDX631"></A>

</P>
<P>
Команда <code>SHOW [FULL] PROCESSLIST</code> показывает, какие потоки запущены в
настоящий момент. Эту информацию также можно получить при помощи команды
<code>mysqladmin processlist</code>. Если у вас привилегия <code>SUPER</code>, можно
просматривать все потоки, в противном случае - только свои потоки. See section <A HREF="manual.ru.html#KILL">4.5.5  Синтаксис команды <code>KILL</code></A>.
Если не используется параметр <code>FULL</code>, будут показаны только первые 100
символов каждого запроса.

</P>
<P>
Начиная с 4.0.12, MySQL сообщает имя хоста для TCP/IP соединений как 
<code>имя_хоста:клиентский_порт</code> с тем, чтобы было проще понять, какой клиент
чем занят. 

</P>
<P>
Эта команда очень полезна, если выдается сообщение об ошибке 'too many
connections' (слишком много соединений) и необходимо выяснить, что
происходит. MySQL резервирует одно дополнительное соединение для клиента с
привилегией <code>SUPER</code>, чтобы у вас всегда была возможность войти в систему и
произвести проверку (предполагается, что вы не станете раздавать эту
привилегию всем своим пользователям).

</P>
<P>
Некоторые состояния обычно можно увидеть в <code>mysqladmin processlist</code>.

</P>

<UL>
<LI><code>Checking table</code>

Поток осуществляет [автоматическую] проверку таблицы.
<LI><code>Closing tables</code>

Означает, что поток записывает измененные данные таблиц
на диск и закрывает использующиеся таблицы. Выполнение этой операции
должно произойти быстро. Если на нее уходит значительное время,
убедитесь, что диск не переполнен или что диск не используется слишком
интенсивно.
<LI><code>Connect Out</code>

Подчиненный компьютер, подсоединенный к головному
компьютеру.
<LI><code>Copying to tmp table on disk</code>

Набор временных результатов превысил
<code>tmp_table_size</code>, и теперь поток изменяет таблицу временных данных,
расположенную в памяти, на дисковую таблицу, чтобы сохранить память.
<LI><code>Creating tmp table</code>

Поток создает временную таблицу, чтобы хранить
часть результатов для запроса.
<LI><code>deleting from main table</code>

При запуске первой части удаления нескольких
таблиц удаление производится только начиная с первой таблицы.
<LI><code>deleting from reference tables</code>

При запуске второй части удаления
нескольких таблиц удаляются совпадающие строки из других таблиц.
<LI><code>Flushing tables</code>

Поток запускает команду <code>FLUSH TABLES</code> и ожидает, пока
все потоки закроют свои таблицы.
<LI><code>Killed</code>

Кто-то направил команду на закрытие потока, и поток будет
закрыт при следующей проверке флага закрытия. Флаг проверяется при
каждом основном цикле в MySQL, но в некоторых случаях закрытие потока
может занять некоторое время. Если поток заблокирован другим потоком,
закрытие будет произведено сразу после того, как другой поток снимет
блокировку.
<LI><code>Sending data</code>

Поток обрабатывает строки для оператора <code>SELECT</code>, а также
направляет данные клиенту.
<LI><code>Sorting for group</code>

Поток осуществляет сортировку в соответствии с <code>GROUP BY</code>.
<LI><code>Sorting for order</code>

Поток осуществляет сортировку в соответствии с <code>ORDER BY</code>.
<LI><code>Opening tables</code>

Это просто означает, что поток пытается открыть
таблицу. Такая процедура осуществляется довольно быстро, если что-либо
не мешает открытию. Например, команды <code>ALTER TABLE</code> или <code>LOCK TABLE</code> могут
помешать открытию таблицы, пока выполнение команды не будет завершено.
<LI><code>Removing duplicates</code>

Запрос использовал команду <code>SELECT DISTINCT</code> таким
образом, что MySQL не смог произвести оптимизацию на начальном этапе.
Поэтому MySQL перед отправкой результатов клиенту должен выполнить
дополнительное удаление всех дублирующихся строк.
<LI><code>Reopen table</code>

Поток заблокировал таблицу, но обнаружил, что после
блокировки структура таблицы изменилась. Он снял блокировку, закрыл
таблицу и теперь пытается повторно ее открыть.
<LI><code>Repair by sorting</code>

Код восстановления использует сортировку для
создания индексов.
<LI><code>Repair with keycache</code>

Код восстановления использует создание ключей
один за другим, через кэш ключей. Это намного медленнее, чем <code>Repair by
sorting</code>.
<LI><code>Searching rows for update</code>

Поток осуществляет первую фазу - производит
поиск всех совпадающих строк, чтобы затем обновить их. Это действие
необходимо выполнить, если команда <code>UPDATE</code> изменяет индекс, который
используется для поиска указанных строк.
<LI><code>Sleeping</code>

Поток ожидает, когда клиент направит ему новую команду.
<LI><code>System lock</code>

Поток ожидает получения внешней системной блокировки
таблицы. Если не используется несколько серверов <code>mysqld</code>, которые
получают доступ к одним и тем же таблицам, системную блокировку можно
отключить при помощи параметра <code>--skip-external-locking</code>.
<LI><code>Upgrading lock</code>

Обработчик <code>INSERT DELAYED</code> пытается заблокировать
таблицу, чтобы вставить строки.
<LI><code>Updating</code>

Поток производит поиск строк, которые необходимо обновить, и
обновляет их.
<LI><code>User Lock</code>

Поток  ожидает  <code>GET_LOCK()</code>.
<LI><code>Waiting for tables</code>

Поток получил уведомление, что структура таблицы
изменилась, и ему необходимо повторно открыть таблицу, чтобы получить
новую структуру. Чтобы повторно открыть таблицу, он должен подождать,
пока ее не закроют все остальные потоки. Это уведомление выдается,
если другой поток воспользовался командой <code>FLUSH TABLES</code> или к таблице
была применена одна из следующих команд: <code>FLUSH TABLES table_name</code>,
<code>ALTER TABLE</code>, <code>RENAME TABLE</code>, <code>REPAIR TABLE</code>, <code>ANALYZE TABLE</code> или <code>OPTIMIZE TABLE</code>.
Обработчик <code>INSERT DELAYED</code> завершил работу
со всеми вставками и ожидает новые.
</UL>

<P>
Большинство состояний - это очень быстрые операции. Если потоки остаются в
любом из этих состояний на протяжении большого количества секунд, то,
возможно, возникла какая-то проблема, которую следует устранить.

</P>
<P>
Существует еще несколько состояний, не упомянутых выше, но большинство из
них полезны только для поиска ошибок в <code>mysqld</code>.

</P>


<H4><A NAME="SHOW_GRANTS" HREF="manual.ru_toc.html#SHOW_GRANTS">4.5.6.7  <code>SHOW GRANTS</code></A></H4>

<P>
<A NAME="IDX632"></A>
<A NAME="IDX633"></A>

</P>
<P>
<A NAME="IDX634"></A>
<A NAME="IDX635"></A>

</P>
<P>
SHOW GRANTS FOR user выводит список команд назначения привилегий, которые
нужны при дублировании привилегий для пользователя.

</P>

<PRE>
mysql&#62; SHOW GRANTS FOR root@localhost;
+---------------------------------------------------------------------+
| Grants for root@localhost                                          |
+---------------------------------------------------------------------+
| GRANT ALL PRIVILEGES ON *.* TO 'root'&lacute;ocalhost' WITH GRANT OPTION |
+---------------------------------------------------------------------+
</PRE>

<P>
Для получения информации по привилегии в текущей сессии можно использовать
функцию <code>CURRENT_USER()</code> (новшество в версии 4.0.6) для того, чтобы
выяснить, по какому пользователю в действительности аутентифицировалась сессия.
See section <A HREF="manual.ru.html#Miscellaneous_functions">6.3.6.2  Разные функции</A>.

</P>



<H4><A NAME="SHOW_CREATE_TABLE" HREF="manual.ru_toc.html#SHOW_CREATE_TABLE">4.5.6.8  <code>SHOW CREATE TABLE</code></A></H4>

<P>
<A NAME="IDX636"></A>

</P>
<P>
Показывает оператор <code>CREATE TABLE</code>, который будет создавать данную таблицу:

</P>

<PRE>
mysql&#62; SHOW CREATE TABLE t\G
*************************** 1. row ***************************
Table: t
Create Table: CREATE TABLE t (
id int(11) default NULL auto_increment,
s char(60) default NULL,
PRIMARY KEY (id)
) TYPE=MyISAM
</PRE>

<P>
Команда  <code>SHOW CREATE TABLE</code>  будет выдавать таблицу и названия столбцов
в  соответствии с параметром <code>SQL_QUOTE_SHOW_CREATE</code>. See section <A HREF="manual.ru.html#SET_OPTION">5.5.6  Синтаксис команды <code>SET</code></A>.

</P>


<H4><A NAME="SHOW_WARNINGS" HREF="manual.ru_toc.html#SHOW_WARNINGS">4.5.6.9  <code>SHOW WARNINGS | ERRORS</code></A></H4>

<P>
<A NAME="IDX637"></A>

</P>

<PRE>
SHOW WARNINGS [LIMIT #]
SHOW ERRORS [LIMIT #]
</PRE>

<P>
Эта команда реализована в версии MySQL 4.1.0.

</P>
<P>
Команда показывает информацию по ошибкам, предупреждениям и сообщениям,
касающихся последней команды.  Эти сообщения сбрасываются для каждой новой
команды, использующей таблицы.

</P>
<P>
Сервер MySQL возвращает общее количество сообщений и ошибок, которые вы
получили для последней команды. Это количество можно получить вызовом
<code>mysql_warning_count()</code>.

</P>
<P>
Максимум <code>max_error_count</code> сообщений сохраняется (переменная глобальная и
специфичная для потока). 

</P>
<P>
Вы можете получить количество ошибок из  <code>@error_count</code> и количество
предупреждений из <code>@warning_count</code>.

</P>
<P>
<code>SHOW WARNINGS</code> сообщает все ошибки, предупреждения и заметки, которые вы получили 
для последней команды, в то время как <code>SHOW ERRORS</code> даешь лишь только информацию по 
ошибкам. 

</P>

<PRE>
mysql&#62; DROP TABLE IF EXISTS нет_такой_таблицы;
mysql&#62; SHOW WARNINGS;

+-------+------+-----------------------------------+
| Level | Code | Message                           |
+-------+------+-----------------------------------+
| Note  | 1051 | Unknown table 'нет_такой_таблицы' |
+-------+------+-----------------------------------+
</PRE>



<H4><A NAME="SHOW_TABLE_TYPES" HREF="manual.ru_toc.html#SHOW_TABLE_TYPES">4.5.6.10  <code>SHOW TABLE TYPES</code></A></H4>

<P>
<A NAME="IDX638"></A>

</P>

<PRE>
SHOW TABLE TYPES
</PRE>

<P>
Эта команда реализована в 4.1.0.

</P>
<P>
<code>SHOW TABLE TYPES</code> дает статусную информацию про типы таблиц.  Эта
информация полезна, например, для проверки, поддерживается ли определенный тип
таблицы или для того чтобы узнать, какой тип таблиц используется по умолчанию. 

</P>

<PRE>
mysql&#62; SHOW TABLE TYPES;

+--------+---------+----------------------------------------------------------------+
| Type   | Support | Comment                                                        |
+--------+---------+----------------------------------------------------------------+
| MyISAM | DEFAULT | Основной тип для 3.23 с отличной производительностью           | 
| HEAP   | YES     | Хеш-тип, хранится только в памяти, полезен для временных таблиц|
| MERGE  | YES     | Набор идентичных MyISAM-таблиц                                 |
| ISAM   | YES     | Старый тип; замещен MyISAM                                     |
| InnoDB | YES     | Поддерживает транзакции, строчную блокировку и внешние ключи   |
| BDB    | NO      | Поддерживает транзакции и страничную блокировку                |
+--------+---------+----------------------------------------------------------------+
6 rows in set (0.00 sec)
</PRE>

<P>
Опция <code>DEFAULT</code> в столбце <code>Support</code> указывает, что данный конкретный
тип таблицы поддерживается и является принятым по умолчанию. Если сервер был
запущен с <code>--default-table-type=InnoDB</code>, тогда для InnoDB столбец
<code>Support</code> примет значение <code>DEFAULT</code>. 

</P>



<H4><A NAME="SHOW_PRIVILEGES" HREF="manual.ru_toc.html#SHOW_PRIVILEGES">4.5.6.11  <code>SHOW PRIVILEGES</code></A></H4>

<P>
<A NAME="IDX639"></A>

</P>

<PRE>
SHOW PRIVILEGES
</PRE>

<P>
Эта команда реализована в MySQL 4.1.0.

</P>
<P>
<code>SHOW PRIVILEGES</code> показывает список системных привилегий, 
которые поддерживаются сервером MySQL. 

</P>

<PRE>
mysql&#62; show privileges;
+------------+--------------------------+-------------------------------------------------------+
| Privilege  | Context                  | Comment                                               |
+------------+--------------------------+-------------------------------------------------------+
| Select     | Tables                   | To retrieve rows from table                           |
| Insert     | Tables                   | To insert data into tables                            |
| Update     | Tables                   | To update existing rows                               |
| Delete     | Tables                   | To delete existing rows                               |
| Index      | Tables                   | To create or drop indexes                             |
| Alter      | Tables                   | To alter the table                                    |
| Create     | Databases,Tables,Indexes | To create new databases and tables                    |
| Drop       | Databases,Tables         | To drop databases and tables                          |
| Grant      | Databases,Tables         | To give to other users those privileges you possess   |
| References | Databases,Tables         | To have references on tables                          |
| Reload     | Server Admin             | To reload or refresh tables, logs and privileges      |
| Shutdown   | Server Admin             | To shutdown the server                                |
| Process    | Server Admin             | To view the plain text of currently executing queries |
| File       | File access on server    | To read and write files on the server                 |
+------------+--------------------------+-------------------------------------------------------+
14 rows in set (0.00 sec)
</PRE>

<P>
Этот же пример в переводе на русский язык: 

</P>

<PRE>
mysql&#62; show privileges;
+------------+--------------------------+-------------------------------------------------------+
| Привилегия | Контекст                 | Описание                                              |
+------------+--------------------------+-------------------------------------------------------+
| Select     | Таблица                  | Для выборки строк из таблицы                          |
| Insert     | Таблица                  | Для вставки данных в таблицы                          |
| Update     | Таблица                  | Для обновления существующих записей                   |
| Delete     | Таблица                  | Для удаления существующих записей                     |
| Index      | Таблица                  | Для создания или удаления индексов                    |
| Alter      | Таблица                  | Для изменения таблиц                                  |
| Create     | База,Таблица,Индекс      | Для создания новых баз данных и таблиц                |
| Drop       | База,Таблица             | Для удаления баз данных и таблиц                      |
| Grant      | База,Таблица             | Для раздачи другим пользователям имеющихся у вас прав |
| References | База,Таблица             | Для обладания ссылок на таблицы                       |
| Reload     | Администрирование        | Для обновления таблиц, журналов и привилегий          |
| Shutdown   | Администрирование        | Для остановки сервера                                 |
| Process    | Администрирование        | Для просмотра текста выполняющихся запросов           |
| File       | Доступ к файлам          | Для чтения и записи файлов на сервере                 |
+------------+--------------------------+-------------------------------------------------------+
14 rows in set (0.00 sec)
</PRE>



<H2><A NAME="Localisation" HREF="manual.ru_toc.html#Localisation">4.6  Локализация MySQL и использование национальных алфавитов</A></H2>



<H3><A NAME="Character_sets" HREF="manual.ru_toc.html#Character_sets">4.6.1  Набор символов, применяющийся для записи данных и сортировки</A></H3>

<P>
<A NAME="IDX640"></A>
<A NAME="IDX641"></A>
<A NAME="IDX642"></A>
<A NAME="IDX643"></A>
<A NAME="IDX644"></A>
<A NAME="IDX645"></A>

</P>
<P>
По умолчанию в MySQL используется набор символов ISO-8859-1 (Latin1) с
сортировкой согласно шведским/финским правилам. Этот набор символов также
подходит для использования в США и Западной Европе.

</P>
<P>
Все стандартные исполняемые файлы MySQL компилируются с настройкой
<code>--with-extra-charsets=complex</code>. Таким образом в файл помещается код,
позволяющий всем стандартным программам работать с набором символов
<code>latin1</code>, а также многобайтовыми наборами символов. Другие наборы символов
могут загружаться из соответствующих файлов определений по необходимости.

</P>
<P>
Набор определяет, какие символы могут использоваться в именах, а также
способ сортировки значений в операторах <code>ORDER BY</code> и <code>GROUP BY</code> команды
<code>SELECT</code>.

</P>
<P>
При запуске сервера можно изменить набор символов при помощи параметра
<code>--default-character-set</code>. Выбрать доступные наборы символов можно при
помощи параметров <code>--with-charset=charset</code> и <code>--with-extra-charsets=
список-кодировок | complex | all</code>, и файлов наборов символов, перечисленных
в <code>SHAREDIR/charsets/Index</code>. See section <A HREF="manual.ru.html#configure_options">2.3.3  Типичные опции <code>configure</code></A>.

</P>
<P>
При смене набора символов во время работы MySQL (что может одновременно
изменить и порядок сортировки) необходимо запустить команду <code>myisamchk -r
-q --set-character-set=charset</code> для всех таблиц. В противном случае индексы
могут быть созданы в неправильном порядке.

</P>
<P>
При подключении клиента к серверу MySQL сервер отправляет ему используемый
по умолчанию набор символов. На время соединения клиент переключается на
использование этого набора.

</P>
<P>
Для экранирования строк в SQL-запросе необходимо пользоваться функцией
<code>mysql_real_escape_string()</code>. <code>mysql_real_escape_string()</code> идентична старой
функции <code>mysql_escape_string()</code> - во всем, кроме одного: в качестве первого
параметра она принимает дескриптор соединения MYSQL.

</P>
<P>
Если клиент был скомпилирован с набором путей, в которых не было пути
установки сервера, а настраивавший MySQL пользователь на включил в
исполняемый файл системы все наборы символов, клиенту необходимо сообщить
о местонахождении дополнительных наборов символов, которые нужны ему для
общения с сервером.

</P>
<P>
Сделать это можно путем внесения в файл настроек MySQL следующей строки:

</P>

<PRE>
[client]
character-sets-dir=/usr/local/mysql/share/mysql/charsets
</PRE>

<P>
путь в ней указывает на каталог, в котором хранятся динамические наборы
символов MySQL.

</P>
<P>
Заставить клиента использовать определенный набор символов можно следующим
образом:

</P>

<PRE>
[client]
default-character-set=character-set-name
</PRE>

<P>
но обычно этого не требуется.

</P>



<H4><A NAME="German_character_set" HREF="manual.ru_toc.html#German_character_set">4.6.1.1  Набор символов немецкого алфавита</A></H4>

<P>
Для задания порядка сортировки в соответствии с немецким алфавитом нужно
запустить <code>mysqld</code> с параметром <code>--default-character-set=latin1_de</code>.

</P>
<P>
При сортировке и сравнении строк осуществляется следующая подстановка:

</P>

<PRE>
Д  -&#62;  ae
Ж  -&#62;  oe
Э  -&#62;  ue
ъ  -&#62;  ss
</PRE>

<P>
Все символы с диакритическими знаками заменяются их аналогами из верхнего
регистра и без ударения. Все буквы переводятся в верхний регистр.

</P>
<P>
При сравнении строк с помощью команды <code>LIKE</code>, подстановки двух символов
вместо одного не происходит. Все буквы переводятся в верхний регистр.
Диакритические знаки снимаются со всех букв, кроме: <code>э</code>, <code>Э</code>, <code>ж</code>, <code>Ж</code>, <code>д</code> и <code>Д</code>.

</P>


<H3><A NAME="Languages" HREF="manual.ru_toc.html#Languages">4.6.2  Сообщения об ошибках на языках, отличных от английского</A></H3>

<P>
<A NAME="IDX646"></A>
<A NAME="IDX647"></A>
<A NAME="IDX648"></A>
<A NAME="IDX649"></A>

</P>
<P>
<code>mysqld</code> может выдавать сообщения об ошибках на следующих языках: чешском,
датском, голландском, английском (по умолчанию), эстонском, французском,
немецком, греческом, венгерском, итальянском, японском, корейском,
норвежском, новонорвежском, польском, португальском, румынском, русском,
словацком, испанском и шведском.

</P>
<P>
При запуске <code>mysqld</code> выбрать определенный язык можно при помощи настройки
<code>--language=язык</code> или <code>-L язык</code>. Например:

</P>

<PRE>
shell&#62; mysqld --language=swedish
или:
shell&#62; mysqld --language=/usr/local/share/swedish
</PRE>

<P>
Обратите внимание: названия языков вводятся в нижнем регистре.

</P>
<P>
Файлы языков по умолчанию располагаются в папке
<tt>`<var>mysql_base_dir</var>/share/<var>LANGUAGE</var>/'</tt>.

</P>
<P>
Для того чтобы изменить тексты сообщений об ошибках, нужно отредактировать
файл <tt>`errmsg.txt'</tt> и запустить следующую команду для генерации нового файла
<tt>`errmsg.sys'</tt>:

</P>

<PRE>
shell&#62; comp_err errmsg.txt errmsg.sys
</PRE>

<P>
Установив новую версию MySQL, не забудьте внести те же изменения в новый
файл <tt>`errmsg.txt'</tt>.

</P>


<H3><A NAME="Adding_character_set" HREF="manual.ru_toc.html#Adding_character_set">4.6.3  Добавление набора символов</A></H3>

<P>
<A NAME="IDX650"></A>
<A NAME="IDX651"></A>
<A NAME="IDX652"></A>
<A NAME="IDX653"></A>

</P>
<P>
Снабдить MySQL новым набором символов можно следующим образом.

</P>
<P>
Определите, является ли новый набор символов простым или сложным. Если для
работы с этим набором никаких специальных процедур обработки строк и
поддержки многобайтовых символов не требуется, он является простым. Если
вышеперечисленные возможности необходимы, этот набор символов относится к
сложным.

</P>
<P>
Например, наборы <code>latin1</code> и <code>danish</code> - простые, а <code>big5</code> и <code>czech</code> - сложные.

</P>
<P>
Для всех приведенных ниже примеров предполагается, что используемый набор
символов называется <code>MYSET</code>.

</P>
<P>
Для создания простого набора достаточно сделать следующее:

</P>

<OL>
<LI>

Вставьте имя <code>MYSET</code> в конец файла <tt>`sql/share/charsets/Index'</tt> и присвойте
этому набору символов уникальный номер.

<LI>

Создайте файл <tt>`sql/share/charsets/MYSET.conf'</tt>. (в качестве основы можно
использовать файл <tt>`sql/share/charsets/latin1.conf'</tt>). Правила составления
этого файла очень просты:


<UL>
<LI>

Комментарием считается целая строка, начинающаяся с символа <samp>`#'</samp>.

<LI>

Слова разделяются любым количеством непечатаемых символов.

<LI>

При определении набора символов каждое слово должно представлять собой
число в шестнадцатеричной системе счисления.

<LI>

Массив ctype занимает первых 257 слов. За ним следуют массивы
<code>to_lower</code>, <code>to_upper[]</code> и <code>sort_order[]</code>, каждый из которых занимает 256 слов.
</UL>

See section <A HREF="manual.ru.html#Character_arrays">4.6.4  Массивы определения символов</A>.

<LI>

Добавьте имя набора символов в списки <code>CHARSETS_AVAILABLE</code> и
<code>COMPILED_CHARSETS</code> файла <tt>`configure.in'</tt>.

<LI>

Перенастройте, перекомпилируйте и протестируйте систему.

</OL>

<P>
Для создания сложного набора необходимо выполнить следующие действия:

</P>

<OL>
<LI>

Создайте файл strings/ctype-MYSET.c в исходном дистрибутиве MySQL.

<LI>

Вставьте имя MYSET в конец файла sql/share/charsets/Index и присвойте
этому набору символов уникальный номер.

<LI>

Просмотрите один из существующих файлов ctype-*.c
(например strings/ctype-big5.c) и узнайте, что нужно определить. Не
забывайте, что имена массивов в вашем файле должны быть похожи на
следующие: ctype_MYSET, to_lower_MYSET и т.п. Эти имена соответствуют
именам массивов из простого набора символов (see section <A HREF="manual.ru.html#Character_arrays">4.6.4  Массивы определения символов</A>).

<LI>

В начале файла целесообразно поместить комментарий наподобие
следующего:


<PRE>
/*
этот комментарий разбирается configure для создания ctype.c,
поэтому не меняйте его, если не уверены в правильности своих действий.
*
.configure. number_MYSET=MYNUMBER
.configure. strxfrm_multiply_MYSET=N
.configure. mbmaxlen_MYSET=N
*/
</PRE>

Программа configure использует этот комментарий для линкования набора
символов с библиотекой MySQL. Значение строк strxfrm_multiply и mbmaxlen
будет разъяснено ниже. Использовать их нужно только в том случае, если вам
нужны функции для сортировки строк или работы с многобайтовыми наборами
символов соответственно.

<LI>

После этого нужно создать некоторые из следующих функций:


<UL>
<LI><code>my_strncoll_MYSET()</code>

<LI><code>my_strcoll_MYSET()</code>

<LI><code>my_strxfrm_MYSET()</code>

<LI><code>my_like_range_MYSET()</code>

</UL>

See section <A HREF="manual.ru.html#String_collating">4.6.5  Поддержка упорядочивания строк</A>.

<LI>

Добавьте имя набора символов в списки <code>CHARSETS_AVAILABLE</code> и
<code>COMPILED_CHARSETS</code> файла <tt>`configure.in'</tt>.

<LI>

Перенастройте, перекомпилируйте и протестируйте систему.
</OL>

<P>
Более подробные инструкции приведены в файле <tt>`sql/share/charsets/README'</tt>.

</P>
<P>
Если вы хотите, чтобы ваш набор символов был включен в комплект поставки
MySQL, вышлите патч с ним по адресу <a HREF="mailto:internals@lists.mysql.com">internals@lists.mysql.com</a>.

</P>


<H3><A NAME="Character_arrays" HREF="manual.ru_toc.html#Character_arrays">4.6.4  Массивы определения символов</A></H3>

<P>
<A NAME="IDX654"></A>
<A NAME="IDX655"></A>

</P>
<P>
Простые массивы <code>to_lower[]</code> и <code>to_upper[]</code> содержат символы верхнего и
нижнего регистров, соответствующие каждому из символов набора. Например:

</P>

<PRE>
to_lower['A'] should contain 'a'
to_upper['a'] should contain 'A'
</PRE>

<P>
<code>sort_order[]</code> - карта, устанавливающая правила упорядочивания символов для
сравнения и сортировки. Во многих наборах символов эта таблица совпадает с
<code>to_upper[]</code> (благодаря чему при сортировке регистр символов не
учитывается). MySQL сортирует символы в соответствии со значением
<code>sort_order[символ]</code>. Более сложные правила упорядочивания строк
разъясняются ниже. See section <A HREF="manual.ru.html#String_collating">4.6.5  Поддержка упорядочивания строк</A>.

</P>
<P>
<code>ctype[]</code> представляет собой массив битов, по одному элементу на каждый из
символов. (Массивы <code>to_lower[]</code>, <code>to_upper[]</code>, и <code>sort_order[]</code> индексируются по
значению символа, а <code>ctype[]</code> - по значению символа + 1. Это позволяет
обрабатывать символы <code>EOF</code>).

</P>
<P>
В файле <tt>`m_ctype.h'</tt> приведены следующие определения битовых масок:

</P>

<PRE>
#define _U 01 /* верхний регистр */
#define _L 02 /* нижний регистр */
#define _N 04 /* число (цифра) */
#define _S 010 /* символ пробела */
#define _P 020 /* знак пунктуации */
#define _C 040 /* управляющий символ */
#define _B 0100 /* пустой символ */
#define _X 0200 /* шестнадцатеричная цифра */
</PRE>

<P>
Значение <code>ctype[]</code> для каждого из символов должно представлять собой
объединение значений битовых масок, описывающих символ. Например, <code>'A'</code> 
представят собой символ верхнего регистра (<code>_U</code>) а также шестнадцатеричную
цифру (<code>_X</code>), поэтому элемент <code>['A'+1]</code> должен содержать значение:

</P>

<PRE>
_U + _X = 01 + 0200 = 0201
</PRE>



<H3><A NAME="String_collating" HREF="manual.ru_toc.html#String_collating">4.6.5  Поддержка упорядочивания строк</A></H3>

<P>
<A NAME="IDX656"></A>
<A NAME="IDX657"></A>

</P>
<P>
Если правила сортировки вашего естественного языка слишком сложны и не
могут быть заданы с помощью простой таблицы <code>sort_order</code>[], необходимо
использовать функции упорядочивания строк.

</P>
<P>
В настоящее время лучшим справочным пособием по этому вопросу являются уже
реализованные наборы символов. Примером такой реализации могут служить
наборы <code>big5</code>, <code>czech</code>, <code>gbk</code>, <code>sjis</code> и <code>tis160</code>.

</P>
<P>
В начале файла в особом комментарии необходимо указать значение
<code>strxfrm_multiply_MYSET=N</code>. Значение <code>N</code> представляет собой максимальный
прирост объема строк во время <code>my_strxfrm_MYSET</code> (т.е. положительное целое
число).

</P>


<H3><A NAME="Multi-byte_characters" HREF="manual.ru_toc.html#Multi-byte_characters">4.6.6  Поддержка многобайтовых символов</A></H3>

<P>
<A NAME="IDX658"></A>
<A NAME="IDX659"></A>

</P>
<P>
При желании обеспечить поддержку нового набора, содержащего многобайтовые
символы, нужно пользоваться специальными функциями для работы с
многобайтовыми символами.

</P>
<P>
В настоящее время лучшим справочным пособием по этому вопросу являются уже
реализованные наборы символов. Примером такой реализации могут служить
наборы <code>euc_kr</code>, <code>gb2312</code>, <code>gbk</code>, <code>sjis</code> и <code>ujis</code>. Они реализованы в файлах
<tt>`ctype-'charset'.c'</tt>, расположенных в папке <tt>`strings'</tt>.

</P>
<P>
В начале файла в особом комментарии необходимо указать значение
<code>strxfrm_multiply_MYSET=N</code>. Значение <code>N</code> должно содержать объем самого
``большого'' символа набора в байтах.

</P>


<H3><A NAME="Problems_with_character_sets" HREF="manual.ru_toc.html#Problems_with_character_sets">4.6.7  Проблемы с наборами символов</A></H3>

<P>
При попытке воспользоваться набором символов, не включенным в исполняемый
файл, можно столкнуться со следующими неприятностями:

</P>

<UL>
<LI>

В программе задан неверный путь к каталогу, в котором хранятся наборы
символов (по умолчанию это <tt>`/usr/local/mysql/share/mysql/charsets'</tt>).
Данную  проблему можно решить с помощью настройки
<code>--character-sets-dir</code>.
<LI>

Набор символов является многобайтовым и не может быть загружен
динамически. В таком случае нужно перекомпилировать программу и
включить в нее поддержку нужного набора.
<LI>

Набор символов может быть загружен динамически, но конфигурационного
файла для него нет. В таком случае нужно скопировать файл для этого
набора из нового дистрибутива MySQL.
<LI>

В файле <tt>`Index'</tt> нет имени набора символов.


<PRE>
ERROR 1105: File '/usr/local/share/mysql/charsets/?.conf' not found (Errcode: 2)
</PRE>

В таком случае нужно либо установить новый файл <tt>`Index'</tt> или вручную внести в
него недостающие имена наборов.

</UL>

<P>
Узнать имя набора символов таблиц <code>MyISAM</code> можно с помощью команды <code>myisamchk
-dvv table_name</code>.

</P>


<H2><A NAME="Server-Side_Scripts" HREF="manual.ru_toc.html#Server-Side_Scripts">4.7  Серверные сценарии и утилиты MySQL</A></H2>



<H3><A NAME="Server-Side_Overview" HREF="manual.ru_toc.html#Server-Side_Overview">4.7.1  Обзор серверных сценариев и утилит</A></H3>

<P>
<A NAME="IDX660"></A>
<A NAME="IDX661"></A>

</P>
<P>
Все программы MySQL имеют множество различных опций. При этом каждая
программа MySQL поддерживает опцию <code>--help</code>, которую можно использовать
для получения полного описания различных опций программы. Например,
попробуйте выполнить <code>mysql --help</code>.

</P>
<P>
Заданные по умолчанию опции для всех стандартных программ можно
переопределять при помощи файла опций. See section <A HREF="manual.ru.html#Option_files">4.1.2  Файлы параметров <tt>`my.cnf'</tt></A>.

</P>
<P>
В следующем списке приводятся краткие описания серверных программ MySQL:

</P>
<DL COMPACT>

<DT><code>myisamchk</code>
<DD>
<A NAME="IDX662"></A>
 
Утилита, используемая для описания, проверки, оптимизации и восстановления
таблиц MySQL. Поскольку утилита <code>myisamchk</code> имеет много функций, она
описывается в отдельном разделе. See section <A HREF="manual.ru.html#MySQL_Database_Administration">4  Администрирование баз данных</A>.

<A NAME="IDX663"></A>
<DT><code>make_binary_distribution</code>
<DD>
Создает бинарную поставку откомпилированного кода MySQL. Эту версию при
помощи <code>FTP</code> можно передать на сайт <code>support.mysql.com</code> в директорию
<tt>`/pub/mysql/Incoming'</tt>, чтобы ею могли воспользоваться и другие пользователи
MySQL.

<A NAME="IDX664"></A>
<DT><code>mysqlbug</code>
<DD>
Сценарий, составляющий отчет о возникшей в MySQL неполадке. Этот сценарий
должен всегда использоваться для составления отчета для почтового списка
рассылки MySQL.

<A NAME="IDX665"></A>
<DT><code>mysqld</code>
<DD>
Сам сервер MySQL, демон. Он должен работать постоянно.

<A NAME="IDX666"></A>
<DT><code>mysql_install_db</code>
<DD>
Создает таблицы привилегий MySQL с заданными по умолчанию привилегиями.
Это обычно делается только один раз, при первой инсталляции MySQL в
системе.

</DL>



<H3><A NAME="safe_mysqld" HREF="manual.ru_toc.html#safe_mysqld">4.7.2  <code>safe_mysqld</code>, оболочка <code>mysqld</code></A></H3>

<P>
<A NAME="IDX667"></A>
<A NAME="IDX668"></A>
<A NAME="IDX669"></A>
<A NAME="IDX670"></A>

</P>
<P>
В MySQL 4.0 <code>safe_mysqld</code> был переименован в <code>mysqld_safe</code>.

</P>
<P>
<code>safe_mysqld</code> - это сценарий, с помощью которого рекомендуется запускать
демон mysqld на Unix. <code>safe_mysqld</code> служит для реализации неких
дополнительных функций безопасности для <code>mysqld</code>, таких как возможность
перезапуска сервера при обнаружении ошибки и записи в журнал информации о
процессе работы <code>mysqld</code>.

</P>
<P>
Если не указаны опции <code>--mysqld=#</code> или <code>--mysqld-version=#</code>,  <code>safe_mysqld</code> 
будет использовать исполняемый файл <code>mysqld</code>-max, если последний существует.
Если <code>mysqld-max</code> не существует, <code>safe_mysqld</code> запустит <code>mysqld</code>. Это позволяет
легко выяснить, что даст использование <code>mysqld-max</code> вместо <code>mysqld</code>: просто
скопируйте <code>mysqld-max</code> поверх <code>mysqld</code>, и он будет работать.

</P>
<P>
Как правило, редактировать сценарий <code>safe_mysqld</code> не следует, однако можно
указать опции для <code>safe_mysqld</code>, поместив их в раздел <code>[safe_mysqld]</code> файла
<tt>`my.cnf'</tt>. <code>safe_mysqld</code> будет считывать все опции из разделов файлов опций
<code>[mysqld]</code>, <code>[server]</code> и <code>[safe_mysqld]</code>. See section <A HREF="manual.ru.html#Option_files">4.1.2  Файлы параметров <tt>`my.cnf'</tt></A>.

</P>
<P>
Обратите внимание: все опции, которые вводятся в командной строке для
<code>safe_mysqld</code>, передаются <code>mysqld</code>. Если требуется применить в <code>safe_mysqld</code>
какие-либо опции, которые <code>mysqld</code> не поддерживает, эти опции нужно
определить в файле опций.

</P>
<P>
Большинство опций <code>safe_mysqld</code> - те же, что и у <code>mysqld</code>. See section <A HREF="manual.ru.html#Command-line_options">4.1.1  Параметры командной строки <code>mysqld</code></A>.

</P>
<P>
<code>Safe_mysqld</code> поддерживает следующие опции:

</P>
<DL COMPACT>

<DT><code>--basedir=path</code>
<DD>
<DT><code>--core-file-size=#</code>
<DD>
Размер <code>core</code>-файла который может быть создан <code>mysqld</code>. Значение передается <code>ulimit -c</code> 
<DT><code>--datadir=path</code>
<DD>
<DT><code>--defaults-extra-file=path</code>
<DD>
<DT><code>--defaults-file=path</code>
<DD>
<DT><code>--err-log=path  (устарело в 4.0; Используйте --log-error вместо)</code>
<DD>
<DT><code>--log-error=path</code>
<DD>
Писать журнал ошибок в указанный файл. See section <A HREF="manual.ru.html#Error_log">4.9.1  Журнал ошибок</A>.
<DT><code>--ledir=path</code>
<DD>
Путь к <code>mysqld</code>
<DT><code>--log=path</code>
<DD>
<DT><code>--mysqld=mysqld-version</code>
<DD>
Имя версии <code>mysqld</code>, которую вы хотите запустить в директории <tt>`ledir'</tt>
<DT><code>--mysqld-version=version</code>
<DD>
То же, что и <code>--mysqld=</code>, но в этой опции задается только суффикс для
<code>mysqld</code>. Например, если используется <code>--mysqld-version=max</code>, <code>safe_mysqld</code>
запустит версию <code>ledir/mysqld-max</code>. Если задать <code>--mysqld-version</code> без
аргумента, будет использоваться <code>ledir/mysqld</code>.
<DT><code>--no-defaults</code>
<DD>
<DT><code>--open-files-limit=#</code>
<DD>
Максимальное количество файлов, которые могут быть открыты <code>mysqld</code>.
Значение передается <code>ulimit -n</code>. Обратите внимание: чтобы эта опция работала
корректно, необходимо запустить <code>safe_mysqld</code> от пользователя root!
<DT><code>--pid-file=path</code>
<DD>
<DT><code>--port=#</code>
<DD>
<DT><code>--socket=path</code>
<DD>
<DT><code>--timezone=#</code>
<DD>
Устанавливает переменную часового пояса (<code>TZ</code>) в значение, передаваемое в
этом параметре.
<DT><code>--user=#</code>
<DD>
</DL>

<P>
Сценарий <code>safe_mysqld</code> написан таким образом, чтобы можно было запустить
сервер, инсталлированный как из исходного кода, так и из бинарной поставки
MySQL, даже если компоненты сервера, в зависимости от используемой
инсталляции, будут размещены несколько по-другому. Для <code>safe_mysqld</code>
требуется выполнение одного из следующих условий:

</P>

<UL>
<LI>

Сервер и базы данных можно обнаружить относительно каталога, в котором
вызывается <code>safe_mysqld</code>. <code>safe_mysqld</code> ищет в своей рабочей директории
<tt>`bin'</tt> и <tt>`data'</tt> (для бинарных дистрибутивов) или <tt>`libexec'</tt> и <tt>`var'</tt> (для
дистрибутивов с исходным кодом). Это условие должно выполняться, если
<code>safe_mysqld</code> запускается из директории, в которую инсталлирован MySQL
(например <tt>`/usr/local/mysql'</tt> для бинарного дистрибутива).

<LI>

Если сервер и базы данных не могут быть найдены относительно рабочей
директории, <code>safe_mysqld</code> пытается найти их по абсолютным путям.
Типичные местоположения - <tt>`/usr/local/libexec'</tt> и <tt>`/usr/local/var'</tt>.
Действительные местоположения определяются при создании дистрибутива,
из которого запускается <code>safe_mysqld</code>. Они должны быть корректными, если
MySQL был инсталлирован в стандартное местоположение.
</UL>

<P>
Поскольку <code>safe_mysqld</code> будет пытаться найти сервер и базы данных
относительно собственной рабочей директории, можно инсталлировать двоичный
дистрибутив MySQL куда угодно, при условии, что <code>safe_mysqld</code> будет
запускаться из директории, в которой установлен MySQL:

</P>

<PRE>
shell&#62; cd mysql_installation_directory
shell&#62; bin/safe_mysqld &#38;
</PRE>

<P>
Если <code>safe_mysqld</code> не может запустить сервер, даже в том случае, когда он
вызывается из инсталляционной директории MySQL, сценарий <code>safe_mysqld</code> можно
модифицировать так, чтобы он использовал верный путь к <code>mysqld</code> и опции
путей, которые являются правильными для вашей системы. Обратите внимание:
если в будущем вы будете делать апгрейд MySQL, новая версия <code>safe_mysqld</code>
будет записана поверх старой, поэтому нужно сделать копию
отредактированной версии, которую вы сможете затем установить повторно.

</P>


<H3><A NAME="mysqld_multi" HREF="manual.ru_toc.html#mysqld_multi">4.7.3  <code>Mysqld_multi</code>, программа для управления множеством серверов MySQL</A></H3>

<P>
<A NAME="IDX671"></A>
<A NAME="IDX672"></A>
<A NAME="IDX673"></A>
<A NAME="IDX674"></A>

</P>
<P>
Программа <code>mysqld_multi</code> предназначена для управления несколькими процессами
<code>mysqld</code>, работающих на различных сокетах Unix и портах TCP/IP.

</P>
<P>
Программа будет искать группу(группы) <code>[mysqld#]</code> в <tt>`my.cnf'</tt> (или
заданных при помощи <code>--config-file=...</code> файлах), где <code>#</code> - любое
положительное число, начиная с 1. Мы говорим про этот номер далее как про номер
группы опций, или GNR. Номера групп различают группы опций одну от другой и
используются как аргумент при запуске <code>mysqld_multi</code> чтобы указать, какие сервера
вы хотите запустить, остановить или получить статус об.  Эти группы должны быть
такими же, как и обычная группа <code>[mysqld</code>] (например содержать опции для
<code>mysqld</code>; см. в руководстве более подробную информацию), но с такими
портом, сокетом и т.д., которые требуются для каждого отдельного процесса
<code>mysqld</code>.

</P>
<P>
<code>mysqld_multi</code> запускается в таком синтаксисе:

<PRE>
Использование: mysqld_multi [OPTIONS] {start|stop|report} [GNR,GNR,GNR...]
или            mysqld_multi [OPTIONS] {start|stop|report} [GNR-GNR,GNR,GNR-GNR,...]
</PRE>

<P>
GNR здесь означает номер группы. Можно запускать, останавливать или
создавать отчеты о любом GNR, или о нескольких из них одновременно. Получить
пример о том, как бы вы могли настроить файл опций, можно так: 

</P>

<PRE>
shell&#62; mysqld_multi --example
</PRE>

<P>
В качестве разделителей в списке GNR применяются запятые,
комбинации создаются при помощи тире. Последнее означает, что будут
задействованы все номера GNR из диапазона GNR1-GNR2. Если не задан
аргумент GNR, то все группы будут либо запущены, либо остановлены, либо
будет выведен отчет об этих группах. Обратите внимание, что в списке GNR
не должно быть никаких пропусков (пробелов, символов табуляции или пустых
строк). Любые данные после пропуска будут игнорироваться.

</P>
<P>
mysqld_multi поддерживает следующие опции:

</P>
<DL COMPACT>

<DT><code>--config-file=...</code>
<DD>
<A NAME="IDX675"></A>
 
Альтернативный файл конфигурации (<code>config file</code>). Примечание: данный файл
не влияет на собственные опции этой программы (группа <code>[mysqld_multi]</code>), а
только на группы <code>[mysqld#]</code>. Без этой опции поиск всех данных будет
осуществляться только в обычном файле <tt>`my.cnf'</tt>.

<A NAME="IDX676"></A>
<DT><code>--example</code>
<DD>
Представляет пример файла конфигурации.

<A NAME="IDX677"></A>
<DT><code>--help</code>
<DD>
Выводит справочную информацию и завершает работу.

<A NAME="IDX678"></A>
<DT><code>--log=...</code>
<DD>
Файл журнала. Имя файла журнала и полный путь к нему. Примечание: если
файл существует, записи будут добавляться в конец файла.

<A NAME="IDX679"></A>
<DT><code>--mysqladmin=...</code>
<DD>
Исполняемый файл <code>mysqladmin</code>, используемый для завершения работы сервера.

<A NAME="IDX680"></A>
<DT><code>--mysqld=...</code>
<DD>
Исполняемый файл <code>mysqld</code>, который будет использоваться. Обратите внимание:
в этой опции можно также указывать <code>safe_mysqld</code>. Опции передаются <code>mysqld</code>.
Необходимо только удостовериться, что в переменной окружения PATH  имеется
<code>mysqld</code> или что установлен <code>safe_mysqld</code>.

<A NAME="IDX681"></A>
<DT><code>--no-log</code>
<DD>
Вывод в <code>stdout</code> вместо журнала. По умолчанию журналы включены.

<A NAME="IDX682"></A>
<DT><code>--password=...</code>
<DD>
Пароль пользователя для доступа к <code>mysqladmin</code>.

<A NAME="IDX683"></A>
<DT><code>--tcp-ip</code>
<DD>
Подсоединение к серверу(ам) MySQL по TCP/IP вместо Unix-сокетов. Данная
опция влияет на завершение работы сервера и создание отчетов. Если файл
сокета отсутствует, сервер будет работать, но к нему можно будет
обращаться только через порт TCP/IP. По умолчанию соединение
осуществляется через сокет Unix.

<A NAME="IDX684"></A>
<DT><code>--user=...</code>
<DD>
Имя пользователя MySQL для <code>mysqladmin</code>.

<A NAME="IDX685"></A>
<DT><code>--version</code>
<DD>
Вывод номера версии и завершение работы.
</DL>

<P>
Некоторые примечания относительно mysqld_multi:

</P>

<UL>
<LI>

Удостоверьтесь, что пользователь MySQL, останавливающий <code>mysqld</code>
(например, при помощи <code>mysqladmin</code>), имеет один пароль и имя
пользователя для всех директорий данных, к которым производится доступ
(имеется в виду - к базе данных <code>mysql</code>). Убедитесь также, что
пользователь имеет привилегию <code>Shutdown_priv</code>! Если имеется несколько
директорий с данными и несколько различных баз данных <code>mysql</code> с
различными паролями для пользователя <code>root</code> в MySQL, можно создать
некоего общего пользователя <code>multi_admin</code> для всех, с одинаковым паролем
(см. ниже). Сделать это можно так:


<PRE>
shell&#62; mysql -u root -S /tmp/mysql.sock -proot_password -e
"GRANT SHUTDOWN ON *.* TO multi_admin@localhost IDENTIFIED BY
</PRE>

See section <A HREF="manual.ru.html#Privileges">4.2.6  Как работает система привилегий</A>.
Эти действия нужно выполнять для каждого <code>mysqld</code> для каждой имеющейся
директории данных (для этого нужно выбрать другой сокет <code>-S=...</code>).

<LI>

<tt>`pid-файл'</tt> играет очень важную роль, если для запуска <code>mysqld</code> используется
сценарий <code>safe_mysqld</code> (например, <code>--mysqld=safe_mysqld</code>). Преимущество
использования <code>safe_mysqld</code> вместо <code>mysqld</code> заключается в том, что <code>safe_mysqld</code>
``бережет'' каждый процесс <code>mysqld</code> и перезапустит его, если <code>mysqld</code>-процесс
умрет по сигналу 9 или подобному (например, в случае ошибки сегментации -
хотя, конечно, уж этой ошибки MySQL в принципе совершать не должен;).
Пожалуйста, обратите внимание: может оказаться, что сценарий <code>safe_mysqld</code>
требуется запускать из определенного каталога. Это означает, что прежде
чем запустить <code>mysqld_multi</code>, прийдется перейти в нужный каталог. Если при
запуске возникнут проблемы, пожалуйста, просмотрите сценарий <code>safe_mysqld</code>.
Обратите внимание на следующие строки:


<PRE>
--------------------------------------------------------------------------
MY_PWD=`pwd` Check if we are starting this relative (for the binary
release) if test -d /data/mysql -a -f ./share/mysql/english/errmsg.sys
-a -x ./bin/mysqld
--------------------------------------------------------------------------

See section <A HREF="manual.ru.html#safe_mysqld">4.7.2  <code>safe_mysqld</code>, оболочка <code>mysqld</code></A>.
</PRE>

Этот тест может пройти успешно, однако возможны и проблемы.

<LI>

Не запускайте несколько демонов <code>mysqld</code> с одной и тожй же директорией
данных. Используйте различные директории с данными, если Вы четко не
уверены в своих действиях!

<LI>

Файл сокета и порт TCP/IP должны быть различными для каждого демона
<code>mysqld</code>.

<LI>

Первая и пятая группы <code>mysqld</code> были преднамеренно не включены в пример.
В файле конфигурации могут быть ``промежутки'' - это увеличивает
гибкость. Порядок, в котором запускаются или завершают работу демоны
<code>mysqld</code>, зависит от порядка, в котором они указаны в файле
конфигурации.

<LI>

Когда нужно обратиться к некоторой группе (GNR) в этой программе,
просто используйте номер в конце имени группы. Например, GNR для группы
<code>[mysqld17]</code> - 17. 

<LI>

Для <code>mysqld</code> можно использовать опцию <code>--user</code>, но для этого сценарий
<code>mysqld_multi</code> должен быть запущен от <code>root</code>. Наличие опции в файле
конфигурации не имеет значения; вы получите предупреждение только в
случаях, если не являетесь суперпользователем и демон <code>mysqlds</code> запущен
под <strong>вашим</strong> аккаунтом Unix. <strong>Важно</strong>: удостоверьтесь, что для <code>pid-файла</code> и
директории с данными имеется доступ для чтения+записи(+выполнения -
для директории с данными) для <strong>того</strong> пользователя Unix, который
запускает определенный процесс <code>mysqld</code>. <strong>Не</strong> используйте для этого
аккаунт <code>root</code> в Unix, если Вы не уверены в своих действиях!

<LI>

<strong>Очень важно</strong>: удостоверьтесь, что вы понимаете значения опций, которые
передаются демонам <code>mysqld</code>, и что осознаете то, почему могут быть нужны
отдельные процессы <code>mysqld</code>. Запуск нескольких демонов <code>mysqld</code> с одной
директорией данных не увеличит производительность в многопоточной
системе!
</UL>

<P>
See section <A HREF="manual.ru.html#Multiple_servers">4.1.4  Запуск нескольких серверов MySQL на одном компьютере</A>.

</P>
<P>
Пример файла конфигурации для <code>mysqld_multi</code>.

</P>

<PRE>
# Этот файл может находиться в вашей домашней директории (~/.my.cnf) или
/etc/my.cnf
# Version 2.1 by Jani Tolonen

[mysqld_multi]
mysqld = /usr/local/bin/safe_mysqld
mysqladmin = /usr/local/bin/mysqladmin
user = multi_admin
password = multipass

[mysqld2]
socket = /tmp/mysql.sock2
port = 3307
pid-file = /usr/local/mysql/var2/hostname.pid2
datadir = /usr/local/mysql/var2
language = /usr/local/share/mysql/english
user = john

[mysqld3]
socket = /tmp/mysql.sock3
port = 3308
pid-file = /usr/local/mysql/var3/hostname.pid3
datadir = /usr/local/mysql/var3
language = /usr/local/share/mysql/swedish
user = monty

[mysqld4]
socket = /tmp/mysql.sock4
port = 3309
pid-file = /usr/local/mysql/var4/hostname.pid4
datadir = /usr/local/mysql/var4
language = /usr/local/share/mysql/estonia
user = tonu

[mysqld6]
socket = /tmp/mysql.sock6
port = 3311
pid-file = /usr/local/mysql/var6/hostname.pid6
datadir = /usr/local/mysql/var6
language = /usr/local/share/mysql/japanese
user = jani
</PRE>

<P>
See section <A HREF="manual.ru.html#Option_files">4.1.2  Файлы параметров <tt>`my.cnf'</tt></A>.

</P>


<H3><A NAME="myisampack" HREF="manual.ru_toc.html#myisampack">4.7.4  <code>myisampack</code>, MySQL-генератор сжатых таблиц (только для чтения)</A></H3>

<P>
<A NAME="IDX686"></A>
<A NAME="IDX687"></A>
<A NAME="IDX688"></A>
<A NAME="IDX689"></A>
<A NAME="IDX690"></A>

</P>
<P>
Утилита <code>myisampack</code> используется для сжатия таблиц <code>MyISAM</code>, а утилита
<code>pack_isam</code> - для сжатия таблиц <code>ISAM</code>. Поскольку таблицы <code>ISAM</code> являются
устаревшими, здесь будет рассматриваться только <code>myisampack</code>, но все,
сказанное относительно <code>myisampack</code>, справедливо также и для <code>pack_isam</code>.

</P>
<P>
<code>myisampack</code>  сжимает каждый столбец в таблице по отдельности. Информация,
необходимая для декомпрессии столбцов, считывается в память при открытии
таблицы. В результате обеспечивается более высокая производительность при
доступе к отдельным записям, поскольку нужно распаковывать только одну
запись, а не значительно больший по размеру дисковый блок, как при
использовании программы Stacker в MS DOS. В среднем <code>myisampack</code> сжимает
файл данных на 40%-70%.

</P>
<P>
(MySQL использует отображение в памяти (<code>mmap()</code>) для сжатых таблиц

</P>
<P>
а если <code>mmap()</code> не работает, возвращается назад к нормальному режиму
чтения/записи.

</P>
<P>
Обратите внимание на следующее:

</P>

<UL>
<LI>

После сжатия таблица доступна в режиме только для чтения. Это удобно,
скажем, для записи на CD. Реализация возможности записи в сжатые таблицы
находится в нашем списке задач к выполнению, но имеет низкий приоритет.

<LI>

<code>myisampack</code> может также сжимать столбцы c типами <code>BLOB</code> или <code>TEXT</code>. В
предыдущей версии <code>pack_isam</code> (для таблиц <code>ISAM</code>) данной функции не было.
</UL>

<P>
Утилиту <code>myisampack</code> можно запустить следующим образом:

</P>

<PRE>
shell&#62; myisampack [options] filename ...
</PRE>

<P>
Каждое имя файла (<code>filename</code>) должно быть именем индексного файла (<tt>`.MYI'</tt>).
Если вы не находитесь в директории базы данных, необходимо указать полный
путь к файлу. Допускается опускать расширение <tt>`.MYI'</tt>.

</P>
<P>
myisampack  поддерживает следующие опции:

</P>
<DL COMPACT>

<DT><code>-b, --backup</code>
<DD>
Создает резервную копию таблицы, присваивая ей имя <tt>`tbl_name.OLD'</tt>.

<DT><code>-#, --debug=debug_options</code>
<DD>
Выводить журнал отладки. Строка <code>debug_options</code> часто принимает значение
<code>d:t:o,filename</code>

<DT><code>-f, --force</code>
<DD>
Сжатие таблицы происходит, даже если она увеличивается или если существует
временный файл. Во время сжатия таблицы <code>myisampack</code>  создает временный файл
<tt>`tbl_name.TMD'</tt>. Если вы вручную прекратите выполнение <code>myisampack</code>, может
оказаться так, что файл <tt>`tbl_name.TMD'</tt> не будет удален. Обычно если
<code>myisampack</code> обнаруживает существующий <tt>`tbl_name.TMD'</tt>, она прекращает работу и
выдает ошибку. При указании опции <code>--force</code> <code>myisampack</code> сжимает таблицу в
любом случае.

<DT><code>-?, --help</code>
<DD>
Выдает справочную информацию и завершает работу.

<DT><code>-j big_tbl_name, --join=big_tbl_name</code>
<DD>
Соединяет все таблицы, указанные в командной строке, в одну таблицу
<code>big_tbl_name</code>. Все таблицы, подлежащие объединению, должны быть идентичными
(одинаковые имена и типы столбцов, одинаковые индексы и т.д.).

<DT><code>-p #, --packlength=#</code>
<DD>
Определяет разрядность поля, хранящего длину строки, в байтах. Может
принимать значения 1, 2 или 3. (<code>myisampack</code>  хранит все строки с
указателями длины размером в 1, 2, или 3 байта. В большинстве случаев
<code>myisampack</code> способна определить правильное значение длины перед началом
сжатия файла, но во время сжатия она может обнаружить, что может быть
использована более короткая длина. В этом случае <code>myisampack</code> выведет
сообщение о том, что в следующий раз при сжатии данного файла можно
использовать более короткую длину записи.)

<DT><code>-s, --silent</code>
<DD>
Молчаливый режим. Сообщения выводятся только при возникновении ошибок.

<DT><code>-t, --test</code>
<DD>
Сжатие таблицы не выполняется, происходит только проверка процедуры
сжатия.

<DT><code>-T dir_name, --tmp_dir=dir_name</code>
<DD>
Указанная директория используется как местоположение для создания
временной таблицы.

<DT><code>-v, --verbose</code>
<DD>
Расширенный режим вывода сообщений. Выводится информация о состоянии
процесса и результаты сжатия.

<DT><code>-V, --version</code>
<DD>
Отображает информацию о версии и завершает работу.

<DT><code>-w, --wait</code>
<DD>
Если таблица уже используется, подождать повторить попытку. Если сервер
<code>mysqld</code> был вызван с опцией <code>--skip-external-locking</code>, то не самая лучшая идея -
вызывать <code>myisampack</code>, если таблица может модифицироваться во время процесса
сжатия.
</DL>

<P>
<A NAME="IDX691"></A>
Последовательность приведенных ниже команд иллюстрирует типичный сеанс
сжатия таблицы:

</P>

<PRE>
shell&#62; ls -l station.*
-rw-rw-r--   1 monty    my         994128 Apr 17 19:00 station.MYD
-rw-rw-r--   1 monty    my          53248 Apr 17 19:00 station.MYI
-rw-rw-r--   1 monty    my           5767 Apr 17 19:00 station.frm

shell&#62; myisamchk -dvv station

MyISAM file:     station
Isam-version:  2
Creation time: 1996-03-13 10:08:58
Recover time:  1997-02-02  3:06:43
Data records:              1192  Deleted blocks:              0
Datafile: Parts:           1192  Deleted data:                0
Datafile pointer (bytes):     2  Keyfile pointer (bytes):     2
Max datafile length:   54657023  Max keyfile length:   33554431
Recordlength:               834
Record format: Fixed length

table description:
Key Start Len Index   Type                       Root  Blocksize    Rec/key
1   2     4   unique  unsigned long              1024       1024          1
2   32    30  multip. text                      10240       1024          1

Field Start Length Type
1     1     1
2     2     4
3     6     4
4     10    1
5     11    20
6     31    1
7     32    30
8     62    35
9     97    35
10    132   35
11    167   4
12    171   16
13    187   35
14    222   4
15    226   16
16    242   20
17    262   20
18    282   20
19    302   30
20    332   4
21    336   4
22    340   1
23    341   8
24    349   8
25    357   8
26    365   2
27    367   2
28    369   4
29    373   4
30    377   1
31    378   2
32    380   8
33    388   4
34    392   4
35    396   4
36    400   4
37    404   1
38    405   4
39    409   4
40    413   4
41    417   4
42    421   4
43    425   4
44    429   20
45    449   30
46    479   1
47    480   1
48    481   79
49    560   79
50    639   79
51    718   79
52    797   8
53    805   1
54    806   1
55    807   20
56    827   4
57    831   4

shell&#62; myisampack station.MYI
Compressing station.MYI: (1192 records)
- Calculating statistics

normal:     20  empty-space:      16  empty-zero:        12  empty-fill:  11
pre-space:   0  end-space:        12  table-lookups:      5  zero:         7
Original trees:  57  After join: 17
- Compressing file
87.14%

shell&#62; ls -l station.*
-rw-rw-r--   1 monty    my         127874 Apr 17 19:00 station.MYD
-rw-rw-r--   1 monty    my          55296 Apr 17 19:04 station.MYI
-rw-rw-r--   1 monty    my           5767 Apr 17 19:00 station.frm

shell&#62; myisamchk -dvv station

MyISAM file:     station
Isam-version:  2
Creation time: 1996-03-13 10:08:58
Recover time:  1997-04-17 19:04:26
Data records:              1192  Deleted blocks:              0
Datafile: Parts:           1192  Deleted data:                0
Datafilepointer (bytes):      3  Keyfile pointer (bytes):     1
Max datafile length:   16777215  Max keyfile length:     131071
Recordlength:               834
Record format: Compressed

table description:
Key Start Len Index   Type                       Root  Blocksize    Rec/key
1   2     4   unique  unsigned long             10240       1024          1
2   32    30  multip. text                      54272       1024          1

Field Start Length Type                         Huff tree  Bits
1     1     1      constant                             1     0
2     2     4      zerofill(1)                          2     9
3     6     4      no zeros, zerofill(1)                2     9
4     10    1                                           3     9
5     11    20     table-lookup                         4     0
6     31    1                                           3     9
7     32    30     no endspace, not_always              5     9
8     62    35     no endspace, not_always, no empty    6     9
9     97    35     no empty                             7     9
10    132   35     no endspace, not_always, no empty    6     9
11    167   4      zerofill(1)                          2     9
12    171   16     no endspace, not_always, no empty    5     9
13    187   35     no endspace, not_always, no empty    6     9
14    222   4      zerofill(1)                          2     9
15    226   16     no endspace, not_always, no empty    5     9
16    242   20     no endspace, not_always              8     9
17    262   20     no endspace, no empty                8     9
18    282   20     no endspace, no empty                5     9
19    302   30     no endspace, no empty                6     9
20    332   4      always zero                          2     9
21    336   4      always zero                          2     9
22    340   1                                           3     9
23    341   8      table-lookup                         9     0
24    349   8      table-lookup                        10     0
25    357   8      always zero                          2     9
26    365   2                                           2     9
27    367   2      no zeros, zerofill(1)                2     9
28    369   4      no zeros, zerofill(1)                2     9
29    373   4      table-lookup                        11     0
30    377   1                                           3     9
31    378   2      no zeros, zerofill(1)                2     9
32    380   8      no zeros                             2     9
33    388   4      always zero                          2     9
34    392   4      table-lookup                        12     0
35    396   4      no zeros, zerofill(1)               13     9
36    400   4      no zeros, zerofill(1)                2     9
37    404   1                                           2     9
38    405   4      no zeros                             2     9
39    409   4      always zero                          2     9
40    413   4      no zeros                             2     9
41    417   4      always zero                          2     9
42    421   4      no zeros                             2     9
43    425   4      always zero                          2     9
44    429   20     no empty                             3     9
45    449   30     no empty                             3     9
46    479   1                                          14     4
47    480   1                                          14     4
48    481   79     no endspace, no empty               15     9
49    560   79     no empty                             2     9
50    639   79     no empty                             2     9
51    718   79     no endspace                         16     9
52    797   8      no empty                             2     9
53    805   1                                          17     1
54    806   1                                           3     9
55    807   20     no empty                             3     9
56    827   4      no zeros, zerofill(2)                2     9
57    831   4      no zeros, zerofill(1)                2     9
</PRE>

<P>
Ниже приведено описание вывода myisampack:

</P>
<DL COMPACT>

<DT><code>normal</code>
<DD>
Количество столбцов, для которых не используется никакого дополнительного
сжатия.

<DT><code>empty-space</code>
<DD>
Количество столбцов, содержащих пустые значения; эти занимают по 1 биту.

<DT><code>empty-zero</code>
<DD>
Количество целочисленных столбцов, в которых содержатся только двоичные
нули (ascii 0); каждый из них будет занимать 1 бит

<DT><code>empty-fill</code>
<DD>
Количество целочисленных столбцов, значения которых не полностью занимают
отведенную для них разрядность в байтах; тип этих столбцов изменяется на
тип с меньшей разрядностью(например, столбец <code>INTEGER</code> может быть изменен на
<code>MEDIUMINT</code>).

<DT><code>pre-space</code>
<DD>
Количество десятичных столбцов, которые хранятся с начальными пробелами. В
этом случае каждое значение будет содержать число ведущих пробелов.

<DT><code>end-space</code>
<DD>
Количество столбцов, имеющих много оконечных пробелов. В этом случае
каждое значение будет содержать число таких пробелов.

<DT><code>table-lookup</code>
<DD>
Столбец имеет только небольшое количество различающихся значений, которые
перед сжатием Хаффмана (Huffman) конвертируются в <code>ENUM</code>.

<DT><code>zero</code>
<DD>
Количество столбцов, все значения которых являются нулями.

<DT><code>Original  trees</code>
<DD>
Начальное количество деревьев Хаффмана.

<DT><code>After  join</code>
<DD>
Количество различных деревьев Хаффмана, оставленных после соединения
деревьев для сохранения немного пространства в заголовках.
</DL>

<P>
После сжатия таблицы <code>myisamchk -dvv</code> выводит дополнительную информацию по
каждому полю:

</P>
<DL COMPACT>

<DT><code>Type</code>
<DD>
Тип поля может содержать следующие дескрипторы:

<DL COMPACT>

<DT><code>constant</code>
<DD>
Все строки содержат одинаковое значение.

<DT><code>no  endspace</code>
<DD>
Не сохраняются замыкающие пробелы.

<DT><code>no endspace, not_always</code>
<DD>
Не сохраняются замыкающие пробелы и не производится сжатие за счет
замыкающих пробелов для всех значений.

<DT><code>no endspace, no empty</code>
<DD>
Не сохраняются замыкающие пробелы. Не сохраняются пустые значения.

<DT><code>table-lookup</code>
<DD>
Столбец был преобразован к <code>ENUM</code>.

<DT><code>zerofill(n)</code>
<DD>
В значении n главных байтов всегда являются 0 и не сохранены.

<DT><code>no zeros</code>
<DD>
Не сохраняются нули.

<DT><code>always  zero</code>
<DD>
Значения 0 хранятся в 1 бите.
</DL>

<DT><code>Huff  tree</code>
<DD>
Дерево Хаффмана, связанное с полем.

<DT><code>Bits</code>
<DD>
Количество битов, используемых в дереве Хаффмана.
</DL>

<P>
После запуска <code>pack_isam</code>/<code>myisampack</code> нужно запустить <code>isamchk</code>/<code>myisamchk</code> для
повторного создания индекса. В это время можно также отсортировать
индексные блоки и создать статистику, необходимую для более эффективной
работы оптимизатора MySQL:

</P>

<PRE>
myisamchk -rq --analyze --sort-index table_name.MYI
isamchk -rq --analyze --sort-index table_name.ISM
</PRE>

<P>
После установки сжатой таблицы в директорию базы данных MySQL нужно
проделать операцию <code>mysqladmin flush-tables</code>, чтобы сервер <code>mysqld</code> начал
использовать новую таблицу.

</P>
<P>
Для распаковки сжатой таблицы можно использовать опцию <code>--unpack</code> <code>isamchk</code>
или <code>myisamchk</code>.

</P>


<H3><A NAME="mysqld-max" HREF="manual.ru_toc.html#mysqld-max">4.7.5  <code>mysqld-max</code>, расширенный сервер <code>mysqld</code></A></H3>

<P>
<A NAME="IDX692"></A>

</P>
<P>
<code>mysqld-max</code> - это сервер MySQL (<code>mysqld</code>), скомпилированный со следующими
конфигурационными опциями:

</P>
<TABLE BORDER>
<TR><TD><strong>Опция</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD>--with-server-suffix=-max </TD><TD> Добавляет суффикс к версии <code>mysqld</code>.
</TD></TR>
<TR><TD>--with-innodb </TD><TD> Поддержка таблиц InnoDB.
</TD></TR>
<TR><TD>--with-bdb </TD><TD> Поддержка таблиц Беркли DB (BDB)
</TD></TR>
<TR><TD>CFLAGS=-DUSE_SYMDIR </TD><TD> Символические ссылки для Windows.
</TD></TR>
</TABLE>

<P>
Бинарную версию MySQL-max можно найти по адресу 
<a HREF="http://www.mysql.com/downloads/mysql-max-3.23.html">http://www.mysql.com/downloads/mysql-max-3.23.html</a>.

</P>
<P>
Бинарные дистрибутивы Windows MySQL включают стандартный двоичный файл
<code>mysqld.exe</code> а также двоичный файл <code>mysqld-max.exe</code>.
<a HREF="http://www.mysql.com/downloads/mysql-3.23.html">http://www.mysql.com/downloads/mysql-3.23.html</a>. See section <A HREF="manual.ru.html#Windows_installation">2.1.2  Установка MySQL на Windows</A>.

</P>
<P>
Обратите внимание: поскольку таблицы InnoDB и Berkeley DB доступны не для
всех платформ, некоторые из двоичных дистрибутивов  могут не поддерживать
оба этих типа таблиц. Проверить, какие типы таблиц поддерживаются, можно
при помощи следующего запроса:

</P>

<PRE>
mysql&#62; SHOW VARIABLES LIKE "have_%";
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| have_bdb | YES |
| have_innodb | NO |
| have_isam | YES |
| have_raid | NO |
| have_openssl | NO |
+---------------+-------+
</PRE>

<P>
Значения имеют следующий смысл:

</P>
<TABLE BORDER>
<TR><TD><strong>Значение</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD><code>YES</code> </TD><TD> Опция активизирована.
</TD></TR>
<TR><TD><code>NO</code> </TD><TD> MySQL не поддерживает эту опцию.
</TD></TR>
<TR><TD><code>DISABLED</code> </TD><TD> Опция xxxx заблокирована, потому что <code>mysqld</code> был запущен с параметром <code>--skip-xxxx</code>  или потому, что <code>mysqld</code> был запущен не со всеми опциями, необходимыми для того, чтобы использование данной опции было возможным. В этом случае файл <tt>`hostname.err'</tt> будет содержать причину, по которой опция заблокирована.
</TD></TR>
</TABLE>

<P>
<strong>Примечание</strong>: чтобы получить возможность создавать таблицы InnoDB, вы <strong>должны</strong>
отредактировать опции, включив по меньшей мере опцию
<code>innodb_data_file_path</code>. See section <A HREF="manual.ru.html#InnoDB_start">7.5.2  Параметры запуска InnoDB</A>.

</P>
<P>
Чтобы улучшить производительность таблиц BDB, для них нужно также добавить
некоторые конфигурационные опции. See section <A HREF="manual.ru.html#BDB_start">7.6.3  Параметры запуска <code>BDB</code></A>.

</P>
<P>
<code>safe_mysqld</code> будет автоматически пытаться запустить двоичный <code>mysqld</code> с
суффиксом <code>-max</code>. Таким образом можно просто осуществлять тестирование
свежесобранного бинарного <code>mysqld</code> в существующей инсталляции. Для этого
нужно выполнить <code>configure</code> с требуемыми опциями, собрать, и затем
установить новый <code>mysqld</code> как <code>mysqld-max</code>  в тот же самый каталог, где
находится ``старый'' бинарный <code>mysqld</code>. See section <A HREF="manual.ru.html#safe_mysqld">4.7.2  <code>safe_mysqld</code>, оболочка <code>mysqld</code></A>.

</P>
<P>
<code>mysqld-max</code> RPM использует вышеупомянутую возможность <code>safe_mysqld</code>. Он
только устанавливает исполняемый <code>mysqld-max</code>, и <code>safe_mysqld</code> будет
автоматически использовать его после перезапуска <code>safe_mysqld</code>.

</P>
<P>
В следующей таблице показаны типы таблиц, поддерживаемые двоичным
<code>MySQL-Max</code>:

</P>
<TABLE BORDER>
<TR><TD><strong>System</strong> </TD><TD> <code>BDB</code> </TD><TD> <code>InnoDB</code>
</TD></TR>
<TR><TD>AIX 4.3 </TD><TD> Нет </TD><TD> Да
</TD></TR>
<TR><TD>HP-UX 11.0 </TD><TD> Нет </TD><TD> Да
</TD></TR>
<TR><TD>Linux-Alpha </TD><TD> Нет </TD><TD> Да
</TD></TR>
<TR><TD>Linux-Intel </TD><TD> Да </TD><TD> Да
</TD></TR>
<TR><TD>Linux-IA64 </TD><TD> Нет </TD><TD> Да
</TD></TR>
<TR><TD>Solaris-Intel </TD><TD> Нет </TD><TD> Да
</TD></TR>
<TR><TD>Solaris-SPARC </TD><TD> Да </TD><TD> Да
</TD></TR>
<TR><TD>Caldera (SCO) OSR5 </TD><TD> Да </TD><TD> Да
</TD></TR>
<TR><TD>UnixWare </TD><TD> Да </TD><TD> Да
</TD></TR>
<TR><TD>Windows/NT </TD><TD> Да </TD><TD> Да
</TD></TR>
</TABLE>



<H2><A NAME="Client-Side_Scripts" HREF="manual.ru_toc.html#Client-Side_Scripts">4.8  Клиентские сценарии и утилиты MySQL</A></H2>



<H3><A NAME="Client-Side_Overview" HREF="manual.ru_toc.html#Client-Side_Overview">4.8.1  Обзор клиентских сценариев и утилит</A></H3>

<P>
<A NAME="IDX693"></A>
<A NAME="IDX694"></A>

</P>
<P>
Все клиенты MySQL, которые взаимодействуют с сервером с помощью библиотеки
<code>mysqlclient</code>, используют следующие переменные окружения:

</P>
<P>
<A NAME="IDX695"></A>
<A NAME="IDX696"></A>
<A NAME="IDX697"></A>
<A NAME="IDX698"></A>
<A NAME="IDX699"></A>
<A NAME="IDX700"></A>
<A NAME="IDX701"></A>
<A NAME="IDX702"></A>

</P>
<TABLE BORDER>
<TR><TD><strong>Имя</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD><code>MYSQL_UNIX_PORT</code> </TD><TD> Сокет, используемый по умолчанию для локальных подсоединений
</TD></TR>
<TR><TD><code>MYSQL_TCP_PORT</code> </TD><TD> Устанавливаемый по умолчанию порт TCP/IP
</TD></TR>
<TR><TD><code>MYSQL_PWD</code> </TD><TD> Устанавливаемый по умолчанию пароль
</TD></TR>
<TR><TD><code>MYSQL_DEBUG</code> </TD><TD> Опции пошаговой отладки программ
</TD></TR>
<TR><TD><code>TMPDIR</code> </TD><TD> Каталог для создания временных таблиц/файлов
</TD></TR>
</TABLE>

<P>
Использование <code>MYSQL_PWD</code> небезопасно. See section <A HREF="manual.ru.html#Connecting">4.2.8  Соединение с сервером MySQL</A>.

</P>
<P>
<A NAME="IDX703"></A>
<A NAME="IDX704"></A>
<A NAME="IDX705"></A>
<A NAME="IDX706"></A>
<A NAME="IDX707"></A>
<A NAME="IDX708"></A>
<A NAME="IDX709"></A>

</P>
<P>
Клиент <code>mysql</code> использует файл, указанный в переменной окружения
<code>MYSQL_HISTFILE</code>, для хранения истории командной строки. Значение по
умолчанию для этого файла истории - <code>$HOME/.mysql_history</code>, где <code>$HOME</code> -
значение переменной окружения <code>HOME</code>. See section <A HREF="manual.ru.html#Environment_variables">E  Переменные окружения</A>.

</P>
<P>
Все программы MySQL принимают множество различных опций. При этом каждая
программа MySQL поддерживает опцию <code>--help</code>, которую можно использовать для
получения полного описания различных опций программы. Например, попробуйте
запустить <code>mysql --help</code>.

</P>
<P>
Для всех стандартных клиентских программ можно переопределить значения
опций по умолчанию, используя файл опций. See section <A HREF="manual.ru.html#Option_files">4.1.2  Файлы параметров <tt>`my.cnf'</tt></A>.

</P>
<P>
В приведенном ниже списке дано краткое описание клиентских программ MySQL:

</P>
<DL COMPACT>

<DT><code>msql2mysql</code>
<DD>
<A NAME="IDX710"></A>
 
Сценарий оболочки операционной системы, преобразующий программы базы
данных mSQL к виду, приемлемому для MySQL. Он не обрабатывает всех
случаев, но с него хорошо начинать такое преобразование.

<A NAME="IDX711"></A>
<DT><code>mysqlaccess</code>
<DD>
Сценарий, который проверяет привилегии доступа для комбинации значений
хоста, пользователя и базы данных.

<A NAME="IDX712"></A>
<DT><code>mysqladmin</code>
<DD>
Утилита для выполнения административных функций, таких как создание или
удаление баз данных, перезагрузка таблиц привилегий, запись на диск
содержимого таблиц, находящегося в буфере, повторное открытие файлов
журналов. Утилита  <code>mysqladmin</code> может также использоваться для получения
информации с сервера о номере версии, процессах и состоянии сервера. См.
раздел See section <A HREF="manual.ru.html#mysqladmin">4.8.3  <code>mysqladmin</code>, Администрирование MySQL-сервера.</A>.

<A NAME="IDX713"></A>
<DT><code>mysqldump</code>
<DD>
Выводит содержимое базы данных MySQL в виде файла с SQL-операторами или в
виде текстовых файлов с символом табуляции в качестве разделителя.
Усовершенствованная свободно распространяемая утилита, автором которой
является Игорь Романенко. See section <A HREF="manual.ru.html#mysqldump">4.8.5  <code>mysqldump</code>, Получение дампов данных и структуры таблицы</A>.

<A NAME="IDX714"></A>
<DT><code>mysqlimport</code>
<DD>
Импортирует текстовые файлы в соответствующие таблицы, используя команду
<code>LOAD DATA INFILE</code>. See section <A HREF="manual.ru.html#mysqlimport">4.8.7  <code>mysqlimport</code>, импорт данных из текстовых файлов</A>.

<A NAME="IDX715"></A>
<DT><code>mysqlshow</code>
<DD>
Отображает информацию о существующих базах данных, таблицах, полях и
индексах.

<A NAME="IDX716"></A>
<DT><code>replace</code>
<DD>
Служебная программа, использующаяся в сценарии <code>msql2mysql</code>, но имеющая
также более широкое применение. Утилита <code>replace</code> изменяет строки,
находящиеся в файлах или в стандартных входных данных. Использует принцип
конечного автомата, чтобы в первую очередь найти соответствие длинных
строк. Может применяться для замены строк. Например, эта команда меняет
местами <code>a</code> и <code>b</code> в данных файлах:


<PRE>
shell&#62; replace a b b a -- file1 file2 ...
</PRE>

</DL>



<H3><A NAME="mysql" HREF="manual.ru_toc.html#mysql">4.8.2  <code>mysql</code>, Утилита командной строки</A></H3>

<P>
<A NAME="IDX717"></A>
<A NAME="IDX718"></A>
<A NAME="IDX719"></A>
<A NAME="IDX720"></A>

</P>
<P>
Утилита командной строки <code>mysql</code> является простой SQL-оболочкой (с
возможностями библиотеки <code>readline</code> проекта GNU). Она поддерживает
интерактивный и неинтерактивный режимы. В интерактивном режиме результаты
запроса представляются в ASCII-формате. При использовании в
неинтерактивном режиме (например, в качестве фильтра) результат
представляется в текстовом формате с символом табуляции в качестве
разделителя (выходной формат можно изменить при помощи параметров
командной строки). Сценарии можно запускать, как показано ниже:

</P>

<PRE>
shell&#62; mysql database &#60; script.sql &#62; output.tab
</PRE>

<P>
Если возникают проблемы из-за недостатка памяти на данном клиенте,
применяйте параметр <code>--quick</code>! Это заставит <code>mysql</code> использовать функцию
<code>mysql_use_result()</code> вместо функции <code>mysql_store_result()</code> для получения
результирующей выборки данных.

</P>
<P>
Использовать <code>mysql</code> очень легко. Запустите <code>mysql database</code> или <code>mysql
--user=user_name --password=your_password databas</code>e. Наберите SQL-команду
прямо в командной строке, завершив ее одним из символов: <samp>`;'</samp>, <samp>`\g'</samp> или
<samp>`\G'</samp>, и нажмите клавишу ``Ввод''.

</P>
<P>
Утилита командной строки <code>mysql</code> поддерживает следующие параметры:

</P>
<P>
<A NAME="IDX721"></A>
<A NAME="IDX722"></A>
<A NAME="IDX723"></A>
<A NAME="IDX724"></A>

</P>
<DL COMPACT>

<DT><code>-?, --help</code>
<DD>
<A NAME="IDX725"></A>
 
Вывод справочной информации об использовании программы и выход из нее.

<A NAME="IDX726"></A>
<DT><code>-A, --no-auto-rehash</code>
<DD>
Отключает автоматическое рехеширование. <code>rehash</code> следует использовать для
получения хеша таблиц и полей. Это обеспечивает более быстрый старт <code>mysql</code>.

<A NAME="IDX727"></A>
<DT><code>--prompt=...</code>
<DD>
Устанавливает приглашение на ввод команд в заданном формате.

<A NAME="IDX728"></A>
<DT><code>-b, --no-beep</code>
<DD>
Выключает звуковой сигнал об ошибке.

<A NAME="IDX729"></A>
<DT><code>-B, --batch</code>
<DD>
Выводит результаты в пакетном режиме с символом табуляции в качестве
разделителя, каждая строка с новой строки. Файл истории не используется.

<A NAME="IDX730"></A>
<DT><code>--character-sets-dir=...</code>
<DD>
Директория, где находятся наборы символов.

<A NAME="IDX731"></A>
<DT><code>-C, --compress</code>
<DD>
Использовать сжатие данных в протоколе сервер/клиент.

<A NAME="IDX732"></A>
<DT><code>-#, --debug[=...]</code>
<DD>
Журнал отладки. Значение по умолчанию - 'd:t:o,/tmp/mysql.trace'.

<A NAME="IDX733"></A>
<DT><code>-D, --database=...</code>
<DD>
Имя используемой базы данных. Большей частью применяется в
конфигурационном файле <tt>`my.cnf'</tt>.

<A NAME="IDX734"></A>
<DT><code>--default-character-set=...</code>
<DD>
Установить набор символов по умолчанию.

<A NAME="IDX735"></A>
<DT><code>-e, --execute=...</code>
<DD>
Выполнить команду и завершить программу (вывод результата как и для
<code>--batch</code>).

<A NAME="IDX736"></A>
<DT><code>-E, --vertical</code>
<DD>
Вывести результаты запроса (строки) по вертикали. Можно произвести вывод
подобным образом и без данного параметра, завершая команды символами <code>\G</code>.

<A NAME="IDX737"></A>
<DT><code>-f, --force</code>
<DD>
Продолжать обработку даже при обнаружении ошибки SQL.

<A NAME="IDX738"></A>
<DT><code>-g, --no-named-commands</code>
<DD>
Выключает именованные команды. Следует использовать только команды вида \*
либо применять именованные команды только в начале строки, заканчивающейся
символом <samp>`;'</samp>. Начиная с версии 10.9 клиент запускается с этой опцией,
<strong>включенной</strong> по умолчанию! С опцией <code>-g</code>, однако, длинные команды все еще
работают с первой строки.

<A NAME="IDX739"></A>
<DT><code>-G, --enable-named-commands</code>
<DD>
Разрешает именованные команды. Допускаются длинные команды, а также
укороченные команды вида \*.

<A NAME="IDX740"></A>
<DT><code>-i, --ignore-space</code>
<DD>
Игнорировать пробел после имен функций.

<A NAME="IDX741"></A>
<DT><code>-h, --host=...</code>
<DD>
Подсоединиться к базе данных на указанном хосте.

<A NAME="IDX742"></A>
<DT><code>-H, --html</code>
<DD>
Вывести выходные данные в виде HTML.

<A NAME="IDX743"></A>
<DT><code>-X, --xml</code>
<DD>
Вывести выходные данные в виде XML.

<A NAME="IDX744"></A>
<DT><code>-L, --skip-line-numbers</code>
<DD>
Не указывать номера строк для ошибок. Полезно для сравнения результирующих
файлов, включающих сообщения об ошибках.

<A NAME="IDX745"></A>
<DT><code>--no-pager</code>
<DD>
Блокирует пейджер (программа постраничного вывода) и выводит результат в
стандартный вывод stdout (в Unix). Смотрите также команду <code>\h</code>
(интерактивная помощь).

<A NAME="IDX746"></A>
<DT><code>--no-tee</code>
<DD>
Блокирует выходной файл. Смотрите также команду <code>\h</code> (интерактивная помощь).

<A NAME="IDX747"></A>
<DT><code>-n, --unbuffered</code>
<DD>
Очищать буфер после каждого запроса.

<A NAME="IDX748"></A>
<DT><code>-N, --skip-column-names</code>
<DD>
Не указывать имена столбцов в результатах.

<A NAME="IDX749"></A>
<DT><code>-O, --set-variable var=option</code>
<DD>
Установить значение переменной. Список используемых переменных выводится
через <code>--help</code>. Обратите внимание, что <code>--set-variable</code> не используется в 
MySQL 4.0. Просто используйте <code>--var=option</code>. 

<A NAME="IDX750"></A>
<DT><code>-o, --one-database</code>
<DD>
Обновить только базу данных, установленную по умолчанию. Позволяет
пропускать обновления другой базы данных в журнале обновления.

<A NAME="IDX751"></A>
<DT><code>--pager[=...]</code>
<DD>
Устанавливает тип данных вывода. По умолчанию это переменная окружения
<code>PAGER</code>. Ее возможные значения - less, more, cat [&#62; имя файла], и т.д. См.
также команду \h (интерактивная помощь). Этот параметр не работает в
пакетном (batch) режиме. Пейджер работает только под Unix.

<A NAME="IDX752"></A>
<DT><code>-p[password], --password[=...]</code>
<DD>
Пароль, используемый при подсоединении к серверу баз данных. Если в
командной строке пароль не указан, то он запрашивается у пользователя. При
использовании краткой формы <code>-p</code> не оставляйте пробел между параметром и
значением пароля.

<A NAME="IDX753"></A>
<DT><code>-P порт, --port=порт</code>
<DD>
Номер порта TCP/IP, используемый для подсоединения.

<A NAME="IDX754"></A>
<DT><code><code>--protocol=(TCP | SOCKET | PIPE | MEMORY)</code></code>
<DD>
Для указания протокола соединения, который надлежит использовать.
Новшество в  MySQL 4.1.0. 

<A NAME="IDX755"></A>
<DT><code>-q, --quick</code>
<DD>
Не кэшировать результат. Выводить его строка за строкой так, как он
приходит от сервера. Это может замедлить скорость работы сервера, если
вывод результата будет приостановлен. Файл истории не используется.

<A NAME="IDX756"></A>
<DT><code>-r, --raw</code>
<DD>
Показывать значения столбцов без какого-либо преобразования. Используется
с <code>--batch</code>.

<A NAME="IDX757"></A>
<DT><code>-s, --silent</code>
<DD>
Режим молчания. Выводить только сообщения об ошибках.

<A NAME="IDX758"></A>
<DT><code>-S --socket=...</code>
<DD>
Файл сокета, используемый для подсоединения.

<A NAME="IDX759"></A>
<DT><code>-t --table</code>
<DD>
Выводить результат в табличном формате. Установлено по умолчанию для
непакетного режима.

<A NAME="IDX760"></A>
<DT><code>-T, --debug-info</code>
<DD>
Выводить некоторые отладочные данные при выходе из программы.

<A NAME="IDX761"></A>
<DT><code>--tee=...</code>
<DD>
Присоединить что-либо к выходному файлу. Смотрите также команду \h
(интерактивная помощь). Этот параметр не работает в пакетном режиме.

<A NAME="IDX762"></A>
<DT><code>-u, --user=#</code>
<DD>
Имя пользователя MySQL, если этот пользователь не является активным в
данное время.

<A NAME="IDX763"></A>
<DT><code>-U, --safe-updates[=#], --i-am-a-dummy[=#]</code>
<DD>
Разрешает выполнять только операции <code>UPDATE</code> и <code>DELETE</code>, используя ключи.
Более полная информация об этом параметре приведена ниже. Можно сбросить
данный параметр, установив в конфигурационном файле <tt>`my.cnf'</tt> значение
аргумента <code>--safe-updates=0</code>.

<A NAME="IDX764"></A>
<DT><code>-v, --verbose</code>
<DD>
Более расширенный режим вывода результатов (<code>-v -v -v</code> дает формат вывода
таблицы).

<A NAME="IDX765"></A>
<DT><code>-V, --version</code>
<DD>
Вывод информации о версии и выход из программы.

<A NAME="IDX766"></A>
<DT><code>-w, --wait</code>
<DD>
Если соединение с сервером упало, подождать и попытаться восстановить его,
вместо того, чтобы прервать работу.
</DL>

<P>
Через параметры командной строки <code>-O</code> или <code>--set-variable</code> (в MySQL 4.0 используйте 
просто <code>--var=option</code>) можно также установить следующие переменные:

</P>
<P>
<A NAME="IDX767"></A>
<A NAME="IDX768"></A>
<A NAME="IDX769"></A>
<A NAME="IDX770"></A>
<A NAME="IDX771"></A>

</P>
<TABLE BORDER>
<TR><TD><strong>Имя переменной</strong> </TD><TD> <strong>По умолчанию</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD>connect_timeout </TD><TD> 0 </TD><TD> Число секунд до истечения времени ожидания соединения
</TD></TR>
<TR><TD>max_allowed_packet </TD><TD> 16777216 </TD><TD> Максимальная величина пакета, посылаемого/принимаемого с сервера
</TD></TR>
<TR><TD>net_buffer_length </TD><TD> 16384 </TD><TD> Размер буфера для TCP/IP и сокетного соединения
</TD></TR>
<TR><TD>select_limit </TD><TD> 1000 </TD><TD> Автоматическое ограничение количества команд SELECT при использовании --i-am-a-dummy
</TD></TR>
<TR><TD>max_join_size </TD><TD> 1000000 </TD><TD> Автоматическое ограничение количества связанных строк при использовании --i-am-a-dummy.
</TD></TR>
</TABLE>

<P>
Если ввести в командной строке <code>help</code>, программа <code>mysql</code> выведет список
поддерживаемых ею команд:

</P>
<P>
<A NAME="IDX772"></A>

</P>

<PRE>
mysql&#62; help

Команды MySQL
help (\h)	Выводит данный текст.
? (\h)		Синоним для help.
clear (\c)	Команда очистки.
connect (\r)	Снова подключиться к серверу.
		Дополнительные аргументы - db и host.
edit (\e)	Редактировать текущую команду с помощью $EDITOR.
ego (\G)	Послать текущую команду MySQL серверу
		и вывести результат по вертикали.
exit (\q)	Выйти из программы. То же что и quit.
go (\g)		Послать текущую команду MySQL серверу.
nopager (\n)	Блокировать пейджер, выводить через stdout.
notee (\t)	Не добавлять записи в выходной файл outfile.
pager (\P)	Установить PAGER [to_pager].
		Выводить результаты запроса через PAGER.
print (\p)	Вывести текущую команду.
prompt (\R)	Изменить формат приглашения на ввод команд mysql.
quit (\q)	Выйти из программы.
rehash (\#)	Восстановить таблицу хэшей.
source (\.)	Запустить на выполнение файл с SQL-сценарием.
		Указать имя файла в качестве аргумента.
status (\s)	Получить информацию о статусе сервера.
tee (\T)	Установить параметр outfile [to_outfile].
		Присоединить что-либо к данному выходному файлу.
use (\u)	Использовать другую базу данных.
		Указать имя базы данных в качестве аргумента.
</PRE>

<P>
Команда <code>pager</code> работает только под Unix.

</P>
<P>
<A NAME="IDX773"></A>
Команда <code>status</code> дает информацию о текущем соединении и используемом
сервере. Если вы работаете в режиме <code>--safe-updates</code>, команда <code>status</code> также
выведет значения переменных для <code>mysql</code>, которые влияют на ваши запросы.

</P>
<P>
Для начинающих рекомендуется пользоваться программой <code>mysql</code> с установленным
параметром (введен в MySQL 3.23.11) <code>--safe-updates</code> (или <code>--i-am-a-dummy</code> для
пользователей, выполнивших <code>DELETE FROM table_name</code>, но забывших указать
аргументы в <code>WHERE</code>). В этом случае <code>mysql</code> при установлении соединения
посылает следующую команду MySQL-серверу:

</P>

<PRE>
SET SQL_SAFE_UPDATES=1,SQL_SELECT_LIMIT=#select_limit#,
    SQL_MAX_JOIN_SIZE=#max_join_size#"
</PRE>

<P>
где <code>#select_limit#</code> и <code>#max_join_size#</code> - переменные, которые можно
установить из командной строки mysql. See section <A HREF="manual.ru.html#SET_OPTION">5.5.6  Синтаксис команды <code>SET</code></A>.

</P>
<P>
Результат этого следующий:

</P>

<UL>
<LI>

Не разрешено выполнять команды <code>UPDATE</code> или <code>DELETE</code>, если не указаны
ограничения по ключам в секции <code>WHERE</code>. Однако можно заставить
выполняться команды <code>UPDATE</code>/<code>DELETE</code>, используя оператор <code>LIMIT</code>:


<PRE>
UPDATE table_name SET not_key_column=# WHERE not_key_column=# LIMIT 1;
</PRE>

<LI>

Все слишком большие результаты ограничены строками <code>#select_limit#</code>.

<LI>

<code>SELECT</code>ы, которые могут потребовать для исполнения количество
комбинаций строк более, чем <code>#max_join_size#</code>, будут прерваны.
</UL>

<P>
Несколько полезных советов по использованию клиента <code>mysql</code>:

</P>
<P>
Некоторые данные более удобочитаемы при выводе их по вертикали вместо
обычно используемого горизонтального окна вывода. Например, текст, который
больше по длине, чем по ширине, и содержит в себе много новых строк, часто
намного легче читать в вертикальном представлении.

</P>

<PRE>
mysql&#62; SELECT * FROM mails WHERE LENGTH(txt) &#60; 300 lIMIT 300,1\G
*************************** 1. row ***************************
  msg_nro: 3068
     date: 2000-03-01 23:29:50
time_zone: +0200
mail_from: Monty
    reply: monty@no.spam.com
  mail_to: "Thimble Smith" &#60;tim@no.spam.com&#62;
      sbj: UTF-8
      txt: &#62;&#62;&#62;&#62;&#62; "Thimble" == Thimble Smith writes:
Thimble&#62; Hi.  I think this is a good idea.  Is anyone familiar with UTF-8
Thimble&#62; or Unicode? Otherwise, I'll put this on my TODO list and see what
Thimble&#62; happens.

Yes, please do that.
Regards,
Monty
     file: inbox-jani-1
     hash: 190402944
1 row in set (0.09 sec)
</PRE>

<P>
Для журналирования можно использовать опции команды tee. Она может
быть запущена с помощью параметра <code>--tee=...</code> для  <code>mysql</code> или
интерактивно из командной строки вводом команды <code>tee</code>. Все
представляемые на экране данные будут также добавлены к заданному
файлу. Это может быть очень полезно для целей отладки программы.
Утилиту tee можно блокировать из командной строки командой <code>notee</code>.
Повторный запуск команды <code>tee</code> снова включит журналирование. Если при
этом параметр для команды <code>tee</code> не указан, то будет использоваться
предыдущий файл. Следует учесть, что команда <code>tee</code> будет записывать
результаты в файл после каждой выполненной команды, как раз перед
появлением командной строки для ввода очередной команды.

</P>
<P>
При помощи опции <code>--pager[=...]</code> стал возможным просмотр или поиск
результатов в интерактивном режиме с помощью Unix-программ <code>less</code>, <code>more</code>
или иных подобных. Если явно не указать аргумент в этом параметре,
клиент <code>mysql</code> будет искать переменную окружения <code>PAGER</code> и установит
значение <code>pager</code>. Программу <code>pager</code> также можно запустить из интерактивной
командной строки командой <code>pager</code> и остановить командой <code>nopager</code>. Команда
может принимать аргумент, который является необязательным; <code>pager</code> будет
установлена в значение этого аргумента.. Команда <code>pager</code> может быть
вызвана и без аргумента, но это требует использования опции <code>--pager</code> 
или соответствующей установки по умолчанию стандартного вывода <code>stdout</code>.
Команда pager работает только в Unix, поскольку использует функцию
<code>popen()</code>, отсутствующую в Windows. Вместо этого в Windows можно
использовать параметр <code>tee</code>, хотя в ряде ситуаций это менее удобно, чем
применение команды <code>pager</code>.

</P>
<P>
Несколько советов касательно команды <code>pager</code>: 

<UL>
<LI>

Ее можно использовать для записи в файл:


<PRE>
mysql&#62; pager cat &#62; /tmp/log.txt
</PRE>

и результаты будут направлены только в файл. Вызываемые командой <code>pager</code>
программы могут принимать любые допустимые опции:


<PRE>
mysql&#62; pager less -n -i -S
</PRE>

<LI>

Обратите особое внимание на опцию -S в вышеприведенном примере. Она может
быть очень полезна при просмотре результатов. Попробуйте применить ее с
горизонтальным выводом (завершайте команды символами '\g', or ';') и с
вертикальным (в конце команд - '\G'). Очень громоздкие результаты вывода
иногда трудно бывает прочесть с экрана, в этом случае команда less с
опцией -S позволит просмотреть результаты в интерактивном режиме слева
направо, при этом при появлении строк с длиной больше, чем ширина экрана,
их вывод будет продолжен вывод с новой строки. Вывод данных в таких
случаях получается более удобочитаемым. При интерактивном вызове команды
less с опцией '-S' можно переключать режим ее работы (включено/выключено)
из командной строки. Чтобы получить дополнительную информацию относительно
less, обращайтесь к описанию команды 'h'.

<LI>

В заключение отметим (если вы этого еще не поняли из предыдущих
примеров :), что существует возможность комбинировать очень сложные
способы обработки результатов. Так, в следующем примере результаты
будут посланы в два различных каталога, смонтированных на двух
различных жестких дисках в /dr1 and /dr2, и, несмотря на это,
результаты можно увидеть на экране посредством команды less:


<PRE>
mysql&#62; pager cat | tee /dr1/tmp/res.txt | \
       tee /dr2/tmp/res2.txt | less -n -i -S
</PRE>

</UL>

<P>
Приведенные выше функции можно тоже комбинировать: запустив <code>tee</code> и
установив <code>pager</code> в <code>less</code>, можно просматривать результаты с помощью
Unix-команды <code>less</code> и при этом одновременно производить запись в файл.
Разница между служебной Unix-утилитой <code>tee</code>, используемой в программе
<code>pager</code>, и встроенной в клиент <code>mysql</code> командой <code>tee</code> заключается в том, что
встроенная команда <code>tee</code> работает даже в том случае, если в Unix утилита
<code>tee</code> недоступна. Встроенная команда <code>tee</code> также ведет запись всего, что
выводится на экран, тогда как утилита Unix <code>tee</code>, используемая с <code>pager</code>,
не делает этого в достаточном объеме. Последнее, но тем не менее
важное обстоятельство состоит в том, что интерактивная команда <code>tee</code>
более удобна для переключения режимов работы включено/выключено, если
при записи в файл иногда возникает необходимость отключить эту
функцию.

</P>
<P>
Начиная с версии MySQL 4.0.2 можно изменить формат приглашения в командной
строке клиента <code>mysql</code>.

</P>
<P>
<A NAME="IDX774"></A>

</P>
<P>
Возможны следующие опции приглашения:
<TABLE BORDER>
<TR><TD><strong>Опция</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD>\v </TD><TD> версия mysqld
</TD></TR>
<TR><TD>\d </TD><TD> имя используемой базы данных
</TD></TR>
<TR><TD>\h </TD><TD> имя хоста, к которому производится подсоединение
</TD></TR>
<TR><TD>\p </TD><TD> номер порта, через который производится подсоединение
</TD></TR>
<TR><TD>\u </TD><TD> имя пользователя
</TD></TR>
<TR><TD>\U </TD><TD> полный адрес username@host
</TD></TR>
<TR><TD>\\ </TD><TD> обратный слэш <samp>`\'</samp>
</TD></TR>
<TR><TD>\n </TD><TD> символ новой строки
</TD></TR>
<TR><TD>\t </TD><TD> табуляция
</TD></TR>
<TR><TD>\ </TD><TD> пробел
</TD></TR>
<TR><TD>\_ </TD><TD> пробел с подчеркиванием
</TD></TR>
<TR><TD>\R </TD><TD> время по военному часовому поясу (0-23)
</TD></TR>
<TR><TD>\r </TD><TD> время по стандартному часовому поясу (1-12)
</TD></TR>
<TR><TD>\m </TD><TD> минуты
</TD></TR>
<TR><TD>\y </TD><TD> два разряда года
</TD></TR>
<TR><TD>\Y </TD><TD> четыре разряда года
</TD></TR>
<TR><TD>\D </TD><TD> полный формат даты
</TD></TR>
<TR><TD>\s </TD><TD> секунды
</TD></TR>
<TR><TD>\w </TD><TD> день недели в трехбуквенном формате (Mon, Tue, ...)
</TD></TR>
<TR><TD>\P </TD><TD> Время до полудня/после полудня (am/pm)
</TD></TR>
<TR><TD>\o </TD><TD> месяц в числовом формате
</TD></TR>
<TR><TD>\O </TD><TD> месяц в трехбуквенном формате (Jan, Feb, ...)
</TD></TR>
<TR><TD>\c </TD><TD> Счетчик, подсчитывающий количество вводимых команд
</TD></TR>
</TABLE>

</P>
<P>
Символ <samp>`\'</samp> за которым следует любая другая буква, просто дополняет эту
букву.

</P>
<P>
Установить параметры приглашения можно следующими способами:

</P>
<DL COMPACT>

<DT><strong>В переменных окружения</strong>
<DD>
Можно установить переменную окружения <code>MYSQL_PS1</code> для строки приглашения.
Например:


<PRE>
shell&#62; export MYSQL_PS1="(\u@\h) [\d]&#62; "
</PRE>

<DT><strong><tt>`my.cnf'</tt></strong>
<DD>
<DT><strong><tt>`.my.cnf'</tt></strong>
<DD>
Можно установить опцию prompt в любом конфигурационном файле MySQL в
группе <code>mysql</code>. Например:


<PRE>
[mysql]
prompt=(\u@\h) [\d]&#62;\_
</PRE>

<DT><strong>В командной строке</strong>
<DD>
Можно установить опцию <code>--prompt</code> из командной строки утилиты <code>mysql</code>.
Например:


<PRE>
shell&#62; mysql --prompt="(\u@\h) [\d]&#62; "
(user@host) [database]&#62;
</PRE>

<DT><strong>В интерактивном режиме</strong>
<DD>
Можно также использовать команду <code>prompt</code> (или <code>\R</code>) для изменения настроек
приглашения в интерактивном режиме. Например:


<PRE>
mysql&#62; prompt (\u@\h) [\d]&#62;\_
PROMPT set to '(\u@\h) [\d]&#62;\_'

(user@host) [database]&#62;
(user@host) [database]&#62; prompt
Возвращение к исходным (по умолчанию) настройкам PROMPT в утилите mysql&#62;
mysql&#62;
</PRE>

</DL>



<H3><A NAME="mysqladmin" HREF="manual.ru_toc.html#mysqladmin">4.8.3  <code>mysqladmin</code>, Администрирование MySQL-сервера.</A></H3>

<P>
<A NAME="IDX775"></A>
<A NAME="IDX776"></A>
<A NAME="IDX777"></A>

</P>
<P>
Утилита для выполнения административных операций. Ее  синтаксис:

</P>

<PRE>
shell&#62; mysqladmin [ПАРАМЕТРЫ] command [command-option] command ...
</PRE>

<P>
Список опций, поддерживаемых вашей конкретной версией <code>mysqladmin</code>, можно
получить, выполнив команду <code>mysqladmin --help</code>.

</P>
<P>
Текущая версия <code>mysqladmin</code> поддерживает следующие команды:

</P>
<DL COMPACT>

<DT><code>create databasename</code>
<DD>
Создать новую базу данных.

<DT><code>drop databasename</code>
<DD>
Удалить базу данных и все ее таблицы.

<DT><code>extended-status</code>
<DD>
Выдает расширенный отчет о состоянии сервера (более полный, чем при
команде <code>status</code> )

<DT><code>flush-hosts</code>
<DD>
Сбросить и перезагрузить хосты.

<DT><code>flush-logs</code>
<DD>
Сбросить на диск и переоткрыть все журналы.

<DT><code>flush-tables</code>
<DD>
Закрыть все открытые таблицы.

<DT><code>flush-privileges</code>
<DD>
Перечитать таблицы привилегий.

<DT><code>kill id,id,...</code>
<DD>
Завершить потоки <code>mysql</code> с указанными <code>thread-id</code>.

<DT><code>password</code>
<DD>
Установить новый пароль для сервера баз данных. Изменить старый пароль на
новый.

<DT><code>ping</code>
<DD>
Проверить, работает ли сервер <code>mysqld</code>.

<DT><code>processlist</code>
<DD>
Показать список активных потоков на сервере.

<DT><code>reload</code>
<DD>
Перезагрузить таблицы привилегий.

<DT><code>refresh</code>
<DD>
Выполнить все табличные операции, находящиеся в буфере, закрыть и открыть
заново все системные журналы.

<DT><code>shutdown</code>
<DD>
Завершить работу сервера баз данных.

<DT><code>slave-start</code>
<DD>
Запустить подчиненный дублирующий поток.

<DT><code>slave-stop</code>
<DD>
Остановить подчиненный дублирующий поток.

<DT><code>status</code>
<DD>
Выдает краткий отчет о состоянии сервера.

<DT><code>variables</code>
<DD>
Вывести доступные для использования переменные.

<DT><code>version</code>
<DD>
Вывести данные о версии сервера.
</DL>

<P>
Все команды могут сокращаться до их уникальных префиксов. Например:

</P>

<PRE>
shell&#62; mysqladmin proc stat
+----+-------+-----------+----+-------------+------+-------+------+
| Id | User  | Host      | db | Command     | Time | State | Info |
+----+-------+-----------+----+-------------+------+-------+------+
| 6  | monty | localhost |    | Processlist | 0    |       |      |
+----+-------+-----------+----+-------------+------+-------+------+
Uptime: 10077  Threads: 1  Questions: 9  Slow queries: 0
Opens: 6 Flush tables: 1  Open tables: 2
Memory in use: 1092K  Max memory used: 1116K
</PRE>

<P>
<A NAME="IDX778"></A>

</P>
<P>
Результат команды <code>mysqladmin</code> status выводится в виде следующих столбцов:

</P>
<P>
<A NAME="IDX779"></A>
<TABLE BORDER>
<TR><TD><strong>Столбец</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD>Uptime </TD><TD> Количество секунд с момента запуска MySQL-сервера.
</TD></TR>
<TR><TD>Threads </TD><TD> Количество активных потоков (клиентов).
<A NAME="IDX780"></A>
 
</TD></TR>
<TR><TD>Questions </TD><TD> Количество вопросов от клиентов с момента запуска программы <code>mysqld</code>.
<A NAME="IDX781"></A>
 
</TD></TR>
<TR><TD>Slow queries </TD><TD> Количество запросов, потребовавших большее количество секунд, чем установлено в конфигурации ключом <code>long_query_time</code>. See section <A HREF="manual.ru.html#Slow_query_log">4.9.5  Журнал медленных запросов</A>.
<A NAME="IDX782"></A>
 
</TD></TR>
<TR><TD>Opens </TD><TD> Количество таблиц, открытых программой <code>mysqld</code>.
<A NAME="IDX783"></A>
 
</TD></TR>
<TR><TD>Flush table </TD><TD> Количество выполненных команд <code>flush</code> ..., <code>refresh</code>, <code>reload</code>.
<A NAME="IDX784"></A>
 <A NAME="IDX785"></A>
 
</TD></TR>
<TR><TD>Open  tables </TD><TD> Количество таблиц, открытых в данное время.
<A NAME="IDX786"></A>
 
</TD></TR>
<TR><TD>Memory in use </TD><TD> Память, используемая непосредственно программой <code>mysqld</code> (доступно только в случае компиляции MySQL с установленным значением <code>--with-debug=full</code>).
<A NAME="IDX787"></A>
 
</TD></TR>
<TR><TD>Max memory used </TD><TD> Максимальный объем памяти, использованный непосредственно программой mysqld (доступно только в случае компиляции MySQL с установленным значением <code>--with-debug=full</code>).
<A NAME="IDX788"></A>
 
</TD></TR>
</TABLE>

</P>
<P>
При выполнении <code>mysqladmin shutdown</code> через сокет
(другими словами, через компьютер с запущенным <code>mysqld</code>) <code>mysqladmin</code> будет
ожидать, пока на сервере MySQL не будет удален файл <code>pid-file</code> (в котором
содержится идентификатор процесса <tt>`pid'</tt> запущенного сервера) чтобы
убедиться, что сервер остановлен должным образом.

</P>


<H3><A NAME="Using_mysqlcheck" HREF="manual.ru_toc.html#Using_mysqlcheck">4.8.4  Использование <code>mysqlcheck</code> для сопровождения и аварийного восстановления таблиц.</A></H3>

<P>
Начиная с версии MySQL 3.23.38 можно применять новый инструмент для
проверки и восстановления <code>MyISAM</code>-таблиц. Отличие <code>mysqlcheck</code> от <code>myisamchk</code>
состоит в том, что утилита <code>mysqlcheck</code> должна использоваться при работающем
сервере <code>mysqld</code>, в то время как <code>myisamchk</code> - при остановленном. Преимущество
же заключается в том, что теперь не нужно останавливать сервер для
проверки или восстановления таблиц.

</P>
<P>
Утилита <code>mysqlcheck</code> использует соответствующие команды MySQL-сервера <code>CHECK</code>,
<code>REPAIR</code>, <code>ANALYZE</code> и <code>OPTIMIZE</code> удобным для пользователя образом.

</P>
<P>
Существует три альтернативных способа запуска <code>mysqlcheck</code>:

</P>

<PRE>
shell&#62; mysqlcheck [OPTIONS] database [tables]
shell&#62; mysqlcheck [OPTIONS] --databases DB1 [DB2 DB3...]
shell&#62; mysqlcheck [OPTIONS] --all-databases
</PRE>

<P>
Таким образом, утилита может использоваться подобно <code>mysqldump</code> по отношению
к выбранным базам данных и таблицам.

</P>
<P>
В сравнении с другими клиентами утилита <code>mysqlcheck</code> имеет следующую
отличительную особенность: установка поведения по умолчанию, (проверка
таблиц, <code>-с</code>), может быть изменена путем переименования исполняемого файла
утилиты. Итак, чтобы получить инструмент, восстанавливающий таблицы по
умолчанию, просто скопируйте <code>mysqlcheck</code> с новым именем, <code>mysqlrepair</code>, или,
наоборот, сделайте символьную ссылку на <code>mysqlrepair</code> и обозначьте ее как
<code>mysqlrepair</code>. Если теперь запустить <code>mysqlrepair</code>, то утилита по умолчанию
будет восстанавливать таблицы.

</P>
<P>
Для изменения поведения <code>mysqlcheck</code> по умолчанию можно использовать
следующие обозначения:

</P>

<PRE>
mysqlrepair: Значение по умолчанию будет -r
mysqlanalyze: Значение по умолчанию будет -a
mysqloptimize: Значение по умолчанию будет -o
</PRE>

<P>
Ниже приведены возможные опции для <code>mysqlcheck</code>. Какие из них поддерживает
ваша версия, можно проверить с помощью команды <code>mysqlcheck --help</code>.

</P>
<DL COMPACT>

<DT><code>-A, --all-databases</code>
<DD>
Проверить все базы данных. Аналогична опции <code>--databases</code>, если указать все
базы данных.

<DT><code>-1, --all-in-1</code>
<DD>
Вместо выполнения запросов для каждой таблицы в отдельности выполнить все
запросы в одном отдельно для каждой таблицы. Имена таблиц будут
представлены в виде списка имен, разделенных запятой.

<DT><code>-a, --analyze</code>
<DD>
Анализировать данные таблицы.

<DT><code>--auto-repair</code>
<DD>
Если проверенная таблица повреждена, автоматически восстановить ее.
Исправления будут произведены после проверки всех таблиц, если были
обнаружены повреждения.

<DT><code>-#, --debug=...</code>
<DD>
Выводит информацию журнала отладки. Часто используется следующий набор
параметров: 'd:t:o,filename'

<DT><code>--character-sets-dir=...</code>
<DD>
Директория, где находятся установки символов.

<DT><code>-c, --check</code>
<DD>
Проверить таблицу на наличие ошибок.

<DT><code>-C, --check-only-changed</code>
<DD>
Проверить только таблицы, измененные со времени последней проверки или
некорректно закрытые.

<DT><code>--compress</code>
<DD>
Использовать сжатие данных в протоколе сервер/клиент.

<DT><code>-?, --help</code>
<DD>
Вывести данную вспомогательную информацию и выйти из программы.

<DT><code>-B, --databases</code>
<DD>
Проверить несколько баз данных. Обратите внимание на разницу в
использовании: в этом случае таблицы не указываются. Все имена аргументов
рассматриваются как имена баз данных.

<DT><code>--default-character-set=...</code>
<DD>
Установить набор символов по умолчанию.

<DT><code>-F, --fast</code>
<DD>
Проверить только базы данных, которые не были закрыты должным образом.

<DT><code>-f, --force</code>
<DD>
Продолжать даже при получении ошибки SQL.

<DT><code>-e, --extended</code>
<DD>
При использовании данного параметра совместно с <code>CHECK TABLE</code> можно быть на
100 процентов быть уверенным в целостности таблицы, хотя это и займет
много времени. Если же использовать этот параметр с <code>REPAIR TABLE</code>,
запустится расширенное восстановление таблицы, которое может потребовать
не только длительного времени выполнения, но и привнесет также массу
ненужных строк!

<DT><code>-h, --host=...</code>
<DD>
Подключиться к хосту.

<DT><code>-m, --medium-check</code>
<DD>
Быстрее, чем <code>--extended-check</code>, но находит только 99,99 процентов всех
ошибок. Для большинства случаев этот вариант вполне подходит.

<DT><code>-o, --optimize</code>
<DD>
Оптимизировать таблицу.

<DT><code>-p, --password[=...]</code>
<DD>
Используемый пароль при подключении к серверу. Если пароль не указан, у
пользователя запрашивается пароль с терминала.

<DT><code>-P, --port=...</code>
<DD>
Номер порта, используемого для подключения по TCP/IP.

<DT><code><code>--protocol=(TCP | SOCKET | PIPE | MEMORY)</code></code>
<DD>
Для указания протокола соединения, который надлежит использовать. 
Новшество в  MySQL 4.1.0. 

<DT><code>-q, --quick</code>
<DD>
При использовании данной опции совместно с <code>CHECK TABLE</code> предотвращается
сканирование строк для корректировки неправильных связей. Это наиболее
быстрый метод проверки. Если же использовать этот параметр с <code>REPAIR 
TABLE</code>, программа попытается восстановить только систему индексов. Это
наиболее быстрый метод восстановления таблицы.

<DT><code>-r, --repair</code>
<DD>
Может исправить почти все, за исключением уникальных ключей, имеющих
дубликаты.

<DT><code>-s, --silent</code>
<DD>
Выводить только сообщения об ошибках.

<DT><code>-S, --socket=...</code>
<DD>
Файл сокета, используемый для подсоединения.

<DT><code>--tables</code>
<DD>
Перекрывает опцию <code>--databases</code> (<code>-B</code>).

<DT><code>-u, --user=#</code>
<DD>
Имя пользователя MySQL, если этот пользователь в данное время не является
активным.

<DT><code>-v, --verbose</code>
<DD>
Вывести информацию о различных этапах.

<DT><code>-V, --version</code>
<DD>
Вывести информацию о версии и выйти из программы.
</DL>



<H3><A NAME="mysqldump" HREF="manual.ru_toc.html#mysqldump">4.8.5  <code>mysqldump</code>, Получение дампов данных и структуры таблицы</A></H3>

<P>
<A NAME="IDX789"></A>
<A NAME="IDX790"></A>
<A NAME="IDX791"></A>
<A NAME="IDX792"></A>

</P>
<P>
Данная утилита позволяет получить дамп (``моментальный снимок'')
содержимого базы данных или совокупности баз для создания резервной копии
или пересылки данных на другой SQL-сервер баз данных (не обязательно
MySQL-сервер). Дамп будет содержать набор команд SQL для создания и/или
заполнения таблиц.

</P>
<P>
Если же резервная копия создается на сервере, то вместо описываемой
утилиты следует использовать <code>mysqlhotcopy</code>. См.раздел See section <A HREF="manual.ru.html#mysqlhotcopy">4.8.6  <code>mysqlhotcopy</code>, Копирование баз данных и таблиц MySQL</A>.

</P>

<PRE>
shell&#62; mysqldump [OPTIONS] database [tables]
или  mysqldump [OPTIONS] --databases [OPTIONS] DB1 [DB2 DB3...]
или  mysqldump [OPTIONS] --all-databases [OPTIONS]
</PRE>

<P>
Если не указывать имена таблиц или использовать параметры <code>--databases</code> или
<code>--all-databases</code>, то будет получен дамп базы данных в целом (соответственно
- всех баз данных).

</P>
<P>
Перечень опций, поддерживаемых вашей конкретной версией утилиты <code>mysqldump</code>,
можно получить, выполнив команду <code>mysqldump --help</code>.

</P>
<P>
Следует иметь в виду, что утилита <code>mysqldump</code>, используемая без опций
<code>--quick</code> или <code>--opt</code>, перед тем, как сделать дамп результата выборки
информации, загрузит весь результат в память. Это может создать проблемы
при получении дампа большой базы данных.

</P>
<P>
Учтите, что не следует применять параметры <code>--opt</code> или <code>-e</code>, если вы
собираетесь использовать для получения дампа новую копию программы
<code>mysqldump</code>, а затем воспроизводить его на очень старом MySQL-сервере.

</P>
<P>
Утилита <code>mysqldump</code> поддерживает следующие опции:

</P>
<DL COMPACT>

<DT><code>--add-locks</code>
<DD>
Добавить команды <code>LOCK TABLES</code> перед выполнением и <code>UNLOCK TABLE</code> после
выполнения каждого дампа таблицы (для ускорения доступа к MySQL).

<DT><code>--add-drop-table</code>
<DD>
Добавить команду <code>DROP TABLE</code> перед каждой командой <code>CREATE TABLE</code>.

<DT><code>-A, --all-databases</code>
<DD>
Произвести дамп всех баз данных. Аналогично опции <code>--databases</code> с указанием
всех баз данных.

<DT><code>-a, --all</code>
<DD>
Включить все опции создания объектов, специфичные для MySQL.

<DT><code>--allow-keywords</code>
<DD>
Разрешить создавать имена столбцов, которые совпадают с ключевыми словами.
Отсутствие конфликтов обеспечивается прибавлением имени таблицы в качестве
префикса к имени каждого столбца.

<DT><code>-c, --complete-insert</code>
<DD>
Использовать полные команды <code>INSERT</code> (с именами столбцов).

<DT><code>-C, --compress</code>
<DD>
Использовать сжатие всей информации между клиентом и сервером, если они
оба поддерживают сжатие.

<DT><code>-B, --databases</code>
<DD>
Выполнить дамп нескольких баз данных. Обратите внимание на разницу в
использовании: в этом случае таблицы не указываются. Все имена аргументов
рассматриваются как имена баз данных. Оператор <code>USE db_name;</code> включается в
вывод перед каждой новой базой данных.

<DT><code>--delayed</code>
<DD>
Использовать команду <code>INSERT DELAYED</code> при вставке строк.

<DT><code>-e, --extended-insert</code>
<DD>
Использовать команду <code>INSERT</code> с новым многострочным синтаксисом (повышает
компактность и быстродействие операторов ввода).

<DT><code>-#, --debug[=option_string]</code>
<DD>
Отслеживать прохождение программы (для отладки).

<DT><code>--help</code>
<DD>
Вывести справочную информацию и выйти из программы.

<DT><code>--fields-terminated-by=...</code>
<DD>
<DT><code>--fields-enclosed-by=...</code>
<DD>
<DT><code>--fields-optionally-enclosed-by=...</code>
<DD>
<DT><code>--fields-escaped-by=...</code>
<DD>
<DT><code>--lines-terminated-by=...</code>
<DD>
Эти опции используются совместно с параметром <code>-T</code> и имеют то же самое
значение, что и соответствующие операторы для <code>LOAD DATA INFILE</code>. См.
раздел See section <A HREF="manual.ru.html#LOAD_DATA">6.4.9  Синтаксис оператора  <code>LOAD DATA INFILE</code></A>.

<DT><code>-F, --flush-logs</code>
<DD>
Записать на диск данные системного журнала из буфера MySQL-сервера перед
началом выполнения дампа.

<DT><code>-f, --force,</code>
<DD>
Продолжать даже при получении ошибки SQL при выполнении дампа таблицы.

<DT><code>-h, --host=..</code>
<DD>
Выполнить дамп данных MySQL сервера на указанном хосте. Значение хоста по
умолчанию - <code>localhost</code>.

<DT><code>-l, --lock-tables.</code>
<DD>
Заблокировать все таблицы перед началом выполнения дампа. Таблицы
блокируются оператором <code>READ LOCAL</code>, чтобы разрешить параллельные записи
для <code>MyISAM</code>-таблиц. Следует отметить, что при выполнении дампа совокупности
баз данных опция <code>--lock-tables</code> блокирует таблицы каждой базы по
отдельности. Таким образом, использование этого параметра не гарантирует,
что таблицы будут логически непротиворечивы в пределах этих баз данных. В
различных базах данных при выполнении дампа таблицы могут находиться в
совершенно разных состояниях.

<DT><code>-K, --disable-keys</code>
<DD>
Добавляет выражение
<code>/*!40000 ALTER TABLE tb_name DISABLE KEYS */;</code>
и <code>/*!40000 ALTER TABLE tb_name ENABLE KEYS */;</code> 
в выводе результата. Это
ускорит загрузку данных на сервер MySQL 4.0, так как индексы создаются
после внесения всех данных.

<DT><code>-n, --no-create-db</code>
<DD>
В выводе результата выражение <code>CREATE DATABASE /*!32312 IF NOT EXISTS*/
db_name;</code> будет отсутствовать. Данная строка будет добавлена в любом случае
при использовании опций <code>--databases</code> или <code>--all-databases</code>.

<DT><code>-t, --no-create-info</code>
<DD>
Не записывать информацию о создании таблицы (команда <code>CREATE TABLE</code>).

<DT><code>-d, --no-data</code>
<DD>
Не записывать информацию из строк таблицы. Это очень полезно для получения
дампа структуры таблицы!

<DT><code>--opt</code>
<DD>
То же, что и <code>--quick --add-drop-table --add-locks --extended-insert
--lock-tables</code>. Должно дать наиболее быстрый дамп для чтения на
MySQL-сервере.

<DT><code>-pyour_pass, --password[=your_pass]</code>
<DD>
Используемый пароль при подключении к серверу. Если аргумент <code>=your_pass</code> не
введен, <code>mysqldump</code> предложит ввести пароль.

<DT><code>-P port_num, --port=port_num</code>
<DD>
Номер порта TCP/IP, используемого для подключения к хосту.

<DT><code><code>--protocol=(TCP | SOCKET | PIPE | MEMORY)</code></code>
<DD>
Для указания протокола соединения, который надлежит использовать. 
Новшество в  MySQL 4.1.0. 

<DT><code>-q, --quick</code>
<DD>
Выводить дамп непосредственно на стандартный вывод <code>stdout</code> без буферизации
запроса. Для этого используется функция <code>mysql_use_result()</code>.

<DT><code>-Q, --quote-names</code>
<DD>
Взять в кавычки имена таблиц и столбцов без символов <samp>``'</samp>.

<DT><code>-r, --result-file=...</code>
<DD>
Прямой вывод указанного файла. Этот опцию следует использовать в MS DOS,
так как она предотвращает преобразование символа новой строки '\n' в
последовательность '\n\r' (новая строка + возврат каретки).

<DT><code>--single-transaction</code>
<DD>
Данная опция выдает SQL-команду <code>BEGIN</code> перед выполнением дампа данных с
сервера. Наиболее часто используется с <code>InnoDB</code>-таблицамии и уровнем
изоляции транзакций <code>READ_COMMITTED</code>, так как именно в этом режиме можно
получить дамп с непротиворечивым состоянием базы данных после выполнения
команды <code>BEGIN</code> без блокирования каких-либо приложений. Используя эту опцию,
необходимо помнить, что при выполнении дампа только транзакционные таблицы
будут находиться в непротиворечивом состоянии, т.е. некоторые <code>MyISAM</code>- или
<code>HEAP</code>-таблицы при использовании данной опции могут все же изменить свое
состояние. 

Опция <code>--single-transaction</code> добавлена в версии 4.0.2. Она
является взаимоисключающей по отношению к опции <code>--lock-tables</code>, так как
команда <code>LOCK TABLES</code> уже принимает открытую транзакцию. 

<DT><code>-S /path/to/socket, --socket=/path/to/socket</code>
<DD>
Файл сокета для подсоединения к <code>localhost</code> (значение хоста по умолчанию).

<DT><code>--tables</code>
<DD>
Перекрывает параметр --databases (-B).

<DT><code>-T, --tab=path-to-some-directory</code>
<DD>
Для каждой заданной таблицы создает файл a <tt>`table_name.sql'</tt>, содержащий
SQL <code>CREATE</code> команды для создания таблицы, и файл <tt>`table_name.txt'</tt> с данными
таблицы. Файл <tt>`.txt'</tt> имеет формат в соответствии с параметрами <code>--fields-xxx</code> 
и <code>--lines--xxx</code>. <strong>Примечание</strong>: Этот параметр работает только при условии,
что утилита <code>mysqldump</code> запущена на том же компьютере, что и демон <code>mysqld</code>,
причем пользователь/группа, запустившие данный поток <code>mysqld</code> (обычно это
пользователь <code>mysql</code> и группа <code>mysql</code>), должны иметь право
создавать/записывать файл по указанному адресу.

<DT><code>-u user_name, --user=user_name</code>
<DD>
Имя пользователя MySQL-сервера, используемое при подключении к серверу.
Значением по умолчанию является имя пользователя Unix.

<DT><code>-O var=option, --set-variable var=option</code>
<DD>
Установить значения переменных. Доступные для использования переменные
перечислены ниже. В MySQL 4.0 просто используйте <code>--var=option</code>. 

<DT><code>-v, --verbose</code>
<DD>
Расширенный режим вывода. Вывод более детальной информации о работе
программы.

<DT><code>-V, --version</code>
<DD>
Вывести информацию о версии и выйти из программы.

<DT><code>-w, --where='where-condition'</code>
<DD>
Выполнить дамп только выбранных записей. Обратите внимание, что кавычки
обязательны.


<PRE>
"--where=user='jimf'" "-wuserid&#62;1" "-wuserid&#60;1"
</PRE>

<DT><code>-X, --xml</code>
<DD>
Представляет дамп базы данных в виде XML.

<DT><code>-x, --first-slave</code>
<DD>
Блокирует все таблицы во всех базах данных.

<DT><code>-O net_buffer_length=#, where # &#60; 16M</code>
<DD>
При создании многострочных операторов ввода (как и в случаях применения
параметров <code>--extended-insert</code> или <code>--opt</code>) утилита <code>mysqldump</code> будет создавать
строки длиной вплоть до указанной в <code>net_buffer_length</code>. При увеличении
значения этой переменной необходимо также убедиться в том, что в
MySQL-сервере для переменной <code>max_allowed_packet</code> указано значение больше,
чем величина <code>net_buffer_length</code>.
</DL>

<P>
Чаще всего утилита <code>mysqldump</code> используется для получения резервной копии
всех баз данных. See section <A HREF="manual.ru.html#Backup">4.4.1  Резервное копирование баз данных</A>.

</P>

<PRE>
mysqldump --opt database &#62; backup-file.sql
</PRE>

<P>
Можно, наоборот, прочитать этот файл на MySQL-сервере посредством команды:

</P>

<PRE>
mysql database &#60; backup-file.sql
</PRE>

<P>
или

<PRE>
mysql -e "source /patch-to-backup/backup-file.sql" database
</PRE>

<P>
Данная утилита достаточно часто используется и для переноса информации из
базы данных на другой MySQL-сервер:

</P>

<PRE>
mysqldump --opt database | mysql --host=remote-host -C database
</PRE>

<P>
Вполне возможно получить дамп нескольких баз данных с помощью одной
команды:

</P>

<PRE>
mysqldump --databases database1 [database2 ...] &#62; my_databases.sql
</PRE>

<P>
Если необходим дамп всех баз данных, можно использовать:

</P>

<PRE>
mysqldump --all-databases &#62; all_databases.sql
</PRE>



<H3><A NAME="mysqlhotcopy" HREF="manual.ru_toc.html#mysqlhotcopy">4.8.6  <code>mysqlhotcopy</code>, Копирование баз данных и таблиц MySQL</A></H3>

<P>
<A NAME="IDX793"></A>
<A NAME="IDX794"></A>
<A NAME="IDX795"></A>
<A NAME="IDX796"></A>

</P>
<P>
Утилита <code>mysqlhotcopy</code> представляет собой Perl-сценарий, использующий
SQL-команды <code>LOCK TABLES</code>, <code>FLUSH TABLES</code> и Unix-утилиты <code>cp</code> или <code>scp</code> для
быстрого получения резервной копии базы данных. Пожалуй, это наиболее
быстрый способ копирования баз данных или таблиц, но он
может работать только на том же компьютере, где расположены каталоги
копируемой базы данных.

</P>

<PRE>
mysqlhotcopy db_name [/path/to/new_directory]
mysqlhotcopy db_name_1 ... db_name_n /path/to/new_directory
mysqlhotcopy db_name./regex/
</PRE>

<P>
Утилита <code>mysqlhotcopy</code> поддерживает следующие опции:

</P>
<DL COMPACT>

<DT><code>-?, --help</code>
<DD>
Показать окно справки и выйти из программы.

<DT><code>-u, --user=#</code>
<DD>
Имя пользователя для входа в базу данных.

<DT><code>-p, --password=#</code>
<DD>
Используемый пароль при подсоединении к серверу.

<DT><code>-P, --port=#</code>
<DD>
Номер порта, используемого для подсоединения к локальному серверу.

<DT><code>-S, --socket=#</code>
<DD>
Номер сокета, используемого для подсоединения к локальному серверу.

<DT><code>--allowold</code>
<DD>
Не делать прерывания, если объект уже существует (переименовать в it_old).

<DT><code>--keepold</code>
<DD>
Не удалять предыдущий результат (только что переименованный) после
выполнения команды.

<DT><code>--noindices</code>
<DD>
Не включать обширные индексные файлы в копию, чтобы сделать дубликат
меньше по размеру и более быстрым. Индексы можно реконструировать позже с
помощью команды <code>myisamchk -rq</code>.

<DT><code>--method=#</code>
<DD>
Метод копирования (<code>cp</code> или <code>scp</code>).

<DT><code>-q, --quiet</code>
<DD>
Выводить только сообщения об ошибках.

<DT><code>--debug</code>
<DD>
Разрешить отладку.

<DT><code>-n, --dryrun</code>
<DD>
Сообщать о действиях без их выполнения.

<DT><code>--regexp=#</code>
<DD>
Копировать все базы данных с именами, встречающимися в функции regexp.

<DT><code>--suffix=#</code>
<DD>
Суффикс для имен скопированных баз данных.

<DT><code>--checkpoint=#</code>
<DD>
Внести проверочную запись в предусмотренную таблицу базы данных.

<DT><code>--flushlog</code>
<DD>
Записать на диск данные журналов из буфера, как только все таблицы
заблокируются.

<DT><code>--tmpdir=#</code>
<DD>
Временная директория (вместо <tt>`/tmp'</tt>).
</DL>

<P>
Более полное описание данного сценария можно посмотреть в документации по
языку программирования Perl.

</P>
<P>
Сценарий <code>mysqlhotcopy</code> берет информацию для групп <code>[client]</code> и <code>[mysqlhotcopy]</code> 
из файлов опций.

</P>
<P>
Для выполнения программы <code>mysqlhotcopy</code> необходимы доступ для записи в
директорию, куда будет помещена копия, и привилегия выполнения команды
<code>SELECT</code> для копируемых таблиц и команды <code>RELOAD</code> для MySQL-сервера (чтобы
выполнить <code>FLUSH TABLES</code>).

</P>


<H3><A NAME="mysqlimport" HREF="manual.ru_toc.html#mysqlimport">4.8.7  <code>mysqlimport</code>, импорт данных из текстовых файлов</A></H3>

<P>
<A NAME="IDX797"></A>
<A NAME="IDX798"></A>
<A NAME="IDX799"></A>
<A NAME="IDX800"></A>
<A NAME="IDX801"></A>

</P>
<P>
Утилита <code>mysqlimport</code> обеспечивает интерфейс командной строки для
SQL-оператора <code>LOAD DATA INFILE</code>. Большинство параметров <code>mysqlimport</code>
полностью соответствует аналогичным параметрам для оператора <code>LOAD DATA
INFILE</code>. See section <A HREF="manual.ru.html#LOAD_DATA">6.4.9  Синтаксис оператора  <code>LOAD DATA INFILE</code></A>.

</P>
<P>
Утилита <code>mysqlimport</code> вызывается следующим образом:

</P>

<PRE>
shell&#62; mysqlimport [параметры] database textfile1 [textfile2 ...]
</PRE>

<P>
Для каждого текстового файла, указанного в командной строке, <code>mysqlimport</code>
удаляет расширение в каждом имени файла и использует его, чтобы
определить, в какую таблицу занести содержимое. Например, файлы с именами
<tt>`patient.txt'</tt>, <tt>`patient.text'</tt> и <tt>`patient'</tt> должны быть все занесены в таблицу с
именем <tt>`patient'</tt>.

</P>
<P>
Утилита <code>mysqlimport</code> поддерживает следующие опции:

</P>
<DL COMPACT>

<DT><code>-c, --columns=...</code>
<DD>
Эта опция принимает в качестве аргумента список разделенных запятыми имен
полей. Данный список полей используется для создания соответствующей
команды <code>LOAD DATA INFILE</code>, которая затем посылается в MySQL. 
See section <A HREF="manual.ru.html#LOAD_DATA">6.4.9  Синтаксис оператора  <code>LOAD DATA INFILE</code></A>.

<DT><code>-C, --compress</code>
<DD>
Использовать компрессию в связи между клиентом и сервером, если они оба
поддерживают сжатие.

<DT><code>-#, --debug[=option_string]</code>
<DD>
Отслеживать прохождение программы (для отладки).

<DT><code>-d, --delete</code>
<DD>
Удалить данные из таблицы перед импортированием текстового файла.

<DT><code>--fields-terminated-by=...</code>
<DD>
<DT><code>--fields-enclosed-by=...</code>
<DD>
<DT><code>--fields-optionally-enclosed-by=...</code>
<DD>
<DT><code>--fields-escaped-by=...</code>
<DD>
<DT><code>--lines-terminated-by=...</code>
<DD>
Эти опции аналогичны соответствующим операторам для <code>LOAD DATA INFILE</code>.
See section <A HREF="manual.ru.html#LOAD_DATA">6.4.9  Синтаксис оператора  <code>LOAD DATA INFILE</code></A>.

<DT><code>-f, --force</code>
<DD>
Игнорировать ошибки. Например, если таблица для текстового файла не
существует, продолжать обработку остающихся файлов. Без параметра <code>--force</code> 
утилита <code>mysqlimport</code> прекращает работу при отсутствии таблицы.

<DT><code>--help</code>
<DD>
Вывести справочную информацию и выйти из программы.

<DT><code>-h host_name, --host=host_name</code>
<DD>
Импортировать данные в MySQL-сервер на указанном хосте. Значение хоста по
умолчанию - <code>localhost</code>.

<DT><code>-i, --ignore</code>
<DD>
См. описание для параметра <code>--replace</code>.

<DT><code>-l, --lock-tables</code>
<DD>
Заблокировать все таблицы для записи перед обработкой любых текстовых
файлов. Это обеспечивает синхронизацию всех таблиц на сервере.

<DT><code>-L, --local</code>
<DD>
Читать входящие файлы из клиента. По умолчанию предполагается, что
текстовые файлы расположены на сервере при подсоединении к <code>localhost</code>
(значение хоста по умолчанию).

<DT><code>-pyour_pass, --password[=your_pass]</code>
<DD>
Используемый пароль при подключении к серверу. Если аргумент <code>=your_pass</code> не
введен, <code>mysqlimport</code> предложит ввести пароль.

<DT><code>-P port_num, --port=port_num</code>
<DD>
Номер порта TCP/IP, используемого для подсоединения к хосту.

<DT><code><code>--protocol=(TCP | SOCKET | PIPE | MEMORY)</code></code>
<DD>
Для указания протокола соединения, который надлежит использовать. 
Новшество в  MySQL 4.1.0. 

<DT><code>-r, --replace</code>
<DD>
Опции <code>--replace</code> и <code>--ignore</code> управляют обработкой поступающих на вход
записей, которые дублируют имеющиеся записи по значениям уникальных
ключей. Если задано значение <code>--replace</code>, новые строки заменяют существующие
с тем же самым значением уникального ключа. Если задано значение <code>--ignore</code>,
входные строки, которые дублируют существующую строку по значению
уникального ключа, пропускаются. Если же ни одна из опций не задана, то
при обнаружении ключа-дубликата возникает ошибка и остаток текстового
файла игнорируется.

<DT><code>-s, --silent</code>
<DD>
Режим молчания. Выводить только сообщения об ошибках.

<DT><code>-S /path/to/socket, --socket=/path/to/socket</code>
<DD>
Файл сокета для подсоединения к <code>localhost</code> (значение хоста по умолчанию).

<DT><code>-u user_name, --user=user_name</code>
<DD>
Имя пользователя MySQL-сервера, используемое при подсоединении к серверу.
Значением по умолчанию является имя для входа в Unix.

<DT><code>-v, --verbose</code>
<DD>
Расширенный режим вывода. Вывод более детальной информации о работе
программы.

<DT><code>-V, --version</code>
<DD>
Вывести информацию о версии и выйти из программы.
</DL>

<P>
Ниже приведен пример листинга программы, использующей утилиту <code>mysqlimport</code>:

</P>

<PRE>
$ mysql --version
mysql  Ver 9.33 Distrib 3.22.25, for pc-linux-gnu (i686)
$ uname -a
Linux xxx.com 2.2.5-15 #1 Mon Apr 19 22:21:09 EDT 1999 i586 unknown
$ mysql -e 'CREATE TABLE imptest(id INT, n VARCHAR(30))' test
$ ed
a
100     Max Sydow
101     Count Dracula
.
w imptest.txt
32
q
$ od -c imptest.txt
0000000   1   0   0  \t   M   a   x       S   y   d   o   w  \n   1   0
0000020   1  \t   C   o   u   n   t       D   r   a   c   u   l   a  \n
0000040
$ mysqlimport --local test imptest.txt
test.imptest: Records: 2  Deleted: 0  Skipped: 0  Warnings: 0
$ mysql -e 'SELECT * FROM imptest' test
+------+---------------+
| id   | n             |
+------+---------------+
|  100 | Max Sydow     |
|  101 | Count Dracula |
+------+---------------+
</PRE>



<H3><A NAME="mysqlshow" HREF="manual.ru_toc.html#mysqlshow">4.8.8  <code>mysqlshow</code>, просмотр баз данных, таблиц и столбцов</A></H3>

<P>
<A NAME="IDX802"></A>
<A NAME="IDX803"></A>
<A NAME="IDX804"></A>
<A NAME="IDX805"></A>
<A NAME="IDX806"></A>

</P>
<P>
Утилита <code>mysqlshow</code> позволяет кратко ознакомиться с существующими базами
данных, их таблицами и столбцами таблиц.

</P>
<P>
Аналогичную информацию можно получить с помощью программы <code>mysql</code>, используя
команду <code>SHOW</code>. See section <A HREF="manual.ru.html#SHOW">4.5.6  Синтаксис команды <code>SHOW</code></A>.

</P>
<P>
Утилита <code>mysqlshow</code> вызывается следующим образом:

</P>

<PRE>
shell&#62; mysqlshow [ПАРАМЕТРЫ] [database [table [column]]]
</PRE>


<UL>
<LI>

Если имя базы данных не указано, то выдается список всех существующих
баз данных.

<LI>

Если не указана таблица - показываются все таблицы, найденные в этой
базе данных

<LI>

Если не задан столбец - показываются все найденные в таблице столбцы и
представленные в виде столбцов данные.
</UL>

<P>
Следует отметить, что в более новых версиях MySQL пользователь может
просмотреть только те базы/таблицы/столбцы, для которых у него имеются
соответствующие привилегии.

</P>
<P>
Если последний аргумент содержит в себе шаблонные символы (<code>*</code>, <code>?</code>,
<code>%</code> или <code>_</code>) процессора или SQL, то будут представлены только данные,
совпадающие с шаблоном.  Если имя базы данных содержит подчеркивание, то оно должно быть 
экранировано обратным слешом (некоторые оболочки в Unix востребуют два обратных
слеша) для того, чтобы получить корректные имена. <samp>`*'</samp> корвертируются в
<samp>`%'</samp> и <samp>`?'</samp> - в <samp>`_'</samp>.

</P>
<P>
Это может вызвать путаницу при попытке просмотреть
столбцы таблицы с символом <code>_</code>, так как в таком случае <code>mysqlshow</code>
покажет только имена таблиц, совпадающие с шаблоном. Ситуацию можно легко
исправить добавлением дополнительного символа <code>%</code> в конец командной строки
(как отдельного аргумента).

</P>


<H3><A NAME="mysql_config" HREF="manual.ru_toc.html#mysql_config">4.8.9  <code>mysql_config</code>, Получение опций компиляции для компиляции клиентских программ</A></H3>

<P>
<code>mysql_config</code> дает полезную информацию о том, как 
компилировать ваши клиентские программы. 

</P>
<P>
<code>mysql_config</code> поддерживает такие опции:

</P>
<DL COMPACT>

<DT><code>--cflags</code>
<DD>
Опции компилятора для поиска включаемых файлов
<DT><code>--libs</code>
<DD>
Библиотеки и опции, необходимые для линкования с клиентской библиотекой.
<DT><code>--socket</code>
<DD>
Имя сокета по умолчанию, определенное, когда конфигурировался MySQL.
<DT><code>--port</code>
<DD>
Номер порта по умолчанию, определенный, когда конфигурировался MySQL.
<DT><code>--version</code>
<DD>
Номер версии и версия для поставки MySQL.
<DT><code>--libmysqld-libs</code>
<DD>
Библиотеки и опции, необходимые для линкования с библиотекой встраиваемого сервера.
</DL>

<P>
Если вы выполняете <code>mysql_config</code> без каких-либо параметров, вы получите
все опции, которые он поддерживает плюс значение этих опций: 

</P>

<PRE>
shell&#62; mysql_config
sage: /usr/local/mysql/bin/mysql_config [OPTIONS]
Options:
        --cflags         [-I'/usr/local/mysql/include/mysql']
        --libs           [-L'/usr/local/mysql/lib/mysql' -lmysqlclient -lz -lcrypt -lnsl -lm -L/usr/lib -lssl -lcrypto]
        --socket         [/tmp/mysql.sock]
        --port           [3306]
        --version        [4.0.8-gamma]
        --libmysqld-libs [ -L'/usr/local/mysql/lib/mysql' -lmysqld -lpthread -lz -lcrypt -lnsl -lm  -lpthread  -lrt]
</PRE>

<P>
Вы можете это использовать, чтобы скопмилировать клиента MySQL таким образом: 

</P>

<PRE>
CFG=/usr/local/mysql/bin/mysql_config
sh -c "gcc -o progname `$CFG --cflags` progname.c `$CFG --libs`"
</PRE>



<H3><A NAME="perror" HREF="manual.ru_toc.html#perror">4.8.10  <code>perror</code>, разъяснение кодов ошибок</A></H3>

<P>
<A NAME="IDX807"></A>
<A NAME="IDX808"></A>

</P>
<P>
<A NAME="IDX809"></A>
<A NAME="IDX810"></A>

</P>
<P>
Для большинства системных ошибок, помимо внутреннего текстового сообщения
MySQL, можно также выводить номер кода системной ошибки в одном из
следующих стилей: <code>message ... (errno: #)</code> или <code>message ... (Errcode: #)</code>.

</P>
<P>
Выяснить, что данный код ошибки означает, можно либо путем изучения
документации на данную систему, либо воспользовавшись возможностями
утилиты <code>perror</code>.

</P>
<P>
perror выводит описание кода системной ошибки или код ошибки обработчика
таблиц <code>MyISAM</code>/<code>ISAM</code>.

</P>
<P>
<code>perror</code> вызывается следующим образом:

</P>

<PRE>
shell&#62; perror [ПАРАМЕТРЫ] [ERRORCODE [ERRORCODE...]]
</PRE>

<P>
Пример:

</P>

<PRE>
shell&#62; perror 13 64
Error code 13: Доступ запрещен
Error code 64: Компьютер не находится в сети
</PRE>

<P>
Следует учитывать, что сообщения об ошибках в большинстве своем являются
системно-зависимыми!

</P>


<H3><A NAME="Batch_Commands" HREF="manual.ru_toc.html#Batch_Commands">4.8.11  Как запускать SQL-команды из текстового файла</A></H3>

<P>
Обычно клиент <code>mysql</code> используется в интерактивном режиме, например,
следующим образом:

</P>

<PRE>
shell&#62; mysql database
</PRE>

<P>
Однако вполне можно поместить SQL команды в текстовый файл и указать <code>mysql</code>
считывать входные данные из этого файла. Для этого необходимо создать
текстовый файл <code>text_file</code>, содержащий команды, которые предстоит выполнить.
Затем запускаем <code>mysql</code> как показано ниже:

</P>

<PRE>
shell&#62; mysql database &#60; text_file
</PRE>

<P>
Можно также запустить текстовый файл с командой <code>USE db_name</code>. В этом случае
указывать имя базы данных в командной строке не обязательно:

</P>

<PRE>
shell&#62; mysql &#60; text_file
</PRE>

<P>
Если программ<code>а</code> mysql уже работает, можно запустить файл с SQL-сценарием,
используя команду <code>source</code>:

</P>

<PRE>
mysql&#62; source filename;
</PRE>

<P>
Более подробная информация по пакетному режиму работы находится в разделе
See section <A HREF="manual.ru.html#Batch_mode">3.6  Использование <code>mysql</code> в пакетном режиме</A>.

</P>


<H2><A NAME="Log_Files" HREF="manual.ru_toc.html#Log_Files">4.9  Файлы журналов MySQL</A></H2>

<P>
<A NAME="IDX811"></A>

</P>
<P>
В MySQL имеется несколько журналов, позволяющих узнать, что происходит
внутри <code>mysqld</code>:

</P>
<TABLE BORDER>
<TR><TD><strong>Журнал</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD>Журнал ошибок </TD><TD> В нем хранятся ошибки запуска, работы или завершения работы <code>mysqld</code>.
</TD></TR>
<TR><TD>Журнал isam </TD><TD> В нем хранится информация обо всех изменениях таблиц <code>ISAM</code>. Используется только при отладке кода isam.
</TD></TR>
<TR><TD>Общий журнал запросов </TD><TD> В нем хранится информация об установленных соединениях и выполненных запросах.
</TD></TR>
<TR><TD>Журнал обновлений log </TD><TD> В нем хранятся все команды, меняющие данные; в скором времени выйдет из употребления
</TD></TR>
<TR><TD>Бинарный журнал обновлений </TD><TD> В нем хранятся все меняющие что-либо команды. Используется для репликации
</TD></TR>
<TR><TD>Журнал медленных запросов </TD><TD> В нем хранятся все запросы, на выполнение которых ушло больше времени, чем указано в переменной <code>long_query_time</code> (или запросы, не использовавшие индексов).
</TD></TR>
</TABLE>

<P>
Все файлы журналов хранятся в каталоге с данными <code>mysqld</code>. С помощью команды
<code>FLUSH LOGS</code> можно заставить <code>mysqld</code> открыть файлы журналов снова (или - в
некоторых случаях - переключиться на новый файл). See section <A HREF="manual.ru.html#FLUSH">4.5.3  Синтаксис команды <code>FLUSH</code></A>.

</P>



<H3><A NAME="Error_log" HREF="manual.ru_toc.html#Error_log">4.9.1  Журнал ошибок</A></H3>

<P>
Журнал ошибок содержит информацию о том, когда запускается и останавливается mysqld, 
а также все критические ошибки, обнаруженные в процессе работы. 

</P>
<P>
В нем содержится информация о запуске и завершении работы <code>mysqld</code>, а также
обо всех серьезных ошибках, возникших во время работы. Если произойдет
неожиданное аварийное завершение работы, и <code>safe_mysqld</code> придется
перезапустить <code>mysqld</code>, <code>safe_mysqld</code> внесет в этот файл соответствующую
запись. Кроме того, в этот журнал заносится предупреждение в том случае,
если <code>mysqld</code> обнаружит таблицу, нуждающуюся в автоматической проверке или
исправлении.

</P>
<P>
Все ошибки <code>mysqld</code> записывает в <code>stderr</code>, который сценарий <code>safe_mysqld</code>
перенаправляет в файл с именем <code>'hostname'.err</code> (в Windows <code>mysqld</code> сохраняет
его в каталоге <tt>`\mysql\data\mysql.err'</tt>).

</P>

<P>
В некоторых ОС в журнал включается распечатка части стека погибшего
<code>mysqld</code>. С помощью этой информации можно определить причину сбоя (see section <A HREF="manual.ru.html#Using_stack_trace">D.1.4  Использование трассировки стека</A>).

</P>
<P>
Начиная с MySQL 4.0.10 можно указать, где именно mysqld должен сохранять журнал
ошибок, с помощью опции <code>--log-error[=filename]</code>. Если имя файла не задается,
то тогда mysqld будет использовать <code>mysql-data-dir/'hostname'.err</code> на Unix
и <tt>`\mysql\data\mysql.err'</tt> на windows.

</P>
<P>
Если вы выполняете <code>FLUSH LOGS</code> старый файл будет сохранен с префиксом
<code>--old</code> и <code>mysqld</code> создаст новый пустой журнал.

</P>
<P>
На старых версиях MySQL журнал ошибок велся скриптом mysqld_safe, который перенаправлял вывод в
файл <code>'hostname'.err</code>.  В старых версиях можно было изменить имя этого файла опцией
<code>--err-log=filename</code>.

</P>
<P>
Если вы не указываете <code>--log-error</code> или используете  опцию <code>--console</code>,
то ошибки будут выводиться на stderr (на терминал). 

</P>
<P>
На Windows вывод всегда пишется в <code>.err</code>-файл если <code>--console</code> не была указана. 

</P>


<H3><A NAME="Query_log" HREF="manual.ru_toc.html#Query_log">4.9.2  Общий журнал запросов</A></H3>

<P>
<A NAME="IDX812"></A>
<A NAME="IDX813"></A>

</P>
<P>
Если вы хотите знать обо всем, что происходит с <code>mysqld</code>, нужно запустить
систему с ключом <code>--log[=file]</code>. После этого информация обо всех соединениях
и запросах будет записываться в файл журнала (по умолчанию ему дается имя
<code>'hostname'.log</code>). Этот журнал может оказаться полезным, если вы
подозреваете наличие ошибки в клиентском ПО и хотите выяснить, что, по
мнению <code>mysqld</code>, клиент передал базе.

</P>
<P>
Старые версии скрипта <code>mysql.server</code> (с MySQL 3.23.4 по 3.23.8)
передавали <code>safe_mysqld</code> опцию <code>--log</code> (включить общий журнал запросов).
Если вам нужна большая производительность при запуске MySQL в промышленной эксплуатации, 
вы можете удалить опцию <code>--log</code> из <code>mysql.server</code> или поменять ее на
<code>--log-bin</code>. See section <A HREF="manual.ru.html#Binary_log">4.9.4  Бинарный журнал обновлений</A>.

</P>
<P>
Записи в журнал заносятся по мере получения <code>mysqld</code> запросов. Порядок их
занесения может отличаться от порядка выполнения команд. В этом и
заключается основное отличие данного журнала от журналов обновлений и
бинарных журналов, в которые информация заносится по мере выполнения
запросов, но до отмены блокировок.

</P>


<H3><A NAME="Update_log" HREF="manual.ru_toc.html#Update_log">4.9.3  Журнал обновлений (update)</A></H3>

<P>
<A NAME="IDX814"></A>
<A NAME="IDX815"></A>

</P>
<P>
<strong>Обратите внимание</strong>: журнал обновлений (update) заменен бинарным журналом
(binary) (see section <A HREF="manual.ru.html#Binary_log">4.9.4  Бинарный журнал обновлений</A>. С этим журналом можно
производить те же операции, что и с журналом обновлений.

</P>
<P>
При запуске с ключом <code>--log-update[=file_name]</code> <code>mysqld</code> создает журнал, в
который заносятся все команды SQL, обновляющие данные. Если имя файла не
задано, по умолчанию ему присваивается имя хоста. Если файлу присвоено
имя, не содержащее пути доступа к нему, этот файл сохраняется в каталоге с
данными. Если у имени <tt>`file_name'</tt> нет расширения, <code>mysqld</code> даст файлу примерно
такое имя: <tt>`file_name.###'</tt>, где <code>###</code> - номер, увеличивающийся при каждом
выполнении команд <code>mysqladmin refresh</code>, <code>mysqladmin flush-logs</code>, <code>FLUSH LOGS</code> 
или при перезапуске сервера.

</P>
<P>
<strong>Обратите внимание</strong>: чтобы вышеописанная схема могла работать, нельзя
самостоятельно создавать файлы с тем же именем, что и у журнала
обновлений, а также с некоторыми расширениями, которые могут быть
восприняты как номер, в каталоге, использующемся для хранения этого
журнала!

</P>
<P>
При запуске с ключами <code>--log</code> или <code>-l</code> <code>mysqld</code> создает общий журнал в файле с
именем <tt>`hostname.log'</tt>, причем перезапуски и обновления не приводят к
созданию нового файла журнала (хотя существующий при таких операциях
закрывается и затем открывается вновь). В таком случае скопировать его (в
Unix) можно так:

</P>

<PRE>
mv hostname.log hostname-old.log
mysqladmin flush-logs
cp hostname-old.log to-backup-directory
rm hostname-old.log
</PRE>

<P>
Журнал обновлений работает избирательно - в него попадают только те
команды, которые действительно обновляют данные. Команда <code>UPDATE</code> или
<code>DELETE</code>, выражение <code>WHERE</code> которой не находит совпадающих строк, в журнал не
заносится - как и команды <code>UPDATE</code>, присваивающие столбцам те же значения,
которые у них были до ``обновления''.

</P>
<P>
Запись в журнал осуществляется сразу по завершении работы запроса, но до
того, как будут сняты блокировки. Таким образом обеспечивается уверенность
в том, что журнал ведется именно в порядке выполнения запросов.

</P>
<P>
При желании обновить базу в соответствии с данными журналов обновлений
можно воспользоваться следующей командой (при условии, что имена файлов
журналов соответствуют форме <tt>`file_name.###'</tt>):

</P>

<PRE>
shell&#62; ls -1 -t -r file_name.[0-9]* | xargs cat | mysql
</PRE>

<P>
<code>ls</code> расставляет все файлы журналов в правильном порядке.

</P>
<P>
Эта возможность может пригодиться в случае, если возникнет необходимость
(в результате серьезного сбоя) привести базу в соответствие с резервной
копией и затем повторить все обновления, произошедшие с момента создания
копии и до сбоя.

</P>


<H3><A NAME="Binary_log" HREF="manual.ru_toc.html#Binary_log">4.9.4  Бинарный журнал обновлений</A></H3>

<P>
<A NAME="IDX816"></A>
<A NAME="IDX817"></A>

</P>
<P>
Бинарный журнал обновлений в скором времени должен полностью заменить
журнал обновлений, так что мы рекомендуем вам как можно скорее перейти на
его использование!

</P>
<P>
Бинарный журнал содержит всю информацию, имеющуюся в журнале обновлений, в
более эффективном формате. В нем имеется информация и о времени выполнения
каждого обновляющего базу запроса. В нем не содержится информации о запросах,
которые не изменяют данные. Если вам нужно журналировать все запросы (например для
выявления проблемного запроса), вам следует использовать общий журнал запросов. 
See section <A HREF="manual.ru.html#Query_log">4.9.2  Общий журнал запросов</A>.

</P>
<P>
Бинарный журнал используется и при репликации подчиненного сервера (slave)
с головного (master) (see section <A HREF="manual.ru.html#Replication">4.10  Репликация в MySQL</A>).

</P>
<P>
При запуске с ключом <code>--log-bin[=file_name]</code> <code>mysqld</code> создает файл журнала, в
который вносятся данные обо всех обновляющих данные командах SQL. Если имя
файла не задано, по умолчанию ему дается имя хоста с окончанием <code>-bin</code>. Если
файлу присвоено имя, не содержащее пути доступа к нему, этот файл
сохраняется в каталоге данных.

</P>
<P>
При вводе расширения в имя файла (например: <code>--log-bin=filename.extension</code>)
это расширение удаляется без предупреждения.

</P>
<P>
К имени файла бинарного журнала программа <code>mysqld</code> прибавляет специальное
расширение - номер, увеличивающийся при каждом выполнении команд
<code>mysqladmin refresh</code>, <code>mysqladmin flush-logs</code>, <code>FLUSH LOGS</code> или перезапуске
сервера. При достижении файлом журнала максимального размера, заданного в
параметре <code>max_binlog_size</code>, автоматически создается новый. Все неактивные
файлы бинарных журналов можно удалить командой <code>RESET MASTER</code> (see section <A HREF="manual.ru.html#RESET">4.5.4  Синтаксис команды <code>RESET</code></A>.

</P>
<P>
На выбор данных, записываемых в журнал, влияют следующие настройки <code>mysqld</code>:

</P>
<TABLE BORDER>
<TR><TD><strong>Опция</strong> </TD><TD> <strong>Описание</strong>

</TD></TR>
<TR><TD><code>binlog-do-db=database_name</code> </TD><TD>
Указывает головному серверу что он должен журналировать обновления в двоичный журнал
если текущая (т.е. выбранная) база данных - это 'database_name'. Остальные базы данных,
особо не отмеченные, игнорируются. Имейте в виду, что если вы используете эту опцию, то 
вам следует делать обновления только в этой базе данных. 
(пример: binlog-do-db=some_database) 

</TD></TR>
<TR><TD><code>binlog-ignore-db=database_name</code> </TD><TD>
Заставляет master отказаться от занесения в журнал обновлений определенной базы данных (пример: <code>binlog-ignore-db=some_database</code>)
</TD></TR>
</TABLE>

<P>
Чтобы была возможность определить, какие файлы журналов используются в
данный момент, <code>mysqld</code> создает и индексный файл, содержащий имена всех
находящихся в работе файлов. По умолчанию ему присваивается то же имя, что
и файлу журнала, но с расширением .index. Имя этого файла можно изменить с
помощью параметра <code>--log-bin-index=[filename]</code>.

</P>
<P>
При использовании репликации удалять старые файлы журналов не стоит до тех
пор, пока вы не будете уверены в том, что они никогда не понадобятся ни
одной зависимой базе. Добиться такого результата можно, запуская команду
<code>mysqladmin flush-logs</code> раз в день и затем удаляя все журналы, созданные
более 3 дней назад.

</P>
<P>
Работать с файлами бинарного журнала можно с помощью программы
<code>mysqlbinlog</code>. Обновить MySQL в соответствии с записями в журнале можно так:

</P>
<P>
<A NAME="IDX818"></A>

</P>

<PRE>
shell&#62; mysqlbinlog log-file | mysql -h server_name
</PRE>

<P>
С помощью программы <code>mysqlbinlog</code> можно даже считывать файлы журнала прямо с
удаленного сервера MySQL!

</P>
<P>
При запуске <code>mysqlbinlog</code> с ключом <code>--help</code> на экран выводится дополнительная
информация по работе с этой программой.

</P>
<P>
При работе с настройками <code>BEGIN [WORK]</code> или <code>SET AUTOCOMMIT=0</code> для резервного
копирования нужно использовать бинарный журнал, а не старый журнал
обновлений.

</P>
<P>
Занесение данных в бинарный журнал происходит сразу по завершении
исполнения запроса, но до снятия блокировок. Таким образом обеспечивается
уверенность в том, что журнал ведется именно в порядке выполнения
запросов.

</P>
<P>
Updates to non-transactional tables are stored in the binary log
immediately after execution.  

</P>
<P>
Обновления нетранзакционных таблиц сохраняются в двоичном журнале немедленно после выполнения. 
Все обновления (<code>UPDATE</code>, <code>DELETE</code> или <code>INSERT</code>), изменяющие данные в транзакционных
таблицах (например, BDB-таблицу) находятся в кэше до вызова <code>COMMIT</code>. В этот момент <code>mysqld</code> пишет
всю транзакцию целиком в двоичный журнал перед тем, как выполнить <code>COMMIT</code>. 
Каждый поток при запуске будет создавать буффер размером <code>binlog_cache_size</code> для буферизации запросов. 
Если запрос превышает этот размер, тогда поток откроет временный файл для сохранения транзакции. Временный 
файл будет удален при выходе потока.

</P>

<P>
При
запуске каждого потока создается буфер запросов, объем которого
соответствует значению параметра <code>binlog_cache_size</code>. Если запрос не
помещается в буфере, поток создаст временный файл для кэша. Временный файл
удаляется по завершении работы потока.

</P>
<P>
Параметр <code>max_binlog_cache_size</code> (по умолчанию 4Гб) позволяет ограничить
общий объем памяти, используемой для кэширования мультитранзакционного запроса.
Если транзакция больше этого - будет произведен откат. 

</P>
<P>
При использовании журнала обновлений или бинарного журнала параллельные
операции вставки будут преобразованы в нормальные операции вставки в командах <code>CREATE
... SELECT</code> и <code>INSERT ... SELECT</code>. Это сделано специально - для того, чтобы
обеспечить возможность создания точной копии таблиц путем объединения
резервной копии с журналом.

</P>


<H3><A NAME="Slow_query_log" HREF="manual.ru_toc.html#Slow_query_log">4.9.5  Журнал медленных запросов</A></H3>

<P>
<A NAME="IDX819"></A>
<A NAME="IDX820"></A>

</P>
<P>
При запуске с параметром <code>--log-slow-queries[=file_name]</code> <code>mysqld</code> создает
файл журнала, в котором сохраняются данные обо всех командах SQL, на
выполнение которых ушло больше времени, чем указано в значении параметра
<code>long_query_time</code>. Время, уходящее на первоначальную блокировку таблиц, не
включается во время исполнения запроса.

</P>
<P>
Занесение данных в журнал происходит сразу по завершении исполнения
запроса и снятия блокировок. Таким образом, порядок расположения записей
может отличаться от порядка выполнения запросов.

</P>
<P>
Если имя файла не задано, по умолчанию ему дается имя хоста с окончанием
<code>-slow.log</code>. Если файлу присвоено имя, не содержащее пути доступа к нему,
этот файл сохраняется в каталоге с данными.

</P>
<P>
Этот журнал позволяет определить запросы, на выполнение которых ушло
слишком много времени, а, значит, и обнаружить основных кандидатов на
оптимизацию. Конечно, при достижении журналом значительного объема эта
задача усложняется. В таком случае журнал можно пропустить через команду
<code>mysqldumpslow</code> и получить краткий отчет о запросах, попавших в список.

</P>
<P>
При использовании ключа <code>--log-long-format</code> на экран выводятся и запросы, не
работающие с индексами (see section <A HREF="manual.ru.html#Command-line_options">4.1.1  Параметры командной строки <code>mysqld</code></A>).

</P>


<H3><A NAME="Log_file_maintenance" HREF="manual.ru_toc.html#Log_file_maintenance">4.9.6  Обслуживание файлов журналов</A></H3>

<P>
<A NAME="IDX821"></A>
<A NAME="IDX822"></A>
<A NAME="IDX823"></A>

</P>
<P>
В MySQL предусмотрено наличие нескольких файлов журналов, позволяющих следить
за всеми аспектами работы системы (see section <A HREF="manual.ru.html#Log_Files">4.9  Файлы журналов MySQL</A>). Правда, иногда
приходится проверять, не занимают ли журналы лишнего места, и удалять ненужные.

</P>
<P>
При работе с журналами MySQL, вам, вероятнее всего, понадобится удалять их
или создавать их резервные копии, и указывать MySQL записывать данные
журналов в новые файлы (see section <A HREF="manual.ru.html#Backup">4.4.1  Резервное копирование баз данных</A>).

</P>
<P>
В системе Linux (<code>Red Hat</code>) для этого можно использовать сценарий
<code>mysql-log-rotate</code>. При установке MySQL с дистрибутива RPM этот сценарий
устанавливается автоматически. Обратите внимание: использовать журнал для
репликации необходимо с максимальной аккуратностью!

</P>
<P>
В других ОС вы можете самостоятельно создать небольшой сценарий для
обработки журналов, запускаемый из <code>cron</code>.

</P>
<P>
Заставить MySQL создать новый файл журнала можно с помощью команды
<code>mysqladmin flush-logs</code> или SQL-команды <code>FLUSH LOGS</code>. При работе с MySQL
версии 3.21 пользоваться можно только командой <code>mysqladmin refresh</code>.

</P>
<P>
Эта команда выполняет следующие действия:

</P>

<UL>
<LI>

Если используется стандартный журнал (<code>--log</code>) или журнал медленных
запросов (<code>--log-slow-queries</code>), файл журнала (<code>mysql.log</code> и
<code>`hostname`-slow.log</code> по умолчанию) закрывается и открывается вновь.
<LI>

Если используется журнал обновлений (<code>--log-update</code>), файл журнала
закрывается, после чего создается новый файл с большим номером.
</UL>

<P>
При использовании одного журнала обновлений нужно очистить журналы и
перенести их старые файлы в резервную копию. При использовании обычной
процедуры ведения журналов для этого нужно выполнить примерно
следующую последовательность команд:

</P>

<PRE>
shell&#62; cd mysql-data-directory
shell&#62; mv mysql.log mysql.old
shell&#62; mysqladmin flush-logs
</PRE>

<P>
а затем сделать резервную копию файла <code>mysql.old</code> и удалить его.

</P>


<H2><A NAME="Replication" HREF="manual.ru_toc.html#Replication">4.10  Репликация в MySQL</A></H2>

<P>
<A NAME="IDX824"></A>
<A NAME="IDX825"></A>
<A NAME="IDX826"></A>
<A NAME="IDX827"></A>

</P>

<P>
В этом разделе описаны различные функциональные возможности репликации в
MySQL. Он может служить справочником по опциям, используемым при
репликации. Здесь будет описан механизм репликации и показано, как
реализовывать репликации. В конце раздела мы дадим ответы на некоторые
часто задаваемые вопросы, а также описания проблем и способы их решения.

</P>
<P>
Рекомендуем регулярно посещать наш web-сайт по адресу
<a HREF="http://www.mysql.com/">http://www.mysql.com/</a> для ознакомления с обновлениями, произошедшими в
этом разделе. Механизм репликации постоянно улучшается, и руководство
постоянно дополняется самой свежей информацией.

</P>


<H3><A NAME="Replication_Intro" HREF="manual.ru_toc.html#Replication_Intro">4.10.1  Введение</A></H3>

<P>
К числу преимуществ, которые обеспечивает репликация, относится повышение
скорости и надежности. Чтобы обеспечить надежность, можно установить две
системы и при возникновении проблем с головным сервером переключаться на
резервную копию. Для увеличения скорости можно перенаправлять те запросы,
которые не обновляют данные, на сервер с копиями. Разумеется, это даст
эффект лишь в том случае, если запросы, не обновляющие данные,
преобладают, но, как правило, чаще всего так и бывает.

</P>
<P>
MySQL, начиная с версии 3.23.15, поддерживает односторонний внутренний
механизм репликации. Один сервер действует как головной, а другие - как
подчиненные. Обратите внимание: один сервер может играть роль головного в
одной паре и подчиненного - в другой. Головной сервер содержит двоичный
журнал обновлений (see section <A HREF="manual.ru.html#Binary_log">4.9.4  Бинарный журнал обновлений</A>) и индексный файл
двоичных журналов для протоколирования ротации двоичных журналов.
Подчиненный сервер при соединении уведомляет головной о том, в каком
состоянии он находится, начиная от последнего обновления, которое было
успешно опубликовано на подчиненный сервер. После этого подчиненный сервер
принимает обновления, а затем блокируется и ждет, пока головной сервер не
сообщит о новых обновлениях.

</P>
<P>
Обратите внимание: при реплицировании базы данных все обновления этой базы
данных должны производиться через головной сервер!

</P>
<P>
Еще одно преимущество использования механизма репликации заключается в
том, что можно иметь "живую" резервную копию системы, выполняя резервное
копирование не на головном, а на подчиненном сервере (see section <A HREF="manual.ru.html#Backup">4.4.1  Резервное копирование баз данных</A>).

</P>


<H3><A NAME="Replication_Implementation" HREF="manual.ru_toc.html#Replication_Implementation">4.10.2  Как реализована репликация: обзор</A></H3>

<P>
<A NAME="IDX828"></A>
<A NAME="IDX829"></A>

</P>
<P>
Репликация в MySQL основывается на том, что все изменения базы данных
(обновления, удаления и т.д.) протоколируются в двоичном журнале на
сервере (see section <A HREF="manual.ru.html#Binary_log">4.9.4  Бинарный журнал обновлений</A>), а подчиненный сервер читает
сохраненные запросы из двоичного журнала головного сервера и выполняет эти
запросы на своей копии данных.

</P>
<P>
<strong>Очень важно</strong> понимать, что двоичный журнал - это просто запись, начатая с
фиксированного момента времени (с момента, когда вы включаете ведение
записей в двоичном журнале). При установке каждого из подчиненных серверов
нужно будет скопировать с головного сервера все данные, существовавшие на
нем к моменту начала ведения записей в двоичном журнале. Если подчиненный
сервер будет запущен с данными, не соответствующими тем, которые
содержались на головном сервере <strong>к моменту запуска двоичного журнала</strong>, на
подчиненном сервере может произойти сбой.

</P>
<P>
В следующей таблице вы найдете информацию о совместимости головных и подчиненных серверов 
разных версий. С учетом версии 4.0, мы рекомендуем использовать одну и ту же версию
на обеих серверах, подчиненном и головном. 

</P>
<TABLE BORDER>
<TR><TD></TD><TD> </TD><TD> <strong>Головной</strong> </TD><TD> <strong>Головной</strong> </TD><TD> <strong>Головной</strong> </TD><TD> <strong>Головной</strong>
</TD></TR>
<TR><TD></TD><TD> </TD><TD> <strong>3.23.33 и новее</strong> </TD><TD> <strong>4.0.0</strong> </TD><TD> <strong>4.0.1</strong> </TD><TD> <strong>4.0.3 и новее</strong>
</TD></TR>
<TR><TD><strong>Подчиненный</strong> </TD><TD> <strong>3.23.33 и новее</strong> </TD><TD> да </TD><TD> нет </TD><TD> нет </TD><TD> нет
</TD></TR>
<TR><TD><strong>Подчиненный</strong> </TD><TD> <strong>4.0.0</strong> </TD><TD> нет </TD><TD> да </TD><TD> нет </TD><TD> нет
</TD></TR>
<TR><TD><strong>Подчиненный</strong> </TD><TD> <strong>4.0.1</strong> </TD><TD> да </TD><TD> нет </TD><TD> да </TD><TD> нет
</TD></TR>
<TR><TD><strong>Подчиненный</strong> </TD><TD> <strong>4.0.3 и новее</strong> </TD><TD> да </TD><TD> нет </TD><TD> нет </TD><TD> да
</TD></TR>
</TABLE>

<P>
<strong>Note</strong>: MySQL 4.0.2 не рекомендован для репликации.

</P>
<P>
Начиная с версии 4.0.0 для записи данных на подчиненный сервер можно
использовать команду <code>LOAD DATA FROM MASTER</code>. 
Учтите, что команда <code>LOAD DATA FROM MASTER</code> в настоящее время работает
только если все таблицы на головном сервере имеют тип <code>MyISAM</code>, и для них
будет установлена глобальная блокировка чтения, чтобы не допустить никаких
записей во время передачи таблиц от головного сервера к подчиненному.
Данное ограничение носит временный характер. Оно обусловлено тем, что мы
еще не реализовали горячее резервное копирование таблиц без блокировок.
Это ограничение мы снимем для следующих ветвей версии 4.0 - как только
будет реализовано горячее резервное копирование, которое позволит команде
<code>LOAD DATA FROM MASTER</code> работать без блокирования обновлений на головном
сервере.

</P>
<P>
Из-за вышеупомянутого ограничения рекомендуется использовать команду <code>LOAD
DATA FROM MASTER</code> только в тех случаях, если набор данных на головном
сервере относительно невелик или если для головного сервера допустима
длительная блокировка чтения. Скорость выполнения команды <code>LOAD DATA FROM
MASTER</code> для разных систем может быть различной, поэтому для грубой оценки
времени выполнения команды можно считать, что для передачи 1 Мб данных
требуется 1 секунда. Это приблизительно соответствует случаю, когда и
головной, и подчиненный серверы эквивалентны Pentium с тактовой частотой
700 МГц и связаны сетью с пропускной способностью 100 Мбит/с, а размер
индексного файла равен примерно половине размера файла данных. Разумеется,
такая прикидка дает лишь грубую приближенную оценку и в случае каждой
конкретной системы потребуются свои допущения.

</P>
<P>
После того как подчиненный сервер будут правильно сконфигурирован и
запущен, он должен легко соединиться с головным сервером и ожидать
обработки обновлений. Если головной сервер завершит работу или подчиненный
сервер потеряет связь с головным, подчиненный сервер будет пытаться
установить соединение каждый раз по истечении интервала времени,
указанного в опции <code>master-connect-retry</code> (в секундах) до тех пор, пока не
установится подсоединение и не продолжится прослушивание обновлений.

</P>
<P>
Каждый подчиненный сервер отслеживает события с момента разрыва. Головной
сервер не имеет никакой информации о том, сколько существует подчиненных
серверов, и какие из них обновлены последними данными в любой момент
времени.

</P>
<P>
В следующем разделе процесс установки головного/подчиненного серверов
рассматривается более подробно.

</P>


<H3><A NAME="Replication_HOWTO" HREF="manual.ru_toc.html#Replication_HOWTO">4.10.3  Как настроить репликацию</A></H3>

<P>
Здесь кратко описано как настроить полную репликацию вашего MySQL-сервера.
Предполагается, что реплицироваться будут все базы данных и репликация
ранее не настраивалась. Для того чтобы выполнить указанные здесь действия,
вам придется на короткое время остановить головной сервер.

</P>
<P>
Это самый простой способ установки подчиненного сервера, однако он не
единственный. Например, если уже имеется образ головного сервера, на
головном сервере уже установлен ID сервера и производятся записи в журнал,
подчиненный сервер можно установить, не останавливая головной сервер и
даже не устанавливая блокировки обновлений (за дополнительной информацией
обращайтесь к разделу See section <A HREF="manual.ru.html#Replication_FAQ">4.10.7  Часто задаваемые вопросы по репликации</A>.

</P>
<P>
Чтобы стать настоящим гуру по репликации в MySQL, советуем сначала
изучить, осмыслить и опробовать все команды, упомянутые в разделе See section <A HREF="manual.ru.html#Replication_SQL">4.10.6  SQL-команды, относящиеся к репликации</A>. Необходимо также ознакомиться с опциями
запуска репликации из файла <tt>`my.cnf'</tt> в разделе See section <A HREF="manual.ru.html#Replication_Options">4.10.5  Опции репликации в файле <tt>`my.cnf'</tt></A>.

</P>

<OL>
<LI>

Удостоверьтесь, что на головном и подчиненном(ых) серверах установлена
свежая версия MySQL. Используйте версию 3.23.29 или выше. В предыдущих
релизах применялся другой формат двоичного журнала и содержались
ошибки, которые были исправлены в более новых релизах. Большая
просьба: пожалуйста, не посылайте сообщения об ошибках, не проверив,
присутствует ли эта ошибка в последнем релизе.

<LI>

Установите на головном сервере отдельного пользователя для репликации
с привилегией <code>FILE</code> (в версиях MySQL ниже 4.0.2) или <code>REPLICATION SLAVE</code> 
в более новых версиях MySQL. У этого пользователя должно быть также
разрешение подсоединяться со всех подчиненных серверов. Если
пользователь будет выполнять только репликацию (рекомендуется), то ему
не нужно предоставлять какие-либо дополнительные привилегии. Например,
чтобы создать пользователя с именем <code>repl</code>, который может иметь доступ к
головному серверу с любого хоста, можно использовать такую команду:


<PRE>
mysql&#62; GRANT FILE ON *.* TO repl@"%" IDENTIFIED BY '&#60;password&#62;'; # головной &#60; 4.0.2
</PRE>


<PRE>
mysql&#62; GRANT REPLICATION SLAVE ON *.* TO repl@"%" IDENTIFIED BY '&#60;password&#62;'; # головной &#62;= 4.0.2
</PRE>

Если вы планируете использовать <code>LOAD TABLE FROM MASTER</code> или <code>LOAD
DATA FROM MASTER</code> (доступные с версии 4.0.0), вам также надо выделить
привилегии <code>RELOAD</code> и <code>SUPER</code> на головном сервере для вышеуказанного
пользователя. 

<LI>

Если вы используете MyISAM-таблицы, сохраните содержимое и заблокируйте модифицирующие запросы командой
<code>FLUSH TABLES WITH READ LOCK</code>.


<PRE>
mysql&#62; FLUSH TABLES WITH READ LOCK;
</PRE>

и после этого - снимите образ данных на вашем головном сервере. 

Легче всего сделать это (на Unix), создав при помощи <strong>tar</strong> архив всей
своей директории данных. Точное местоположение директории данных зависит от
вашей инсталляции.


<PRE>
tar -cvf /tmp/mysql-snapshot.tar /path/to/data-dir
</PRE>

Пользователи Windows для создания архива каталога данных могут
использовать <code>WinZIP</code> или другую подобную программу.

После того как снимок будет или прямо во время этого процесса, узнайте значения: 
имя текущего двоичного журнала и позицию на головном сервере: 


<PRE>
mysql &#62; SHOW MASTER STATUS;
+---------------+----------+--------------+-------------------------------+
| File          | Position | Binlog_do_db | Binlog_ignore_db              |
+---------------+----------+--------------+-------------------------------+
| mysql-bin.003 | 73       | test,bar     | foo,manual,sasha_likes_to_run |
+---------------+----------+--------------+-------------------------------+
1 row in set (0.06 sec)
</PRE>

Столбец <code>File</code> дает имя журнала, <code>Position</code> дает информацию о смещении в журнале
(позиции). В этом примере имя журнала - <code>mysql-bin.003</code> и смещение - <code>73</code>.
Запишите эти значения - они вам понадобятся чуть позже, когда будете
настраивать подчиненный сервер. 

Когда вы получили образ и сохранили указанную информацию, вы можете снова разрешить запись в таблицы
на головном сервере: 


<PRE>
mysql&#62; UNLOCK TABLES;
</PRE>

Если вы используете таблицы InnoDB, то в идеале было бы хорошо, чтобы вы
использовали ПО InnoDB Hot Backup. Она берет целостный снимок без установки
каких-либо блокировок на головном сервере, и сохраняет имя журнала и позицию
непосредственно в снимке, что позволит в дальнейшем использовать эту информацию
на подчиненном сервере.  Более подробная информация об этой программе доступна
на <a HREF="http://www.innodb.com/hotbackup.html">http://www.innodb.com/hotbackup.html</a>.

Без использования этой утилиты, наиболее быстрый способ получить снимок таблиц InnoDB - 
это остановить головной сервер и скопировать файлы данных, журналы, и файлы
определений формата таблицы (<tt>`.frm'</tt>). Для сохранения текущего имени файла
журнала и смещения, вам следует выполнить следующее перед остановкой сервера: 


<PRE>
mysql&#62; FLUSH TABLES WITH READ LOCK;
mysql&#62; SHOW MASTER STATUS;
</PRE>

И затем сохраните имя журнала и смещение из вывода команды 
<code>SHOW MASTER STATUS</code> так, как было показано выше. После этого 
остановите сервер без снятия блокировок с таблиц. Это нужно сделать именно так,
чтобы быть уверенным, что сервер остановится именно с тем снимком, который мы
сделали: 


<PRE>
shell&#62; mysqladmin -uroot shutdown
</PRE>

Если головной сервер был ранее запущен без опции <code>log-bin</code>, то значения
имени файла журнала и позиции будут пустыми  в выводе <code>SHOW MASTER
STATUS</code>. В этом случае, сохраните пустую строку ('') как имя файла журнала и
<code>4</code> как позицию. 

<LI>

В <tt>`my.cnf'</tt> на головном сервере добавьте к разделу <code>[mysqld]</code> записи
<code>log-bin</code> и <code>server-id=уникальный номер</code> и перезапустите сервер.
Очень важно, чтобы номер подчиненного сервера отличался от номера головного сервера.
Можно считать, что <code>server-id</code> играет роль IP-адреса - он уникально
идентифицирует сервер среди участников репликации.


<PRE>
[mysqld]
log-bin
server-id=1
</PRE>

<LI>

Добавьте в my.cnf на подчиненном сервере(ах) следующий фрагмент:


<PRE>
server-id=&#60;некоторое уникальное число между 2 и 2^32-1&#62;
</PRE>

заменяя значения в &#60;&#62; значениями, соответствующими вашей системе. Значения
<code>server-id</code> должны быть различными на каждом сервере, участвующем в
репликации. Если значение <code>server-id</code> не определено, оно будет установлено в
1, если также не определено значение <code>master-host</code>, оно будет установлено в
2. Обратите внимание, что если значение <code>server-id</code> опущено, то головной
сервер будет отказывать в соединении всем подчиненным серверам, а
подчиненный сервер - отказывать в соединении головному серверу. Таким
образом, опускать установку значения <code>server-id</code> можно лишь в случае
резервного копирования с использованием двоичного журнала.

<LI>

Когда подчиненный сервер будет работать, заставьте его забыть старую конфигурацию репликации, 
если он использовался в репликации раньше: 


<PRE>
mysql&#62; RESET SLAVE;
</PRE>

<LI>

Скопируйте данные снимка в директорию данных на подчиненном сервере
(ах). Удостоверьтесь в правильности привилегий для файлов и каталогов.
Пользователь, от имени которого запускается MySQL, должен иметь
возможность читать и записывать данные в них так же, как и на головном
сервере.

<LI>

Перезапустите подчиненный(ые) сервер(ы).

<LI>

Когда подчиненные сервера запустятся, выполните:


<PRE>
mysql&#62; CHANGE MASTER TO MASTER_HOST='&#60;имя хоста головного сервера&#62;',
 MASTER_USER='&#60;имя пользователя репликации&#62;',
 MASTER_PASSWORD='&#60;пароль репликации&#62;',
 MASTER_LOG_FILE='&#60;записанное вами имя журнала&#62;',
 MASTER_LOG_POS=&#60;записанная вами позиция&#62;;
</PRE>

заменяя значения в &#60;&#62; значениями, соответствующими вашей системе.

<LI>

Запустите поток подчиненного сервера: 


<PRE>
mysql&#62; SLAVE START;
</PRE>

</OL>

<P>
После выполнения указанных действий подчиненный(ые) сервер(ы) должен(ы)
подсоединиться к головному серверу и подгонять свои данные под любые
изменения, произошедшие на головном сервере после принятия образа.

</P>
<P>
Если не установлен идентификатор <code>server</code>-id для подчиненного сервера, в
журнальный файл регистрации ошибок будет внесена следующая ошибка:

</P>

<PRE>
Warning: one should set server_id to a non-0 value if master_host is set.
The server will not act as a slave.

(Предупреждение: если задан master_host, следует установить server_id в
ненулевое значение.
Сервер не будет работать как подчиненный сервер.)
</PRE>

<P>
Если не установлен идентификатор головного сервера, подчиненные серверы не
смогут подключиться к головному серверу.

</P>
<P>
Если подчиненный сервер по какой-либо причине не может выполнять
репликацию, соответствующие сообщения об ошибках можно найти в журнале
регистрации ошибок на подчиненном сервере.

</P>
<P>
После того как подчиненный сервер начнет выполнять репликацию, в той же
директории, где находится журнал регистрации ошибок, появится файл
<tt>`master.info'</tt>. Файл <tt>`master.info'</tt> используется подчиненным сервером для
отслеживания того, какие записи двоичных журналов головного сервера
обработаны. Не удаляйте и не редактируйте этот файл, если не уверены в
том, что это необходимо. Даже если такая уверенность есть, все равно лучше
использовать команду <code>CHANGE MASTER TO</code>.

</P>
<P>
На данном этапе у вас есть снимок, который вы можете использовать для настройки
и установки других подчиненных серверов. Чтобы сделать это, вам надо повторить
вышеописанную процедуру в части настройки подчиненного сервера. Вам не нужно
создавать еще один снимок головного сервера. 

</P>


<H3><A NAME="Replication_Features" HREF="manual.ru_toc.html#Replication_Features">4.10.4  Возможности репликации и известные проблемы</A></H3>

<P>
<A NAME="IDX830"></A>
<A NAME="IDX831"></A>
<A NAME="IDX832"></A>

</P>
<P>
Ниже приводится список поддерживаемых и не поддерживаемых при репликации
функций:

</P>

<UL>
<LI>

Реплицирование будет выполнено правильно при использовании значений
<code>AUTO_INCREMENT</code>, <code>LAST_INSERT_ID()</code> и <code>TIMESTAMP</code>.

<LI>

Если в обновлениях присутствует функция <code>RAND()</code>, реплицирование будет
выполнено некорректно. При реплицировании обновлений с функцией <code>RAND()</code> 
применяйте <code>RAND(some_non_rand_expr)</code>. В качестве аргумента
(<code>some_non_rand_expr</code> - некоторое не случайное выражение) для функции
<code>RAND()</code> можно, например, использовать функцию <code>UNIX_TIMESTAMP()</code>.

<LI>

На головном и подчиненном серверах следует использовать одинаковый
набор символов (<code>--default-character-set</code>). В противном случае могут
возникать ошибки дублирующихся ключей на подчиненном сервере,
поскольку ключ, который считается уникальным на головном сервере,
может не быть таковым при использовании другого набора символов.

<LI>

В MySQL 3.23 команда <code>LOAD DATA INFILE</code> будет выполнена корректно, если
файл во время выполнения обновления будет находиться на головном
сервере. Команда <code>LOAD LOCAL DATA INFILE</code> будет проигнорирована. В MySQL
4.0 это ограничение не присутствует - все разновидности команды <code>LOAD
DATA INFILE</code> реплицируются правильно.

<LI>

Запросы на обновление, в которых используются пользовательские
переменные, являются не безопасными для репликации (пока).

<LI>

Команды <code>FLUSH</code> не записываются в двоичный журнал и поэтому не
копируются на подчиненный сервер. Проблем при этом не возникает,
поскольку команды <code>FLUSH</code> ничего не изменяют. Однако это означает, что
при непосредственном, без использования оператора <code>GRANT</code>, обновлении
таблиц привилегий MySQL и при последующем реплицировании базы данных
привилегий <code>mysql</code> нужно выполнить команду <code>FLUSH PRIVILEGES</code> на
подчиненных серверах, чтобы новые привилегии вступили в силу.

<LI>

Временные таблицы, начиная с версии 3.23.29, реплицируются корректно,
за исключением случая, когда при прекращении работы подчиненного
сервера (не только потока подчиненного сервера) некоторые временные
таблицы остаются открытыми и используются в последующих обновлениях.
Для решения этой проблемы перед прекращением работы подчиненного
сервера выполните команду <code>SLAVE STOP</code>, проверьте, чтобы переменная
<code>Slave_open_temp_tables</code> содержала значение 0, затем выполните
<code>mysqladmin shutdown</code>. Если значение переменной <code>Slave_open_temp_tables</code>
не 0, перезапустите поток подчиненного сервера при помощи команды
<code>SLAVE START</code> и проверьте, не улучшилась ли ситуация теперь. Эта
проблема будет решаться более изящно, но придется подождать MySQL 4.0.
В более ранних версиях при использовании временных таблиц репликации
не выполняются должным образом - в таких случаях мы рекомендуем либо
обновить версию MySQL, либо перед выполнением запросов, использующих
временные таблицы, выполнить команду <code>SET SQL_LOG_BIN=0</code> на своих
клиентах.

<LI>

MySQL поддерживает лишь один головной и много подчиненных серверов. В
4.x будет добавлен алгоритм голосования, обеспечивающий автоматическое
изменение головного сервера, если что-либо будет выполняться
неправильно при текущем головном сервере. Будут также введены процессы
'агента', которые помогут выполнять распределение нагрузки путем
посылки запросов на выборки различным подчиненным серверам.

<LI>

Начиная с версии 3.23.26 стало безопасно соединять серверы
циклическими соединениями головной-подчиненный с включенной опцией
<code>log-slave-updates</code>. Однако обратите внимание: при таком способе
установки многие запросы не будут выполняться корректно, если только в
коде вашего клиента не предусмотрена обработка потенциальных проблем,
которые могут случаться при обновлениях, происходящих в различной
последовательности на различных серверах. Это означает, что если вы
сделаете установку следующим образом:

<PRE>
A - &#62; B &#62; - C - &#62; A
</PRE>

то такая установка будет работать только в том случае, если
выполняются непротиворечивые обновления между таблицами. Другими
словами, при вставке данных на серверах <code>A</code> и <code>C</code> нельзя вставлять на
сервере <code>A</code> строку, которая может иметь ключ, противоречащий строке,
вставляемой на сервере <code>C</code>. Также нельзя обновлять одинаковые строки на
двух серверах, если имеет значение порядок обновлений. Обратите
внимание: в версии 3.23.26 изменился формат журнала. Таким образом,
если версия подчиненного сервера меньше 3.23.26, сервер не сможет
считывать записи из журнала.

<LI>

Если запрос на подчиненном сервере вызывает ошибку, поток подчиненного
сервера завершится, и в файле <tt>`.err'</tt> появится соответствующее сообщение.
После этого нужно будет вручную установить соединение с подчиненным
сервером, исправить причину ошибки (например обращение к
несуществующей таблице) и затем выполнять SQL-команду <code>SLAVE START</code> 
(доступна в версии 3.23.16). При использовании версии 3.23.15
потребуется перезапустить сервер.

<LI>

Если соединение с головным сервером прервется, подчиненный сервер
попытается сразу же восстановить его, и затем в случае неудачи будет
повторять попытки через установленное в опции <code>master-connect-retry</code> 
количество секунд (по умолчанию 60). По этой причине безопасно
выключить головной сервер и после этого перезапустить его через
некоторое время. Подчиненный сервер будет также разрешать проблемы,
возникающие при аварийных отключениях электричества в узлах сети.

<LI>

Завершение работы подчиненного сервера (корректное) также является
безопасным, поскольку при этом отслеживаются события начиная от
момента остановки сервера. Но в случае некорректного отключения
сервера могут возникать проблемы, особенно, если дисковый кэш не был
синхронизирован перед ``смертью'' системы. Для того чтобы значительно
повысить эффективность своей системы обеспечения отказоустойчивости,
целесообразно приобрести хороший UPS (источник бесперебойного
питания).

<LI>

Если головной сервер слушает нестандартный порт, это нужно будет
указать также в параметре <code>master-port</code> в файле <tt>`my.cnf'</tt>.

<LI>

В версии 3.23.15 все таблицы и базы данных могут быть реплицированы.
Начиная с версии 3.23.16 появилась возможность ограничить репликацию
набором баз данных при помощи директив <code>replicate-do-db</code> в файле <tt>`my.cnf'</tt>;
можно также исключить набор баз данных из репликации при помощи
директив <code>replicate-ignore-db</code>. Обратите внимание,: в версиях MySQL до
3.23.23, имелась ошибка, из-за которой команда <code>LOAD DATA INFILE</code> 
выполнялась некорректно, если она применялась к базе данных,
исключенной из репликации.

<LI>

Начиная с версии 3.23.16 команда <code>SET SQL_LOG_BIN = 0</code> будет выключать
ведение записей о репликации в журналах (двоичных) на головном
сервере, а команда <code>SET SQL_LOG_BIN = 1</code> - включать такое ведение
записей. Для выполнения этих команд нужно иметь привилегию <code>SUPER</code> (в
MySQL 4.0.2 и выше) или <code>PROCESS</code> (в более ранних версиях MySQL).

<LI>

Начиная с версии 3.23.19 можно убрать мусор, оставшийся после
неоконченной репликации (если ее выполнение пошло не должным образом),
и начать все сначала, используя команды <code>FLUSH MASTER</code> и <code>FLUSH SLAVE</code>. В
версии 3.23.26 эти команды переименованы в RESET MASTER и RESET SLAVE
соответственно - чтобы сделать понятным их назначение. Тем не менее,
старые варианты <code>FLUSH</code> все еще работают - для обеспечения
совместимости.

<LI>

Начиная с версии 3.23.23 можно заменять головные серверы и
корректировать точку положения в журнале репликации при помощи команды
<code>CHANGE MASTER TO</code>.

<LI>

Начиная с версии 3.23.23 можно при помощи опции <code>binlog-ignore-db</code> 
уведомлять головной сервер о том, что обновления в некоторых базах
данных не должны отражаться в двоичном журнале.

<LI>

Начиная с версии 3.23.26, можно использовать опцию
<code>replicate-rewrite-db</code> для уведомления подчиненного сервера о том, что
он должен применить обновления базы данных на головном сервере к базе
данных с другим именем на подчиненном сервере.

<LI>

Начиная с версии 3.23.28 можно использовать команду <code>PURGE MASTER LOGS
TO 'имя-журнала'</code>, чтобы избавиться от старых журналов без завершения
работы подчиненного сервера. Это удалит все журналы до, но не включая <code>log-name</code>.

<LI>

Из-за того, что по своей природе таблицы <code>MyISAM</code> являются
нетранзакционными, может случиться так, что запрос обновит таблицу
только частично и возвратит код ошибки. Это может произойти, например,
при вставке нескольких строк, одна из которых нарушает ограничение
ключа, или в случае, когда длинный запрос обновления ``убивается''
после обновления некоторых строк. Если такое случится на головном
сервере, поток подчиненного сервера завершит работу и будет ждать,
пока администратор базы данных не примет решение о том, что делать в
этом случае (если только код ошибки не является легитимным и в
результате выполнения запроса не будет сгенерирована ошибка с тем же
кодом). Если такой способ проверки правильности кода ошибки
нежелателен, начиная с версии 3.23.47, некоторые (или все) ошибки
могут быть замаскированы при помощи опции <code>slave-skip-errors</code>.

<LI>

Отдельные таблицы могут исключаться из репликации при помощи опции
<code>replicate-do-table</code>/<code>replicate-ignore-tab</code> или опции
<code>replicate-wild-do-table</code>/<code>replicate-wild-ignore-table</code>. Однако в
настоящее время наличие определенных конструктивных неточностей в
некоторых довольно редких случаях может приводить к неожиданным
результатам. Протокол репликации явно не уведомляет подчиненный сервер
о том, какие таблицы должны быть изменены запросом, поэтому
подчиненному серверу требуется анализировать запрос, чтобы узнать это.
Чтобы избежать лишнего синтаксического анализа, для которого требуется
прерывать выполнение запросов, исключение таблицы в настоящее время
реализуется путем посылки запроса к стандартному анализатору MySQL для
упрощенного синтаксического анализа. Если анализатор обнаружит, что
таблица должна игнорироваться, выполнение запроса будет остановлено и
выдано сообщение об успехе. Этот подход несколько неэффективен, при
его применении чаще возникают ошибки и, кроме того, имеются две
известные ошибки в версии 3.23.49. Первая может возникнуть из-за того,
что поскольку анализатор автоматически открывает таблицу при анализе
некоторых запросов, игнорируемая таблица должна существовать на
подчиненном сервере. Другая ошибка заключается в том, что при
частичном обновлении игнорируемой таблицы поток подчиненного сервера
не заметит, что таблица должна игнорироваться, и приостановит процесс
репликации. Несмотря на то что вышеупомянутые ошибки концептуально
очень просто исправить, для этого придется изменить достаточно много
кода, что поставит под угрозу состояние стабильности ветви 3.23. Если
описанные случаи непосредственно имеют отношение к вашему приложению
(а это довольно редкий случай) - используйте опцию <code>slave-skip-errors</code>,
чтобы дать указание серверу продолжать репликации, игнорируя эти
ошибки.
</UL>



<H3><A NAME="Replication_Options" HREF="manual.ru_toc.html#Replication_Options">4.10.5  Опции репликации в файле <tt>`my.cnf'</tt></A></H3>

<P>
Для использования репликации рекомендуется MySQL 3.23.33 или выше. С более
ранними версиями тоже можно работать, но в них имеются ошибки и
отсутствуют некоторые возможности. Если у вас не самая последняя версия
MySQL, то в ней может не оказаться некоторых из упомянутых в данном
разделе опций. Все опции, появившиеся в ветви 4.0, сопровождаются
примечанием, в котором это указано. В противном случае, если интересующая
вас опция не присутствует в версии 3.23, но действительно необходима,
пожалуйста, замените версию на самую новую ветвь 3.23.

</P>
<P>
Не следует забывать о том, что ветвь 4.0 все еще находится в стадии
альфа-разработки, поэтому некоторые функции могут работать не так гладко,
как хотелось бы. Новые возможности, появившиеся в 4.0, рекомендуется
использовать так, чтобы в случае возникновения проблемы не нарушилась
работа приложения.

</P>
<P>
Как на головном, так и на подчиненном серверах нужно использовать опцию
<code>server-id</code>. Она устанавливает уникальный идентификатор репликации. Нужно
выбрать уникальное значение из диапазона от 1 до 2^32-1 для каждого
головного и подчиненного сервера, например: <code>server-id=3</code> 

</P>
<P>
В следующей таблице представлены опции, которые можно использовать для
головного сервера.

</P>
<TABLE BORDER>
<TR><TD><strong>Опция</strong> </TD><TD> <strong>Описание</strong>

</TD></TR>
<TR><TD><code>log-bin=filename</code> </TD><TD>
Указывает местоположение двоичного журнала обновлений, в котором будут вестись
записи. Обратите внимание: если передаваемый параметр имеет расширение
(например <code>log-bin=/mysql/logs/replication.log</code>), то в случае вызова
команды <code>FLUSH LOGS</code> версии MySQL ниже 3.23.24 не будут правильно работать
во время репликации. Эта проблема устранена в версии 3.23.25. Теперь, если
используется такой способ определения имени журнала, команда <code>FLUSH LOGS</code>
для двоичных журналов будет игнорироваться. Для очистки журнала выполните
команду <code>FLUSH MASTER</code> и не забудьте запустить команду <code>FLUSH SLAVE</code>
на всех подчиненных серверах. В версии 3.23.26 или выше нужно использовать для
этого команды <code>RESET MASTER</code> и <code>RESET SLAVE</code> 
Вы можете использовать эту опци. если вы хотите иметь имя, которое будет независимо
от имени хоста (может быть полезно, скажем, если вы переименуете ваш сервер в один прекрасный день).

</TD></TR>
<TR><TD><code>log-bin-index=filename</code> </TD><TD>
Так как пользователь может выполнять
команду <code>FLUSH LOG</code>, нужно знать, какой
журнал является активным в настоящее
время, а также какие журналы
использовались ранее и в какой
последовательности они сменялись. Эта
информация сохранена в индексном файле
двоичного журнала, имя которого по
умолчанию <tt>`имя_хоста.index'</tt>. Имя и
содержимое данного файла не следует
изменять.

Пример: <code>log-bin-index=db.index</code> 

</TD></TR>
<TR><TD><code>sql-bin-update-same</code> </TD><TD>
Если включена данная опция, то при
установке значения переменной <code>SQL_LOG_BIN</code>
это же значение будет автоматически
установлено и для переменной
<code>SQL_LOG_UPDATE</code>, и наоборот.

</TD></TR>
<TR><TD><code>binlog-do-db=database_name</code> </TD><TD>
Указывает головному серверу, что он
должен вести записи об обновлениях в
двоичном журнале, если текущая база
данных - <code>database_name</code>. Все другие базы
данных игнорируются. Обратите внимание:
при использовании этой опции вы должны
быть уверены, что обновления будут
производиться только в текущей базе
данных.

Пример: <code>binlog-do-db=sales</code> 

</TD></TR>
<TR><TD><code>binlog-ignore-db=database_name</code> </TD><TD>
Указывает головному серверу, что если
текущая база данных - <code>database_name</code>, то
записи об обновлениях не должны вестись в
двоичном журнале. Обратите внимание: при
использовании этой опции вы должны быть
уверены, что обновления будут
производиться только в текущей базе
данных.

Пример: <code>binlog-ignore-db=accounting</code> 
</TD></TR>
</TABLE>

<P>
В следующей таблице представлены опции, которые можно использовать для
подчиненного сервера:

</P>
<TABLE BORDER>
<TR><TD><strong>Опция</strong> </TD><TD> <strong>Описание</strong>

</TD></TR>
<TR><TD><code>master-host=host</code> </TD><TD>
Имя хоста головного сервера или IP-адрес для
репликации. Если значение этой опции не
установлено, поток подчиненного сервера не будет
запущен. Обратите внимание: установка <code>master-host</code> 
будет игнорироваться, если существует корректный
файл <tt>`master.info'</tt>. Возможно, лучше было бы назвать
эти опции как-нибудь иначе, что-то вроде
<code>bootstrap-master-host</code>, но менять их имена уже
поздно.

Пример: <code>master-host=db-master.mycompany.com</code> 

</TD></TR>
<TR><TD><code>master-user=username</code> </TD><TD>
Имя пользователя, которое подчиненный сервер будет
использовать для аутентификации при подсоединении
к головному серверу. Пользователь должен иметь
привилегию <code>FILE</code>. Если пользователь головного
сервера не установлен, будет использовано имя
пользователя <code>test</code>. Если удастся считать значение
из файла <tt>`master.info'</tt>, то оно будет иметь больший
приоритет.

Пример: <code>master-user=scott</code> 

</TD></TR>
<TR><TD><code>master-password=password</code> </TD><TD>
Пароль, который будет использоваться при
подсоединении подчиненного сервера к головному
серверу. Если этот пароль не установлен, будет
использоваться пустой пароль. Если удастся считать
значение из файла <tt>`master.info,'</tt> то оно будет иметь
больший приоритет.

Пример: <code>master-password=tiger</code> 

</TD></TR>
<TR><TD><code>master-port=portnumber</code> </TD><TD>
Порт, который слушает головной сервер. Если не он
не установлен, используется откомпилированная
установка <code>MYSQL_PORT</code>. Это должно быть значение
<code>3306</code>, если оно не было изменено при помощи опций
<code>configure</code>. Если удастся считать значение из файла
<tt>`master.info'</tt>, то оно будет иметь больший приоритет

Пример: <code>master-port=3306</code>

</TD></TR>
<TR><TD><code>master-connect-retry=seconds</code> </TD><TD>
Время ожидания в секундах для потока подчиненного
сервера перед повторением попытки установить связь
с головным сервером в случае прекращения работы
головного сервера или потери связи. По  умолчанию
- 60.

Пример: <code>master-connect-retry=60</code> 

</TD></TR>
<TR><TD><code>master-ssl</code> </TD><TD>
Доступна для версий выше 4.0.0. Включает SSL для
репликации. Это относительно новая опция, поэтому
применять ее следует осторожно.

Пример: <code>master-ssl</code>

</TD></TR>
<TR><TD><code>master-ssl-key</code> </TD><TD>
Доступна для версий выше 4.0.0. Имя файла-ключа
SSL на головном сервере. Используется только в том
случае, если включена опция <code>master-ssl</code>.

Пример: <code>master-ssl-key=SSL/master-key.pem</code>

</TD></TR>
<TR><TD><code>master-ssl-cert</code> </TD><TD>
Доступна для версий выше 4.0.0. Имя
файла-сертификата SSL. Используется только в том
случае, если включена опция <code>master-ssl</code>.

Пример: <code>master-ssl-key=SSL/master-cert.pem</code>

</TD></TR>
<TR><TD><code>master-info-file=filename</code> </TD><TD>
Местоположение файла, в который записывается
информация о том, где на головном сервере
произошла остановка во время выполнения
репликации. По умолчанию это файл <tt>`master.info'</tt> в
директории данных. Изменять это местоположение нет
необходимости.

Пример: <code>master-info-file=master.info</code>

</TD></TR>
<TR><TD><code>report-host</code> </TD><TD>
Доступна для версий выше 4.0.0. Имя хоста или
IP-адрес подчиненного сервера, который передается
головному серверу во время регистрации
подчиненного сервера. Может быть выведен командой
<code>SHOW SLAVE HOSTS</code>. Не устанавливайте эту опцию,
если не хотите, чтобы подчиненный сервер
регистрировался на головном сервере. Обратите
внимание: для того, чтобы головной сервер
установил соединение с подчиненным сервером, ему
недостаточно просто получить IP-адрес подчиненного
сервера из соединения. Из-за <code>NAT</code> и других проблем
маршрутизации IP-адрес может быть недопустимым для
подсоединения головного сервера или других хостов
к подчиненному серверу.

Пример: <code>report-host=slave1.mycompany.com</code>

</TD></TR>
<TR><TD><code>report-port</code> </TD><TD>
Доступна для версий выше 4.0.0. Порт для
соединения с подчиненным сервером, имя хоста или
IP-адрес которого были переданы головному серверу
при регистрации подчиненного сервера. Порт нужно
устанавливать лишь в том случае, когда подчиненный
сервер слушает порт, который задан не по
умолчанию, или если имеется специальный тоннель от
головного сервера или других клиентов к
подчиненному серверу. Не используйте эту опцию,
если не уверены в своих действиях.

</TD></TR>
<TR><TD><code>replicate-do-table=db_name.table_name</code> </TD><TD>
Сообщает подчиненному серверу, что он должен
реплицировать только указанную таблицу. Для
указания более чем одной таблицы директиву следует
использовать несколько раз, по одному разу для
каждой таблицы. В отличие от <code>replicate-do-db</code>,
данную опцию можно применять для обновлений, в
которых используется несколько баз данных.

Пример: <code>replicate-do-table=some_db.some_table</code>

</TD></TR>
<TR><TD><code>replicate-ignore-table=db_name.table_name</code> </TD><TD>
Указывает подчиненному серверу, что команды, обновляющие эту таблицу, 
не должны реплицироваться. Для указания
более чем одной таблицы директиву следует задавать
несколько раз, по одному разу для каждой таблицы.
В отличие от <code>replicate-do-db</code>,  данную опцию можно
применять для обновлений, в которых используется
несколько баз данных.

Пример: <code>replicate-ignore-table=db_name.some_table</code>

</TD></TR>
<TR><TD><code>replicate-wild-do-table=db_name.table_name</code> </TD><TD>
Указывает подчиненному серверу, что должны реплицироваться только те
запросы, где хоть одна из таблиц удовлетворяет указанном шаблону.  Для указания
более чем одной таблицы директиву следует задавать несколько раз, по одному
разу для каждой таблицы.  Данную опцию можно применять для обновлений, в
которых используется несколько баз данных.  Пример: при использовании
<code>replicate-wild-do-table=foo%.bar%</code> будут реплицироваться обновления
только таблиц с именами, начинающимися с ``bar'', которые находятся в базах
данных, с именами, начинаются с ``foo''.

Заметьте, что если вы используете <code>replicate-wild-do-table=foo%.%</code> тогда
это правило также распространяется и на <code>CREATE DATABASE</code> и на <code>DROP
DATABASE</code>, т.е. эти два выражения также будут реплицированы если имя базы
данных совпадет с шаблоном (<code>'foo%'</code> в этом примере; это получается из-за
того, что символ <code>%</code> становится шаблонным).

</TD></TR>
<TR><TD><code>replicate-wild-ignore-table=db_name.table_name</code> </TD><TD>
Указывает подчиненному серверу, запросы, где используется одна из перечисленных здесь таблиц, 
реплицироваться не должны. Для указания более чем
одной подлежащей игнорированию таблицы директиву
следует задавать несколько раз, по одному разу для
каждой таблицы. Данную опцию можно применять для
обновлений, в которых используется несколько баз
данных. Например, при использовании
<code>replicate-wild-do-table=foo%.bar%</code> не будут
реплицироваться обновления всех таблиц,
начинающихся на ``bar'', в базах данных, имена
которых начинаются на ``foo''.

</TD></TR>
<TR><TD><code>replicate-ignore-db=database_name</code> </TD><TD>
Сообщает подчиненному серверу, что не следует реплицировать ни 
один запрос, в котором текущая база данных - <code>database_name</code>.  Чтобы
указать более одной базы данных, директиву следует использовать несколько раз,
по одному разу для каждой базы данных. 

Вы не должны использовать эту директиву,
если вы используете кросс-табличные обновления, и не хотите чтобы 
эти обновления реплицировались. 

Основная причина такого поведения заключается в том, что очень трудно 
из самой команды понять, должен ли этот запрос реплицироваться или нет. 
Например, если вы используете многотабличное удаление или многотабличное обновление
в MySQL 4.x, которое охватывает более чем одну базу данных.
Кроме того, достаточно быстро можно проверить, является ли текущая база данных 
соответствующей, т.к. эта проверка выполняется только на момент соединения или смены базы данных. 

Если такие обновления необходимо производить, убедитесь, что у вас установлена
версия MySQL 3.23.28 или выше и используйте
<code>replicate-ignore-db=db_name.%</code>.

Пример: <code>replicate-ignore-db=some_db</code> 

</TD></TR>
<TR><TD><code>replicate-do-db=database_name</code> </TD><TD>
Сообщает подчиненному серверу, что реплицироваться
должна только указанная база данных. Чтобы указать
более одной базы данных, директиву следует
использовать несколько раз, по одному разу для
каждой базы данных. Заметьте, что не будут реплицироваться
обновления, охватывающие несколько баз данных, такие как
<code>UPDATE some_db.some_table SET foo='bar'</code> при том, что выбрана другая база данных или не выбрана вовсе.

Если такие обновления необходимо производить, убедитесь, что у вас установлена
версия MySQL 3.23.28 или выше и используйте
<code>replicate-wild-do-table=db_name.%</code>.

Пример: <code>replicate-do-db=some_db</code>

</TD></TR>
<TR><TD><code>log-slave-updates</code> </TD><TD>
Указывает подчиненному серверу, чтобы тот вел
записи об обновлениях, происходящих на подчиненном
сервере, в двоичном журнале. По умолчанию эта
опция выключена. Ее следует включить, если
требуется организовать подчиненные серверы в
гирляндную цепь.

</TD></TR>
<TR><TD><code>replicate-rewrite-db=from_name-&#62;to_name</code> </TD><TD>
Обновления производятся не в подлинную базу
данных, а в базу данных с именем, указанным в
опции.

Пример: <code>replicate-rewrite-db=master_db_name-&#62;slave_db_name</code> 

</TD></TR>
<TR><TD><code>slave-skip-errors= [err_code1,err_code2,... | all]</code> </TD><TD>
Доступна только в версии 3.23.47 и выше. Сообщает
потоку  подчиненного сервера, что он должен
продолжать репликацию, если запрос возвращает
ошибку, указанную в списке. Обычно при
возникновении ошибки выполнение реплицирование
прекращается, чтобы пользователь мог вручную
исправить несоответствия в данных. Не используйте
данную опцию, если вы до конца не разобрались в
причинах возникновения ошибок. Если не было
допущено ошибок при установке репликации, нет
ошибок в клиентских программах и нет никаких
ошибок непосредственно в MySQL, то прекращения
работы из-за ошибки происходить не должно.
Неразборчивое применение данной опции может
привести к тому, что подчиненный сервер окажется
безнадежно не синхронизированным с головным
сервером, и вы будете тщетно ломать себе голову
над тем, каким образом это случилось. Код ошибок
можно получить в сообщениях об ошибках в журнале
ошибок и в выводе команды <code>SHOW SLAVE STATUS</code>.
Полный список сообщений об ошибках можно найти в
файле исходного дистрибутива
<tt>`Docs/mysqld_error.txt'</tt>. Можно также (но не нужно)
использовать значение <code>all</code> (хотя этого делать
настоятельно не рекомендуется) - тогда будут
игнорироваться все сообщения об ошибках и за
процессом переброски данных наблюдения не будет.
Само собой разумеется, при использовании этой
опции целостность данных ставится под угрозу. В
этом случае просьба не жаловаться, если данные на
подчиненном сервере не будут соответствовать
данным на головном сервере, - вас предупреждали.

Пример: <code>slave-skip-errors=1062,1053</code> или
<code>slave-skip-errors=all</code>

</TD></TR>
<TR><TD><code>skip-slave-start</code> </TD><TD>
Указывает компьютеру, на котором установлен
подчиненный сервер, что при его запуске не должен
запускаться подчиненный сервер. Пользователь может
запустить его позже при помощи команды <code>SLAVE START</code>.                                          

</TD></TR>
<TR><TD><code>slave_compressed_protocol=#</code> </TD><TD>
Если 1, то использовать сжание в клиент/серверном протоколе связи, 
если оба, и сервер и клиент, поддерживают сжатие. 

</TD></TR>
<TR><TD><code>slave_net_timeout=#</code> </TD><TD>
Время ожидания (в секундах) дополнительных данных
от головного сервера, после чего чтение будет
прервано.
</TD></TR>
</TABLE>



<H3><A NAME="Replication_SQL" HREF="manual.ru_toc.html#Replication_SQL">4.10.6  SQL-команды, относящиеся к репликации</A></H3>

<P>
<A NAME="IDX833"></A>
<A NAME="IDX834"></A>
<A NAME="IDX835"></A>

</P>
<P>
Управление репликацией производится командами SQL. Ниже приводится краткое
описание команд:

</P>
<TABLE BORDER>
<TR><TD><strong>Команда</strong> </TD><TD> <strong>Описание</strong>

</TD></TR>
<TR><TD><code>SLAVE START</code> </TD><TD> Запускает поток подчиненного сервера (подчиненный сервер)

</TD></TR>
<TR><TD><code>SLAVE STOP</code> </TD><TD> Завершает поток подчиненного сервера. Также как и <code>SLAVE START</code>, этот оператор можно использовать с опциями
<code>IO_THREAD</code> и <code>SQL_THREAD</code>. (подчиненный сервер)

</TD></TR>
<TR><TD><code>SET SQL_LOG_BIN=0</code> </TD><TD> Блокирует ведение записей в журналах
обновлений, если пользователь имеет привилегию <code>SUPER</code>. В противном случае ничего
не выполняет (головной сервер)

</TD></TR>
<TR><TD><code>SET SQL_LOG_BIN=1</code> </TD><TD> Отменяет блокировку ведения записей в
журналах обновлений, если пользователь имеет привилегию <code>SUPER</code>. В противном
случае ничего не выполняет (головной сервер)

</TD></TR>
<TR><TD><code>SET GLOBAL SQL_SLAVE_SKIP_COUNTER=n</code> </TD><TD> Пропускает последующие n событий
на головном сервере. Опция допустима, если поток подчиненного сервера не
запущен, в противном случае будет выдана ошибка. Полезна для восстановления
после сбоев репликации.

</TD></TR>
<TR><TD><code>RESET MASTER</code> </TD><TD> Удаляет все двоичные журналы, перечисленные в
индексном файле, и делает индексный файл двоичных журналов пустым. Для версий
ниже 3.23.26 используйте команду <code>FLUSH SLAVE</code> (головной сервер)

</TD></TR>
<TR><TD><code>RESET SLAVE</code> </TD><TD> Заставляет подчиненный сервер "забыть" свою
точку положения репликации в журналах головного сервера. Для версий ниже
3.23.26 эта команда называется <code>FLUSH SLAVE</code> (подчиненный сервер)

</TD></TR>
<TR><TD><code>LOAD TABLE tblname FROM MASTER</code> </TD><TD> Загружает копию таблицы из
головного на подчиненный сервер. Используется главным образом для отладки
команды <code>LOAD DATA FROM MASTER</code>, но некоторые "пользователи-гурманы" могут найти
ей и другие применения. Если вы относите себя к числу обычных, не отягощенных
хакерскими амбициями пользователей, данную опцию применять не стоит.
Требуется, чтобы у пользователя репликации, использущегося в соединении с головным
сервером, присутствовали привилегии <code>RELOAD</code> и <code>SUPER</code> на головном сервере. 
(подчиненный  сервер).

</TD></TR>
<TR><TD><code>LOAD DATA FROM MASTER</code> </TD><TD> Присутствует в версиях выше 4.0.0.
Создает образ головного сервера и копирует его на подчиненный сервер. 
Требуется, чтобы у пользователя репликации, использущегося в соединении с головным
сервером, присутствовали привилегии <code>RELOAD</code> и <code>SUPER</code> на головном сервере.
Обновляет
значения <code>MASTER_LOG_FILE</code> и <code>MASTER_LOG_POS</code> таким образом, чтобы подчиненный
сервер начинал репликацию из конкретной позиции. Будет обрабатывать ограничения
таблиц и баз данных, указанные в опциях <code>replicate-*</code>. При этом, пока происходит
создание образа, могут использоваться лишь таблицы <code>MyISAM</code> и требуется
глобальная блокировка чтения на головном сервере. В будущем планируется
обеспечить работу этой команды с таблицами <code>InnoDB</code> и устранить необходимость
глобальной блокировки чтения при помощи  интерактивного резервного копирования,
не требующего блокировки.

Заметьте, <code>LOAD DATA FROM MASTER</code> <strong>НЕ</strong> копирует ни одну таблицу в
базе данных mysql.  Это сделано для того, чтобы было легко управлять разными
пользователями на головном и подчиненном серверах. 

</TD></TR>
<TR><TD><code>CHANGE MASTER TO master_def_list</code> </TD><TD>

Заменяет параметры головного сервера значениями, заданными в списке
<code>master_def_list</code>, и перезапускает поток подчиненного сервера. <code>master_def_list</code> -
это список с разделителем-запятой, содержащий значения <code>master_def</code>, где
<code>master_def</code> - одно из следующих значений: <code>MASTER_HOST, MASTER_USER,
MASTER_PASSWORD, MASTER_PORT, MASTER_CONNECT_RETRY, MASTER_LOG_FILE,
MASTER_LOG_POS</code>. Например:


<PRE>
CHANGE MASTER TO
   MASTER_HOST='master2.mycompany.com',
   MASTER_USER='replication',
   MASTER_PASSWORD='bigs3cret',
   MASTER_PORT=3306,
   MASTER_LOG_FILE='master2-bin.001',
   MASTER_LOG_POS=4;
</PRE>

Следует указывать только те значения, которые подлежат изменению. Не указанные
значения останутся неизменными, за исключением тех случаев, когда изменяется
хост или порт. В этом случае подчиненный сервер считает, что поскольку
изменяется хост или порт, головной сервер становится другим. Следовательно,
старые значения и точки положения в журнале будут автоматически заменены на
значение пустой строки и <code>0</code> соответственно (начальные значения). Обратите
внимание: если подчиненный сервер перезапускается, он сохраняет "память" о
своем последнем головном сервере. Если это нежелательно, можно перед
перезапуском удалить файл <tt>`master.info'</tt> - тогда подчиненный сервер будет
считывать информацию о своем головном сервере из файла <tt>`my.cnf'</tt> или из командной
строки. Эта команда используется для настройки подчиненного сервера при наличии
образа головного сервера, а также записей из журнала и сдвига головного
сервера, которые соответствуют образу. Можно выполнить команду


<PRE>
CHANGE MASTER TO
   MASTER_LOG_FILE='log_name_on_master',
   MASTER_LOG_POS=log_offset_on_master 
</PRE>

на подчиненном сервере после восстановления образа (подчиненный сервер)

</TD></TR>
<TR><TD><code>SHOW MASTER STATUS</code> </TD><TD> Выводит информацию о состоянии головного
сервера, исходя из информации в двоичных журналах (головной сервер)

</TD></TR>
<TR><TD><code>SHOW SLAVE HOSTS</code> </TD><TD> Присутствует в версии 4.0.0 и выше. Выводит
список подчиненных серверов, связанных в текущее время с головным сервером
(подчиненный сервер)

</TD></TR>
<TR><TD><code>SHOW SLAVE STATUS</code> </TD><TD> Выводит информацию о состоянии существенных
параметров потока подчиненного сервера (головной сервер)

</TD></TR>
<TR><TD><code>SHOW MASTER LOGS</code> </TD><TD> Присутствует только начиная с версии
3.23.28.  Выводит список двоичных журналов головного сервера. Эту команду
следует использовать перед вызовом команды <code>PURGE MASTER LOGS TO</code> для определения
того, какие из журналов можно удалить  (головной сервер)

</TD></TR>
<TR><TD><code>SHOW BINLOG EVENTS [ IN 'logname' ] [ FROM pos ] [LIMIT [offset,] rows ]</code>
@tab Показывает события в двоичном журнале обновлений. Преимущественно
применяется для тестирования/отладки, но может также использоваться и для
обычных клиентов, по какой-либо причине нуждающихся в чтении содержимого
двоичных журналов (головной сервер).

</TD></TR>
<TR><TD><code>SHOW NEW MASTER FOR SLAVE
WITH
MASTER_LOG_FILE='logfile'
AND MASTER_LOG_POS=pos AND
MASTER_LOG_SEQ=log_seq AND
MASTER_SERVER_ID=server_id</code> </TD><TD> 
Эта команда используется, когда подчиненному
серверу, связанному с головным сервером,
который, возможно, является "мертвым" или
недоступным, нужно отключить репликации на
другом подчиненном сервере, связанном с тем же головным сервером. Команда
возвратит пересчитанные координаты репликации (имя файла журнала и позицию в
нем), и вывод этой команды может использоваться в последующей команде
<code>CHANGE MASTER TO</code>. Обычным пользователям данная команда, как правило,
никогда не понадобится: она главным образом служит для внутреннего
использования в отказобезопасном репликационном коде. В будущем возможны
изменения синтаксиса опции, если будет найден более интуитивно понятный способ
описания этой операции.

</TD></TR>
<TR><TD><code>PURGE MASTER LOGS TO 'logname'</code> </TD><TD>
Присутствует начиная с версии 3.23.28.
Удаляет все журналы репликации, которые
перечислены в индексном файле журналов до
передаваемого журнала, и удаляет их из
индексного файла журналов. Таким образом
передаваемый журнал становится первым в
индексном файле журналов. Пример:


<PRE>
PURGE MASTER LOGS TO 'mysql-bin.010'
</PRE>

Эта команда не выполнит никаких действий и
возвратит ошибку, если имеется активный
подчиненный сервер, который в текущее время
читает данные из одного из журналов, который
должен быть удален. Однако если имеется
бездействующий подчиненный сервер и
происходит удаление одного из журналов,
который он хочет прочитать, то после того,
как подчиненный сервер "поднимется", он
станет неспособным к репликации. Команда
может быть безопасно выполнена на подчиненных
серверах во время процесса репликации - не
нужно останавливать процесс. Сначала
необходимо проверить все подчиненные серверы
при помощи команды <code>SHOW SLAVE STATUS</code>, чтобы
увидеть, какой журнал используется, затем
вывести список журналов головного сервера при
помощи команды <code>SHOW MASTER LOGS</code>, найти самый
ранний журнал среди всех подчиненных серверов
(если все подчиненные серверы получили
последние обновления, это будет последний
журнал в списке), сделать резервные копии
всех журналов, которые должны быть удалены
(необязательно), и очистить все до целевого
журнала.
</TD></TR>
</TABLE>



<H3><A NAME="Replication_FAQ" HREF="manual.ru_toc.html#Replication_FAQ">4.10.7  Часто задаваемые вопросы по репликации</A></H3>

<P>
<strong>Вопрос:</strong> Как сконфигурировать подчиненный сервер, если головной сервер уже
запущен, и я не хочу его останавливать?

</P>
<P>
<strong>Ответ:</strong> Есть несколько возможностей. Если имеется резервная копия головного
сервера в некоторой точке, имя двоичного журнала и сдвиг (от вывода <code>SHOW
MASTER STATUS</code>), соответствующий образу, выполните следующие действия:

</P>

<UL>
<LI>

Удостоверьтесь, что подчиненному серверу назначен уникальный
идентификатор.

<LI>

Выполните  команды  <code>CHANGE MASTER TO MASTER_HOST='master-host-name',
MASTER_USER='master-user-name', MASTER_PASSWORD='master-pass',
MASTER_LOG_FILE='recorded-log-name', MASTER_LOG_POS=recorded_log_pos</code>

<LI>

Выполните команду <code>SLAVE START</code>
</UL>

<P>
Если нет резервной копии головного сервера, существует быстрый способ
создать ее в той же последовательности действий:

</P>

<UL>
<code>FLUSH TABLES WITH READ LOCK</code>

<LI>

<code>gtar zcf /tmp/backup.tar.gz /var/lib/mysql</code> (или разновидность данной
команды)

<LI>

<code>SHOW MASTER STATUS</code> - удостоверьтесь в том что вывод этой команды
сохранен - он пригодится позже

<LI>

<code>UNLOCK TABLES</code>
</UL>

<P>
После этого следуйте инструкциям для случая, когда имеется образ, имя
двоичного журнала и сдвиг. Можно использовать один и тот же образ для
конфигурации нескольких подчиненных серверов. Пока существуют двоичные
журналы головного сервера, установить подчиненный сервер можно через
несколько дней, а то и через месяц - при наличии образа головного сервера.
Теоретически промежуток ожидания может быть бесконечным. На практике
существуют два ограничения - дисковое пространство головного сервера,
которое будет занято старыми журналами, и время, которое потребуется
подчиненному серверу, чтобы догнать головной сервер.

</P>
<P>
В версии 4.0.0 и выше можно также использовать команду <code>LOAD DATA FROM
MASTER</code>. Это удобная команда, которая создает образ, восстанавливает его на
подчиненном сервере и сразу же корректирует имя журнала и сдвиг на
подчиненном сервере. Именно команду <code>LOAD DATA FROM MASTER</code> можно
рекомендовать как способ установки подчиненного сервера. Имейте в виду,
однако, что при использовании данной команды чтение может быть блокировано
на долгое время. В настоящее время эта команда еще не реализована
настолько эффективно, как бы нам хотелось. Если имеются большие таблицы,
пока лучше использовать локальный архив tar после выполнения команды <code>FLUSH
TABLES WITH READ LOCK</code>.

</P>
<P>
<code>В</code>: Должен ли подчиненный сервер постоянно быть подсоединен к головному
серверу?

</P>
<P>
<code>О</code>: Нет, не должен. Можно прекращать работу подчиненного сервера или
оставлять его отсоединенным на несколько часов или даже дней, затем
повторно подгонять подчиненный сервер к произошедшим обновлениям, и
затем снова отсоединять или останавливать его на некоторое время.
Таким образом можно, например, использовать установку
"головной-подчиненный"  через коммутационную связь, работающую в
течение коротких периодов времени. При такой реализации, однако,
нельзя гарантировать, что в какое-либо заданное время подчиненный
сервер будет синхронизирован с головным сервером, если вы для этого не
примете специальных мер. В будущем будет добавлена опция для
блокировки головного сервера до тех пор, пока хотя бы один подчиненный
сервер находится в синхронизации с ним.

</P>
<P>
<code>В</code>: Как заставить головной сервер блокировать обновления, пока
происходит соединение с подчиненным сервером?

</P>
<P>
<code>О</code>: Выполните следующие команды:

</P>

<UL>

<LI>

Головной  сервер: <code>FLUSH TABLES WITH READ LOCK</code>
<LI>

Головной сервер: <code>SHOW MASTER STATUS</code> - запомните имя журнала и сдвиг
<LI>

Подчиненный сервер: <code>SELECT MASTER_POS_WAIT('recorded_log_name',
recorded_log_offset</code>) После выполнения этой команды подчиненный сервер
будет синхронизирован с головным сервером
<LI>

Головной сервер: <code>UNLOCK TABLES</code> - теперь головной сервер может
продолжить обновления.
</UL>

<P>
<code>В</code>: Почему иногда после перезапуска подчиненного сервера я вижу более
одного потока <code>Binlog_Dump</code> на головном сервере?

</P>
<P>
<code>О:</code> Поток <code>Binlog_Dump</code> является непрерывным процессом, который
обрабатывается сервером следующим способом:

</P>

<UL>
<LI>

Осуществляется захват обновлений.

<LI>

Если не остается больше обновлений, входит в число
<code>pthread_cond_wait()</code>, откуда его можно "пробудить", выполнив
следующее обновление, или уничтожить.

<LI>

После пробуждения проверяется причина пробуждения. Если нет причины
прекращения цикла, цикл <code>Binlog_dump</code> продолжается.

<LI>

При возникновении какой-либо фатальной ошибки, такой как обнаружение
"мертвого" клиента, цикл прекращается.
</UL>

<P>
Таким образом, если поток подчиненного сервера прекратится на подчиненном
сервере, соответствующий поток <code>Binlog_Dump</code> на головном сервере не будет
замечать этого, пока не произойдет по крайней мере одного обновления на
головном сервере (или уничтожения потока), которое необходимо, чтобы
пробудить его из числа <code>pthread_cond_wait()</code>. Тем временем подчиненный
сервер может открыть другое соединение, результатом которого будет другой
поток <code>Binlog_Dump</code>.

</P>
<P>
Эта проблема не должна присутствовать в версии 3.23.26 и более поздних
версиях. В версии 3.23.26 для каждого репликационного сервера добавляется
идентификатор <code>server-id</code>, и теперь все старые процессы-зомби на головном
сервере уничтожаются при присоединении нового репликационного потока из
того же самого подчиненного сервера.

</P>
<P>
<code>В</code>: Как прокручивать журналы репликации?

</P>
<P>
<code>О</code>: В версии 3.23.28 нужно использовать команду <code>PURGE MASTER LOGS TO</code> после
определения тех журналов, которые должны быть удалены, и выборочно сделать
резервные копии этих журналов. В более ранних версиях этот процесс намного
более трудоемкий, и не может быть безопасно выполнен без остановки всех
подчиненных серверов, если планируется повторное использование имен
журналов. Нужно будет остановить потоки подчиненного сервера,
отредактировать индексный файл двоичного журнала, удалить все старые
журналы, перезапустить головной сервер, запустить потоки подчиненного
сервера и затем удалить файлы старых журналов.

</P>
<P>
<code>В</code>: Как сделать апгрейд сервера во время репликации?

</P>
<P>
<code>О</code>: Если модернизируемая версия ниже 3.23.26, нужно лишь блокировать
таблицы головного сервера, позволить подчиненному серверу подогнать
обновления, затем выполнить команду <code>FLUSH MASTER</code> на головном сервере и
команду <code>FLUSH SLAVE</code> на подчиненном сервере, чтобы очистить журналы,
затем перезапустить новые версии на головном и подчиненном серверах.
Обратите внимание: подчиненный сервер может останавливаться на
некоторое время - пока головной сервер записывает в журнал все
обновления, подчиненный сервер будет способен подогнать обновления как
только сможет начать работу и подсоединиться к головному серверу.

</P>
<P>
В версиях выше 3.23.26 осуществляется блокировка протокола репликации для
обновлений. Таким образом можно делать апгрейд до более свежей версии 3.23
головного и подчиненного серверов динамически. Помимо этого, на головном и
подчиненном серверах могут быть запущены различающиеся версии MySQL, если
обе версии выше 3.23.26.

</P>
<P>
<code>Q</code>: Какие проблемы могут возникать при установке двухсторонней
репликации?

</P>
<P>
<code>A</code>: В настоящее время для репликаций MySQL не поддерживается никакого
протокола блокировки между головным и подчиненным сервером, который
обеспечивал бы неделимость распределенных (междусерверных) обновлений.
Другими словами, клиент A может делать обновления на головном сервере
1, и в это же время, перед тем, как эти обновления скопируются на
головной сервер 2, клиент B может делать обновления на головном
сервере 2, из-за которых обновления клиента A будут выполняться не
так, как на головном сервере 1 компании. Таким образом, когда
обновления, сделанные клиентом A, будут перенесены на головной сервер
2, таблицы, полученные в результате, будут отличаться от таблиц на
головном сервере 1. В этом случае таблицы на двух серверах будут
разными, даже если обновления, произошедшие на головном сервере 2,
также будут скопированы на головной сервер 1. Отсюда следует, что не
стоит соединять в цепочку два сервера двусторонней репликационной
связью, если вы не уверены, что обновления будут безопасно выполняться
в любом порядке, или если вы не обрабатываете каким-либо образом такие
неупорядоченные обновления где-либо в клиентском коде.

</P>
<P>
Важно понять также и то, что если двухсторонний механизм репликации и
повышает производительность, то не настолько, что это могло бы отразиться
на обновлениях. Каждый из серверов должен выполнять такое же количество
обновлений, как и один сервер, разве что уменьшатся конфликты при
блокировках, потому что обновления, происходящие на другом сервере, будут
сериализованы в одном потоке подчиненного сервера. Эта выгода, тем не
менее, может быть компенсирована задержками в сети.

</P>
<P>
<A NAME="IDX836"></A>
<A NAME="IDX837"></A>
<code>Q</code>: Как использовать репликацию для повышения производительности
системы?

</P>
<P>
<code>A</code>: Установите один сервер как головной и направляйте все записи к
нему, а также сконфигурируйте такое количество подчиненных серверов,
на какое у вас хватит средств и дискового пространства, и распределите
чтение между головным сервером и подчиненными серверами. Можно также
запустить подчиненные серверы с опциями <code>--skip-bdb</code>,
<code>--low-priority-updates</code> и <code>--delay-key-write=ALL</code>, чтобы
получить увеличение скорости на подчиненном сервере. В данном случае
подчиненный сервер для повышения скорости будет использовать
нетранзакционные таблицы <code>MyISAM</code> вместо таблиц <code>BDB</code>.

</P>
<P>
<code>Q</code>: Что нужно сделать, чтобы подготовить свой клиентский код для
использования репликации, повышающей производительность?

</P>
<P>
<code>A</code>: Если та часть вашего кода, которая отвечает за доступ к базе
данных, является достаточно абстрактной и модульной, преобразование ее
для работы с установленной репликацией произойдет очень гладко и
просто - для этого нужно лишь изменить реализацию доступа для чтения к
базе данных от некоторого подчиненного сервера или головного сервера
так, чтобы запись всегда производилась на головной сервер. Если же ваш
код не имеет такого уровня абстракции, то установка системы репликации
окажется для вас хорошей и мотивированной возможностью почистить свой
код. Начните с создания библиотеки или оболочки со следующими
функциями:

</P>

<UL>
<LI><code>Safe_writer_connect()</code>

<LI><code>Safe_reader_connect()</code>

<LI><code>Safe_reader_query()</code>

<LI><code>Safe_writer_query()</code>

</UL>

<P>
Префикс <code>safe_</code> означает, что функция будет нести ответственность за
обработку всех возникающих ошибок.

</P>
<P>
После этого нужно преобразовать клиентский код так, чтобы он использовал
библиотеку  оболочки. Вначале все это покажется лишней головной болью, но
в конечном счете ваши усилия окупятся. Все приложения, построенные в
соответствии с приведенной выше схемой, смогут "приобщиться" к
преимуществам решения один головной/много подчиненных. Код будет гораздо
легче поддерживать, а добавление опций поиска неисправностей станет
тривиальным. К примеру, если вам захочется узнать, какой запрос среди
многих тысяч возвращает ошибку или реализовать регистрацию
продолжительности выполнения каждого запроса, то понадобится изменить
всего пару функций. Если у вас уже написано много кода, то для
автоматизации задачи его преобразования можно использовать написанную
Монти  утилиту <code>replace</code>, которая имеется в стандартном дистрибутиве MySQL,
или написать собственный сценарий на Perl. Остается надеяться, что ваш код
удовлетворяет некоторой распознаваемой схеме. В противном случае будет
лучше переписать его каким-либо образом, или, по крайней мере, вручную
подогнать его под схему.

</P>
<P>
Обратите внимание: имена функций, конечно же, можно использовать любые.
Важно иметь унифицированный интерфейс для подключения для чтения,
подсоединения для записи, выполнения чтения и выполнения записи.

</P>
<P>
<code>Q</code>: В каких случаях репликация MySQL может улучшить производительность
системы, и насколько?

</P>
<P>
<code>A</code>: Механизм репликации MySQL наиболее эффективен для системы, где чтение
производится часто, а запись - редко. Теоретически, используя установку
один головной/много подчиненных, можно наращивать ее, добавляя подчиненные
серверы, пока не исчерпается пропускная способность сети или количество
обновлений не вырастет настолько, что головной сервер не сможет
обрабатывать их.

</P>
<P>
Чтобы определить какое количество подчиненных серверов можно установить,
прежде чем выгоды от дополнительных ресурсов не перестанут оправдывать
затраты, и насколько увеличится производительность вашего сайта, нужно
знать структуру запросов и опытным путем (тестированием) определить связь
между производительностью чтения (количество считываний за секунду, или
<code>max_reads</code>) и записи (<code>max_writes</code>) на типовом головном сервере и типовом
подчиненном сервере. В приведенном примере показан достаточно упрощенный
подсчет того, что можно получить, используя механизм репликации для
предполагаемой системы.

</P>
<P>
Предположим, что загрузка системы состоит из 10% операций записи и 90%
операций чтения, и известно что <code>max_reads = 1200 - 2 * max_writes</code>, или
другими словами, наша система, не делая записей, может делать 1200
операций чтения за секунду, средняя скорость записи вдвое ниже, чем
средняя скорость чтения,  а зависимость между этими величинами линейная.
Предположим, что головной сервер и подчиненный сервер имеют одинаковую
мощность, и имеется N подчиненных серверов и 1 головной. Тогда для каждого
сервера (головного или подчиненного) имеем:

</P>
<P>
<code>reads = 1200 - 2 * writes</code> (по результатам тестирования)

</P>
<P>
<code>reads = 9 * writes / (N + 1)</code> (операции чтения распределяются по серверам,
но запись выполняются на всех серверах)

</P>
<P>
<code>9 * writes/(N+1) + 2 * writes = 1200</code>

</P>
<P>
<code>writes = 1200/(2 + 9/(N+1)</code>

</P>
<P>
Таким образом, если N = 0, что означает отсутствие репликации, система
может обрабатывать 1200/11, т.е. около 109 записей в секунду (а число
операций чтения, в соответствии с нашими допущениями для данной системы,
будет в 9 раз больше, чем число операций записи).

</P>
<P>
Если N = 1, можно получить 184 операций записи в секунду.

</P>
<P>
Если N = 8, можно получить до 400 операций записи в секунду.

</P>
<P>
Если N = 17, то - 480 операций записи в секунду.

</P>
<P>
В конечном счете, если N приближается к бесконечности (а бюджет к минус
бесконечности), можно получить около 600 записей в секунду, при этом
производительность системы увеличится приблизительно в 5,5 раз. Однако при
использовании лишь 8 серверов производительность уже увеличивается почти в
4 раза.

</P>
<P>
Обратите внимание: в приведенных вычислениях мы принимали, что сеть имеет
неограниченную пропускную способность, и пренебрегали некоторыми другими
факторами, которые могут оказаться существенными для системы. Во многих
случаях такие подсчеты могут и не дать точного прогноза того, как
отразится на системе добавление N подчиненных серверов. Однако определить,
улучшат ли репликации производительность вашей системы, а если да, то
насколько, вам помогут ответы на следующие вопросы:

</P>

<UL>
<LI>

Каково отношение числа операций чтения к числу операций записи в вашей
системе?

<LI>

Насколько увеличится количество записей, которые сможет обрабатывать
один сервер, при уменьшении количества операций чтения?

<LI>

Сколько подчиненных серверов можно установить при текущей пропускной
способности сети?
</UL>

<P>
<code>Q</code>: Как использовать репликацию для обеспечения избыточности и хорошей
доступности?

</P>
<P>
<code>A</code>: С учетом сегодняшних возможностей репликации нужно будет установить
головной сервер и подчиненный сервер (или несколько подчиненных
серверов), и написать сценарий для мониторинга головного сервера - для
определения, включен ли он, и уведомления приложения и подчиненных
серверов об изменениях головного сервера в случае ошибки. Ниже
приведено несколько советов:

</P>

<UL>
<LI>

Для уведомления подчиненного сервера об изменениях головного сервера
используйте команду <code>CHANGE MASTER TO</code>.

<LI>

Хороший способ информирования приложений о местоположении головного
сервера - иметь на головном сервере динамической компонент DNS. При
использовании <code>bind</code> для динамического обновления DNS можно применять
<code>nsupdate</code>.

<LI>

Запустите подчиненные серверы с опцией <code>log-bin</code>, но без
<code>log-slave-updates</code>. Таким образом подчиненный сервер будет готов стать
головным сервером после выполнения команд <code>STOP SLAVE; RESET MASTER</code> и 
<code>CHANGE MASTER TO</code>  на других подчиненных серверах. Указание этой опции 
обеспечит также возможность перехвата ложных обновлений, которые могут
происходить из-за ошибочной конфигурации подчиненного сервера (в
идеале можно настроить права доступа таким образом, чтобы никакой
клиент не мог производить обновления на подчиненном сервере иначе, чем
через поток подчиненного сервера) в сочетании с ошибками в клиентских
программах (они никогда не должны производить обновления на
подчиненном сервере непосредственно).
</UL>

<P>
В настоящее время мы работаем над интеграцией системы автоматического
выбора головного сервера в MySQL, но пока эта функция не будет готова,
придется создавать собственные средства контроля.

</P>

<P>
<strong>Q</strong>: Каким образом подчиненный сервер сохраняет информацию о том, где он находится на головном сервер? 

</P>
<P>
<strong>A</strong>: Подчиненный сервер использует файл в каталоге данных, определенный 
в опции <code>master-info-file=filename</code>. В этом файле находится вся информация, 
необходимая подчиненному сервер для запроса новых обновлений. Этот файл содержит следующую информацию: 

</P>
<TABLE BORDER>
<TR><TD><strong>Номер строки</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD>1 </TD><TD> Имя файла двоичного журнала
</TD></TR>
<TR><TD>2 </TD><TD> Позиция в файле журнала
</TD></TR>
<TR><TD>3 </TD><TD> Удаленный компьютер (головной сервер)
</TD></TR>
<TR><TD>4 </TD><TD> Пользователь
</TD></TR>
<TR><TD>5 </TD><TD> Пароль
</TD></TR>
<TR><TD>6 </TD><TD> Порт
</TD></TR>
<TR><TD>7 </TD><TD> Интервал в секундах между соединениями
</TD></TR>
</TABLE>



<H3><A NAME="Replication_Problems" HREF="manual.ru_toc.html#Replication_Problems">4.10.8  Поиск неисправностей репликации</A></H3>

<P>
Если вы следовали инструкциям, но установленный механизм репликации не
работает, прежде всего следует искать пользовательские ошибки. Выполните
следующие проверки:

</P>

<UL>
<LI>

Производит ли головной сервер записи в двоичный журнал? Проверьте это
при помощи команды <code>SHOW MASTER STATUS</code>. Если да, значение <code>Position</code>
будет отличным от нуля. Если нет, проверьте, запущен ли головной
сервер с опцией <code>log-bin</code> и установлен ли <code>server-id</code>.

<LI>

Запущен ли подчиненный сервер? Проверьте это при помощи команды <code>SHOW
SLAVE STATUS</code>. Ответ находится в столбце <code>Slave_running</code>. Если нет,
проверьте опции подчиненного сервера и просмотрите сообщения в журнале
ошибок.

<LI>

Если подчиненный сервер запущен, установил ли он соединение с головным
сервером? Выполните команду <code>SHOW PROCESSLIST</code>, найдите поток, которому
соответствует значение <code>system user</code> в столбце <code>User</code> и <code>none</code> в столбце
<code>Host</code>, и проверьте столбец <code>State</code>. Если в нем находится значение
<code>connecting to master</code>, проверьте привилегии для пользователя репликации
на головном сервере, имя хоста головного сервера, установку DNS,
посмотрите, запущен ли головной сервер в текущее время, доступен ли он
для подчиненного сервера. После этого, если все окажется в порядке,
просмотрите журналы ошибок.

<LI>

Если подчиненный сервер был запущен, но затем остановился, посмотрите
на вывод команды <code>SHOW SLAVE STATUS</code> и проверьте журналы ошибок. Такое
обычно случается, когда некоторый запрос, успешно выполняющийся на
головном сервере, не выполняется на подчиненном. Если создан
корректный образ головного сервера и данные на подчиненном сервере
обновлялись только через поток подчиненного сервера, этого происходить
не должно. Но если все же такое случилось - значит, имеет место
ошибка; как сообщить о ней, читайте ниже.

<LI>

Если запрос, успешно выполняемый на головном сервере, не выполняется
на подчиненном, и нельзя выполнить полную ресинхронизацию базы данных
(ее стоит выполнить), попробуйте сделать следующее:


<UL>
<LI>

Сначала проверьте: возможно где-либо случайно оказалась ненужная
запись. Разберитесь, как она оказалась там, затем удалите ее, и
выполните команду <code>SLAVE START</code>.

<LI>

Если вы проделали все, о чем написано выше, и ничего не помогло или
этого сделать нельзя, попытайтесь понять, будет ли безопасно выполнить
обновления вручную (если необходимо) и после этого игнорировать
следующий запрос от головного сервера.

<LI>

Если вы решили пропустить следующий запрос, выполните команды <code>SET GLOBAL
SQL_SLAVE_SKIP_COUNTER=1; SLAVE START;</code> чтобы пропустить запрос, не
использующий функции <code>AUTO_INCREMENT</code> или <code>LAST_INSERT_ID()</code>. В противном
случае выполните команды <code>SET GLOBAL SQL_SLAVE_SKIP_COUNTER=2; SLAVE START</code>.
Причина того, что запросы, использующие функции <code>AUTO_INCREMENT</code> или
<code>LAST_INSERT_ID()</code>, обрабатываются по-другому, заключается в том, что
они создают два события в двоичном журнале головного сервера.

<LI>

Если вы уверены, что подчиненный сервер был успешно запущен и
синхронизирован с головным сервером, а также что обновления таблиц не
производились вне потока подчиненного сервера, пришлите нам отчет об
ошибке, и вам не потребуется опять повторять описанные выше уловки.
</UL>

<LI>

Удостоверьтесь, что вы не внесли старой ошибки при апгрейде MySQL до
более новой версии.

<LI>

Если ничего не помогает, просмотрите журналы ошибок. Если журналы
большие, выполните команду <code>grep -i slave /path/to/your-log.err</code> на
подчиненном сервере. Искать ошибку на головном сервере - не лучшая
идея, поскольку в его журналах находятся лишь системные ошибки общего
характера; если это возможно, он посылает ошибку на подчиненный
сервер, когда что-либо происходит не так, как надо.
</UL>

<P>
Если вы убедились, что пользовательская ошибка здесь ни при чем, однако
механизм репликации по-прежнему не работает или работает нестабильно,
пришло время начать работу над отчетом об ошибке. Вы должны предоставить
нам столько информации, сколько нужно, чтобы отследить ошибку. Пожалуйста,
уделите отчету об ошибке нужное количество времени и усилий, чтобы сделать
его хорошо. В идеале мы хотели бы иметь контрольный пример в формате,
который находится в каталоге <tt>`mysql-test/t/rpl*'</tt> исходного дерева. Отослав
такой контрольный пример, в большинстве случаев можно рассчитывать на
получение патча в течение одного-двух дней, хотя, конечно, это время может
варьироваться в зависимости от множества факторов.

</P>
<P>
Еще один хороший способ проинформировать нас об ошибке - написать простую
программу с легко конфигурируемыми параметрами соединения для головного и
подчиненного серверов, в которой будет продемонстрирована проблема наших
систем. Программа может быть написана на Perl или на C, в зависимости от
того, какой язык вы знаете лучше.

</P>
<P>
Подготовив информацию об ошибке одним из двух способов, используйте
утилиту <code>mysqlbug</code>, чтобы создать отчет об ошибке, и пошлите его по адресу
<a HREF="mailto:bugs@lists.mysql.com">bugs@lists.mysql.com</a>. Если же вы имеете дело с фантомом - проблемой,
которая имеет место, но вы по какой-либо причине не можете ее
воспроизвести по желанию:

</P>

<UL>
<LI>

Убедитесь, что эта проблема не вызвана пользовательской ошибкой.
Например, при обновлении подчиненного сервера вне потока подчиненного
сервера данные будут не синхронизированы, и могут быть нарушения
уникальных ключей при обновлениях. В этом случае поток подчиненного
сервера остановится и будет ждать, пока таблицы не будут очищены
вручную, для приведения их в синхронизированный режим.

<LI>

Запустите подчиненный сервер с опциями <code>log-slave-updates</code> и <code>log-bin</code> -
при этом в журнал будет заноситься информация обо всех обновлениях,
происходящих на подчиненном сервере.

<LI>

Сохраните все доказательства наличия ошибки перед сбросом репликации.
Если у нас нет информации о проблеме, или имеется только отрывочная
информация, потребуется время, чтобы найти источник проблемы. Вы
должны собрать следующие "свидетельства":


<UL>
<LI>Все двоичные журналы головного сервера

<LI>Весь двоичный журнал подчиненного сервера

<LI>Вывод команды <code>SHOW MASTER STATUS</code> на головном сервере во время

обнаружения проблемы

<LI>Вывод команды <code>SHOW SLAVE STATUS</code> на головном сервере во время

обнаружения проблемы

<LI>Журналы ошибок головного сервера и подчиненного сервера

</UL>

<LI>

Для изучения двоичных журналов используйте утилиту <code>mysqlbinlog</code>. Таким
образом можно находить проблемные запросы, например:


<PRE>
mysqlbinlog -j pos_from_slave_status /path/to/log_from_slave_status | head
</PRE>

</UL>

<P>
Собрав "свидетельства" о проблеме-фантоме, попробуйте сначала
организовать их в отдельный контрольный пример. После этого сообщите о
проблеме по адресу <a HREF="mailto:bugs@lists.mysql.com">bugs@lists.mysql.com</a>, описав эту проблему во всех
подробностях.


<H1><A NAME="MySQL_Optimisation" HREF="manual.ru_toc.html#MySQL_Optimisation">5  Оптимизация в MySQL</A></H1>

<P>
Оптимизация - сложная задача, потому что она, в конечном счете, требует
понимания системы в целом. В отдельных случаях для выполнения локальной
оптимизации достаточно знать систему или приложение не в полном объеме,
однако чтобы сделать систему более оптимальной, нужно разбираться в том,
как она устроена.

</P>
<P>
В этой главе будут рассмотрены различные способы оптимизации MySQL и
представлены некоторые примеры ее выполнения. Не следует забывать, однако,
что всегда можно найти некоторые дополнительные возможности сделать
систему еще быстрее (хотя каждый следующий шаг в этом направлении будет
даваться все труднее и труднее).

</P>


<H2><A NAME="Optimise_Overview" HREF="manual.ru_toc.html#Optimise_Overview">5.1  Oбзор оптимизации</A></H2>

<P>
Чтобы увеличить скорость системы, необходимо, разумеется, прежде всего
разбираться в ее конструкции. Кроме того, нужно знать, какие функции будет
выполнять система и какие "узкие места" в ней имеются.

</P>
<P>
Ниже приведен список наиболее часто встречающихся "узких мест":

</P>

<UL>
<LI>Поиск данных на диске. Чтобы найти на диске какой-то фрагмент данных,

требуется некоторое время. Для устройств выпуска 1999 года среднее
время поиска составляет менее 10мс, так что теоретически можно
выполнять приблизительно 100 операций поиска в секунду. Это время
можно ненамного уменьшить, заменив диски более новыми. Для одной
таблицы поиск на диске оптимизировать очень сложно. Такую оптимизацию
можно выполнить путем распределения данных по нескольким дискам.

<LI>Дисковое чтение/запись. После выполнения поиска, когда найдена

соответствующая позиция на диске, мы можем считать данные. Для
устройств выпуска 1999 года производительность одного диска составляет
около 10-20Мб/с. Дисковое чтение/запись легче оптимизировать, чем
дисковый поиск, поэтому читать можно параллельно с нескольких дисков.

<LI>Циклы процессора. Когда мы помещаем данные в основную память (или если

они уже находятся там), мы должны обработать их, чтобы получить
результат. Наличие маленьких по сравнению с объемом ОЗУ таблиц -
наиболее часто встречающийся лимитирующий фактор. Но в этом случае, в
общем-то, скорость обработки маленьких таблиц значения не имеет.

<LI>Пропускная способность ОЗУ (memory bandwidth). Когда процессору

требуется больше данных, чем может вместить его кэш, узким местом
становится пропускная способность памяти. В большинстве систем это
узкое место встречается редко, однако о нем нужно знать.
</UL>



<H3><A NAME="Design_Limitations" HREF="manual.ru_toc.html#Design_Limitations">5.1.1  Конструктивные ограничения MySQL/компромиссы</A></H3>

<P>
<A NAME="IDX838"></A>
<A NAME="IDX839"></A>

</P>
<P>
При использовании обработчика таблиц <code>MyISAM</code> MySQL применяет очень быструю
блокировку таблиц (несколько потоков чтения/один поток записи). Самая
большая проблема при использовании этого типа таблиц возникает в случае
непрерывного потока обновлений в сочетании с медленными выборками из одной
и той же таблицы. Если эта проблема касается лишь некоторых таблиц, можно
использовать вместо них таблицы другого типа. See section <A HREF="manual.ru.html#Table_types">7  Типы  таблиц MySQL</A>.

</P>

<P>
MySQL может работать как с транзакционными так и с нетранзакционными
таблицами. Чтобы обеспечить возможность нормальной работы с
нетранзакционными таблицами (для которых невозможен откат, если что-нибудь
произойдет не так, как надо), в MySQL существуют следующие правила:

</P>
<P>
<A NAME="IDX840"></A>

</P>

<UL>
<LI>Все столбцы имеют значения по умолчанию.

<LI>Если в столбец вставляется "неправильное" значение (например, <code>NULL</code> в

столбец <code>NOT NULL</code> или слишком большое числовое значение - в числовой
столбец), MySQL не будет выводить сообщение об ошибке, а просто
поместит в столбец "наиболее подходящее возможное значение". Для
числовых значений это 0, наименьшие возможные значения или наибольшее
возможное значение. Для строк это либо пустая строка, либо самая
длинная строка, которая может быть в столбце.

<LI>Все вычисляемые выражения возвращают значение, которое можно

использовать вместо того, чтобы сигнализировать об ошибке. Например,
выражение <code>1/0</code> возвратит <code>NULL</code>
</UL>

<P>
Существование приведенных выше правил объясняется тем, что перед началом
выполнения запроса невозможно проверить, сможет ли он выполниться. Если
проблема обнаружится после обновления нескольких строк, мы не можем
выполнить полный откат, поскольку это может не поддерживаться типом
таблицы. Остановиться в этот момент тоже нельзя, потому что тогда
обновления будут выполнены наполовину, что является, вероятно, самым
худшим возможным результатом. В данном случае лучше выбрать "наименьшее
из зол", а затем продолжать, как будто ничего не произошло.

</P>
<P>
Отсюда следует, что MySQL нельзя использовать для проверки содержимого
полей. Это нужно делать в приложении.

</P>


<H3><A NAME="Portability" HREF="manual.ru_toc.html#Portability">5.1.2  Вопросы переносимости</A></H3>

<P>
<A NAME="IDX841"></A>
<A NAME="IDX842"></A>
<A NAME="IDX843"></A>

</P>
<P>
Поскольку все SQL-серверы поддерживают разные части стандарта SQL, то
разработка переносимых SQL-приложений занимает время. Для очень простых
запросов/вставок это достаточно просто, однако чем сложнее становится ваше
приложение, тем сложнее делать запросы переносимыми. Если вы хотите чтобы
ваше приложение работало максимально быстро с разными серверами SQL,
задача еще более усложняется.

</P>
<P>
Чтобы сделать сложное приложение переносимым в области SQL, вам следует
выбрать те SQL-серверы, с которыми оно должно работать.

</P>
<P>
Чтобы узнать, какие функции, типы и ограничения существуют в выбранных
вами серверах, можно воспользоваться приложением MySQL <code>crash-me</code>. <code>crash-me</code>
пока еще далека от того, чтобы тестировать все, что возможно, но тем не
менее, является достаточно качественным сравнительным тестом по более чем
450 характеристикам.

</P>
<P>
Например, если вы хотите использовать Informix или DB2, имена полей не
должны быть длиннее 18 символов.

</P>
<P>
И тесты MySQL (MySQL benchmarks), и программа <code>crash-me</code> являются достаточно
независимыми от конкретной СУБД. Ознакомившись с тем, как мы решили этот
вопрос, вы можете получить представление о том, как следует писать
переносимые программы для работы с базами данных. Тесты можно найти в
каталоге <tt>`sql-bench'</tt> в поставке исходных текстов MySQL. Они написаны на Perl
с использованием интерфейса DBI (который, кстати, уже решает проблему
получения доступа к разным базам данных).

</P>
<P>
См. <a HREF="http://www.mysql.com/information/benchmarks.html">http://www.mysql.com/information/benchmarks.html</a> - там находятся
результаты тестов.

</P>
<P>
Как можно видеть по этим результатам, у каждой СУБД есть свои слабые
стороны. Все они построены по-разному и спроектированы с учетом различных
компромиссов, что приводит к различиям в поведении этих систем.

</P>
<P>
Если независимость от СУБД для вас очень важна, вам нужно хорошо ощущать,
где находятся слабые места в каждом сервере. MySQL - очень быстрый сервер,
если речь идет о выборках/вставках, но у нас все еще есть проблемы, когда
с одной таблицей в смешанном режиме работают медленные клиенты, делающие
выборки и обновления. С другой стороны, при работе в Oracle возникают
большие проблемы, когда вы хотите получить доступ к строке, которую только
что обновили (до тех пор, пока она не будет сохранена на диске).
Транзакционные базы данных обычно не очень подходят для генерации отчетов
по файлам журналов, так как в этом случае блокировки совершенно
бесполезны.

</P>
<P>
Чтобы сделать свое приложение <em>действительно</em> не зависящим от СУБД, вам
следует создать некий быстро расширяемый интерфейс, через который
происходит обработка данных. Поскольку C++ доступен на большинстве систем,
имеет смысл создать соответствующие классы-интерфейсы к базам данных.

</P>
<P>
Если вы используете некоторые специфические функции СУБД (скажем, <code>REPLACE</code>
в MySQL), вам следует написать код, реализующий этот метод для других
серверов SQL. С MySQL вы можете использовать такой синтаксис для того,
чтобы добавить некоторые специфические для MySQL ключевые слова в запрос:
<code>/*! */</code>. Код внутри <code>/* */</code> будет проигнорирован как комментарий большинством
других SQL-серверов.

</P>
<P>
Если скорость важнее точности данных, как в некоторых веб-приложениях, то
тогда можно создать промежуточный уровень, который кэширует запросы и
таким образом дает еще больший выигрыш по скорости. Убирая некоторые
запросы из кэша по истечении времени, вы можете держать кэш в достаточно
"свежем" состоянии. Таким образом можно избежать пиков повышения
нагрузки на сервер, т.к. вы можете динамически увеличить кэш и
продолжительность жизни информации, и сохранять эти параметры таковыми,
пока ситуация не стабилизируется.

</P>
<P>
В этом случае структура таблицы должна содержать информацию об изначальном
размере кэша и то, как часто таблица должна быть обновлена в общем случае.

</P>


<H3><A NAME="Internal_use" HREF="manual.ru_toc.html#Internal_use">5.1.3  Для чего мы использовали MySQL?</A></H3>

<P>
<A NAME="IDX844"></A>
<A NAME="IDX845"></A>
<A NAME="IDX846"></A>

</P>
<P>
На первых этапах развития MySQL его функциональные возможности
разрабатывались под потребности самого крупного из наших заказчиков. Это
делалось для обслуживания больших хранилищ данных для пары самых крупных
продавцов в Швеции.

</P>
<P>
По всем магазинам мы получаем еженедельный отчет по продажам по бонусным
карточкам, и обеспечиваем владельцам магазинов полезной информацией о том,
как рекламные компании влияют на их покупателей.

</P>
<P>
Объем этих данных весьма значителен (в сумме приблизительно 7 миллионов
транзакций в месяц), и, кроме того, мы должны предоставлять пользователям
данные за периоды от 4 до 10 лет. Каждую неделю мы получаем от клиентов
просьбы предоставить "мгновенный" доступ к новым отчетам на основе этих
данных.

</P>
<P>
Эта проблема была решена следующим образом. Мы сохраняем всю информацию за
месяц в сжатых таблицах "транзакций". У нас есть набор простых макросов
(сценарий), генерирующий итоговые таблицы, сгруппированные по различным
критериям (группа изделий, идентификатор заказчика, хранилище...) из
таблиц транзакций. Отчеты - это веб-страницы, динамически генерирующиеся
небольшим сценарием на Perl, который просматривает веб-страницу, выполняет
SQL-операторы, содержащиеся в ней и вставляет результаты. Для этих целей
можно было бы использовать PHP или модуль <code>mod_perl</code>, но в то время этих
средств еще не существовало.

</P>
<P>
Для графических данных мы написали простой инструмент на C, который может
создавать GIF-файлы на основе результата SQL-запроса (определенным образом
обработав результат). Это также динамически выполняется из создаваемой
Perl'ом странички.

</P>
<P>
В большинстве случаев новый отчет может быть создан просто путем
копирования существующего сценария и модифицирования SQL-запроса в нем.
Иногда требуется дополнительно добавить поля в существующую итоговую
таблицу или сгенерировать новую таблицу, но это также делается очень
просто, поскольку у нас все транзакционные таблицы хранятся на диске (в
настоящее время у нас имеется меньшей мере 50Гб транзакционных таблиц и
200Гб других клиентских данных.)

</P>
<P>
Кроме того, мы обеспечиваем для наших клиентов возможность обращаться к
итоговым таблицам непосредственно через интерфейс ODBC; таким образом,
продвинутые пользователи могут самостоятельно экспериментировать с
данными.

</P>
<P>
У нас не было каких-либо проблем при обработке этих данных на весьма
скромном Sun Ultra SPARCstation (2x200 МГц). Недавно мы заменили один из
наших серверов на двухпроцессорный UltraSPARC с тактовой частотой 400 МГц
и теперь планируем начать обрабатывать транзакции на уровне продукта, что
будет означать десятикратное увеличение объема данных. Мы полагаем, что
сможем справиться с этим объемом лишь только добавлением соответствующего
количества дисков.

</P>
<P>
Помимо этого мы экспериментируем с Intel-Linux, чтобы получить больше
производительности по низшей цене. Теперь, имея бинарно-переносимый формат
базы данных (появившийся в версии 3.23), мы начнем использовать его для
некоторых частей приложения.

</P>
<P>
Наша интуиция подсказывает, что у Linux производительность значительно
выше при низкой и средней загрузке, а у Solaris - когда высокая загрузка
начнет возникать из-за критического дискового ввода-вывода. Но у нас нет
пока никаких выводов по этому поводу. После обсуждения с разработчиками
ядра Linux мы выяснили, что в это может быть побочным эффектом работы
ядра: когда Linux дает слишком много ресурсов пакетным заданиям, задачи
взаимодействия начинают замедляться. Из-за этого машина работает очень
медленно и не реагирует ни на что, пока обрабатываются большие пакеты.
Надеемся, что в последующих ядрах Linux этот вопрос найдет свое решение.

</P>


<H3><A NAME="MySQL_Benchmarks" HREF="manual.ru_toc.html#MySQL_Benchmarks">5.1.4  Набор тестов MySQL (The MySQL Benchmark Suite)</A></H3>

<P>
<A NAME="IDX847"></A>
<A NAME="IDX848"></A>

</P>
<P>
В данном разделе будет находиться техническое описание набора эталонных
тестов MySQL (и <code>crash-me</code>), но оно пока еще не написано. В настоящее время
можно получить хорошее представление об эталонном тесте, глядя на код и
результаты в каталоге <tt>`sql-bench'</tt> любого исходного дистрибутива MySQL.

</P>
<P>
Данный набор эталонных создан с целью обеспечить эталонный тест, который
будет информировать любого пользователя о том, что в данной реализации SQL
выполняется хорошо, а что плохо.

</P>
<P>
Обратите внимание: этот эталонный тест - однопоточный, так что в нем
измеряется минимальное время выполнения операций. В будущем мы планируем
добавить в данный набор большое количество многопоточных тестов.

</P>
<P>
Например (выполнено на одной машине под NT 4.0):

</P>
<TABLE BORDER>
<TR><TD><strong>Чтение 2000000 строк по индексу</strong> </TD><TD> <strong>Секунды</strong> </TD><TD> <strong>Секунды</strong>
</TD></TR>
<TR><TD>mysql </TD><TD> 367 </TD><TD> 249
</TD></TR>
<TR><TD>mysql_odbc </TD><TD> 464 </TD><TD>
</TD></TR>
<TR><TD>db2_odbc </TD><TD> 1206 </TD><TD>
</TD></TR>
<TR><TD>informix_odbc </TD><TD> 121126 </TD><TD>
</TD></TR>
<TR><TD>ms-sql_odbc </TD><TD> 1634 </TD><TD>
</TD></TR>
<TR><TD>oracle_odbc </TD><TD> 20800 </TD><TD>
</TD></TR>
<TR><TD>solid_odbc </TD><TD> 877 </TD><TD>
</TD></TR>
<TR><TD>sybase_odbc </TD><TD> 17614 </TD><TD>
</TD></TR>
</TABLE>

<TABLE BORDER>
<TR><TD><strong>Вставка 350768 строк</strong> </TD><TD> <strong>Секунды</strong> </TD><TD> <strong>Секунды</strong>
</TD></TR>
<TR><TD>mysql </TD><TD> 381 </TD><TD> 206
</TD></TR>
<TR><TD>mysql_odbc </TD><TD> 619 </TD><TD>
</TD></TR>
<TR><TD>db2_odbc </TD><TD> 3460 </TD><TD>
</TD></TR>
<TR><TD>informix_odbc </TD><TD> 2692 </TD><TD>
</TD></TR>
<TR><TD>ms-sql_odbc </TD><TD> 4012 </TD><TD>
</TD></TR>
<TR><TD>oracle_odbc </TD><TD> 11291 </TD><TD>
</TD></TR>
<TR><TD>solid_odbc </TD><TD> 1801 </TD><TD>
</TD></TR>
<TR><TD>sybase_odbc </TD><TD> 4802 </TD><TD>
</TD></TR>
</TABLE>

<P>
В предыдущем тесте MySQL запускался с 8-мегабайтным индексным кэшем.

</P>
<P>
Гораздо больше результатов тестов вы сможете найти по адресу
<a HREF="http://www.mysql.com/information/benchmarks.html">http://www.mysql.com/information/benchmarks.html</a>.

</P>
<P>
Обратите внимание: данные об Oracle отсутствуют - по просьбе компании
Oracle вся информация по их продукту была удалена. Все эталонные тесты для
Oracle должны быть пропущены через компанию Oracle! Мы считаем, однако,
что при таком способе тестирования результаты эталонных тестов для Oracle
будут в <strong>очень</strong> высокой степени различаться, поскольку приведенные на сайте
результаты призваны показывать на что способна стандартная инсталляция для
одного клиента.

</P>
<P>
Чтобы выполнить набор эталонных тестов, необходимо загрузить исходный
дистрибутив MySQL, установить драйвер perl DBI, драйвер perl DBD для той
базы данных, которую нужно проверить, а затем выполнить:

</P>

<PRE>
cd sql-bench
perl run-all-tests --server=#
</PRE>

<P>
где # - один из поддерживаемых серверов. Список всех опций и
поддерживаемых серверов можно получить, выполнив <code>run-all-tests --help</code>.

</P>
<P>
Программа <code>crash-me</code> пытается определить, какие функции поддерживаются СУБД,
и какие возможности и ограничения имеют эти функции при выполнении
запросов. Например, она определяет следующее:

</P>

<UL>
<LI>какие типы столбцов поддерживаются

<LI>сколько индексов поддерживается

<LI>какие функции поддерживаются

<LI>насколько большим может быть запрос

<LI>насколько большим может быть столбец <code>VARCHAR</code>

</UL>

<P>
<A NAME="IDX849"></A>
Результат, полученные <code>crash-me</code> для большого количества различных СУБД,
можно найти по адресу: <a HREF="http://www.mysql.com/information/crash-me.php">http://www.mysql.com/information/crash-me.php</a>.

</P>


<H3><A NAME="Custom_Benchmarks" HREF="manual.ru_toc.html#Custom_Benchmarks">5.1.5  Использование собственных тестов</A></H3>

<P>
<A NAME="IDX850"></A>
<A NAME="IDX851"></A>

</P>
<P>
Чтобы найти "узкие места" в своем приложении и базе данных, вы должны их
тщательно протестировать. После устранения "узкого места" (или после
замены его некой заглушкой) можно легко идентифицировать следующее "узкое
место" (и так далее). Даже если общая производительность приложения
достаточна, нужно по крайней мере выявить все "узкие места" и
определиться с тем, как их устранять, - на будущее, если когда-нибудь
потребуется дополнительная производительность.

</P>
<P>
Примеры переносимых программ программы для эталонного тестирования можно
найти в наборе тестов MySQL. See section <A HREF="manual.ru.html#MySQL_Benchmarks">5.1.4  Набор тестов MySQL (The MySQL Benchmark Suite)</A>. 
Можно взять любую программу из
этого набора и модифицировать ее для своих потребностей. Таким образом
можно испытывать различные решения проблемы и проверять, которое из них
самое быстрое.

</P>
<P>
Зачастую некоторые проблемы проявляются только тогда, когда система очень
сильно загружена. К нам часто обращаются клиенты, которые, запустив
(протестированную) систему в производство, сталкиваются с проблемами,
связанными с нагрузкой. На сегодня причиной каждого из этих случаев были
либо проблемы, связанные с базовой конструкцией (при высокой нагрузке
<strong>нехорошо</strong> выполняется сканирование таблиц), либо проблемы
ОС/библиотек. И большинство таких проблем было бы <strong>намного</strong> легче устранить
до начала промышленной эксплуатации систем.

</P>
<P>
Чтобы избежать подобных проблем, нужно постараться выполнить эталонное
тестирование всего приложения при самой плохой возможной нагрузке! Для
этого можно использовать программу <code>Super Smack</code>, которая доступна по
адресу: <a HREF="http://www.mysql.com/Downloads/super-smack/super-smack-1.0.tar.gz">http://www.mysql.com/Downloads/super-smack/super-smack-1.0.tar.gz</a>.
Эта программа, как следует из ее имени (<em>smack - шлепок - прим. пер.</em>),
способна поставить систему на колени, так что используйте её только на
разрабатываемых системах (проще говоря, в девелопменте).

</P>


<H2><A NAME="Query_Speed" HREF="manual.ru_toc.html#Query_Speed">5.2  Оптимизация <code>SELECT</code> и других запросов</A></H2>

<P>
<A NAME="IDX852"></A>
<A NAME="IDX853"></A>
<A NAME="IDX854"></A>

</P>
<P>
Сначала приведем одно правило, касающееся всех запросов: Чем сложнее ваша
система привилений, тем больше издержек.

</P>
<P>
Если не было выполнено никаких операторов <code>GRANT</code>, MySQL каким-то образом
будет оптимизировать проверку полномочий. Таким образом при наличии очень
большого объема данных лучше, наверное, будет работать без привилегий. В
противном случае при большом количестве полномочий проверка результатов
будет происходить с увеличенными издержками.

</P>
<P>
Если проблема состоит в некоторой явной функции MySQL, всегда можно
протестировать ее в клиенте:

</P>

<PRE>
mysql&#62; SELECT BENCHMARK(1000000,1+1);
+------------------------+
| BENCHMARK(1000000,1+1) |
+------------------------+
|                      0 |
+------------------------+
1 row in set (0.32 sec)
</PRE>

<P>
Из приведенного выше примера видно, что MySQL может выполнять более
1000000 операций сложения за 0,32 секунды на PentiumII 400MHz.

</P>
<P>
Все функции MySQL достаточно хорошо оптимизированы, но могут попадаться
некоторые исключения, и функция <code>BENCHMARK(число_циклов,выражение)</code> -
хороший инструмент для выяснения, присутствует ли проблема в запросе.

</P>



<H3><A NAME="EXPLAIN" HREF="manual.ru_toc.html#EXPLAIN">5.2.1  Синтаксис оператора <code>EXPLAIN</code> (получение информации о <code>SELECT</code>)</A></H3>

<P>
<A NAME="IDX855"></A>
<A NAME="IDX856"></A>

</P>

<PRE>
    EXPLAIN имя_таблицы
или EXPLAIN SELECT опции_выборки
</PRE>

<P>
<code>EXPLAIN имя_таблицы</code> является синонимом операторов <code>DESCRIBE имя_таблицы</code> и
<code>SHOW COLUMNS FROM имя_таблицы</code>.

</P>
<P>
Если оператор <code>SELECT</code> предваряется ключевым словом <code>EXPLAIN</code>, MySQL сообщит о
том, как будет производиться обработка <code>SELECT</code>, и предоставит информацию о
порядке и методе связывания таблиц.

</P>
<P>
При помощи <code>EXPLAIN</code> можно выяснить, когда стоит снабдить таблицы индексами,
чтобы получить более быструю выборку, использующую индексы для поиска
записей. 

</P>
<P>
Вы должны почаще запускать <code>ANALYZE TABLE</code> с тем, чтобы обновлялась статистика по 
таблицам, такая как кардинальность ключей, которые могут повлиять на выбор оптимизатора. 
See section <A HREF="manual.ru.html#ANALYZE_TABLE">4.5.2  Синтаксис команды <code>ANALYZE TABLE</code></A>.

</P>
<P>
Можно проверить, насколько удачный порядок связывания
таблиц был выбран оптимизатором. Заставить оптимизатор связывать таблицы в
заданном порядке можно при помощи указания <code>STRAIGHT_JOIN</code>.

</P>
<P>
Для непростых соединений <code>EXPLAIN</code> возвращает строку информации о каждой из
использованных в работе оператора <code>SELECT</code> таблиц. Таблицы перечисляются в
том порядке, в котором они будут считываться.
MySQL выполняет все связывания за один проход (метод называется
"single-sweep multi-join"). Делается это так: MySQL читает строку из
первой таблицы, находит совпадающую строку во второй таблице, затем - в
третьей, и так далее. Когда обработка всех таблиц завершается, MySQL
выдает выбранные столбцы и обходит в обратном порядке список таблиц до тех
пор, пока не будет найдена таблица с наибольшим совпадением строк.
Следующая строка считывается из этой таблицы и процесс продолжается в
следующей таблице.

</P>
<P>
В MySQL 4.1, вывод <code>EXPLAIN</code> был изменен с тем, чтобы работать лучше с конструкциями типа 
<code>UNION</code>, подзапросами, и наследованными (вторичными, derived) таблицами. 
Наиболее заметным изменением стало введение двух новых столбцов: <code>id</code> и <code>select_type</code>.

</P>
<P>
Вывод команды <code>EXPLAIN</code> включает следующие столбцы:

</P>
<DL COMPACT>

<DT><code>id</code>
<DD>
Идентификатор <code>SELECT</code>, последовательный номер этого конкретного <code>SELECT</code> в запросе. 

<DT><code>select_type</code>
<DD>
Тип оператора <code>SELECT</code>, который может быть один из следующих: 

<DL COMPACT>

<DT><code>SIMPLE</code>
<DD>
Простая выборка (<code>SELECT</code> без <code>UNION</code> или подзапросов). 

<DT><code>PRIMARY</code>
<DD>
Крайний <code>SELECT</code>.

<DT><code>UNION</code>
<DD>
Второй и дальнейшие <code>UNION SELECT</code>.

<DT><code>DEPENDENT UNION</code>
<DD>
Второй и дальнейшие <code>UNION SELECT</code>, зависящие от внешнего подзапроса. 

<DT><code>SUBSELECT</code>
<DD>
Первый <code>SELECT</code> в подзапросе. 

<DT><code>DEPENDENT SUBSELECT</code>
<DD>
Первый <code>SELECT</code>, зависящий от внешнего подзапроса. 

<DT><code>DERIVED</code>
<DD>
Наследованная (вторичная) таблица <code>SELECT</code>.
</DL>

<DT><code>table</code>
<DD>
Таблица, к которой относится выводимая строка.

<DT><code>type</code>
<DD>
Тип связывания. 
Ниже перечислены различные типы связывания, упорядоченные от лучшего к
худшему:

<A NAME="IDX857"></A>
<A NAME="IDX858"></A>

<DL COMPACT>

<DT><code>system</code>
<DD>
Таблица содержит только одну строку (= системная таблица). Это - частный
случай типа связывания <code>const</code>.

<A NAME="IDX859"></A>

<DT><code>const</code>
<DD>
Таблица содержит не более одной соответствующей строки, которая будет
считываться в начале запроса. Поскольку имеется только одна строка,
оптимизатор в дальнейшем может расценивать значения этой строки в столбце
как константы. Таблицы <code>const</code> являются очень быстрыми, поскольку они
читаются только однажды!

<DT><code>eq_ref</code>
<DD>
Для каждой комбинации строк из предыдущих таблиц будет cчитываться одна
строка из этой таблицы. Это наилучший возможный тип связывания среди
типов, отличных от <code>const</code>. Данный тип применяется, когда все части индекса
используются для связывания, а сам индекс - <code>UNIQUE</code> или <code>PRIMARY KEY</code>.

<DT><code>ref</code>
<DD>
Из этой таблицы будут считываться все строки с совпадающими значениями
индексов для каждой комбинации строк из предыдущих таблиц. Тип <code>ref</code>
применяется, если для связывания используется только крайний левый префикс
ключа, или если ключ не является <code>UNIQUE</code> или <code>PRIMARY KEY</code> (другими словами,
если на основании значения ключа для связывания не может быть выбрана одна
строка). Этот тип связывания хорошо работает, если используемый ключ
соответствует только нескольким строкам.

<DT><code>range</code>
<DD>
При помощи индекса для выборки строк будут извлечены только строки,
находящиеся в заданном диапазоне. Используемый индекс указывается в
столбце <code>key</code>. Столбец <code>key_len</code> содержит самую длинную часть ключа, которая
была использована. Столбец <code>ref</code> будет содержать значения <code>NULL</code> для этого
типа.

<DT><code>index</code>
<DD>
Данный тип аналогичен <code>ALL</code>, за исключением того, что просматривается только
дерево индексов. Этот тип обычно более быстрый чем <code>ALL</code>, поскольку
индексный файл, как правило, меньше файла данных.

<DT><code>ALL</code>
<DD>
Для каждой комбинации строк из предыдущих таблиц будет производиться
полный просмотр этой таблицы. Это обычно плохо, если таблица - первая из
не отмеченных как <code>const</code>, и <strong>очень</strong> плохо во всех остальных случаях. Как
правило, можно избегать типа связывания <code>ALL</code> - путем добавления большего
количества индексов таким образом, чтобы строка могла быть найдена при
помощи константных значений или значений столбца из предыдущих таблиц.
</DL>

<DT><code>possible_keys</code>
<DD>
Столбец <code>possible_keys</code> служит для указания индексов, которые может
использовать MySQL для нахождения строк в этой таблице. Обратите внимание:
этот столбец полностью независим от порядка таблиц. Это означает, что на
практике некоторые ключи в столбце <code>possible_keys</code> могут не годиться для
сгенерированного порядка таблиц. 

Если данный столбец пуст, то никаких
подходящих индексов не имеется. В этом случае для увеличения
производительности следует исследовать выражение <code>WHERE</code>, чтобы увидеть,
есть ли в нем ссылки на какой-либо столбец (столбцы), которые подходили бы
для индексации. Если да, создайте соответствующий индекс и снова проверьте
запрос при помощи оператора <code>EXPLAIN</code>. See section <A HREF="manual.ru.html#ALTER_TABLE">6.5.4  Синтаксис оператора <code>ALTER TABLE</code></A>. 

Чтобы увидеть, какие
индексы есть в таблице, используйте команду <code>SHOW INDEX FROM имя_таблицы</code>.

<DT><code>key</code>
<DD>
Столбец <code>key</code> содержит ключ (индекс), который MySQL решил использовать в
действительности. Если никакой индекс не был выбран, ключ будет иметь значение
<code>NULL</code>. Чтобы заставить MySQL применить индекс из <code>possible_keys</code>,
следует использовать оператор <code>USE INDEX/IGNORE INDEX</code> в запросе.
See section <A HREF="manual.ru.html#SELECT">6.4.1  Синтаксис оператора <code>SELECT</code></A>.

Также, выполнение <code>myisamchk --analyze</code> (see section <A HREF="manual.ru.html#myisamchk_syntax">4.4.6.1  Синтаксис запуска <code>myisamchk</code></A>) или
<code>ANALYZE TABLE</code> (see section <A HREF="manual.ru.html#ANALYZE_TABLE">4.5.2  Синтаксис команды <code>ANALYZE TABLE</code></A>) по таблицам даст возможность
оптимизатору принимать более правильные решения. 

<DT><code>key_len</code>
<DD>
Столбец <code>key_len</code> содержит длину ключа, которую решил использовать MySQL.
Если <code>key</code> имеет значение <code>NULL</code>, то длина ключа (<code>key_len</code>) тоже <code>NULL</code>. Обратите
внимание: по значению длины ключа можно определить, сколько частей
составного ключа в действительности будет использовать MySQL.

<DT><code>ref</code>
<DD>
Столбец <code>ref</code> показывает, какие столбцы или константы используются с ключом,
указанным в <code>key</code>, для выборки строк из таблицы.

<DT><code>rows</code>
<DD>
В столбце <code>rows</code> указывается число строк, которые MySQL считает нужным
проанализировать для выполнения запроса.

<DT><code>Extra</code>
<DD>
Этот столбец содержит дополнительную информацию о том, как MySQL будет
выполнять запрос. Ниже объясняется значение каждой из текстовых строк,
которые могут находиться в этом столбце:

<DL COMPACT>

<DT><code>Distinct</code>
<DD>
После нахождения первой совпадающей строки MySQL не будет продолжать поиск
строк для текущей комбинации строк.

<DT><code>Not exists</code>
<DD>
MySQL смог осуществить оптимизацию <code>LEFT JOIN</code> для запроса и после
нахождения одной строки, соответствующей критерию <code>LEFT JOIN</code>, не будет
искать в этой таблице последующие строки для предыдущей комбинации строк.

Например:


<PRE>
SELECT * FROM t1 LEFT JOIN t2 ON t1.id=t2.id WHERE t2.id IS NULL;
</PRE>

Предположим, что столбец <code>t2.id</code> определен как <code>NOT NULL</code>. В этом случае MySQL
просмотрит таблицу <code>t1</code> и будет искать строки в <code>t2</code> соответствующие <code>t1.id</code>.
Если MySQL находит в <code>t2</code> нужную строку, он знает, что <code>t2.id</code> никогда не
может иметь значение <code>NULL</code>, и не будет искать в <code>t2</code> оставшуюся часть строк,
имеющих тот же самый <code>id</code>. Другими словами, для каждой строки в <code>t1</code> MySQL
должен выполнить только один поиск в <code>t2</code>, независимо от того, сколько
совпадающих строк содержится в <code>t2</code>.

<DT><code><code>range checked for each record (index map: #)</code></code>
<DD>
MySQL не нашел достаточно хорошего индекса для использования. Вместо этого
для каждой комбинации строк в предшествующих таблицах он будет проверять,
какой индекс следует использовать (если есть какой-либо индекс), и
применять его для поиска строк в таблице. Это делается не очень быстро, но
таким образом таблицы связываются быстрее, чем без индекса.

<DT><code>Using filesort</code>
<DD>
MySQL должен будет сделать дополнительный проход, чтобы выяснить, как
извлечь строки в порядке сортировки. Для выполнения сортировки выполняется
просмотр всех строк согласно типу связывания (<code>join type</code>) и сохраняются
ключ сортировки плюс указатель на строку для всех строк, удовлетворяющих
выражению <code>WHERE</code>. После этого ключи сортируются и строки извлекаются в
порядке сортировки.

<DT><code>Using index</code>
<DD>
Для извлечения данных из столбца используется только информация дерева
индексов; при этом нет необходимости производить собственно чтение записи.
Это применимо для случаев, когда все используемые столбцы таблицы являются
частью одного индекса.

<DT><code>Using temporary</code>
<DD>
Чтобы выполнить запрос, MySQL должен будет создать временную таблицу для
хранения результата. Это обычно происходит, если предложение <code>ORDER BY</code>
выполняется для набора столбцов, отличного от того, который используется в
предложении <code>GROUP BY</code>.

<DT><code>Using where</code>
<DD>
Выражение <code>WHERE</code> будет использоваться для выделения тех строк, которые
будут сопоставляться со следующей таблицей или тех, которые будут посланы
клиенту. Если этой информации нет, а таблица имеет тип <code>ALL</code> или <code>index</code>, то,
значит, в вашем запросе есть какая-то ошибка (если вы не собираетесь
делать выборку/тестирование всех строк таблицы).
</DL>

Если нужно, чтобы запросы выполнялись настолько быстро, насколько это
возможно, посмотрите, есть ли строки упоминания <code>Using filesort</code> и <code>Using temporary</code>.
</DL>

<P>
Существует неплохой способ определить, насколько хорошим является тип
связывания. Для этого нужно перемножить все значения столбца <code>rows</code>,
выводимого командой <code>EXPLAIN</code>. Результатом будет грубая оценка того, сколько
строк должен просмотреть MySQL для выполнения запроса. Это же число
используется для ограничения запросов в переменной <code>max_join_size</code>.
See section <A HREF="manual.ru.html#Server_parameters">5.5.2  Настройка параметров сервера</A>.

</P>
<P>
В следующем примере показано, как можно постепенно оптимизировать <code>JOIN</code> при
помощи информации, выводимой оператором <code>EXPLAIN</code>.

</P>
<P>
Предположим, что имеется представленный ниже оператор <code>SELECT</code>, который
нужно исследовать при помощи команды <code>EXPLAIN</code>:

</P>

<PRE>
EXPLAIN SELECT tt.TicketNumber, tt.TimeIn,
            tt.ProjectReference, tt.EstimatedShipDate,
            tt.ActualShipDate, tt.ClientID,
            tt.ServiceCodes, tt.RepetitiveID,
            tt.CurrentProcess, tt.CurrentDPPerson,
            tt.RecordVolume, tt.DPPrinted, et.COUNTRY,
            et_1.COUNTRY, do.CUSTNAME
        FROM tt, et, et AS et_1, do
        WHERE tt.SubmitTime IS NULL
            AND tt.ActualPC = et.EMPLOYID
            AND tt.AssignedPC = et_1.EMPLOYID
            AND tt.ClientID = do.CUSTNMBR;
</PRE>

<P>
Для этого примера принимается, что:

</P>

<UL>
<LI>

Сравниваемые столбцы были объявлены следующим образом:

<TABLE BORDER>
<TR><TD><strong>Таблица</strong> </TD><TD> <strong>Столбец</strong> </TD><TD> <strong>Тип столбца</strong>
</TD></TR>
<TR><TD><code>tt</code> </TD><TD> <code>ActualPC</code> </TD><TD> <code>CHAR(10)</code>
</TD></TR>
<TR><TD><code>tt</code> </TD><TD> <code>AssignedPC</code> </TD><TD> <code>CHAR(10)</code>
</TD></TR>
<TR><TD><code>tt</code> </TD><TD> <code>ClientID</code> </TD><TD> <code>CHAR(10)</code>
</TD></TR>
<TR><TD><code>et</code> </TD><TD> <code>EMPLOYID</code> </TD><TD> <code>CHAR(15)</code>
</TD></TR>
<TR><TD><code>do</code> </TD><TD> <code>CUSTNMBR</code> </TD><TD> <code>CHAR(15)</code>
</TD></TR>
</TABLE>

<LI>

Таблицы проиндексированы следующим образом:

<TABLE BORDER>
<TR><TD><strong>Таблица</strong> </TD><TD> <strong>Индекс</strong>
</TD></TR>
<TR><TD><code>tt</code> </TD><TD> <code>ActualPC</code>
</TD></TR>
<TR><TD><code>tt</code> </TD><TD> <code>AssignedPC</code>
</TD></TR>
<TR><TD><code>tt</code> </TD><TD> <code>ClientID</code>
</TD></TR>
<TR><TD><code>et</code> </TD><TD> <code>EMPLOYID</code> (primary key)
</TD></TR>
<TR><TD><code>do</code> </TD><TD> <code>CUSTNMBR</code> (primary key)
</TD></TR>
</TABLE>

<LI>

Значения <code>tt.ActualPC</code> распределены не равномерно.
</UL>

<P>
На начальном этапе перед выполнением какой-либо оптимизации оператор
<code>EXPLAIN</code> выведет следующую информацию:

</P>

<PRE>
table type possible_keys                key  key_len ref  rows  Extra
et    ALL  PRIMARY                      NULL NULL    NULL 74
do    ALL  PRIMARY                      NULL NULL    NULL 2135
et_1  ALL  PRIMARY                      NULL NULL    NULL 74
tt    ALL  AssignedPC,ClientID,ActualPC NULL NULL    NULL 3872
      range checked for each record (key map: 35)
</PRE>

<P>
Поскольку каждая таблица имеет тип (<code>type</code>) <code>ALL</code>, из приведенного выше вывода видно,
что MySQL будет делать полное связывание всех таблиц! Это займет долгое
время, поскольку для выполнения такого связывания должно быть рассмотрено
произведение числа строк в каждой таблице! Для нашего случая такое
произведение - 74 * 2135 * 74 * 3872 = 45268558720 строк. Если таблицы
большие, трудно даже представить себе, как долго они будут связываться.

</P>
<P>
Одна проблема здесь состоит в том, что MySQL не может (пока еще)
эффективно применять индексы к столбцам, если они объявлены по-разному. В
этом контексте тип <code>VARCHAR</code> и тип <code>CHAR</code> - одинаковы, если они не объявлены с
различной длиной. Поскольку столбец <code>tt.ActualPC</code> объявлен как <code>CHAR(10)</code>, а
<code>et.EMPLOYID</code> - как <code>CHAR(15)</code>, имеется несоответствие по длине значений.

</P>
<P>
Чтобы устранить это несоответствие между длинами столбцов, следует
использовать команду <code>ALTER TABLE</code> для удлинения столбца <code>ActualPC</code> от 10
символов до 15 символов:

</P>

<PRE>
mysql&#62; ALTER TABLE tt MODIFY ActualPC VARCHAR(15);
</PRE>

<P>
Теперь оба столбца <code>tt.ActualPC</code> и <code>et.EMPLOYID</code> имеют тип <code>VARCHAR(15)</code>. При
повторном выполнении оператора <code>EXPLAIN</code> будет выведен следующий результат:

</P>

<PRE>
table type   possible_keys   key     key_len ref         rows    Extra
tt    ALL    AssignedPC,ClientID,ActualPC NULL NULL NULL 3872    Using where
do    ALL    PRIMARY         NULL    NULL    NULL        2135
      range checked for each record (key map: 1)
et_1  ALL    PRIMARY         NULL    NULL    NULL        74
      range checked for each record (key map: 1)
et    eq_ref PRIMARY         PRIMARY 15      tt.ActualPC 1
</PRE>

<P>
Это не идеально, но уже намного лучше (произведение значений строк (<code>rows</code>) теперь
уменьшилось в 74 раза). Такое связывание выполнится за пару секунд.

</P>
<P>
Можно сделать еще одно изменение - чтобы устранить несоответствие длин
столбцов для сравнений <code>tt.AssignedPC = et_1.EMPLOYID</code> и <code>tt.ClientID =
do.CUSTNMBR</code>.

</P>

<PRE>
mysql&#62; ALTER TABLE tt MODIFY AssignedPC VARCHAR(15),
    -&#62;                MODIFY ClientID   VARCHAR(15);
</PRE>

<P>
Теперь оператор <code>EXPLAIN</code> будет выводить такую информацию:

</P>

<PRE>
table type   possible_keys   key      key_len ref           rows Extra
et    ALL    PRIMARY         NULL     NULL    NULL          74
tt    ref    AssignedPC,     ActualPC 15      et.EMPLOYID   52   Using where
             ClientID,
             ActualPC
et_1  eq_ref PRIMARY         PRIMARY  15      tt.AssignedPC 1
do    eq_ref PRIMARY         PRIMARY  15      tt.ClientID   1
</PRE>

<P>
Это почти идеально.

</P>
<P>
Осталась еще одна проблема. Она заключается в том, что по умолчанию MySQL
принимает, что значения в столбце <code>tt.ActualPC</code> распределены равномерно, но
в таблице <code>tt</code> это не так. К счастью, проинформировать MySQL об этом можно
очень просто:

</P>

<PRE>
shell&#62; myisamchk --analyze PATH_TO_MYSQL_DATABASE/tt
shell&#62; mysqladmin refresh
</PRE>

<P>
Теперь связывание совершенно, и оператор <code>EXPLAIN</code> выведет такой результат:

</P>

<PRE>
table type   possible_keys key     key_len ref           rows Extra
tt    ALL    AssignedPC    NULL    NULL    NULL          3872 Using where
             ClientID,
             ActualPC
et    eq_ref PRIMARY       PRIMARY 15      tt.ActualPC   1
et_1  eq_ref PRIMARY       PRIMARY 15      tt.AssignedPC 1
do    eq_ref PRIMARY       PRIMARY 15      tt.ClientID   1
</PRE>

<P>
Обратите внимание: столбец rows в выводе оператора <code>EXPLAIN</code> - опытное
предположение оптимизатора связей MySQL. Чтобы оптимизировать запрос,
нужно проверить, являются ли числа близкими к действительным. Если нет,
можно получить лучшую производительность, используя в операторе <code>SELECT</code>
соединение <code>STRAIGHT_JOIN</code> и попытаться задать другой порядок таблиц в
выражении <code>FROM</code>.

</P>


<H3><A NAME="Estimating_performance" HREF="manual.ru_toc.html#Estimating_performance">5.2.2  Оценка производительности запроса</A></H3>

<P>
<A NAME="IDX860"></A>
<A NAME="IDX861"></A>
<A NAME="IDX862"></A>

</P>
<P>
В большинстве случаев можно оценивать производительность путем подсчета
дисковых операций. Для маленьких таблиц можно обычно принимать 1 строку за
1 операцию дискового поиска (поскольку индекс, скорее всего, в кэше). Для
больших таблиц можно считать, что (при использовании индексов типа B++
деревьев) для нахождения строки потребуется 

</P>
<P>
<code>log(количество_строк) / log(длина_индексного_блока / 3 * 2 / 
(длина_индекса + длина_указателя_на_данные)) + 1</code>

</P>
<P>
дисковая операция для получения строки.

</P>
<P>
Обычно в MySQL индексный блок занимает 1024 байта, а указательн - 4 байта.
Для таблицы, содержащей 500000 строк и имеющей длину индекса 3 (<code>medium
integer</code>) потребуется <code>log(500,000)/log(1024/3*2/(3+4)) + 1 = 4</code> дисковых
операции поиска.

</P>
<P>
Поскольку вышеупомянутый индекс будет занимать приблизительно 500000 * 7 *
3/2 = 5,2Mб (если учитывать, что индексные буфера обычно заполняются на
2/3), большая часть индекса, скорее всего, окажется в памяти, и для того,
чтобы найти строку, потребуется лишь 1-2 обращения к ОС для чтения.

</P>
<P>
Для записи, однако, потребуется 4 дисковых запроса (таких, какие
рассматривались выше) чтобы найти место для помещения нового индекса, и
обычно 2 дисковых операции, чтобы обновить индекс и вставить строку.

</P>
<P>
Обратите внимание: сказанное выше не означает, что производительность
приложения будет ухудшаться в <code>log N</code> раз! Поскольку все кэшируется в OС или
на SQL-сервере, замедление работы при увеличении таблицы будет
незначительным. И лишь после того, как данных станет так много, что они
перестанут помещаться в кэш, замедление работы там, где работа приложения
сводится только к операциям дискового поиска (количество которых растет в
<code>log N</code>), станет гораздо ощутимей. Чтобы избежать этого, следует увеличить
индексный кэш так, чтобы он вмещал возросшее количество данных. 
See section <A HREF="manual.ru.html#Server_parameters">5.5.2  Настройка параметров сервера</A>.

</P>


<H3><A NAME="SELECT_speed" HREF="manual.ru_toc.html#SELECT_speed">5.2.3  Скорость выполнения запросов <code>SELECT</code></A></H3>

<P>
<A NAME="IDX863"></A>

</P>
<P>
<A NAME="IDX864"></A>

</P>
<P>
В общем случае для того, чтобы заставить медленный <code>SELECT ... WHERE</code>
работать быстрее, прежде всего нужно выяснить, можно ли добавить индекс.
 Для всех ссылок между различными таблицами должны, как
правило, применяться индексы. Чтобы определить, какие индексы используются
для выборки <code>SELECT</code>, можно использовать <code>EXPLAIN</code>. See section <A HREF="manual.ru.html#EXPLAIN">5.2.1  Синтаксис оператора <code>EXPLAIN</code> (получение информации о <code>SELECT</code>)</A>.

</P>
<P>
Вот несколько общих советов:

</P>

<UL>
<LI>Чтобы MySQL лучше оптимизировал запросы, можно выполнить <code>myisamchk

--analyze</code> для таблицы после того, как она загружена соответствующими
данными. Таким образом для каждой части индекса будет обновлено
значение, указывающее среднее число строк, имеющих одинаковые значения
(для уникальных индексов это всегда 1, разумеется). MySQL будет
использовать это число, чтобы решить, какой индекс следует выбрать для
связывания двух таблиц при помощи "неконстантного выражения".
Результат работы <code>analyze</code> можно увидеть в столбце <code>Cardinality</code> после
выполнения команды <code>SHOW INDEX FROM имя_таблицы</code>.

<LI>Чтобы отсортировать индекс и данные в соответствии с индексом,

используйте <code>myisamchk --sort-index --sort-records=1</code> (если нужно
отсортировать по индексу 1). Если имеется уникальный индекс, по
которому вы хотите считывать все записи в порядке, соответствующем
данному индексу, это - хороший способ ускорить считывание записей.
Обратите внимание, однако, что эта сортировка написана не оптимально и
для большой таблицы будет выполняться долго!
</UL>



<H3><A NAME="Where_optimisations" HREF="manual.ru_toc.html#Where_optimisations">5.2.4  Как MySQL оптимизирует выражения <code>WHERE</code></A></H3>

<P>
<A NAME="IDX865"></A>

</P>
<P>
<A NAME="IDX866"></A>

</P>
<P>
Описание оптимизации выражений <code>WHERE</code> помещено в раздел, посвященный
<code>SELECT</code>, потому что они главным образом используются в запросах <code>SELECT</code>, но
для выражений <code>WHERE</code> в операторах <code>DELETE</code> и <code>UPDATE</code> используются те же
способы оптимизации.

</P>
<P>
Отметим также, что данный раздел неполон. В MySQL реализовано много
возможностей оптимизации, и у нас не было времени, чтобы задокументировать
их все.

</P>
<P>
Ниже перечислены некоторые из оптимизации, выполняемых MySQL:

</P>

<UL>

<LI>Удаляются ненужные скобки:


<PRE>
   ((a AND b) AND c OR (((a AND b) AND (c AND d))))
-&#62; (a AND b AND c) OR (a AND b AND c AND d)
</PRE>

<LI>Константы заменяются значениями:


<PRE>
   (a&#60;b AND b=c) AND a=5
-&#62; b&#62;5 AND b=c AND a=5
</PRE>

<LI>Удаляются условия для констант (требуется при замене констант

значением):

<PRE>
   (B&#62;=5 AND B=5) OR (B=6 AND 5=5) OR (B=7 AND 5=6)
-&#62; B=5 OR B=6
</PRE>

<LI>Константные выражения, используемые индексами, оцениваются только один

раз.

<LI>Для таблиц <code>HEAP</code> и <code>MyISAM</code> функция <code>COUNT(*)</code>, которая вызывается для

одной таблицы и не содержит предложения <code>WHERE</code>, берется непосредственно
из табличной информации. Это делается также для любого выражения <code>NOT</code>
<code>NULL</code>, в котором используется только одна таблица.

<LI>Недопустимые константные выражения выявляются на ранних этапах. MySQL

быстро обнаруживает, что некоторые операторы <code>SELECT</code> неосуществимы и не
возвращают строк.

<LI>Выполняется слияние выражения <code>HAVING</code> с <code>WHERE</code>, если не используется

предложение <code>GROUP BY</code> или групповые функции (<code>COUNT(), MIN()...</code>).

<LI>Для каждого подчиненного связывания создается более простое

предложение <code>WHERE</code>, чтобы ускорить оценку <code>WHERE</code> для каждого
подчиненного связывания а также чтобы пропустить записи как можно
быстрее.

<LI>Все константные таблицы считываются в первую очередь, перед любыми

другими таблицами в запросе. К константным таблицам относятся
следующие:


<UL>

<LI>Пустая таблица или таблица с 1 строкой.

<LI>Таблица, которая используется с выражением <code>WHERE</code> для индекса <code>UNIQUE</code>,

или <code>PRIMARY KEY</code>, где все части индекса используются с константными
выражениями и части индекса определены как <code>NOT NULL</code>.
</UL>

Все эти таблицы используются как константные таблицы:


<PRE>
mysql&#62; SELECT * FROM t WHERE primary_key=1;
mysql&#62; SELECT * FROM t1,t2
    -&#62;          WHERE t1.primary_key=1 AND t2.primary_key=t1.id;
</PRE>

<LI>Лучшая комбинацию связывания для связывания таблиц находится путем

испытания всех возможных вариантов. Если все столбцы в предложениях
<code>ORDER BY</code> и <code>GROUP BY</code> принадлежат одной таблице, эта таблица
рассматривается первой при связывании.

<LI>Если имеется выражение <code>ORDER BY</code> и отличное от него выражение <code>GROUP BY</code>,

или если выражения <code>ORDER BY</code> или <code>GROUP BY</code> содержат столбцы не только из
первой таблицы в очереди на связывание, но и из других таблиц, то
тогда создается временная таблица.

<LI>Если используется <code>SQL_SMALL_RESULT</code>, MySQL будет применять временную

таблицу, которую разместит в памяти.

<LI>Запрашивается каждый индекс таблицы, и используется лучший,

охватывающий менее 30% строк. Если такой индекс найти нельзя,
используется быстрое сканирование таблицы.

<LI>В некоторых случаях MySQL может читать данные из индекса даже без

обращения к файлу данных. Если все столбцы, используемые в индексе,
числовые, то для выполнения запроса будет использоваться только
индексное дерево.

<LI>Перед выводом каждой записи пропускаются те, которые не соответствуют

выражению <code>HAVING</code>.
</UL>

<P>
Вот некоторые примеры очень быстрых запросов:

</P>

<PRE>
mysql&#62; SELECT COUNT(*) FROM tbl_name;
mysql&#62; SELECT MIN(key_part1),MAX(key_part1) FROM tbl_name;
mysql&#62; SELECT MAX(key_part2) FROM tbl_name
    -&#62;        WHERE key_part_1=constant;
mysql&#62; SELECT ... FROM tbl_name
    -&#62;        ORDER BY key_part1,key_part2,... LIMIT 10;
mysql&#62; SELECT ... FROM tbl_name
    -&#62;        ORDER BY key_part1 DESC,key_part2 DESC,... LIMIT 10;
</PRE>

<P>
Для выполнения следующих запросов используется только индексное дерево
(предполагается, что индексированные столбцы числовые):

</P>


<PRE>
mysql&#62; SELECT key_part1,key_part2 FROM tbl_name WHERE key_part1=val;
mysql&#62; SELECT COUNT(*) FROM tbl_name
    -&#62;        WHERE key_part1=val1 AND key_part2=val2;
mysql&#62; SELECT key_part2 FROM tbl_name GROUP BY key_part1;
</PRE>

<P>
Следующие запросы используют индексацию, чтобы получить отсортированные
строки без дополнительного прохода для сортировки:

</P>


<PRE>
mysql&#62; SELECT ... FROM tbl_name
    -&#62;            ORDER BY key_part1,key_part2,... ;
mysql&#62; SELECT ... FROM tbl_name
    -&#62;            ORDER BY key_part1 DESC,key_part2 DESC,... ;
</PRE>



<H3><A NAME="DISTINCT_optimisation" HREF="manual.ru_toc.html#DISTINCT_optimisation">5.2.5  Как MySQL оптимизирует <code>DISTINCT</code></A></H3>

<P>
<A NAME="IDX867"></A>

</P>
<P>
<A NAME="IDX868"></A>

</P>
<P>
<code>DISTINCT</code> преобразовывается к <code>GROUP BY</code> для всех столбцов, для <code>DISTINCT</code> в
сочетании с <code>ORDER BY</code>, помимо этого, во многих случаях также требуется
временная таблица.

</P>
<P>
Если <code>LIMIT #</code> указывается совместно с <code>DISTINCT</code>, MySQL остановится, как
только найдет # уникальных строк.

</P>
<P>
Если не все столбцы и не во всех таблицах используются, MySQL прекратит
сканирование неиспользуемых таблиц, как только найдет первое совпадение.

</P>

<PRE>
SELECT DISTINCT t1.a FROM t1,t2 where t1.a=t2.a;
</PRE>

<P>
В случае, если, предположим, таблица <code>t1</code> используется перед <code>t2</code> (это
проверяется при помощи <code>EXPLAIN</code>), MySQL прекратит чтение в <code>t2</code> (для каждой
отдельной строки из <code>t1</code>), после того как найдет первую строку в <code>t2</code>.

</P>


<H3><A NAME="LEFT_JOIN_optimisation" HREF="manual.ru_toc.html#LEFT_JOIN_optimisation">5.2.6  Как MySQL оптимизирует <code>LEFT JOIN</code> и <code>RIGHT JOIN</code></A></H3>

<P>
<A NAME="IDX869"></A>

</P>
<P>
<A NAME="IDX870"></A>

</P>
<P>
Выражение "<code>A LEFT JOIN B</code>" в MySQL реализовано следующим образом:

</P>

<UL>
<LI>Таблица B устанавливается как зависимая от таблицы A и от всех таблиц,

от которых зависит A.

<LI>Таблица A устанавливается как зависимая ото всех таблиц (кроме B),

которые используются в условии <code>LEFT JOIN</code>.

<LI>Все условия <code>LEFT JOIN</code> перемещаются в предложение <code>WHERE</code>.

<LI>Выполняются все стандартные способы оптимизации соединения, за

исключением того, что таблица всегда читается после всех таблиц, от
которых она зависит. Если имеется циклическая зависимость, MySQL
выдаст ошибку.

<LI>Выполняются все стандартные способы оптимизации <code>WHERE</code>.

<LI>Если в таблице A имеется строка, соответствующая выражению <code>WHERE</code>, но в

таблице B ни одна строка не удовлетворяет условию <code>LEFT JOIN</code>,
генерируется дополнительная строка B, в которой все значения столбцов
устанавливаются в <code>NULL</code>.

<LI>Если <code>LEFT JOIN</code> используется для поиска тех строк, которые отсутствуют

в некоторой таблице, и в предложении <code>WHERE</code> выполняется следующая
проверка: <code>column_name IS NULL</code>, где <code>column_name</code> - столбец, который
объявлен как <code>NOT NULL</code>, MySQL пререстанет искать строки (для отдельной
комбинации ключа) после того, как найдет строку, соответствующую
условию <code>LEFT JOIN</code>.
</UL>

<P>
<code>RIGHT JOIN</code> реализован аналогично <code>LEFT JOIN</code>.

</P>
<P>
При указании жесткого порядка чтения таблиц в <code>LEFT JOIN</code> и <code>STRAIGHT JOIN</code>
оптимизатор связей (который определяет, в каком порядке
таблицы должны быть связаны) будет выполнять работу намного быстрее, так
как ему потребуется проверять меньшее количество перестановок таблиц.

</P>
<P>
Обратите внимание: отсюда следует, что если выполняется запрос типа

</P>

<PRE>
SELECT * FROM a,b LEFT JOIN c ON (c.key=a.key) LEFT JOIN d (d.key=a.key)
         WHERE b.key=d.key
</PRE>

<P>
MySQL будет делать полный просмотр таблицы <code>b</code>, поскольку <code>LEFT JOIN</code> заставит
его читать эту таблицу перед <code>d</code>.

</P>
<P>
В этом случае, чтобы предотвратить полный просмотр таблицы <code>b</code>, нужно
изменить запрос таким образом:

</P>

<PRE>
SELECT * FROM b,a LEFT JOIN c ON (c.key=a.key) LEFT JOIN d (d.key=a.key)
         WHERE b.key=d.key
</PRE>



<H3><A NAME="ORDER_BY_optimisation" HREF="manual.ru_toc.html#ORDER_BY_optimisation">5.2.7  Как MySQL оптимизирует <code>ORDER BY</code></A></H3>

<P>
В некоторых случаях MySQL может использовать индекс, чтобы выполнить
запрос <code>ORDER BY</code> или <code>GROUP BY</code> без выполнения дополнительной сортировки.

</P>
<P>
Индекс может также использоваться и тогда, когда предложение <code>ORDER BY</code> не
соответствует индексу в точности, если все неиспользуемые части индекса и
все столбцы, не указанные в <code>ORDER BY</code> - константы в выражении <code>WHERE</code>.
Следующие запросы будут использовать индекс, чтобы выполнить 
<code>ORDER BY / GROUP BY</code>.

</P>

<PRE>
SELECT * FROM t1 ORDER BY key_part1,key_part2,...
SELECT * FROM t1 WHERE key_part1=constant ORDER BY key_part2
SELECT * FROM t1 WHERE key_part1=constant GROUP BY key_part2
SELECT * FROM t1 ORDER BY key_part1 DESC,key_part2 DESC
SELECT * FROM t1 WHERE key_part1=1 ORDER BY key_part1 DESC,key_part2 DESC
</PRE>

<P>
Ниже приведены некоторые случаи, когда MySQL <strong>не может</strong> использовать
индексы, чтобы выполнить <code>ORDER BY</code> (обратите внимание, что MySQL тем не
менее будет использовать индексы, чтобы найти строки, соответствующие
выражению <code>WHERE</code>):

</P>

<UL>
<LI>

Сортировка <code>ORDER BY</code> делается по нескольким ключам: 
<code>SELECT * FROM t1 ORDER BY key1,key2</code>

<LI>

Сортировка <code>ORDER BY</code> делается, при использовании непоследовательных
частей  ключа: <code>SELECT * FROM t1 WHERE key2=constant ORDER BY key_part2</code>

<LI>

Смешиваются <code>ASC</code> и <code>DESC</code>. 
<code>SELECT * FROM t1 ORDER BY key_part1 DESC,key_part2 ASC</code>

<LI>

Для выборки строк и для сортировки <code>ORDER BY</code> используются разные ключи:
<code>SELECT * FROM t1 WHERE key2=constant ORDER BY key1</code>

<LI>

Связываются несколько таблиц, и столбцы, по которым делается
сортировка <code>ORDER BY</code>, относятся не только к первой неконстантной
(const) таблице, используемой для выборки строк (это первая таблица в
выводе <code>EXPLAIN</code>, в которой не используется константный, <code>const</code>, метод
выборки строк).

<LI>

Имеются различные выражения <code>ORDER BY</code> и <code>GROUP BY</code>.

<LI>

Используемый индекс таблицы имеет такой тип, который не обеспечивает
сортированного хранения строк (как индекс <code>HASH</code> в таблицах <code>HEAP</code>).

</UL>

<P>
В тех случаях, когда MySQL должен сортировать результат, он использует
следующий алгоритм:

</P>

<UL>
<LI>

Считываются все строки согласно ключу или путем сканирования таблицы.
Строки, которые не соответствует предложению WHERE, пропускаются.

<LI>

Ключ сортировки сохраняется в буфере сортировки (размера <code>sort_buffer</code>)

<LI>

Когда буфер заполняется, содержимое буфера сортируется алгоритмом
<code>qsort</code>, результаты сохраняются во временном файле. Сохраняется
указатель на отсортированный блок (в том случае, когда все строки
умещаются в буфере сортировки, временный файл не создается).

<LI>

Вышеупомянутое действие повторяется, пока не будут считаны все строки.

<LI>

Делается мультислияние до <code>MERGEBUFF</code> (7) областей в один блок в другом
временном файле. Это действие повторяется, пока все блоки из первого
файла не окажутся во втором файле.

<LI>

Предыдущий пункт повторяется, пока не останется менее <code>MERGEBUFF2</code> (15)
блоков.

<LI>

При последнем мультислиянии в результирующий файл записывается только
указатель на строку (последняя часть ключа сортировки).

<LI>

Теперь код в файле <tt>`sql/records.cc'</tt> будет использоваться для чтения
данных в отсортированном порядке, с использованием указателей на
строки из результирующего файла. Чтобы оптимизировать этот процесс, мы
считываем большой блок указателей на строки, сортируем их, и затем
считываем строки в отсортированном порядке в буфер строк
(<code>record_rnd_buffer</code>).
</UL>

<P>
При помощи команды <code>EXPLAIN SELECT ... ORDER BY</code> можно проверить, может ли
MySQL использовать индексы для выполнения запроса. Если в столбце <code>extra</code>
содержится значение <code>Using filesort</code>, то MySQL не может использовать индексы
для выполнения сортировки <code>ORDER BY</code>. See section <A HREF="manual.ru.html#EXPLAIN">5.2.1  Синтаксис оператора <code>EXPLAIN</code> (получение информации о <code>SELECT</code>)</A>.

</P>
<P>
Чтобы сортировка <code>ORDER BY</code> выполнялась с большей скоростью, нужно сначала
посмотреть, можно ли заставить MySQL использовать индексы взамен
дополнительной фазы сортировки. Если это невозможно, то можно сделать
следующее:

</P>

<UL>
<LI>

Увеличить значение переменной <code>sort_buffer</code>.

<LI>

Увеличить значение переменной <code>record_rnd_buffer</code>.

<LI>

Изменить переменную <code>tmpdir</code>, чтобы она указывала на выделенный диск с
большим количеством свободного пространства.
Начиная с MySQL 4.1, в <code>tmpdir</code> могут быть указаны несколько путей, разделенных
двоеточием <code>:</code> (точкой с запятой на Windows <code>;</code>). Эти пути будут 
использованы в ротации. 

<strong>Внимание:</strong> Эти пути должны находится на разных <strong>физических</strong>
дисках, не на разных разделах одного и того же диска. 

</UL>

<P>
MySQL по умолчанию сортирует все <code>GROUP BY x,y[,...]</code> запросы так, как
если бы вы указали <code>ORDER BY x,y[,...]</code>. MySQL будет оптимизировать любой
<code>ORDER BY</code> как сказано выше, без всяких потерь производительности. Если,
как в некоторых случаях, вы не хотите иметь результат отсортированным, вы
можете указать <code>ORDER BY NULL</code>: 

</P>

<PRE>
INSERT INTO foo SELECT a,COUNT(*) FROM bar GROUP BY a ORDER BY NULL;
</PRE>



<H3><A NAME="LIMIT_optimisation" HREF="manual.ru_toc.html#LIMIT_optimisation">5.2.8  Как MySQL оптимизирует <code>LIMIT</code></A></H3>

<P>
<A NAME="IDX871"></A>

</P>
<P>
<A NAME="IDX872"></A>

</P>
<P>
В некоторых случаях, когда используется <code>LIMIT #</code> и не используется <code>HAVING</code>,
MySQL будет выполнять запрос несколько иначе:

</P>

<UL>
<LI>

Если при помощи <code>LIMIT</code> выбираются только несколько строк, MySQL будет
использовать индексы в тех некоторых случаях, когда он обычно
предпочел бы делать полное сканирование таблицы.

<LI>

Если <code>LIMIT #</code> используется с <code>ORDER BY</code>, MySQL закончит сортировку, как
только найдет первые <code>#</code> строк, вместо того, чтобы сортировать всю
таблицу.

<LI>

При сочетании <code>LIMIT #</code> с <code>DISTINCT</code> MySQL остановится, как только найдет
<code>#</code> уникальных строк.

<LI>

В некоторых случаях группировка <code>GROUP BY</code> может быть выполнена путем
упорядоченного считывания ключа (или путем выполнения сортировки по
ключу) и последующего вычисления итогового результата пока не
изменится значение ключа. В этом случае <code>LIMIT #</code> не будет вычислять
какие-либо ненужные предложения <code>GROUP BY</code>.

<LI>

После того как MySQL пошлет первые <code>#</code> строк клиенту, он прервет
выполнение запроса (если не используется <code>SQL_CALC_FOUND_ROWS</code>).

<LI>

<code>LIMIT 0</code> всегда будет быстро возвращать пустую выборку. Эта команда
полезна для проверки запроса и получения типов столбцов результата.

<LI>

Если сервер для выполнения запроса использует временные таблицы, <code>LIMIT
#</code> применяется для вычисления того, сколько для них потребуется места.
</UL>



<H3><A NAME="Insert_speed" HREF="manual.ru_toc.html#Insert_speed">5.2.9  Скорость выполнения запросов <code>INSERT</code></A></H3>

<P>
<A NAME="IDX873"></A>

</P>
<P>
<A NAME="IDX874"></A>
<A NAME="IDX875"></A>

</P>
<P>
Время, необходимое для вставки записи, можно грубо разделить на такие
промежутки:

</P>

<UL>
<LI>

Подсоединение: (3)
<LI>

Посылка запроса на сервер: (2)
<LI>

Синтаксический анализ запроса: (2)
<LI>

Вставка записи: (1 * размер записи)
<LI>

Вставка индексов: (1 * число индексов)
<LI>

Закрытие: (1)
</UL>

<P>
где числа в скобках пропорциональны полному времени. При этом не
учитывается время в начале вставки, требующееся для открытия таблиц
(таблицы открываются один раз для каждого конкурентно выполняющегося
запроса).

</P>
<P>
Размер таблицы замедляет вставку индексов в <code>log N</code> раз (B-деревья).

</P>
<P>
Некоторые способы ускорения вставки:

</P>

<UL>
<LI>

Если с одного клиента одновременно вставляется большое количество
строк, используйте операторы <code>INSERT</code> в форме, содержащей множество
записей. При этом вставка будет происходить намного быстрее (в
некоторых случаях в несколько раз), чем при использовании отдельных
операторов <code>INSERT</code>. При добавлении данных в непустую таблицу можно
настроить переменную <code>bulk_insert_buffer_size</code> так, чтобы это
делалось еще быстрее. See section <A HREF="manual.ru.html#SHOW_VARIABLES">4.5.6.4  <code>SHOW VARIABLES</code></A>.

<LI>

При вставке нескольких строк с различных клиентов можно повысить
скорость, используя оператор <code>INSERT DELAYED</code>. See section <A HREF="manual.ru.html#INSERT">6.4.3  Синтаксис оператора <code>INSERT</code></A>.

<LI>

Обратите внимание: при использовании таблиц <code>MyISAM</code> можно вставлять
строки во время выполнения операторов <code>SELECT</code>, если в таблицах нет
удаленных строк.

<LI>

При загрузке таблицы из текстового файла используйте команду <code>LOAD DATA
INFILE</code>. При этом обычно вставка будет происходить в 20 раз быстрее,
чем при использовании соответствующего количества операторов <code>INSERT</code>.
See section <A HREF="manual.ru.html#LOAD_DATA">6.4.9  Синтаксис оператора  <code>LOAD DATA INFILE</code></A>.

<LI>

Если таблица имеет много индексов, можно проделать некоторую
дополнительную работу, чтобы команда <code>LOAD DATA INFILE</code> выполнялась еще
быстрее. Используйте следующую процедуру:


<OL>

<LI>

При необходимости создайте таблицу при помощи оператора <code>CREATE TABLE</code>
(например, используя <code>mysql</code> или <code>Perl-DBI</code>).

<LI>

Выполните оператор <code>FLUSH TABLES</code> или команду оболочки: 
<code>mysqladmin flush-tables</code>.

<LI>

Используйте <code>myisamchk --keys-used=0 -rq /path/to/db/tbl_name</code>. После
этого индексы не будут использоваться для данной таблицы.

<LI>

Вставьте данные в таблицу при помощи <code>LOAD DATA INFILE</code>. При этом
никакие индексы обновляться не будут и, следовательно, скорость будет
высокой весьма.

<LI>

Если вы собираетесь в будущем только лишь читать таблицу, выполните
<code>myisampack</code> для этой таблицы, чтобы уменьшить ее размер. See section <A HREF="manual.ru.html#myisampack">4.7.4  <code>myisampack</code>, MySQL-генератор сжатых таблиц (только для чтения)</A>.

<LI>

Воссоздайте индексы при помощи команды <code>myisamchk -r -q
/path/to/db/tbl_name</code>. Эта процедура создает индексное дерево в памяти,
перед тем как записать его на диск, что гораздо быстрее за счет
исключения большого количества дисковых операций. Индексное дерево,
получившееся в результате, к тому же отлично сбалансировано.

<LI>

Выполните оператор <code>FLUSH TABLES</code> или команду оболочки: 
<code>mysqladmin flush-tables</code>.
</OL>

Обратите внимание: команда <code>LOAD DATA INFILE</code> также выполняет вышеупомянутую
оптимизацию при вставках в пустую таблицу. Главное отличие этой команды от
вышеупомянутой процедуры заключается в том, что при помощи <code>myisamchk</code> можно
выделить намного больше временной памяти для создания индекса, чем MySQL,
по вашему мнению, должен выделять для каждого воссоздания индексов.
Начиная с MySQL 4.0 можно также использовать команду <code>ALTER TABLE tbl_name
DISABLE KEYS</code> вместо <code>myisamchk --keys-used=0 -rq /path/to/db/tbl_name</code> и
<code>ALTER TABLE tbl_name ENABLE KEYS</code> вместо <code>myisamchk -r -q
/path/to/db/tbl_name</code>. Таким образом можно также пропускать шаги <code>FLUSH
TABLES</code>.

<LI>

Можно ускорять операции вставки, выполняемые несколькими операторами,
путем установки блокировки таблиц:


<PRE>
mysql&#62; LOCK TABLES a WRITE;
mysql&#62; INSERT INTO a VALUES (1,23),(2,34),(4,33);
mysql&#62; INSERT INTO a VALUES (8,26),(6,29);
mysql&#62; UNLOCK TABLES;
</PRE>

Главный фактор, влияющий на скорость, - то, что буфер индексов
сбрасывается на диск только один раз, после завершения всех операторов
<code>INSERT</code>. Обычно содержимое индексных буферов сбрасывалось бы на диск
столько раз, сколько имеется различных операторов <code>INSERT</code>. Блокировка не
нужна, если можно вставить все строки при помощи одного оператора. Для
транзакционных таблиц, чтобы повысить скорость, следует использовать
<code>BEGIN/COMMIT</code> вместо <code>LOCK TABLES</code>. Блокировка также понизит полное время
проверки подсоединений (multi-connection tests), но максимальное время
ожидания для некоторых потоков повысится (потому что они ожидают снятия
блокировки). Например:


<PRE>
поток 1 делает 1000 вставок
потоки 2, 3 и 4 делают 1 вставку
поток 5 делает 1000 вставок
</PRE>

Если блокировка не используется, 2, 3, и 4 завершат выполнение раньше, чем
1 и 5. Если блокировка используется, 2, 3 и 4, видимо, не закончат
выполнение раньше, чем 1 или 5, но общее время должно приблизительно
уменьшиться на 40%. Так как в MySQL операции <code>INSERT</code>, <code>UPDATE</code> и <code>DELETE</code> очень
быстрые, общая производительность будет улучшаться, если добавлять
блокировки ко всем командам, делающим более 5 вставок или обновлений
подряд. Если делается очень много вставок строк, можно время от времени
сопровождать команду <code>LOCK TABLES</code> командой <code>UNLOCK TABLES</code> (после каждых 1000
строк), чтобы позволить другим потокам обращаться к таблице. Результатом
всего этого будет получение хорошей производительности. Конечно, для
загрузки данных намного более быстрой является команда <code>LOAD DATA INFILE</code>.

</UL>

<P>
Чтобы дополнительно повысить скорость выполнения команд <code>LOAD DATA INFILE</code> и
<code>INSERT</code>, увеличьте буфер ключа (<code>key buffer</code>). See section <A HREF="manual.ru.html#Server_parameters">5.5.2  Настройка параметров сервера</A>.

</P>


<H3><A NAME="Update_speed" HREF="manual.ru_toc.html#Update_speed">5.2.10  Скорость выполнения запросов <code>UPDATE</code></A></H3>

<P>
<A NAME="IDX876"></A>

</P>
<P>
Запросы <code>UPDATE</code> оптимизируются как запрос <code>SELECT</code> с дополнительными
издержками на запись. Скорость записи зависит от размера обновляемых
данных и количества обновляемых индексов. Индексы, которые не были
изменены, обновлены не будут.

</P>
<P>
Существует и другой способ произвести операции обновления быстро:
задерживать операции обновления, а потом делаеть сразу несколько
обновлений. Несколько обновлений подряд выполняются намного быстрее, чем
отдельные обновления если вы блокируете таблицу.

</P>
<P>
Обратите внимание: при использовании динамического формата записи, если
запись обновляется более длинной, может произойти "расслоение" записи.
Таким образом, если вы делаете это часто, очень важно время от времени
выполнять команду <code>OPTIMIZE TABLE</code>. See section <A HREF="manual.ru.html#OPTIMIZE_TABLE">4.5.1  Синтаксис  команды <code>OPTIMIZE TABLE</code></A>.

</P>


<H3><A NAME="Delete_speed" HREF="manual.ru_toc.html#Delete_speed">5.2.11  Скорость выполнения запросов <code>DELETE</code></A></H3>

<P>
Чтобы удалить все строки в таблице, нужно использовать команду <code>TRUNCATE
TABLE table_name</code>. See section <A HREF="manual.ru.html#TRUNCATE">6.4.7  Синтаксис оператора <code>TRUNCATE</code></A>.

</P>
<P>
Время, необходимое для удаления записи, прямо пропорционально числу
индексов. Чтобы записи удалялись быстрее, можно увеличить размер
индексного кэша. See section <A HREF="manual.ru.html#Server_parameters">5.5.2  Настройка параметров сервера</A>.

</P>


<H3><A NAME="Tips" HREF="manual.ru_toc.html#Tips">5.2.12  Другие советы по оптимизации</A></H3>

<P>
<A NAME="IDX877"></A>
<A NAME="IDX878"></A>

</P>
<P>
Несортированные советы для повышения скорости систем:

</P>

<UL>
<LI>

Используйте постоянные соединения с базой данных, чтобы избежать
издержек на подключения. Если невозможно использовать постоянные
соединения и осуществляется большое количество новых подключений к
базе данных, то можно изменить значение переменной <code>thread_cache_size</code>.
See section <A HREF="manual.ru.html#Server_parameters">5.5.2  Настройка параметров сервера</A>.

<LI>

Всегда проверяйте, чтобы все ваши запросы действительно использовали
созданные вами в таблицах индексы. В MySQL это можно сделать с помощью
команды <code>EXPLAIN</code>. See section <A HREF="manual.ru.html#EXPLAIN">5.2.1  Синтаксис оператора <code>EXPLAIN</code> (получение информации о <code>SELECT</code>)</A>.

<LI>

Старайтесь избегать сложных запросов <code>SELECT</code> на часто обновляемых
таблицах типа MyISAM. Это помогает избежать проблем с блокировкой
таблиц.

<LI>

Новые таблицы MyISAM могут вносить записи в таблицу без удаляемых
записей, которые в то же самое время читает иная таблица. Если это
имеет для вас значение, то следует рассмотреть методы, не требующие
удаления записей или запускать <code>OPTIMIZE TABLE</code> после удаления большого
количества строк.

<LI>

Используйте <code>ALTER TABLE ... ORDER BY expr1,expr2...</code> если вы большей
частью извлекаете записи в порядке <code>expr1,expr2...</code> Можно получить более
высокую производительность, используя эту опцию после больших
преобразований в таблице.

<LI>

В некоторых случаях может оказаться целесообразным введение столбца,
базирующегося на "хэшированной" информации из других столбцов. Если
этот столбец невелик и достаточно уникален, то он может быть намного
быстрее, чем большой индекс на многих столбцах. В MySQL очень просто
использовать подобный дополнительный столбец: 

<code>SELECT * FROM table_name
WHERE hash=MD5(CONCAT(col1,col2)) AND col_1='constant' AND
col_2='constant</code>'

<LI>

Для часто изменяющихся таблиц следует избегать типов <code>VARCHAR</code> или <code>BLOB</code>
для всех столбцов. При использовании единичного столбца <code>VARCHAR</code> или
<code>BLOB</code> вы получите динамическую длину строки. See section <A HREF="manual.ru.html#Table_types">7  Типы  таблиц MySQL</A>.

<LI>

Разделение таблицы на несколько различных таблиц просто потому, что
строки получаются "большими", обычно не приносит пользы. Чтобы
получить доступ к строке, наиболее трудоемким оказывается поиск по
диску для нахождения первого байта этой строки. После нахождения этих
данных большинство новых дисков могут прочесть всю строку достаточно
быстро для большинства приложений. Разделение таблицы имеет значение
только в следующих случаях: когда это таблица с динамическим размером
строки (смотрите выше), которую можно изменить на строку
фиксированного размера, или когда необходимо просматривать таблицу
очень часто и нет необходимости в большинстве столбцов.
See section <A HREF="manual.ru.html#Table_types">7  Типы  таблиц MySQL</A>.

<LI>

Если очень часто приходится производить вычисления, базирующиеся на
информации из большого количества строк (такие как подсчет
предметов), то, вероятно, намного лучше ввести новую таблицу и
обновлять счетчик в режиме реального времени. Обновление вида <code>UPDATE
table SET count=count+1 WHERE index_column=constant</code> является очень
быстрым! 

Это действительно важно при использовании типов таблиц MySQL, вроде MyISAM или
ISAM, имеющих только блокирование таблиц (многочисленные читающие/единственный
записывающий). Для многих баз данных это обеспечит также более высокую
производительность, поскольку программа управления блокировкой строк в этом
случае будет иметь меньше работы.

<LI>

Если необходимо собирать статистические данные из больших журнальных
таблиц, то используйте сводные таблицы вместо сканирования целой
таблицы. Поддерживать сводные таблицы должно быть намного быстрее, чем
пытаться сделать ``живую'' статистику. Намного быстрее воспроизвести
новые сводные таблицы из журналов, когда что-либо изменяется (в
зависимости от деловых решений), чем изменять работающее приложение!

<LI>

Если возможно, необходимо классифицировать отчеты как "реальные" или
"статистические", где данные, необходимые для статистических
отчетов, генерируются только на основе сводных таблиц, которые
формируются из реальных данных.

<LI>

Воспользуйтесь преимуществом того факта, что столбцы имеют значения по
умолчанию. Вносите величины явно только тогда, когда значения вносимых
величин отличаются от установленных по умолчанию. Это уменьшает объем
анализа, который необходимо произвести в MySQL, и улучшает скорость
внесения.

<LI>

В некоторых случаях удобно упаковывать и хранить данные в столбцах
<code>BLOB</code>. В этом случае необходимо добавить дополнительный код для
запаковывания в <code>BLOB</code> и распаковывания обратно, но на некотором этапе
это может сэкономить много обращений. Это практично, когда ваши данные
не согласуются со структурой статической таблицы.

<LI>

Обычно следует стремиться сохранять все данные в безизбыточной форме
(которая называется 3-й нормальной формой в теории баз данных), но не
следует опасаться дублирования данных или создания сводных таблиц,
если это необходимо для достижения большей скорости.

<LI>

Хранимые процедуры или <code>UDF</code> (функции, определяемые пользователем) могут
быть хорошим способом получить большую производительность. В этом
случае, однако, следует иметь в запасе некоторый иной (более
медленный) путь, если используемая вами база данных не поддерживает
этих возможностей.

<LI>

Вы всегда можете кое-чего достичь путем кэширования запросов/ответов в
своем приложении и стараясь выполнить много вставок/обновлений в одно
и то же время. Если ваша база данных поддерживает блокировку таблиц
(как MySQL и Oracle), то это должно помочь гарантировать, что кэш
индексов сбрасывается только однажды после всех обновлений.

<LI>

Используйте <code>INSERT /*! DELAYED */</code>, если нет необходимости знать,
когда ваши данные записываются. Это повысит скорость работы, поскольку
многие табличные записи могут быть внесены с помощью одной дисковой
записи.

<LI>

Используйте <code>INSERT /*! LOW_PRIORITY */</code>, если хотите сделать ваши
выборки более важными.

<LI>

Используйте <code>SELECT /*! HIGH_PRIORITY */</code>, чтобы получить выборки,
которые перепрыгивают очередь. То есть, выборка выполняется, даже если
кто-либо ожидает, чтобы сделать запись.

<LI>

Используйте многострочную команду <code>INSERT</code> для хранения многих строк в
одной SQL-команде (многие SQL-серверы поддерживают это).

<LI>

Используйте <code>LOAD DATA INFILE</code> для загрузки больших количеств данных.
Это быстрее, чем обычные вставки и будет еще быстрее при интеграции
<code>myisamchk</code> в <code>mysqld</code>.

<LI>

Используйте столбцы <code>AUTO_INCREMENT</code>, чтобы сделать величины
уникальными.

<LI>

Используйте время от времени <code>OPTIMIZE TABLE</code>, чтобы избежать
фрагментации при использовании динамического табличного формата.
See section <A HREF="manual.ru.html#OPTIMIZE_TABLE">4.5.1  Синтаксис  команды <code>OPTIMIZE TABLE</code></A>.

<LI>

Используйте таблицы <code>HEAP</code>, чтобы получить более высокую скорость,
когда это возможно. See section <A HREF="manual.ru.html#Table_types">7  Типы  таблиц MySQL</A>.

<LI>

При использовании нормальной установки веб-сервера рисунки должны
храниться как файлы. То есть, храните в базе данных только ссылку на
файл. Главная причина этого состоит в том, что обычный веб-сервер
намного лучше кэширует файлы, чем содержание базы данных. Таким
образом, при использовании файлов намного легче получить быструю
систему.

<LI>

Используйте в памяти таблицы для неответственных данных, к которым
часто обращаются (таким, как информация о последнем показанном баннере
для пользователей, не имеющих cookies).

<LI>

Столбцы с идентичной информацией в различных таблицах должны
объявляться одинаково и иметь одинаковые имена. До версии 3.23 в
противном случае получались медленные соединения (slow joins).
Старайтесь сохранять имена простыми (используйте <code>name</code> вместо
<code>customer_name</code> в таблице <code>customer</code>). Чтобы ваши имена были переносимыми
на другие SQL-серверы, они должны быть короче, чем 18 символов.

<LI>

Если вам действительно нужна высокая скорость, вы должны взглянуть на
интерфейсы нижнего уровня для хранения данных, поддерживаемые
различными SQL-серверами! Например, обращаясь к таблицам <code>MyISAM</code> в
MySQL напрямую, можно было бы получить увеличение скорости в 2-5 раз
по сравнению с использованием интерфейса SQL. Для возможности сделать
это, данные должны находиться на том же самом сервере, что и
приложение, и, обычно, должны иметь доступ только в одном процессе
обработки (поскольку внешняя файловая блокировка действительно
медленна). Можно было бы избавиться от вышеуказанных проблем введением
низко-уровневых команд <code>MyISAM</code> в сервере MySQL (это был бы один из
простых путей получить большую производительность, если необходимо).
Путем тщательного проектирования интерфейса базы данных было бы
достаточно просто поддерживать этот тип оптимизации.

<LI>

Во многих случаях быстрее получить доступ к данным из базы данных
(используя действующее соединение), чем обращаться к текстовому файлу,
просто из-за того, что база данных, вероятно, более компактна, чем
текстовый файл (если вы используете числовые данные), и это приведет к
меньшему количеству обращений к диску. Вы также сэкономите на коде,
поскольку не должны анализировать текстовые файлы, чтобы найти границы
строк и столбцов.

<LI>

Для увеличения скорости можно также использовать репликацию. 
See section <A HREF="manual.ru.html#Replication">4.10  Репликация в MySQL</A>.

<LI>

Объявление таблицы с <code>DELAY_KEY_WRITE=1</code> сделает обновление индексов
более быстрым, так как они не записываются на диск, пока файл закрыт.
Обратная сторона этого заключается в том, что необходимо запускать
<code>myisamchk</code> на этих таблицах перед началом работы <code>mysqld</code>, для
уверенности, что все в порядке, если что-либо уничтожит <code>mysqld</code> в
середине работы. Поскольку ключевая информация всегда может быть
воспроизведена из данных, то вы не должны что-либо потерять при
использовании <code>DELAY_KEY_WRITE</code>.
</UL>



<H2><A NAME="Locking_Issues" HREF="manual.ru_toc.html#Locking_Issues">5.3  Вопросы блокировок</A></H2>



<H3><A NAME="Internal_locking" HREF="manual.ru_toc.html#Internal_locking">5.3.1  Как MySQL блокирует таблицы</A></H3>

<P>
<A NAME="IDX879"></A>
<A NAME="IDX880"></A>
<A NAME="IDX881"></A>

</P>
<P>
Описание различных методов блокировки дается в приложении, в разделе
section <A HREF="manual.ru.html#Locking_methods">D.4  Методы блокировки</A>.

</P>
<P>
В MySQL все блокировки, кроме блокировок таблиц типов <code>InnoDB</code> <code>и</code> BDB, не
создают тупиковых ситуаций. Это обеспечивается за счет того, что все
необходимые блокировки всегда запрашиваются единожды в начале запроса и
блокировка таблиц всегда происходит в одном и том же порядке.

</P>
<P>
В таблицах типа <code>InnoDB</code> устанавливается блокировка строк, а в таблицах типа
<code>BDB</code> - блокировка страниц в процессе выполнения SQL-команд, а не в начале
транзакции.

</P>
<P>
Метод блокирования, используемый в MySQL для блокировок записи (<code>WRITE</code>),
работает следующим образом:

</P>

<UL>
<LI>

Если на данной таблице нет никаких блокировок, то на нее накладывается
блокировка записи.

<LI>

В противном случае запрос на данную блокировку ставится в очередь
блокировок записи.
</UL>

<P>
Метод блокирования, используемый в MySQL для блокировок чтения (<code>READ</code>),
работает следующим образом:

</P>

<UL>
<LI>

Если на данной таблице нет блокировок записи, то на нее накладывается
блокировка чтения.

<LI>

В противном случае запрос на данную блокировку ставится в очередь
блокировок чтения.
</UL>

<P>
При освобождении текущей блокировки становится возможной следующая
блокировка для потоков из очереди блокировок записи, затем для потоков из
очереди блокировок чтения.

</P>
<P>
Это означает, что, если таблица подвергается многочисленным обновлениям,
то команды <code>SELECT</code> будут ожидать, пока обновления не закончатся.

</P>
<P>
Чтобы обойти это в случае, когда для таблицы требуется выполнить много
операций <code>INSERT</code> и <code>SELECT</code>, можно внести строки во временную таблицу и время
от времени обновлять реальную таблицу записями из временной.

</P>
<P>
Для этого можно применить следующий код:

</P>

<PRE>
mysql&#62; LOCK TABLES real_table WRITE, insert_table WRITE;
mysql&#62; INSERT INTO real_table SELECT * FROM insert_table;
mysql&#62; TRUNCATE TABLE insert_table;
mysql&#62; UNLOCK TABLES;
</PRE>

<P>
В некоторых случаях, когда необходимо установить приоритеты извлечения
данных, для команд <code>INSERT</code>, <code>UPDATE</code> или <code>DELETE</code> можно указывать опцию
<code>LOW_PRIORITY</code>, а  для  команды   <code>SELECT</code> - <code>HIGH_PRIORITY</code>. Тот же результат
можно получить, запустив <code>mysqld</code> с <code>--low-priority-updates</code>.

</P>
<P>
Использование <code>SQL_BUFFER_RESULT</code> тоже способствует уменьшению времени
блокировок таблиц. See section <A HREF="manual.ru.html#SELECT">6.4.1  Синтаксис оператора <code>SELECT</code></A>.

</P>
<P>
Можно также изменить блокировочный код в <tt>`mysys/thr_lock.c'</tt> - чтобы
использовать только одну очередь блокировок. В этом случае блокировки
записи и чтения будут иметь одинаковый приоритет, что может оказаться
полезным для некоторых приложений.

</P>


<H3><A NAME="Table_locking" HREF="manual.ru_toc.html#Table_locking">5.3.2  Вопросы блокирования таблиц</A></H3>

<P>
<A NAME="IDX882"></A>

</P>
<P>
Код блокирования таблиц в MySQL не создает тупиковых ситуаций.

</P>
<P>
Чтобы получить высокую скорость блокирования, в MySQL на таблицах всех
типов, кроме <code>InnoDB</code> <code>и</code> BDB,используется табличная блокировка (вместо
блокирования строк или столбцов). Если таблицы большие, то для большинства
приложений табличная блокировка намного лучше, чем строковая, но
существуют, конечно, и определенные подводные камни.

</P>
<P>
Для таблиц типов <code>InnoDB</code> и <code>BDB</code> в MySQL табличная блокировка используется
только в случае, если данная таблица явно блокируется командой <code>LOCK
TABLES</code>. Мы вообще не рекомендуем применять <code>LOCK TABLES</code> для упомянутых
типов таблиц, поскольку для таблицы <code>InnoDB</code> используется автоматическая
блокировка строкового уровня, а для таблиц <code>BDB</code> - блокировка страничного
уровня. Это делается, чтобы гарантировать изоляцию транзакций.

</P>
<P>
В версии MySQL 3.23.7 и выше можно вставлять строки в таблицы MyISAM в то
время, когда другие потоки производят чтение из этой таблицы. Следует
учитывать, что в настоящее время эта функция работает только при условии,
что в таблице в момент вставки отсутствуют какие-либо пустые пространства,
оставшиеся после удаленных из нее записей. Как только все пустые места
будут заполнены новыми данными, автоматически будет восстановлена
возможность делать одновременные вставки.

</P>
<P>
Табличная блокировка обеспечивает возможность одновременного выполнения
чтения из таблицы несколькими потоками, но если какой-нибудь поток
попробует произвести запись в таблицу, то вначале он должен получить
исключительный доступ. Во время обновления таблицы все другие потоки,
стремящиеся получить доступ к этой конкретной таблице, будут ожидать, пока
данное обновление не будет завершено.

</P>
<P>
Поскольку обновление обычно считается более важной операцией, чем <code>SELECT</code>,
то все команды, производящие обновления таблицы, имеют более высокий
приоритет, чем команды извлечения данных. Такой алгоритм гарантирует, что
обновления не зависнут в случае, если для некоторой таблицы выполняется
большое количество тяжелых запросов (этот порядок действий можно изменить,
используя <code>LOW_PRIORITY</code> с командой обновления или <code>HIGH_PRIORITY</code> с командой
<code>SELECT</code>).

</P>
<P>
Начиная с версии MySQL 3.23.7 можно использовать переменную
<code>max_write_lock_count</code>, чтобы заставить MySQL временно предоставить всем
командам <code>SELECT</code>, ожидающим доступ к таблице, более высокий приоритет после
заданного числа вставок в таблицу.

</P>
<P>
Табличную блокировку, однако, нецелесообразно использовать в случае
следующего сценария:

</P>

<UL>
<LI>

Клиент запускает <code>SELECT</code>, требующий длительного времени для выполнения.

<LI>

Затем другой клиент запускает команду <code>UPDATE</code> на используемой таблице.
Этот клиент будет ожидать, пока <code>SELECT</code> не закончит свою работу.

<LI>

Другой клиент запускает еще одну команду <code>SELECT</code> на той же таблице.
Поскольку <code>UPDATE</code> имеет более высокий приоритет, чем <code>SELECT</code>, то эта
команда <code>SELECT</code> будет ждать, пока <code>UPDATE</code> не закончит свою работу. Кроме
того, вторая команда <code>SELECT</code> будет также ждать, пока не завершится
первая команда <code>SELECT</code>!

<LI>

Поток ждет ситуации заполненного диска. В таком случае все потоки,
которые хотят получить доступ к проблемной таблице, будут переведены в
состояние ожидания до тех пор, пока не освободится немного дискового
пространства.
</UL>

<P>
Ниже представлены некоторые возможные решения данной проблемы:

</P>

<UL>
<LI>

Постарайтесь заставить команды <code>SELECT</code> выполняться быстрее. Возможно,
для этого необходимо будет создать сводные таблицы.

<LI>

Запустите  <code>mysqld</code>  с  <code>--low-priority-updates</code>. Этим вы назначите всем
командам обновления таблицы более низкий приоритет, чем у команды 
<code>SELECT</code>. Тогда последняя команда <code>SELECT</code> в предыдущем сценарии будет
выполняться перед командой <code>INSERT</code>.

<LI>

Конкретным командам <code>INSERT</code>, <code>UPDATE</code> или <code>DELETE</code> можно назначить более
низкий приоритет с помощью атрибута <code>LOW_PRIORITY</code>.

<LI>

Запустите <code>mysqld</code> с небольшим значением <code>max_write_lock_count</code>, чтобы
разрешить блокировки чтения (<code>READ</code>) после определенного количества
блокировок записи (<code>WRITE</code>).

<LI>

SQL-командой: <code>SET LOW_PRIORITY_UPDATES=1</code> можно указать, что все
обновления из конкретного потока должны выполняться с низким
приоритетом. See section <A HREF="manual.ru.html#SET_OPTION">5.5.6  Синтаксис команды <code>SET</code></A>.

<LI>

Можно указать, что команда <code>SELECT</code> является очень важной, - с помощью
атрибута <code>HIGH_PRIORITY</code>. See section <A HREF="manual.ru.html#SELECT">6.4.1  Синтаксис оператора <code>SELECT</code></A>.

<LI>

Если имеются проблемы при выполнении команд  <code>INSERT</code> совместно с
<code>SELECT</code>, перейдите на новые таблицы <code>MyISAM</code>, которые поддерживают
одновременное выполнение команд <code>SELECT</code> и <code>INSERT</code>.

<LI>

Если совместно выполняются преимущественно команды <code>INSERT</code> и <code>SELECT</code>, то
решить возникающие при этом проблемы иногда помогает атрибут <code>DELAYED</code>
для <code>INSERT</code>. See section <A HREF="manual.ru.html#INSERT">6.4.3  Синтаксис оператора <code>INSERT</code></A>.

<LI>

Если имеются проблемы с командами <code>SELECT</code> и <code>DELETE</code>, то может помочь
опция <code>LIMIT</code> для <code>DELETE</code>. See section <A HREF="manual.ru.html#DELETE">6.4.6  Синтаксис оператора <code>DELETE</code></A>.
</UL>



<H2><A NAME="Optimising_Database_Structure" HREF="manual.ru_toc.html#Optimising_Database_Structure">5.4  Оптимизация структуры базы данных</A></H2>



<H3><A NAME="Design" HREF="manual.ru_toc.html#Design">5.4.1  Конструктивные особенности MySQL</A></H3>

<P>
<A NAME="IDX883"></A>
<A NAME="IDX884"></A>
<A NAME="IDX885"></A>

</P>
<P>
В MySQL данные и индексы хранятся отдельно, в разных файлах, в то время
как во многих (практически во всех) базах данных данные и индексы
помещаются вместе в одном и том же файле. Мы полагаем, что конструкция
MySQL лучше подходит для очень широкого диапазона современных систем.

</P>
<P>
Существует еще один способ хранения исходных данных - когда данные для
каждого столбца содержатся в отдельной области (примерами являются SDBM и
Focus). При такой организации данных неизбежно снижение производительности
для каждого запроса, затрагивающего более, чем один столбец. Поскольку при
доступе к более чем одному столбцу ситуация очень быстро начинает
ухудшаться, то мы полагаем, что эта модель не вполне годится для баз
данных общего назначения.

</P>
<P>
Модель, когда индексы и данные хранятся вместе (как в Oracle/Sybase и
других), встречается чаще. В этом случае запись будет находиться в
странице соответствующего индекса. Преимущества такой схемы во многих
случаях заключаются в том, что считывание с диска получается более
экономным - в зависимости от того, насколько хорошо кэшируется индекс.
Недостатки же здесь следующие:

</P>

<UL>
<LI>

Сканирование таблиц выполняется намного медленнее, поскольку
необходимо прочитать индексы, чтобы добраться до данных.

<LI>

Нельзя использовать только таблицу индексов для извлечения данных по
запросу.

<LI>

Теряется много дискового пространства, поскольку необходимо
дублировать индексы из узлов (так как нельзя хранить строку в узлах)

<LI>

Удаления со временем приводят к вырождению таблицы (так как индексы в
узлах обычно не обновляются при операции удаления).

<LI>

Более сложно выполняется кэширование только данных об индексах.
</UL>



<H3><A NAME="Data_size" HREF="manual.ru_toc.html#Data_size">5.4.2  Сделайте объем данных как можно меньше</A></H3>

<P>
<A NAME="IDX886"></A>
<A NAME="IDX887"></A>
<A NAME="IDX888"></A>
<A NAME="IDX889"></A>
<A NAME="IDX890"></A>

</P>
<P>
Одна из основных задач оптимизации заключается в том, чтобы данные (и
индексы) занимали как можно меньше места на диске (и в памяти). Это дает
значительные преимущества в работе, поскольку ускоряется чтение диска, а
оперативная память, как правило, используется меньше. Индексирование также
требует меньших ресурсов, если оно выполняется на меньших столбцах.

</P>
<P>
MySQL поддерживает большое количество различных типов таблиц и форматов
строк. Значительный выигрыш в производительности можно получить за счет
правильного выбора формата таблицы (see section <A HREF="manual.ru.html#Table_types">7  Типы  таблиц MySQL</A>).

</P>
<P>
Чтобы увеличить производительность работы с таблицей и минимизировать
требуемое пространство памяти, можно применять перечисленные ниже
технические приемы:

</P>

<UL>
<LI>

Используйте по возможности наиболее эффективные (наименьшие по объему)
типы данных. В MySQL имеется много специализированных типов данных,
применение которых позволяет экономить пространство на диске и в
памяти.

<LI>

Используйте, если это возможно, целочисленные типы меньшей длины,
чтобы получить таблицы меньшего размера. Например, <code>MEDIUMINT</code> часто
лучше, чем <code>INT</code>.

<LI>

Объявляйте везде, где возможно, столбцы как <code>NOT NULL</code>. Это позволяет
ускорить все операции и сэкономить по одному биту для каждого столбца.
Однако если для данного приложения действительно нужен <code>NULL</code>, то вы
все-таки его (<code>NULL</code>) используйте. Нужно просто избегать наличия <code>NULL</code> во
всех столбцах по умолчанию.

<LI>

Если отсутствуют какие-либо столбцы переменной длины (столбцы типов
<code>VARCHAR</code>, <code>TEXT</code> или <code>BLOB</code>), то нужно применять формат записи
фиксированного размера. Такой метод дает увеличение скорости, но при
этом, к сожалению, может потребоваться лишнее место на диске. 
See section <A HREF="manual.ru.html#MyISAM_table_formats">7.1.2  Форматы таблиц <code>MyISAM</code></A>.

<LI>

Первичные индексы в таблице должны быть как можно короче. Это делает
идентификацию конкретной записи простой и эффективной.

<LI>

Метод хранения/индексации нужно выбрать для каждой таблицы. 
See section <A HREF="manual.ru.html#Table_types">7  Типы  таблиц MySQL</A>.

<LI>

Создавайте только те индексы, которые действительно необходимы.
Индексы хороши для извлечения данных, но плохи при необходимости
быстрого сохранения информации. Если работа с таблицей большей частью
сводится к поиску на некотором сочетании столбцов, то следует сделать
по ним индекс. Первая часть этого индекса должна представлять собой
наиболее используемый столбец. Если <strong>всегда</strong> задействовано много
столбцов, то следует первым использовать столбец с большим количеством
повторений, чтобы получить лучшее сжатие этого индекса.

<LI>

Если в столбце с большой степенью вероятности в начальной части
символов присутствует уникальный префикс, то лучше индексировать
только этот префикс. MySQL поддерживает индекс по части символов
столбца. Более короткие индексы работают быстрее не только за счет
того, что они занимают меньше дискового пространства, но также и
потому, что они обеспечивают больше попаданий в кэш индексов,
благодаря чему уменьшается количество операций поиска на диске. 
See section <A HREF="manual.ru.html#Server_parameters">5.5.2  Настройка параметров сервера</A>.

<LI>

Иногда целесообразно разбить очень часто просматриваемую таблицу на
две, особенно если таблица имеет динамический формат и при просмотре
данной таблицы для поиска соответствующих строк можно использовать
таблицу с меньшим статическим форматом.
</UL>



<H3><A NAME="MySQL_indexes" HREF="manual.ru_toc.html#MySQL_indexes">5.4.3  Использование индексов в MySQL</A></H3>

<P>
<A NAME="IDX891"></A>

</P>
<P>
Индексы применяются для быстрого поиска строк с указанным значением одного
столбца. Без индекса чтение таблицы осуществляется по всей таблице начиная
с первой записи, пока не будут найдены соответствующие строки. Чем больше
таблица, тем больше накладные расходы. Если же таблица содержит индекс по
рассматриваемым столбцам, то MySQL может быстро определить позицию для
поиска в середине файла данных без просмотра всех данных. Для таблицы,
содержащей 1000 строк, это будет как минимум в 100 раз быстрее по
сравнению с последовательным перебором всех записей. Однако в случае,
когда необходим доступ почти ко всем 1000 строкам, быстрее будет
последовательное чтение, так как при этом не требуется операций поиска по
диску.

</P>
<P>
Все индексы MySQL (<code>PRIMARY</code>, <code>UNIQUE</code>, и <code>INDEX</code>) хранятся в виде B-деревьев.
Строки автоматически сжимаются с удалением пробелов в префиксах и
оконечных пробелов (see section <A HREF="manual.ru.html#CREATE_INDEX">6.5.7  Синтаксис оператора <code>CREATE INDEX</code></A>).

</P>
<P>
Индексы используются для того, чтобы:

</P>

<UL>

<LI>

Быстро найти строки, соответствующие выражению <code>WHERE</code>.

<LI>

Извлечь строки из других таблиц при выполнении объединений.

<LI>

Найти величины <code>MAX()</code> или <code>MIN()</code> для заданного индексированного столбца.
Эта операция оптимизируется препроцессором, который проверяет, не
используете ли вы <code>WHERE key_part_4 = константа</code>, по всем частям
составного ключа <code>&#60; N</code>. В этом случае MySQL сделает один просмотр ключа
и заменит выражение константой <code>MIN()</code>. Если все выражения заменяются
константой, запрос моментально вернет результат:


<PRE>
SELECT MIN(key_part2),MAX(key_part2) FROM table_name where key_part1=10
</PRE>

<LI>

Производить сортировку или группирование в таблице, если эти операции
делаются на крайнем слева префиксе используемого ключа (например <code>ORDER
BY key_part_1,key_part_2</code>). Если за всеми частями ключа следует <code>DESC</code>,
то данный ключ читается в обратном порядке (see section <A HREF="manual.ru.html#ORDER_BY_optimisation">5.2.7  Как MySQL оптимизирует <code>ORDER BY</code></A>).

<LI>

В некоторых случаях запрос можно оптимизировать для извлечения величин
без обращения к файлу данных. Если все используемые столбцы в
некоторой таблице являются числовыми и образуют крайний слева префикс
для некоторого ключа, то чтобы обеспечить большую скорость, искомые
величины могут быть извлечены непосредственно из индексного дерева:


<PRE>
SELECT key_part3 FROM table_name WHERE key_part1=1
</PRE>

</UL>

<P>
Предположим, что вызывается следующий оператор <code>SELECT</code>:

</P>

<PRE>
mysql&#62; SELECT * FROM tbl_name WHERE col1=val1 AND col2=val2;
</PRE>

<P>
<A NAME="IDX892"></A>
<A NAME="IDX893"></A>

</P>
<P>
Если по столбцам <code>col1</code> и <code>col2</code> существует многостолбцовый индекс, то
соответствующие строки могут выбираться напрямую. В случае, когда по
столбцам <code>col1</code> и <code>col2</code> существуют раздельные индексы, оптимизатор пытается
найти наиболее ограничивающий индекс путем определения, какой индекс
найдет меньше строк, и использует данный индекс для выборки этих строк.

</P>
<P>
Если данная таблица имеет многостолбцовый индекс, то любой крайний слева
префикс этого индекса может использоваться оптимизатором для нахождения
строк. Например, если имеется индекс по трем столбцам (<code>col1,col2,col3</code>), то
существует потенциальная возможность индексированного поиска по (<code>col1</code>),
(<code>col1,col2</code>) и (<code>col1,col2,col3</code>).

</P>
<P>
В MySQL нельзя использовать частичный индекс, если столбцы не образуют
крайний слева префикс этого индекса. Предположим, что имеются команды
<code>SELECT</code>, показанные ниже:

</P>

<PRE>
mysql&#62; SELECT * FROM tbl_name WHERE col1=val1;
mysql&#62; SELECT * FROM tbl_name WHERE col2=val2;
mysql&#62; SELECT * FROM tbl_name WHERE col2=val2 AND col3=val3;
</PRE>

<P>
Если индекс существует по (<code>col1,col2,col3</code>), то только первый показанный
выше запрос использует данный индекс. Второй и третий запросы
действительно включают индексированные столбцы, но (<code>col2</code>) и  (<code>col2,col3</code>) не
являются крайней слева частью префиксов (<code>col1,col2,col3</code>).

</P>
<P>
<A NAME="IDX894"></A>
<A NAME="IDX895"></A>
<A NAME="IDX896"></A>
<A NAME="IDX897"></A>

</P>
<P>
MySQL применяет индексы также для сравнений <code>LIKE</code>, если аргумент в
выражении <code>LIKE</code> представляет собой постоянную строку, не начинающуюся с
символа-шаблона. Например, следующие команды <code>SELECT</code> используют индексы:

</P>

<PRE>
mysql&#62; SELECT * FROM tbl_name WHERE key_col LIKE "Patrick%";
mysql&#62; SELECT * FROM tbl_name WHERE key_col LIKE "Pat%_ck%";
</PRE>

<P>
В первой команде рассматриваются только строки с <code>"Patrick" &#60;= key_col &#60;
"Patricl"</code>, а во второй - только строки с <code>"Pat" &#60;= key_col &#60; "Pau"</code>.

</P>
<P>
Следующие команды <code>SELECT</code> не будут использовать индексы:

</P>

<PRE>
mysql&#62; SELECT * FROM tbl_name WHERE key_col LIKE "%Patrick%";
mysql&#62; SELECT * FROM tbl_name WHERE key_col LIKE other_col;
</PRE>

<P>
В первой команде величина <code>LIKE</code> начинается с шаблонного символа. Во второй
команде величина <code>LIKE</code> не является константой.

</P>
<P>
В версии MySQL 4.0 производится другая оптимизация на выражении <code>LIKE</code>. Если
используется выражение <code>... LIKE "%string%"</code> и длина строки (string) больше, чем 3
символа, то MySQL будет применять алгоритм Турбо Бойера-Мура для
инициализации шаблона для строки и затем использовать этот шаблон, чтобы
выполнить поиск быстрее.

</P>
<P>
<A NAME="IDX898"></A>
<A NAME="IDX899"></A>

</P>
<P>
При поиске с использованием <code>column_name IS NULL</code> будут использоваться
индексы, если <code>column_name</code> является индексом.

</P>
<P>
MySQL обычно использует тот индекс, который находит наименьшее количество
строк. Индекс применяется для столбцов, которые сравниваются с помощью
следующих операторов: <code>=, &#62;, &#62;=, &#60;, &#60;=, BETWEEN</code> и <code>LIKE</code> с префиксом, не
содержащим шаблонного символа, такого как <code>something%</code>.

</P>
<P>
Если индекс не охватывает все уровни <code>AND</code> в выражении <code>WHERE</code>, то он не
применяется для оптимизации данного запроса. Другими словами: чтобы индекс
можно было использовать, префикс этого индекса должен входить в каждую
группу <code>AND</code>.

</P>
<P>
Следующие выражения <code>WHERE</code> используют индексы:

</P>

<PRE>
... WHERE index_part1=1 AND index_part2=2 AND other_column=3
... WHERE index=1 OR A=10 AND index=2 /* индекс = 1 ИЛИ индекс = 2 */
... WHERE index_part1='hello' AND index_part_3=5

/* оптимизировано как "index_part1='hello'" */

... WHERE index1=1 and index2=2 or index1=3 and index3=3;

/* Можно использовать индекс по index1, но не по index2 или index 3 */
</PRE>

<P>
Следующие выражения <code>WHERE</code> <strong>не</strong> используют индексы:

</P>

<PRE>
... WHERE index_part2=1 AND index_part3=2 
/* index_part_1 не используется */

... WHERE index=1 OR A=10 
/* Индекс не используется в обеих частях AND */

... WHERE index_part1=1 OR index_part2=10 
/* Нет индекса, покрывающего все строки*/
</PRE>

<P>
В некоторых случаях MySQL не использует индекс, даже если это возможно.
Несколько примеров таких ситуаций приведено ниже:

</P>

<UL>
<LI>

Если использование индекса требует от MySQL прохода более чем по 30%
строк в данной таблице (в таких случаях просмотр таблицы, по всей
видимости, окажется намного быстрее, так как потребуется выполнить
меньше операций поиска). Следует учитывать, что если подобный запрос
использует <code>LIMIT</code> по отношению только к извлекаемой части строк, то
MySQL будет применять индекс в любом случае, так как небольшое
количество строк можно найти намного быстрее, чтобы вернуть результат.
</UL>



<H3><A NAME="Indexes" HREF="manual.ru_toc.html#Indexes">5.4.4  Индексы столбцов</A></H3>

<P>
<A NAME="IDX900"></A>
<A NAME="IDX901"></A>
<A NAME="IDX902"></A>

</P>
<P>
В MySQL могут быть проиндексированы столбцы всех типов. Использование
индексов на соответствующих столбцах представляет собой хороший способ
ускорения выполнения операций <code>SELECT</code>.

</P>
<P>
Максимальное количество ключей и максимальная длина индексов определяется
обработчиком таблиц (see section <A HREF="manual.ru.html#Table_types">7  Типы  таблиц MySQL</A>). Можно иметь по меньшей
мере 16 ключей на всех обработчиках таблиц и общую длину индексов по
меньшей мере 256 байтов.

</P>
<P>
Для столбцов типов <code>CHAR</code> и <code>VARCHAR</code> можно индексировать префикс столбца. Это
намного быстрее и требует меньше дискового пространства, чем индексация
всего столбца. Используемый в команде <code>CREATE TABLE</code> синтаксис для
индексации префикса столбца выглядит примерно так:

</P>

<PRE>
KEY index_name (col_name(length))
</PRE>

<P>
В следующем примере создается индекс для первых 10 символов в столбце <code>name</code>:

</P>

<PRE>
mysql&#62; CREATE TABLE test (
    -&#62;        name CHAR(200) NOT NULL,
    -&#62;        KEY index_name (name(10)));
</PRE>

<P>
Для столбцов типа <code>BLOB</code> и <code>TEXT</code> индексировать необходимо префикс столбца.
Нельзя индексировать столбец целиком.

</P>
<P>
В версии MySQL 3.23.23 и более поздних можно также создавать специальные
индексы <code>FULLTEXT</code>. Они используются для полнотекстового поиска.
Полнотекстовые индексы <code>FULLTEXT</code> поддерживают только таблицы типа <code>MyISAM</code>.
Они могут создаваться только по столбцам <code>VARCHAR</code> и <code>TEXT</code>. Индексация всегда
производится для целого столбца, а частичная индексация не поддерживается.
See section <A HREF="manual.ru.html#Fulltext_Search">6.8  Полнотекстовый поиск в MySQL</A>.

</P>


<H3><A NAME="Multiple-column_indexes" HREF="manual.ru_toc.html#Multiple-column_indexes">5.4.5  Многостолбцовые индексы</A></H3>

<P>
<A NAME="IDX903"></A>
<A NAME="IDX904"></A>
<A NAME="IDX905"></A>

</P>
<P>
MySQL может создавать индексы по нескольким столбцам. Индекс может
включать в себя до 15 столбцов (на столбцах <code>CHAR</code> и <code>VARCHAR</code> можно также
использовать префикс столбца в качестве части индекса)

</P>
<P>
Многостолбцовый индекс может рассматриваться как упорядоченный массив,
содержащий величины, созданные конкатенацией величин проиндексированных
столбцов.

</P>
<P>
MySQL использует многостолбцовые индексы таким образом, что запросы
выполняются быстро, когда указывается известная часть для первого столбца
в индексе в выражении <code>WHERE</code>, даже если не заданы  величины для других
столбцов.

</P>
<P>
Предположим, создается следующая таблица:

</P>

<PRE>
mysql&#62; CREATE TABLE test (
    -&#62;       id INT NOT NULL,
    -&#62;       last_name CHAR(30) NOT NULL,
    -&#62;       first_name CHAR(30) NOT NULL,
    -&#62;       PRIMARY KEY (id),
    -&#62;       INDEX name (last_name,first_name));
</PRE>

<P>
Индекс <code>name</code> является индексом по столбцам <code>last_name</code> и <code>first_name</code>. Этот
индекс будет применяться для запросов, указывающих величины в известной
области для <code>last_name</code> или для обоих столбцов <code>last_name</code> и <code>first_name</code>. Таким
образом, индекс <code>name</code> будет использоваться в следующих запросах:

</P>

<PRE>
mysql&#62; SELECT * FROM test WHERE last_name="Widenius";

mysql&#62; SELECT * FROM test WHERE last_name="Widenius"
    -&#62;                    AND first_name="Michael";

mysql&#62; SELECT * FROM test WHERE last_name="Widenius"
    -&#62;                    AND (first_name="Michael" OR first_name="Monty");

mysql&#62; SELECT * FROM test WHERE last_name="Widenius"
    -&#62;                    AND first_name &#62;="M" AND first_name &#60; "N";
</PRE>

<P>
Чтобы получить более подробную информацию о том, как в MySQL используются
индексы для улучшения работы запросов, See section <A HREF="manual.ru.html#MySQL_indexes">5.4.3  Использование индексов в MySQL</A>.

</P>


<H3><A NAME="Open_tables" HREF="manual.ru_toc.html#Open_tables">5.4.6  Почему так много открытых таблиц?</A></H3>

<P>
<A NAME="IDX906"></A>
<A NAME="IDX907"></A>

</P>
<P>
При запуске <code>mysqladmin status</code> можно увидеть что-нибудь вроде этого:

</P>

<PRE>
Uptime: 426 Running threads: 1 Questions: 11082 Reloads: 1 Open tables: 12
</PRE>

<P>
В чем же дело, ведь у вас всего 6 таблиц?

</P>
<P>
MySQL является многопоточной базой данных, поэтому для одной и той же
таблицы могут одновременно присутствовать несколько запросов. Чтобы
минимизировать эту проблему для двух потоков, имеющих различный статус на
одном и том же файле, таблица открывается независимо каждым конкурирующим
потоком. Это требует дополнительной памяти, но, как правило, повышает
производительность. Кроме того, для таблиц типа <code>ISAM</code> и <code>MyISAM</code> требуется
дополнительный дескриптор для файла данных. В таблицах этого типа
дескриптор индексного файла используется совместно всеми потоками.

</P>
<P>
В следующем разделе вы найдете более подробную информацию по этой теме
(see section <A HREF="manual.ru.html#Table_cache">5.4.7  Открытие и закрытие таблиц в MySQL</A>).

</P>


<H3><A NAME="Table_cache" HREF="manual.ru_toc.html#Table_cache">5.4.7  Открытие и закрытие таблиц в MySQL</A></H3>

<P>
<A NAME="IDX908"></A>

</P>
<P>
<A NAME="IDX909"></A>
<A NAME="IDX910"></A>
<A NAME="IDX911"></A>
<A NAME="IDX912"></A>
<A NAME="IDX913"></A>

</P>
<P>
Параметры <code>table_cache</code>, <code>max_connections</code> и <code>max_tmp_tables</code> задают
максимальное количество файлов, которые сервер держит открытыми. Если
увеличить один или оба этих параметра, то можно столкнуться с
ограничением, накладываемым данной операционной системой на количество
открытых файловых дескрипторов для одного процесса. Во многих системах,
однако, этот предел можно увеличить. Поскольку способы изменения данного
значения для разных систем могут быть совершенно различными, в каждом
конкретном случае вам следует обращаться к документации по своей
операционной системе.

</P>
<P>
Значения  <code>table_cache</code> и <code>max_connections</code> взаимосвязаны. Например, для 200
одновременно работающих соединений необходимо иметь кэш для таблиц
размером по меньшей мере 200 * n, где n - максимальное количество
связанных таблиц. Необходимо также зарезервировать несколько
дополнительных файловых дескрипторов для временных таблиц и файлов.

</P>
<P>
Следует удостовериться, что ваша операционная система способна
обрабатывать такое количество открытых файловых дескрипторов, какое
предполагает данная установка <code>table_cache</code>. Если устанавливается слишком
высокое значение <code>table_cache</code>, то MySQL может выйти за пределы допустимого
количества файловых дескрипторов, прервать соединение, не выполнять
запросы и стать очень ненадежным. Необходимо также принять во внимание,
что для обработчика таблиц <code>MyISAM</code> требуется по два файловых дескриптора
для каждой уникальной открытой таблицы. Допустимое для MySQL количество
файловых дескрипторов можно увеличить с помощью опции запуска
<code>--open-files-limit=#</code> (see section <A HREF="manual.ru.html#Not_enough_file_handles">A.2.16  Не найден файл (<code>File not found</code>)</A>).

</P>
<P>
Максимальное количество таблиц в кэше открытых таблиц будет равно
количеству, указанному в <code>table_cache</code> (по умолчанию - 64; это число можно
изменить с помощью опции <code>-O table_cache=#</code> для <code>mysqld</code>). Следует учитывать,
что для выполнения запросов MySQL может временно открыть и больше таблиц.

</P>
<P>
Неиспользуемая таблица закрывается и удаляется из кэша таблиц в следующих
ситуациях:

</P>

<UL>
<LI>

Когда кэш заполнен и поток старается открыть таблицу, отсутствующую в
этом кэше.

<LI>

Когда кэш содержит более, чем <code>table_cache</code> входных величин, и поток
больше не использует таблицу.

<LI>

Когда кто-либо выполняет <code>mysqladmin refresh</code> или <code>mysqladmin
flush-tables</code>.

<LI>

Когда кто-либо выполняет <code>FLUSH TABLES</code>.
</UL>

<P>
Когда табличный кэш заполняется, сервер использует следующую процедуру
размещения входных данных кэша для их использования:

</P>

<UL>
<LI>

Не используемые в данное время таблицы освобождаются в порядке
наиболее давнего использования.

<LI>

Если кэш заполнен и ни одна таблица не может быть высвобождена, а
необходимо открыть новую таблицу, то кэш временно расширяется
настолько, насколько необходимо.

<LI>

Если кэш находится во временно расширенном состоянии и таблица
переходит из используемого в неиспользуемое состояние, то такая
таблица закрывается и освобождается из кэша.
</UL>

<P>
Таблица открывается для каждого одновременного доступа. Это означает, что,
если существуют два потока, получающие доступ к одной и той же таблице,
или происходит обращение к этой таблице дважды в одном и том же запросе (с
помощью <code>AS</code>), то данная таблица должна быть открыта дважды. Для первого
открытия любой таблицы требуется два файловых дескриптора; для каждого
дополнительного использования - только один. Дополнительный дескриптор для
первого открытия используется для индексного файла; этот дескриптор
используется совместно всеми потоками.

</P>
<P>
При открытии таблицы командой <code>HANDLER table_name OPEN</code> создается выделенный
табличный объект для данного потока. Этот табличный объект недоступен для
других потоков и не будет закрыт, пока данный поток не вызовет команду
<code>HANDLER table_name CLOSE</code> или сам поток не уничтожится (see section <A HREF="manual.ru.html#HANDLER">6.4.2  Синтаксис оператора  <code>HANDLER</code></A>). Если это произойдет, то данная таблица помещается обратно в кэш
таблиц (если он не заполнен).

</P>
<P>
Чтобы узнать, не слишком ли мал кэш таблиц, следует проверить переменную
<code>Opened_tables</code>. Если ее значение достаточно велико, даже если вы не
выполняли слишком часто команду <code>FLUSH TABLES</code>, то необходимо увеличить
данный кэш таблиц (see section <A HREF="manual.ru.html#SHOW_STATUS">4.5.6.3  <code>SHOW STATUS</code></A>).

</P>


<H3><A NAME="Creating_many_tables" HREF="manual.ru_toc.html#Creating_many_tables">5.4.8  Недостатки создания множества таблиц в одной базе данных</A></H3>

<P>
<A NAME="IDX914"></A>

</P>
<P>
Если в каталоге присутствует большое количество файлов, то операции
открытия, закрытия и создания будут медленными. Выполнение значительного
количества команд <code>SELECT</code> на большом количестве разных таблиц приводит к
небольшим непроизводительным затратам при заполненном табличном кэше,
поскольку для открытия одной таблицы требуется закрыть другую. Чтобы
сократить эту перегрузку, следует увеличить табличный кэш.

</P>


<H2><A NAME="Optimising_the_Server" HREF="manual.ru_toc.html#Optimising_the_Server">5.5  Оптимизация сервера MySQL</A></H2>



<H3><A NAME="System" HREF="manual.ru_toc.html#System">5.5.1  Настройка параметров системы, компляции и запуска</A></H3>

<P>
<A NAME="IDX915"></A>
<A NAME="IDX916"></A>
<A NAME="IDX917"></A>

</P>
<P>
Мы начинаем с вопросов системного уровня, поскольку некоторые из них
требуют решения на самых ранних этапах. В других случаях может оказаться
достаточно только беглого просмотра этого материала, поскольку
значительного выигрыша в оптимизации он не обеспечивает. Однако всегда
хорошо иметь представление о том, какую пользу можно получить при
изменении параметров на этом уровне.

</P>
<P>
Используемая по умолчанию операционная система имеет действительно большое
значение! Чтобы получить максимальную выгоду от применения
многопроцессорных компьютеров, следует применять Solaris (так как под этой
ОС потоки работают в самом деле хорошо) или Linux (поскольку ядро 2.2
обеспечивает действительно хорошую поддержку SMP). Однако на 32-разрядных
компьютерах Linux по умолчанию имеет ограничение размера файлов в 2 Гб.
Будем надеяться, что это ограничение в скором времени будет снято при
выпуске новых файловых систем (XFS/Reiserfs). Но если вам действительно не
обойтись без файлов с размерами более чем 2 Гб на 32-разрядном ПК с
Linux-intel, то следует использовать патч LFS для файловой системы ext2.

</P>
<P>
На многих платформах MySQL еще не находился в промышленной эксплуатации,
поэтому мы рекомендуем прежде, чем остановить свой выбор на какой-либо
платформе, сначала ее протестировать.

</P>
<P>
<A NAME="IDX918"></A>
Другие советы:

</P>

<UL>
<LI>

Если оперативной памяти достаточно, то можно было бы удалить все
внешние запоминающие устройства. Существуют операционные системы,
которые при некоторых обстоятельствах будут использовать внешние
запоминающие устройства даже при наличии свободной памяти.

<LI>

Чтобы избежать внешнего блокирования, используйте опцию MySQL
<code>--skip-external-locking</code>. Следует учитывать, что пока работает только один
сервер, это не будет оказывать большого влияния на функциональные
возможности MySQL. Только не забудьте остановить сервер (или
блокировать соответствующие части) перед запуском <code>myisamchk</code>. В
некоторых системах такое переключение обязательно, поскольку внешнее
блокирование не работает в любом случае. 

Опция <code>--skip-external-locking</code> включена
по умолчанию при компилировании с потоками <code>MIT-pthreads</code>, поскольку
функция <code>flock()</code> не полностью поддерживается потоками <code>MIT-pthreads</code> на
всех платформах. Для Linux также подразумевается, что блокирование
файлов пока еще ненадежно. 

Нельзя использовать <code>--skip-external-locking</code> только в
одном случае - при запуске нескольких <em>серверов</em> (не клиентов) MySQL на
одних и тех же данных, или при запуске <code>myisamchk</code> на таблице без
предварительного сбрасывания на диск и блокирования демона <code>mysqld</code> для
сервера, содержащего эти таблицы. Можно также применять команду <code>LOCK
TABLES/UNLOCK TABLES</code> даже при использовании <code>--skip-external-locking</code>.
</UL>



<H3><A NAME="Server_parameters" HREF="manual.ru_toc.html#Server_parameters">5.5.2  Настройка параметров сервера</A></H3>

<P>
<A NAME="IDX919"></A>
<A NAME="IDX920"></A>
<A NAME="IDX921"></A>
<A NAME="IDX922"></A>

</P>
<P>
Размеры буферов, используемые по умолчанию сервером <code>mysqld</code>, можно узнать с
помощью следующей команды:

</P>

<PRE>
shell&#62; mysqld --help
</PRE>

<P>
<A NAME="IDX923"></A>
<A NAME="IDX924"></A>
Эта команда выдает список всех опций <code>mysqld</code> и конфигурируемых переменных.
Вывод включает в себя величины по умолчанию и выглядит примерно следующим
образом:

</P>

<PRE>
Possible variables for option --set-variable (-O) are:
back_log                 current value: 5
bdb_cache_size           current value: 1048540
binlog_cache_size        current value: 32768
connect_timeout          current value: 5
delayed_insert_timeout   current value: 300
delayed_insert_limit     current value: 100
delayed_queue_size       current value: 1000
flush_time               current value: 0
interactive_timeout      current value: 28800
join_buffer_size         current value: 131072
key_buffer_size          current value: 1048540
lower_case_table_names   current value: 0
long_query_time          current value: 10
max_allowed_packet       current value: 1048576
max_binlog_cache_size    current value: 4294967295
max_connections          current value: 100
max_connect_errors       current value: 10
max_delayed_threads      current value: 20
max_heap_table_size      current value: 16777216
max_join_size            current value: 4294967295
max_sort_length          current value: 1024
max_tmp_tables           current value: 32
max_write_lock_count     current value: 4294967295
myisam_sort_buffer_size  current value: 8388608
net_buffer_length        current value: 16384
net_retry_count          current value: 10
net_read_timeout         current value: 30
net_write_timeout        current value: 60
read_buffer_size         current value: 131072
record_rnd_buffer_size   current value: 131072
slow_launch_time         current value: 2
sort_buffer              current value: 2097116
table_cache              current value: 64
thread_concurrency       current value: 10
tmp_table_size           current value: 1048576
thread_stack             current value: 131072
wait_timeout             current value: 28800
</PRE>

<P>
Не забывайте, что <code>--set-variable</code> не используется в MySQL 4.0. Просто
указывайте <code>--var=option</code>.

</P>
<P>
Если сервер <code>mysqld</code> в настоящее время работает, то для того, чтобы увидеть,
какие величины реально используются для переменных, необходимо выполнить
следующую команду:

</P>

<PRE>
shell&#62; mysqladmin variables
</PRE>

<P>
Полное описание всех переменных можно найти в разделе <code>SHOW VARIABLES</code> этого
руководства (see section <A HREF="manual.ru.html#SHOW_VARIABLES">4.5.6.4  <code>SHOW VARIABLES</code></A>).

</P>
<P>
Некоторые статистические данные по работающему серверу можно также
просмотреть с помощью команды <code>SHOW STATUS</code> (see section <A HREF="manual.ru.html#SHOW_STATUS">4.5.6.3  <code>SHOW STATUS</code></A>).

</P>
<P>
В MySQL используются алгоритмы, масштабируемые в широких пределах, так что
обычно можно работать с очень небольшой памятью. Однако если выделить для
MySQL больше памяти, то и производительность, как правило, будет выше.

</P>
<P>
При настройке сервера MySQL наиболее важными из используемых являются две
переменные <code>key_buffer_size</code> и <code>table_cache</code>. Но прежде чем пытаться изменить
ту или иную переменную, вначале следует убедиться, что вы обладаете
необходимыми для этого правами.

</P>
<P>
Если имеется большая память (&#62;=256 Mб) и много таблиц, то для обеспечения
максимальной производительности путем регулирования количества клиентов
следует использовать что-нибудь вроде этого:

</P>

<PRE>
shell&#62; safe_mysqld -O key_buffer=64M -O table_cache=256 \
                   -O sort_buffer=4M -O read_buffer_size=1M &#38;
</PRE>

<P>
Если память составляет только 128 Mб и количество таблиц невелико, но тем
не менее, выполняется много сортировок, то можно использовать что-нибудь
вроде:

</P>

<PRE>
shell&#62; safe_mysqld -O key_buffer=16M -O sort_buffer=1M
</PRE>

<P>
При малой памяти и большом количестве соединений следует использовать
что-нибудь вроде следующего:

</P>

<PRE>
shell&#62; safe_mysqld -O key_buffer=512k -O sort_buffer=100k \
                   -O read_buffer_size=100k &#38;
</PRE>

<P>
или даже:

</P>

<PRE>
shell&#62; safe_mysqld -O key_buffer=512k -O sort_buffer=16k \
                   -O table_cache=32 -O read_buffer_size=8k \
                   -O net_buffer_length=1K &#38;
</PRE>

<P>
Если выполняются операции <code>GROUP BY</code> или <code>ORDER BY</code> на файлах, которые намного
больше, чем доступная память, то следует увеличить величину
<code>record_rnd_buffer</code> для ускорения чтения строк после выполнения сортировки.

</P>
<P>
После установки MySQL каталог <tt>`support-files'</tt> будет содержать несколько
различных файлов-примеров <tt>`my.cnf'</tt>, а именно: <tt>`my-huge.cnf'</tt>, <tt>`my-large.cnf'</tt>,
<tt>`my-medium.cnf'</tt> и <tt>`my-small.cnf'</tt>, которые можно использовать как основу для
оптимизации вашей системы.

</P>
<P>
Если демон <code>mysqld</code> не отконфигурирован для использования очень малой памяти
для каждого соединения, то в условиях очень большого количества соединений
могут возникнуть проблемы с подкачкой виртуальной памяти. При наличии
достаточной памяти для всех соединений <code>mysqld</code>, конечно, будет
функционировать лучше.

</P>
<P>
Следует учитывать, что при изменении какой-либо опции для <code>mysqld</code> это
изменение действительно только для данного экземпляра сервера.

</P>
<P>
Чтобы увидеть воздействие изменения параметра, нужно выполнить что-нибудь
вроде этого:

</P>

<PRE>
shell&#62; mysqld -O key_buffer=32m --help
</PRE>

<P>
Следует удостовериться, что опция <code>--help</code> расположена последней; в
противном случае влияние любой опции, следующей после нее в командной
строке, в данном выводе отражено не будет.

</P>


<H3><A NAME="Compile_and_link_options" HREF="manual.ru_toc.html#Compile_and_link_options">5.5.3  Как компиляция и линкование влияет на скорость MySQL</A></H3>

<P>
<A NAME="IDX925"></A>
<A NAME="IDX926"></A>
<A NAME="IDX927"></A>
<A NAME="IDX928"></A>

</P>
<P>
Большинство из последующих тестов выполняются под Linux с использованием
тестов производительности MySQL, но они должны дать некоторое
представление и для других операционных систем и рабочих нагрузок.

</P>
<P>
Самый быстрый исполняемый код получается при линковании с помощью <code>-static</code>.

</P>
<P>
Под Linux наиболее быстрый код можно получить при компилировании 
<code>pgcc</code> с опицей <code>-O3</code>. Чтобы скомпилировать <code>sql_yacc.cc</code> с этой опцией, требуется
около 200 Mб памяти, поскольку компилятор <code>gcc/pgcc</code> забирает много памяти.
При конфигурировании MySQL следует также
установить <code>CXX=gcc</code> - чтобы не линковалась библиотека <code>libstdc++</code> (в этом
нет необходимости). Следует учитывать, что при некоторых версиях
компилятора <code>pgcc</code> результирующий код будет работать только на настоящих
процессорах Pentium, даже если использовать возможность компилятора
выдавать результирующий код, работоспособный на всех процессорах типа x586
(например AMD).

</P>
<P>
Используя просто лучший компилятор и/или лучшую опцию компилятора, можно
получить для приложения увеличение скорости на 10-30%. Это особенно важно,
если вы компилируете сервер SQL самостоятельно!

</P>
<P>
Мы протестировали такие компиляторы как Cygnus CodeFusion и Fujitsu, но ни
тот, ни другой не были достаточно свободны от ошибок, чтобы можно было
скомпилировать MySQL с оптимизирующими параметрами.

</P>
<P>
При компилировании MySQL необходимо включать только наборы кодировок,
которые вы собираетесь использовать (опция <code>--with-charset=xxx</code>).
Стандартная поставка MySQL скомпилирована с поддержкой всех кодировок.

</P>
<P>
Ниже приводится обзор некоторых действий, которые мы предпринимали для
ускорения работы:

</P>

<UL>
<LI>

При использовании <code>pgcc</code> и компиляции всего кода с <code>-O6</code> сервер <code>mysqld</code> на
1% быстрее, чем при <code>gcc 2.95.2</code>.

<LI>

При динамическом связывании (без опции <code>-static</code>) результирующий
исполняемый файл сервера будет на 13% медленнее работать под
управлением Linux. Обратите  внимание: вы спокойно можете использовать
динамическую библиотеку MySQL. Это касается только сервера и актуально
только там, где нужна высокая производительность.

<LI>

При сокращении двоичного кода <code>mysqld</code> с помощью <code>strip libexec/mysqld</code> 
можно получить прирост скорости результирующего двоичного кода до 4%.

<LI>

При соединении с использованием протокола TCP/IP, а не сокетов Unix
работа будет на 7,5% медленнее на том же самом
компьютере (при подключении к <code>localhost</code> MySQL по умолчанию будет
использовать сокеты).

<LI>

При соединении с использованием протокола TCP/IP с другим компьютером
по сети Ethernet с пропускной способностью 100Mбит/сек скорость будет
на 8-11% ниже.

<LI>

При запуске наших тестов производительности с использованием
безопасных соединений (все данные зашифрованы с поддержкой 
протокола SSL) скорость была на 55% ниже.

<LI>

Если код компилируется с параметром <code>--with-debug=full</code>, то для
большинства запросов потери в производительности будут составлять до
20%, но некоторые запросы могут выполняться значительно дольше (тесты
производительности MySQL работают на 35% медленнее). При использовании
опции <code>--with-debug</code> теряется только 15% производительности. При запуске
mysqld, откомпилированного с <code>--with-debug=full</code> и <code>--skip-safemalloc</code>,
результат должен почти таким же, как и при компиляции с <code>--with-debug</code>.

<LI>

На компьютере Sun UltraSPARC-IIe, Forte 5.0 дает на 4% более быстрый код чем <code>gcc 3.2</code>

<LI>

На компьютере Sun UltraSPARC-IIe, Forte 5.0 дает на  4% более быстрый код в 32-разрядном режиме чем в 64-разрядном. 

<LI>

Компилирование посредством <code>gcc 2.95.2</code> для UltraSPARC с опцией <code>-mcpu=v8
-Wa,-xarch=v8plusa</code> дает прирост производительности на 4%.

<LI>

Под операционной системой Solaris 2.5.1 потоки MIT-pthreads на 8-12%
медленнее, чем собственные потоки Solaris для единичного процессора.
При возрастании нагрузки на процессоры разница должна получиться
больше.

<LI>

Запуск с <code>--log-bin</code> делает <code>mysqld</code>  на 1% медленнее.

<LI>

Компилирование под Linux-x86 с использованием <code>gcc</code> без указателей
фреймов <code>-fomit-frame-pointer</code> или <code>-fomit-frame-pointer -ffixed-ebp</code>
делает mysqld на 1-4% быстрее.
</UL>

<P>
Поставка MySQL под Linux, которую предоставляет  MySQL AB, обычно
компилировалась с <code>pgcc</code>, но мы должны были вернуться к обычному компилятору
<code>gcc</code> из-за ошибок в <code>pgcc</code>, которая могут генерировать код, не исполняемый на
AMD. Пока эти ошибки не будут устранены, мы будем продолжать использовать
<code>gcc</code>, однако если ваш компьютер не относится к типу AMD, то можно получить
более быстрый двоичный код, компилируя его с <code>pgcc</code>. Стандартный двоичный
код MySQL для Linux слинкован статически, чтобы сделать его более быстрым
и более переносимым.

</P>


<H3><A NAME="Memory_use" HREF="manual.ru_toc.html#Memory_use">5.5.4  Как MySQL использует память</A></H3>

<P>
<A NAME="IDX929"></A>

</P>
<P>
В следующем перечне дано описание некоторых  аспектов использования памяти
сервером <code>mysqld</code>. Там, где это возможно, приводятся имена серверных
переменных, относящихся к использованию памяти:

</P>

<UL>
<LI>

Буфер ключей (переменная <code>key_buffer_size</code>) используется совместно всеми
потоками; другие буферы, используемые данным сервером, выделяются при
необходимости (see section <A HREF="manual.ru.html#Server_parameters">5.5.2  Настройка параметров сервера</A>).

<LI>

Каждое соединение использует определенное пространство в памяти для
конкретного потока: стек (по умолчанию 64Kб, переменная <code>thread_stack</code>),
буфер соединения (переменная <code>net_buffer_length</code>) и буфер результата
(переменная <code>net_buffer_length</code>). Буфер соединения и буфер результата
при необходимости динамически расширяются вплоть до
<code>max_allowed_packet</code>. При выполнении запроса также выделяется память для
копии строки данного текущего запроса.

<LI>

Все потоки совместно используют одну и туже базовую память.

Только сжатые таблицы типа <code>ISAM/MyISAM</code> имеют распределенную память.
Это объясняется тем, что 4 Гб памяти (адресуемой в рамках 32-битной
разрядности) мало для достаточно больших таблиц. Когда системы с
64-разрядными адресным пространством получат более широкое
распространение, мы сможем добавить в сервер общую поддержку для
распределения памяти.

<LI>

Каждый запрос, выполняющий последовательный просмотр таблицы,
размещается в буфере чтения (переменная <code>record_buffer</code>).

<LI>

При чтении строк в "случайном" порядке (например, после сортировки)
выделяется буфер "случайного чтения", чтобы избежать поиска по диску
(переменная <code>record_rnd_buffer</code>).

<LI>

Все объединения выполняются за одну операцию, и большинство
объединений может производиться даже без временных таблиц. Большинство
временных таблиц располагаются в оперативной памяти (в динамически
выделяемой области <code>HEAP</code>). Временные таблицы с записями большой длины
(вычисляемой как сумма длин всех столбцов) или таблицы, содержащие
столбцы <code>BLOB</code>, хранятся на диске. В версиях MySQL до 3.23.2 существует
проблема, заключающаяся в том, что если таблицы <code>HEAP</code> в динамически
выделяемой области превышают размер <code>tmp_table_size</code>, то возникает
ошибка <code>The table tbl_name is full</code>. В более новых версиях эта проблема
при необходимости решается путем автоматического преобразования
хранящихся в оперативной памяти <code>HEAP</code>-таблиц в таблицы <code>MyISAM</code>,
расположенные на диске. Чтобы обойти эту проблему, можно увеличить
размер временных таблиц установкой опции <code>tmp_table_size</code> в <code>mysqld</code> или
установкой SQL-опции <code>SQL_BIG_TABLES</code> в клиентской программе (see section <A HREF="manual.ru.html#SET_OPTION">5.5.6  Синтаксис команды <code>SET</code></A>). 
В версии MySQL 3.20 максимальный размер временной таблицы
был равен <code>record_buffer*16</code>, так что при использовании данной версии
необходимо увеличить значение <code>record_buffer</code>. Можно также запустить
<code>mysqld</code> с опцией <code>--big-tables</code> - для того, чтобы всегда хранить
временные таблицы на диске. Однако это будет влиять на скорость многих
сложных запросов.

<LI>

Большинство запросов, выполняющих сортировку, размещаются в буфере
сортировки и в 0-2 временных файлах, в зависимости от размера
результирующего набора данных (see section <A HREF="manual.ru.html#Temporary_files">A.4.4  Где MySQL хранит временные файлы</A>).

<LI>

Почти все операции, связанные с анализом и вычислениями, выполняются в
пространстве локальной памяти. Для небольших задач не требуется
никаких дополнительных затрат памяти и удается избежать обычно
медленных процессов выделения и освобождения памяти. Память выделяется
только для непредвиденно больших строк (это делается с помощью функций
<code>malloc()</code> и <code>free()</code>).

<LI>

Каждый файл индексов и файл данных открываются сразу для каждого
параллельно работающего потока. Для каждого параллельного потока
выделяется место в памяти для структуры таблицы, структур столбцов для
каждого столбца и буфер размером 3 * n (где n представляет
максимальную длину строки без учета столбцов <code>BLOB</code>). Для столбца <code>BLOB</code>
используется от 5 до 8 байтов плюс длина данных <code>BLOB</code>. Обработчики
таблиц <code>ISAM/MyISAM</code> будут использовать один дополнительный буфер строки
для внутреннего представления.

<LI>

Для каждой таблицы, имеющей столбцы <code>BLOB</code>, буфер динамически
увеличивается при чтении больших величин <code>BLOB</code>. При просмотре таблицы
выделяется буфер с размером, равным наибольшей величине <code>BLOB</code>.

<LI>

Обработчики всех находящихся в употреблении таблиц хранятся в кэше и
обрабатываются в порядке их поступления (режим FIFO). Обычно этот кэш
содержит 64 элемента. Если данная таблица была использована двумя
работающими потоками в одно и то же время, то кэш содержит два
элемента для такой таблицы (see section <A HREF="manual.ru.html#Table_cache">5.4.7  Открытие и закрытие таблиц в MySQL</A>).

<LI>

Команда <code>mysqladmin flush-tables</code> закрывает все неиспользуемые таблицы и
отмечает все используемые таблицы, которые необходимо закрыть после
окончания выполнения текущего потока. Такой алгоритм позволяет
эффективно освобождать большое количество используемой памяти.

</UL>

<P>
Программа <code>ps</code> и другие программы контроля состояния системы могут сообщать,
что <code>mysqld</code> использует слишком много памяти. Это может быть вызвано
расположением стеков памяти потоков по различным адресам в памяти.
Например, версия программы ps для Solaris интерпретирует неиспользуемую
память между стеками как используемую. Это можно проверить путем
выполнения допустимой перестановки с помощью <code>swap -s</code>. Мы тестировали
<code>mysqld</code> при помощи коммерческих детекторов утечки памяти, так что никаких
потерь памяти быть не должно.

</P>


<H3><A NAME="DNS" HREF="manual.ru_toc.html#DNS">5.5.5  Как MySQL использует DNS</A></H3>

<P>
<A NAME="IDX930"></A>
<A NAME="IDX931"></A>

</P>
<P>
Когда к <code>mysqld</code> подключается новый клиент, <code>mysqld</code> выделяет новый поток
для обработки данного запроса. Этот поток вначале проверяет, имеется ли в
кэше имен хостов имя требуемого хоста. Если нет, то поток вызовет функции
<code>gethostbyaddr_r()</code> и <code>gethostbyname_r()</code>, чтобы определить имя хоста.

</P>
<P>
Если операционная система не обеспечивает вышеописанные вызовы с
поддержкой потоков, то данный поток заблокирует флаг и вызовет вместо
этого функции  <code>gethostbyaddr()</code> и <code>gethostbyname()</code>. Следует учитывать, что в
таком случае никакой другой поток не сможет определять имена других
хостов, отсутствующих в кэше имен хостов, пока первый поток не будет
готов.

</P>
<P>
Можно заблокировать поиск DNS хоста, запустив <code>mysqld</code> с параметром
<code>--skip-name-resolve</code>. В этом случае, однако, в таблицах привилегий MySQL
можно использовать только IP-адреса.

</P>
<P>
Если процесс установления DNS очень медленный и хостов очень много, то
можно получить более высокую производительность либо путем блокировки
поиска DNS при помощи <code>--skip-name-resolve</code>, либо увеличив размер
определения <code>HOST_CACHE_SIZE</code> (по умолчанию: 128) и перекомпилировав <code>mysqld</code>.

</P>
<P>
Заблокировать кэш имен хостов можно с помощью <code>--skip-host-cache</code>. Можно
также очистить этот кэш с помощью команды <code>FLUSH HOSTS</code> или <code>mysqladmin
flush-hosts</code>.

</P>
<P>
Можно запретить соединения по протоколу TCP/IP, запустив <code>mysqld</code> с опцией
<code>--skip-networking</code>.

</P>


<H3><A NAME="SET_OPTION" HREF="manual.ru_toc.html#SET_OPTION">5.5.6  Синтаксис команды <code>SET</code></A></H3>

<P>
<A NAME="IDX932"></A>

</P>

<PRE>
SET [GLOBAL | SESSION] sql_variable=expression, [[GLOBAL | SESSION] sql_variable=expression...]
</PRE>

<P>
Команда <code>SET</code> устанавливает различные опции, влияющие на работу
сервера или клиента. 

</P>
<P>
Следующие примеры иллюстрируют различный синтаксис, который можно использовать для установки
переменных. 

</P>
<P>
В старых версиях MySQL мы допускали использование <code>SET OPTION</code>, но этот синтакс теперь
считается морально устаревшим. 

</P>
<P>
В MySQL 4.0.3 мы также добавили режимы <code>GLOBAL</code> и <code>SESSION</code> и реализовали доступ к 
наиболее важным переменным запуска. 

</P>
<P>
<code>LOCAL</code> может использоваться как синоним для <code>SESSION</code>.

</P>
<P>
Если вы устанавливаете несколько переменных в одной команде, то последний указанный режим
<code>GLOBAL | SESSION</code> будет использован. 

</P>

<PRE>
SET sort_buffer_size=10000;
SET @@local.sort_buffer_size=10000;
SET GLOBAL sort_buffer_size=1000000, SESSION sort_buffer_size=1000000;
SET @@sort_buffer_size=1000000;
SET @@global.sort_buffer_size=1000000, @@local.sort_buffer_size=1000000;
</PRE>

<P>
Синтаксис <code>@@variable_name</code> поддерживается с тем, чтобы сделать MySQL более
совместимым с другими СУБД. 

</P>
<P>
Различные системные переменные, которые вы можете установить, описаниы в этом руководстве. 
See section <A HREF="manual.ru.html#System_Variables">6.1.5  Системные переменные</A>.

</P>
<P>
Если вы используете режим <code>SESSION</code> (по умолчанию), то значения
переменных, которые вы устанавливаете, остаются в в действии до тех пор, пока
текущая сессия не будет завершена, или до тех пор, пока вы не установите
переменные в другое значение. Если вы используете <code>GLOBAL</code>, который
требует привилегии <code>SUPER</code>, это значение запоминается и используется для
всех новых соединений до тех пор, пока сервер не будет перезагружен. Если вы
хотите сделать какое-либо значение перманентным, то вам следует указать его в
одном из файлов конфигураций MySQL.  See section <A HREF="manual.ru.html#Option_files">4.1.2  Файлы параметров <tt>`my.cnf'</tt></A>.

</P>
<P>
Чтобы избежать неправильного использования, MySQL будет сообщать об ошибке, если 
вы будете выполнять <code>SET GLOBAL</code> на переменной, которую только можно изменять в 
<code>SET SESSION</code> или если вы не выбираете режим <code>GLOBAL</code> для глобальной переменной. 

</P>
<P>
Если вы хотите установить сессионную (<code>SESSION</code>) переменную в значение
глобальной (<code>GLOBAL</code>) или просто в значение по умолчанию - вы можете
установить это значение в <code>DEFAULT</code>. 

</P>

<PRE>
SET max_join_size=DEFAULT;
</PRE>

<P>
Это аналогично: 

</P>

<PRE>
SET @@session.max_join_size=@@global.max_join_size;
</PRE>

<P>
Если вам необходимо ограничить максимальное значение, которое может принимать стартовая
переменная с помощью <code>SET</code>, вы можете указать это с помощью использования опции командной строки
<code>--maximum-variable-name</code>. See section <A HREF="manual.ru.html#Command-line_options">4.1.1  Параметры командной строки <code>mysqld</code></A>.

</P>
<P>
Список большинства переменных можно получить с помощью <code>SHOW VARIABLES</code>.
See section <A HREF="manual.ru.html#SHOW_VARIABLES">4.5.6.4  <code>SHOW VARIABLES</code></A>. Вы можете получить конкретное значение с помощью синтаксиса
<code>@@[global.|local.]variable_name</code>:

</P>

<PRE>
SHOW VARIABLES like "max_join_size";
SHOW GLOBAL VARIABLES like "max_join_size";
SELECT @@max_join_size, @@global.max_join_size;
</PRE>

<P>
Далее следует описание переменных, использующих нестандартный синтаксис
<code>SET</code> и некоторых других. 
Описание других переменных можно найти в секции, описывающих системные переменные, 
вместе с описанием стартовых опций или в описании команды <code>SHOW VARIABLES</code>.
See section <A HREF="manual.ru.html#System_Variables">6.1.5  Системные переменные</A>. See section <A HREF="manual.ru.html#Command-line_options">4.1.1  Параметры командной строки <code>mysqld</code></A>.  See section <A HREF="manual.ru.html#SHOW_VARIABLES">4.5.6.4  <code>SHOW VARIABLES</code></A>.

</P>

<DL COMPACT>

<DT><code>CHARACTER SET character_set_name | DEFAULT</code>
<DD>
Преобразует все строки, передающиеся от клиента, и строки передающиеся
клиенту, в соответствии с заданным набором символов. В настоящее время
единственной опцией для <code>character_set_name</code> является <code>cp1251_koi8</code>, но можно
легко добавить новые наборы символов, отредактировав файл <code>sql/convert.cc</code> в
дистрибутиве исходного кода MySQL. Чтобы восстановить установку по
умолчанию, следует установить значение <code>character_set_name</code> в <code>DEFAULT</code>.

Следует учитывать, что синтаксис установки опции <code>CHARACTER SET</code> отличается
от синтаксиса установки других опций.

<DT><code>PASSWORD = PASSWORD('некий пароль')</code>
<DD>
<A NAME="IDX933"></A>
Устанавливает пароль для текущего пользователя. Любой не анонимный
пользователь может изменить свой собственный пароль!

<DT><code>PASSWORD FOR user = PASSWORD('некий пароль')</code>
<DD>
Устанавливает пароль для особого пользователя для текущего серверного
хоста. Это может сделать только пользователь, имеющий доступ к базе данных
<code>mysql</code>. Данный пользователь должен быть представлен в формате
<code>user@hostname</code>, где <code>user</code> и <code>hostname</code> в точности соответствуют записям этих
позиций в столбцах <code>User</code> и <code>Host</code> в таблице <code>mysql.user</code>. Например, если записи
в полях <code>User</code> и <code>Host</code> соответственно были <code>bob</code> и <code>%.loc.gov</code>, то необходимо
писать:


<PRE>
mysql&#62; SET PASSWORD FOR bob@"%.loc.gov" = PASSWORD("newpass");
</PRE>

или


<PRE>
mysql&#62; UPDATE mysql.user SET password=PASSWORD("newpass")
    -&#62;                   WHERE user="bob" AND host="%.loc.gov";
</PRE>

<DT><code>SQL_AUTO_IS_NULL = 0 | 1</code>
<DD>
Если установить в <code>1</code> (значение по умолчанию), то можно найти последнюю
внесенную строку для таблицы со столбцом <code>AUTO_INCREMENT</code> с помощью
следующей конструкции: <code>WHERE auto_increment_column IS NULL</code>. Эта
возможность используется некоторыми ODBC-программами, такими как Access.

<DT><code>AUTOCOMMIT = 0 | 1</code>
<DD>
Если установить в <code>1</code>, то все изменения в таблицу будут вноситься
немедленно. Чтобы открыть многокомандную транзакцию, необходимо
использовать команду <code>BEGIN</code> (see section <A HREF="manual.ru.html#COMMIT">6.7.1  Синтаксис команд <code>BEGIN/COMMIT/ROLLBACK</code></A>). Если
установить данную опцию в <code>0</code>, то необходимо использовать <code>COMMIT / ROLLBACK</code>
для того, чтобы принять/отменить эту транзакцию (see section <A HREF="manual.ru.html#COMMIT">6.7.1  Синтаксис команд <code>BEGIN/COMMIT/ROLLBACK</code></A>). 
Следует учитывать, что при переходе из
режима работы без <code>AUTOCOMMIT</code> в режим <code>AUTOCOMMIT</code> MySQL автоматически
выполнит <code>COMMIT</code> для любой открытой транзакции.

<DT><code>BIG_TABLES = 0 | 1</code>
<DD>
Если установить в 1, то предпочтительным местом хранения всех временных
таблиц будет диск, а не оперативная память. Это вызовет некоторое
замедление работы, зато для больших операций <code>SELECT</code>, требующих обширных
временных таблиц, не будет выдаваться ошибка <code>The table tbl_name is full</code>.
Для нового соединения значение этой величины по умолчанию равно 0 (т.е.
использовать для временных таблиц оперативную память). Эта переменная раньше называлась
<code>SQL_BIG_TABLES</code>.

<DT><code>SQL_BIG_SELECTS = 0 | 1</code>
<DD>
При установке в 0 MySQL будет прерывать выполнение запроса, если
поступившая команда <code>SELECT</code> может потребовать  слишком много времени для
выполнения. Такая возможность полезна при нерационально написанном
выражении <code>WHERE</code>. Запрос классифицируется как слишком большой, если оператору
<code>SELECT</code>, видимо, пришлось бы обрабатывать больше строк, чем задано в
<code>max_join_size</code>. Для нового соединения значение по умолчанию равно 1 (т.е.
разрешаются любые команды <code>SELECT</code>).

<DT><code>SQL_BUFFER_RESULT = 0 | 1</code>
<DD>
<code>SQL_BUFFER_RESULT</code> будет заносить результат выполнения команд <code>SELECT</code> во
временную таблицу. Это поможет MySQL раньше освободить блокировки таблиц и
окажется полезным в случаях, когда требуется значительное время для
пересылки результирующего набора данных клиенту.

<DT><code>LOW_PRIORITY_UPDATES = 0 | 1</code>
<DD>
При установке в 1 все команды <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code> и
<code>LOCK TABLE WRITE</code> будут ожидать, пока не будет ни одной ожидающей решения
команды <code>SELECT</code> или <code>LOCK TABLE READ</code> на обрабатываемой таблице.
Эта переменная раньше называлась <code>SQL_LOW_PRIORITY_UPDATES</code>.

<DT><code>MAX_JOIN_SIZE = значение | DEFAULT</code>
<DD>
Запрещает команды <code>SELECT</code>, которым, возможно, придется обрабатывать более,
чем указанное значение комбинаций строк. Установив эту величину, можно определить
команды <code>SELECT</code>, в которых ключи используются неправильно и которые,
возможно, потребуют длительного времени для исполнения. При установке этой
опции в величину, отличную от <code>DEFAULT</code>, сбрасывается флаг <code>SQL_BIG_SELECTS</code>.
Если вновь установить флаг <code>SQL_BIG_SELECTS</code>, то переменная
<code>SQL_MAX_JOIN_SIZE</code> будет игнорироваться. Значение по умолчанию для этой
переменной можно установить, запустив <code>mysqld</code> с <code>-O max_join_size=#</code>. 
Эта переменная раньше называлась <code>SQL_MAX_JOIN_SIZE</code>.

Следует
учитывать, что если результат запроса всегда находится в кэше запросов, то
упомянутая выше проверка выполняться не будет. Вместо этого MySQL будет
отсылать результат клиенту, поскольку результат запроса уже вычислен и
отсылка его клиенту не создаст нагрузки для сервера.

<DT><code>QUERY_CACHE_TYPE = OFF | ON | DEMAND</code>
<DD>
<DT><code>QUERY_CACHE_TYPE = 0 | 1 | 2</code>
<DD>
Определяет установку кэша запросов для данного потока.

<TABLE BORDER>
<TR><TD><strong>Опция</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD>0 or OFF </TD><TD> Не кэшировать или не извлекать результаты
</TD></TR>
<TR><TD>1 or ON </TD><TD> Кэшировать все результаты за исключением запросов <code>SELECT SQL_NO_CACHE ...</code>
</TD></TR>
<TR><TD>2 or DEMAND </TD><TD> Кэшировать только запросы <code>SELECT SQL_CACHE ...</code>
</TD></TR>
</TABLE>

<DT><code>SQL_SAFE_UPDATES = 0 | 1</code>
<DD>
Если установить в 1, то MySQL будет прерывать выполнение поступивших
команд <code>UPDATE</code> или <code>DELETE</code>, в которых не используется ключ или <code>LIMIT</code> в
выражении <code>WHERE</code>. Это позволяет обнаружить ошибочные обновления при ручном
создании команд SQL.

<DT><code>SQL_SELECT_LIMIT = value | DEFAULT</code>
<DD>
Максимальное количество записей, возвращаемых командой <code>SELECT</code>. Если <code>SELECT</code>
содержит выражение <code>LIMIT</code>, то <code>LIMIT</code> превосходит по старшинству величину в
<code>SQL_SELECT_LIMIT</code>. Для нового соединения значение по умолчанию равно
"<code>unlimited</code>". Если предел был изменен, то его можно вернуть в значение по
умолчанию указанием величины <code>DEFAULT</code> в выражении <code>SQL_SELECT_LIMIT</code>.

<DT><code>SQL_LOG_OFF = 0 | 1</code>
<DD>
При установке в 1 для данного клиента в стандартный журнал не будут
заноситься никакие записи, если клиент имеет привилегии <code>SUPER</code>. Это не
относится к журналу обновлений!

<DT><code>SQL_LOG_UPDATE = 0 | 1</code>
<DD>
При установке в 0 для данного клиента в журнал обновлений не будут
заноситься никакие записи, если клиент имеет привилегии <code>SUPER</code>. Это не
относится к стандартному журналу!

<DT><code>SQL_QUOTE_SHOW_CREATE = 0 | 1</code>
<DD>
При установке этой опции в 1  <code>SHOW CREATE TABLE</code> будет заключать в кавычки
имена таблиц и столбцов. Имеет значение <strong>Включено</strong> по умолчанию, чтобы
работала репликация таблиц с изощренными именами столбцов (see section <A HREF="manual.ru.html#SHOW_CREATE_TABLE">4.5.6.8  <code>SHOW CREATE TABLE</code></A>).

<DT><code>TIMESTAMP = timestamp_value | DEFAULT</code>
<DD>
Устанавливает время для данного клиента. Применяется для получения
первоначальной временной метки при использовании журнала обновлений для
восстановления строк. Переменная <code>timestamp_value</code> должна представлять
системное время Unix, а не временную метку MySQL.

<DT><code>LAST_INSERT_ID = #</code>
<DD>
Устанавливает величину, возвращаемую функцией <code>LAST_INSERT_ID()</code>. Хранится в
журнале обновлений при использовании функции <code>LAST_INSERT_ID()</code> в команде,
обновляющей таблицу.

<DT><code>INSERT_ID = #</code>
<DD>
Устанавливает величину, которую следует использовать в следующей команде
<code>INSERT</code> или <code>ALTER TABLE</code> при внесении величины <code>AUTO_INCREMENT</code>. В основном
используется с журналом обновлений.

</DL>



<H2><A NAME="Disk_issues" HREF="manual.ru_toc.html#Disk_issues">5.6  Вопросы, относящиеся к диску</A></H2>

<P>
<A NAME="IDX934"></A>
<A NAME="IDX935"></A>

</P>

<UL>
<LI>

Как уже упоминалось ранее, наиболее узким местом для
производительности  является  поиск на диске. Эта проблема становится
все более и более очевидной по мере того,  как объем данных
увеличивается  настолько, что эффективное кэширование становится
невозможным. Для крупных баз данных, где доступ к данным
осуществляется более или менее случайным образом, можно с уверенностью
сказать, что потребуется по меньшей мере один поиск по диску для
чтения и пара поисков по диску  для записи некоторой информации. Чтобы
свести эту проблему к минимуму, следует использовать диски с малыми
временами поиска.

<LI>

Можно увеличить количество доступных дисковых "блоков" (и, таким
образом, уменьшить  нагрузку на диски). Это делается  либо путем
установления символических ссылок на разные диски, либо использованием
RAID (stripe).

<DL COMPACT>

<DT><strong>Использование символических ссылок</strong>
<DD>
Это означает, что создаются символические ссылки индекса и/или
файла/файлов данных из обычного каталога данных на иной диск (для
которого, помимо этого, можно использовать RAID (stripe)). Применение
символических ссылок улучшает как время  поиска, так и время чтения (если
эти диски не используются для других операций). See section <A HREF="manual.ru.html#Symbolic_links">5.6.1  Использование символических ссылок</A>.

<A NAME="IDX936"></A>
<DT><strong>Использование RAID (stripe)</strong>
<DD>
Использование RAID (stripe) подразумевает, что при наличии нескольких
дисков первый блок данных помещается на первом диске, второй блок - на
втором диске, N-ный блок на диске с номером, равным остатку от
целочисленного деления количества блоков N на число дисков, и т.д. При
этом подразумевается, что если нормальный размер данных меньше, чем размер
RAID-блока (или в точности равен ему), то производительность будет намного
лучше. Следует учитывать, что процесс разделения дисков на RAID-блоки в
значительной степени зависит от операционной системы и размера RAID-блока.
Поэтому тесты производительности конкретного приложения необходимо
производить для разных размеров RAID-блока  (see section <A HREF="manual.ru.html#Custom_Benchmarks">5.1.5  Использование собственных тестов</A>). 

Следует также учитывать, что разница в скорости при
разделении дисков на RAID-блоки <strong>сильно</strong> зависит от заданных параметров. В
зависимости от того, как установлены параметры разделения на RAID-блоки и
каково количество дисков, можно получить величины с разницей в несколько
порядков. Следует помнить, что необходимо выбрать оптимизацию отдельно для
случайного и отдельно для последовательного доступа.
</DL>

<LI>

Для надежности можно использовать режим RAID 0+1 (разделение на
RAID-блоки + зеркальное отображение), но в этом случае будет
необходимо 2*N дисководов для хранения информации N дисководов данных.
Если возможности позволяют, то такой вариант выбора - наилучший!
Однако при этом могут понадобиться также инвестиции и в программное
обеспечение для эффективного управления этим объемом оборудования.

<LI>

Существует еще одна неплохая возможность: хранить не слишком важные данные
(которые могут быть воспроизведены) на диске RAID 0, а действительно
важные данные (такие как информация о хостах и журналы) - на диске RAID
0+1 или диске RAID N. Использование RAID N может оказаться проблемой, если
у вас много операций записи, потому что обновление битов четности занимает
время.

<LI>

Можно также задать требуемые параметры для используемой базой данных
файловой системы. Легко поддается изменению монтирование файловой
системы с опцией <code>noatime</code>. Использование этой опции позволяет
пропускать обновление при последнем обращении в данном режиме и тем
самым избежать поиска по диску.

<LI>

Под Linux можно получить намного большую производительность (под
нагрузкой нередко вплоть до 100%), используя <code>hdpram</code> для конфигурации
интерфейса диска! Приведенные ниже опции для <code>hdparm</code> зарекомендовали
себя как очень полезные для MySQL (и, возможно, для многих других
приложений):


<PRE>
hdparm -m 16 -d 1
</PRE>

Следует учитывать, что производительность/надежность при использовании
приведенных выше рекомендаций зависит от конкретного оборудования, так что
мы настоятельно рекомендуем вам основательно протестировать систему после
использования <code>hdparm</code>! Для получения более подробной информации о
применении <code>hdparm</code>, обращайтесь, пожалуйста, к соответствующей странице
руководства! Некомпетентное применение <code>hdparm</code> может привести к разрушению
файловой системы. Прежде чем экспериментировать, сделайте полную резервную
копию!

<LI>

Во многих операционных системах можно монтировать диски с флагом
<code>async</code> - для того, чтобы данная файловая система могла обновляться
асинхронно. Если ваш компьютер достаточно стабилен, это должно
обеспечить повышение производительности без слишком большой потери
надежности (под Linux этот флаг включен по умолчанию).

<LI>

Если нет необходимости знать, к какому файлу было последнее обращение
(что реально не используется на сервере баз данных), можно
смонтировать файловые системы с флагом <code>noatime</code>.
</UL>



<H3><A NAME="Symbolic_links" HREF="manual.ru_toc.html#Symbolic_links">5.6.1  Использование символических ссылок</A></H3>

<P>
<A NAME="IDX937"></A>
<A NAME="IDX938"></A>

</P>
<P>
Таблицы и базы данных можно перемещать из каталога баз данных в другие
места, заменив их символическими ссылками на новые адреса. Это можно
сделать, например, для того, чтобы поместить базу данных в файловую
систему с большим количеством свободного места или чтобы увеличить
скорость системы путем распространения таблиц на иной диск.

</P>
<P>
Рекомендуется создавать символические ссылки на другой диск для баз
данных, а символические ссылки для таблиц - только в крайних случаях.

</P>



<H4><A NAME="Symbolic_links_to_databases" HREF="manual.ru_toc.html#Symbolic_links_to_databases">5.6.1.1  Использование символических ссылок для баз данных</A></H4>

<P>
<A NAME="IDX939"></A>

</P>
<P>
Для создания символической ссылки для базы данных вначале следует создать
каталог на некотором диске, где имеется свободное место, а затем создать
символическую ссылку на него из каталога баз данных MySQL.

</P>

<PRE>
shell&#62; mkdir /dr1/databases/test
shell&#62; ln -s /dr1/databases/test mysqld-datadir
</PRE>

<P>
MySQL не поддерживает ссылку из одного каталога на несколько баз данных.
Замещение каталога базы данных символической ссылкой будет хорошо работать
только в случае, если вы не создаете символическую ссылку между базами
данных. Предположим, имеется база данных <code>db1</code> в каталоге данных MySQL и
создается символическая ссылка <code>db2</code>, указывающая на <code>db1</code>:

</P>

<PRE>
shell&#62; cd /path/to/datadir
shell&#62; ln -s db1 db2
</PRE>

<P>
Теперь для любой таблицы <code>tbl_a</code> в <code>db1</code> должна существовать  таблица <code>tbl_a</code> в
<code>db2</code>. Если один поток обновляет <code>db1.tbl_a</code>, а другой поток - <code>db2.tbl_a</code>, то
возникнут проблемы.

</P>
<P>
Если описанная выше возможность действительно необходима, то нужно
изменить следующий код в <code>mysys/mf_format.c</code>:

</P>

<PRE>
if (flag &#38; 32 || (!lstat(to,&#38;stat_buff) &#38;&#38; S_ISLNK(stat_buff.st_mode)))
</PRE>

<P>
на

</P>

<PRE>
if (1)
</PRE>

<P>
Под Windows можно использовать внутренние символические ссылки на каталоги
(путем компиляции MySQL с <code>-DUSE_SYMDIR</code>). Это позволяет размещать различные
базы данных на различных дисках (see section <A HREF="manual.ru.html#Windows_symbolic_links">2.6.2.5  Распределение данных в Windows между несколькими различными дисками</A>).

</P>


<H4><A NAME="Symbolic_links_to_tables" HREF="manual.ru_toc.html#Symbolic_links_to_tables">5.6.1.2  Использование символических ссылок для таблиц</A></H4>

<P>
<A NAME="IDX940"></A>

</P>
<P>
Не следует использовать символические ссылки для таблиц в версиях до MySQL
4.0, где при работе с ними требуется особая тщательность. Проблема
заключается в том, что, если запускаются команды <code>ALTER TABLE</code>, <code>REPAIR TABLE</code>
или <code>OPTIMIZE TABLE</code> на таблице, связанной символической ссылкой, то
символические ссылки будут удалены и заменены исходными файлами. Это
происходит потому, что любая вышеназванная команда работает путем создания
временного файла в каталоге базы данных и по завершении команды происходит
замещение исходного файла временным.

</P>
<P>
Не следует связывать символическими ссылками таблицы в системах, где вызов
функции <code>realpath()</code> работает не полностью (по крайней мере,
<code>realpath()</code> поддерживают Linux и Solaris).

</P>
<P>
В MySQL 4.0 символические ссылки полностью поддерживаются только для
таблиц <code>MyISAM</code>. Для других типов таблиц при выполнении какой-либо из
вышеупомянутых команд могут возникать непонятные проблемы.

</P>
<P>
Обработка символических ссылок в MySQL 4.0 происходит следующим образом
(это в основном относится только к таблицам <code>MyISAM</code>).

</P>

<UL>
<LI>

В каталоге данных всегда будет находиться файл определения таблицы и
файлы данных/индексов.

<LI>

Можно связывать символическими ссылками файл индексов и файл данных с
различными каталогами независимо друг от друга.

<LI>

Связывание символическими ссылками можно выполнить из операционной
системы (если не запущен <code>mysqld</code>) или с помощью команды <code>INDEX/DATA
DIRECTORY="path-to-dir"</code> в <code>CREATE TABLE</code> (see section <A HREF="manual.ru.html#CREATE_TABLE">6.5.3  Синтаксис оператора <code>CREATE TABLE</code></A>).

<LI>

<code>myisamchk</code> не замещает символическую ссылку на индекс/файл, а работает
напрямую с файлами, на которые указывает символическая ссылка. Все
временные файлы будут создаваться в том же каталоге, где находится
файл данных/индексов.

<LI>

При удалении таблицы, в которой используются символические ссылки, как
ссылка, так и файл, на который ссылка указывает, удаляются. Это веская
причина для того, чтобы <strong>не</strong> запускать <code>mysqld</code> в качестве
суперпользователя (<code>root</code>) и не позволять другим иметь доступ к записи
в каталоги баз данных MySQL.

<LI>

Если таблица переименовывается с помощью <code>ALTER TABLE RENAME</code>, и вы не переносите
таблицу в другую базу данных, то данная символическая ссылка в каталоге базы
данных будет переименована и файл данных/индексов соответственно будет
переименован.

<LI>

Если <code>ALTER TABLE RENAME</code> используется для переноса таблицы в другую
базу данных, то эта таблица будет перенесена в другой каталог базы
данных, а старые символические ссылки и файлы, на которые они
указывают, будут удалены. Иными словами, новая таблица не будет ссылкой. 

<LI>

Если символические ссылки не применяются, то необходимо использовать
опцию <code>--skip-symlink</code> в <code>mysqld</code> для уверенности, что никто не сможет
удалить или переименовать файл вне каталога данных этого потока.
</UL>

<P>
Возможности, которые пока еще не поддерживаются:

</P>

<UL>
<LI>

<code>ALTER TABLE</code>  игнорирует  все  опции  <code>INDEX/DATA DIRECTORY="path"</code>.

<LI>

<code>CREATE TABLE</code> не сообщает, что данная таблица имеет символические
ссылки.

<LI>

<code>mysqldump</code> не включает в вывод информацию о символических ссылках.

<LI>

<code>BACKUP TABLE</code> и <code>RESTORE TABLE</code> не признают символические ссылки.
</UL>



<H1><A NAME="Reference" HREF="manual.ru_toc.html#Reference">6  Справочник по языку MySQL</A></H1>

<P>
MySQL имеет очень сложный, но интуитивно понятный и легкий в изучении интерфейс,
основанный на SQL (структурированный язык запросов). В данном разделе
описываются различные команды, типы данных и функции этого языка, которые
необходимо знать, чтобы использовать MySQL рационально и эффективно. Данная
глава служит также справочником по всем функциональным возможностям,
реализованным в MySQL. Читатель найдет в этой главе ссылки на различные
источники информации, которые, возможно, будут полезными для ее эффективного
использования.

</P>



<H2><A NAME="Language_Structure" HREF="manual.ru_toc.html#Language_Structure">6.1  Структура языка</A></H2>



<H3><A NAME="Literals" HREF="manual.ru_toc.html#Literals">6.1.1  Литералы: представление строк и чисел</A></H3>

<P>
<A NAME="IDX941"></A>
<A NAME="IDX942"></A>
<A NAME="IDX943"></A>
<A NAME="IDX944"></A>

</P>

<P>
В этом разделе описываются различные способы представления строк и чисел в
MySQL. Здесь затронуты также различные нюансы и особенности, с которыми
могут столкнуться программисты при работе с этими базовыми типами данных в
MySQL.

</P>


<H4><A NAME="String_syntax" HREF="manual.ru_toc.html#String_syntax">6.1.1.1  Cтроки</A></H4>

<P>
Строка представляет собой последовательность символов, заключенных либо в
одинарные кавычки (<samp>`''</samp>) - апострофы, либо в двойные кавычки (<samp>`"'</samp>). При
использовании диалекта ANSI SQL допустимы только одинарные кавычки.
Например:

</P>

<PRE>
'a string'
"another string"
</PRE>

<P>
Внутри строки некоторые последовательности символов имеют специальное
назначение. Каждая из этих последовательностей начинается обратным слешем
(<samp>`\'</samp>), известным как escape-символ или символ перехода.  MySQL распознает
следующие escape-последовательности:

</P>
<DL COMPACT>

<DT><code>\0</code>
<DD>
<A NAME="IDX945"></A>
 <A NAME="IDX946"></A>
 
Символ 0 (<code>NUL</code>) в ASCII коде.

<A NAME="IDX947"></A>
<A NAME="IDX948"></A>
<DT><code>\'</code>
<DD>
Символ одиночной кавычки (<samp>`''</samp>).

<A NAME="IDX949"></A>
<A NAME="IDX950"></A>
<DT><code>\"</code>
<DD>
Символ двойной кавычки (<samp>`"'</samp>).

<A NAME="IDX951"></A>
<DT><code>\b</code>
<DD>
Возврат на один символ.

<A NAME="IDX952"></A>
<DT><code>\n</code>
<DD>
Символ новой строки (перевода строки).

<A NAME="IDX953"></A>
<DT><code>\r</code>
<DD>
Символ перевода каретки.

<A NAME="IDX954"></A>
<A NAME="IDX955"></A>
<DT><code>\t</code>
<DD>
Символ  табуляции.

<A NAME="IDX956"></A>
<A NAME="IDX957"></A>
<DT><code>\z</code>
<DD>
Символ (Control-Z) таблицы ASCII(26). Данный символ можно закодировать,
чтобы обойти проблему, заключающуюся в том, что под Windows ASCII(26)
означает конец файла (проблемы возникают при использовании ASCII(26) в
выражении <code>mysql database &#60; filename)</code>.

<A NAME="IDX958"></A>
<DT><code>\\</code>
<DD>
Символ обратного слеша.

<A NAME="IDX959"></A>
<DT><code>\%</code>
<DD>
Символ процентов <samp>`%'</samp>. Используется для поиска копий литерала <samp>`%'</samp> в
контекстах, где выражение <samp>`%'</samp> в противном случае интерпретировалось бы как
групповой символ (see section <A HREF="manual.ru.html#String_comparison_functions">6.3.2.1  Функции сравнения строк</A>).

<A NAME="IDX960"></A>
<DT><code>\<samp>`_'</samp></code>
<DD>
Символ  подчеркивания  <samp>`_'</samp>. Используется для поиска копий литерала <samp>`_'</samp> в
контекстах, где выражение <samp>`_'</samp> в противном случае интерпретировалось бы как
групповой символ (see section <A HREF="manual.ru.html#String_comparison_functions">6.3.2.1  Функции сравнения строк</A>).
</DL>

<P>
Обратите внимание на то, что при использовании <samp>`\%'</samp> или <samp>`\_'</samp> в контекстах
некоторых строк будут возвращаться значения строк <samp>`\%'</samp> и <samp>`\_'</samp>, а не <samp>`%'</samp> и
<samp>`_'</samp>.

</P>
<P>
Существует несколько способов включить кавычки в строку:

</P>

<UL>
<LI>

Одиночная кавычка (апостроф) <samp>`''</samp> внутри строки, заключенной в кавычки
<samp>`''</samp>, может быть записана как <samp>`'''</samp>.

<LI>

Двойная кавычка <samp>`"'</samp> внутри строки, заключенной в двойные кавычки <samp>`"'</samp>,
может быть записана как <samp>`""'</samp>.

<LI>

Можно предварить символ кавычки символом экранирования (<samp>`\'</samp>).

<LI>

Для символа <samp>`''</samp> внутри строки, заключенной в двойные кавычки,
не требуется специальной обработки; его также не требуется дублировать
или предварять обратным слешем. Точно так же не требует специальной
обработки двойная кавычка <samp>`"'</samp> внутри строки, заключенной в одиночные
кавычки <samp>`''</samp>.
</UL>

<P>
Ниже показаны возможные варианты применения кавычек и escape-символа на
примерах выполнения команды SELECT:

</P>

<PRE>
mysql&#62; SELECT 'hello', '"hello"', '""hello""', 'hel''lo', '\'hello';
+-------+---------+-----------+--------+--------+
| hello | "hello" | ""hello"" | hel'lo | 'hello |
+-------+---------+-----------+--------+--------+

mysql&#62; SELECT "hello", "'hello'", "''hello''", "hel""lo", "\"hello";
+-------+---------+-----------+--------+--------+
| hello | 'hello' | ''hello'' | hel"lo | "hello |
+-------+---------+-----------+--------+--------+

mysql&#62; SELECT "This\nIs\nFour\nlines";
+--------------------+
| This
Is
Four
lines |
+--------------------+
</PRE>

<P>
<A NAME="IDX961"></A>

</P>
<P>
Если необходимо вставить в строку двоичные данные (такие как <code>BLOB</code>),
следующие символы должны быть представлены как escape-последовательности:

</P>
<DL COMPACT>

<DT><code>NUL</code>
<DD>
ASCII 0. Необходимо представлять в виде <samp>`\0'</samp> (обратный слеш и символ ASCII
<samp>`0'</samp>).

<DT><code>\</code>
<DD>
ASCII 92, обратный слеш. Представляется как <samp>`\\'</samp>.

<DT><code>'</code>
<DD>
ASCII 39, единичная кавычка. Представляется как <samp>`\''</samp>.

<DT><code>"</code>
<DD>
ASCII 34, двойная кавычка. Представляется как <samp>`\"'</samp>.
</DL>

<P>
При написании программы на языке C для добавления символов экранирования в
команде <code>INSERT</code> можно использовать функцию <code>mysql_real_escape_string()</code> из C
API (see section <A HREF="manual.ru.html#C_API_function_overview">8.4.2  Обзор функций интерфейса C</A>). При программировании на Perl
можно использовать метод <code>quote</code> из пакета DBI для превращения специальных
символов в соответствующие escape-последовательности (see section <A HREF="manual.ru.html#Perl_DBI_Class">8.2.2  Интерфейс <code>DBI</code></A>).

</P>
<P>
Не следует забывать, что указанное свойство escape-символа должно
использоваться во всех строках, которые могут содержать любые специальные
символы, перечисленные выше.

</P>
<P>
В качестве альтернативы многие интерфейсы прикладного программирования
(API) для MySQL предоставляют определенную возможность использования
символов-заменителей, что позволяет вносить специальные маркеры в строку
запроса и затем связывать с ними значения данных при выдаче результатов
запроса.

</P>


<H4><A NAME="Number_syntax" HREF="manual.ru_toc.html#Number_syntax">6.1.1.2  Числа</A></H4>

<P>
<A NAME="IDX962"></A>
<A NAME="IDX963"></A>
<A NAME="IDX964"></A>
<A NAME="IDX965"></A>
<A NAME="IDX966"></A>

</P>
<P>
Целые числа представляются в виде последовательности цифр. Для чисел с
плавающей точкой в качестве разделителя десятичных знаков используется
символ <samp>`.'</samp>. Числа обоих типов могут предваряться символом  <samp>`-'</samp>,
обозначающим отрицательную величину.

</P>
<P>
Примеры допустимых целых чисел:

</P>

<PRE>
1221
0
-32
</PRE>

<P>
Примеры  допустимых  чисел с плавающей запятой:

</P>

<PRE>
294.42
-32032.6809e+10
148.00
</PRE>

<P>
Целое число можно использовать в контексте дробных чисел, при этом оно
будет интерпретироваться как эквивалент числа с плавающей запятой.

</P>


<H4><A NAME="Hexadecimal_values" HREF="manual.ru_toc.html#Hexadecimal_values">6.1.1.3  Шестнадцатеричные величины</A></H4>

<P>
<A NAME="IDX967"></A>

</P>
<P>
MySQL поддерживает шестнадцатеричные величины.  В числовом контексте такое
число обладает всеми свойствами целого числа с 64-разрядной точностью. В
строковом контексте шестнадцатеричная величина представляет собой двоичную
строку, в которой каждая пара шестнадцатеричных разрядов конвертируется в
символ:

</P>


<PRE>
mysql&#62; SELECT x'4D7953514C';
         -&#62; MySQL
mysql&#62; SELECT 0xa+0;
         -&#62; 10
mysql&#62; SELECT 0x5061756c;
         -&#62; Paul
</PRE>

<P>
Синтаксис выражений вида <code>x'hexstring'</code> (новшество в версии 4.0) базируется
на ANSI SQL, а для обозначений вида <code>0x</code> используется синтаксис ODBC.
Шестнадцатеричные строки часто применяются в ODBC для представления
двоичных типов данных вида <code>BLOB</code>. Для конвертирования строки или числа в
шестнадцатеричный вид можно применять функцию <code>HEX()</code>.

</P>


<H4><A NAME="NULL_values" HREF="manual.ru_toc.html#NULL_values">6.1.1.4  Значения <code>NULL</code></A></H4>

<P>
<A NAME="IDX968"></A>

</P>
<P>
Значение <code>NULL</code> означает ``отсутствие данных''. Они является отличным от
значения 0 для числовых типов данных или пустой строки для строковых типов
(see section <A HREF="manual.ru.html#Problems_with_NULL">A.5.3  Проблемы со значением <code>NULL</code></A>).

</P>
<P>
При использовании форматов импорта или экспорта текстовых файлов (<code>LOAD
DATA INFILE, SELECT ... INTO OUTFILE</code>) <code>NULL</code> можно представить как <code>\N</code> 
(see section <A HREF="manual.ru.html#LOAD_DATA">6.4.9  Синтаксис оператора  <code>LOAD DATA INFILE</code></A>).

</P>


<H3><A NAME="Legal_names" HREF="manual.ru_toc.html#Legal_names">6.1.2  Имена баз данных, таблиц, столбцов, индексы псевдонимы</A></H3>

<P>
<A NAME="IDX969"></A>
<A NAME="IDX970"></A>
<A NAME="IDX971"></A>
<A NAME="IDX972"></A>
<A NAME="IDX973"></A>
<A NAME="IDX974"></A>
<A NAME="IDX975"></A>

</P>
<P>
Для всех имен баз данных, таблиц, столбцов, индексов и псевдонимов в MySQL
приняты одни и те же правила.

</P>
<P>
<A NAME="IDX976"></A>
<A NAME="IDX977"></A>
<A NAME="IDX978"></A>
<A NAME="IDX979"></A>

</P>
<P>
Следует отметить, что эти правила были изменены, начиная с версии MySQL
3.23.6, когда было разрешено брать в одиночные скобки <samp>``'</samp> идентификаторы
(имена баз данных, таблиц и столбцов). Двойные скобки <samp>`"'</samp> тоже допустимы -
при работе в режиме ANSI SQL (see section <A HREF="manual.ru.html#ANSI_mode">1.9.2  Запуск MySQL в режиме ANSI</A>).

</P>
<TABLE BORDER>
<TR><TD><strong>Идентификатор</strong> </TD><TD> <strong>Максимальная длина строки</strong> </TD><TD> <strong>Допускаемые символы</strong>
</TD></TR>
<TR><TD>База данных </TD><TD> 64 </TD><TD> Любой символ, допустимый в имени  каталога, за исключением <samp>`/'</samp>, <samp>`\'</samp> или
<samp>`.'</samp> 
</TD></TR>
<TR><TD>Таблица </TD><TD> 64 </TD><TD> Любой символ, допустимый в имени  файла, за исключением <samp>`/'</samp> или <samp>`.'</samp>
</TD></TR>
<TR><TD>Столбец </TD><TD> 64 </TD><TD> Все символы
</TD></TR>
<TR><TD>Псевдоним </TD><TD> 255 </TD><TD> Все символы
</TD></TR>
</TABLE>

<P>
Необходимо также учитывать, что не следует использовать символы <code>ASCII(0)</code>,
<code>ASCII(255)</code> или кавычки в самом идентификаторе.

</P>
<P>
Кроме того, если имя идентификатора относится к служебным словам или
содержит специальные символы, необходимо всегда заключать его в обратные
кавычки <code>`</code> при использовании в выражениях:

</P>

<PRE>
mysql&#62; SELECT * FROM `select` WHERE `select`.id &#62; 100;
</PRE>

<P>
See section <A HREF="manual.ru.html#Reserved_words">6.1.7  ``Придирчив'' ли MySQL к зарезервированным словам?</A>.

</P>
<P>
В предыдущих версиях MySQL (до 3.23.6) для имен существовали следующие правила:

</P>

<UL>
<LI>

 Имя может состоять из буквенно-цифровых символов установленного в
данное время алфавита и символов <samp>`_'</samp> and <samp>`$'</samp>. Тип кодировки по
умолчанию - ISO-8859-1 Latin1, он может быть изменен указанием иного
типа в аргументе параметра <code>--default-character-set</code> <code>mysqld</code> 
(see section <A HREF="manual.ru.html#Character_sets">4.6.1  Набор символов, применяющийся для записи данных и сортировки</A>).

<LI>

Имя может начинаться с любого допустимого символа, в частности, с
цифры (в этом состоит отличие от правил, принятых во многих других
базах данных). Однако имя не может состоять только из цифр.

<LI>

Не допускается использование в именах символа <samp>`.'</samp>, так как он
применяется для расширения формата имени (посредством чего можно
ссылаться на столбцы - см. в этом же разделе ниже).
</UL>

<P>
Не рекомендуется использовать имена, подобные <code>1e</code>, так как выражение
вида <code>1e+1</code> является неоднозначным. Оно может интерпретироваться и как
выражение <code>1e + 1</code>, и как число <code>1e+1</code>.

</P>
<P>
В MySQL разрешается делать ссылки на столбец, используя любую из следующих
форм:

</P>
<TABLE BORDER>
<TR><TD><strong>Ссылка на столбец</strong> </TD><TD> <strong>Значение</strong>
</TD></TR>
<TR><TD><code>col_name</code> </TD><TD> Столбец <code>col_name</code> из любой используемой в запросе таблицы содержит столбец с данным именем.
</TD></TR>
<TR><TD><code>tbl_name.col_name</code> </TD><TD> Столбец <code>col_name</code> из таблицы <code>tbl_name</code> текущей базы данных.
</TD></TR>
<TR><TD><code>db_name.tbl_name.col_name</code> </TD><TD> Столбец  <code>col_name</code>  из  таблицы  <code>tbl_name</code>  базы   данных  <code>db_name</code>. Эта форма доступна в версии MySQL 3.22 или более поздних.
</TD></TR>
<TR><TD><code>`column_name`</code> </TD><TD> Имя столбца является ключевым словом или содержит специальные символы.
</TD></TR>
</TABLE>

<P>
Нет необходимости указывать префикс <code>tbl_name</code> или <code>db_name.tbl_name</code> в ссылке
на столбец в каком-либо утверждении, если эта ссылка не будет
неоднозначной. Например, предположим, что каждая из таблиц <code>t1</code> и <code>t2</code>
содержит столбец <code>c</code>, по которому производится выборка командой <code>SELECT</code>,
использующей обе таблицы - и <code>t1</code>, и  <code>t2</code>. В этом случае имя <code>столбца</code> c
является неоднозначным, так как оно не уникально для таблиц, указанных в
команде, поэтому необходимо уточнить, какая именно таблица имеется в виду,
конкретизировав - <code>t1.c</code> или <code>t2.c</code>. Аналогично, при выборке данных из таблицы
<code>t</code> в базе данных <code>db1</code> и из таблицы <code>t</code> в базе данных <code>db2</code> необходимо ссылаться
на столбцы в этих таблицах как на <code>db1.t.col_name</code> и <code>db2.t.col_name</code>.

</P>
<P>
Выражение <code>.tbl_name</code> означает таблицу <code>tbl_name</code> в текущей базе данных.
Данный синтаксис принят для совместимости с ODBC, так как некоторые
программы ODBC ставят в начале имен таблиц в качестве префикса символ <samp>`.'</samp>.

</P>


<H3><A NAME="Name_case_sensitivity" HREF="manual.ru_toc.html#Name_case_sensitivity">6.1.3  Чувствительность имен к регистру</A></H3>

<P>
<A NAME="IDX980"></A>
<A NAME="IDX981"></A>
<A NAME="IDX982"></A>
<A NAME="IDX983"></A>
<A NAME="IDX984"></A>
<A NAME="IDX985"></A>

</P>
<P>
В MySQL имена баз данных и таблиц соответствуют директориям и файлам
внутри директорий. Следовательно, чувствительность к регистру операционной
системы, под которой работает MySQL, определяет чувствительность к
регистру имен баз данных и таблиц. Это означает, что имена баз данных и
таблиц нечувствительны к регистру под Windows, а под большинством версий
Unix проявляют чувствительность к регистру.
Одно большое исключение здесь это Mac OS X, когда файловая система по умолчанию HFS+ используется.
Однако Mac OS X также поддерживает тома UFS, которые чувствительны к регистру
под Mac OS X также как и на Unix.  See section <A HREF="manual.ru.html#Extensions_to_ANSI">1.9.3  Расширения MySQL к ANSI SQL92</A>.

</P>
<P>
Примечание: хотя имена баз данных и таблиц нечувствительны к регистру под
Windows, не следует ссылаться на конкретную базу данных или таблицу,
используя различные регистры символов внутри одного и того же запроса.
Приведенный ниже запрос не будет выполнен, поскольку в нем одна и та же
таблица указана и как <code>my_table</code>, и как <code>MY_TABLE</code>:

</P>

<PRE>
mysql&#62; SELECT * FROM my_table WHERE MY_TABLE.col=1;
</PRE>

<P>
Имена и псевдонимы столбцов нечувствительны к регистру во всех случаях.

</P>
<P>
Псевдонимы таблиц обладают чувствительностью к регистру. Приведенный ниже
запрос не будет выполнен, поскольку он ссылается на псевдоним и как на <code>a</code>,
и как на <code>A</code>:

</P>

<PRE>
mysql&#62; SELECT col_name FROM tbl_name AS a
    -&#62; WHERE a.col_name = 1 OR A.col_name = 2;
</PRE>

<P>
Если вы не хотите держать в памяти размер букв для имен базы данных и
таблиц, при создании базы данных и таблиц придерживайтесь
последовательного принципа, используя для имен только строчные буквы.

</P>
<P>
Одним из путей устранения этой проблемы является запуск демона <code>mysqld</code> с
параметром <code>-O lower_case_table_names=1</code>. По умолчанию этот параметр имеет
значение 1 для Windows и 0 для Unix.

</P>
<P>
Если значение параметра <code>lower_case_table_names</code> равно 1, MySQL при
сохранении и поиске  будет преобразовывать все имена таблиц к нижнему регистру.
С версии 4.0.2 это также касается и имен баз данных. Обратите внимание на то,
что при изменении этого параметра перед запуском <code>mysqld</code> необходимо
прежде всего преобразовать имена всех старых таблиц к нижнему регистру.

</P>
<P>
При переносе <code>MyISAM</code>-файлов с Windows на диск в Unix в некоторых случаях
будет полезна утилита <code>mysql_fix_extensions</code> для приведения в соответствие
регистров расширений файлов в каждой указанной директории базы данных (нижний
регистр <tt>`.frm'</tt>, верхний регистр <tt>`.MYI'</tt> и <tt>`.MYD'</tt>). Утилиту
<code>mysql_fix_extensions</code> можно найти в подкаталоге <tt>`scripts'</tt>.

</P>


<H3><A NAME="Variables" HREF="manual.ru_toc.html#Variables">6.1.4  Переменные пользователя</A></H3>

<P>
<A NAME="IDX986"></A>
<A NAME="IDX987"></A>
<A NAME="IDX988"></A>

</P>
<P>
Для конкретного процесса пользователь может определить локальные
переменные, которые в MySQL обозначаются как <code>@variablename</code>. Имя локальной
переменной может состоять из буквенно-цифровых символов установленного в
данное время алфавита и символов <samp>`_'</samp>, <samp>`$'</samp>, and <samp>`.'</samp>. Тип кодировки по
умолчанию - ISO-8859-1 Latin1, он может быть изменен указанием иного типа
в аргументе параметра <code>--default-character-set</code> <code>mysqld</code> 
(see section <A HREF="manual.ru.html#Character_sets">4.6.1  Набор символов, применяющийся для записи данных и сортировки</A>).

</P>
<P>
Локальные переменные не требуют инициализации. Они содержат значение <code>NULL</code>
по умолчанию; в них могут храниться целые числа, вещественные числа или
строковые величины. При запуске конкретного процесса все объявленные в нем
локальные переменные автоматически активизируются.

</P>
<P>
Локальную переменную можно объявить, используя синтаксис команды <code>SET</code>:

</P>

<PRE>
SET @variable= { integer expression | real expression | string expression }
[,@variable= ...].
</PRE>

<P>
Можно также определить значение переменной иным способом, без команды <code>SET</code>.
Однако в этом случае в качестве оператора присвоения более предпочтительно
использовать оператор <samp>`:='</samp>, чем оператор <samp>`='</samp>, так как последний
зарезервирован для сравнения выражений, не связанных с установкой
переменных:

</P>

<PRE>
mysql&#62; SELECT @t1:=(@t2:=1)+@t3:=4,@t1,@t2,@t3;
+----------------------+------+------+------+
| @t1:=(@t2:=1)+@t3:=4 | @t1  | @t2  | @t3  |
+----------------------+------+------+------+
|                    5 |    5 |    1 |    4 |
+----------------------+------+------+------+
</PRE>

<P>
Введенные пользователем переменные могут применяться только в составе
выражений и там, где выражения допустимы. Заметим, что в область их
применения в данное время не включается контекст, в котором явно требуется
число, например, условие <code>LIMIT</code> в команде <code>SELECT</code> или выражение  <code>IGNORE
number LINES</code> в команде <code>LOAD DATA</code>.

</P>
<P>
Примечание: в команде <code>SELECT</code> каждое выражение оценивается только при
отправлении клиенту. Это означает, что в условиях <code>HAVING</code>, <code>GROUP BY</code>, or
<code>ORDER BY</code> не следует ссылаться на  выражение, содержащее переменные,
которые введены в части <code>SELECT</code> этой команды. Например, следующая команда
НЕ будет выполняться так, как ожидалось:

</P>

<PRE>
mysql&#62; SELECT (@aa:=id) AS a, (@aa+3) AS b FROM table_name HAVING b=5;
</PRE>

<P>
Причина в том, что переменная <code>@aa</code> не будет содержать значения текущей
строки, в то время как значение <code>id</code> в предыдущем выражении является
строкой.

</P>
<P>
Действует правило никогда не создавать <code>и не использовать</code> одну и ту же переменную в одном
и том же выражении SQL.

</P>


<H3><A NAME="System_Variables" HREF="manual.ru_toc.html#System_Variables">6.1.5  Системные переменные</A></H3>

<P>
<A NAME="IDX989"></A>
<A NAME="IDX990"></A>

</P>
<P>
Начиная с MySQL 4.0.3 мы предоставляем лучший доступ к большинству системных переменных и 
переменных, относящихся к соединению. Можно менять теперь большую часть переменных без необходимости
останавливать сервер. 

</P>
<P>
Есть два типа системных переменных: специфичные для потока (или для соединения;
мы их в дальнейшем называем потоковыми переменными для краткости), которые
уникальны для данного соединения и глобальные перемененные, которые
предназначаются для управления глобальными событиями. Глобальные переменные
также используются для того, чтобы установить значения по умолчанию для
соответствующих потоковых переменных для новых соединений. 

</P>
<P>
Когда <code>mysqld</code> запускается, все глобальные переменные инициализируются из командной строки
и файлов опций. Вы можете изменять значения с помощью <code>SET GLOBAL</code>. Когда новый поток создается, 
потоковые переменные инициализируются из глобальных и они не меняются даже если вы даете новую 
команду <code>SET GLOBAL</code>.

</P>
<P>
Для установки глобальной переменной, используйте один из таких синтаксисов: 
(Здесь используется <code>sort_buffer_size</code> в качестве примера)

</P>

<PRE>
SET GLOBAL sort_buffer_size=value;
SET @@global.sort_buffer_size=value;
</PRE>

<P>
Чтобы установить значение для потоковой переменной, используйте такие синтаксисы: 

</P>

<PRE>
SET SESSION sort_buffer_size=value;
SET @@session.sort_buffer_size=value;
SET sort_buffer_size=value;
</PRE>

<P>
Если вы не указываете режим, то тогда подразумевается <code>SESSION</code>.
See section <A HREF="manual.ru.html#SET_OPTION">5.5.6  Синтаксис команды <code>SET</code></A>.

</P>
<P>
<code>LOCAL</code> - синоним для <code>SESSION</code>.

</P>
<P>
Для получения значения глобальной переменной используйте одну из этих команд: 

</P>

<PRE>
SELECT @@global.sort_buffer_size;
SHOW GLOBAL VARIABLES like 'sort_buffer_size';
</PRE>

<P>
Для получения значения потоковой переменной используйте одну из этих команд: 

</P>

<PRE>
SELECT @@session.sort_buffer_size;
SHOW SESSION VARIABLES like 'sort_buffer_size';
</PRE>

<P>
Когда вы запрашиваете значение переменной с помощью синтаксиса
<code>@@variable_name</code> и не укзываете <code>GLOBAL</code> или <code>SESSION</code>, то
тогда MySQL вернет потоковое значение этой переменное, если таковое существует.
Если нет, то MySQL вернет глобальное значение. 

</P>
<P>
Причина, по которой требуется указывать <code>GLOBAL</code> для установки только глобальных 
переменных но не для получения их значения, заключается в том, чтобы
удостовериться, что если мы в будущем не будем иметь проблем, если добавим 
потоковую переменную с таким же именем или уберем некую потоковую переменную. 
В этом случае вы можете ненароком изменить состояние сервера в целом, а не 
исключительно вашего соединения. 

</P>
<P>
Далее идет полный список всех переменных которые вы можете изменять и значения
которых можете получать, а также информация о том, можете ли вы использовать
<code>SESSION</code> или <code>GLOBAL</code> с ними. 

</P>
<TABLE BORDER>
<TR><TD><strong>Переменная</strong> </TD><TD> <strong>Тип значения</strong> </TD><TD> <strong>Тип</strong>
</TD></TR>
<TR><TD>autocommit </TD><TD> булевое </TD><TD> SESSION
</TD></TR>
<TR><TD>big_tables </TD><TD> булевое </TD><TD> SESSION
</TD></TR>
<TR><TD>binlog_cache_size </TD><TD> число </TD><TD> GLOBAL
</TD></TR>
<TR><TD>bulk_insert_buffer_size </TD><TD> число </TD><TD> GLOBAL | SESSION
</TD></TR>
<TR><TD>concurrent_insert </TD><TD> булевое </TD><TD> GLOBAL
</TD></TR>
<TR><TD>connect_timeout </TD><TD> число </TD><TD> GLOBAL
</TD></TR>
<TR><TD>convert_character_set </TD><TD> строка </TD><TD> SESSION
</TD></TR>
<TR><TD>delay_key_write </TD><TD> OFF | ON | ALL </TD><TD> GLOBAL
</TD></TR>
<TR><TD>delayed_insert_limit </TD><TD> число </TD><TD> GLOBAL
</TD></TR>
<TR><TD>delayed_insert_timeout </TD><TD> число </TD><TD> GLOBAL
</TD></TR>
<TR><TD>delayed_queue_size </TD><TD> число </TD><TD> GLOBAL
</TD></TR>
<TR><TD>error_count </TD><TD> число </TD><TD> LOCAL
</TD></TR>
<TR><TD>flush </TD><TD> булевое </TD><TD> GLOBAL
</TD></TR>
<TR><TD>flush_time </TD><TD> число </TD><TD> GLOBAL
</TD></TR>
<TR><TD>foreign_key_checks </TD><TD> булевое </TD><TD> SESSION
</TD></TR>
<TR><TD>identity </TD><TD> число </TD><TD> SESSION
</TD></TR>
<TR><TD>insert_id </TD><TD> булевое </TD><TD> SESSION
</TD></TR>
<TR><TD>interactive_timeout </TD><TD> число </TD><TD> GLOBAL | SESSION
</TD></TR>
<TR><TD>join_buffer_size </TD><TD> число </TD><TD> GLOBAL | SESSION
</TD></TR>
<TR><TD>key_buffer_size </TD><TD> число </TD><TD> GLOBAL
</TD></TR>
<TR><TD>last_insert_id </TD><TD> булевое </TD><TD> SESSION
</TD></TR>
<TR><TD>local_infile </TD><TD> булевое </TD><TD> GLOBAL
</TD></TR>
<TR><TD>log_warnings </TD><TD> булевое </TD><TD> GLOBAL
</TD></TR>
<TR><TD>long_query_time </TD><TD> число </TD><TD> GLOBAL | SESSION
</TD></TR>
<TR><TD>low_priority_updates </TD><TD> булевое </TD><TD> GLOBAL | SESSION
</TD></TR>
<TR><TD>max_allowed_packet </TD><TD> число </TD><TD> GLOBAL | SESSION
</TD></TR>
<TR><TD>max_binlog_cache_size </TD><TD> число </TD><TD> GLOBAL
</TD></TR>
<TR><TD>max_binlog_size </TD><TD> число </TD><TD> GLOBAL
</TD></TR>
<TR><TD>max_connect_errors </TD><TD> число </TD><TD> GLOBAL
</TD></TR>
<TR><TD>max_connections </TD><TD> число </TD><TD> GLOBAL
</TD></TR>
<TR><TD>max_error_count </TD><TD> число </TD><TD> GLOBAL | SESSION
</TD></TR>
<TR><TD>max_delayed_threads </TD><TD> число </TD><TD> GLOBAL
</TD></TR>
<TR><TD>max_heap_table_size </TD><TD> число </TD><TD> GLOBAL | SESSION
</TD></TR>
<TR><TD>max_join_size </TD><TD> число </TD><TD> GLOBAL | SESSION
</TD></TR>
<TR><TD>max_sort_length </TD><TD> число </TD><TD> GLOBAL | SESSION
</TD></TR>
<TR><TD>max_tmp_tables </TD><TD> число </TD><TD> GLOBAL
</TD></TR>
<TR><TD>max_user_connections </TD><TD> число </TD><TD> GLOBAL
</TD></TR>
<TR><TD>max_write_lock_count </TD><TD> число </TD><TD> GLOBAL
</TD></TR>
<TR><TD>myisam_max_extra_sort_file_size </TD><TD> число </TD><TD> GLOBAL | SESSION
</TD></TR>
<TR><TD>myisam_max_sort_file_size </TD><TD> число </TD><TD> GLOBAL | SESSION
</TD></TR>
<TR><TD>myisam_sort_buffer_size </TD><TD> число </TD><TD> GLOBAL | SESSION
</TD></TR>
<TR><TD>net_buffer_length </TD><TD> число </TD><TD> GLOBAL | SESSION
</TD></TR>
<TR><TD>net_read_timeout </TD><TD> число </TD><TD> GLOBAL | SESSION
</TD></TR>
<TR><TD>net_retry_count </TD><TD> число </TD><TD> GLOBAL | SESSION
</TD></TR>
<TR><TD>net_write_timeout </TD><TD> число </TD><TD> GLOBAL | SESSION
</TD></TR>
<TR><TD>query_cache_limit </TD><TD> число </TD><TD> GLOBAL
</TD></TR>
<TR><TD>query_cache_size </TD><TD> число </TD><TD> GLOBAL
</TD></TR>
<TR><TD>query_cache_type </TD><TD> enum </TD><TD> GLOBAL
</TD></TR>
<TR><TD>read_buffer_size </TD><TD> число </TD><TD> GLOBAL | SESSION
</TD></TR>
<TR><TD>read_rnd_buffer_size </TD><TD> число </TD><TD> GLOBAL | SESSION
</TD></TR>
<TR><TD>rpl_recovery_rank </TD><TD> число </TD><TD> GLOBAL
</TD></TR>
<TR><TD>safe_show_database </TD><TD> булевое </TD><TD> GLOBAL
</TD></TR>
<TR><TD>server_id </TD><TD> число </TD><TD> GLOBAL
</TD></TR>
<TR><TD>slave_compressed_protocol </TD><TD> булевое </TD><TD> GLOBAL
</TD></TR>
<TR><TD>slave_net_timeout </TD><TD> число </TD><TD> GLOBAL
</TD></TR>
<TR><TD>slow_launch_time </TD><TD> число </TD><TD> GLOBAL
</TD></TR>
<TR><TD>sort_buffer_size </TD><TD> число </TD><TD> GLOBAL | SESSION
</TD></TR>
<TR><TD>sql_auto_is_null </TD><TD> булевое </TD><TD> SESSION
</TD></TR>
<TR><TD>sql_big_selects </TD><TD> булевое </TD><TD> SESSION
</TD></TR>
<TR><TD>sql_big_tables </TD><TD> булевое </TD><TD> SESSION
</TD></TR>
<TR><TD>sql_buffer_result </TD><TD> булевое </TD><TD> SESSION
</TD></TR>
<TR><TD>sql_log_binlog </TD><TD> булевое </TD><TD> SESSION
</TD></TR>
<TR><TD>sql_log_off </TD><TD> булевое </TD><TD> SESSION
</TD></TR>
<TR><TD>sql_log_update </TD><TD> булевое </TD><TD> SESSION
</TD></TR>
<TR><TD>sql_low_priority_updates </TD><TD> булевое </TD><TD> GLOBAL | SESSION
</TD></TR>
<TR><TD>sql_max_join_size </TD><TD> число </TD><TD> GLOBAL | SESSION
</TD></TR>
<TR><TD>sql_quote_show_create </TD><TD> булевое </TD><TD> SESSION
</TD></TR>
<TR><TD>sql_safe_updates </TD><TD> булевое </TD><TD> SESSION
</TD></TR>
<TR><TD>sql_select_limit </TD><TD> булевое </TD><TD> SESSION
</TD></TR>
<TR><TD>sql_slave_skip_counter </TD><TD> число </TD><TD> GLOBAL
</TD></TR>
<TR><TD>sql_warnings </TD><TD> булевое </TD><TD> SESSION
</TD></TR>
<TR><TD>table_cache </TD><TD> число </TD><TD> GLOBAL
</TD></TR>
<TR><TD>table_type </TD><TD> enum </TD><TD> GLOBAL | SESSION
</TD></TR>
<TR><TD>thread_cache_size </TD><TD> число </TD><TD> GLOBAL
</TD></TR>
<TR><TD>timestamp </TD><TD> булевое </TD><TD> SESSION
</TD></TR>
<TR><TD>tmp_table_size </TD><TD> enum </TD><TD> GLOBAL | SESSION
</TD></TR>
<TR><TD>tx_isolation </TD><TD> enum </TD><TD> GLOBAL | SESSION
</TD></TR>
<TR><TD>version </TD><TD> строка </TD><TD> GLOBAL
</TD></TR>
<TR><TD>wait_timeout </TD><TD> число </TD><TD> GLOBAL | SESSION
</TD></TR>
<TR><TD>warning_count </TD><TD> число </TD><TD> LOCAL
</TD></TR>
<TR><TD>unique_checks </TD><TD> булевое </TD><TD> SESSION
</TD></TR>
</TABLE>

<P>
Переменные, помеченные как <code>число</code> могут иметь числовое значение.
Переменные, помеченные как <code>булевое</code> могут быть установлены в <code>0</code>,
<code>1</code>, <code>ON</code> или <code>OFF</code>.  Переменные типа <code>enum</code> должны в общем
случае быть установлены в одно из возможных значений для переменной, но также
могут быть установлены в значение числа, соответствующего значению выбора enum.
Первый элемент списка enum - номер 0. 

</P>
<P>
Вот описание некоторых переменных: 

</P>
<TABLE BORDER>
<TR><TD><strong>Переменная</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD>identity </TD><TD> Синоним для last_insert_id (совместимость с Sybase)
</TD></TR>
<TR><TD>sql_low_priority_updates </TD><TD> Синоним для low_priority_updates
</TD></TR>
<TR><TD>sql_max_join_size </TD><TD> Синоним для max_join_size
</TD></TR>
<TR><TD>delay_key_write_for_all_tables </TD><TD> Если это и delay_key_write установлены, то тогда все вновь открываемые таблицы MyISAM открываются с задержкой записи ключей.
</TD></TR>
<TR><TD>version </TD><TD> Синоним для VERSION() (совместимость (?) с Sybase)
</TD></TR>
</TABLE>

<P>
Описания других переменных можно найти в описании переменных запуска
<code>mysql</code>, в описании команды <code>SHOW VARIABLES</code> и в разделе <code>SET</code>.
See section <A HREF="manual.ru.html#Command-line_options">4.1.1  Параметры командной строки <code>mysqld</code></A>.  See section <A HREF="manual.ru.html#SHOW_VARIABLES">4.5.6.4  <code>SHOW VARIABLES</code></A>. See section <A HREF="manual.ru.html#SET_OPTION">5.5.6  Синтаксис команды <code>SET</code></A>.

</P>



<H3><A NAME="Comments" HREF="manual.ru_toc.html#Comments">6.1.6  Синтаксис  комментариев</A></H3>

<P>
<A NAME="IDX991"></A>

</P>
<P>
Сервер MySQL поддерживает следующие способы задания комментариев: с
помощью символа <samp>`#'</samp>, за которым следует текст комментария до конца строки; 
с помощью двух символов  <code>--</code>, за которыми идет текст комментария до конца
строки;  и (для многострочных комментариев) с помощью символов <code>/*</code> (начало
комментария) и <code>*/</code> (конец комментария):

</P>


<PRE>
mysql&#62; SELECT 1+1;     # Этот комментарий продолжается до конца строки
mysql&#62; SELECT 1+1;     -- Этот комментарий продолжается до конца строки
mysql&#62; SELECT 1 /* Это комментарий в строке */ + 1;
mysql&#62; SELECT 1+
/*
Это многострочный
комментарий
*/
1;
</PRE>

<P>
Обратите внимание: при использовании для комментирования способа с <code>--</code>
(двойное тире) требуется наличие хотя бы одного пробела после второго
тире!

</P>
<P>
Хотя сервер ``понимает'' все описанные выше варианты комментирования,
существует ряд ограничений на способ синтаксического анализа комментариев
вида <code>/* ... */</code>  клиентом  <code>mysql</code>:

</P>

<UL>
<LI>

Символы одинарной и двойной кавычек, даже внутри комментария,
считаются началом заключенной в кавычки строки. Если внутри
комментария не встречается вторая такая же кавычка, синтаксический
анализатор не считает комментарий законченным. При работе с <code>mysql</code> в
интерактивном режиме эта ошибка проявится в том, что окно запроса
изменит свое состояние с <code>mysql&#62;</code> на <code>'&#62;</code> или <code>"&#62;</code>.

<LI>

Точка с запятой используется для обозначения окончания данной
SQL-команды и что-либо, следующее за этим символом, указывает на
начало следующего выражения.
</UL>

<P>
Эти ограничения относятся как к интерактивному режиму работы <code>mysql</code> (из
командной строки), так и к вызову команд из файла, читаемого с ввода
командой <code>mysql &#60; some-file</code>.

</P>
<P>
MySQL поддерживает принятый в ANSI SQL способ комментирования с помощью
двойного тире <samp>`--'</samp> только в том случае, если после второго тире следует
пробел (see section <A HREF="manual.ru.html#ANSI_diff_comments">1.9.4.7  Символы `--' как начало комментария</A>).

</P>


<H3><A NAME="Reserved_words" HREF="manual.ru_toc.html#Reserved_words">6.1.7  ``Придирчив'' ли MySQL к зарезервированным словам?</A></H3>

<P>
<A NAME="IDX992"></A>
<A NAME="IDX993"></A>
<A NAME="IDX994"></A>
<A NAME="IDX995"></A>

</P>
<P>
Это общая проблема, возникающая при попытке создать таблицу с именами
столбцов, использующих принятые в MySQL названия типов данных или функций,
такие как <code>TIMESTAMP</code> или <code>GROUP</code>. Иногда это возможно (например, <code>ABS</code> является
разрешенным именем для столбца), но не допускается пробел между именем
функции и сразу же следующей за ним скобкой <samp>`('</samp> при использовании имен
функций, совпадающих с именами столбцов.

</P>
<P>
Следующие слова являются зарезервированными в MySQL. Большинство из них не
допускаются в ANSI  SQL92 как имена столбцов и/или таблиц (например
GROUP). Некоторые зарезервированы для нужд MySQL и используются (в
настоящее время) синтаксическим анализатором <code>yacc</code>:

</P>

<TABLE BORDER>
<TR><TD><strong>Word</strong>
 </TD><TD> <strong>Word</strong>
 </TD><TD> <strong>Word</strong>
</TD></TR>
<TR><TD><code>ADD</code>
 </TD><TD> <code>ALL</code>
 </TD><TD> <code>ALTER</code>
</TD></TR>
<TR><TD><code>ANALYZE</code>
 </TD><TD> <code>AND</code>
 </TD><TD> <code>AS</code>
</TD></TR>
<TR><TD><code>ASC</code>
 </TD><TD> <code>ASENSITIVE</code>
 </TD><TD> <code>AUTO_INCREMENT</code>
</TD></TR>
<TR><TD><code>BDB</code>
 </TD><TD> <code>BEFORE</code>
 </TD><TD> <code>BERKELEYDB</code>
</TD></TR>
<TR><TD><code>BETWEEN</code>
 </TD><TD> <code>BIGINT</code>
 </TD><TD> <code>BINARY</code>
</TD></TR>
<TR><TD><code>BLOB</code>
 </TD><TD> <code>BOTH</code>
 </TD><TD> <code>BY</code>
</TD></TR>
<TR><TD><code>CALL</code>
 </TD><TD> <code>CASCADE</code>
 </TD><TD> <code>CASE</code>
</TD></TR>
<TR><TD><code>CHANGE</code>
 </TD><TD> <code>CHAR</code>
 </TD><TD> <code>CHARACTER</code>
</TD></TR>
<TR><TD><code>CHECK</code>
 </TD><TD> <code>COLLATE</code>
 </TD><TD> <code>COLUMN</code>
</TD></TR>
<TR><TD><code>COLUMNS</code>
 </TD><TD> <code>CONDITION</code>
 </TD><TD> <code>CONNECTION</code>
</TD></TR>
<TR><TD><code>CONSTRAINT</code>
 </TD><TD> <code>CONTINUE</code>
 </TD><TD> <code>CREATE</code>
</TD></TR>
<TR><TD><code>CROSS</code>
 </TD><TD> <code>CURRENT_DATE</code>
 </TD><TD> <code>CURRENT_TIME</code>
</TD></TR>
<TR><TD><code>CURRENT_TIMESTAMP</code>
 </TD><TD> <code>CURSOR</code>
 </TD><TD> <code>DATABASE</code>
</TD></TR>
<TR><TD><code>DATABASES</code>
 </TD><TD> <code>DAY_HOUR</code>
 </TD><TD> <code>DAY_MICROSECOND</code>
</TD></TR>
<TR><TD><code>DAY_MINUTE</code>
 </TD><TD> <code>DAY_SECOND</code>
 </TD><TD> <code>DEC</code>
</TD></TR>
<TR><TD><code>DECIMAL</code>
 </TD><TD> <code>DECLARE</code>
 </TD><TD> <code>DEFAULT</code>
</TD></TR>
<TR><TD><code>DELAYED</code>
 </TD><TD> <code>DELETE</code>
 </TD><TD> <code>DESC</code>
</TD></TR>
<TR><TD><code>DESCRIBE</code>
 </TD><TD> <code>DETERMINISTIC</code>
 </TD><TD> <code>DISTINCT</code>
</TD></TR>
<TR><TD><code>DISTINCTROW</code>
 </TD><TD> <code>DIV</code>
 </TD><TD> <code>DOUBLE</code>
</TD></TR>
<TR><TD><code>DROP</code>
 </TD><TD> <code>ELSE</code>
 </TD><TD> <code>ELSEIF</code>
</TD></TR>
<TR><TD><code>ENCLOSED</code>
 </TD><TD> <code>ESCAPED</code>
 </TD><TD> <code>EXISTS</code>
</TD></TR>
<TR><TD><code>EXIT</code>
 </TD><TD> <code>EXPLAIN</code>
 </TD><TD> <code>FALSE</code>
</TD></TR>
<TR><TD><code>FETCH</code>
 </TD><TD> <code>FIELDS</code>
 </TD><TD> <code>FLOAT</code>
</TD></TR>
<TR><TD><code>FOR</code>
 </TD><TD> <code>FORCE</code>
 </TD><TD> <code>FOREIGN</code>
</TD></TR>
<TR><TD><code>FOUND</code>
 </TD><TD> <code>FRAC_SECOND</code>
 </TD><TD> <code>FROM</code>
</TD></TR>
<TR><TD><code>FULLTEXT</code>
 </TD><TD> <code>GRANT</code>
 </TD><TD> <code>GROUP</code>
</TD></TR>
<TR><TD><code>HAVING</code>
 </TD><TD> <code>HIGH_PRIORITY</code>
 </TD><TD> <code>HOUR_MICROSECOND</code>
</TD></TR>
<TR><TD><code>HOUR_MINUTE</code>
 </TD><TD> <code>HOUR_SECOND</code>
 </TD><TD> <code>IF</code>
</TD></TR>
<TR><TD><code>IGNORE</code>
 </TD><TD> <code>IN</code>
 </TD><TD> <code>INDEX</code>
</TD></TR>
<TR><TD><code>INFILE</code>
 </TD><TD> <code>INNER</code>
 </TD><TD> <code>INNODB</code>
</TD></TR>
<TR><TD><code>INOUT</code>
 </TD><TD> <code>INSENSITIVE</code>
 </TD><TD> <code>INSERT</code>
</TD></TR>
<TR><TD><code>INT</code>
 </TD><TD> <code>INTEGER</code>
 </TD><TD> <code>INTERVAL</code>
</TD></TR>
<TR><TD><code>INTO</code>
 </TD><TD> <code>IO_THREAD</code>
 </TD><TD> <code>IS</code>
</TD></TR>
<TR><TD><code>ITERATE</code>
 </TD><TD> <code>JOIN</code>
 </TD><TD> <code>KEY</code>
</TD></TR>
<TR><TD><code>KEYS</code>
 </TD><TD> <code>KILL</code>
 </TD><TD> <code>LEADING</code>
</TD></TR>
<TR><TD><code>LEAVE</code>
 </TD><TD> <code>LEFT</code>
 </TD><TD> <code>LIKE</code>
</TD></TR>
<TR><TD><code>LIMIT</code>
 </TD><TD> <code>LINES</code>
 </TD><TD> <code>LOAD</code>
</TD></TR>
<TR><TD><code>LOCALTIME</code>
 </TD><TD> <code>LOCALTIMESTAMP</code>
 </TD><TD> <code>LOCK</code>
</TD></TR>
<TR><TD><code>LONG</code>
 </TD><TD> <code>LONGBLOB</code>
 </TD><TD> <code>LONGTEXT</code>
</TD></TR>
<TR><TD><code>LOOP</code>
 </TD><TD> <code>LOW_PRIORITY</code>
 </TD><TD> <code>MASTER_SERVER_ID</code>
</TD></TR>
<TR><TD><code>MATCH</code>
 </TD><TD> <code>MEDIUMBLOB</code>
 </TD><TD> <code>MEDIUMINT</code>
</TD></TR>
<TR><TD><code>MEDIUMTEXT</code>
 </TD><TD> <code>MIDDLEINT</code>
 </TD><TD> <code>MINUTE_MICROSECOND</code>
</TD></TR>
<TR><TD><code>MINUTE_SECOND</code>
 </TD><TD> <code>MOD</code>
 </TD><TD> <code>NATURAL</code>
</TD></TR>
<TR><TD><code>NOT</code>
 </TD><TD> <code>NO_WRITE_TO_BINLOG</code>
 </TD><TD> <code>NULL</code>
</TD></TR>
<TR><TD><code>NUMERIC</code>
 </TD><TD> <code>ON</code>
 </TD><TD> <code>OPTIMIZE</code>
</TD></TR>
<TR><TD><code>OPTION</code>
 </TD><TD> <code>OPTIONALLY</code>
 </TD><TD> <code>OR</code>
</TD></TR>
<TR><TD><code>ORDER</code>
 </TD><TD> <code>OUT</code>
 </TD><TD> <code>OUTER</code>
</TD></TR>
<TR><TD><code>OUTFILE</code>
 </TD><TD> <code>PRECISION</code>
 </TD><TD> <code>PRIMARY</code>
</TD></TR>
<TR><TD><code>PRIVILEGES</code>
 </TD><TD> <code>PROCEDURE</code>
 </TD><TD> <code>PURGE</code>
</TD></TR>
<TR><TD><code>READ</code>
 </TD><TD> <code>REAL</code>
 </TD><TD> <code>REFERENCES</code>
</TD></TR>
<TR><TD><code>REGEXP</code>
 </TD><TD> <code>RENAME</code>
 </TD><TD> <code>REPEAT</code>
</TD></TR>
<TR><TD><code>REPLACE</code>
 </TD><TD> <code>REQUIRE</code>
 </TD><TD> <code>RESTRICT</code>
</TD></TR>
<TR><TD><code>RETURN</code>
 </TD><TD> <code>REVOKE</code>
 </TD><TD> <code>RIGHT</code>
</TD></TR>
<TR><TD><code>RLIKE</code>
 </TD><TD> <code>SECOND_MICROSECOND</code>
 </TD><TD> <code>SELECT</code>
</TD></TR>
<TR><TD><code>SENSITIVE</code>
 </TD><TD> <code>SEPARATOR</code>
 </TD><TD> <code>SET</code>
</TD></TR>
<TR><TD><code>SHOW</code>
 </TD><TD> <code>SMALLINT</code>
 </TD><TD> <code>SOME</code>
</TD></TR>
<TR><TD><code>SONAME</code>
 </TD><TD> <code>SPATIAL</code>
 </TD><TD> <code>SPECIFIC</code>
</TD></TR>
<TR><TD><code>SQL</code>
 </TD><TD> <code>SQLEXCEPTION</code>
 </TD><TD> <code>SQLSTATE</code>
</TD></TR>
<TR><TD><code>SQLWARNING</code>
 </TD><TD> <code>SQL_BIG_RESULT</code>
 </TD><TD> <code>SQL_CALC_FOUND_ROWS</code>
</TD></TR>
<TR><TD><code>SQL_SMALL_RESULT</code>
 </TD><TD> <code>SQL_TSI_DAY</code>
 </TD><TD> <code>SQL_TSI_FRAC_SECOND</code>
</TD></TR>
<TR><TD><code>SQL_TSI_HOUR</code>
 </TD><TD> <code>SQL_TSI_MINUTE</code>
 </TD><TD> <code>SQL_TSI_MONTH</code>
</TD></TR>
<TR><TD><code>SQL_TSI_QUARTER</code>
 </TD><TD> <code>SQL_TSI_SECOND</code>
 </TD><TD> <code>SQL_TSI_WEEK</code>
</TD></TR>
<TR><TD><code>SQL_TSI_YEAR</code>
 </TD><TD> <code>SSL</code>
 </TD><TD> <code>STARTING</code>
</TD></TR>
<TR><TD><code>STRAIGHT_JOIN</code>
 </TD><TD> <code>STRIPED</code>
 </TD><TD> <code>TABLE</code>
</TD></TR>
<TR><TD><code>TABLES</code>
 </TD><TD> <code>TERMINATED</code>
 </TD><TD> <code>THEN</code>
</TD></TR>
<TR><TD><code>TIMESTAMPADD</code>
 </TD><TD> <code>TIMESTAMPDIFF</code>
 </TD><TD> <code>TINYBLOB</code>
</TD></TR>
<TR><TD><code>TINYINT</code>
 </TD><TD> <code>TINYTEXT</code>
 </TD><TD> <code>TO</code>
</TD></TR>
<TR><TD><code>TRAILING</code>
 </TD><TD> <code>TRUE</code>
 </TD><TD> <code>UNDO</code>
</TD></TR>
<TR><TD><code>UNION</code>
 </TD><TD> <code>UNIQUE</code>
 </TD><TD> <code>UNLOCK</code>
</TD></TR>
<TR><TD><code>UNSIGNED</code>
 </TD><TD> <code>UPDATE</code>
 </TD><TD> <code>USAGE</code>
</TD></TR>
<TR><TD><code>USE</code>
 </TD><TD> <code>USER_RESOURCES</code>
 </TD><TD> <code>USING</code>
</TD></TR>
<TR><TD><code>UTC_DATE</code>
 </TD><TD> <code>UTC_TIME</code>
 </TD><TD> <code>UTC_TIMESTAMP</code>
</TD></TR>
<TR><TD><code>VALUES</code>
 </TD><TD> <code>VARBINARY</code>
 </TD><TD> <code>VARCHAR</code>
</TD></TR>
<TR><TD><code>VARCHARACTER</code>
 </TD><TD> <code>VARYING</code>
 </TD><TD> <code>WHEN</code>
</TD></TR>
<TR><TD><code>WHERE</code>
 </TD><TD> <code>WHILE</code>
 </TD><TD> <code>WITH</code>
</TD></TR>
<TR><TD><code>WRITE</code>
 </TD><TD> <code>XOR</code>
 </TD><TD> <code>YEAR_MONTH</code>
</TD></TR>
<TR><TD><code>ZEROFILL</code>
 </TD><TD>  </TD><TD> </TD></TR>
</TABLE>

<P>
Следующие символы (из приведенной выше таблицы таблицы) не разрешены в
ANSI  SQL, но допускаются в MySQL как имена столбцов/таблиц. Это
объясняется тем, что некоторые из этих имен являются словами естественного
языка и уже использованы многими потребителями.

</P>


<UL>
<LI><code>ACTION</code>

<LI><code>BIT</code>

<LI><code>DATE</code>

<LI><code>ENUM</code>

<LI><code>NO</code>

<LI><code>TEXT</code>

<LI><code>TIME</code>

<LI><code>TIMESTAMP</code>

</UL>



<H2><A NAME="Column_types" HREF="manual.ru_toc.html#Column_types">6.2  Типы данных столбцов</A></H2>

<P>
<A NAME="IDX996"></A>
<A NAME="IDX997"></A>

</P>
<P>
MySQL поддерживает несколько типов столбцов, которые можно разделить на
три категории: числовые типы данных, типы данных для хранения даты и
времени и символьные (строковые) типы данных. В данном разделе вначале
дается обзор всех возможных типов и приводятся требования по хранению для
каждого типа столбца, затем свойства типов описываются более подробно по
каждой категории. Мы намеренно сделали обзор кратким, поскольку более
детальные описания требуют дополнительной информации о конкретных типах
столбцов, например, о допустимых форматах представления величин.

</P>
<P>
Ниже перечислены типы столбцов, поддерживаемые MySQL. В описаниях
используются следующие обозначения:

</P>
<P>
<A NAME="IDX998"></A>
<A NAME="IDX999"></A>
<A NAME="IDX1000"></A>
<A NAME="IDX1001"></A>
<A NAME="IDX1002"></A>
<A NAME="IDX1003"></A>

</P>
<DL COMPACT>

<DT><code>M</code>
<DD>
Указывает максимальный размер вывода. Максимально допустимый размер вывода
составляет 255 символов.

<DT><code>D</code>
<DD>
Употребляется для типов данных с плавающей точкой и указывает количество
разрядов, следующих за десятичной точкой. Максимально возможная величина
составляет 30 разрядов, но не может быть больше, чем <code>M</code>-2.
</DL>

<P>
Квадратные скобки (<samp>`['</samp> и <samp>`]'</samp>) указывают для типа данных группы
необязательных признаков.

</P>
<P>
<A NAME="IDX1004"></A>

</P>
<P>
Заметьте, что если для столбца указать параметр <code>ZEROFILL</code>, то MySQL будет
автоматически добавлять в этот столбец атрибут <code>UNSIGNED</code>.

</P>
<P>
<strong>Предупреждение:</strong> следует помнить, что при выполнении вычитания между
числовыми величинами, одна из которых относится к типу <code>UNSIGNED</code>, результат
будет беззнаковым! See section <A HREF="manual.ru.html#Cast_Functions">6.3.5  Функции приведения типов</A>.

</P>
<DL COMPACT>

<DT><code>TINYINT[(M)] [UNSIGNED] [ZEROFILL]</code>
<DD>
<A NAME="IDX1005"></A>
 

Очень малое целое число. Диапазон со знаком от <code>-128</code> до <code>127</code>. Диапазон без
знака от <code>0</code> до <code>255</code>.

<A NAME="IDX1006"></A>
<A NAME="IDX1007"></A>
<DT><code>BIT</code>
<DD>
<DT><code>BOOL</code>
<DD>
Являются синонимами для <code>TINYINT(1)</code>.

<A NAME="IDX1008"></A>
<DT><code>SMALLINT[(M)] [UNSIGNED] [ZEROFILL]</code>
<DD>
Малое целое число. Диапазон со знаком от <code>-32768</code> до <code>32767</code>. Диапазон без
знака от <code>0</code> до <code>65535</code>.

<A NAME="IDX1009"></A>
<DT><code>MEDIUMINT[(M)] [UNSIGNED] [ZEROFILL]</code>
<DD>
Целое число среднего размера. Диапазон со знаком от <code>-8388608</code> до <code>8388607</code>.
Диапазон без знака от <code>0</code> до <code>16777215</code>.

<A NAME="IDX1010"></A>
<DT><code>INT[(M)] [UNSIGNED] [ZEROFILL]</code>
<DD>
Целое число нормального размера. Диапазон со знаком от <code>-2147483648</code> до
<code>2147483647</code>. Диапазон без знака от <code>0</code> до <code>4294967295</code>.

<A NAME="IDX1011"></A>
<DT><code>INTEGER[(M)] [UNSIGNED] [ZEROFILL]</code>
<DD>
Синоним для <code>INT</code>.

<A NAME="IDX1012"></A>
<DT><code>BIGINT[(M)] [UNSIGNED] [ZEROFILL]</code>
<DD>
Большое целое число. Диапазон со знаком от <code>-9223372036854775808</code> до
<code>9223372036854775807</code>. Диапазон без знака от 0 до <code>18446744073709551615</code>. Для
столбцов типа <code>BIGINT</code> необходимо учитывать некоторые особенности:


<UL>
<LI>

<A NAME="IDX1013"></A>
Все арифметические операции выполняются с использованием значений
<code>BIGINT</code> или <code>DOUBLE</code> со знаком, так что не следует использовать
беззнаковые целые числа больше чем <code>9223372036854775807</code> (63 бита),
кроме операций, выполняемых логическими функциями. В противном случае
несколько последних разрядов результата могут оказаться ошибочными
из-за ошибок округления при преобразовании <code>BIGINT</code> в <code>DOUBLE</code>. MySQL 4.0
может обрабатывать данные типа <code>BIGINT</code> в следующих случаях:


<UL>
<LI>

Использование целых чисел для хранения больших беззнаковых
величин в столбце с типом <code>BIGINT</code>.

<LI>

В случаях <code>MIN(big_int_column)</code> и <code>MAX(big_int_column)</code>.

<LI>

При использовании операторов (<samp>`+'</samp>, <samp>`-'</samp>, <samp>`*'</samp> и т.д.), когда оба операнда
являются целыми числами.
</UL>

<LI>

Точное значение целого числа всегда можно хранить в столбце с типом
<code>BIGINT</code> в виде строки. В этом случае MySQL выполнит преобразование
строки в число без промежуточного преобразования.

<LI>

Если оба аргумента являются целочисленными величинами, то при
выполнении над ними операций <samp>`-'</samp>, <samp>`+'</samp>, и <samp>`*'</samp> будут использоваться
правила <code>BIGINT</code>-арифметики. Это означает, что при умножении двух
больших целых чисел (или результатов вычислений функций, возвращающих
целые числа) результат операции может оказаться непредсказуемым, если
он превосходит значение <code>9223372036854775807</code>.
</UL>

<A NAME="IDX1014"></A>
<A NAME="IDX1015"></A>
<A NAME="IDX1016"></A>
<DT><code>FLOAT(точность) [UNSIGNED] [ZEROFILL]</code>
<DD>
Число с плавающей точкой. Атрибут точности может иметь значение <code>&#60;=24</code> для
числа с плавающей точкой обычной (одинарной) точности и между <code>25</code> и <code>53</code> -
для числа с плавающей точкой удвоенной точности. Эти типы данных сходны с
типами <code>FLOAT</code> и <code>DOUBLE</code>, описанными ниже. <code>FLOAT(X)</code> относится к тому же
интервалу, что и соответствующие типы <code>FLOAT</code> и <code>DOUBLE</code>, но диапазон значений
и количество десятичных знаков не определены.

В версии MySQL 3.23 это
истинная величина числа с плавающей точкой. В более ранних версиях MySQL
тип данных <code>FLOAT(точность)</code> всегда имеет два десятичных знака.

<A NAME="IDX1017"></A>
<A NAME="IDX1018"></A>
Следует
отметить, что использование типа данных <code>FLOAT</code> может привести к неожиданным
проблемам, так как все вычисления в MySQL выполняются с удвоенной
точностью. See section <A HREF="manual.ru.html#No_matching_rows">A.5.6  Решение проблем с отсутствием строк, удовлетворяющих условиям поиска</A>. Данный
синтаксис обеспечивает совместимость с ODBC.

<A NAME="IDX1019"></A>
<A NAME="IDX1020"></A>
<DT><code>FLOAT[(M,D)] [UNSIGNED] [ZEROFILL]</code>
<DD>
Малое число с плавающей точкой обычной точности. Допустимые значения: от
<code>-3,402823466E+38</code> до <code>-1,175494351E-38</code>, <code>0</code>, и от <code>1,175494351E-38</code> до
<code>3,402823466E+38</code>. Если указан атрибут <code>UNSIGNED</code>, отрицательные значения
недопустимы. Атрибут <code>M</code> указывает количество выводимых пользователю знаков,
а атрибут <code>D</code> - количество разрядов, следующих за десятичной точкой.
Обозначение <code>FLOAT</code> без указания аргументов или запись вида <code>FLOAT(X)</code>, где <code>X</code>
<code>&#60;=24</code> справедливы для числа с плавающей точкой обычной точности.

<A NAME="IDX1021"></A>
<A NAME="IDX1022"></A>
<DT><code>DOUBLE[(M,D)] [UNSIGNED] [ZEROFILL]</code>
<DD>
Число с плавающей точкой удвоенной точности нормального размера.
Допустимые значения: от <code>-1,7976931348623157E+308</code> до
<code>-2,2250738585072014E-308</code>, <code>0</code>, и от <code>2,2250738585072014E-308</code> до
<code>1,7976931348623157E+308</code>. Если указан атрибут <code>UNSIGNED</code>, отрицательные
значения недопустимы. Атрибут <code>M</code> указывает количество выводимых
пользователю знаков, а атрибут <code>D</code> - количество разрядов, следующих за
десятичной точкой. Обозначение <code>DOUBLE</code> без указания аргументов или запись
вида <code>FLOAT(X)</code>, где <code>25 &#60;= X &#60;= 53</code> справедливы для числа с плавающей точкой
двойной точности.

<A NAME="IDX1023"></A>
<A NAME="IDX1024"></A>
<DT><code>DOUBLE PRECISION[(M,D)] [UNSIGNED] [ZEROFILL]</code>
<DD>
<DT><code>REAL[(M,D)] [UNSIGNED] [ZEROFILL]</code>
<DD>
Данные обозначения являются синонимами для <code>DOUBLE</code>.

<A NAME="IDX1025"></A>
<DT><code>DECIMAL[(M[,D])] [UNSIGNED] [ZEROFILL]</code>
<DD>
``Неупакованное'' число с плавающей точкой. Ведет себя подобно столбцу
<code>CHAR</code>, содержащему цифровое значение. Термин ``неупакованное'' означает,
что число хранится в виде строки и при этом для каждого десятичного знака
используется один символ. Разделительный знак десятичных разрядов, а также
знак <samp>`-'</samp> для отрицательных чисел не учитываются в <code>M</code> (но место для них
зарезервировано). Если атрибут <code>D</code> равен <code>0</code>, величины будут представлены без
десятичного знака, т.е. без дробной части. Максимальный интервал значений
типа <code>DECIMAL</code> тот же, что и для типа <code>DOUBLE</code>, но действительный интервал для
конкретного столбца <code>DECIMAL</code> может быть ограничен выбором значений
атрибутов <code>M</code> и <code>D</code>. Если указан атрибут <code>UNSIGNED</code>, отрицательные значения
недопустимы. Если атрибут <code>D</code> не указан, его значение по умолчанию равно <code>0</code>.
Если не указан <code>M</code>, его значение по умолчанию равно <code>10</code>. В более ранних, чем
MySQL 3.23, версиях аргумент <code>M</code> должен содержать в себе место для знака
числа и десятичного знака.

<A NAME="IDX1026"></A>
<A NAME="IDX1027"></A>
<DT><code>DEC[(M[,D])] [UNSIGNED] [ZEROFILL]</code>
<DD>
<DT><code>NUMERIC[(M[,D])] [UNSIGNED] [ZEROFILL]</code>
<DD>
Данные обозначения являются синонимами для <code>DECIMAL</code>.

<A NAME="IDX1028"></A>
<DT><code>DATE</code>
<DD>
Дата. Поддерживается интервал от <code>'1000-01-01'</code> до <code>'9999-12-31'</code>. MySQL
выводит значения <code>DATE</code> в формате <code>'YYYY-MM-DD'</code>, но можно установить значения
в столбец <code>DATE</code>, используя как строки, так и числа. See section <A HREF="manual.ru.html#DATETIME">6.2.2.2  Типы данных <code>DATETIME</code>, <code>DATE</code> и <code>TIMESTAMP</code></A>.

<A NAME="IDX1029"></A>
<DT><code>DATETIME</code>
<DD>
Комбинация даты и времени. Поддерживается интервал от <code>'1000-01-01 00:00:00'</code> 
до <code>'9999-12-31 23:59:59'</code>. MySQL выводит значения <code>DATETIME</code>  в
формате <code>'YYYY-MM-DD HH:MM:SS'</code>, но можно устанавливать значения в столбце 
<code>DATETIME</code>, используя как строки, так и числа. See section <A HREF="manual.ru.html#DATETIME">6.2.2.2  Типы данных <code>DATETIME</code>, <code>DATE</code> и <code>TIMESTAMP</code></A>.

<A NAME="IDX1030"></A>
<DT><code>TIMESTAMP[(M)]</code>
<DD>
Временная метка. Интервал от <code>'1970-01-01 00:00:00'</code> до некоторого
значения времени в 2037 году. MySQL выводит значения <code>TIMESTAMP</code> в форматах
<code>YYYYMMDDHHMMSS</code>, <code>YYMMDDHHMMSS</code>, <code>YYYYMMDD</code> или <code>YYMMDD</code> в зависимости от
значений <code>M</code>: <code>14</code> (или отсутствующее), <code>12</code>, <code>8</code>, или <code>6</code>;  но можно также
устанавливать значения в столбце  <code>TIMESTAMP</code>, используя как строки, так и
числа. Столбец <code>TIMESTAMP</code> полезен для записи даты и времени при выполнении
операций <code>INSERT</code> или <code>UPDATE</code>, так как при этом автоматически вносятся
значения даты и времени самой последней операции, если эти величины не
введены программой. Можно также устанавливать текущее значение даты и
времени, задавая значение <code>NULL</code>. See section <A HREF="manual.ru.html#Date_and_time_types">6.2.2  Типы данных даты и времени</A>.
Аргумент <code>M</code> влияет только на способ вывода столбца <code>TIMESTAMP</code>; для хранения
его значений всегда используется 4 байта. Следует учитывать, что столбцы
<code>TIMESTAMP(M)</code>, где <code>M</code> равно <code>8</code> или <code>14</code>, представляют собой числа, в то время,
как столбцы <code>TIMESTAMP(M)</code> с иным значением аргумента <code>M</code> являются строками.
Это убеждает, что можно надежно сделать дамп и восстановить таблицу с
этими типами столбцов! See section <A HREF="manual.ru.html#DATETIME">6.2.2.2  Типы данных <code>DATETIME</code>, <code>DATE</code> и <code>TIMESTAMP</code></A>.

<A NAME="IDX1031"></A>
<DT><code>TIME</code>
<DD>
Время. Интервал от <code>'-838:59:59'</code> до <code>'838:59:59'</code>. MySQL выводит значения
<code>TIME</code> в формате <code>'HH:MM:SS'</code>, но можно устанавливать значения в столбце  <code>TIME</code>,
используя как строки, так и числа. See section <A HREF="manual.ru.html#TIME">6.2.2.3  Тип данных <code>TIME</code></A>.

<A NAME="IDX1032"></A>
<DT><code>YEAR[(2|4)]</code>
<DD>
Год в двухзначном или четырехзначном форматах (по умолчанию формат
четырехзначный). Допустимы следующие значения: с <code>1901</code> по <code>2155</code>, <code>0000</code> для
четырехзначного формата года и <code>1970-2069</code> при использовании двухзначного
формата (<code>70-69</code>). MySQL выводит значения <code>YEAR</code> в формате <code>YYYY</code>, но можно
задавать значения в столбце  <code>YEAR</code>,  используя как строки, так и числа (тип
данных <code>YEAR</code> недоступен в версиях, предшествующих MySQL 3.22). 
See section <A HREF="manual.ru.html#YEAR">6.2.2.4  Тип данных  <code>YEAR</code></A>.

<A NAME="IDX1033"></A>
<A NAME="IDX1034"></A>
<A NAME="IDX1035"></A>
<A NAME="IDX1036"></A>
<DT><code>[NATIONAL] CHAR(M) [BINARY]</code>
<DD>
Строка фиксированной длины, при хранении всегда дополняется пробелами в
конце строки до заданного размера. Диапазон аргумента <code>M</code> составляет от <code>0</code> до
<code>255</code> символов (от <code>1</code> до <code>255</code> в версиях, предшествующих MySQL 3.23). Концевые
пробелы удаляются при выводе значения. Если не задан атрибут
чувствительности к регистру <code>BINARY</code>, то величины <code>CHAR</code> сортируются и
сравниваются как независимые от регистра в соответствии с установленным по
умолчанию алфавитом. 

Атрибут <code>NATIONAL CHAR</code> (или его эквивалентная краткая
форма <code>NCHAR</code>) представляет собой принятый в ANSI  SQL способ указания, что
в столбце <code>CHAR</code> должен использоваться установленный по умолчанию набор
символов (<code>CHARACTER</code>). В MySQL это принято по умолчанию. <code>CHAR</code> является
сокращением от <code>CHARACTER</code>. MySQL позволяет создавать столбец типа <code>CHAR(0)</code>.

В основном это полезно, если необходимо обеспечить совместимость с
некоторыми старыми приложениями, которые зависят от наличия столбца, но
реально эту величину не используют. Кроме того, такая возможность может
очень пригодиться в случае, если необходим столбец, который может
содержать только 2 значения, а именно <code>CHAR(0)</code> (т.е. столбец, который не
определен как <code>NOT NULL</code>, занимает только один бит и принимает только 2
значения: <code>NULL</code> или <code>""</code>). See section <A HREF="manual.ru.html#CHAR">6.2.3.1  Типы данных CHAR и VARCHAR</A>.

<DT><code>CHAR</code>
<DD>
Это синоним для <code>CHAR(1)</code>.

<A NAME="IDX1037"></A>
<A NAME="IDX1038"></A>
<A NAME="IDX1039"></A>
<DT><code>[NATIONAL] VARCHAR(M) [BINARY]</code>
<DD>
Строка переменной длины. <strong>Примечание:</strong> концевые пробелы удаляются при
сохранении значения (в этом заключается отличие от спецификации ANSI 
SQL). Диапазон аргумента <code>M</code> составляет от <code>0</code> до <code>255</code> символов (от <code>1</code> до <code>255</code> в
версиях, предшествующих MySQL  Version 4.0.2). Если не задан атрибут
чувствительности к регистру <code>BINARY</code>, то величины <code>VARCHAR</code> сортируются и
сравниваются как независимые от регистра. See section <A HREF="manual.ru.html#Silent_column_changes">6.5.3.1  Молчаливые изменения определений столбцов</A>. Термин <code>VARCHAR</code> является сокращением от <code>CHARACTER 
VARYING</code>. See section <A HREF="manual.ru.html#CHAR">6.2.3.1  Типы данных CHAR и VARCHAR</A>.

<A NAME="IDX1040"></A>
<A NAME="IDX1041"></A>
<DT><code>TINYBLOB</code>
<DD>
<DT><code>TINYTEXT</code>
<DD>
Столбец типа <code>BLOB</code> или <code>TEXT</code> с максимальной длиной <code>255</code> (<code>2^8 - 1</code>) символов.
See section <A HREF="manual.ru.html#Silent_column_changes">6.5.3.1  Молчаливые изменения определений столбцов</A>. See section <A HREF="manual.ru.html#BLOB">6.2.3.2  Типы данных <code>BLOB</code> и <code>TEXT</code></A>.

<A NAME="IDX1042"></A>
<A NAME="IDX1043"></A>
<DT><code>BLOB</code>
<DD>
<DT><code>TEXT</code>
<DD>
Столбец типа <code>BLOB</code> или <code>TEXT</code> с максимальной длиной <code>65535</code> (<code>2^16 - 1</code>)
символов. See section <A HREF="manual.ru.html#Silent_column_changes">6.5.3.1  Молчаливые изменения определений столбцов</A>. See section <A HREF="manual.ru.html#BLOB">6.2.3.2  Типы данных <code>BLOB</code> и <code>TEXT</code></A>.

<A NAME="IDX1044"></A>
<A NAME="IDX1045"></A>
<DT><code>MEDIUMBLOB</code>
<DD>
<DT><code>MEDIUMTEXT</code>
<DD>
Столбец типа <code>BLOB</code> или <code>TEXT</code> с максимальной длиной <code>16777215</code> (<code>2^24 - 1</code>)
символов. See section <A HREF="manual.ru.html#Silent_column_changes">6.5.3.1  Молчаливые изменения определений столбцов</A>. See section <A HREF="manual.ru.html#BLOB">6.2.3.2  Типы данных <code>BLOB</code> и <code>TEXT</code></A>.

<A NAME="IDX1046"></A>
<A NAME="IDX1047"></A>
<DT><code>LONGBLOB</code>
<DD>
<DT><code>LONGTEXT</code>
<DD>
Столбец типа <code>BLOB</code> или <code>TEXT</code> с максимальной длиной <code>4294967295</code> (<code>2^32 - 1</code>)
символов. See section <A HREF="manual.ru.html#Silent_column_changes">6.5.3.1  Молчаливые изменения определений столбцов</A>. Следует
учитывать, что в настоящее время протокол передачи данных сервер/клиент и
таблицы <code>MyISAM</code> имеют ограничение 16 Мб на передаваемый пакет/строку таблицы,
поэтому пока нельзя использовать этот тип данных в его полном диапазоне.
See section <A HREF="manual.ru.html#BLOB">6.2.3.2  Типы данных <code>BLOB</code> и <code>TEXT</code></A>.

<DT><code>ENUM('значение1','значение2',...)</code>
<DD>
Перечисление. Перечисляемый тип данных. Объект строки может иметь только
одно значение, выбранное из заданного списка величин <code>'значение1'</code>, <code>'значение2'</code>,
<code>...</code>, <code>NULL</code> или специальная величина ошибки <code>""</code>. Список <code>ENUM</code> может содержать
максимум <code>65535</code> различных величин. See section <A HREF="manual.ru.html#ENUM">6.2.3.3  Тип перечисления <code>ENUM</code></A>.

<A NAME="IDX1048"></A>
<DT><code>SET('значение1','значение2',...)</code>
<DD>
Набор. Объект строки может иметь ноль или более значений, каждое из
которых должно быть выбрано из заданного списка величин <code>'значение1'</code>,
<code>'значение2'</code>, <code>...</code> Список <code>SET</code> может содержать максимум 64 элемента. 
See section <A HREF="manual.ru.html#SET">6.2.3.4  Тип множества <code>SET</code></A>.
</DL>



<H3><A NAME="Numeric_types" HREF="manual.ru_toc.html#Numeric_types">6.2.1  Числовые типы данных</A></H3>

<P>
MySQL поддерживает все числовые типы данных языка SQL92 по стандартам
ANSI/ISO. Они включают в себя типы точных числовых данных (<code>NUMERIC</code>,
<code>DECIMAL</code>, <code>INTEGER</code> и <code>SMALLINT</code>) и типы приближенных числовых данных (<code>FLOAT</code>,
<code>REAL</code> и <code>DOUBLE PRECISION</code>). Ключевое слово <code>INT</code> является синонимом для
<code>INTEGER</code>, а ключевое слово <code>DEC</code> - синонимом для <code>DECIMAL</code>.

</P>
<P>
Типы данных <code>NUMERIC</code> и <code>DECIMAL</code> реализованы в MySQL как один и тот же тип -
это разрешается стандартом SQL92. Они используются для величин, для
которых важно сохранить повышенную точность, например для денежных данных.
Требуемая точность данных и масштаб могут задаваться (и обычно задаются)
при объявлении столбца данных одного из этих типов, например:

</P>

<PRE>
    salary DECIMAL(5,2)
</PRE>

<P>
В этом примере - <code>5</code> (точность) представляет собой общее количество значащих
десятичных знаков, с которыми будет храниться данная величина, а цифра <code>2</code>
(масштаб) задает количество десятичных знаков после запятой.
Следовательно, в этом случае интервал величин, которые могут храниться в
столбце <code>salary</code>, составляет от  <code>-99,99</code> до <code>99,99</code> (в действительности для
данного столбца MySQL обеспечивает возможность хранения чисел вплоть до
<code>999,99</code>, поскольку можно не хранить знак для положительных чисел).

</P>
<P>
В SQL92 по стандарту ANSI/ISO выражение <code>DECIMAL(p)</code> эквивалентно
<code>DECIMAL(p,0)</code>. Аналогично, выражение <code>DECIMAL</code> также эквивалентно
<code>DECIMAL(p,0)</code>, при этом предполагается, что величина  <code>p</code> определяется
конкретной реализацией. В настоящее время MySQL не поддерживает ни одну из
рассматриваемых двух различных форм типов данных <code>DECIMAL/NUMERIC</code>. В общем
случае это не является серьезной проблемой, так как основные преимущества
данных типов состоят в возможности явно управлять как точностью, так и
масштабом представления данных.

</P>
<P>
Величины типов <code>DECIMAL</code> и <code>NUMERIC</code> хранятся как строки, а не как двоичные
числа с плавающей точкой, чтобы сохранить точность представления этих
величин в десятичном виде. При этом используется по одному символу строки
для каждого разряда хранимой величины, для десятичного знака (если <code>масштаб &#62; 0</code>) 
и для знака <samp>`-'</samp> (для отрицательных чисел). Если параметр <code>масштаба</code> равен <code>0</code>,
то величины <code>DECIMAL</code> и <code>NUMERIC</code> не содержат десятичного знака или дробной
части.

</P>
<P>
Максимальный интервал величин <code>DECIMAL</code> и  <code>NUMERIC</code> тот же, что и для типа
<code>DOUBLE</code>, но реальный интервал может быть ограничен выбором значений
параметров <code>точности</code> или <code>масштаба</code> для данного столбца с типом данных <code>DECIMAL</code>
или <code>NUMERIC</code>. Если конкретному столбцу присваивается значение, имеющее
большее количество разрядов после десятичного знака, чем разрешено
параметром <code>масштаба</code>, то данное значение округляется до количества разрядов,
разрешенного  <code>масштаба</code>. Если столбцу с типом <code>DECIMAL</code> или <code>NUMERIC</code>
присваивается значение, выходящее за границы интервала, заданного
значениями <code>точности</code> и <code>масштаба</code> (или принятого по умолчанию), то MySQL
сохранит данную величину со значением соответствующей граничной точки
данного интервала.

</P>
<P>
В качестве расширения стандарта ANSI/ISO  SQL92 MySQL также поддерживает
числовые типы представления данных <code>TINYINT</code>, <code>MEDIUMINT</code> и <code>BIGINT</code>, кратко
описанные в таблице выше. Еще одно расширение указанного стандарта,
поддерживаемое MySQL, позволяет при необходимости указывать количество
показываемых пользователю символов целого числа в круглых скобках,
следующих за базовым ключевым словом данного типа (например <code>INT(4)</code>). Это
необязательное указание количества выводимых символов используется для
дополнения слева выводимых значений, которые содержат символов меньше, чем
заданная ширина столбца, однако не накладывает ограничений ни на диапазон
величин, которые могут храниться в столбце, ни на количество разрядов,
которые могут выводиться для величин, у которых количество символов
превосходит ширину данного столбца. Если дополнительно указан
необязательный атрибут <code>ZEROFILL</code>, свободные позиции по умолчанию
заполняются нолями. Например, для столбца, объявленного как <code>INT(5)</code>
<code>ZEROFILL</code>, величина <code>4</code> извлекается как <code>00004</code>. Следует учитывать, что если в
столбце для целых чисел хранится величина с количеством символов,
превышающим заданную ширину столбца, могут возникнуть проблемы, когда
MySQL будет генерировать временные таблицы для некоторых сложных связей,
так как в подобных случаях MySQL полагает, что данные действительно
поместились в столбец имеющейся ширины.

</P>
<P>
Все типы целочисленных данных могут иметь необязательный и не оговоренный
в стандарте атрибут <code>UNSIGNED</code>. Беззнаковые величины можно использовать для
разрешения записи в столбец только положительных чисел, если необходимо
немного увеличить числовой интервал в столбце.

</P>
<P>
В версии MySQL 4.0.2 числовые типы данных с плавающей точкой также могут
иметь параметр <code>UNSIGNED</code>. Как и в целочисленных типах, этот атрибут
предотвращает хранение в отмеченном столбце отрицательных величин. Но, в
отличие от целочисленных типов, максимальный интервал для величин столбца
остается прежним.

</P>
<P>
Тип <code>FLOAT</code> обычно используется для представления приблизительных числовых
типов данных. Стандарт ANSI/ISO  SQL92 допускает факультативное указание
точности (но не интервала порядка числа) в битах в круглых скобках,
следующих за ключевым словом <code>FLOAT</code>. Реализация MySQL также поддерживает
это факультативное указание точности. При этом если ключевое слово <code>FLOAT</code> в
обозначении типа столбца используется без указания точности, MySQL
выделяет 4 байта для хранения величин в этом столбце. Возможно также иное
обозначение, с двумя числами в круглых скобках за ключевым словом <code>FLOAT</code>. В
этом варианте первое число по-прежнему определяет требования к хранению
величины в байтах, а второе число указывает количество разрядов после
десятичной запятой, которые будут храниться и показываться (как для типов
<code>DECIMAL</code> и <code>NUMERIC</code>). Если в столбец подобного типа попытаться записать
число, содержащее больше десятичных знаков после запятой, чем указано для
данного столбца, то значение величины при ее хранении в MySQL округляется
для устранения излишних разрядов.

</P>
<P>
Для типов <code>REAL</code> и <code>DOUBLE PRECISION</code> не предусмотрены установки точности.
MySQL воспринимает <code>DOUBLE</code> как синоним типа <code>DOUBLE PRECISION</code> - это еще
одно расширение стандарта ANSI/ISO  SQL92. Но, вопреки требованию
стандарта, указывающему, что точность для <code>REAL</code> меньше, чем для <code>DOUBLE 
PRECISION</code>, в  MySQL оба типа реализуются как 8-байтовые числа с плавающей
точкой удвоенной точности (если не установлен ``ANSI-режим''). Чтобы
обеспечить максимальную совместимость, в коде, требующем хранения
приблизительных числовых величин, должны использоваться типы <code>FLOAT</code> или
<code>DOUBLE PRECISION</code> без указаний точности или количества десятичных знаков.

</P>
<P>
Если в числовой столбец попытаться записать величину, выходящую за границы
допустимого интервала для столбца данного типа, то MySQL ограничит
величину до соответствующей граничной точки данного интервала и сохранит
результат вместо исходной величины.

</P>
<P>
Например, интервал столбца <code>INT</code> составляет от <code>-2147483648</code> до <code>2147483647</code>.
Если попытаться записать в столбец <code>INT</code> число <code>-9999999999</code>, то оно будет
усечено до нижней конечной точки интервала и вместо записываемого значения
в столбце будет храниться величина <code>-2147483648</code>. Аналогично, если
попытаться записать число <code>9999999999</code>, то взамен запишется число
<code>2147483647</code>.

</P>
<P>
Если для столбца <code>INT</code> указан параметр <code>UNSIGNED</code>, то величина допустимого
интервала для столбца останется той же, но его граничные точки сдвинутся к
<code>0</code> и <code>4294967295</code>. Если попытаться записать числа <code>-9999999999</code> и <code>9999999999</code>,
то в столбце окажутся величины <code>0</code> и <code>4294967296</code>.

</P>
<P>
Для команд <code>ALTER TABLE</code>, <code>LOAD DATA INFILE</code>, <code>UPDATE</code> и многострочной <code>INSERT</code>
выводится предупреждение, если могут возникнуть преобразования данных
вследствие вышеописанных усечений.

</P>
<TABLE BORDER>
<TR><TD><strong>Тип</strong> </TD><TD> <strong>Байт</strong> </TD><TD> <strong>От</strong> </TD><TD> <strong>До</strong>
</TD></TR>
<TR><TD><code>TINYINT</code> </TD><TD> 1 </TD><TD> -128 </TD><TD> 127
</TD></TR>
<TR><TD><code>SMALLINT</code> </TD><TD> 2 </TD><TD> -32768 </TD><TD> 32767
</TD></TR>
<TR><TD><code>MEDIUMINT</code> </TD><TD> 3 </TD><TD> -8388608 </TD><TD> 8388607
</TD></TR>
<TR><TD><code>INT</code> </TD><TD> 4 </TD><TD> -2147483648 </TD><TD> 2147483647
</TD></TR>
<TR><TD><code>BIGINT</code> </TD><TD> 8 </TD><TD> -9223372036854775808 </TD><TD> 9223372036854775807
</TD></TR>
</TABLE>



<H3><A NAME="Date_and_time_types" HREF="manual.ru_toc.html#Date_and_time_types">6.2.2  Типы данных даты и времени</A></H3>

<P>
<A NAME="IDX1049"></A>
<A NAME="IDX1050"></A>

</P>
<P>
Существуют следующие типы данных даты и времени: <code>DATETIME</code>, <code>DATE</code>,
<code>TIMESTAMP</code>, <code>TIME</code> и <code>YEAR</code>. Каждый из них имеет интервал допустимых значений,
а также значение ``ноль'', которое используется, когда пользователь вводит
действительно недопустимое значение. Отметим, что MySQL позволяет хранить
некоторые не вполне достоверные значения даты, например <code>1999-11-31</code>.
Причина в том, что, по нашему мнению, управление проверкой даты входит в
обязанности конкретного приложения, а не SQL-серверов. Для ускорения
проверки правильности даты MySQL только проверяет, находится ли месяц в
интервале <code>0-12</code> и день в интервале <code>0-31</code>. Данные интервалы начинаются с <code>0</code>,
это сделано для того, чтобы обеспечить для MySQL возможность хранить в
столбцах <code>DATE</code> или <code>DATETIME</code> даты, в которых день или месяц равен нулю. Эта
возможность особенно полезна для приложений, которые предполагают хранение
даты рождения - здесь не всегда известен день или месяц рождения. В таких
случаях дата хранится просто в виде <code>1999-00-00</code> или <code>1999-01-00</code> (при этом не
следует рассчитывать на то, что для подобных дат функции <code>DATE_SUB()</code> или
<code>DATE_ADD</code> дадут правильные значения).

</P>
<P>
Ниже приведены некоторые общие соображения, полезные при работе с типами
данных даты и времени:

</P>

<UL>
MySQL извлекает значения для данного типа даты или времени только в
стандартном формате, но в то же время пытается интерпретировать
разнообразные форматы, которые могут поступать от пользователей
(например, когда задается величина, которой следует присвоить тип даты
или времени или сравнить со значением, имеющим один из этих типов).
Тем не менее, поддерживаются только форматы, описанные в следующих
разделах. Предполагается, что пользователь будет вводить допустимые
значения величин, так как использование величин в других форматах
может дать непредсказуемые результаты.

<LI>

Хотя MySQL пытается интерпретировать значения в нескольких форматах,
во всех случаях ожидается, что крайним слева будет раздел значения
даты, содержащий год. Даты должны задаваться в порядке <code>год-месяц-день</code>
(например, <code>'98-09-04'</code>), а не в порядке <code>месяц-день-год</code> или
<code>день-месяц-год</code>, т.е. не так, как мы их обычно записываем (например
<code>'09-04-98'</code>, <code>'04-09-98'</code>).

<LI>

MySQL автоматически преобразует значение, имеющее тип даты или
времени, в число, если данная величина используется в числовом
контексте, и наоборот.

<LI>

Значение, имеющее тип даты или времени, которое выходит за границы
установленного интервала или является недопустимым для этого типа
данных (см. начало раздела), преобразуется в значение ``ноль'' для
данного типа. (Исключение составляют выходящие за границы
установленного интервала величины типа <code>TIME</code>, которые усекаются до
соответствующей граничной точки заданного интервала <code>TIME</code>). В следующей
таблице представлены форматы значения ``ноль'' для каждого из типов
столбцов:

<TABLE BORDER>
<TR><TD><strong>Тип столбца</strong> </TD><TD> <strong>Значение ``Ноль''</strong>
</TD></TR>
<TR><TD><code>DATETIME</code> </TD><TD> <code>'0000-00-00 00:00:00'</code>
</TD></TR>
<TR><TD><code>DATE</code> </TD><TD> <code>'0000-00-00'</code>
</TD></TR>
<TR><TD><code>TIMESTAMP</code> </TD><TD> <code>00000000000000</code> (длина зависит от количества выводимых символов)
</TD></TR>
<TR><TD><code>TIME</code> </TD><TD> <code>'00:00:00'</code>
</TD></TR>
<TR><TD><code>YEAR</code> </TD><TD> <code>0000</code>
</TD></TR>
</TABLE>

<LI>

Значения ``ноль'' - особые. Для их хранения или ссылок на них можно
явно применять представленные в таблице значения, а можно использовать
<samp>`0'</samp> или <samp>`0'</samp>, что легче в написании.

<LI>

Значения ``ноль'' даты или времени при использовании MyODBC
автоматически конвертируются в <code>NULL</code> в версии MyODBC 2.50.12 и выше,
так как ODBC не оперирует с подобными величинами.
</UL>



<H4><A NAME="Y2K_issues" HREF="manual.ru_toc.html#Y2K_issues">6.2.2.1  Проблема 2000 года и типы данных</A></H4>

<P>
<A NAME="IDX1051"></A>
<A NAME="IDX1052"></A>

</P>
<P>
Ядро MySQL само по себе устойчиво к ``проблеме 2000 года'' (see section <A HREF="manual.ru.html#Year_2000_compliance">1.4.5  Вопросы, связанные с Проблемой-2000</A>), 
но некоторые представленные в MySQL входные
величины могут являться источниками ошибок. Так, любое вводимое значение,
содержащее двухразрядное значение года, является неоднозначным, поскольку
неизвестно столетие. Подобные величины должны быть переведены в
четырехразрядную форму, так как для внутреннего представления года в MySQL
используется 4 разряда.

</P>
<P>
Для типов <code>DATETIME</code>, <code>DATE</code>, <code>TIMESTAMP</code> и <code>YEAR</code> даты с неоднозначным годом
интерпретируются в MySQL по следующим правилам:

</P>

<UL>
<LI>

Величина года в интервале <code>00-69</code> конвертируется в <code>2000-2069</code>.
<LI>

Величина года в интервале <code>70-99</code> конвертируется в <code>1970-1999</code>.
</UL>

<P>
Следует помнить, что эти правила дают только правдоподобные предположения
о том, что ваши данные в действительности означают. Если применяемая MySQL
эвристика не дает правильных величин, необходимо обеспечить
недвусмысленные входные данные, содержащие четырехразрядные величины года.

</P>
<P>
<code>ORDER BY</code> отсортирует двухразрядные <code>YEAR/DATE/DATETIME</code> типы корректно.

</P>
<P>
Необходимо также отметить, что некоторые функции, такие как <code>MIN()</code> и <code>MAX()</code>
будут преобразовывать <code>TIMESTAMP/DATE</code> в число. Это означает, что столбец с
данными типа <code>TIMESTAMP</code>, содержащими год в виде двух разрядов, не будет
правильно работать с указанными функциями. Выход из этого положения
состоит в преобразовании <code>TIMESTAMP/DATE</code> к четырехразрядному формату или
использовании чего-нибудь вроде <code>MIN(DATE_ADD(timestamp,INTERVAL 0 DAYS))</code>.

</P>


<H4><A NAME="DATETIME" HREF="manual.ru_toc.html#DATETIME">6.2.2.2  Типы данных <code>DATETIME</code>, <code>DATE</code> и <code>TIMESTAMP</code></A></H4>

<P>
<A NAME="IDX1053"></A>
<A NAME="IDX1054"></A>
<A NAME="IDX1055"></A>

</P>
<P>
Типы <code>DATETIME</code>, <code>DATE</code> и <code>TIMESTAMP</code> являются родственными типами данных. В
данном разделе описаны их свойства, общие черты и различия.

</P>
<P>
Тип данных <code>DATETIME</code> используется для величин, содержащих информацию как о
дате, так и о времени. MySQL извлекает и выводит величины <code>DATETIME</code> в
формате <code>'YYYY-MM-DD HH:MM:SS'</code>. Поддерживается диапазон величин от
<code>'1000-01-01 00:00:00'</code> до <code>'9999-12-31 23:59:59'</code>. (''поддерживается''
означает, что хотя величины с более ранними временными значениями,
возможно, тоже будут работать, но нет гарантии того, что они будут
правильно храниться и отображаться).

</P>
<P>
Тип <code>DATE</code> используется для величин с информацией только о дате, без части,
содержащей время. MySQL извлекает и выводит величины <code>DATE</code> в формате
<code>'YYYY-MM-DD'</code>. Поддерживается диапазон величин от <code>'1000-01-01'</code> до
<code>'9999-12-31'</code>.

</P>
<P>
Тип столбца <code>TIMESTAMP</code> обеспечивает тип представления данных, который можно
использовать для автоматической записи текущих даты и времени при
выполнении операций <code>INSERT</code> или <code>UPDATE</code>. При наличии нескольких столбцов
типа <code>TIMESTAMP</code> только первый из них обновляется автоматически.

</P>
<P>
Автоматическое обновление первого столбца с типом <code>TIMESTAMP</code> происходит при
выполнении любого из следующих условий:

</P>

<UL>
<LI>

Столбец не указан явно в команде <code>INSERT</code> или <code>LOAD DATA INFILE</code>.

<LI>

Столбец не указан явно в команде <code>UPDATE</code>, и при этом изменяется
величина в некотором другом столбце (следует отметить, что команда
<code>UPDATE</code>, устанавливающая столбец в то же самое значение, которое было
до выполнения команды, не вызовет обновления столбца <code>TIMESTAMP</code>,
поскольку в целях повышения производительности  MySQL игнорирует
подобные обновления при установке столбца в его текущее значение).

<LI>

Величина в столбце <code>TIMESTAMP</code> явно установлена в <code>NULL</code>.
</UL>

<P>
Для остальных (кроме первого) столбцов типа <code>TIMESTAMP</code> также можно задать
установку в значение текущих даты и времени. Для этого необходимо просто
установить столбец в <code>NULL</code> или в <code>NOW()</code>.

</P>
<P>
Любой столбец типа <code>TIMESTAMP</code> (даже первый столбец данного типа) можно
установить в значение, отличное от текущих даты и времени. Это делается
путем явной установки его в желаемое значение. Данное свойство можно
использовать, например, если необходимо установить столбец <code>TIMESTAMP</code> в
значение текущих даты и времени при создании строки, а при последующем
обновлении этой строки значение столбца не должно изменяться:

</P>

<UL>
<LI>

Пусть MySQL автоматически установит значение столбца с типом <code>TIMESTAMP</code>
при создании данной строки. Столбец будет установлен в исходное
состояние со значением текущих даты и времени.

<LI>

При выполнении последующих обновлений других столбцов в данной строке
необходимо явно установить столбец <code>TIMESTAMP</code> в его текущее значение.
</UL>

<P>
Однако, с другой стороны, для этих целей, возможно, будет проще
использовать столбец <code>DATETIME</code>. При создании строки его следует
инициализировать функцией <code>NOW()</code> и оставить в покое при последующих
обновлениях.

</P>
<P>
Величины типа <code>TIMESTAMP</code> могут принимать значения от начала <code>1970</code> года до
некоторого значения в <code>2037</code> году с разрешением в одну секунду. Эти величины
выводятся в виде числовых значений.

</P>
<P>
Формат данных, в котором MySQL извлекает и показывает величины <code>TIMESTAMP</code>,
зависит от количества показываемых символов. Это проиллюстрировано в
приведенной ниже таблице. Полный формат <code>TIMESTAMP</code> составляет 14 десятичных
разрядов, но можно создавать столбцы типа <code>TIMESTAMP</code> и с более короткой
строкой вывода:

</P>
<TABLE BORDER>
<TR><TD><strong>Тип столбца</strong> </TD><TD> <strong>Формат вывода</strong>
</TD></TR>
<TR><TD><code>TIMESTAMP(14)</code> </TD><TD> <code>YYYYMMDDHHMMSS</code>
</TD></TR>
<TR><TD><code>TIMESTAMP(12)</code> </TD><TD> <code>YYMMDDHHMMSS</code>
</TD></TR>
<TR><TD><code>TIMESTAMP(10)</code> </TD><TD> <code>YYMMDDHHMM</code>
</TD></TR>
<TR><TD><code>TIMESTAMP(8)</code> </TD><TD> <code>YYYYMMDD</code>
</TD></TR>
<TR><TD><code>TIMESTAMP(6)</code> </TD><TD> <code>YYMMDD</code>
</TD></TR>
<TR><TD><code>TIMESTAMP(4)</code> </TD><TD> <code>YYMM</code>
</TD></TR>
<TR><TD><code>TIMESTAMP(2)</code> </TD><TD> <code>YY</code>
</TD></TR>
</TABLE>

<P>
Независимо от размера выводимого значения размер данных, хранящихся в
столбцах типа <code>TIMESTAMP</code>, всегда один и тот же. Чаще всего используется
формат вывода с 6, 8, 12 или 14 десятичными знаками. При создании таблицы
можно указать произвольный размер выводимых значений, однако если этот
размер задать равным 0 или превышающим 14, то будет использоваться
значение 14. Нечетные значения размеров в интервале от 1 до 13 будут
приведены к ближайшему большему четному числу.

</P>
<P>
Величины <code>DATETIME</code>, <code>DATE</code> и <code>TIMESTAMP</code> могут быть заданы любым стандартным
набором форматов:

</P>

<UL>
<LI>

Как строка в формате <code>'YYYY-MM-DD HH:MM:SS'</code> или в формате <code>'YY-MM-DD HH:MM:SS'</code>. 
Допускается ``облегченный'' синтаксис - можно использовать
любой знак пунктуации в качестве разделительного между частями
разделов даты или времени. Например, величины <code>'98-12-31 11:30:45'</code>,
<code>'98.12.31 11+30+45'</code>, <code>'98/12/31 11*30*45'</code> и <code>'98@12@31 11^30^45'</code>
являются эквивалентными.

<LI>

Как строка в формате <code>'YYYY-MM-DD'</code> или в формате <code>'YY-MM-DD'</code>. Здесь
также допустим ``облегченный'' синтаксис. Например, величины
<code>'98-12-31'</code>, <code>'98.12.31'</code>, <code>'98/12/31'</code> и <code>'98@12@31'</code> являются
эквивалентными.

<LI>

Как строка без разделительных знаков в формате <code>'YYYYMMDDHHMMSS'</code> или в
формате <code>'YYMMDDHHMMSS'</code>, при условии, что строка понимается как дата.
Например, величины <code>'19970523091528'</code> и <code>'970523091528'</code> можно
интерпретировать как <code>'1997-05-23 09:15:28'</code>, но величина <code>'971122129015'</code>
является недопустимой (значение раздела минут является абсурдным) и
преобразуется в <code>'0000-00-00 00:00:00'</code>.

<LI>

Как строка без разделительных знаков в формате <code>'YYYYMMDD'</code> или в
формате <code>'YYMMDD'</code>, при условии, что строка интерпретируется как дата.
Например, величины <code>'19970523'</code> и <code>'970523'</code> можно интерпретировать как
<code>'1997-05-23'</code>, но величина <code>'971332'</code> является недопустимой (значения
разделов месяца и дня не имеют смысла) и преобразуется в <code>'0000-00-00'</code>.

<LI>

Как число в формате <code>YYYYMMDDHHMMSS</code> или в формате <code>YYMMDDHHMMSS</code>, при
условии, что число интерпретируется как дата. Например, величины
<code>19830905132800</code> и <code>830905132800</code> интерпретируются как <code>'1983-09-05 13:28:00'</code>.

<LI>

Как число в формате <code>YYYYMMDD</code> или в формате <code>YYMMDD</code>, при условии, что
число интерпретируется как дата. Например, величины <code>19830905</code> и <code>830905</code>
интерпретируются как <code>'1983-09-05'</code>.

<LI>

Как результат выполнения функции, возвращающей величину, приемлемую в
контекстах типов данных <code>DATETIME</code>, <code>DATE</code> или <code>TIMESTAMP</code> (например,
функции <code>NOW()</code> или <code>CURRENT_DATE()</code>.
</UL>

<P>
Недопустимые значения величин <code>DATETIME</code>, <code>DATE</code> или <code>TIMESTAMP</code> преобразуются в
значение ``ноль'' соответствующего типа величин (<code>'0000-00-00 00:00:00'</code>,
<code>'0000-00-00'</code>, или <code>00000000000000</code>).

</P>
<P>
Для величин, представленных как строки, содержащие разделительные знаки
между частями даты, нет необходимости указывать два разряда для значений
месяца или дня, меньших, чем <code>10</code>. Так, величина <code>'1979-6-9'</code> эквивалентна
величине <code>'1979-06-09'</code>. Аналогично, для величин, представленных как строки,
содержащие разделительные знаки внутри обозначения времени, нет
необходимости указывать два разряда для значений часов, минут или секунд,
меньших, чем <code>10</code>. Так,

</P>
<P>
Величины, определенные как числа, должны иметь <code>6</code>, <code>8</code>, <code>12</code>, или <code>14</code> десятичных
разрядов. Предполагается, что число, имеющее <code>8</code> или <code>14</code> разрядов,
представлено в форматах <code>YYYYMMDD</code> или <code>YYYYMMDDHHMMSS</code> соответственно, причем
год указан в первых четырех разрядах. Если же длина числа <code>6</code> или <code>12</code>
разрядов, то предполагаются соответственно форматы <code>YYMMDD</code> или
<code>YYMMDDHHMMSS</code>, где год указан в первых двух разрядах. Числа, длина которых
не соответствует ни одному из описанных вариантов, интерпретируются как
дополненные спереди нулями до ближайшей вышеуказанной длины.

</P>
<P>
Величины, представленные строками без разделительных знаков,
интерпретируются с учетом их длины согласно приведенным далее правилам.
Если длина строки равна <code>8</code> или <code>14</code> символам, то предполагается, что год
задан первыми четырьмя символами. В противном случае предполагается, что
год задан двумя первыми символами. Строка интерпретируется слева направо,
при этом определяются значения для года, месяца, дня, часов, минут и
секунд для всех представленных в строке разделов. Это означает, что строка
с длиной меньше, чем <code>6</code> символов, не может быть использована. Например,
если задать строку вида <code>'9903'</code>, полагая, что это будет означать март 1999
года, то MySQL внесет в таблицу ``нулевую'' дату. Год и месяц в данной
записи равны <code>99</code> и <code>03</code> соответственно, но раздел, представляющий день,
пропущен (значение равно нулю), поэтому в целом данная величина не
является достоверным значением даты.

</P>
<P>
При хранении допустимых величин в столбцах типа <code>TIMESTAMP</code> используется
полная точность, указанная при их задании, независимо от количества
выводимых символов. Это свойство имеет несколько следствий:

</P>

<UL>
<LI>

Необходимо всегда указывать год, месяц и день даже для типов
<code>TIMESTAMP(4)</code> или <code>TIMESTAMP(2)</code>. В противном случае задаваемая величина
не будет допустимым значением даты и будет храниться как <code>0</code>.

<LI>

При увеличении ширины узкого столбца <code>TIMESTAMP</code> путем использования
команды <code>ALTER TABLE</code> будет выводиться ранее ``скрытая'' информация.

<LI>

И аналогично, при сужении столбца <code>TIMESTAMP</code> хранимая информация не
будет потеряна, если не принимать во внимание, что при выводе
информации будет выдаваться меньше.

<LI>

Хотя величины <code>TIMESTAMP</code> хранятся с полной точностью, непосредственно
может работать с этим исходным хранимым значением величины только
функция <code>UNIX_TIMESTAMP()</code>. Остальные функции оперируют форматированными
значениями извлеченной величины. Это означает, что нельзя использовать
такие функции, как <code>HOUR()</code> или <code>SECOND()</code>, пока соответствующая часть
величины <code>TIMESTAMP</code> не будет включена в ее форматированное значение.
Например, раздел <code>HH</code> столбца <code>TIMESTAMP</code> не будет выводиться, пока
количество выводимых символов не станет по меньшей мере равным <code>10</code>, так
что попытки использовать <code>HOUR()</code> для более коротких величин <code>TIMESTAMP</code>
приведут к бессмысленным результатам.
</UL>

<P>
Величины одного типа даты можно в ряде случаев присвоить объекту другого
типа даты. Однако при этом возможны некоторое изменение величины или
потеря информации:

</P>

<UL>
<LI>

Если присвоить значение типа <code>DATE</code> объекту <code>DATETIME</code> или <code>TIMESTAMP</code>, то в
результирующей величине ``временная'' часть будет установлена в
<code>'00:00:00'</code>, так как величина <code>DATE</code> не содержит информации о времени.

<LI>

Если присвоить значение типа <code>DATE</code>,  <code>DATETIME</code> или <code>TIMESTAMP</code> объекту
<code>DATE</code>, то ``временная'' часть в результирующей величине будет удалена,
так как тип <code>DATE</code> не включает информацию о времени.

<LI>

Несмотря на то что все величины <code>DATETIME</code>, <code>DATE</code> и <code>TIMESTAMP</code> могут быть
указаны с использованием одного и того же набора форматов, следует
помнить, что указанные типы имеют разные интервалы допустимых
значений. Например, величины типа <code>TIMESTAMP</code> не могут иметь значения
даты более ранние, чем относящиеся к <code>1970</code> году или более поздние, чем
относящиеся к <code>2037</code> году. Это означает, что такая дата, как
<code>'1968-01-01'</code>, будучи разрешенной для величины типа <code>DATETIME</code> или <code>DATE</code>,
недопустима для величины типа <code>TIMESTAMP</code> и будет преобразована в <code>0</code> при
присвоении этому объекту.
</UL>

<P>
Задавая величины даты, следует иметь в виду некоторые ``подводные камни'':

</P>
<P>
<A NAME="IDX1056"></A>
<A NAME="IDX1057"></A>

</P>

<UL>
<LI>

Упрощенный формат, который допускается для величин, заданных строками,
может ввести в заблуждение. Например, такая величина, как <code>'10:11:12'</code>,
благодаря разделителю <samp>`:'</samp> могла бы оказаться величиной времени, но,
используемая в контексте даты, она будет интерпретирована как год
<code>'2010-11-12'</code>. В то же время величина <code>'10:45:15'</code> будет преобразована в
<code>'0000-00-00'</code>, так как для месяца значение <code>'45'</code> недопустимо.

<LI>

Сервер MySQL выполняет только первичную проверку истинности даты: дни
<code>00-31</code>, месяцы <code>00-12</code>, года <code>1000-9999</code>. Любая дата вне этого диапазона
преобразуется в <code>0000-00-00</code>. Следует отметить, что, тем не менее, при
этом не запрещается хранить неверные даты, такие как <code>2002-04-31</code>. Это
позволяет веб-приложениям сохранять данные форм без дополнительной
проверки. Чтобы убедиться в достоверности даты, выполняется проверка в
самом приложении.

<LI>

Величины года, представленные двумя разрядами, допускают неоднозначное
толкование, так как неизвестно столетие. MySQL интерпретирует
двухразрядные величины года по следующим правилам:


<UL>
<LI>

Величины года в интервале <code>00-69</code> преобразуются в <code>2000-2069</code>.
<LI>

Величины года в интервале <code>70-99</code> преобразуются в <code>1970-1999</code>.
</UL>

</UL>



<H4><A NAME="TIME" HREF="manual.ru_toc.html#TIME">6.2.2.3  Тип данных <code>TIME</code></A></H4>

<P>
<A NAME="IDX1058"></A>

</P>
<P>
MySQL извлекает и выводит величины типа <code>TIME</code> в формате <code>'HH:MM:SS'</code> (или в
формате <code>'HHH:MM:SS'</code> для больших значений часов). Величины <code>TIME</code> могут
изменяться в пределах от <code>'-838:59:59'</code> до <code>'838:59:59'</code>. Причина того, что
``часовая'' часть величины может быть настолько большой, заключается в
том, что тип <code>TIME</code> может использоваться не только для представления времени
дня (которое должно быть меньше 24 часов), но также для представления
общего истекшего времени или временного интервала между двумя событиями
(который может быть значительно больше 24 часов или даже отрицательным).

</P>
<P>
Величины <code>TIME</code> могут быть заданы в различных форматах:

</P>

<UL>
Как строка в формате <code>'D HH:MM:SS.дробная часть'</code> (следует учитывать,
что MySQL пока не обеспечивает хранения дробной части величины в
столбце рассматриваемого типа). Можно также использовать одно из
следующих ``облегченных'' представлений: <code>HH:MM:SS.дробная часть</code>,
<code>HH:MM:SS</code>, <code>HH:MM</code>, <code>D HH:MM:SS</code>, <code>D HH:MM</code>, <code>D HH</code> или <code>SS</code>. Здесь <code>D</code> - это
дни из интервала значений <code>0-33</code>.

<LI>

Как строка без разделителей в формате <code>'HHMMSS'</code>, при условии, что
строка интерпретируется как дата. Например, величина <code>'101112'</code>
понимается как <code>'10:11:12'</code>, но величина <code>'109712'</code> будет недопустимой
(значение раздела минут является абсурдным) и преобразуется в
<code>'00:00:00'</code>.

<LI>

Как число в формате <code>HHMMSS</code>, при условии, что строка интерпретируется
как дата. Например, величина <code>101112</code> понимается как <code>'10:11:12'</code>. MySQL
понимает и следующие альтернативные форматы: <code>SS</code>, <code>MMSS</code>, <code>HHMMSS</code>,
<code>HHMMSS.дробная часть</code>. При этом следует учитывать, что хранения дробной
части MySQL пока не обеспечивает.

<LI>

Как результат выполнения функции, возвращающей величину, приемлемую в
контексте типа данных типа <code>TIME</code> (например, такой функции, как
<code>CURRENT_TIME</code>).
</UL>

<P>
Для величин типа  <code>TIME</code>, представленных как строки, содержащие
разделительные знаки между частями значения времени, нет необходимости
указывать два разряда для значений часов, минут или секунд, меньших <code>10</code>.
Так, величина <code>'8:3:2'</code> эквивалентна величине <code>'08:03:02'</code>.

</P>
<P>
Будьте внимательны в отношении использования ``укороченных'' величин <code>TIME</code>
в столбце типа <code>TIME</code>.  MySQL интерпретирует выражения без разделительных
двоеточий исходя из предположения, что крайние справа разряды представляют
секунды (MySQL интерпретирует величины <code>TIME</code> как общее истекшее время, а не
как время дня). Например, можно подразумевать, что величины <code>'1112'</code> и <code>1112</code>
обозначают <code>'11:12:00'</code> (11 часов и 12 минут дня по показаниям часов), но
MySQL понимает их как <code>'00:11:12'</code> (11 минут, 12 секунд). Подобно этому,
<code>'12'</code> и <code>12</code> интерпретируются как <code>'00:00:12'</code>. Величины <code>TIME</code> с разделительными
двоеточиями, наоборот, всегда трактуются как время дня. Т.е. выражение
<code>'11:12'</code> будет пониматься как <code>'11:12:00'</code>, а не <code>'00:11:12'</code>.

</P>
<P>
Величины, лежащие вне разрешенного интервала <code>TIME</code>, но во всем остальном
представляющие собой допустимые значения, усекаются до соответствующей
граничной точки данного интервала. Например, величины <code>'-850:00:00'</code> и
<code>'850:00:00'</code> преобразуются соответственно в <code>'-838:59:59'</code> и <code>'838:59:59'</code>.

</P>
<P>
Недопустимые значения величин <code>TIME</code> преобразуются в значение <code>'00:00:00'</code>.
Отметим, что поскольку выражение <code>'00:00:00'</code> само по себе представляет
разрешенное значение величины <code>TIME</code>, то по хранящейся в таблице величине
<code>'00:00:00'</code> невозможно определить, была ли эта величина изначально задана
как <code>'00:00:00'</code> или является преобразованным значением недопустимой
величины.

</P>


<H4><A NAME="YEAR" HREF="manual.ru_toc.html#YEAR">6.2.2.4  Тип данных  <code>YEAR</code></A></H4>

<P>
<A NAME="IDX1059"></A>

</P>
<P>
Тип <code>YEAR</code> - это однобайтный тип данных для представления значений года.

</P>
<P>
MySQL извлекает и выводит величины <code>YEAR</code> в формате <code>YYYY</code>. Диапазон возможных
значений - от <code>1901</code> до <code>2155</code>.

</P>
<P>
Величины типа <code>YEAR</code> могут быть заданы в различных форматах:

</P>

<UL>
<LI>

Как четырехзначная строка в интервале значений от <code>'1901'</code> до <code>'2155'</code>.

<LI>

Как четырехзначное число в интервале значений от <code>1901</code> до <code>2155</code>.

<LI>

Как двухзначная строка в интервале значений от <code>'00'</code> до <code>'99'</code>. Величины
в интервалах от <code>'00'</code> до <code>'69'</code> и от <code>'70'</code> до <code>'99'</code> при этом преобразуются
в величины <code>YEAR</code> в интервалах от <code>2000</code> до <code>2069</code> и от <code>1970</code> до <code>1999</code>
соответственно.

<LI>

Как двухзначное число в интервале значений от <code>1</code> до <code>99</code>. Величины в
интервалах от <code>1</code> до <code>69</code> и от <code>70</code> до <code>99</code>  при этом преобразуются в величины
<code>YEAR</code> в интервалах от <code>2001</code> до <code>2069</code> и от <code>1970</code> до <code>1999</code> соответственно.
Необходимо принять во внимание, что интервалы для двухзначных чисел и
двухзначных строк несколько различаются, так как нельзя указать
``ноль'' непосредственно как число и интерпретировать его как <code>2000</code>.
Необходимо задать его как строку <code>'0'</code> или <code>'00'</code>, или же оно будет
интерпретировано как <code>0000</code>.

<LI>

Как результат выполнения функции, возвращающей величину, приемлемую в
контексте типа данных <code>YEAR</code> (такой как <code>NOW()</code>).
</UL>

<P>
Недопустимые величины <code>YEAR</code> преобразуются в <code>0000</code>.

</P>


<H3><A NAME="String_types" HREF="manual.ru_toc.html#String_types">6.2.3  Символьные типы данных</A></H3>

<P>
Существуют следующие символьные типы данных: <code>CHAR</code>, <code>VARCHAR</code>, <code>BLOB</code>, <code>TEXT</code>,
<code>ENUM</code> и <code>SET</code>. В данном разделе дается описание их работы, требований к их
хранению и использования их в запросах.

</P>
<TABLE BORDER>
<TR><TD><strong>Тип</strong> </TD><TD> <strong>Макс.размер</strong> </TD><TD> <strong>Байт</strong>
</TD></TR>
<TR><TD><code>TINYTEXT</code>   или <code>TINYBLOB</code> </TD><TD> 2^8-1 </TD><TD> 255
</TD></TR>
<TR><TD><code>TEXT</code>       или <code>BLOB</code> </TD><TD> 2^16-1 (64K-1) </TD><TD> 65535
</TD></TR>
<TR><TD><code>MEDIUMTEXT</code> или <code>MEDIUMBLOB</code> </TD><TD> 2^24-1 (16M-1) </TD><TD> 16777215
</TD></TR>
<TR><TD><code>LONGBLOB</code> </TD><TD> 2^32-1 (4G-1) </TD><TD> 4294967295
</TD></TR>
</TABLE>



<H4><A NAME="CHAR" HREF="manual.ru_toc.html#CHAR">6.2.3.1  Типы данных CHAR и VARCHAR</A></H4>

<P>
<A NAME="IDX1060"></A>
<A NAME="IDX1061"></A>

</P>
<P>
<A NAME="IDX1062"></A>
<A NAME="IDX1063"></A>

</P>
<P>
Типы данных <code>CHAR</code> и <code>VARCHAR</code> очень схожи между собой, но различаются по
способам их хранения и извлечения.

</P>
<P>
В столбце типа <code>CHAR</code> длина поля постоянна и задается при создании таблицы.
Эта длина может принимать любое значение между <code>1</code> и <code>255</code> (что же касается
версии MySQL 3.23, то в ней длина столбца <code>CHAR</code> может быть от <code>0</code> до <code>255</code>).
Величины типа <code>CHAR</code> при хранении дополняются справа пробелами до заданной
длины. Эти концевые пробелы удаляются при извлечении хранимых величин.

</P>
<P>
Величины в столбцах <code>VARCHAR</code> представляют собой строки переменной длины.
Так же как и для столбцов <code>CHAR</code>, можно задать столбец <code>VARCHAR</code> любой длины
между <code>1</code> и <code>255</code>. Однако, в противоположность <code>CHAR</code>, при хранении величин типа
<code>VARCHAR</code> используется только то количество символов, которое необходимо,
плюс один байт для записи длины. Хранимые величины пробелами не
дополняются, наоборот, концевые пробелы при хранении удаляются (описанный
процесс удаления пробелов отличается от предусмотренного спецификацией
ANSI  SQL).

</P>
<P>
Если задаваемая в столбце <code>CHAR</code> или <code>VARCHAR</code> величина превосходит
максимально допустимую длину столбца, то эта величина соответствующим
образом усекается.

</P>
<P>
Различие между этими двумя типами столбцов в представлении результата
хранения величин с разной длиной строки в столбцах <code>CHAR(4)</code> и
<code>VARCHAR(4)</code> проиллюстрировано следующей таблицей:

</P>

<TABLE BORDER>
<TR><TD><strong>Величина</strong> </TD><TD> <code>CHAR(4)</code> </TD><TD> <strong>Требуемая память</strong> </TD><TD> <code>VARCHAR(4)</code> </TD><TD> <strong>Требуемая память</strong>
</TD></TR>
<TR><TD><code>''</code> </TD><TD> <code>'    '</code> </TD><TD> 4 байта </TD><TD> <code>''</code> </TD><TD> 1 байт
</TD></TR>
<TR><TD><code>'ab'</code> </TD><TD> <code>'ab  '</code> </TD><TD> 4 байта </TD><TD> <code>'ab'</code> </TD><TD> 3 байта
</TD></TR>
<TR><TD><code>'abcd'</code> </TD><TD> <code>'abcd'</code> </TD><TD> 4 байта </TD><TD> <code>'abcd'</code> </TD><TD> 5 байтов
</TD></TR>
<TR><TD><code>'abcdefgh'</code> </TD><TD> <code>'abcd'</code> </TD><TD> 4 байта </TD><TD> <code>'abcd'</code> </TD><TD> 5 байтов
</TD></TR>
</TABLE>

<P>
Извлеченные из столбцов <code>CHAR(4)</code> и <code>VARCHAR(4)</code> величины в каждом случае
будут одними и теми же, поскольку при извлечении концевые пробелы из
столбца CHAR удаляются.

</P>
<P>
Если при создании таблицы не был задан атрибут <code>BINARY</code> для столбцов, то
величины в столбцах типа <code>CHAR</code> и <code>VARCHAR</code> сортируются и сравниваются без
учета регистра. При задании атрибута <code>BINARY</code> величины в столбце сортируются
и сравниваются с учетом регистра в соответствии с порядком таблицы ASCII
на том компьютере, где работает сервер MySQL. Атрибут <code>BINARY</code> не влияет на
процессы хранения или извлечения данных из столбца.

</P>
<P>
Атрибут <code>BINARY</code> является ``прилипчивым''. Это значит, что, если в
каком-либо выражении использовать столбец, помеченный как <code>BINARY</code>, то
сравнение всего выражения будет выполняться как сравнение величины типа
<code>BINARY</code>.

</P>
<P>
MySQL может без предупреждения изменить тип столбца <code>CHAR</code> или <code>VARCHAR</code> во
время создания таблицы. See section <A HREF="manual.ru.html#Silent_column_changes">6.5.3.1  Молчаливые изменения определений столбцов</A>.

</P>


<H4><A NAME="BLOB" HREF="manual.ru_toc.html#BLOB">6.2.3.2  Типы данных <code>BLOB</code> и <code>TEXT</code></A></H4>

<P>
<A NAME="IDX1064"></A>
<A NAME="IDX1065"></A>

</P>
<P>
Тип данных <code>BLOB</code> представляет собой двоичный объект большого размера,
который может содержать переменное количество данных. Существуют 4
модификации этого типа - <code>TINYBLOB</code>, <code>BLOB</code>, <code>MEDIUMBLOB</code> и <code>LONGBLOB</code>,
отличающиеся только максимальной длиной хранимых величин.
See section <A HREF="manual.ru.html#Storage_requirements">6.2.6  Требования к памяти для различных типов столбцов</A>.

</P>
<P>
Тип данных <code>TEXT</code> также имеет 4 модификации - <code>TINYTEXT</code>, <code>TEXT</code>, <code>MEDIUMTEXT</code> и
<code>LONGTEXT</code>, соответствующие упомянутым четырем типам <code>BLOB</code> и имеющие те же
максимальную длину и требования к объему памяти. Единственное различие
между типами <code>BLOB</code> и <code>TEXT</code> состоит в том, что сортировка и сравнение данных
выполняются с учетом регистра для величин <code>BLOB</code> и без учета регистра для
величин <code>TEXT</code>. Другими словами, <code>TEXT</code> - это независимый от регистра <code>BLOB</code>.

</P>
<P>
Если размер задаваемого в столбце <code>BLOB</code> или <code>TEXT</code> значения превосходит
максимально допустимую длину столбца, то это значение соответствующим
образом усекается.

</P>
<P>
В большинстве случаев столбец <code>TEXT</code> может рассматриваться как столбец
<code>VARCHAR</code> неограниченного размера. И, аналогично, <code>BLOB</code> - как столбец типа
<code>VARCHAR BINARY</code>. Различия при этом следующие:

</P>

<UL>
<LI>

Столбцы типов <code>BLOB</code> и <code>TEXT</code> могут индексироваться в версии MySQL 3.23.2
и более новых. Более старые версии MySQL не поддерживают индексацию
этих столбцов.

<LI>

В столбцах типов  <code>BLOB</code> и <code>TEXT</code> не производится удаление концевых
символов, как это делается для столбцов типа <code>VARCHAR</code>.

<A NAME="IDX1066"></A>
<A NAME="IDX1067"></A>
<A NAME="IDX1068"></A>
<LI>

Для столбцов <code>BLOB</code> и <code>TEXT</code> не может быть задан атрибут <code>DEFAULT</code> -
значения величин по умолчанию.
</UL>

<P>
В MyODBC величины типа <code>BLOB</code> определяются как <code>LONGVARBINARY</code> и величины типа
TEXT - как <code>LONGVARCHAR</code>.

</P>
<P>
Так как величины типов <code>BLOB</code> и <code>TEXT</code> могут быть чрезмерно большими, при их
использовании целесообразно предусмотреть некоторые ограничения:

</P>

<UL>
Чтобы обеспечить возможность использования команд <code>GROUP BY</code> или <code>ORDER 
BY</code> в столбце типа <code>BLOB</code> или <code>TEXT</code>, необходимо преобразовать значение
столбца в объект с фиксированной длиной. Обычно это делается с помощью
функции <code>SUBSTRING</code>. Например:


<PRE>
mysql&#62; SELECT comment FROM tbl_name,SUBSTRING(comment,20) AS substr
    -&#62; ORDER BY substr;
</PRE>

Если этого не сделать, то операция сортировки в столбце будет выполнена
только для первых байтов, количество которых задается параметром
<code>max_sort_length</code>. Значение по умолчанию величины <code>max_sort_length</code> равно
<code>1024</code>; это значение можно изменить, используя параметр <code>-O</code> сервера <code>mysqld</code>
при его запуске. Группировка выражения, включающего в себя величины <code>BLOB</code>
или <code>TEXT</code>, возможна при указании позиции столбца или использовании
псевдонима:


<PRE>
mysql&#62; SELECT id,SUBSTRING(blob_col,1,100) FROM tbl_name GROUP BY 2;
mysql&#62; SELECT id,SUBSTRING(blob_col,1,100) AS b FROM tbl_name GROUP BY b;
</PRE>

<LI>

Максимальный размер объекта типа <code>BLOB</code> или <code>TEXT</code> определяется его типом,
но наибольшее значение, которое фактически может быть передано между
клиентом и сервером, ограничено величиной доступной памяти и размером
буферов связи. Можно изменить размер буфера блока передачи, но сделать
это необходимо как на стороне сервера, так и на стороне клиента. 
See section <A HREF="manual.ru.html#Server_parameters">5.5.2  Настройка параметров сервера</A>.
</UL>

<P>
Следует учитывать, что внутренним представлением любой величины типа <code>BLOB</code>
или <code>TEXT</code> является отдельно размещенный объект - в противоположность всем
остальным типам столбцов, для которых память выделяется единовременно для
столбца при открытии таблицы.

</P>


<H4><A NAME="ENUM" HREF="manual.ru_toc.html#ENUM">6.2.3.3  Тип перечисления <code>ENUM</code></A></H4>

<P>
<A NAME="IDX1069"></A>

</P>
<P>
ENUM (перечисление) - это столбец, который может принимать значение из списка допустимых значений, явно перечисленных в спецификации столбца в момент создания таблицы. 

</P>
<P>
Этим значением также может быть пустая строка ("") или NULL при определенных условиях:

</P>

<UL>
<LI>

Если делается всавка некорректного значения в столбец ENUM (т.е. вставка строки, не перечисленной в списке допустимых), то вставляется пустая строка, что является указанием на ошибочное значение. Эта строка отличается от "обычной" пустой строки по тому признаку, что она имеет цифровое значение, равное 0. Об этом чуть ниже. 

<LI>

Если ENUM определяется как NULL, то тогда NULL тоже является допустимым значением столбца и значение по умолчанию - NULL. Если ENUM определяется как NOT NULL, то значением по умолчанию является первый элемент из списка допустимых значений.
</UL>

<P>
Каждая величина из допустимы имеет индекс: 

</P>

<UL>
<LI>

Значение из списка допустимых величин, определенных при создании таблицы нумеруются, начиная с 1.

<LI>

Индекс пустой ошибочной строки - 0. Это означает что вы можете использовать следующий SELECT для того, чтобы найти записи, в которые были вставлены некорректные значения ENUM: 


<PRE>
mysql&#62; SELECT * FROM tbl_name WHERE enum_col=0;
</PRE>

<LI>

Индекс значения NULL - NULL. 
</UL>

<P>
Например, столбец, определенный как ENUM("один", "два", "три") может иметь любую из перечисленных величин. Индекс каждой величины также известен: 

</P>
<TABLE BORDER>
<TR><TD><strong>Величина</strong> </TD><TD> <strong>Индекс</strong>
</TD></TR>
<TR><TD><code>NULL</code> </TD><TD> <code>NULL</code>
</TD></TR>
<TR><TD><code>""</code> </TD><TD> 0
</TD></TR>
<TR><TD><code>"один"</code> </TD><TD> 1
</TD></TR>
<TR><TD><code>"два"</code> </TD><TD> 2
</TD></TR>
<TR><TD><code>"три"</code> </TD><TD> 3
</TD></TR>
</TABLE>

<P>
Перечисление может иметь максимум 65535 элементов. 

</P>
<P>
Начиная с 3.23.51, оконечные пробелы автоматически удаляются из величин этого столбца  в момент создания таблицы. 

</P>
<P>
Регистр не играет роли, когда вы делаете вставку в столбец ENUM. Однако регистр значений, получаемых из этого столбца, совпадает с регистром в написании соответствующего значения, заданного во время создания таблицы. 

</P>
<P>
Если вы делаете выборку столбца ENUM в числовом контексте, возвращается индекс значения. Например, вы можете получить численное значение ENUM таким образом: 

</P>

<PRE>
mysql&#62; SELECT enum_col+0 FROM tbl_name;
</PRE>

<P>
Если вы вставляете число в столбец ENUM, это число воспринимается как индекс, и
в таблицу записывается соответствующее этому индексу значение перечисления.
(Однако, это не будет работать с LOAD DATA, который воспринимает все входящие
данные как строки.) Не рекомендуется сохранять числа в перечислении, т.к. это
может привести к излишней путаннице. 

</P>
<P>
Значения перечисления сортируются в соответствии с порядком, в котором
допустимые значения были заданы при создании таблицы. (Другими словами,
значения ENUM сортируются в соответствии с ихними индексами.) Например,
<code>"a"</code> в отсортированном выводе будет присутствовать раньше чем <code>"b"</code>
для <code>ENUM("a", "b")</code>, но <code>"b"</code> появится раньше <code>"a"</code> для
<code>ENUM("b","a")</code>. Пустые строки возвращаются перед непустыми строками, и
NULL-значения будут выведены в самую первую очередь. 

</P>
<P>
Для предотвращения неожиданностей, указывайте список <code>ENUM</code>  в алфавитном
порядке.  Вы также можете использовать <code>GROUP BY CONCAT(col)</code> чтобы
удостовериться, что столбец отсортирован в алфавитном порядке, а не по индексу.

</P>

<P>
Если вам нужно получить список возможных значения для столбца ENUM, вы должны вызвать 
<code>SHOW COLUMNS FROM имя_таблицы LIKE имя_столбца_enum</code> 
и проанализировать определение ENUM во втором столбце. 

</P>



<H4><A NAME="SET" HREF="manual.ru_toc.html#SET">6.2.3.4  Тип множества <code>SET</code></A></H4>

<P>
<A NAME="IDX1070"></A>

</P>
<P>
SET - это строковый тип, который может принимать ноль или более значений, каждое из которых
должно быть выбрано из списка допустимых значений, определенных при создании таблицы. Элементы 
множества SET разделяются запятыми. Как следствие, сами элементы множества не могут содержать 
запятых. 

</P>
<P>
Например, столбец, определенный как <code>SET("один", "два") NOT NULL</code>  может принимать
такие значения: 

</P>

<PRE>
""
"один"
"два"
"один,два"
</PRE>

<P>
Множество SET может иметь максимум 64 различных элемента. 

</P>
<P>
Начиная с 3.23.51, оконечные пробелы удаляются из значений множества SET 
в момент создания таблицы. 

</P>
<P>
MySQL сохраняет значения SET в численном виде, где младший бит сохраненной 
величины соответствует первому элементу множества. Если вы делаете выборку 
столбца SET в числовом контексте, полученное значение содержит соответствующим 
образом установленные биты, создающие значение столбца. Например, вы можете сделать
выборку численного значения SET-столбца таким образом: 

</P>

<PRE>
mysql&#62; SELECT set_col+0 FROM tbl_name;
</PRE>

<P>
Если делается вставка в столбец SET, биты, установленные в двоичном
представлении числа определяют элементы множества. Допустим, столбец определен как
<code>SET("a","b","c","d")</code>.  Тогда элементы имеют такие биты установленными: 

</P>
<TABLE BORDER>
<TR><TD><code>SET</code> <strong>элемент</strong> </TD><TD> <strong>числовое значение</strong> </TD><TD> <strong>двоичное значение</strong>
</TD></TR>
<TR><TD><code>a</code> </TD><TD> <code>1</code> </TD><TD> <code>0001</code>
</TD></TR>
<TR><TD><code>b</code> </TD><TD> <code>2</code> </TD><TD> <code>0010</code>
</TD></TR>
<TR><TD><code>c</code> </TD><TD> <code>4</code> </TD><TD> <code>0100</code>
</TD></TR>
<TR><TD><code>d</code> </TD><TD> <code>8</code> </TD><TD> <code>1000</code>
</TD></TR>
</TABLE>

<P>
Если вы вставляет значение <code>9</code> в этот столбец, это соответствует <code>1001</code> в двоичном представлении,
так что первый (<code>"a"</code>) и четвертый (<code>"d"</code>) элементы множества выбираются, что в результате дает <code>"a,d"</code>.

</P>
<P>
Для значения, содержащего более чем один элемент множестве, не играет никакой роли, в каком
порядке эти элементы перечисляются в момент вставки значения. Также не играет роли,
как много раз то или иное значение перечислено. Когда позже это значение выбирается, каждый
элемент будет присутствовать только единожды, и элементы будут перечислены в том порядке,
в котором они перечисляются в определении таблицы. Например, если столбец определен как
<code>SET("a","b","c","d")</code>, тогда <code>"a,d"</code>, <code>"d,a"</code>, и
<code>"d,a,a,d,d"</code> будут представлены как <code>"a,d"</code>.

</P>

<P>
Если вы вставляете в столбец SET некорректую величины, это значение будет проигнорировано. 

</P>
<P>
SET-значения сортируются в соответствии с числовым представлением. NULL-значения идут в первую очередь.

</P>
<P>
Обычно, следует выполнять <code>SELECT</code> для  SET-столбца, используя оператор <code>LIKE</code> или функцию <code>FIND_IN_SET()</code>:

</P>

<PRE>
mysql&#62; SELECT * FROM tbl_name WHERE set_col LIKE '%value%';
mysql&#62; SELECT * FROM tbl_name WHERE FIND_IN_SET('value',set_col)&#62;0;
</PRE>

<P>
Но и такая форма также работает: 

</P>

<PRE>
mysql&#62; SELECT * FROM tbl_name WHERE set_col = 'val1,val2';
mysql&#62; SELECT * FROM tbl_name WHERE set_col &#38; 1;
</PRE>

<P>
Первый оператор в каждом примере делает выборку точного значения. Второй оператор делает 
выборку значений, содержащих первого элемента множества. 

</P>
<P>
Если вам нужно получить все возможные значения для столбца SET, вам следует вызвать
<code>SHOW COLUMNS FROM table_name LIKE set_column_name</code> 
и проанализировать SET-определение во втором столбце.

</P>


<H3><A NAME="Choosing_types" HREF="manual.ru_toc.html#Choosing_types">6.2.4  Выбор правильного типа данных в столбце</A></H3>

<P>
<A NAME="IDX1071"></A>
<A NAME="IDX1072"></A>

</P>
<P>
Для того чтобы память использовалась наиболее эффективно, всегда следует
стараться применять тип данных, обеспечивающий максимальную точность.
Например, для величин в диапазоне между <code>1</code> и <code>99999</code> в целочисленном столбце
наилучшим типом будет <code>MEDIUMINT UNSIGNED</code>.

</P>
<P>
Часто приходится сталкиваться с такой проблемой, как точное представление
денежных величин. В MySQL для представления таких величин необходимо
использовать тип данных <code>DECIMAL</code>. Поскольку данные этого типа хранятся в
виде строки, потерь в точности не происходит. А в случаях, когда точность
не имеет слишком большого значения, вполне подойдет и тип данных <code>DOUBLE</code>.

</P>
<P>
Если же требуется высокая точность, всегда можно выполнить конвертирование
в тип данных с фиксированной точкой. Такие данные хранятся в виде <code>BIGINT</code>.
Это позволяет выполнять все вычисления с ними как с целыми числами, а
впоследствии при необходимости результаты можно преобразовать обратно в
величины с плавающей точкой.

</P>


<H3><A NAME="Other-vendor_column_types" HREF="manual.ru_toc.html#Other-vendor_column_types">6.2.5  Использование типов столбцов из других баз данных</A></H3>

<P>
<A NAME="IDX1073"></A>
<A NAME="IDX1074"></A>
<A NAME="IDX1075"></A>

</P>
<P>
Чтобы облегчить использование SQL-кода, написанного для баз данных других
поставщиков, в MySQL установлено соответствие типов столбцов, как показано
в следующей таблице. Это соответствие упрощает применение описаний таблиц
баз данных других поставщиков в MySQL:

</P>
<TABLE BORDER>
<TR><TD><strong>Тип иного поставщика</strong> </TD><TD> <strong>Тип MySQL</strong>
</TD></TR>
<TR><TD><code>BINARY(NUM)</code> </TD><TD> <code>CHAR(NUM) BINARY</code>
</TD></TR>
<TR><TD><code>CHAR VARYING(NUM)</code> </TD><TD> <code>VARCHAR(NUM)</code>
</TD></TR>
<TR><TD><code>FLOAT4</code> </TD><TD> <code>FLOAT</code>
</TD></TR>
<TR><TD><code>FLOAT8</code> </TD><TD> <code>DOUBLE</code>
</TD></TR>
<TR><TD><code>INT1</code> </TD><TD> <code>TINYINT</code>
</TD></TR>
<TR><TD><code>INT2</code> </TD><TD> <code>SMALLINT</code>
</TD></TR>
<TR><TD><code>INT3</code> </TD><TD> <code>MEDIUMINT</code>
</TD></TR>
<TR><TD><code>INT4</code> </TD><TD> <code>INT</code>
</TD></TR>
<TR><TD><code>INT8</code> </TD><TD> <code>BIGINT</code>
</TD></TR>
<TR><TD><code>LONG VARBINARY</code> </TD><TD> <code>MEDIUMBLOB</code>
</TD></TR>
<TR><TD><code>LONG VARCHAR</code> </TD><TD> <code>MEDIUMTEXT</code>
</TD></TR>
<TR><TD><code>MIDDLEINT</code> </TD><TD> <code>MEDIUMINT</code>
</TD></TR>
<TR><TD><code>VARBINARY(NUM)</code> </TD><TD> <code>VARCHAR(NUM) BINARY</code>
</TD></TR>
</TABLE>

<P>
Соотнесение типов столбцов происходит во время создания таблицы. При
создании таблицы с типами столбцов, которые используются другими
поставщиками, после запуска команды <code>DESCRIBE имя_таблицы</code> выдается структура
данной таблицы с применением принятых в MySQL эквивалентных типов.

</P>


<H3><A NAME="Storage_requirements" HREF="manual.ru_toc.html#Storage_requirements">6.2.6  Требования к памяти для различных типов столбцов</A></H3>

<P>
<A NAME="IDX1076"></A>
<A NAME="IDX1077"></A>

</P>
<P>
Требования к объему памяти для столбцов каждого типа, поддерживаемого
MySQL, перечислены ниже по категориям.

</P>
<P>
<A NAME="IDX1078"></A>
<A NAME="IDX1079"></A>

</P>
<P>
Требования к памяти для числовых типов

</P>
<TABLE BORDER>
<TR><TD><strong>Тип столбца</strong> </TD><TD> <strong>Требуемая память</strong>
</TD></TR>
<TR><TD><code>TINYINT</code> </TD><TD> 1 byte
</TD></TR>
<TR><TD><code>SMALLINT</code> </TD><TD> 2 байта
</TD></TR>
<TR><TD><code>MEDIUMINT</code> </TD><TD> 3 байта
</TD></TR>
<TR><TD><code>INT</code> </TD><TD> 4 байта
</TD></TR>
<TR><TD><code>INTEGER</code> </TD><TD> 4 байта
</TD></TR>
<TR><TD><code>BIGINT</code> </TD><TD> 8 байтов
</TD></TR>
<TR><TD><code>FLOAT(X)</code> </TD><TD> 4, если X &#60;= 24 или 8, если 25 &#60;= X &#60;= 53
</TD></TR>
<TR><TD><code>FLOAT</code> </TD><TD> 4 байта
</TD></TR>
<TR><TD><code>DOUBLE</code> </TD><TD> 8 байтов
</TD></TR>
<TR><TD><code>DOUBLE PRECISION</code> </TD><TD> 8 байтов
</TD></TR>
<TR><TD><code>REAL</code> </TD><TD> 8 байтов
</TD></TR>
<TR><TD><code>DECIMAL(M,D)</code> </TD><TD> <code>M+2</code> байт, если D &#62; 0, <code>M+1</code> байт, если D = 0 (<code>D</code>+2, если <code>M &#60; D</code>)
</TD></TR>
<TR><TD><code>NUMERIC(M,D)</code> </TD><TD> <code>M+2</code> байт, если D &#62; 0, <code>M+1</code> байт, если D = 0 (<code>D</code>+2, если <code>M &#60; D</code>)
</TD></TR>
</TABLE>

<P>
<A NAME="IDX1080"></A>
<A NAME="IDX1081"></A>
<A NAME="IDX1082"></A>
<A NAME="IDX1083"></A>

</P>
<P>
Требования к памяти для типов даты и времени

</P>
<TABLE BORDER>
<TR><TD><strong>Тип столбца</strong> </TD><TD> <strong>Требуемая память</strong>
</TD></TR>
<TR><TD><code>DATE</code> </TD><TD> 3 байта
</TD></TR>
<TR><TD><code>DATETIME</code> </TD><TD> 8 байтов
</TD></TR>
<TR><TD><code>TIMESTAMP</code> </TD><TD> 4 байта
</TD></TR>
<TR><TD><code>TIME</code> </TD><TD> 3 байта
</TD></TR>
<TR><TD><code>YEAR</code> </TD><TD> 1 байт
</TD></TR>
</TABLE>

<P>
Требования к памяти для символьных типов

</P>

<TABLE BORDER>
<TR><TD><strong>Тип столбца</strong> </TD><TD> <strong>Требуемая память</strong>
</TD></TR>
<TR><TD><code>CHAR(M)</code> </TD><TD> <code>M</code> байт, <code>1 &#60;= M &#60;= 255</code>
</TD></TR>
<TR><TD><code>VARCHAR(M)</code> </TD><TD> <code>L</code>+1 байт, где <code>L &#60;= M</code> и <code>1 &#60;= M &#60;= 255</code>
</TD></TR>
<TR><TD><code>TINYBLOB</code>, <code>TINYTEXT</code> </TD><TD> <code>L</code>+1 байт, где <code>L</code> &#60; 2^8
</TD></TR>
<TR><TD><code>BLOB</code>, <code>TEXT</code> </TD><TD> <code>L</code>+2 байт, где <code>L</code> &#60; 2^16
</TD></TR>
<TR><TD><code>MEDIUMBLOB</code>, <code>MEDIUMTEXT</code> </TD><TD> <code>L</code>+3 байт, где <code>L</code> &#60; 2^24
</TD></TR>
<TR><TD><code>LONGBLOB</code>, <code>LONGTEXT</code> </TD><TD> <code>L</code>+4 байт, где <code>L</code> &#60; 2^32
</TD></TR>
<TR><TD><code>ENUM('value1','value2',...)</code> </TD><TD> 1 или 2 байт, в зависимости от количества перечисляемых величин (максимум 65535)
</TD></TR>
<TR><TD><code>SET('value1','value2',...)</code> </TD><TD> 1, 2, 3, 4 или 8 байт, в зависимости от количества элементов множества (максимум 64)
</TD></TR>
</TABLE>

<P>
<A NAME="IDX1084"></A>
<A NAME="IDX1085"></A>
<A NAME="IDX1086"></A>
<code>VARCHAR</code>, <code>BLOB</code> и <code>TEXT</code> являются типами данных с переменной длиной строки,
для таких типов требования к памяти в общем случае определяются реальным
размером величин в столбце (представлен символом <code>L</code> в приведенной выше
таблице), а не максимально возможным для данного типа размером. Например,
столбец <code>VARCHAR(10)</code> может содержать строку с максимальной длиной <code>10</code>
символов. Реально требуемый объем памяти равен длине строки (<code>L</code>) плюс 1
байт для записи длины строки. Для строки <code>'abcd'</code>  <code>L</code> равно 4 и требуемый
объем памяти равен 5 байтов.

</P>
<P>
В случае типов данных <code>BLOB</code> и <code>TEXT</code> требуется 1, 2, 3 или 4 байта для записи
длины значения данного столбца в зависимости от максимально возможной
длины для данного типа. See section <A HREF="manual.ru.html#BLOB">6.2.3.2  Типы данных <code>BLOB</code> и <code>TEXT</code></A>.

</P>
<P>
Если таблица включает в себя столбец какого-либо типа с переменной длиной
строки, то формат записи также будет переменной длины. Следует учитывать,
что при создании таблицы MySQL может при определенных условиях
преобразовать тип столбца с переменной длиной в тип с постоянной длиной
строки или наоборот. See section <A HREF="manual.ru.html#Silent_column_changes">6.5.3.1  Молчаливые изменения определений столбцов</A>.

</P>
<P>
<A NAME="IDX1087"></A>
Размер объекта <code>ENUM</code> определяется количеством различных перечисляемых 
величин. Один байт используется для перечисления до <code>255</code> возможных величин.
Используя два байта, можно перечислить до <code>65535</code> величин. See section <A HREF="manual.ru.html#ENUM">6.2.3.3  Тип перечисления <code>ENUM</code></A>.

</P>
<P>
<A NAME="IDX1088"></A>
Размер объекта <code>SET</code> определяется количеством различных элементов
множества.  Если это количество равно <code>N</code>, то размер объекта вычисляется
по формуле <code>(N+7)/8</code> и полученное число округляется до <code>1</code>, <code>2</code>,
<code>3</code>, <code>4</code> или <code>8</code> байтов.  Множество <code>SET</code> может иметь
максимум <code>64</code> элемента. See section <A HREF="manual.ru.html#SET">6.2.3.4  Тип множества <code>SET</code></A>.

</P>
<P>
<A NAME="IDX1089"></A>
Максимальный размер записи в MyISAM составляет 65534 байтов. Каждый <code>BLOB</code> или
<code>TEXT</code>-столбец засчитывается здесь как 5-9 байтов. 

</P>


<H2><A NAME="Functions" HREF="manual.ru_toc.html#Functions">6.3  Функции, используемые в операторах <code>SELECT</code> и <code>WHERE</code></A></H2>

<P>
<A NAME="IDX1090"></A>

</P>
<P>
В команде SQL выражение <code>SELECT</code>  или определение  <code>WHERE</code> могут включать в
себя любое выражение, в котором используются описанные ниже функции.

</P>
<P>
Выражение, содержащее <code>NULL</code>, всегда будет давать в результате величину
<code>NULL</code>, если иное не оговорено в документации для операторов и функций,
задействованных в данном выражении.

</P>
<P>
<strong>Примечание:</strong> между именем функции и следующими за ним скобками не должно
быть пробелов. Это поможет синтаксическому анализатору MySQL отличать
вызовы функций от ссылок на таблицы или столбцы, имена которых случайно
окажутся теми же, что и у функций. Однако допускаются пробелы до или после
аргументов.

</P>
<P>
Если нужно, чтобы в MySQL допускались пробелы после имени функции, следует
запустить <code>mysqld</code> с параметром <code>--ansi</code> или использовать <code>CLIENT_IGNORE_SPACE</code>
в <code>mysql_connect()</code>, но в этом случае все имена функций станут
зарезервированными словами. See section <A HREF="manual.ru.html#ANSI_mode">1.9.2  Запуск MySQL в режиме ANSI</A>.

</P>
<P>
В целях упрощения в данной документации результат выполнения программы
<code>mysql</code> в примерах представлен в сокращенной форме. Таким образом вывод:

</P>

<PRE>
mysql&#62; SELECT MOD(29,9);
1 rows in set (0.00 sec)

+-----------+
| mod(29,9) |
+-----------+
|         2 |
+-----------+
</PRE>

<P>
будет представлен следующим образом:

</P>

<PRE>
mysql&#62; SELECT MOD(29,9);
        -&#62; 2
</PRE>



<H3><A NAME="Non-typed_Operators" HREF="manual.ru_toc.html#Non-typed_Operators">6.3.1  Операторы и функции общего назначения</A></H3>



<H4><A NAME="Parentheses" HREF="manual.ru_toc.html#Parentheses">6.3.1.1  Круглые скобки</A></H4>

<P>
<A NAME="IDX1091"></A>
<A NAME="IDX1092"></A>

</P>
<P>
<A NAME="IDX1093"></A>
<A NAME="IDX1094"></A>

</P>


<PRE>
( ... )
</PRE>

<P>
Круглые скобки используются для задания порядка вычислений в выражении.
Например:

</P>


<PRE>
mysql&#62; SELECT 1+2*3;
        -&#62; 7
mysql&#62; SELECT (1+2)*3;
        -&#62; 9
</PRE>



<H4><A NAME="Comparison_Operators" HREF="manual.ru_toc.html#Comparison_Operators">6.3.1.2  Операторы сравнения</A></H4>

<P>
<A NAME="IDX1095"></A>

</P>
<P>
<A NAME="IDX1096"></A>

</P>
<P>
Операторы сравнения дают в результате величину <code>1</code> (истина, TRUE), <code>0</code> (ложь, FALSE) или
<code>NULL</code>. Эти функции работают как с числами, так и со строками. Строки при
необходимости автоматически преобразуются в числа, а числа - в строки (как
в Perl).

</P>
<P>
Операции сравнения в MySQL выполняются по следующим правилам:

</P>

<UL>
<LI>

Если один или оба аргумента - <code>NULL</code>, то и результат сравнения будет
<code>NULL</code>. Справедливо для всех операторов кроме <code>&#60;=&#62;</code>.

<LI>

Если оба аргумента в операторе сравнения являются строками, то они
сравниваются как строки.

<LI>

Если оба аргумента - целые числа, то они сравниваются как целые числа.

<LI>

Шестнадцатеричные величины, если они не сравниваются с числом,
трактуются как строки с двоичными данными.

<LI>

<A NAME="IDX1097"></A>
<A NAME="IDX1098"></A>
Если один из аргументов представляет собой столбец типа <code>TIMESTAMP</code> или
<code>DATETIME</code>, а второй аргумент - константа, то константа перед
выполнением сравнения преобразуется к типу <code>TIMESTAMP</code>. Это сделано для
лучшей совместимости с ODBC.

<LI>

Во всех других случаях аргументы сравниваются как действительные числа
с плавающей точкой.
</UL>

<P>
По умолчанию сравнение строк производится без учета регистра символов с
использованием текущего набора символов (по умолчанию ISO-8859-1 Latin1,
который, к тому же, прекрасно подходит для английского языка).

</P>
<P>
Ниже приведены примеры, иллюстрирующие преобразование строк в числа для
операторов сравнения:

</P>

<PRE>
mysql&#62; SELECT 1 &#62; '6x';
         -&#62; 0
mysql&#62; SELECT 7 &#62; '6x';
         -&#62; 1
mysql&#62; SELECT 0 &#62; 'x6';
         -&#62; 0
mysql&#62; SELECT 0 = 'x6';
         -&#62; 1
</PRE>

<DL COMPACT>

<DT><code>=</code>
<DD>
<A NAME="IDX1099"></A>
 <A NAME="IDX1100"></A>
 
Равно:


<PRE>
mysql&#62; SELECT 1 = 0;
        -&#62; 0
mysql&#62; SELECT '0' = 0;
        -&#62; 1
mysql&#62; SELECT '0.0' = 0;
        -&#62; 1
mysql&#62; SELECT '0.01' = 0;
        -&#62; 0
mysql&#62; SELECT '.01' = 0.01;
        -&#62; 1
</PRE>

<A NAME="IDX1101"></A>
<A NAME="IDX1102"></A>
<A NAME="IDX1103"></A>
<A NAME="IDX1104"></A>
<DT><code>&#60;&#62;</code>
<DD>
<DT><code>!=</code>
<DD>
Не равно:


<PRE>
mysql&#62; SELECT '.01' &#60;&#62; '0.01';
        -&#62; 1
mysql&#62; SELECT .01 &#60;&#62; '0.01';
        -&#62; 0
mysql&#62; SELECT 'zapp' &#60;&#62; 'zappp';
        -&#62; 1
</PRE>

<A NAME="IDX1105"></A>
<A NAME="IDX1106"></A>
<DT><code>&#60;=</code>
<DD>
Меньше или равно:

<PRE>
mysql&#62; SELECT 0.1 &#60;= 2;
        -&#62; 1
</PRE>

<A NAME="IDX1107"></A>
<A NAME="IDX1108"></A>
<DT><code>&#60;</code>
<DD>
Меньше чем:

<PRE>
mysql&#62; SELECT 2 &#60; 2;
        -&#62; 0
</PRE>

<A NAME="IDX1109"></A>
<A NAME="IDX1110"></A>
<DT><code>&#62;=</code>
<DD>
Больше или равно:

<PRE>
mysql&#62; SELECT 2 &#62;= 2;
        -&#62; 1
</PRE>

<A NAME="IDX1111"></A>
<A NAME="IDX1112"></A>
<DT><code>&#62;</code>
<DD>
Больше чем:

<PRE>
mysql&#62; SELECT 2 &#62; 2;
        -&#62; 0
</PRE>

<A NAME="IDX1113"></A>
<A NAME="IDX1114"></A>
<DT><code>&#60;=&#62;</code>
<DD>
NULL-безопасное сравнение (равно):

<PRE>
mysql&#62; SELECT 1 &#60;=&#62; 1, NULL &#60;=&#62; NULL, 1 &#60;=&#62; NULL;
        -&#62; 1 1 0
</PRE>

<A NAME="IDX1115"></A>
<A NAME="IDX1116"></A>
<A NAME="IDX1117"></A>
<DT><code>IS NULL</code>
<DD>
<DT><code>IS NOT NULL</code>
<DD>
Тест для определения, является величина равной <code>NULL</code> или нет:

<PRE>
mysql&#62; SELECT 1 IS NULL, 0 IS NULL, NULL IS NULL;
        -&#62; 0 0 1
mysql&#62; SELECT 1 IS NOT NULL, 0 IS NOT NULL, NULL IS NOT NULL;
        -&#62; 1 1 0
</PRE>

<A NAME="IDX1118"></A>
<A NAME="IDX1119"></A>
Для того, чтобы MySQL хорошо работал с другими программами, обеспечивается
поддержка следующих дополнительных возможностей для функции <code>IS NULL</code>:


<UL>
<LI>

Можно найти последнюю вставленную строку, используя выражение:


<PRE>
SELECT * FROM tbl_name WHERE auto_col IS NULL
</PRE>

Это свойство можно блокировать установкой <code>SQL_AUTO_IS_NULL=0</code>. 
See section <A HREF="manual.ru.html#SET_OPTION">5.5.6  Синтаксис команды <code>SET</code></A>.

<LI>

Для данных типа <code>NOT NULL DATE</code> и столбцов <code>DATETIME</code> можно найти особую
дату <code>0000-00-00</code>, используя выражение:


<PRE>
SELECT * FROM tbl_name WHERE date_column IS NULL
</PRE>

Это необходимо для работы некоторых приложений  ODBC (так как ODBC не
поддерживает значение даты <code>0000-00-00</code>).
</UL>

<A NAME="IDX1120"></A>
<DT><code>expr BETWEEN min AND max</code>
<DD>
Если величина выражения expr больше или равна заданному значению <code>min</code> и
меньше или равна заданному значению <code>max</code>, то функция <code>BETWEEN</code> возвращает <code>1</code>,
в противном случае - <code>0</code>. Это эквивалентно выражению (<code>min &#60;= expr AND expr
&#60;= max</code>), в котором все аргументы представлены одним и тем же типом данных.
В противном случае имеет место быть преобразование типов так, как сказано выше,
но применительно ко всем трем аргументами. <strong>Внимание:</strong> до 4.0.5 аргументы
приводились к типу <code>expr</code>. 


<PRE>
mysql&#62; SELECT 1 BETWEEN 2 AND 3;
        -&#62; 0
mysql&#62; SELECT 'b' BETWEEN 'a' AND 'c';
        -&#62; 1
mysql&#62; SELECT 2 BETWEEN 2 AND '3';
        -&#62; 1
mysql&#62; SELECT 2 BETWEEN 2 AND 'x-3';
        -&#62; 0
</PRE>

<A NAME="IDX1121"></A>
<DT><code>expr NOT BETWEEN min AND max</code>
<DD>
То же справедливо и для функции <code>NOT (expr BETWEEN min AND max)</code>.

<A NAME="IDX1122"></A>
<DT><code>expr IN (value,...)</code>
<DD>
Возвращает <code>1</code>, если выражение expr равно любой величине из списка <code>IN</code>,
иначе - <code>0</code>. Если все величины - константы, то они оцениваются в
соответствии с типом выражения expr и сортируются. Поиск элемента в
этом случае производится методом логического поиска. Это означает, что
функция <code>IN</code> является очень быстрой, если список значений <code>IN</code> состоит
полностью из констант. Если expr является зависимым от регистра
строковым выражением, то сравнение строк производится с учетом
регистра:


<PRE>
mysql&#62; SELECT 2 IN (0,3,5,'wefwf');
        -&#62; 0
mysql&#62; SELECT 'wefwf' IN (0,3,5,'wefwf');
        -&#62; 1
</PRE>

Начиная с 4.1 (в соответствии со стандартом SQL-99), <code>IN</code> возвращает
<code>NULL</code> не только если выражение в левой части является <code>NULL</code>, но
также если не найдено соответствия в списке и одно из выражений в списке
является величиной <code>NULL</code>.

<A NAME="IDX1123"></A>
<DT><code>expr NOT IN (value,...)</code>
<DD>
То же справедливо и для функции <code>NOT (expr IN (value,...))</code>.

<A NAME="IDX1124"></A>
<DT><code>ISNULL(expr)</code>
<DD>
Если <code>expr</code> равно <code>NULL</code>, то <code>ISNULL()</code> возвращает <code>1</code>, в противном случае - <code>0</code>:


<PRE>
mysql&#62; SELECT ISNULL(1+1);
        -&#62; 0
mysql&#62; SELECT ISNULL(1/0);
        -&#62; 1
</PRE>

Обратите внимание: при сравнении величин <code>NULL</code> с использованием оператора <code>=</code>
всегда будет возвращаться значение <code>FALSE</code>!

<A NAME="IDX1125"></A>
<A NAME="IDX1126"></A>
<DT><code>COALESCE(list)</code>
<DD>
Возвращает первый в списке элемент со значением, не равным <code>NULL</code>:


<PRE>
mysql&#62; SELECT COALESCE(NULL,1);
        -&#62; 1
mysql&#62; SELECT COALESCE(NULL,NULL,NULL);
        -&#62; NULL
</PRE>

<A NAME="IDX1127"></A>
<DT><code>INTERVAL(N,N1,N2,N3,...)</code>
<DD>
Возвращает <code>0</code>, если <code>N &#60; N1</code>, и <code>1</code>, если <code>N &#60; N2</code>, и так далее. Все аргументы
трактуются как целые числа. Для корректной работы этой функции необходимо
условие <code>N1 &#60; N2 &#60; N3 &#60; ... &#60; Nn</code>. Это обусловлено тем, что используется
логический поиск (очень быстрый):


<PRE>
mysql&#62; SELECT INTERVAL(23, 1, 15, 17, 30, 44, 200);
        -&#62; 3
mysql&#62; SELECT INTERVAL(10, 1, 10, 100, 1000);
        -&#62; 2
mysql&#62; SELECT INTERVAL(22, 23, 30, 44, 200);
        -&#62; 0
</PRE>

</DL>

<P>
Если регистронезависимая строка сравнивается с помощью любого
стандартного оператора (<code>=,</code> <code>&#60;&#62;</code>, ..., но не <code>LIKE</code>), то конечные пустые символы (т.е. пробелы, табуляторы и переводы строк) игнорируются: 
игнорируется.

</P>

<PRE>
mysql&#62; SELECT "a" ="A \n";
        -&#62; 1
</PRE>



<H4><A NAME="Logical_Operators" HREF="manual.ru_toc.html#Logical_Operators">6.3.1.3  Логические операторы</A></H4>

<P>
<A NAME="IDX1128"></A>
<A NAME="IDX1129"></A>

</P>
<P>
В SQL, все логические операторы возвращают 
TRUE (ИСТИНА), FALSE (ЛОЖЬ) или NULL (UNKNOWN, неизвестно).
В MySQL это реализовано как <code>1</code> (TRUE, ИСТИНА), <code>0</code> (FALSE, ЛОЖЬ)
или <code>NULL</code>. Это справедливо для большинства SQL СУБД, однако некоторые
возвращают любое положительное значение как значение TRUE. 

</P>
<DL COMPACT>

<DT><code>NOT</code>
<DD>
<A NAME="IDX1130"></A>
 <A NAME="IDX1131"></A>
 
<DT><code>!</code>
<DD>
Логическое НЕ. 
Возвращает <code>1</code>, если операнд равен <code>0</code>, <code>0</code> если операнд -
ненулевая величина, и <code>NOT NULL</code> возвращает <code>NULL</code>.


<PRE>
mysql&#62; SELECT NOT 10;
        -&#62; 0
mysql&#62; SELECT NOT 0;
        -&#62; 1
mysql&#62; SELECT NOT NULL;
        -&#62; NULL
mysql&#62; SELECT ! (1+1);
        -&#62; 0
mysql&#62; SELECT ! 1+1;
        -&#62; 1
</PRE>

Последний пример дает <code>1</code>, поскольку данное выражение вычисляется тем же
способом, что и <code>(!1)+1</code>.

<A NAME="IDX1132"></A>
<A NAME="IDX1133"></A>
<DT><code>AND</code>
<DD>
<DT><code>&#38;&#38;</code>
<DD>
Логическое И. 
Дает <code>1</code> если все операнды ненулевые и не <code>NULL</code>, <code>0</code> если один
или более операндов равны <code>0</code>, или <code>NULL</code> в остальных случаях.


<PRE>
mysql&#62; SELECT 1 &#38;&#38; 1;
        -&#62; 1
mysql&#62; SELECT 1 &#38;&#38; 0;
        -&#62; 0
mysql&#62; SELECT 1 &#38;&#38; NULL;
        -&#62; NULL
mysql&#62; SELECT 0 &#38;&#38; NULL;
        -&#62; 0
mysql&#62; SELECT NULL &#38;&#38; 0;
        -&#62; 0
</PRE>

Обратите внимание, что версии MySQL до 4.0.5 прекращали вычисление, встретив
первый <code>NULL</code>, вместо  того, чтобы продолжать вычисление выражений с целью
нахождения возможных значений <code>0</code>. Это означает, что в этих версиях
выражение <code>SELECT (NULL AND 0)</code> возвращает <code>NULL</code> вместо <code>0</code>.  В
4.0.5 код был переписан так, чтобы оптимизация сохранилась, но результат всегда
был таков, как требует того ANSI.

<A NAME="IDX1134"></A>
<A NAME="IDX1135"></A>
<DT><code>OR</code>
<DD>
<DT><code>||</code>
<DD>
Логическое ИЛИ. 
Возвращает <code>1</code>, если любой из операндов не <code>0</code>, <code>NULL</code> если один
из операндов <code>NULL</code>, в остальных случаях возвращает <code>0</code>. 


<PRE>
mysql&#62; SELECT 1 || 1;
        -&#62; 1
mysql&#62; SELECT 1 || 0;
        -&#62; 1
mysql&#62; SELECT 0 || 0;
        -&#62; 0
mysql&#62; SELECT 0 || NULL;
        -&#62; NULL
mysql&#62; SELECT 1 || NULL;
        -&#62; 1
</PRE>

<A NAME="IDX1136"></A>
<DT><code>XOR</code>
<DD>
Логический XOR (побитовое сложение по модулю 2) Возвращает <code>NULL</code> если
любой из операндов - <code>NULL</code>. Для не-<code>NULL</code> операндов, возвращает
<code>1</code> если нечетное количество операндов - не <code>0</code>.


<PRE>
mysql&#62; SELECT 1 XOR 1;
        -&#62; 0
mysql&#62; SELECT 1 XOR 0;
        -&#62; 1
mysql&#62; SELECT 1 XOR NULL;
        -&#62; NULL
mysql&#62; SELECT 1 XOR 1 XOR 1;
        -&#62; 1
</PRE>

<code>a XOR b</code> математически эквалиентно
<code>(a AND (NOT b)) OR ((NOT a) and b)</code>.

<code>XOR</code> был реализован в 4.0.2.

</DL>



<H4><A NAME="Control_flow_functions" HREF="manual.ru_toc.html#Control_flow_functions">6.3.1.4  Функции потока управления программой</A></H4>

<P>
<A NAME="IDX1137"></A>
<A NAME="IDX1138"></A>

</P>
<DL COMPACT>

<DT><code>IFNULL(expr1,expr2)</code>
<DD>
<A NAME="IDX1139"></A>
 <A NAME="IDX1140"></A>
 

Если <code>expr1</code> не равно <code>NULL</code>, то функция <code>IFNULL()</code> возвращает значение <code>expr1</code>, в
противном случае - <code>expr2</code>. В зависимости от контекста функция <code>IFNULL()</code> может
возвращать либо числовое, либо строковое значение:


<PRE>
mysql&#62; SELECT IFNULL(1,0);
        -&#62; 1
mysql&#62; SELECT IFNULL(NULL,10);
        -&#62; 10
mysql&#62; SELECT IFNULL(1/0,10);
        -&#62; 10
mysql&#62; SELECT IFNULL(1/0,'yes');
        -&#62; 'yes'
</PRE>

В 4.0.6 и раньше по умолчанию возвращал для <code>IFNULL(expr1,expr2)</code>
более "общее" из двух выражений в порядке <code>STRING</code>, <code>REAL</code> или
<code>INTEGER</code>.  Разница с более ранними версиями MySQL больше всего заметна
тогда, когда вы создаете таблицу, основанную на выражении или MySQL внутренне
сохраняет величину, основанную на выражении <code>IFNULL()</code> во временной
таблице. 


<PRE>
CREATE TABLE foo SELECT IFNULL(1,"test") as test;
</PRE>

В 4.0.6 тип для столбца "test" - <code>CHAR(4)</code> в то время как на более ранних типом был бы
<code>BIGINT</code>. 

<A NAME="IDX1141"></A>
<DT><code>NULLIF(expr1,expr2)</code>
<DD>
Если выражение <code>expr1 = expr2</code> истинно, то возвращает <code>NULL</code>, в противном
случае - <code>expr1</code>. Эквивалентна оператору <code>CASE WHEN x = y THEN NULL ELSE x
END</code>:


<PRE>
mysql&#62; SELECT NULLIF(1,1);
        -&#62; NULL
mysql&#62; SELECT NULLIF(1,2);
        -&#62; 1
</PRE>

Отметим, что если аргументы не равны, то величина <code>expr1</code> вычисляется в MySQL
дважды.

<A NAME="IDX1142"></A>
<DT><code>IF(expr1,expr2,expr3)</code>
<DD>
Если <code>expr1</code> равно значению ИСТИНА (<code>expr1 &#60;&#62; 0</code> и <code>expr1 &#60;&#62; NULL</code>), то функция
<code>IF()</code> возвращает <code>expr2</code>, в противном случае - <code>expr3</code>. В зависимости от
контекста функция <code>IF()</code> может возвращать либо числовое, либо строковое
значение:


<PRE>
mysql&#62; SELECT IF(1&#62;2,2,3);
        -&#62; 3
mysql&#62; SELECT IF(1&#60;2,'yes','no');
        -&#62; 'yes'
mysql&#62; SELECT IF(STRCMP('test','test1'),'no','yes');
        -&#62; 'no'
</PRE>

Если <code>expr2</code> или <code>expr3</code> являются <code>NULL</code> тогда результирующим
типом <code>IF()</code> будет тип, который не есть <code>NULL</code>. Это нововведение в
MySQL 4.0.3.

<code>expr1</code> вычисляется как целое число; это означает, что при исследовании
чисел с плавающей точкой или строковых величин в этой функции необходимо
использовать операцию сравнения:


<PRE>
mysql&#62; SELECT IF(0.1,1,0);
        -&#62; 0
mysql&#62; SELECT IF(0.1&#60;&#62;0,1,0);
        -&#62; 1
</PRE>

В первом случае из приведенных выше функция <code>IF(0.1)</code> возвращает <code>0</code>, так как
<code>0.1</code> преобразуется в целое число и в результате выполняется функция <code>IF(0)</code>.
Но это вовсе не то, что должно было бы получиться. Во втором случае
исходная величина с плавающей точкой исследуется при помощи оператора
сравнения, чтобы определить, является ли она ненулевой, и в качестве
аргумента функции используется результат сравнения - целое число. В версии
MySQL 3.23 возвращаемый по умолчанию тип функции <code>IF()</code> (это может иметь
значение при сохранении его во временной таблице) вычисляется, как
показано ниже:

<TABLE BORDER>
<TR><TD><strong>Выражение</strong> </TD><TD> <strong>Возвращаемая величина</strong>
</TD></TR>
<TR><TD>expr2 или expr3 возвращает строку </TD><TD> строка
</TD></TR>
<TR><TD>expr2 or  expr3 возвращает величину с плавающей точкой </TD><TD> с плавающей точкой
</TD></TR>
<TR><TD>expr2 or  expr3 возвращает целое число </TD><TD> целое число
</TD></TR>
</TABLE>

Если <code>expr2</code> и <code>expr3</code> являются строками, и обе регистро-независимы,
то и результат является регистро-независимым (начиная с 3.23.51).

<A NAME="IDX1143"></A>
<DT><code>CASE value WHEN [compare-value] THEN result [WHEN [compare-value] THEN result ...] [ELSE result] END</code>
<DD>
<DT><code>CASE WHEN [condition] THEN result [WHEN [condition] THEN result ...] [ELSE result] END</code>
<DD>
В первом варианте возвращается значение <code>result</code>, если <code>value=compare-value</code>.
Во втором - результат для первого указанного условия <code>condition</code>, если оно
истинно. Если соответствующая величина результата не определена, то
возвращается значение <code>result</code>, указанное после оператора <code>ELSE</code>. Если часть
<code>ELSE</code> в выражении отсутствует, возвращается <code>NULL</code>:


<PRE>
mysql&#62; SELECT CASE 1 WHEN 1 THEN "one"
           WHEN 2 THEN "two" ELSE "more" END;
       -&#62; "one"
mysql&#62; SELECT CASE WHEN 1&#62;0 THEN "true" ELSE "false" END;
       -&#62; "true"
mysql&#62; SELECT CASE BINARY "B" WHEN "a" THEN 1 WHEN "b" THEN 2 END;
       -&#62; NULL
</PRE>

</DL>

<P>
Тип возвращаемой величины будет такой же (<code>INTEGER</code>, <code>DOUBLE</code> или <code>STRING</code>),
как и у первой возвращаемой величины (выражение после первого оператора
<code>THEN</code>).

</P>


<H3><A NAME="String_functions" HREF="manual.ru_toc.html#String_functions">6.3.2  Строковые функции</A></H3>

<P>
<A NAME="IDX1144"></A>
<A NAME="IDX1145"></A>

</P>
<P>
Строковые функции возвращают <code>NULL</code>, если длина результата оказывается
больше, чем указано в значении серверного параметра <code>max_allowed_packet</code>.
See section <A HREF="manual.ru.html#Server_parameters">5.5.2  Настройка параметров сервера</A>.

</P>
<P>
Для функций, работающих с позициями в строке, нумерация позиций начинается
с 1.

</P>
<DL COMPACT>

Возвращает значение ASCII-кода крайнего слева символа строки <code>str</code>; <code>0</code> если
<code>str</code> является пустой строкой;  <code>NULL</code>, если <code>str</code> равна <code>NULL</code>:


<PRE>
mysql&#62; SELECT ASCII('2');
        -&#62; 50
mysql&#62; SELECT ASCII(2);
        -&#62; 50
mysql&#62; SELECT ASCII('dx');
        -&#62; 100
</PRE>

См. также функцию <code>ORD()</code>.

<DT><code>ORD(str)</code>
<DD>
<A NAME="IDX1146"></A>
 <A NAME="IDX1147"></A>
 

Если крайний слева символ строки <code>str</code> представляет собой многобайтный
символ, то данная функция возвращает его код, который вычисляется на
основе ASCII-кодов составляющих его символов по формуле: ((первый байт
ASCII-кода)*256+(второй байт ASCII-кода))[*256+третий байт ASCII-кода...].
Если крайний слева символ не является многобайтным, то данная функция
возвращает то же значение, что и ASCII():


<PRE>
mysql&#62; SELECT ORD('2');
        -&#62; 50
</PRE>

<A NAME="IDX1148"></A>
<DT><code>CONV(N,from_base,to_base)</code>
<DD>
Преобразует числа из одной системы счисления в другую. Возвращает
строковое представление числа <code>N</code>, преобразованного из системы счисления с
основой <code>from_base</code> в систему счисления с основой <code>to_base</code>. Если хотя бы один
из аргументов равен <code>NULL</code>, то возвращается <code>NULL</code>. Аргумент <code>N</code>
интерпретируется как целое число, но может быть задан как целое число или
строка. Минимальное значение основы системы счисления равно <code>2</code>, а
максимальное - <code>36</code>. Если аргумент <code>to_base</code> представлен отрицательным числом,
то принимается, что <code>N</code> - число со знаком. В противном случае <code>N</code> трактуется
как беззнаковое число. Функция <code>CONV</code> работает с 64-битовой точностью:


<PRE>
mysql&#62; SELECT CONV("a",16,2);
        -&#62; '1010'
mysql&#62; SELECT CONV("6E",18,8);
        -&#62; '172'
mysql&#62; SELECT CONV(-17,10,-18);
        -&#62; '-H'
mysql&#62; SELECT CONV(10+"10"+'10'+0xa,10,10);
        -&#62; '40'
</PRE>

<A NAME="IDX1149"></A>
<DT><code>BIN(N)</code>
<DD>
Возвращает строку, представляющую двоичную величину <code>N</code>, где <code>N</code> - целое число
большого размера (<code>BIGINT</code>). Эквивалентна функции <code>CONV(N,10,2)</code>. Если <code>N</code> равно
<code>NULL</code>, возвращается <code>NULL</code>:


<PRE>
mysql&#62; SELECT BIN(12);
        -&#62; '1100'
</PRE>

<A NAME="IDX1150"></A>
<DT><code>OCT(N)</code>
<DD>
Возвращает строковое представление восьмеричного значения числа <code>N</code>, где <code>N</code> -
целое число большого размера. Эквивалентно функции <code>CONV(N,10,8)</code>. Если <code>N</code>
равно <code>NULL</code>, возвращается <code>NULL</code>:


<PRE>
mysql&#62; SELECT OCT(12);
        -&#62; '14'
</PRE>

<A NAME="IDX1151"></A>
<DT><code>HEX(N_or_S)</code>
<DD>
Если <code>N_OR_S</code> - число, то возвращается строковое представление
шестнадцатеричного числа <code>N</code>, где <code>N</code> - целое число большого размера (<code>BIGINT</code>).
Эквивалентна функции <code>CONV(N,10,16)</code>. Если <code>N_OR_S</code> - строка, то функция
возвращает шестнадцатеричную строку <code>N_OR_S</code>, где каждый символ в <code>N_OR_S</code>
конвертируется в 2 шестнадцатеричных числа. Является обратной по отношению
к строкам <code>0xff</code>.


<PRE>
mysql&#62; SELECT HEX(255);
        -&#62; 'FF'
mysql&#62; SELECT HEX("abc");
        -&#62; 616263
mysql&#62; SELECT 0x616263;
        -&#62; "abc"
</PRE>

<A NAME="IDX1152"></A>
<DT><code>CHAR(N,...)</code>
<DD>
<code>CHAR()</code> интерпретирует аргументы как целые числа и возвращает строку,
состоящую из символов, соответствующих ASCII-коду этих чисел. Величины
<code>NULL</code> пропускаются:


<PRE>
mysql&#62; SELECT CHAR(77,121,83,81,'76');
        -&#62; 'MySQL'
mysql&#62; SELECT CHAR(77,77.3,'77.3');
        -&#62; 'MMM'
</PRE>

<A NAME="IDX1153"></A>
<DT><code>CONCAT(str1,str2,...)</code>
<DD>
Возвращает строку, являющуюся результатом конкатенации аргументов. Если
хотя бы один из аргументов равен <code>NULL</code>, возвращается  <code>NULL</code>. Может принимать
более 2 аргументов. Числовой аргумент преобразуется в эквивалентную
строковую форму:


<PRE>
mysql&#62; SELECT CONCAT('My', 'S', 'QL');
        -&#62; 'MySQL'
mysql&#62; SELECT CONCAT('My', NULL, 'QL');
        -&#62; NULL
mysql&#62; SELECT CONCAT(14.3);
        -&#62; '14.3'
</PRE>

<A NAME="IDX1154"></A>
<DT><code>CONCAT_WS(separator, str1, str2,...)</code>
<DD>
Функция <code>CONCAT_WS</code>() обозначает <code>CONCAT With Separator</code> (конкатенация с
разделителем) и представляет собой специальную форму функции <code>CONCAT()</code>.
Первый аргумент является разделителем для остальных аргументов.
Разделитель, так же как и остальные аргументы, может быть строкой. Если
разделитель равен <code>NULL</code>, то результат будет <code>NULL</code>. Данная функция будет
пропускать все величины <code>NULL</code> и пустые строки, расположенные после
аргумента-разделителя. Разделитель будет добавляться между строками,
подлежащими конкатенации:


<PRE>
mysql&#62; SELECT CONCAT_WS(",","First name","Second name","Last Name");
        -&#62; 'First name,Second name,Last Name'

mysql&#62; SELECT CONCAT_WS(",","First name",NULL,"Last Name");
        -&#62; 'First name,Last Name'
</PRE>

<A NAME="IDX1155"></A>
<A NAME="IDX1156"></A>
<A NAME="IDX1157"></A>
<A NAME="IDX1158"></A>
<DT><code>LENGTH(str)</code>
<DD>
<DT><code>OCTET_LENGTH(str)</code>
<DD>
<DT><code>CHAR_LENGTH(str)</code>
<DD>
<DT><code>CHARACTER_LENGTH(str)</code>
<DD>
Возвращает длину строки str:


<PRE>
mysql&#62; SELECT LENGTH('text');
        -&#62; 4

mysql&#62; SELECT OCTET_LENGTH('text');
        -&#62; 4
</PRE>

Обратите внимание: для <code>CHAR_LENGTH()</code> и <code>CHARACTER_LENGTH()</code> многобайтные
символы учитываются только однажды.

<A NAME="IDX1159"></A>
<DT><code>BIT_LENGTH(str)</code>
<DD>
Возвращает длину строки <code>str</code> в битах:


<PRE>
mysql&#62; SELECT BIT_LENGTH('text');
        -&#62; 32
</PRE>

<A NAME="IDX1160"></A>
<A NAME="IDX1161"></A>
<DT><code>LOCATE(substr,str)</code>
<DD>
<DT><code>POSITION(substr IN str)</code>
<DD>
Возвращает позицию первого вхождения подстроки <code>substr</code> в строку <code>str</code>. Если
подстрока substr в строке <code>str</code>  отсутствует, возвращается <code>0</code>:


<PRE>
mysql&#62; SELECT LOCATE('bar', 'foobarbar');
        -&#62; 4
mysql&#62; SELECT LOCATE('xbar', 'foobar');
        -&#62; 0
</PRE>

Данная функция поддерживает многобайтные величины. В MySQL 3.23 эта
функция чувствительна к регистру, а в 4.0 она чувствительна к регистру
только в случае, если хотя бы один из аргументов является строкой с
двоичными данными.

<A NAME="IDX1162"></A>
<DT><code>LOCATE(substr,str,pos)</code>
<DD>
Возвращает позицию первого вхождения подстроки <code>substr</code> в строку <code>str</code>,
начиная с позиции <code>pos</code>. Если подстрока <code>substr</code> в строке <code>str</code>  отсутствует,
возвращается <code>0</code>:


<PRE>
mysql&#62; SELECT LOCATE('bar', 'foobarbar',5);
        -&#62; 7
</PRE>

Данная функция поддерживает многобайтные величины. В MySQL 3.23 эта
функция чувствительна к регистру, а в 4.0 она чувствительна к регистру,
только в случае, если хотя бы один из аргументов является строкой с
двоичными данными.

<A NAME="IDX1163"></A>
<DT><code>INSTR(str,substr)</code>
<DD>
Возвращает позицию первого вхождения подстроки <code>substr</code> в строку <code>str</code>. То же,
что и двухаргументная форма функции <code>LOCATE()</code>, за исключением перемены мест
аргументов:


<PRE>
mysql&#62; SELECT INSTR('foobarbar', 'bar');
        -&#62; 4

mysql&#62; SELECT INSTR('xbar', 'foobar');
        -&#62; 0
</PRE>

Данная функция поддерживает многобайтные величины. В MySQL 3.23 эта
функция чувствительна к регистру, а в 4.0 она чувствительна к регистру
только в случае, если хотя бы один из аргументов является строкой с
двоичными данными.

<A NAME="IDX1164"></A>
<DT><code>LPAD(str,len,padstr)</code>
<DD>
Возвращает строку <code>str</code>, которая дополняется слева строкой <code>padstr</code>, пока
строка <code>str</code> не достигнет длины <code>len</code> символов. Если строка <code>str</code> длиннее, чем
<code>len</code>, то она будет укорочена до <code>len</code> символов.


<PRE>
mysql&#62; SELECT LPAD('hi',4,'??');
        -&#62; '??hi'
</PRE>

<A NAME="IDX1165"></A>
<DT><code>RPAD(str,len,padstr)</code>
<DD>
Возвращает строку <code>str</code>, которая дополняется справа строкой <code>padstr</code>, пока
строка <code>str</code> не достигнет длины <code>len</code> символов. Если строка <code>str</code> длиннее, чем
<code>len</code>, то она будет укорочена до <code>len</code> символов.


<PRE>
mysql&#62; SELECT RPAD('hi',5,'?');
        -&#62; 'hi???'
</PRE>

<A NAME="IDX1166"></A>
<DT><code>LEFT(str,len)</code>
<DD>
Возвращает крайние слева <code>len</code> символов из строки <code>str</code>:


<PRE>
mysql&#62; SELECT LEFT('foobarbar', 5);
        -&#62; 'fooba'
</PRE>

Данная функция поддерживает многобайтные величины.

<A NAME="IDX1167"></A>
<DT><code>RIGHT(str,len)</code>
<DD>
Возвращает крайние справа <code>len</code> символов из строки <code>str</code>:


<PRE>
mysql&#62; SELECT RIGHT('foobarbar', 4);
        -&#62; 'rbar'
</PRE>

Данная функция поддерживает многобайтные величины.

<A NAME="IDX1168"></A>
<A NAME="IDX1169"></A>
<DT><code>SUBSTRING(str,pos,len)</code>
<DD>
<DT><code>SUBSTRING(str FROM pos FOR len)</code>
<DD>
<DT><code>MID(str,pos,len)</code>
<DD>
Возвращает подстроку длиной <code>len</code> символов из строки <code>str</code>, начиная от позиции
<code>pos</code>. Существует форма с оператором <code>FROM</code>, для которой используется
синтаксис ANSI  SQL92:


<PRE>
mysql&#62; SELECT SUBSTRING('Quadratically',5,6);
        -&#62; 'ratica'
</PRE>

Данная функция поддерживает многобайтные величины.

<DT><code>SUBSTRING(str,pos)</code>
<DD>
<DT><code>SUBSTRING(str FROM pos)</code>
<DD>
Возвращает подстроку из строки <code>str</code>, начиная с позиции <code>pos</code>:


<PRE>
mysql&#62; SELECT SUBSTRING('Quadratically',5);
        -&#62; 'ratically'

mysql&#62; SELECT SUBSTRING('foobarbar' FROM 4);
        -&#62; 'barbar'
</PRE>

Данная функция поддерживает многобайтные величины.

<A NAME="IDX1170"></A>
<DT><code>SUBSTRING_INDEX(str,delim,count)</code>
<DD>
Возвращает подстроку из строки <code>str</code> перед появлениям <code>count</code> вхождений
разделителя <code>delim</code>. Если <code>count</code> положителен, то возвращается все, что
находится слева от последнего разделителя (считая слева). Если <code>count</code>
отрицателен, то возвращается все, что находится справа от последнего
разделителя (считая справа):


<PRE>
mysql&#62; SELECT SUBSTRING_INDEX('www.mysql.com', '.', 2);
        -&#62; 'www.mysql'

mysql&#62; SELECT SUBSTRING_INDEX('www.mysql.com', '.', -2);
        -&#62; 'mysql.com'
</PRE>

Данная функция поддерживает многобайтные величины.

<A NAME="IDX1171"></A>
<DT><code>LTRIM(str)</code>
<DD>
Возвращает строку <code>str</code> с удаленными начальными пробелами:


<PRE>
mysql&#62; SELECT LTRIM(' barbar');
        -&#62; 'barbar'
</PRE>

Данная функция поддерживает многобайтные величины.

<A NAME="IDX1172"></A>
<DT><code>RTRIM(str)</code>
<DD>
Возвращает строку <code>str</code> с удаленными конечными пробелами:


<PRE>
mysql&#62; SELECT RTRIM('barbar ');
        -&#62; 'barbar'
</PRE>

Данная функция поддерживает многобайтные величины.

<A NAME="IDX1173"></A>
<DT><code>TRIM([[BOTH | LEADING | TRAILING] [remstr] FROM] str)</code>
<DD>
Возвращает строку <code>str</code> с удаленными всеми префиксами и/или суффиксами,
указанными в <code>remstr</code>. Если не указан ни один из спецификаторов <code>BOTH</code>,
<code>LEADING</code> или <code>TRAILING</code>, то подразумевается <code>BOTH</code>. Если аргумент <code>remstr</code> не
задан, то удаляются пробелы:


<PRE>
mysql&#62; SELECT TRIM(' bar ');
        -&#62; 'bar'

mysql&#62; SELECT TRIM(LEADING 'x' FROM 'xxxbarxxx');
        -&#62; 'barxxx'

mysql&#62; SELECT TRIM(BOTH 'x' FROM 'xxxbarxxx');
        -&#62; 'bar'

mysql&#62; SELECT TRIM(TRAILING 'xyz' FROM 'barxxyz');
        -&#62; 'barx'
</PRE>

Данная функция поддерживает многобайтные величины.

<A NAME="IDX1174"></A>
<DT><code>SOUNDEX(str)</code>
<DD>
Возвращает саундекс от str. 

<em>Soundex - ``идентификатор звучания строки''. Словосочетания 
``К скалам бурым'' и ``С каламбуроми'' должны давать одинаковый 
саундекс, т.к. на слух они звучат одинаково. Заметим, однако,
что этой функции для русского языка не существует. MySQL нуждается 
в ней, и если кто-то может предоставить алгоритм саундекса на русском 
языке - свяжитесь с нами. - Прим. переводчика.</em>

Две созвучные строки, создающие впечатление почти одинаковых, могут иметь
идентичные саундексы. Обычно стандартная саундекс-строка имеет длину 4
символа, но функция <code>SOUNDEX()</code> возвращает строку произвольной длины. Можно
использовать функцию <code>SUBSTRING()</code> для извлечения стандартного саундекса
строки из результата функции <code>SOUNDEX()</code>. В строке <code>str</code> игнорируются все
символы, не являющиеся буквами или цифрами. Все международные буквенные
символы, не входящие в диапазон <code>A-Z</code>, трактуются как гласные:


<PRE>
mysql&#62; SELECT SOUNDEX('Hello');
        -&#62; 'H400'

mysql&#62; SELECT SOUNDEX('Quadratically');
        -&#62; 'Q36324'
</PRE>

<A NAME="IDX1175"></A>
<DT><code>SPACE(N)</code>
<DD>
Возвращает строку, состоящую из <code>N</code> пробелов:


<PRE>
mysql&#62; SELECT SPACE(6);
        -&#62; ' '
</PRE>

<A NAME="IDX1176"></A>
<DT><code>REPLACE(str,from_str,to_str)</code>
<DD>
Возвращает строку  <code>str</code>, в которой все вхождения строки <code>from_str</code> заменены
на <code>to_str</code>:


<PRE>
mysql&#62; SELECT REPLACE('www.mysql.com', 'w', 'Ww');
        -&#62; 'WwWwWw.mysql.com'
</PRE>

Данная функция поддерживает многобайтные величины.

<A NAME="IDX1177"></A>
<DT><code>REPEAT(str,count)</code>
<DD>
Возвращает строку, состоящую из строки <code>str</code>, повторенной <code>count</code> раз. Если
значение <code>count &#60;= 0</code>, возвращает пустую строку. Возвращает <code>NULL</code>, если <code>str</code>
или <code>count</code> равны <code>NULL</code>:


<PRE>
mysql&#62; SELECT REPEAT('MySQL', 3);
        -&#62; 'MySQLMySQLMySQL'
</PRE>

<A NAME="IDX1178"></A>
<DT><code>REVERSE(str)</code>
<DD>
Возвращает строку  <code>str</code> с обратным порядком символов:


<PRE>
mysql&#62; SELECT REVERSE('abc');
        -&#62; 'cba'
</PRE>

Данная функция поддерживает многобайтные величины.

<A NAME="IDX1179"></A>
<DT><code>INSERT(str,pos,len,newstr)</code>
<DD>
Возвращает строку  <code>str</code>, в которой подстрока начиная с позиции <code>pos</code>, имеющая
длину <code>len</code> замещена на <code>newstr</code>:


<PRE>
mysql&#62; SELECT INSERT('Quadratic', 3, 4, 'What');
        -&#62; 'QuWhattic'
</PRE>

Данная функция поддерживает многобайтные величины.

<A NAME="IDX1180"></A>
<DT><code>ELT(N,str1,str2,str3,...)</code>
<DD>
Возвращает <code>str1</code>, если <code>N = 1</code>, <code>str2</code>, если <code>N = 2</code>, и так далее. Если <code>N</code> меньше,
чем <code>1</code> или больше, чем число аргументов, возвращается <code>NULL</code>. Функция <code>ELT()</code>
является дополненительной по отношению к функции <code>FIELD()</code>:


<PRE>
mysql&#62; SELECT ELT(1, 'ej', 'Heja', 'hej', 'foo');
        -&#62; 'ej'

mysql&#62; SELECT ELT(4, 'ej', 'Heja', 'hej', 'foo');
        -&#62; 'foo'
</PRE>

<A NAME="IDX1181"></A>
<DT><code>FIELD(str,str1,str2,str3,...)</code>
<DD>
Возвращает индекс строки <code>str</code> в списке <code>str1, str2, str3, ...</code>. Если строка
<code>str</code> не найдена, возвращается <code>0</code>. Функция <code>FIELD()</code> является дополнительной по
отношению к функции <code>ELT()</code>:


<PRE>
mysql&#62; SELECT FIELD('ej', 'Hej', 'ej', 'Heja', 'hej', 'foo');
        -&#62; 2

mysql&#62; SELECT FIELD('fo', 'Hej', 'ej', 'Heja', 'hej', 'foo');
        -&#62; 0
</PRE>

<A NAME="IDX1182"></A>
<DT><code>FIND_IN_SET(str,strlist)</code>
<DD>
Возвращает значение от <code>1</code> до <code>N</code>, если строка <code>str</code> присутствует в списке
<code>strlist</code>, состоящем из <code>N</code> подстрок. Список строк представляет собой строку,
состоящую из подстрок, разделенных символами <samp>`,'</samp>. Если первый аргумент
представляет собой строку констант, а второй является столбцом типа <code>SET</code>,
функция <code>FIND_IN_SET()</code> оптимизируется для использования двоичной
арифметики! Возвращает <code>0</code>, если <code>str</code> отсутствует в списке <code>strlist</code> или если
<code>strlist</code> является пустой строкой. Если один из аргументов равен <code>NULL</code>,
возвращается <code>0</code>. Данная функция не будет корректно работать, если первый
аргумент содержит символ <samp>`,'</samp>:


<PRE>
mysql&#62; SELECT FIND_IN_SET('b','a,b,c,d');
        -&#62; 2
</PRE>

<A NAME="IDX1183"></A>
<DT><code>MAKE_SET(bits,str1,str2,...)</code>
<DD>
Возвращает множество (строку, содержащую подстроки, разделенные символами
<samp>`,'</samp>), состоящее из строк, имеющих соответствующий бит в наборе <code>bits</code>.
Аргумент <code>str1</code> соответствует биту <code>0</code>, <code>str2</code> - биту <code>1</code>, и так далее. Нулевые
строки в наборах <code>str1</code>, <code>str2</code>, <code>...</code> не прибавляются к результату:


<PRE>
mysql&#62; SELECT MAKE_SET(1,'a','b','c');
        -&#62; 'a'

mysql&#62; SELECT MAKE_SET(1 | 4,'hello','nice','world');
        -&#62; 'hello,world'

mysql&#62; SELECT MAKE_SET(0,'a','b','c');
        -&#62; ''
</PRE>

<A NAME="IDX1184"></A>
<DT><code>EXPORT_SET(bits,on,off,[separator,[number_of_bits]])</code>
<DD>
Возвращает строку, где для каждому установленному биту в аргументе <code>bits</code>
соответствует строка  <code>on</code>, а каждому сброшенному биту - <code>off</code>.
Каждая строка отделена разделителем, указанным в параметре <code>separator</code> (по
умолчанию - <samp>`,'</samp>), причем используется только количество битов, заданное
аргументом <code>number_of_bits</code>  (по умолчанию 64), из всего количества,
указанного в <code>bits</code>:


<PRE>
mysql&#62; SELECT EXPORT_SET(5,'Y','N',',',4)
        -&#62; Y,N,Y,N
</PRE>

<A NAME="IDX1185"></A>
<A NAME="IDX1186"></A>
<DT><code>LCASE(str)</code>
<DD>
<DT><code>LOWER(str)</code>
<DD>
Возвращает строку <code>str</code>, в которой все символы переведены в нижний регистр
в соответствии с текущей установкой набора символов (по умолчанию -
ISO-8859-1 Latin1):


<PRE>
mysql&#62; SELECT LCASE('QUADRATICALLY');
        -&#62; 'quadratically'
</PRE>

Данная функция поддерживает многобайтные величины.

<A NAME="IDX1187"></A>
<A NAME="IDX1188"></A>
<DT><code>UCASE(str)</code>
<DD>
<DT><code>UPPER(str)</code>
<DD>
Возвращает строку <code>str</code>, в которой все символы переведены в верхний регистр
в соответствии с текущей установкой набора символов (по умолчанию -
ISO-8859-1 Latin1):


<PRE>
mysql&#62; SELECT UCASE('Hej');
        -&#62; 'HEJ'
</PRE>

Данная функция поддерживает многобайтные величины.

<A NAME="IDX1189"></A>
<DT><code>LOAD_FILE(file_name)</code>
<DD>
Читает заданный файл и возвращает его содержимое в виде строки. Данный
файл должен находится на сервере, должен быть указан полный путь к этому
файлу и пользователь должен обладать привилегией <code>FILE</code>. Размер данного
файла должен быть меньше указанного в <code>max_allowed_packet</code> и файл должен
быть открыт для чтения для всех. Если файл не существует или не может быть
прочитан по одной из вышеупомянутых причин, то функция возвращает <code>NULL</code>:


<PRE>
mysql&#62; UPDATE tbl_name 
       SET blob_column=LOAD_FILE("/tmp/picture")
       WHERE id=1;
</PRE>

При использовании версии MySQL, отличной от 3.23, чтение файла
необходимо выполнять внутри вашего приложения и использовать команду
<code>INSERT</code> для внесения в базу данных информации, содержащейся в файле. Один
из путей реализации этого с использованием библиотеки <code>MySQL++</code> можно найти
на <a HREF="http://www.mysql.com/documentation/mysql++/mysql++-examples.html">http://www.mysql.com/documentation/mysql++/mysql++-examples.html</a>.

<A NAME="IDX1190"></A>
<DT><code>QUOTE(str)</code>
<DD>
Экранирует строку с тем, чтобы получить корректное значение для SQL-выражения. 
Строка заключается в одинарные кавычки, и каждое вхождение одинарной кавычки (<samp>`''</samp>),
обратного слеша (<samp>`\'</samp>), значения ASCII NUL и Control-Z экранируются обратным слешом. 
Если аргумент - <code>NULL</code>, то тогда результатом будет слово "NULL" без окружающих кавычек. 


<PRE>
mysql&#62; SELECT QUOTE("Don't");
        -&#62; 'Don\'t!'
mysql&#62; SELECT QUOTE(NULL);
        -&#62; NULL
</PRE>

</DL>

<P>
MySQL при необходимости автоматически конвертирует числа в строки и
наоборот:

</P>

<PRE>
mysql&#62; SELECT 1+"1";
        -&#62; 2

mysql&#62; SELECT CONCAT(2,' test');
        -&#62; '2 test'
</PRE>

<P>
Для преобразования числа в строку явным образом, необходимо передать его в
качестве аргумента функции <code>CONCAT()</code>.

</P>
<P>
Если строковая функция содержит в качестве аргумента строку с двоичными
данными, то и результирующая строка также будет строкой с двоичными
данными. При этом число, конвертированное в строку, воспринимается как
строка с двоичными данными. Это имеет значение только при выполнении
операций сравнения.

</P>



<H4><A NAME="String_comparison_functions" HREF="manual.ru_toc.html#String_comparison_functions">6.3.2.1  Функции сравнения строк</A></H4>

<P>
<A NAME="IDX1191"></A>
<A NAME="IDX1192"></A>

</P>
<P>
<A NAME="IDX1193"></A>
<A NAME="IDX1194"></A>

</P>
<P>
Обычно если при выполнении сравнения строк одно из выражений является
зависимым от регистра, то сравнение выполняется также с учетом регистра.

</P>
<DL COMPACT>

<DT><code>expr LIKE pat [ESCAPE 'escape-char']</code>
<DD>
<A NAME="IDX1195"></A>
 

Функция производит сравнение с шаблоном, используя операции сравнения
простых регулярных выражений в SQL. Возвращает <code>1</code> (ИСТИНА) или <code>0</code> (ЛОЖЬ).
Выражение <code>LIKE</code> предусматривает использование следующих двух шаблонных
символов в <code>pat</code>:

<TABLE BORDER>
<TR><TD><strong>Символ</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD><code>%</code> </TD><TD> Соответствует любому количеству символов, даже нулевых
</TD></TR>
<TR><TD><code>_</code> </TD><TD> Соответствует ровно одному символу
</TD></TR>
</TABLE>


<PRE>
mysql&#62; SELECT 'David!' LIKE 'David_';
        -&#62; 1
mysql&#62; SELECT 'David!' LIKE '%D%v%';
        -&#62; 1
mysql&#62; select TRUNCATE(-1.999,1);
        -&#62; -1.9
</PRE>

Начиная с MySQL 3.23.51 все числа округляются к нулю. 

Если <code>D</code> является негативным, то тогда вся часть числа округляется к нулю. 


<PRE>
mysql&#62; select truncate(122,-2);
       -&#62; 100
</PRE>

Если требуется исследовать литералы при помощи шаблонного символа, следует
предварить шаблонный символ экранирующим символом. Если экранирующий
символ конкретно не указывается, то подразумевается применение символа
<samp>`\'</samp>:

<TABLE BORDER>
<TR><TD><strong>Строка</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD><code>\%</code> </TD><TD> Соответствует одному символу <samp>`%'</samp>
</TD></TR>
<TR><TD><code>\_</code> </TD><TD> Соответствует одному символу <samp>`_'</samp>
</TD></TR>
</TABLE>


<PRE>
mysql&#62; SELECT 'David!' LIKE 'David\_';
        -&#62; 0

mysql&#62; SELECT 'David_' LIKE 'David\_';
        -&#62; 1
</PRE>

Для указания конкретного экранирующего символа используется выражение
<code>ESCAPE</code>:


<PRE>
mysql&#62; SELECT 'David_' LIKE 'David|_' ESCAPE '|';
        -&#62; 1
</PRE>

В следующих двух примерах показано, что сравнение строк производится с
учетом регистра, если ни один из операндов не является строкой с двоичными
данными:


<PRE>
mysql&#62; SELECT 'abc' LIKE 'ABC';
        -&#62; 1
mysql&#62; SELECT 'abc' LIKE BINARY 'ABC';
        -&#62; 0
</PRE>

В функции <code>LIKE</code> допускаются даже числовые выражения! (Это расширение MySQL
по сравнению с ANSI  SQL  LIKE.)


<PRE>
mysql&#62; SELECT 10 LIKE '1%';
        -&#62; 1
</PRE>

Примечание: поскольку в MySQL применяются правила экранирования в строках,
применяемые в языке C (например, <samp>`\n'</samp>), необходимо дублировать все символы
<samp>`\'</samp>, используемые в строках функции <code>LIKE</code>. Например, для поиска сочетания
символов <samp>`\n'</samp> его необходимо указать как  <samp>`\\n'</samp>. Чтобы выполнить поиск
символа <samp>`\'</samp>, он должен быть указан как <samp>`\\\\'</samp> (обратные слеши удаляются
дважды: сначала синтаксическим анализатором, а потом - при выполнении
сравнения с шаблоном, таким образом остается только один обратный слеш,
который и будет обрабатываться).

<A NAME="IDX1196"></A>
<DT><code>expr NOT LIKE pat [ESCAPE 'escape-char']</code>
<DD>
То же, что и <code>NOT (expr LIKE pat [ESCAPE 'escape-char'])</code>.

<A NAME="IDX1197"></A>
<DT><code>expr SOUNDS LIKE expr</code>
<DD>
Тоже самое что и <code>SOUNDEX(expr)=SOUNDEX(expr)</code> (доступно в версии 4.1 или новее). 

<A NAME="IDX1198"></A>
<A NAME="IDX1199"></A>
<A NAME="IDX1200"></A>
<A NAME="IDX1201"></A>
<DT><code>expr REGEXP pat</code>
<DD>
<DT><code>expr RLIKE pat</code>
<DD>
Выполняет сравнение строкового выражения <code>expr</code> с шаблоном <code>pat</code>. Шаблон может
представлять собой расширенное регулярное выражение. See section <A HREF="manual.ru.html#Regexp">F  Регулярные выражения в MySQL</A>. Возвращает <code>1</code>, если <code>expr</code> соответствует <code>pat</code>, в
противном случае - <code>0</code>. Функция <code>RLIKE</code> является синонимом для <code>REGEXP</code>, она
предусмотрена для совместимости с mSQL. Примечание: поскольку в MySQL
используются правила экранирования в строках, применяемые в языке C
(например, <samp>`\n'</samp>), необходимо дублировать все символы <samp>`\'</samp>, используемые в
строках функции <code>REGEXP</code>. Что касается версии MySQL 3.23.4, функция <code>REGEXP</code>
является независимой от регистра для нормальных строк (т.е. строк не с
двоичными данными):


<PRE>
mysql&#62; SELECT 'Monty!' REGEXP 'm%y%%';
        -&#62; 0

mysql&#62; SELECT 'Monty!' REGEXP '.*';
        -&#62; 1

mysql&#62; SELECT 'new*\n*line' REGEXP 'new\\*.\\*line';
        -&#62; 1

mysql&#62; SELECT "a" REGEXP "A", "a" REGEXP BINARY "A";
        -&#62; 1 0

mysql&#62; SELECT "a" REGEXP "^[a-d]";
        -&#62; 1
</PRE>

В <code>REGEXP</code> и <code>RLIKE</code> используется текущий набор символов (ISO-8859-1 Latin1 по
умолчанию),

<A NAME="IDX1202"></A>
<DT><code>expr NOT REGEXP pat</code>
<DD>
<DT><code>expr NOT RLIKE pat</code>
<DD>
То же, что и <code>NOT (expr REGEXP pat)</code>.

<A NAME="IDX1203"></A>
<DT><code>STRCMP(expr1,expr2)</code>
<DD>
Функция <code>STRCMP()</code> возвращает: <code>0</code>, если строки идентичны, <code>-1</code> - если первый
аргумент меньше второго (в соответствии с имеющимся порядком сортировки),
и <code>1</code> - в остальных случаях:


<PRE>
mysql&#62; SELECT STRCMP('text', 'text2');
        -&#62; -1

mysql&#62; SELECT STRCMP('text2', 'text');
        -&#62; 1

mysql&#62; SELECT STRCMP('text', 'text');
        -&#62; 0
</PRE>

<A NAME="IDX1204"></A>
<DT><code>MATCH (col1,col2,...) AGAINST (expr)</code>
<DD>
<DT><code>MATCH (col1,col2,...) AGAINST (expr IN BOOLEAN MODE)</code>
<DD>
Функция <code>MATCH ... AGAINST()</code> используется для полнотекстового поиска и
возвращает величину релевантности - степень сходства между текстом в
столбцах <code>(col1,col2,...)</code> и запросом <code>expr</code>. Величина релевантности
представляет собой положительное число с плавающей точкой. Нулевая
релевантность означает отсутствие сходства. Функция <code>MATCH ... AGAINST()</code>
работает в версиях MySQL 3.23.23 или более поздних. Расширение <code>IN BOOLEAN
MODE</code> было добавлено в версии 4.0.1. Более подробное описание и примеры
использования приведены в разделе section <A HREF="manual.ru.html#Fulltext_Search">6.8  Полнотекстовый поиск в MySQL</A>.
</DL>



<H4><A NAME="Case_Sensitivity_Operators" HREF="manual.ru_toc.html#Case_Sensitivity_Operators">6.3.2.2  Чувствительность к регистру</A></H4>

<P>
<A NAME="IDX1205"></A>

</P>
<P>
<A NAME="IDX1206"></A>

</P>
<DL COMPACT>

<DT><code>BINARY</code>
<DD>
<A NAME="IDX1207"></A>
 

Оператор <code>BINARY</code> преобразует следующую за ним строку в строку с двоичными
данными. Это простой способ обеспечить сравнение в столбце с учетом
регистра, даже если данный столбец не определен как <code>BINARY</code> или <code>BLOB</code>:


<PRE>
mysql&#62; SELECT "a" = "A";
        -&#62; 1

mysql&#62; SELECT BINARY "a" = "A";
        -&#62; 0
</PRE>

<code>BINARY string</code> является сокращением для <code>CAST(string AS BINARY)</code>.
See section <A HREF="manual.ru.html#Cast_Functions">6.3.5  Функции приведения типов</A>. Оператор <code>BINARY</code> был введен в версии MySQL 3.23.0. Следует
учитывать, что при приведении индексированного столбца к типу <code>BINARY</code> 
MySQL в некоторых случаях не сможет эффективно использовать индексы.

Для сравнения двоичных данных типа <code>BLOB</code> без учета регистра данные с типом
<code>BLOB</code>  перед выполнением сравнения всегда можно конвертировать в верхний
регистр:


<PRE>
SELECT 'A' LIKE UPPER(blob_col) FROM table_name;
</PRE>

В скором времени мы планируем ввести преобразование между различными
кодировками, чтобы сделать сравнение строк еще более гибким.
</DL>



<H3><A NAME="Numeric_Functions" HREF="manual.ru_toc.html#Numeric_Functions">6.3.3  Числовые функции</A></H3>



<H4><A NAME="Arithmetic_functions" HREF="manual.ru_toc.html#Arithmetic_functions">6.3.3.1  Арифметические операции</A></H4>

<P>
В MySQL можно применять обычные арифметические операторы. Следует иметь в
виду, что если оба аргумента являются целыми числами, то при использовании
операторов <samp>`-'</samp>, <samp>`+'</samp> и <samp>`*'</samp> результат вычисляется с точностью <code>BIGINT</code> (64
бита). Если один из аргументов - беззнаковое целое число, а второй
аргумент - также целое число, то результат будет беззнаковым целым числом.
See section <A HREF="manual.ru.html#Cast_Functions">6.3.5  Функции приведения типов</A>.

</P>
<P>
<A NAME="IDX1208"></A>
<A NAME="IDX1209"></A>
<DL COMPACT>

<DT><code>+</code>
<DD>
<A NAME="IDX1210"></A>
 <A NAME="IDX1211"></A>
 

Сложение:

<PRE>
mysql&#62; SELECT 3+5;
        -&#62; 8
</PRE>

<A NAME="IDX1212"></A>
<A NAME="IDX1213"></A>
<DT><code>-</code>
<DD>
Вычитание:

<PRE>
mysql&#62; SELECT 3-5;
        -&#62; -2
</PRE>

<A NAME="IDX1214"></A>
<A NAME="IDX1215"></A>
<DT><code>*</code>
<DD>
Умножение:


<PRE>
mysql&#62; SELECT 3*5;
        -&#62; 15

mysql&#62; SELECT 18014398509481984*18014398509481984.0;
        -&#62; 324518553658426726783156020576256.0

mysql&#62; SELECT 18014398509481984*18014398509481984;
        -&#62; 0
</PRE>

В последнем выражении мы получим неверный результат, так как произведение
умножения целых чисел выходит за границы 64-битового диапазона для
вычислений с точностью <code>BIGINT</code>.

<A NAME="IDX1216"></A>
<A NAME="IDX1217"></A>
<DT><code>/</code>
<DD>
Деление:


<PRE>
mysql&#62; SELECT 3/5;
        -&#62; 0.60
</PRE>

Деление на ноль приводит к результату <code>NULL</code>:


<PRE>
mysql&#62; SELECT 102/(1-1);
        -&#62; NULL
</PRE>

Деление будет выполняться по правилам <code>BIGINT</code>-арифметики только в случае,
если эта операция представлена в контексте, где ее результат преобразуется
в <code>INTEGER</code>!

</DL>



<H4><A NAME="Mathematical_functions" HREF="manual.ru_toc.html#Mathematical_functions">6.3.3.2  Математические функции</A></H4>

<P>
<A NAME="IDX1218"></A>

</P>
<P>
Все математические функции в случае ошибки возвращают <code>NULL</code>.

</P>
<DL COMPACT>

<DT><code>-</code>
<DD>
<A NAME="IDX1219"></A>
 <A NAME="IDX1220"></A>
 <A NAME="IDX1221"></A>
 

Унарный минус. Изменяет знак аргумента:


<PRE>
mysql&#62; SELECT - 2;
        -&#62; -2
</PRE>

Необходимо учитывать, что если этот оператор используется с данными типа
<code>BIGINT</code>, возвращаемое значение также будет иметь тип <code>BIGINT</code>! Это означает,
что следует избегать использования оператора для целых чисел, которые
могут иметь величину <code>-2^63</code>!

<A NAME="IDX1222"></A>
<DT><code>ABS(X)</code>
<DD>
Возвращает абсолютное значение величины <code>X</code>:

<PRE>
mysql&#62; SELECT ABS(2);
        -&#62; 2
mysql&#62; SELECT ABS(-32);
        -&#62; 32
</PRE>

Эту функцию можно уверенно применять для величин типа <code>BIGINT</code>.

<A NAME="IDX1223"></A>
<DT><code>SIGN(X)</code>
<DD>
Возвращает знак аргумента в виде <code>-1</code>, <code>0</code> или <code>1</code>, в зависимости от того,
является ли <code>X</code> отрицательным, нулем или положительным:


<PRE>
mysql&#62; SELECT SIGN(-32);
        -&#62; -1

mysql&#62; SELECT SIGN(0);
        -&#62; 0

mysql&#62; SELECT SIGN(234);
        -&#62; 1
</PRE>

<A NAME="IDX1224"></A>
<A NAME="IDX1225"></A>
<DT><code>MOD(N,M)</code>
<DD>
<DT><code>%</code>
<DD>
Значение по модулю (подобно оператору <code>%</code> в C). Возвращает остаток от
деления <code>N</code> на <code>M</code>:


<PRE>
mysql&#62; SELECT MOD(234, 10);
        -&#62; 4

mysql&#62; SELECT 253 % 7;
        -&#62; 1

mysql&#62; SELECT MOD(29,9);
        -&#62; 2
</PRE>

Эту функцию можно уверенно применять для величин типа <code>BIGINT</code>.

<A NAME="IDX1226"></A>
<DT><code>FLOOR(X)</code>
<DD>
Возвращает наибольшее целое число, не превышающее <code>X</code>:


<PRE>
mysql&#62; SELECT FLOOR(1.23);
        -&#62; 1

mysql&#62; SELECT FLOOR(-1.23);
        -&#62; -2
</PRE>

Следует учитывать, что возвращаемая величина преобразуется в <code>BIGINT</code>!

<A NAME="IDX1227"></A>
<DT><code>CEILING(X)</code>
<DD>
Возвращает наименьшее целое число, не меньшее, чем <code>X</code>:


<PRE>
mysql&#62; SELECT CEILING(1.23);
        -&#62; 2

mysql&#62; SELECT CEILING(-1.23);
        -&#62; -1
</PRE>

Следует учитывать, что возвращаемая величина преобразуется в <code>BIGINT</code>!

<A NAME="IDX1228"></A>
<DT><code>ROUND(X)</code>
<DD>
Возвращает аргумент <code>X</code>, округленный до ближайшего целого числа:


<PRE>
mysql&#62; SELECT ROUND(-1.23);
        -&#62; -1

mysql&#62; SELECT ROUND(-1.58);
        -&#62; -2

mysql&#62; SELECT ROUND(1.58);
        -&#62; 2
</PRE>

Следует учитывать, что поведение функции <code>ROUND()</code> при значении аргумента,
равном середине между двумя целыми числами, зависит от конкретной
реализации библиотеки C. Округление может выполняться: к ближайшему
четному числу, всегда к ближайшему большему, всегда к ближайшему меньшему,
всегда быть направленным к нулю. Чтобы округление всегда происходило
только в одном направлении, необходимо использовать вместо данной хорошо
определенные функции, такие как <code>TRUNCATE()</code> или <code>FLOOR()</code>.

<A NAME="IDX1229"></A>
<DT><code>ROUND(X,D)</code>
<DD>
Возвращает аргумент <code>X</code>, округленный до числа с <code>D</code> десятичными знаками. Если
<code>D</code> равно <code>0</code>, результат будет представлен без десятичного знака или дробной
части:


<PRE>
mysql&#62; SELECT ROUND(1.298, 1);
        -&#62; 1.3

mysql&#62; SELECT ROUND(1.298, 0);
        -&#62; 1
</PRE>

<A NAME="IDX1230"></A>
<DT><code>EXP(X)</code>
<DD>
Возвращает значение <code>e</code> (основа натуральных логарифмов), возведенное в
степень <code>X</code>:


<PRE>
mysql&#62; SELECT EXP(2);
        -&#62; 7.389056

mysql&#62; SELECT EXP(-2);
        -&#62; 0.135335
</PRE>

<A NAME="IDX1231"></A>
<DT><code>LN(X)</code>
<DD>
Возвращает натуральный логарифм числа <code>X</code>: 

<PRE>
mysql&#62; SELECT LN(2);
        -&#62; 0.693147
mysql&#62; SELECT LN(-2);
        -&#62; NULL
</PRE>

Эта функция появилась в MySQL 4.0.3. Это синоним 
<code>LOG(X)</code>. 

<A NAME="IDX1232"></A>
<DT><code>LOG(B, X)</code>
<DD>
Если вызывается с одним параметром, возвращает натуральный логарифм числа <code>X</code>:


<PRE>
mysql&#62; SELECT LOG(2);
        -&#62; 0.693147

mysql&#62; SELECT LOG(-2);
        -&#62; NULL
</PRE>

Если вызывается с двумя параметрами, функция возвращает логарифм числа <code>X</code> по базе <code>B</code>:

<PRE>
mysql&#62; SELECT LOG(2,65536);
        -&#62; 16.000000
mysql&#62; SELECT LOG(1,100);
        -&#62; NULL
</PRE>

Опция указания базы логарифма появилась в MySQL 4.0.3. 
<code>LOG(B,X)</code> эквалиентно <code>LOG(X)/LOG(B)</code>.

<A NAME="IDX1233"></A>
<DT><code>LOG2(X)</code>
<DD>
Возвращает логарифм числа <code>X</code> по базе 2: 

<PRE>
mysql&#62; SELECT LOG2(65536);
        -&#62; 16.000000
mysql&#62; SELECT LOG2(-100);
        -&#62; NULL
</PRE>

Функция <code>LOG2()</code> полезна с тем, чтобы узнать, сколько бит число потребует для хранения. 
Эта функция добавлена в MySQL 4.0.3. 
В более старых версиях вызывайте вместо нее: <code>LOG(X)/LOG(2)</code> 

<A NAME="IDX1234"></A>
<DT><code>LOG10(X)</code>
<DD>
Возвращает десятичный логарифм числа <code>X</code>:


<PRE>
mysql&#62; SELECT LOG10(2);
        -&#62; 0.301030

mysql&#62; SELECT LOG10(100);
        -&#62; 2.000000

mysql&#62; SELECT LOG10(-100);
        -&#62; NULL
</PRE>

<A NAME="IDX1235"></A>
<A NAME="IDX1236"></A>
<DT><code>POW(X,Y)</code>
<DD>
<DT><code>POWER(X,Y)</code>
<DD>
Возвращает значение аргумента <code>X</code>, возведенное в степень <code>Y</code>:


<PRE>
mysql&#62; SELECT POW(2,2);
        -&#62; 4.000000

mysql&#62; SELECT POW(2,-2);
        -&#62; 0.250000
</PRE>

<DT><code>SQRT(X)</code>
<DD>
Возвращает неотрицательный квадратный корень числа <code>X</code>:


<PRE>
mysql&#62; SELECT SQRT(4);
        -&#62; 2.000000

mysql&#62; SELECT SQRT(20);
        -&#62; 4.472136
</PRE>

<A NAME="IDX1237"></A>
<DT><code>PI()</code>
<DD>
Возвращает значение числа "пи". По умолчанию представлено 5 десятичных
знаков, но в MySQL для представления числа "пи" при внутренних вычислениях
используется полная двойная точность.


<PRE>
mysql&#62; SELECT PI();
        -&#62; 3.141593

mysql&#62; SELECT PI()+0.000000000000000000;
        -&#62; 3.141592653589793116
</PRE>

<A NAME="IDX1238"></A>
<DT><code>COS(X)</code>
<DD>
Возвращает косинус числа <code>X</code>, где <code>X</code> задается в радианах:


<PRE>
mysql&#62; SELECT COS(PI());
        -&#62; -1.000000
</PRE>

<A NAME="IDX1239"></A>
<DT><code>SIN(X)</code>
<DD>
Возвращает синус числа <code>X</code>, где <code>X</code> задается в радианах:


<PRE>
mysql&#62; SELECT SIN(PI());
        -&#62; 0.000000
</PRE>

<A NAME="IDX1240"></A>
<DT><code>TAN(X)</code>
<DD>
Возвращает тангенс числа <code>X</code>, где <code>X</code> задается в радианах:


<PRE>
mysql&#62; SELECT TAN(PI()+1);
        -&#62; 1.557408
</PRE>

<DT><code>ACOS(X)</code>
<DD>
Возвращает арккосинус числа <code>X</code>, т.е. величину, косинус которой равен <code>X</code>.
Если <code>X</code> не находится в диапазоне от <code>-1</code> до <code>1</code>, возвращает <code>NULL</code>:


<PRE>
mysql&#62; SELECT ACOS(1);
        -&#62; 0.000000

mysql&#62; SELECT ACOS(1.0001);
        -&#62; NULL

mysql&#62; SELECT ACOS(0);
        -&#62; 1.570796
</PRE>

<A NAME="IDX1241"></A>
<DT><code>ASIN(X)</code>
<DD>
Возвращает арксинус числа <code>X</code>, т.е. величину, синус которой равен <code>X</code>. Если <code>X</code>
не находится в диапазоне от <code>-1</code> до <code>1</code>, возвращает <code>NULL</code>:


<PRE>
mysql&#62; SELECT ASIN(0.2);
        -&#62; 0.201358

mysql&#62; SELECT ASIN('foo');
        -&#62; 0.000000
</PRE>

<A NAME="IDX1242"></A>
<DT><code>ATAN(X)</code>
<DD>
Возвращает арктангенс числа <code>X</code>, т.е. величину, тангенс которой равен <code>X</code>:


<PRE>
mysql&#62; SELECT ATAN(2);
        -&#62; 1.107149

mysql&#62; SELECT ATAN(-2);
        -&#62; -1.107149
</PRE>

<A NAME="IDX1243"></A>
<A NAME="IDX1244"></A>
<DT><code>ATAN(Y,X)</code>
<DD>
<DT><code>ATAN2(Y,X)</code>
<DD>
Возвращает арктангенс двух переменных <code>X</code> и <code>Y</code>. Вычисление производится так
же, как и вычисление арктангенса <code>Y / X</code>, за исключением того, что знаки
обоих аргументов используются для определения квадранта результата:


<PRE>
mysql&#62; SELECT ATAN(-2,2);
        -&#62; -0.785398

mysql&#62; SELECT ATAN2(PI(),0);
        -&#62; 1.570796
</PRE>

<A NAME="IDX1245"></A>
<DT><code>COT(X)</code>
<DD>
Возвращает котангенс числа <code>X</code>:


<PRE>
mysql&#62; SELECT COT(12);
        -&#62; -1.57267341

mysql&#62; SELECT COT(0);
        -&#62; NULL
</PRE>

<A NAME="IDX1246"></A>
<DT><code>RAND()</code>
<DD>
<DT><code>RAND(N)</code>
<DD>
Возвращает случайную величину с плавающей точкой в диапазоне от <code>0</code> до <code>1,0</code>.
Если целочисленный аргумент <code>N</code> указан, то он используется как начальное
значение этой величины:


<PRE>
mysql&#62; SELECT RAND();
        -&#62; 0.9233482386203

mysql&#62; SELECT RAND(20);
        -&#62; 0.15888261251047

mysql&#62; SELECT RAND(20);
        -&#62; 0.15888261251047

mysql&#62; SELECT RAND();
        -&#62; 0.63553050033332

mysql&#62; SELECT RAND();
        -&#62; 0.70100469486881
</PRE>

В выражениях вида <code>ORDER BY</code>  не следует использовать столбец с величинами
<code>RAND()</code>, поскольку применение оператора <code>ORDER BY</code> приведет к многократным
вычислениям в этом столбце. В версии MySQL 3.23 можно, однако, выполнить
следующий оператор: <code>SELECT * FROM table_name ORDER BY RAND()</code>: он
полезен для получения случайного экземпляра из множества <code>SELECT * FROM 
table1,table2 WHERE a=b AND c&#60;d ORDER BY RAND() LIMIT 1000</code>. Следует
учитывать, что оператор <code>RAND()</code> в выражении <code>WHERE</code> при выполнении выражения
<code>WHERE</code> будет вычисляться каждый раз заново. Оператор <code>RAND()</code> не следует
воспринимать как полноценный генератор случайных чисел: это просто быстрый
способ динамической генерации случайных чисел, переносимых между
платформами для одной и той же версии MySQL.

<A NAME="IDX1247"></A>
<DT><code>LEAST(X,Y,...)</code>
<DD>
Если задано два или более аргументов, возвращает наименьший (с минимальным
значением) аргумент. Сравнение аргументов происходит по следующим
правилам:


<UL>
<LI>

Если возвращаемая величина используется в целочисленном контексте
(<code>INTEGER</code>), или все аргументы являются целочисленными, то они
сравниваются как целые числа.

<LI>

Если возвращаемая величина используется в контексте действительных
чисел (<code>REAL</code>) или все аргументы являются действительными числами, то
они сравниваются как числа типа <code>REAL</code>.

<LI>

Если один из аргументов является зависимой от регистра строкой, то
данные аргументы сравниваются с учетом регистра.

<LI>

В остальных случаях аргументы сравниваются как строки, независимые от
регистра.
</UL>


<PRE>
mysql&#62; SELECT LEAST(2,0);
        -&#62; 0

mysql&#62; SELECT LEAST(34.0,3.0,5.0,767.0);
        -&#62; 3.0

mysql&#62; SELECT LEAST("B","A","C");
        -&#62; "A"
</PRE>

В версиях MySQL до 3.22.5 можно использовать MIN() вместо  LEAST.

<A NAME="IDX1248"></A>
<DT><code>GREATEST(X,Y,...)</code>
<DD>
Возвращает наибольший (с максимальным значением) аргумент. Сравнение
аргументов происходит по тем же правилам, что и для <code>LEAST</code>:


<PRE>
mysql&#62; SELECT GREATEST(2,0);
        -&#62; 2

mysql&#62; SELECT GREATEST(34.0,3.0,5.0,767.0);
        -&#62; 767.0

mysql&#62; SELECT GREATEST("B","A","C");
        -&#62; "C"
</PRE>

В версиях MySQL до 3.22.5 можно использовать <code>MAX()</code> вместо <code>GREATEST</code>.

<A NAME="IDX1249"></A>
<DT><code>DEGREES(X)</code>
<DD>
Возвращает аргумент <code>X</code>, преобразованный из радианов в градусы:


<PRE>
mysql&#62; SELECT DEGREES(PI());
        -&#62; 180.000000
</PRE>

<A NAME="IDX1250"></A>
<DT><code>RADIANS(X)</code>
<DD>
Возвращает аргумент <code>X</code>, преобразованный из градусов в радианы:


<PRE>
mysql&#62; SELECT RADIANS(90);
        -&#62; 1.570796
</PRE>

<A NAME="IDX1251"></A>
<DT><code>TRUNCATE(X,D)</code>
<DD>
Возвращает число <code>X</code>, усеченное до <code>D</code> десятичных знаков. Если <code>D</code> равно <code>0</code>,
результат будет представлен без десятичного знака или дробной части:


<PRE>
mysql&#62; SELECT TRUNCATE(1.223,1);
        -&#62; 1.2
mysql&#62; SELECT TRUNCATE(1.999,1);
        -&#62; 1.9
mysql&#62; SELECT TRUNCATE(1.999,0);
        -&#62; 1
mysql&#62; SELECT TRUNCATE(-1.999,1);
        -&#62; -1.9
</PRE>

Начиная с MySQL 3.23.51 все числа округляются к нулю. 

Если <code>D</code> - негативное, то тогда вся часть числа обнуляется: 


<PRE>
mysql&#62; SELECT TRUNCATE(122,-2);
       -&#62; 100
</PRE>

Следует учитывать, что обычно в компьютерах десятичные числа хранятся не
так, как целые, а как числа двойной точности с плавающим десятичным знаком
(<code>DOUBLE</code>). Поэтому иногда результат может вводить в заблуждение, как в
следующем примере:


<PRE>
mysql&#62; SELECT TRUNCATE(10.28*100,0);
        -&#62; 1027
</PRE>

Это происходит потому, что в действительности <code>10,28</code> хранится как нечто
вроде <code>10,2799999999999999</code>.
</DL>



<H3><A NAME="Date_and_time_functions" HREF="manual.ru_toc.html#Date_and_time_functions">6.3.4  Функции даты и времени</A></H3>

<P>
<A NAME="IDX1252"></A>

</P>

<P>
Описание диапазона величин для каждого типа и возможные форматы
представления даты и времени приведены в разделе section <A HREF="manual.ru.html#Date_and_time_types">6.2.2  Типы данных даты и времени</A>.

</P>
<P>
Ниже представлен пример, в котором используются функции даты. Приведенный
запрос выбирает все записи с величиной <code>date_col</code> в течение последних 30
дней:

</P>

<PRE>
mysql&#62; SELECT something FROM tbl_name
        WHERE TO_DAYS(NOW()) - TO_DAYS(date_col) &#60;= 30;
</PRE>

<DL COMPACT>

<DT><code>DAYOFWEEK(date)</code>
<DD>
<A NAME="IDX1253"></A>
 

Возвращает индекс дня недели для аргумента <code>date</code> (1 = воскресенье, 2 =
понедельник, ... 7 = суббота). Эти индексные величины соответствуют
стандарту ODBC.


<PRE>
mysql&#62; SELECT DAYOFWEEK('1998-02-03');
        -&#62; 3
</PRE>

<A NAME="IDX1254"></A>
<DT><code>WEEKDAY(date)</code>
<DD>
Возвращает индекс дня недели для аргумента date (0 =понедельник, 1 =
вторник, ... 6 = воскресенье):


<PRE>
mysql&#62; SELECT WEEKDAY('1998-02-03 22:23:00');
        -&#62; 1
mysql&#62; SELECT WEEKDAY('1997-11-05');
        -&#62; 2
</PRE>

<A NAME="IDX1255"></A>
<DT><code>DAYOFMONTH(date)</code>
<DD>
Возвращает порядковый номер дня месяца для аргумента <code>date</code> в диапазоне от 1
до 31:


<PRE>
mysql&#62; SELECT DAYOFMONTH('1998-02-03');
        -&#62; 3
</PRE>

<A NAME="IDX1256"></A>
<DT><code>DAYOFYEAR(date)</code>
<DD>
Возвращает порядковый номер дня года для аргумента <code>date</code> в диапазоне от 1
до 366:


<PRE>
mysql&#62; SELECT DAYOFYEAR('1998-02-03');
        -&#62; 34
</PRE>

<A NAME="IDX1257"></A>
<DT><code>MONTH(date)</code>
<DD>
Возвращает порядковый номер месяца в году для аргумента <code>date</code> в диапазоне
от 1 до 12:


<PRE>
mysql&#62; SELECT MONTH('1998-02-03');
        -&#62; 2
</PRE>

<A NAME="IDX1258"></A>
<DT><code>DAYNAME(date)</code>
<DD>
Возвращает название дня недели для аргумента <code>date</code>:


<PRE>
mysql&#62; SELECT DAYNAME("1998-02-05");
        -&#62; 'Thursday'
</PRE>

<A NAME="IDX1259"></A>
<DT><code>MONTHNAME(date)</code>
<DD>
Возвращает название месяца для аргумента <code>date</code>:


<PRE>
mysql&#62; SELECT MONTHNAME("1998-02-05");
        -&#62; 'February'
</PRE>

<A NAME="IDX1260"></A>
<DT><code>QUARTER(date)</code>
<DD>
Возвращает номер квартала года для аргумента <code>date</code> в диапазоне от 1 до 4:


<PRE>
mysql&#62; SELECT QUARTER('98-04-01');
        -&#62; 2
</PRE>

<A NAME="IDX1261"></A>
<DT><code>WEEK(date)</code>
<DD>
<DT><code>WEEK(date,first)</code>
<DD>
При наличии одного аргумента возвращает порядковый номер недели в году для
<code>date</code> в диапазоне от 0 до 53 (да, возможно начало 53-й недели) для
регионов, где воскресенье считается первым днем недели. Форма <code>WEEK()</code> с
двумя аргументами позволяет уточнить, с какого дня начинается неделя - с
воскресенья или с понедельника. Результат будет в пределах <code>0-53</code> или <code>1-52</code>.

Вот как работает второй аргумент:

<TABLE BORDER>
<TR><TD><strong>Величина</strong> </TD><TD> <code>Означает</code>
</TD></TR>
<TR><TD>0 </TD><TD> Неделя начинается с воскресенья; возвращаемое значение - в промежутке 0-53
</TD></TR>
<TR><TD>1 </TD><TD> Неделя начинается с понедельника; возвращаемое значение - в промежутке 0-53
</TD></TR>
<TR><TD>2 </TD><TD> Неделя начинается с воскресенья; возвращаемое значение - в промежутке 1-53
</TD></TR>
<TR><TD>3 </TD><TD> Неделя начинается с понедельника; возвращаемое значение - в промежутке 1-53 (ISO 8601)
</TD></TR>
</TABLE>


<PRE>
mysql&#62; SELECT WEEK('1998-02-20');
        -&#62; 7

mysql&#62; SELECT WEEK('1998-02-20',0);
        -&#62; 7

mysql&#62; SELECT WEEK('1998-02-20',1);
        -&#62; 8

mysql&#62; SELECT WEEK('1998-12-31',1);
        -&#62; 53
</PRE>

Примечание: в версии 4.0 функция <code>WEEK(#,0)</code> была изменена с целью
соответствия календарю США.

Заметьте, если неделя является последней неделей прошлого года, MySQL вернет <code>0</code>
если вы не указали <code>2</code> или <code>3</code> как опциональный аргумент:


<PRE>
mysql&#62; SELECT YEAR('2000-01-01'), WEEK('2000-01-01',0);
        -&#62; 2000, 0
mysql&#62; SELECT WEEK('2000-01-01',2);
        -&#62; 52
</PRE>

Можно считать, что MySQL должен вернуть <code>52</code>, так как данная дата
и является 52-ой неделей года 1999. Мы решили возвращать <code>0</code>, так как мы
хотим, чтобы функция давала "номер недели в указанном году". Это делает функцию
<code>WEEK()</code> более надежной при использовании совместно с другими функциями,
которые вычисляют части дат. 

Если вам все же важно уточнить корректную неделю в году, тогда вы можете использовать <code>2</code> или <code>3</code>
как опциональный аргумент или использовать <code>YEARWEEK()</code>


<PRE>
mysql&#62; SELECT YEARWEEK('2000-01-01');
        -&#62; 199952
mysql&#62; SELECT MID(YEARWEEK('2000-01-01'),5,2);
        -&#62; 52
</PRE>

<A NAME="IDX1262"></A>
<DT><code>YEAR(date)</code>
<DD>
Возвращает год для аргумента <code>date</code> в диапазоне от 1000 до 9999:


<PRE>
mysql&#62; SELECT YEAR('98-02-03');
        -&#62; 1998
</PRE>

<A NAME="IDX1263"></A>
<DT><code>YEARWEEK(date)</code>
<DD>
<DT><code>YEARWEEK(date,first)</code>
<DD>
Возвращает год и неделю для аргумента <code>date</code>. Второй аргумент в данной
функции работает подобно второму аргументу в функции <code>WEEK()</code>. Следует
учитывать, что год может отличаться от указанного в аргументе <code>date</code> для
первой и последней недель года:


<PRE>
mysql&#62; SELECT YEARWEEK('1987-01-01');
        -&#62; 198653
</PRE>

Обратите внимание, что номер недели отличается от того, который возвращает
функция <code>WEEK()</code> (<code>0</code>), будучи вызванной с опциональным аргументом <code>0</code> или <code>1</code>. Это
потому, что <code>WEEK()</code> возвращает номер недели именно в указанном году. 

<A NAME="IDX1264"></A>
<DT><code>HOUR(time)</code>
<DD>
Возвращает час для аргумента <code>time</code> в диапазоне от 0 до 23:


<PRE>
mysql&#62; SELECT HOUR('10:05:03');
        -&#62; 10
</PRE>

<A NAME="IDX1265"></A>
<DT><code>MINUTE(time)</code>
<DD>
Возвращает количество минут для аргумента <code>time</code> в диапазоне от 0 до 59:


<PRE>
mysql&#62; SELECT MINUTE('98-02-03 10:05:03');
        -&#62; 5
</PRE>

<A NAME="IDX1266"></A>
<DT><code>SECOND(time)</code>
<DD>
Возвращает количество секунд для аргумента <code>time</code> в диапазоне от 0 до 59:


<PRE>
mysql&#62; SELECT SECOND('10:05:03');
        -&#62; 3
</PRE>

<A NAME="IDX1267"></A>
<DT><code>PERIOD_ADD(P,N)</code>
<DD>
Добавляет <code>N</code> месяцев к периоду <code>P</code> (в формате <code>YYMM</code> или <code>YYYYMM</code>). Возвращает
величину в формате <code>YYYYMM</code>. Следует учитывать, что аргумент периода <code>P</code>  не
является значением даты:


<PRE>
mysql&#62; SELECT PERIOD_ADD(9801,2);
        -&#62; 199803
</PRE>

<A NAME="IDX1268"></A>
<DT><code>PERIOD_DIFF(P1,P2)</code>
<DD>
Возвращает количество месяцев между периодами <code>P1</code> и <code>P2</code>. <code>P1</code> и <code>P2</code> должны быть
в формате <code>YYMM</code> или <code>YYYYMM</code>. Следует учитывать, что аргументы периода <code>P1</code> и
<code>P2</code>  не являются значениями даты:


<PRE>
mysql&#62; SELECT PERIOD_DIFF(9802,199703);
        -&#62; 11
</PRE>

<A NAME="IDX1269"></A>
<A NAME="IDX1270"></A>
<A NAME="IDX1271"></A>
<A NAME="IDX1272"></A>
<DT><code>DATE_ADD(date,INTERVAL expr type)</code>
<DD>
<DT><code>DATE_SUB(date,INTERVAL expr type)</code>
<DD>
<DT><code>ADDDATE(date,INTERVAL expr type)</code>
<DD>
<DT><code>SUBDATE(date,INTERVAL expr type)</code>
<DD>
Данные функции производят арифметические действия над датами. Обе являются
нововведением версии MySQL 3.22. Функции <code>ADDDATE()</code> и <code>SUBDATE()</code> - синонимы
для <code>DATE_ADD()</code> и <code>DATE_SUB()</code>. В версии MySQL 3.23 вместо функций <code>DATE_ADD()</code>
и <code>DATE_SUB()</code> можно использовать операторы <code>+</code> и <code>-</code>, если выражение с правой
стороны представляет собой столбец типа <code>DATE</code> или <code>DATETIME</code> (см. пример
ниже). Аргумент <code>date</code> является величиной типа <code>DATETIME</code> или <code>DATE</code>, задающей
начальную дату. 

Выражение <code>expr</code> задает величину интервала, который следует
добавить к начальной дате или вычесть из начальной даты. Выражение <code>expr</code>
представляет собой строку, которая может начинаться с <code>-</code> для
отрицательных значений интервалов. Ключевое слово <code>type</code> показывает, каким
образом необходимо интерпретировать данное выражение. Вспомогательная
функция <code>EXTRACT(type FROM date)</code> возвращает интервал указанного типа
(<code>type</code>) из значения даты. В следующей таблице показана взаимосвязь
аргументов <code>type</code> и <code>expr</code>:

<TABLE BORDER>
<TR><TD><strong>Значение</strong> <code>Type</code> </TD><TD> <strong>Ожидаемый формат</strong> <code>expr</code>
</TD></TR>
<TR><TD><code>SECOND</code> </TD><TD> <code>SECONDS</code>
</TD></TR>
<TR><TD><code>MINUTE</code> </TD><TD> <code>MINUTES</code>
</TD></TR>
<TR><TD><code>HOUR</code> </TD><TD> <code>HOURS</code>
</TD></TR>
<TR><TD><code>DAY</code> </TD><TD> <code>DAYS</code>
</TD></TR>
<TR><TD><code>MONTH</code> </TD><TD> <code>MONTHS</code>
</TD></TR>
<TR><TD><code>YEAR</code> </TD><TD> <code>YEARS</code>
</TD></TR>
<TR><TD><code>MINUTE_SECOND</code> </TD><TD> <code>"MINUTES:SECONDS"</code>
</TD></TR>
<TR><TD><code>HOUR_MINUTE</code> </TD><TD> <code>"HOURS:MINUTES"</code>
</TD></TR>
<TR><TD><code>DAY_HOUR</code> </TD><TD> <code>"DAYS HOURS"</code>
</TD></TR>
<TR><TD><code>YEAR_MONTH</code> </TD><TD> <code>"YEARS-MONTHS"</code>
</TD></TR>
<TR><TD><code>HOUR_SECOND</code> </TD><TD> <code>"HOURS:MINUTES:SECONDS"</code>
</TD></TR>
<TR><TD><code>DAY_MINUTE</code> </TD><TD> <code>"DAYS HOURS:MINUTES"</code>
</TD></TR>
<TR><TD><code>DAY_SECOND</code> </TD><TD> <code>"DAYS HOURS:MINUTES:SECONDS"</code>
</TD></TR>
</TABLE>

В MySQL формат выражения <code>expr</code>  допускает любые разделительные знаки.
Разделители, представленные в данной таблице, приведены в качестве
примеров. Если аргумент <code>date</code> является величиной типа <code>DATE</code> и предполагаемые
вычисления включают в себя только части <code>YEAR</code>, <code>MONTH</code>, и <code>DAY</code> (т.е. не
содержат временной части <code>TIME</code>), то результат представляется величиной типа
<code>DATE</code>. В других случаях результат представляет собой величину <code>DATETIME</code>:


<PRE>
mysql&#62; SELECT "1997-12-31 23:59:59" + INTERVAL 1 SECOND;
        -&#62; 1998-01-01 00:00:00
mysql&#62; SELECT INTERVAL 1 DAY + "1997-12-31";
        -&#62; 1998-01-01
mysql&#62; SELECT "1998-01-01" - INTERVAL 1 SECOND;
        -&#62; 1997-12-31 23:59:59
mysql&#62; SELECT DATE_ADD("1997-12-31 23:59:59", INTERVAL 1 SECOND);
        -&#62; 1998-01-01 00:00:00
mysql&#62; SELECT DATE_ADD("1997-12-31 23:59:59", INTERVAL 1 DAY);
        -&#62; 1998-01-01 23:59:59
mysql&#62; SELECT DATE_ADD("1997-12-31 23:59:59", INTERVAL "1:1" MINUTE_SECOND);
        -&#62; 1998-01-01 00:01:00
mysql&#62; SELECT DATE_SUB("1998-01-01 00:00:00", INTERVAL "1 1:1:1" DAY_SECOND);
        -&#62; 1997-12-30 22:58:59
mysql&#62; SELECT DATE_ADD("1998-01-01 00:00:00", INTERVAL "-1 10" DAY_HOUR);
        -&#62; 1997-12-30 14:00:00
mysql&#62; SELECT DATE_SUB("1998-01-02", INTERVAL 31 DAY);
        -&#62; 1997-12-02
</PRE>

Если указанный интервал слишком короткий (т.е. не включает все части
интервала, ожидаемые при заданном ключевом слове <code>type</code>), то MySQL
предполагает, что опущены крайние слева части интервала. Например, если
указан аргумент <code>type</code> в виде <code>DAY_SECOND</code>, то ожидаемое выражение <code>expr</code> должно
иметь следующие части: дни, часы, минуты и секунды. Если в этом случае
указать значение интервала в виде <code>"1:10"</code>, то MySQL предполагает, что
опущены дни и часы, а данная величина включает только минуты и секунды.
Другими словами, сочетание <code>"1:10"</code> <code>DAY_SECOND</code> интерпретируется как
эквивалент <code>"1:10"</code> <code>MINUTE_SECOND</code>. Аналогичным образом в MySQL
интерпретируются и значения <code>TIME</code> - скорее как представляющие прошедшее
время, чем как время дня. Следует учитывать, что при операциях сложения
или вычитания с участием величины <code>DATE</code> и выражения, содержащего временную
часть, данная величина <code>DATE</code> будет автоматически конвертироваться в
величину типа <code>DATETIME</code>:


<PRE>
mysql&#62; SELECT DATE_ADD("1999-01-01", INTERVAL 1 DAY);
        -&#62; 1999-01-02

mysql&#62; SELECT DATE_ADD("1999-01-01", INTERVAL 1 HOUR);
        -&#62; 1999-01-01 01:00:00
</PRE>

При использовании некорректных значений дат результат будет равен <code>NULL</code>.
Если при суммировании <code>MONTH</code>, <code>YEAR_MONTH</code> или <code>YEAR</code> номер дня в
результирующей дате превышает максимальное количество дней в новом месяце,
то номер дня результирующей даты принимается равным последнему дню нового
месяца:


<PRE>
mysql&#62; SELECT DATE_ADD('1998-01-30', INTERVAL 1 MONTH);
        -&#62; 1998-02-28
</PRE>

Из предыдущего примера видно, что слово <code>INTERVAL</code> и ключевое слово <code>type</code> не
являются регистро-зависимыми.

<A NAME="IDX1273"></A>
<DT><code>EXTRACT(type FROM date)</code>
<DD>
Типы интервалов для функции <code>EXTRACT()</code> используются те же, что и для
функций <code>DATE_ADD()</code> или <code>DATE_SUB()</code>, но <code>EXTRACT()</code> производит скорее
извлечение части из значения даты, чем выполнение арифметических действий.


<PRE>
mysql&#62; SELECT EXTRACT(YEAR FROM "1999-07-02");
        -&#62; 1999

mysql&#62; SELECT EXTRACT(YEAR_MONTH FROM "1999-07-02 01:02:03");
        -&#62; 199907

mysql&#62; SELECT EXTRACT(DAY_MINUTE FROM "1999-07-02 01:02:03");
        -&#62; 20102
</PRE>

<A NAME="IDX1274"></A>
<DT><code>TO_DAYS(date)</code>
<DD>
функция возвращает номер дня для даты, указанной в аргументе <code>date</code>,
(количество дней, прошедших с года 0):


<PRE>
mysql&#62; SELECT TO_DAYS(950501);
        -&#62; 728779

mysql&#62; SELECT TO_DAYS('1997-10-07');
        -&#62; 729669
</PRE>

Функция <code>TO_DAYS()</code> не предназначена для использования с величинами,
предшествующими введению григорианского календаря (1582), поскольку не
учитывает дни, утерянные при изменении календаря.

<A NAME="IDX1275"></A>
<DT><code>FROM_DAYS(N)</code>
<DD>
Возвращает величину <code>DATE</code> для заданного номера дня <code>N</code>:


<PRE>
mysql&#62; SELECT FROM_DAYS(729669);
        -&#62; '1997-10-07'
</PRE>

Функция <code>FROM_DAYS()</code> не предназначена для использования с величинами,
предшествующими введению григорианского календаря (1582), поскольку она не
учитывает дни, утерянные при изменении календаря.

<A NAME="IDX1276"></A>
<DT><code>DATE_FORMAT(date,format)</code>
<DD>
Форматирует величину <code>date</code> в соответствии со строкой <code>format</code>. В строке
<code>format</code> могут использоваться следующие определители:

<TABLE BORDER>
<TR><TD><strong>Определитель</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD><code>%M</code> </TD><TD> Название месяца (январь...декабрь)
</TD></TR>
<TR><TD><code>%W</code> </TD><TD> Название дня недели (воскресенье...суббота)
</TD></TR>
<TR><TD><code>%D</code> </TD><TD> День месяца с английским суффиксом (0st, 1st, 2nd, 3rd и т.д.)
</TD></TR>
<TR><TD><code>%Y</code> </TD><TD> Год, число, 4 разряда
</TD></TR>
<TR><TD><code>%y</code> </TD><TD> Год, число, 2 разряда
</TD></TR>
<TR><TD><code>%X</code> </TD><TD> Год для недели, где воскресенье считается первым днем недели, число, 4 разряда, используется с '%V'
</TD></TR>
<TR><TD><code>%x</code> </TD><TD> Год для недели, где воскресенье считается первым днем недели, число, 4 разряда, используется с '%v'
</TD></TR>
<TR><TD><code>%a</code> </TD><TD> Сокращенное наименование дня недели (Вс...Сб)
</TD></TR>
<TR><TD><code>%d</code> </TD><TD> День месяца, число (00..31)
</TD></TR>
<TR><TD><code>%e</code> </TD><TD> День месяца, число (0..31)
</TD></TR>
<TR><TD><code>%m</code> </TD><TD> Месяц, число (00..12)
</TD></TR>
<TR><TD><code>%c</code> </TD><TD> Месяц, число (0..12)
</TD></TR>
<TR><TD><code>%b</code> </TD><TD> Сокращенное наименование месяца (Янв...Дек)
</TD></TR>
<TR><TD><code>%j</code> </TD><TD> День года (001..366)
</TD></TR>
<TR><TD><code>%H</code> </TD><TD> Час (00..23)
</TD></TR>
<TR><TD><code>%k</code> </TD><TD> Час (0..23)
</TD></TR>
<TR><TD><code>%h</code> </TD><TD> Час (01..12)
</TD></TR>
<TR><TD><code>%I</code> </TD><TD> Час (01..12)
</TD></TR>
<TR><TD><code>%l</code> </TD><TD> Час (1..12)
</TD></TR>
<TR><TD><code>%i</code> </TD><TD> Минуты, число (00..59)
</TD></TR>
<TR><TD><code>%r</code> </TD><TD> Время, 12-часовой формат (hh:mm:ss [AP]M)
</TD></TR>
<TR><TD><code>%T</code> </TD><TD> Время, 24-часовой формат (hh:mm:ss)
</TD></TR>
<TR><TD><code>%S</code> </TD><TD> Секунды (00..59)
</TD></TR>
<TR><TD><code>%s</code> </TD><TD> Секунды (00..59)
</TD></TR>
<TR><TD><code>%p</code> </TD><TD> AM или PM
</TD></TR>
<TR><TD><code>%w</code> </TD><TD> День недели (0=воскресенье..6=суббота)
</TD></TR>
<TR><TD><code>%U</code> </TD><TD> Неделя (00..53), где воскресенье считается первым  днем недели
</TD></TR>
<TR><TD><code>%u</code> </TD><TD> Неделя (00..53), где понедельник считается первым  днем недели
</TD></TR>
<TR><TD><code>%V</code> </TD><TD> Неделя (01..53), где воскресенье считается первым  днем недели. Используется с <samp>`%X'</samp>
</TD></TR>
<TR><TD><code>%v</code> </TD><TD> Неделя (01..53), где понедельник считается первым  днем недели. Используется с <samp>`%x'</samp>
</TD></TR>
<TR><TD><code>%%</code> </TD><TD> Литерал <samp>`%'</samp>.
</TD></TR>
</TABLE>

Все другие символы просто копируются в результирующее выражение без
интерпретации:


<PRE>
mysql&#62; SELECT DATE_FORMAT('1997-10-04 22:23:00', '%W %M %Y');
        -&#62; 'Saturday October 1997'
mysql&#62; SELECT DATE_FORMAT('1997-10-04 22:23:00', '%H:%i:%s');
        -&#62; '22:23:00'
mysql&#62; SELECT DATE_FORMAT('1997-10-04 22:23:00', '%D %y %a %d %m %b %j');
        -&#62; '4th 97 Sat 04 10 Oct 277'
mysql&#62; SELECT DATE_FORMAT('1997-10-04 22:23:00', '%H %k %I %r %T %S %w');
        -&#62; '22 22 10 10:23:00 PM 22:23:00 00 6'
mysql&#62; SELECT DATE_FORMAT('1999-01-01', '%X %V');
        -&#62; '1998 52'
</PRE>

В MySQL 3.23 символ <samp>`%'</samp> должен предшествовать символам определителя
формата. В более ранних версиях MySQL символ <samp>`%'</samp> необязателен.

Причина того, что промежутки для месяца и дня начинаются с нуля заключается в том, что MySQL позволяет
использовать неполные даты, такие как <code>'2004-00-00'</code>, начиная с MySQL 3.23.

<A NAME="IDX1277"></A>
<DT><code>TIME_FORMAT(time,format)</code>
<DD>
Данная функция используется аналогично описанной выше функции
<code>DATE_FORMAT()</code>, но строка <code>format</code> может содержать только те определители
формата, которые относятся к часам, минутам и секундам. При указании
других определителей будет выдана величина <code>NULL</code> или <code>0</code>.

<A NAME="IDX1278"></A>
<A NAME="IDX1279"></A>
<DT><code>CURDATE()</code>
<DD>
<DT><code>CURRENT_DATE</code>
<DD>
Возвращает сегодняшнюю дату как величину в формате <code>YYYY-MM-DD</code> или
<code>YYYYMMDD</code>, в зависимости от того, в каком контексте используется функция -
в строковом или числовом:


<PRE>
mysql&#62; SELECT CURDATE();
        -&#62; '1997-12-15'
mysql&#62; SELECT CURDATE() + 0;
        -&#62; 19971215
</PRE>

<A NAME="IDX1280"></A>
<A NAME="IDX1281"></A>
<DT><code>CURTIME()</code>
<DD>
<DT><code>CURRENT_TIME</code>
<DD>
Возвращает текущее время как величину в формате <code>HH:MM:SS</code> или <code>HHMMS</code>, в
зависимости от того, в каком контексте используется функция - в строковом
или числовом:


<PRE>
mysql&#62; SELECT CURTIME();
        -&#62; '23:50:26'
mysql&#62; SELECT CURTIME() + 0;
        -&#62; 235026
</PRE>

<A NAME="IDX1282"></A>
<A NAME="IDX1283"></A>
<A NAME="IDX1284"></A>
<DT><code>NOW()</code>
<DD>
<DT><code>SYSDATE()</code>
<DD>
<DT><code>CURRENT_TIMESTAMP</code>
<DD>
Возвращает текущую дату и время как величину в формате <code>YYYY-MM-DD HH:MM:SS</code> 
или <code>YYYYMMDDHHMMSS</code>, в зависимости от того, в каком контексте
используется функция - в строковом или числовом:


<PRE>
mysql&#62; SELECT NOW();
        -&#62; '1997-12-15 23:50:26'
mysql&#62; SELECT NOW() + 0;
        -&#62; 19971215235026
</PRE>

Заметьте, что <code>NOW()</code> вычисляется только единожды для каждого запроса, а
именно - в начале его выполнения.  Это позволяет быть уверенным в том, что
множественные ссылки на <code>NOW()</code> в рамках одного запроса дадут одно и то же
значение. 

<A NAME="IDX1285"></A>
<DT><code>UNIX_TIMESTAMP()</code>
<DD>
<DT><code>UNIX_TIMESTAMP(date)</code>
<DD>
При вызове данной функции без аргумента она возвращает временную метку
<code>UNIX_TIMESTAMP</code> (секунды с 1970-01-01 00:00:00 GMT) как беззнаковое
целое число. Если функция <code>UNIX_TIMESTAMP()</code> вызывается с аргументом  <code>date</code>,
она возвращает величину аргумента как количество секунд с 1970-01-01
00:00:00 GMT. Аргумент date может представлять собой строку типа <code>DATE</code>,
строку <code>DATETIME</code>, величину типа <code>TIMESTAMP</code> или число в формате <code>YYMMDD</code> или
<code>YYYYMMDD</code> местного времени:


<PRE>
mysql&#62; SELECT UNIX_TIMESTAMP();
        -&#62; 882226357

mysql&#62; SELECT UNIX_TIMESTAMP('1997-10-04 22:23:00');
        -&#62; 875996580
</PRE>

При использовании функции <code>UNIX_TIMESTAMP</code> в столбце <code>TIMESTAMP</code> эта функция
будет возвращать величину внутренней временной метки непосредственно, без
подразумеваемого преобразования строки во временную метку
(``string-to-unix-timestamp'' ). Если заданная дата выходит за пределы
допустимого диапазона, то функция <code>UNIX_TIMESTAMP()</code> возвратит <code>0</code>, но следует
учитывать, что выполняется только базовая проверка (год 1970-2037, месяц
01-12, день 01-31). Если необходимо выполнить вычитание столбцов
<code>UNIX_TIMESTAMP()</code>, результат можно преобразовать к целым числам со знаком.
See section <A HREF="manual.ru.html#Cast_Functions">6.3.5  Функции приведения типов</A>.

<A NAME="IDX1286"></A>
<DT><code>FROM_UNIXTIME(unix_timestamp)</code>
<DD>
Возвращает представление аргумента <code>unix_timestamp</code> как величину в формате
<code>YYYY-MM-DD HH:MM:SS</code> или <code>YYYYMMDDHHMMSS</code>, в зависимости от того, в каком
контексте используется функция - в строковом или числовом:


<PRE>
mysql&#62; SELECT FROM_UNIXTIME(875996580);
        -&#62; '1997-10-04 22:23:00'

mysql&#62; SELECT FROM_UNIXTIME(875996580) + 0;
        -&#62; 19971004222300
</PRE>

<A NAME="IDX1287"></A>
<DT><code>FROM_UNIXTIME(unix_timestamp,format)</code>
<DD>
Возвращает строковое представление аргумента <code>unix_timestamp</code>,
отформатированное в соответствии со строкой <code>format</code>. Строка <code>format</code> может
содержать те же определители, которые перечислены в описании для функции
<code>DATE_FORMAT()</code>:


<PRE>
mysql&#62; SELECT FROM_UNIXTIME(UNIX_TIMESTAMP(), '%Y %D %M %h:%i:%s %x');
        -&#62; '1997 23rd December 03:43:30 1997'
</PRE>

<A NAME="IDX1288"></A>
<DT><code>SEC_TO_TIME(seconds)</code>
<DD>
Возвращает аргумент seconds, преобразованный в часы, минуты и секунды, как
величину в формате <code>HH:MM:SS</code> или <code>HHMMSS</code>, в зависимости от того, в каком
контексте используется функция - в строковом или числовом:


<PRE>
mysql&#62; SELECT SEC_TO_TIME(2378);
        -&#62; '00:39:38'

mysql&#62; SELECT SEC_TO_TIME(2378) + 0;
        -&#62; 3938
</PRE>

<A NAME="IDX1289"></A>
<DT><code>TIME_TO_SEC(time)</code>
<DD>
Возвращает аргумент <code>time</code>, преобразованный в секунды:


<PRE>
mysql&#62; SELECT TIME_TO_SEC('22:23:00');
        -&#62; 80580

mysql&#62; SELECT TIME_TO_SEC('00:39:38');
        -&#62; 2378
</PRE>

</DL>



<H3><A NAME="Cast_Functions" HREF="manual.ru_toc.html#Cast_Functions">6.3.5  Функции приведения типов</A></H3>

<P>
Функция <code>CAST</code> имеет следующий синтаксис:

</P>
<P>
<A NAME="IDX1290"></A>
<A NAME="IDX1291"></A>

</P>

<PRE>
CAST(expression AS type)
</PRE>

<P>
или

</P>

<PRE>
CONVERT(expression,type)
</PRE>

<P>
где аргумент <code>type</code> представляет один из типов:

</P>

<UL>
<LI>

<code>BINARY</code>
<LI>

<code>CHAR</code> (Новшество в 4.0.6)
<LI>

<code>DATE</code>
<LI>

<code>DATETIME</code>
<LI>

<code>SIGNED {INTEGER}</code>
<LI>

<code>TIME</code>
<LI>

<code>UNSIGNED {INTEGER}</code>
</UL>

<P>
Функция <code>CAST()</code> соответствует синтаксису ANSI  SQL99, а функция <code>CONVERT()</code> -
синтаксису ODBC.

</P>
<P>
Данная функция приведения типов используется главным образом для создания
столбца конкретного типа с помощью команды <code>CREATE ... SELECT</code>:

</P>

<PRE>
CREATE TABLE new_table SELECT CAST('2000-01-01' AS DATE);
</PRE>

<P>
Выражение <code>CAST string AS BINARY</code> эквивалентно <code>BINARY string</code>.
<code>CAST(expr AS CHAR</code> считает что данное выражение есть строка в
кодировке по умолчанию. 

</P>
<P>
Для преобразования строки в числовую величину обычно не нужно ничего
делать: просто используйте строку так, как будто это число:

</P>

<PRE>
mysql&#62; SELECT 1+'1';
       -&#62; 2
</PRE>

<P>
Если вы указываете номер в строковом контексте, номер будет автоматически преобразован
к строке типа <code>BINARY</code>. 

</P>

<PRE>
mysql&#62; SELECT concat("hello you ",2);
       -&#62;  "hello you 2"
</PRE>

<P>
MySQL поддерживает арифметические операции с 64-битовыми величинами - как
со знаковыми, так и с беззнаковыми. Если используются числовые операции
(такие как +) и один из операндов представлен в виде <code>unsigned integer</code>, то
результат будет беззнаковым. Его можно переопределить, используя операторы
приведения <code>SIGNED</code> и <code>UNSIGNED</code>, чтобы получить 64-битовое целое число со
знаком или без знака соответственно.

</P>

<PRE>
mysql&#62; SELECT CAST(1-2 AS UNSIGNED)
        -&#62; 18446744073709551615

mysql&#62; SELECT CAST(CAST(1-2 AS UNSIGNED) AS SIGNED);
        -&#62; -1
</PRE>

<P>
Следует учитывать, что если один из операндов представлен величиной с
плавающей точкой (в данном контексте <code>DECIMAL()</code> рассматривается как
величина с плавающей точкой), результат также является величиной с
плавающей точкой и не подчиняется вышеприведенному правилу приведения.

</P>

<PRE>
mysql&#62; SELECT CAST(1 AS UNSIGNED) -2.0
        -&#62; -1.0
</PRE>

<P>
Если в арифметической операции используется строка, то результат
преобразуется в число с плавающей точкой.

</P>
<P>
Функции <code>CAST()</code> и <code>CONVERT()</code> были добавлены в MySQL 4.0.2.

</P>
<P>
В MySQL 4.0 была изменены правила обработки беззнаковых величин, чтобы
обеспечить более полную поддержку величин типа <code>BIGINT</code>. Если код необходимо
использовать и для MySQL 4.0, и для версии 3.23 (в которой функция <code>CAST</code>,
скорее всего, не будет работать), то можно, применив следующий трюк,
получить при вычитании двух беззнаковых целочисленных столбцов результат
со знаком:

</P>

<PRE>
SELECT (unsigned_column_1+0.0)-(unsigned_column_2+0.0);
</PRE>

<P>
Идея состоит в том, что перед выполнением вычитания данные столбцы
приводятся к типу с плавающей точкой.

</P>
<P>
Если возникнут проблемы со столбцами типа <code>UNSIGNED</code> в старых приложениях
MySQL при переносе их на MySQL 4.0, можно использовать параметр
<code>--sql-mode=NO_UNSIGNED_SUBTRACTION</code> при запуске <code>mysqld</code>. Однако следует
учитывать, что при этом теряется возможность эффективного использования
столбцов типа <code>UNSIGNED BIGINT</code>.

</P>


<H3><A NAME="Other_Functions" HREF="manual.ru_toc.html#Other_Functions">6.3.6  Другие функции</A></H3>



<H4><A NAME="Bit_functions" HREF="manual.ru_toc.html#Bit_functions">6.3.6.1  Битовые функции</A></H4>

<P>
<A NAME="IDX1292"></A>
<A NAME="IDX1293"></A>

</P>
<P>
MySQL использует для двоичных операций 64-битовые величины <code>BIGINT</code>,
следовательно, для двоичных операторов максимальный диапазон составляет 64
бита.

</P>
<DL COMPACT>

<DT><code>|</code>
<DD>
<A NAME="IDX1294"></A>
 <A NAME="IDX1295"></A>
 

Побитовое ИЛИ


<PRE>
mysql&#62; SELECT 29 | 15;
        -&#62; 31
</PRE>

Результат является беззнаковым 64-битовым целым числом.

<A NAME="IDX1296"></A>
<A NAME="IDX1297"></A>
<DT><code>&#38;</code>
<DD>
Побитовое И


<PRE>
mysql&#62; SELECT 29 &#38; 15;
        -&#62; 13
</PRE>

Результат является беззнаковым 64-битовым целым числом.

<A NAME="IDX1298"></A>
<A NAME="IDX1299"></A>
<DT><code>^</code>
<DD>
Побитовый XOR (побитовое сложение по модулю 2)

<PRE>
mysql&#62; SELECT 1 ^ 1;
        -&#62; 0
mysql&#62; SELECT 1 ^ 0;
        -&#62; 1
mysql&#62; SELECT 11 ^ 3;
        -&#62; 8
</PRE>

Результат - беззнаковое 64-битное целое число.

<code>XOR</code> был реализован в MySQL 4.0.2.

<A NAME="IDX1300"></A>
<DT><code>&#60;&#60;</code>
<DD>
Сдвиг числа двойной длины (<code>BIGINT</code>) влево:


<PRE>
mysql&#62; SELECT 1 &#60;&#60; 2;
        -&#62; 4
</PRE>

Результат является беззнаковым 64-битовым целым числом.

<A NAME="IDX1301"></A>
<DT><code>&#62;&#62;</code>
<DD>
Сдвиг числа двойной длины (<code>BIGINT</code>) вправо:


<PRE>
mysql&#62; SELECT 4 &#62;&#62; 2;
        -&#62; 1
</PRE>

Результат является беззнаковым 64-битовым целым числом.

<A NAME="IDX1302"></A>
<DT><code>~</code>
<DD>
Инвертировать все биты:


<PRE>
mysql&#62; SELECT 5 &#38; ~1;
        -&#62; 4
</PRE>

Результат является беззнаковым 64-битовым целым числом.

<A NAME="IDX1303"></A>
<DT><code>BIT_COUNT(N)</code>
<DD>
Возвращает число битов, указанное в аргументе <code>N</code>:


<PRE>
mysql&#62; SELECT BIT_COUNT(29);
        -&#62; 4
</PRE>

</DL>



<H4><A NAME="Miscellaneous_functions" HREF="manual.ru_toc.html#Miscellaneous_functions">6.3.6.2  Разные функции</A></H4>

<P>
<A NAME="IDX1304"></A>

</P>
<DL COMPACT>

<DT><code>DATABASE()</code>
<DD>
<A NAME="IDX1305"></A>
 

Возвращает имя текущей базы данных:


<PRE>
mysql&#62; SELECT DATABASE();
        -&#62; 'test'
</PRE>

Если в данное время нет активной базы данных, то функция <code>DATABASE()</code>
возвращает пустую строку.

<A NAME="IDX1306"></A>
<A NAME="IDX1307"></A>
<A NAME="IDX1308"></A>
<DT><code>USER()</code>
<DD>
<DT><code>SYSTEM_USER()</code>
<DD>
<DT><code>SESSION_USER()</code>
<DD>
Возвращает имя текущего активного пользователя MySQL:


<PRE>
mysql&#62; SELECT USER();
        -&#62; 'davida@localhost'
</PRE>

В версии MySQL 3.22.11 или более поздней данная функция включает в себя
имя хоста клиента, а также имя пользователя. Можно извлечь часть,
касающуюся только имени пользователя, приведенным ниже способом
(проверяется, включает ли данная величина имя хоста):


<PRE>
mysql&#62; SELECT SUBSTRING_INDEX(USER(),"@",1);
        -&#62; 'davida'
</PRE>

<A NAME="IDX1309"></A>
<DT><code>CURRENT_USER()</code>
<DD>
Возвращает текущее имя пользователя, под которым пользователь аутентифицировался в текущей сессии: 


<PRE>
mysql&#62; SELECT USER();
        -&#62; 'davida@localhost'
mysql&#62; SELECT * FROM mysql.user;
        -&#62; ERROR 1044: Access denied for user: '@localhost' to database 'mysql'
mysql&#62; SELECT CURRENT_USER();
        -&#62; '@localhost'
</PRE>

<A NAME="IDX1310"></A>
<A NAME="IDX1311"></A>
<DT><code>PASSWORD(str)</code>
<DD>
<DT><code>OLD_PASSWORD(str)</code>
<DD>
Создает строку "пароля" из простого текста в аргументе <code>str</code>. Именно эта
функция используется в целях шифрования паролей MySQL для хранения в
столбце <code>Password</code> в таблице привилегий <code>user</code>:


<PRE>
mysql&#62; SELECT PASSWORD('badpwd');
        -&#62; '7f84554057dd964b'
</PRE>

Шифрование, которое выполняет функция <code>PASSWORD()</code>, необратимо. Способ
шифрования пароля, который используется функцией <code>PASSWORD()</code>, отличается от
применяемого для шифрования паролей в Unix. 

Функция <code>PASSWORD()</code> используется в системе аутентификации в сервер MySQL, вам не следует использовать
ее для ваших собственных приложений. С этой целью, лучше используйте функции <code>MD5()</code> и <code>SHA1()</code>.

<A NAME="IDX1312"></A>
<DT><code>ENCRYPT(str[,salt])</code>
<DD>
Шифрует аргумент <code>str</code>, используя вызов системной функции кодирования
<code>crypt()</code> из Unix. Аргумент <code>salt</code> должен быть строкой из двух символов (в
версии MySQL 3.22.16 аргумент <code>salt</code> может содержать более двух символов):


<PRE>
mysql&#62; SELECT ENCRYPT("hello");
        -&#62; 'VxuFAJXVARROc'
</PRE>

Если функция <code>crypt()</code> в данной операционной системе недоступна, функция
<code>ENCRYPT()</code> всегда возвращает <code>NULL</code>. Функция  <code>ENCRYPT()</code> игнорирует все
символы в аргументе <code>str</code>, за исключением первых восьми, по крайней мере в
некоторых операционных системах - это определяется тем, как реализован
системный вызов базовой функции <code>crypt()</code>.

<A NAME="IDX1313"></A>
<DT><code>ENCODE(str,pass_str)</code>
<DD>
Шифрует  <code>str</code>, используя аргумент  <code>pass_str</code> как пароль. Для расшифровки
результата следует использовать функцию <code>DECODE()</code>. Результат представляет
собой двоичную строку той же длины, что и <code>string</code>. Для хранения результата
в столбце следует использовать столбец типа <code>BLOB</code>.

<A NAME="IDX1314"></A>
<DT><code>DECODE(crypt_str,pass_str)</code>
<DD>
Расшифровывает зашифрованную строку <code>crypt_str</code>, используя аргумент
<code>pass_str</code> как пароль. Аргумент <code>crypt_str</code> должен быть строкой, возвращаемой
функцией <code>ENCODE()</code>.

<A NAME="IDX1315"></A>
<DT><code>MD5(string)</code>
<DD>
Вычисляет 128-битовую контрольную сумму <code>MD5</code> для аргумента <code>string</code>.
Возвращаемая величина представляет собой 32-разрядное шестнадцатеричное
число, которое может быть использовано, например, в качестве хеш-ключа:


<PRE>
mysql&#62; SELECT MD5("testing");
        -&#62; 'ae2b1fca515949e5d54fb22b8ed95575'
</PRE>

Это "<code>RSA Data Security, Inc. MD5 Message-Digest Algorithm</code>".

<A NAME="IDX1316"></A>
<A NAME="IDX1317"></A>
<DT><code>SHA1(string)</code>
<DD>
<DT><code>SHA(string)</code>
<DD>
Вычисляет 160-битовую контрольную сумму <code>SHA1</code> для аргумента <code>string</code>, как
описано в RFC 3174 (Secure  Hash  Algorithm). Возвращаемая величина
представляет собой 40-разрядное шестнадцатеричное число или <code>NULL</code> (в том
случае, если входной аргумент был равен <code>NULL</code>). Одно из возможных
применений для этой функции - в качестве хеш-ключа. Можно ее использовать
и как криптографически безопасную функцию для сохранения паролей.


<PRE>
mysql&#62; SELECT SHA1("abc");
        -&#62; 'a9993e364706816aba3e25717850c26c9cd0d89d'
</PRE>

Функция  <code>SHA1()</code> была добавлена в версии 4.0.2, и может рассматриваться как
более защищенный криптографически эквивалент функции <code>MD5()</code>. <code>SHA()</code> является
синонимом для функции <code>SHA1()</code>.

<A NAME="IDX1318"></A>
<A NAME="IDX1319"></A>
<DT><code>AES_ENCRYPT(string,key_string)</code>
<DD>
<DT><code>AES_DECRYPT(string,key_string)</code>
<DD>
Эти функции позволяют шифровать/дешифровать данные, используя официальный
алгоритм AES (Advanced  Encryption  Standard) (предыдущее название -
Rijndael). В нем применяется кодирование с 128-битовым ключом, однако при
помощи патча к исходному коду длину ключа можно увеличить до 256 битов. В
MySQL выбран 128-битовый ключ, поскольку он работает намного быстрее и
обычно обеспечивает вполне достаточную защищенность. Входные аргументы
могут быть любой длины. Если один из аргументов равен <code>NULL</code>, то результат
этой функции также будет иметь значение <code>NULL</code>. 

Так как AES является
алгоритмом блочного уровня, то для декодирования используется дополнение
строк нечетной длины, так, чтобы длина результирующей строки могла
вычисляться как выражение <code>16*(trunc(длина_строки/16)+1)</code>. 

Если <code>AES_DECRYPT()</code> обнаруживает некорректные данные или некорректное 
заполнение строки (<em>имеет в виду padding - прим. пер.</em>), функция вернет
<code>NULL</code>. Однако <code>AES_DECRYPT()</code> вполне может вернуть не-<code>NULL</code> величину, или, возможно,
просто мусор, если входные данных или ключ - некорректны.

<code>AES_DECRYPT()</code> имеет также модификацию, возвращающую величину со
значением, не равным <code>NULL</code>, даже при неправильном ключе. Функции AES можно
использовать для хранения данных в зашифрованном виде путем модификации
запросов:


<PRE>
INSERT INTO t VALUES (1,AES_ENCRYPT("text","password"));
</PRE>

Можно добиться еще более высокого уровня защищенности за счет исключения
передачи ключа через соединение для каждого запроса - для этого ключ на
время соединения должен сохраняться в переменной на сервере:


<PRE>
SELECT @password:="my password";
INSERT INTO t VALUES (1,AES_ENCRYPT("text",@password));
</PRE>

Функции  <code>AES_ENCRYPT()</code> и <code>AES_DECRYPT()</code> были добавлены в версию 4.0.2 и
могут рассматриваться как наиболее криптографически защищенные шифрующие
функции, в настоящее время доступные в MySQL.

<A NAME="IDX1320"></A>
<DT><code>DES_ENCRYPT(string_to_encrypt [, (key_number | key_string) ] )</code>
<DD>
Шифрует строку с заданным ключом, используя алгоритм тройного DES. Следует
учитывать, что эта функция работает только тогда, когда конфигурация MySQL
поддерживает SSL. See section <A HREF="manual.ru.html#Secure_connections">4.3.9  Использование безопасных соединений</A>. Ключ для
использования при шифровании выбирается следующим образом:

<TABLE BORDER>
<TR><TD><strong>Аргумент</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD>Только один аргумент </TD><TD> Используется первый ключ из <code>des-key-file</code>
</TD></TR>
<TR><TD>Номер ключа </TD><TD> Используется заданный ключ (0-9) из <code>des-key-file</code>
</TD></TR>
<TR><TD>Строка </TD><TD> Для шифрования <code>string_to_encrypt</code> может использоваться ключ, заданный в <code>key_string</code>
</TD></TR>
</TABLE>

Функция возвращает двоичную строку, в которой первый символ будет 
<code>CHAR(128 | key_number)</code>. Число <code>128</code> добавлено для упрощения распознавания
зашифрованного ключа. При использовании строкового ключа <code>key_number</code> будет
равен <code>127</code>. При ошибке эта функция возвращает <code>NULL</code>. Длина строки в
результате будет равна <code>new_length=org_length + (8-(org_length % 8))+1</code>.
Выражение <code>des-key-file</code> имеет следующий форматt:


<PRE>
key_number des_key_string
key_number des_key_string
</PRE>

Каждый элемент <code>key_number</code> должен быть числом от 0 до 9. Строки в данном
файле могут располагаться в произвольном порядке. Выражение <code>des_key_string</code>
представляет собой строку, которая будет использована при шифровании
сообщения. Между числом и ключом должен быть по крайней мере один пробел.
Первый ключ используется по умолчанию, если не задан какой-либо аргумент
ключа в функции <code>DES_ENCRYPT()</code>. Существует возможность послать MySQL запрос
на чтение новых значений ключей из файла ключей при помощи команды <code>FLUSH 
DES_KEY_FILE</code>. Эта операция требует наличия привилегии <code>Reload_priv</code>. Одно из
преимуществ наличия набора ключей по умолчанию состоит в том, что
приложения могут проверять существование зашифрованных величин в столбцах
без предоставления конечному пользователю права расшифровки этих величин.


<PRE>
mysql&#62; SELECT customer_address FROM customer_table WHERE
        crypted_credit_card = DES_ENCRYPT("credit_card_number");
</PRE>

<A NAME="IDX1321"></A>
<DT><code>DES_DECRYPT(string_to_decrypt [, key_string])</code>
<DD>
Дешифрует строку, зашифрованную с помощью функции <code>DES_ENCRYPT()</code>. Следует
учитывать, что эта функция работает только тогда, когда конфигурация MySQL
поддерживает SSL. See section <A HREF="manual.ru.html#Secure_connections">4.3.9  Использование безопасных соединений</A>. Если аргумент
<code>key_string</code> не задан, то функция <code>DES_DECRYPT()</code> проверяет первый байт
зашифрованной строки для определения номера ключа алгоритма DES,
использованного для шифрования исходной строки, Затем читает ключ из
<code>des-key-file</code> для расшифровки сообщения. Чтобы выполнить это, пользователь
должен обладать привилегией <code>SUPER</code>. При указании значения аргумента в
<code>key_string</code> эта строка используется как ключ для дешифровки сообщения. Если
строка <code>string_to_decrypt</code> не выглядит как зашифрованная, то MySQL вернет
заданную строку <code>string_to_decrypt</code>. При ошибке эта функция возвращает <code>NULL</code>.

<A NAME="IDX1322"></A>
<DT><code>LAST_INSERT_ID([expr])</code>
<DD>
Возвращает последнюю автоматически сгенерированную величину, которая была
внесена в столбец <code>AUTO_INCREMENT</code>. See section <A HREF="manual.ru.html#mysql_insert_id">8.4.3.31  <code>mysql_insert_id()</code></A>.


<PRE>
mysql&#62; SELECT LAST_INSERT_ID();
        -&#62; 195
</PRE>

Значение последнего сгенерированного <code>ID</code> сохраняется на сервере для данного
конкретного соединения и не будет изменено другим клиентом. Оно не будет
изменено даже при обновлении другого столбца <code>AUTO_INCREMENT</code> конкретной
величиной (то есть, которая не равна <code>NULL</code> и не равна <code>0</code>). При внесении
большого количества строк с помощью одной команды <code>INSERT</code> функция
<code>LAST_INSERT_ID()</code> возвращает значение для первой внесенной строки. Причина
этого заключается в том, что можно легко воспроизвести точно такую же
команду <code>INSERT</code> на другом сервере.

Если задано значение аргумента <code>expr</code> в функции <code>LAST_INSERT_ID()</code>, то
величина аргумента возвращается функцией и устанавливается в качестве
следующего значения, которое будет возвращено функцией <code>LAST_INSERT_ID()</code>.
Это можно использовать для моделирования последовательностей: 

Вначале создается таблица:


<PRE>
mysql&#62; CREATE TABLE sequence (id INT NOT NULL);
mysql&#62; INSERT INTO sequence VALUES (0);
</PRE>

Затем данную таблицу можно использовать для генерации чисел
последовательности как показано ниже:


<PRE>
mysql&#62; UPDATE sequence SET id=LAST_INSERT_ID(id+1);
</PRE>

Можно генерировать последовательности без вызова <code>LAST_INSERT_ID()</code>:
полезность применения данной функции состоит в том, что данное значение <code>ID</code>
поддерживается на сервере как последняя автоматически сгенерированная
величина (защищенная от других пользователей), и вы можете извлекать новый
<code>ID</code> так же, как и любое другое нормальное значение <code>AUTO_INCREMENT</code> в MySQL.
Например, функция <code>LAST_INSERT_ID()</code> (без аргумента) возвратит новое
значение <code>ID</code>. Функцию C  API  <code>mysql_insert_id()</code> также можно использовать
для получения этой величины. Следует учитывать, что, поскольку функция
<code>mysql_insert_id()</code> обновляется только после команд <code>INSERT</code> и <code>UPDATE</code>, то
нельзя использовать эту функцию C  API для извлечения значения <code>ID</code> для
<code>LAST_INSERT_ID(expr)</code> после выполнения других команд SQL, таких как <code>SELECT</code>
или <code>SET</code>.

<A NAME="IDX1323"></A>
<DT><code>FORMAT(X,D)</code>
<DD>
Форматирует число <code>X</code> в формат вида <code>'#,###,###.##'</code> с округлением до <code>D</code>
десятичных знаков. Если <code>D</code> равно <code>0</code>, результат будет представлен без
десятичной точки или дробной части:


<PRE>
mysql&#62; SELECT FORMAT(12332.123456, 4);
        -&#62; '12,332.1235'

mysql&#62; SELECT FORMAT(12332.1,4);
        -&#62; '12,332.1000'

mysql&#62; SELECT FORMAT(12332.2,0);
        -&#62; '12,332'
</PRE>

<A NAME="IDX1324"></A>
<DT><code>VERSION()</code>
<DD>
Возвращает строку с номером версии сервера MySQL:


<PRE>
mysql&#62; SELECT VERSION();
        -&#62; '3.23.13-log'
</PRE>

Следует учитывать, что если данная версия заканчивается с <code>-log</code>, то это
означает, что включено ведение журналов.

<A NAME="IDX1325"></A>
<DT><code>CONNECTION_ID()</code>
<DD>
Возвращает идентификатор (<code>thread_id</code>) для данного соединения. Каждое
соединение имеет свой собственный уникальный идентификатор:


<PRE>
mysql&#62; SELECT CONNECTION_ID();
        -&#62; 1
</PRE>

<A NAME="IDX1326"></A>
<DT><code>GET_LOCK(str,timeout)</code>
<DD>
Пытается осуществить блокировку по имени, которое заданно в строке <code>str</code>, с
временем ожидания в секундах, указанном в аргументе <code>timeout</code>. Возвращает <code>1</code>,
если блокировка осуществлена успешно, <code>0</code> - если закончилось время
ожидания для данной попытки, или <code>NULL</code>, если возникла ошибка (такая как
отсутствие свободной памяти или уничтожение потока командой <code>mysqladmin kill</code>).

Блокировка снимается при выполнении команды <code>RELEASE_LOCK()</code>, запуске новой
команды <code>GET_LOCK()</code> или при завершении данного потока. Эту функцию можно
использовать для осуществления блокировок уровня приложения или для
моделирования блокировки записи. Функция блокирует запросы других клиентов
на блокировку с тем же именем; клиенты, которые используют согласованные
имена блокировок, могут применять эту функцию для выполнения совместного
упредительного блокирования:


<PRE>
mysql&#62; SELECT GET_LOCK("lock1",10);
        -&#62; 1
mysql&#62; SELECT IS_FREE_LOCK("lock2");
        -&#62; 1
mysql&#62; SELECT GET_LOCK("lock2",10);
        -&#62; 1
mysql&#62; SELECT RELEASE_LOCK("lock2");
        -&#62; 1
mysql&#62; SELECT RELEASE_LOCK("lock1");
        -&#62; NULL
</PRE>

Обратите внимание: повторный вызов функции <code>RELEASE_LOCK()</code> возвращает <code>NULL</code>,
поскольку блокировка <code>lock1</code> была автоматически выполнена вторым вызовом
функции <code>GET_LOCK()</code>.

<A NAME="IDX1327"></A>
<DT><code>RELEASE_LOCK(str)</code>
<DD>
Снимает блокировку, указанную в строке <code>str</code>, полученной от функции
<code>GET_LOCK()</code>. Возвращает <code>1</code> если блокировка была снята, <code>0</code> - если такая
блокировка уже поставлена в другом соединении (в этом случае блокировка не
снимается) и <code>NULL</code>, если блокировки с указанным именем не существует.
Последнее может произойти в случае, когда вызов функции <code>GET_LOCK()</code> не
привел к успешному результату или данная блокировка уже снята. Функцию
<code>RELEASE_LOCK()</code> удобно использовать совместно с командой <code>DO</code>. 
See section <A HREF="manual.ru.html#DO">6.4.10  Синтаксис оператора <code>DO</code></A>.

<A NAME="IDX1328"></A>
<DT><code>IS_FREE_LOCK(str)</code>
<DD>
Проверяет, свободна ли блокировка по имени <code>str</code> (т.е. не установлена).
Возвращает <code>1</code> если блокировка свободна (никто не поставил таковую).
Возвращает <code>0</code> если блокировка установлена и <code>NULL</code> в случае ошибки
(например, при неправильных аргументах).

<A NAME="IDX1329"></A>
<DT><code>BENCHMARK(count,expr)</code>
<DD>
Функция <code>BENCHMARK()</code> повторяет выполнение выражения <code>expr</code> заданное
количество раз, указанное в аргументе <code>count</code>. Она может использоваться для
определения того, насколько быстро MySQL обрабатывает данное выражение.
Значение результата всегда равно <code>0</code>. Функция предназначена для
использования в клиенте <code>mysql</code>, который сообщает о времени выполнения
запроса:


<PRE>
mysql&#62; SELECT BENCHMARK(1000000,ENCODE("hello","goodbye"));
+----------------------------------------------+
| BENCHMARK(1000000,ENCODE("hello","goodbye")) |
+----------------------------------------------+
|                                            0 |
+----------------------------------------------+
1 row in set (4.74 sec)
</PRE>

Указанное в отчете время представляет собой время, подсчитанное на стороне
клиента, а не время, затраченное центральным процессором (CPU time) на
сервере. Может оказаться целесообразным выполнить <code>BENCHMARK()</code> несколько
раз, чтобы выяснить, насколько интенсивно загружен серверный компьютер.

<A NAME="IDX1330"></A>
<DT><code>INET_NTOA(expr)</code>
<DD>
По заданному числовому адресу сети (4 или 8 байтов) возвращает
представление указанного адреса в виде разделенных точками четырех октетов
в виде строки:


<PRE>
mysql&#62; SELECT INET_NTOA(3520061480);
        -&#62; "209.207.224.40"
</PRE>

<A NAME="IDX1331"></A>
<DT><code>INET_ATON(expr)</code>
<DD>
По заданному представлению сетевого адреса в виде строки, содержащей
разделенные точками четыре октета, функция возвращает целое число,
представляющее собой числовое значение данного адреса. Адреса могут быть
длиной 4 или 8 байтов:


<PRE>
mysql&#62; SELECT INET_ATON("209.207.224.40");
        -&#62; 3520061480
</PRE>

Результирующее число всегда генерируется в соответствии с порядком
расположения октетов в сетевом адресе, например вышеприведенное число
вычисляется как <code>209*256^3 + 207*256^2 + 224*256 +40</code>.

<A NAME="IDX1332"></A>
<DT><code>MASTER_POS_WAIT(log_name, log_pos)</code>
<DD>
Блокируется, пока подчиненный сервер не достигнет определенной точки положения
в журнале репликации головного сервера (т.е. не прочитает и не выполнит все
операции до указанной позиции).

Если информация головного сервера не инициализирована, или аргументы
неправильны, то функция возвращает <code>NULL</code>. Если подчиненный сервер не
работает, то функция блокируется и ожидает, пока сервер запустится и дойдет до
указанной позиции или пройдет через нее.  Если подчиненный сервер уже прошел
указанную точку, то функция немедленно возвращает результат. 

Если timeout (новшество в 4.0.10) указан, то ожидание прекратится по 
прошествии timeout секунд. Таймаут должен быть больше 0. 0 или негативный таймаут
означает тоже самое что и отсутствие таймаута. 

Возвращаемая величина представляет собой число событий в журнале, которые
функция должна была ``переждать'', пока сервер дойдет до указанной точки,
<code>NULL</code> в случае ошибки или <code>-1</code> в случае, если истек таймаут. 

<A NAME="IDX1333"></A>
<A NAME="IDX1334"></A>
<DT><code>FOUND_ROWS()</code>
<DD>
Возвращает количество строк, которые возвратила бы последняя команда
<code>SELECT SQL_CALC_FOUND_ROWS ...</code> при отсутствии ограничения оператором
<code>LIMIT</code>.


<PRE>
mysql&#62; SELECT SQL_CALC_FOUND_ROWS * FROM tbl_name WHERE id &#62; 100 LIMIT 10;
mysql&#62; SELECT FOUND_ROWS();
</PRE>

Второй вызов команды <code>SELECT</code> возвратит количество строк, которые возвратила
бы первая команда SELECT, если бы она была написана без выражения <code>LIMIT</code>.
Отметим, что, хотя при использовании команды <code>SELECT SQL_CALC_FOUND_ROWS
...</code>, MySQL должен пересчитать все строки в наборе результатов, этот способ
все равно быстрее, чем без <code>LIMIT</code>, так как не требуется посылать результат
клиенту.

Функция <code>SQL_CALC_FOUND_ROWS</code> появилась в MySQL 4.0.0.
</DL>



<H3><A NAME="Group_by_functions" HREF="manual.ru_toc.html#Group_by_functions">6.3.7  Функции, используемые в операторах <code>GROUP BY</code></A></H3>

<P>
<A NAME="IDX1335"></A>

</P>
<P>
Вызов групповых функций для SQL-команд, не содержащих <code>GROUP BY</code>,
эквивалентен выполнению этих функций над всем набором возвращаемых данных.

</P>
<DL COMPACT>

<DT><code>COUNT(expr)</code>
<DD>
<A NAME="IDX1336"></A>
 

Возвращает количество величин со значением, не равным <code>NULL</code>, в строках,
полученных при помощи команды <code>SELECT</code>:


<PRE>
mysql&#62; SELECT student.student_name,COUNT(*) FROM student,course
        WHERE student.student_id=course.student_id
        GROUP BY student_name;
</PRE>

Функция <code>COUNT(*)</code> несколько отличается от описанной выше: она возвращает
количество извлеченных строк, содержащих величины со значением <code>NULL</code>.
<code>COUNT(*)</code> оптимизирована для очень быстрого возврата результата при
условии, что команда <code>SELECT</code> извлекает данные из одной таблицы, никакие
другие столбцы не обрабатываются и функция не содержит выражения <code>WHERE</code>.
Например:


<PRE>
mysql&#62; SELECT COUNT(*) FROM student;
</PRE>

<A NAME="IDX1337"></A>
<A NAME="IDX1338"></A>
<DT><code>COUNT(DISTINCT expr,[expr...])</code>
<DD>
Возвращает количество различающихся величин со значением, не равным <code>NULL</code>:


<PRE>
mysql&#62; SELECT COUNT(DISTINCT results) FROM student;
</PRE>

В MySQL для того, чтобы получить количество различающихся комбинаций
выражений, не содержащих <code>NULL</code>, нужно просто задать список этих выражений.
В ANSI  SQL необходимо провести конкатенацию всех выражений внутри
<code>COUNT(DISTINCT ...)</code>.

<A NAME="IDX1339"></A>
<DT><code>AVG(expr)</code>
<DD>
Возвращает среднее значение аргумента expr:


<PRE>
mysql&#62; SELECT student_name, AVG(test_score)
        FROM student
        GROUP BY student_name;
</PRE>

<A NAME="IDX1340"></A>
<A NAME="IDX1341"></A>
<DT><code>MIN(expr)</code>
<DD>
<DT><code>MAX(expr)</code>
<DD>
Возвращает минимальную или максимальную величину аргумента <code>expr</code>. Функции 
<code>MIN()</code> и <code>MAX()</code> могут принимать строковый аргумент; в таких случаях они
возвращают минимальную или максимальную строковую величину. 
See section <A HREF="manual.ru.html#MySQL_indexes">5.4.3  Использование индексов в MySQL</A>.


<PRE>
mysql&#62; SELECT student_name, MIN(test_score), MAX(test_score)
        FROM student
        GROUP BY student_name;
</PRE>

В <code>MIN()</code>, <code>MAX()</code> и других групповых фунциях MySQL сейчас сравнивает <code>ENUM</code> и <code>SET</code>-столбцы по ихнему строковому представлению а не по относительной позиции строки в множестве. Это будет исправлено. 

<A NAME="IDX1342"></A>
<DT><code>SUM(expr)</code>
<DD>
Возвращает сумму величин в аргументе <code>expr</code>. Обратите внимание: если
возвращаемый набор данных не содержит ни одной строки, то функция
возвращает <code>NULL</code>!

<A NAME="IDX1343"></A>
<DT><code>VARIANCE(expr)</code>
<DD>
Возвращает вариант стандарта, которому соответствует <code>expr</code>. Это - расширение по сравнению с ANSI SQL, доступное только в 4.1 или более поздних версиях. 

<A NAME="IDX1344"></A>
<A NAME="IDX1345"></A>
<DT><code>STD(expr)</code>
<DD>
<DT><code>STDDEV(expr)</code>
<DD>
Возвращает среднеквадратичное отклонение значения в аргументе <code>expr</code>. Эта
функция является расширением ANSI  SQL. Форма <code>STDDEV()</code> обеспечивает
совместимость с Oracle.

<A NAME="IDX1346"></A>
<DT><code>BIT_OR(expr)</code>
<DD>
Возвращает побитовое ИЛИ для всех битов в <code>expr</code>. Вычисление производится с
64-битовой (<code>BIGINT</code>) точностью.

<A NAME="IDX1347"></A>
<DT><code>BIT_AND(expr)</code>
<DD>
Возвращает побитовое И для всех битов в <code>expr</code>. Вычисление производится с
64-битовой (<code>BIGINT</code>) точностью.
</DL>

<P>
В MySQL расширены возможности использования оператора <code>GROUP BY</code>. Теперь в
выражениях <code>SELECT</code> можно использовать столбцы или вычисления, которые не
присутствуют в части <code>GROUP BY</code>. Это справедливо для любой возможной
величины для этой группы. Данная возможность позволяет повысить
производительность за счет исключения сортировки и группирования ненужных
величин. Например, в следующем запросе нет необходимости в группировке
<code>customer.name</code>:

</P>

<PRE>
mysql&#62; SELECT order.custid,customer.name,MAX(payments)
        FROM order,customer
        WHERE order.custid = customer.custid
        GROUP BY order.custid;
</PRE>

<P>
В ANSI  SQL к предложению <code>GROUP BY</code>  необходимо добавлять <code>customer.name</code>. В
MySQL, если работа происходит не в режиме ANSI, это имя избыточно.

</P>
<P>
Не используйте данное свойство, если столбцы, пропущенные в части <code>GROUP 
BY</code>, не являются уникальными в данной группе! Возможны непредсказуемые
результаты.

</P>
<P>
В некоторых случаях можно применять функции <code>MIN()</code> и <code>MAX()</code> для получения
указанной величины столбца, даже если он не является уникальным. В
следующем примере выдается значение столбца <code>column</code> из строки, содержащей
наименьшую величину в столбце <code>sort</code>:

</P>

<PRE>
SUBSTR(MIN(CONCAT(RPAD(sort,6,' '),column)),7)
</PRE>

<P>
See section <A HREF="manual.ru.html#example-Maximum-column-group-row">3.5.4  Строка, содержащая максимальное значение некоторого столбца</A>.

</P>
<P>
<A NAME="IDX1348"></A>
<A NAME="IDX1349"></A>
<A NAME="IDX1350"></A>
<A NAME="IDX1351"></A>
<A NAME="IDX1352"></A>

</P>

<P>
Следует отметить, что в версии MySQL 3.22 (или более ранней) либо при
попытке работы в рамках ANSI  SQL применение выражений в предложениях
<code>GROUP BY</code> или <code>ORDER BY</code> невозможно. Это ограничение можно обойти,
используя для выражения псевдоним:

</P>

<PRE>
mysql&#62; SELECT id,FLOOR(value/100) AS val FROM tbl_name
        GROUP BY id,val ORDER BY val;
</PRE>

<P>
В версии MySQL 3.23 можно также выполнить следующее:

</P>

<PRE>
mysql&#62; SELECT id,FLOOR(value/100) FROM tbl_name ORDER BY RAND();
</PRE>



<H2><A NAME="Data_Manipulation" HREF="manual.ru_toc.html#Data_Manipulation">6.4  Обработка данных: SELECT, INSERT, UPDATE, DELETE</A></H2>



<H3><A NAME="SELECT" HREF="manual.ru_toc.html#SELECT">6.4.1  Синтаксис оператора <code>SELECT</code></A></H3>

<P>
<A NAME="IDX1353"></A>

</P>
<P>
Оператор SELECT имеет следующую структуру:

</P>

<PRE>
SELECT [STRAIGHT_JOIN]
       [SQL_SMALL_RESULT] [SQL_BIG_RESULT] [SQL_BUFFER_RESULT]
       [SQL_CACHE | SQL_NO_CACHE] [SQL_CALC_FOUND_ROWS] [HIGH_PRIORITY]
       [DISTINCT | DISTINCTROW | ALL]
    select_expression,...
    [INTO {OUTFILE | DUMPFILE} 'file_name' export_options]
    [FROM table_references
      [WHERE where_definition]
      [GROUP BY {unsigned_integer | col_name | formula} [ASC | DESC], ...]
      [HAVING where_definition]
      [ORDER BY {unsigned_integer | col_name | formula} [ASC | DESC], ...]
      [LIMIT [offset,] rows | rows OFFSET offset]
      [PROCEDURE procedure_name(argument_list)]
      [FOR UPDATE | LOCK IN SHARE MODE]]
</PRE>

<P>
<code>SELECT</code> применяется для извлечения строк, выбранных из одной или нескольких
таблиц. Выражение <code>select_expression</code> задает столбцы, в которых необходимо
проводить выборку. Кроме того, оператор  <code>SELECT</code> можно использовать для
извлечения строк, вычисленных без ссылки на какую-либо таблицу. Например:

</P>

<PRE>
mysql&#62; SELECT 1 + 1;
        -&#62; 2
</PRE>

<P>
При указании ключевых слов следует точно соблюдать порядок, указанный
выше. Например, выражение <code>HAVING</code> должно располагаться после всех выражений
<code>GROUP BY</code> и перед всеми выражениями <code>ORDER BY</code>.

</P>

<UL>
<LI>

<A NAME="IDX1354"></A>
 
Используя ключевое слово <code>AS</code>, выражению в <code>SELECT</code> можно присвоить
псевдоним. Псевдоним используется в качестве имени столбца в данном
выражении и может применяться в <code>ORDER BY</code> или <code>HAVING</code>. Например:


<PRE>
mysql&#62; SELECT CONCAT(last_name,', ',first_name) AS full_name
        FROM mytable ORDER BY full_name;
</PRE>

<LI>

Псевдонимы столбцов нельзя использовать в выражении  <code>WHERE</code>, поскольку
находящиеся в столбцах величины на момент выполнения <code>WHERE</code>  могут быть
еще не определены. See section <A HREF="manual.ru.html#Problems_with_alias">A.5.4  Проблемы  с <code>alias</code></A>.

<LI>

<A NAME="IDX1355"></A>
<A NAME="IDX1356"></A>
<A NAME="IDX1357"></A>
<A NAME="IDX1358"></A>
<A NAME="IDX1359"></A>
<A NAME="IDX1360"></A>
Выражение <code>FROM table_references</code> задает таблицы, из которых надлежит
извлекать строки. Если указано имя более чем одной таблицы, следует
выполнить объединение. Информацию о синтаксисе объединения можно найти
в разделе section <A HREF="manual.ru.html#JOIN">6.4.1.1  Синтаксис оператора <code>JOIN</code></A>. Для каждой заданной таблицы по желанию можно
указать псевдоним.


<PRE>
table_name [[AS] alias] [[USE INDEX (key_list)] | [IGNORE INDEX (key_list)] | FORCE INDEX (key_list)]]
</PRE>

В версии MySQL 3.23.12 можно указывать, какие именно индексы (ключи) MySQL
должен применять для извлечения информации из таблицы. Это полезно, если
оператор <code>EXPLAIN</code> (выводящий информацию о структуре и порядке выполнения
запроса <code>SELECT</code>), показывает, что MySQL из списка возможных индексов выбрал неправильный. Если
нужно. чтобы для поиска записи в таблице применялся только один из
возможных индексов, следует задать значение этого индекса в <code>USE INDEX</code>
(<code>key_list</code>). Альтернативное выражение <code>IGNORE INDEX (key_list)</code> запрещает
использование в MySQL данного конкретного индекса. 

В MySQL 4.0.9 можно также указывать <code>FORCE INDEX</code>. Это работает также, как
и <code>USE INDEX (key_list)</code> но в дополнение дает понять серверу что полное
сканирование таблицы будет ОЧЕНЬ дорогостоящей операцией. Другими словами, в
этом случае сканирование таблицы будет использовано только тогда, когда не
будет найдено другого способа использовать один из данных индексов для поиска
записей в таблице. 

Выражения <code>USE/IGNORE
KEY</code> являются синонимами для <code>USE/IGNORE INDEX</code>.

<LI>

Ссылки на таблицы могут даваться как <code>tbl_name</code> (в рамках текущей базы данных),
или как <code>dbname.tbl_name</code> с тем, чтобы четко указать базу данных.

Ссылки на столбцы могут задаваться в виде <code>col_name</code>, <code>tbl_name.col_name</code>
или <code>db_name.tbl_name.col_name</code>. В выражениях <code>tbl_name</code> или
<code>db_name.tbl_name</code> нет необходимости указывать префикс  для ссылок на
столбцы в команде <code>SELECT</code>, если эти ссылки нельзя истолковать
неоднозначно. See section <A HREF="manual.ru.html#Legal_names">6.1.2  Имена баз данных, таблиц, столбцов, индексы псевдонимы</A>, где приведены примеры неоднозначных случаев, для которых
требуются более четкие определения ссылок на столбцы.

<LI>

<A NAME="IDX1361"></A>
Ссылку на таблицу можно заменить псевдонимом, используя <code>tbl_name [AS]
alias_name</code>:


<PRE>
mysql&#62; SELECT t1.name, t2.salary FROM employee AS t1, info AS t2
        WHERE t1.name = t2.name;

mysql&#62; SELECT t1.name, t2.salary FROM employee t1, info t2
        WHERE t1.name = t2.name;
</PRE>

<LI>

В выражениях <code>ORDER BY</code> и <code>GROUP BY</code> для ссылок на столбцы, выбранные
для вывода информации, можно использовать либо имена столбцов, либо их
псевдонимы, либо их позиции (местоположения). Нумерация позиций
столбцов начинается с <code>1</code>:


<PRE>
mysql&#62; SELECT college, region, seed FROM tournament
        ORDER BY region, seed;

mysql&#62; SELECT college, region AS r, seed AS s FROM tournament
        ORDER BY r, s;

mysql&#62; SELECT college, region, seed FROM tournament
        ORDER  BY 2, 3;
</PRE>

Для того чтобы сортировка производилась в обратном порядке, в утверждении
<code>ORDER BY</code>  к имени заданного столбца, в котором производится сортировка,
следует добавить ключевое слово <code>DESC</code> (убывающий). По умолчанию принята
сортировка в возрастающем порядке, который можно задать явно при помощи
ключевого слова <code>ASC</code>.

<LI>

В выражении <code>WHERE</code> можно использовать любую из функций, которая
поддерживается в MySQL. See section <A HREF="manual.ru.html#Functions">6.3  Функции, используемые в операторах <code>SELECT</code> и <code>WHERE</code></A>.

Выражение <code>HAVING</code> может ссылаться на любой столбец или псевдоним,
упомянутый в выражении <code>select_expression</code>. <code>HAVING</code> отрабатывается
последним, непосредственно перед отсылкой данных клиенту, и без какой бы
то ни было оптимизации. Не используйте это выражение для определения того, что должно
быть определено в <code>WHERE</code>. Например, нельзя задать следующий оператор:


<PRE>
mysql&#62; SELECT col_name FROM tbl_name HAVING col_name &#62; 0;
</PRE>

Вместо этого следует задавать:


<PRE>
mysql&#62; SELECT col_name FROM tbl_name WHERE col_name &#62; 0;
</PRE>

В версии MySQL 3.22.5 или более поздней можно также писать запросы, как
показано ниже:


<PRE>
mysql&#62; SELECT user,MAX(salary) FROM users
        GROUP BY user HAVING MAX(salary)&#62;10;
</PRE>

В более старых версиях MySQL вместо этого можно указывать:


<PRE>
mysql&#62; SELECT user,MAX(salary) AS sum FROM users
        GROUP BY user HAVING sum&#62;10;
</PRE>

<LI>

Параметры (опции) <code>DISTINCT</code>, <code>DISTINCTROW</code> и <code>ALL</code> указывают, должны ли
возвращаться дублирующиеся записи. По умолчанию установлен параметр
(<code>ALL</code>), т.е. возвращаются все встречающиеся строки. <code>DISTINCT</code> и
<code>DISTINCTROW</code> являются синонимами и указывают, что дублирующиеся строки
в результирующем наборе данных должны быть удалены.

<LI>

Все параметры, начинающиеся с <code>SQL_</code>, <code>STRAIGHT_JOIN</code> и <code>HIGH_PRIORITY</code>,
представляют собой расширение MySQL для ANSI  SQL.

<LI>

При указании параметра  <code>HIGH_PRIORITY</code> содержащий его оператор <code>SELECT</code>
будет иметь более высокий приоритет, чем команда обновления таблицы.
Нужно только использовать этот параметр с запросами, которые должны
выполняться очень быстро и сразу. Если таблица заблокирована для
чтения, то запрос <code>SELECT HIGH_PRIORITY</code> будет выполняться даже при
наличии команды обновления, ожидающей, пока таблица освободится.

<LI>

Параметр  <code>SQL_BIG_RESULT</code> можно использовать с <code>GROUP BY</code> или <code>DISTINCT</code>,
чтобы сообщить оптимизатору, что результат будет содержать большое
количество строк. Если указан этот параметр, MySQL при необходимости
будет непосредственно использовать временные таблицы на диске, однако
предпочтение будет отдаваться не созданию временной таблицы с ключом
по элементам <code>GROUP BY</code>, а сортировке данных.

<LI>

При указании параметра  <code>SQL_BUFFER_RESULT</code>  MySQL будет заносить
результат во временную таблицу. Таким образом MySQL получает
возможность раньше снять блокировку таблицы; это полезно также для
случаев, когда для посылки результата клиенту требуется значительное
время.

<LI>

Параметр  <code>SQL_SMALL_RESULT</code> является опцией, специфической для MySQL.
Данный параметр можно использовать с <code>GROUP BY</code> или <code>DISTINCT</code>, чтобы
сообщить оптимизатору, что результирующий набор данных будет
небольшим. В этом случае MySQL для хранения результирующей таблицы
вместо сортировки будет использовать быстрые временные таблицы. В
версии MySQL 3.23 указывать данный параметр обычно нет необходимости.

<LI>

Параметр <code>SQL_CALC_FOUND_ROWS</code> (MySQL 4.0.0 и более новый) возвращает
количество строк, которые вернул бы оператор <code>SELECT</code>, если бы не был
указан <code>LIMIT</code>. Искомое количество строк можно получить при помощи
<code>SELECT FOUND_ROWS()</code>. See section <A HREF="manual.ru.html#Miscellaneous_functions">6.3.6.2  Разные функции</A>.

Заметьте, что в версиях MySQL до 4.1.0 это не работает с <code>LIMIT 0</code>,
который оптимизирован для того, чтобы немедленно вернуть нулевой результат.
See section <A HREF="manual.ru.html#LIMIT_optimisation">5.2.8  Как MySQL оптимизирует <code>LIMIT</code></A>.

<LI>

Параметр  <code>SQL_CACHE</code> предписывает MySQL сохранять результат запроса в
кэше запросов при использовании <code>QUERY_CACHE_TYPE=2</code> (<code>DEMAND</code>).
See section <A HREF="manual.ru.html#Query_Cache">6.9  Кэш запросов в MySQL</A>.

<LI>

Параметр  <code>SQL_NO_CACHE</code> запрещает MySQL хранить результат запроса в
кэше запросов. See section <A HREF="manual.ru.html#Query_Cache">6.9  Кэш запросов в MySQL</A>.

<LI>

<A NAME="IDX1362"></A>
При использовании выражения <code>GROUP BY</code> строки вывода будут
сортироваться в соответствии с порядком, заданным в <code>GROUP BY</code>, - так,
как если бы применялось выражение <code>ORDER BY</code> для всех полей, указанных
в <code>GROUP BY</code>. В MySQL выражение <code>GROUP BY</code> расширено таким образом, что
для него можно также указывать параметры <code>ASC</code> и <code>DESC</code>:


<PRE>
SELECT a,COUNT(b) FROM test_table GROUP BY a DESC
</PRE>

<LI>

Расширенный оператор <code>GROUP BY</code> в MySQL обеспечивает, в частности,
возможность выбора полей, не упомянутых в выражении <code>GROUP BY</code>. Если
ваш запрос не приносит ожидаемых результатов, прочтите, пожалуйста,
описание <code>GROUP BY</code>. See section <A HREF="manual.ru.html#Group_by_functions">6.3.7  Функции, используемые в операторах <code>GROUP BY</code></A>.

<LI>

При указании параметра  <code>STRAIGHT_JOIN</code> оптимизатор будет объединять
таблицы в том порядке, в котором они перечислены в выражении <code>FROM</code>.
Применение данного параметра позволяет увеличить скорость выполнения
запроса, если оптимизатор производит объединение таблиц неоптимальным
образом. See section <A HREF="manual.ru.html#EXPLAIN">5.2.1  Синтаксис оператора <code>EXPLAIN</code> (получение информации о <code>SELECT</code>)</A>.

<LI>

Выражение <code>LIMIT</code> может использоваться для ограничения количества строк,
возвращенных командой <code>SELECT</code>. <code>LIMIT</code> принимает один или два числовых
аргумента. Эти аргументы должны быть целочисленными константами. Если
заданы два аргумента, то первый указывает на начало первой
возвращаемой строки, а второй задает максимальное количество
возвращаемых строк. При этом смещение начальной строки равно <code>0</code> (не <code>1</code>):

Для совместимости с PostgreSQL MySQL также поддерживает синтаксис
<code>LIMIT # OFFSET #</code>.


<PRE>
mysql&#62; SELECT * FROM table LIMIT 5,10; # возвращает строки 6-15
</PRE>

Для того, чтобы выбрать все строки с определенного смещения и до конца
результата, вы можете использовать значение <code>-1</code> в качестве второго параметра: 


<PRE>
mysql&#62; SELECT * FROM table LIMIT 95,-1; # Retrieve rows 96-last.
</PRE>

Если задан один аргумент, то он показывает максимальное количество
возвращаемых строк:


<PRE>
mysql&#62; SELECT * FROM table LIMIT 5; # возвращает первых 5 строк
</PRE>

Другими словами, <code>LIMIT n</code> эквивалентно <code>LIMIT 0,n</code>.

<LI>

<A NAME="IDX1363"></A>
Оператор <code>SELECT</code> может быть представлен в форме <code>SELECT ... INTO 
OUTFILE 'file_name'</code>. Эта разновидность команды осуществляет запись
выбранных строк в файл, указанный в <code>file_name</code>. Данный файл создается
на сервере и до этого не должен существовать (таким образом, помимо
прочего, предотвращается разрушение таблиц и файлов, таких как
<tt>`/etc/passwd'</tt>). Для использования этой формы команды <code>SELECT</code> необходимы
привилегии <code>FILE</code>. Форма <code>SELECT ... INTO OUTFILE</code> главным образом
предназначена для выполнения очень быстрого дампа таблицы на серверном
компьютере. Команду <code>SELECT ... INTO OUTFILE</code> нельзя применять, если
необходимо создать результирующий файл на ином хосте, отличном от
серверного. В таком случае для генерации нужного файла вместо этой
команды следует использовать некоторую клиентскую программу наподобие
<code>mysqldump --tab</code> или <code>mysql -e "SELECT ..." &#62; outfile</code>. Команда  <code>SELECT
... INTO OUTFILE</code> является дополнительной по отношению к <code>LOAD DATA 
INFILE</code>; синтаксис части export_options этой команды содержит те же
выражения <code>FIELDS</code> и <code>LINES</code>, которые используются в команде <code>LOAD DATA 
INFILE</code>. See section <A HREF="manual.ru.html#LOAD_DATA">6.4.9  Синтаксис оператора  <code>LOAD DATA INFILE</code></A>. Следует учитывать, что в
результирующем текстовом файле оператор <code>ESCAPED BY</code> экранирует только
следующие символы:


<UL>
<LI>Символ оператора <code>ESCAPED BY</code>

<LI>Первый символ оператора <code>FIELDS TERMINATED BY</code>

<LI>Первый символ оператора <code>LINES TERMINATED BY</code>

</UL>

Помимо этого ASCII-символ <code>0</code> конвертируется в <code>ESCAPED BY</code>, за которым
следует символ <samp>`0'</samp> (ASCII 48). Это делается потому, что необходимо
экранировать любые символы операторов <code>FIELDS TERMINATED BY</code>, <code>ESCAPED BY</code>
или <code>LINES TERMINATED BY</code>, чтобы иметь надежную возможность повторить
чтение этого файла. ASCII <code>0</code> экранируется, чтобы облегчить просмотр файла с
помощью программ вывода типа pager. Поскольку результирующий файл не
должен удовлетворять синтаксису SQL, нет необходимости экранировать
что-либо еще. Ниже приведен пример того, как получить файл в формате,
который используется многими старыми программами.


<PRE>
SELECT a,b,a+b INTO OUTFILE "/tmp/result.text"
FIELDS TERMINATED BY ',' OPTIONALLY ENCLOSED BY '"'
LINES TERMINATED BY "\n"
FROM test_table;
</PRE>

<LI>

<A NAME="IDX1364"></A>
Если вместо <code>INTO OUTFILE</code>  использовать <code>INTO DUMPFILE</code>, то MySQL
запишет в файл только одну строку без символов завершения столбцов или
строк и без какого бы то ни было экранирования. Это полезно для
хранения данных типа <code>BLOB</code> в файле.

<LI>

Следует учитывать, что любой файл, созданный с помощью <code>INTO OUTFILE</code> и
<code>INTO DUMPFILE</code>, будет доступен для записи всем пользователям! Причина
этого заключается в следующем: сервер MySQL не может создавать файл,
принадлежащий только какому-либо текущему пользователю (вы никогда не
можете запустить <code>mysqld</code> от пользователя <code>root</code>), соответственно, файл
должен быть доступен для записи всем пользователям.

При использовании <code>FOR UPDATE</code> с обработчиком таблиц, поддерживающим
блокировку страниц/строк, выбранные строки будут заблокированы для записи.
</UL>



<H4><A NAME="JOIN" HREF="manual.ru_toc.html#JOIN">6.4.1.1  Синтаксис оператора <code>JOIN</code></A></H4>

<P>
<A NAME="IDX1365"></A>
<A NAME="IDX1366"></A>
<A NAME="IDX1367"></A>
<A NAME="IDX1368"></A>
<A NAME="IDX1369"></A>
<A NAME="IDX1370"></A>
<A NAME="IDX1371"></A>
<A NAME="IDX1372"></A>
<A NAME="IDX1373"></A>
<A NAME="IDX1374"></A>
<A NAME="IDX1375"></A>
<A NAME="IDX1376"></A>

</P>
<P>
MySQL поддерживает следующий синтаксис оператора <code>JOIN</code> при использовании в
командах <code>SELECT</code>:

</P>

<PRE>
table_reference, table_reference
table_reference [CROSS] JOIN table_reference
table_reference INNER JOIN table_reference join_condition
table_reference STRAIGHT_JOIN table_reference
table_reference LEFT [OUTER] JOIN table_reference join_condition
table_reference LEFT [OUTER] JOIN table_reference
table_reference NATURAL [LEFT [OUTER]] JOIN table_reference
{ OJ table_reference LEFT OUTER JOIN table_reference ON conditional_expr }
table_reference RIGHT [OUTER] JOIN table_reference join_condition
table_reference RIGHT [OUTER] JOIN table_reference
table_reference NATURAL [RIGHT [OUTER]] JOIN table_reference
</PRE>

<P>
где <code>table_reference</code> определено, как:
<A NAME="IDX1377"></A>

<PRE>
table_name [[AS] alias] [[USE INDEX (key_list)] | [IGNORE INDEX (key_list)] | [FORCE INDEX (key_list)]]
</PRE>

<P>
и <code>join_condition</code> определено, как:

</P>

<PRE>
ON conditional_expr |
USING (column_list)
</PRE>

<P>
В большинстве случаев не следует указывать в части <code>ON</code>  какие бы то ни
было условия, накладывающие ограничения на строки в наборе результатов (из
этого правила есть исключения). Если необходимо указать, какие строки должны
присутствовать в результате, следует сделать это в выражении <code>WHERE</code>.

</P>
<P>
Необходимо учитывать, что в версиях до 3.23.17 оператор <code>INNER JOIN</code> не
принимает параметр <code>join_condition</code>!

</P>
<P>
<A NAME="IDX1378"></A>
<A NAME="IDX1379"></A>
Наличие последней из приведенных выше конструкций выражения <code>LEFT OUTER 
JOIN</code> обусловлено только требованиями совместимости с ODBC:

</P>

<UL>
<LI>

Вместо ссылки на таблицу может использоваться псевдоним, который
присваивается при помощи выражений <code>tbl_name AS alias_name</code> или
<code>tbl_name alias_name</code>:


<PRE>
mysql&#62; SELECT t1.name, t2.salary FROM employee AS t1, info AS t2
        WHERE t1.name = t2.name;
</PRE>

<LI>

Условный оператор <code>ON</code> представляет собой условие в любой форме из числа
тех, которые можно использовать в выражении <code>WHERE</code>.

<LI>

Если запись для правой таблицы в частях <code>ON</code> или <code>USING</code> в <code>LEFT JOIN</code> не
найдена, то для данной таблицы используется строка, в которой все
столбцы установлены в <code>NULL</code>. Эту возможность можно применять для
нахождения результатов в таблице, не имеющей эквивалента в другой
таблице:


<PRE>
mysql&#62; SELECT table1.* FROM table1
        LEFT JOIN table2 ON table1.id=table2.id
        WHERE table2.id IS NULL;
</PRE>

Этот пример находит все строки в таблице <code>table1</code> с величиной <code>id</code>, которая
не присутствует в таблице <code>table2</code> (т.е. все строки в <code>table1</code>, для которых
нет соответствующих строк в <code>table2</code>). Конечно, это предполагает, что
<code>table2.id</code> объявлен как <code>NOT NULL</code>. See section <A HREF="manual.ru.html#LEFT_JOIN_optimisation">5.2.6  Как MySQL оптимизирует <code>LEFT JOIN</code> и <code>RIGHT JOIN</code></A>.

<LI>

<code>USING (column_list)</code> служит для указания списка столбцов, которые
должны существовать в обеих таблицах. Такое выражение <code>USING</code>, как:


<PRE>
A LEFT JOIN B USING (C1,C2,C3,...)
</PRE>

семантически идентично выражению <code>ON</code>, например:


<PRE>
A.C1=B.C1 AND A.C2=B.C2 AND A.C3=B.C3,...
</PRE>

<LI>

Выражение <code>NATURAL [LEFT] JOIN</code> для двух таблиц определяется так, чтобы
оно являлось семантическим эквивалентом <code>INNER JOIN</code> или <code>LEFT JOIN</code> с
выражением <code>USING</code>, в котором указаны все столбцы, имеющиеся в обеих
таблицах.

<LI>

<code>INNER JOIN</code> и <code>,</code> (запятая) являются семантическими эквивалентами. Оба
осуществляют полное объединение используемых таблиц. Способ связывания
таблиц обычно задается в условии <code>WHERE</code>.

<LI>

<code>RIGHT JOIN</code> работает аналогично <code>LEFT JOIN</code>. Для сохранения
переносимости кода между различными базами данных рекомендуется вместо
<code>RIGHT JOIN</code>  использовать <code>LEFT JOIN</code>.

<LI>

<code>STRAIGHT_JOIN</code> идентично <code>JOIN</code>, за исключением того, что левая таблица
всегда читается раньше правой. Это выражение может использоваться для
тех (немногих) случаев, когда оптимизатор объединения располагает
таблицы в неправильном порядке.

<LI>

<A NAME="IDX1380"></A>
<A NAME="IDX1381"></A>
Начиная с версии  MySQL 3.23.12, можно давать MySQL указания о том,
какой индекс должен использоваться при извлечении информации из
таблицы. Эта возможность полезна, если оператор <code>EXPLAIN</code> 
показывает, что MySQL из всех возможных индексов использует ошибочный. Задавая значение
индекса в  <code>USE INDEX (key_list)</code>, можно заставить MySQL применять для
поиска записи только один из возможных индексов. Альтернативное
выражение  <code>IGNORE INDEX (key_list)</code> запрещает использование в MySQL
данного конкретного индекса. Выражения <code>USE/IGNORE KEY</code> являются
синонимами для <code>USE/IGNORE INDEX</code>.

<A NAME="IDX1382"></A>
В MySQL 4.0.9 можно также указывать <code>FORCE INDEX</code>. Это работает также, как
и <code>USE INDEX (key_list)</code> но в дополнение дает понять серверу что полное
сканирование таблицы будет ОЧЕНЬ дорогостоящей операцией. Другими словами, в
этом случае сканирование таблицы будет использовано только тогда, когда не
будет найдено другого способа использовать один из данных индексов для поиска
записей в таблице. 
</UL>

<P>
<A NAME="IDX1383"></A>
<A NAME="IDX1384"></A>

</P>
<P>
Несколько примеров:

</P>

<PRE>
mysql&#62; SELECT * FROM table1,table2 WHERE table1.id=table2.id;
mysql&#62; SELECT * FROM table1 LEFT JOIN table2 ON table1.id=table2.id;
mysql&#62; SELECT * FROM table1 LEFT JOIN table2 USING (id);
mysql&#62; SELECT * FROM table1 LEFT JOIN table2 ON table1.id=table2.id
       LEFT JOIN table3 ON table2.id=table3.id;
mysql&#62; SELECT * FROM table1 USE INDEX (key1,key2)
       WHERE key1=1 AND key2=2 AND key3=3;
mysql&#62; SELECT * FROM table1 IGNORE INDEX (key3)
       WHERE key1=1 AND key2=2 AND key3=3;
</PRE>

<P>
See section <A HREF="manual.ru.html#LEFT_JOIN_optimisation">5.2.6  Как MySQL оптимизирует <code>LEFT JOIN</code> и <code>RIGHT JOIN</code></A>.

</P>


<H4><A NAME="UNION" HREF="manual.ru_toc.html#UNION">6.4.1.2  Синтаксис оператора  <code>UNION</code></A></H4>

<P>
<A NAME="IDX1385"></A>

</P>

<PRE>
SELECT ...
UNION [ALL]
SELECT ...
  [UNION 
   SELECT ...]
</PRE>

<P>
Оператор <code>UNION</code> реализован в MySQL 4.0.0.

</P>
<P>
<code>UNION</code> используется для объединения результатов работы нескольких команд
<code>SELECT</code> в один набор результатов.

</P>
<P>
Столбцы, перечисленные в части <code>select_expression</code> должны быть одинакового типа.
Имена столбцов, указанные в первом <code>SELECT</code> будут использованы как имена столбцов для 
всего результата. 

</P>
<P>
Эти команды <code>SELECT</code> являются обычными командами выборки данных, но со
следующим ограничением:

</P>

<UL>
<LI>

Только последняя команда <code>SELECT</code> может включать оператор <code>INTO OUTFILE</code>.
</UL>

<P>
Если не используется ключевое слово <code>ALL</code> для <code>UNION</code>, все возвращенные строки
будут уникальными, так как по умолчанию подразумевается <code>DISTINCT</code> для всего
результирующего набора данных. Если указать ключевое слово <code>ALL</code>, то
результат будет содержать все найденные строки из всех примененных команд
<code>SELECT</code>.

</P>
<P>
Если для всего результата <code>UNION</code>  необходимо применить оператор <code>ORDER BY</code>,
следует использовать круглые скобки:

</P>

<PRE>
(SELECT a FROM table_name WHERE a=10 AND B=1 ORDER BY a LIMIT 10)
UNION
(SELECT a FROM table_name WHERE a=11 AND B=2 ORDER BY a LIMIT 10)
ORDER BY a;
</PRE>



<H3><A NAME="HANDLER" HREF="manual.ru_toc.html#HANDLER">6.4.2  Синтаксис оператора  <code>HANDLER</code></A></H3>

<P>
<A NAME="IDX1386"></A>

</P>

<PRE>
HANDLER tbl_name OPEN [ AS alias ]
HANDLER tbl_name READ index_name { = | &#62;= | &#60;= | &#60; } (value1,value2,...)
    [ WHERE ... ] [LIMIT ... ]
HANDLER tbl_name READ index_name { FIRST | NEXT | PREV | LAST }
    [ WHERE ... ] [LIMIT ... ]
HANDLER tbl_name READ { FIRST | NEXT }
    [ WHERE ... ] [LIMIT ... ]
HANDLER tbl_name CLOSE
</PRE>

<P>
Оператор <code>HANDLER</code> обеспечивает прямой доступ к интерфейсу обработчика
таблиц <code>MyISAM</code>.

</P>
<P>
Первая форма оператора  <code>HANDLER</code> открывает таблицу, делая ее доступной для
последовательности команд <code>HANDLER ... READ</code>. Этот объект недоступен другим
потокам и не будет закрыт, пока данный поток не вызовет <code>HANDLER tbl_name 
CLOSE</code> или сам поток не будет уничтожен.

</P>
<P>
Вторая форма выбирает одну строку (или больше - в соответствии с
установкой в выражении <code>LIMIT</code>), для которой(ых) указанный индекс
соответствует заданному условию и условие в выражении <code>WHERE</code> также
выполняется. Если индекс состоит из нескольких частей (охватывает
несколько столбцов), то составляющие его величины указываются в виде
разделенного запятыми списка. Обеспечиваются величины только для
нескольких первых столбцов.

</P>
<P>
Третья форма выбирает одну строку (или больше - в соответствии с
установкой в выражении <code>LIMIT</code>), из таблицы; в порядке указания индексов в
соответствии с условием <code>WHERE</code>.

</P>
<P>
Четвертая форма (без указания индексов) выбирает одну строку (или больше -
в соответствии с установкой в выражении <code>LIMIT</code>), из таблицы, используя
естественный порядок строк (как они хранятся в файле данных), в
соответствии с условием <code>WHERE</code>. Эта форма работает быстрее, чем <code>HANDLER 
tbl_name READ index_name</code>, в тех случаях, когда желателен просмотр всей
таблицы.

</P>
<P>
Оператор  <code>HANDLER ... CLOSE</code> закрывает таблицу, открытую оператором 
<code>HANDLER ... OPEN</code>.

</P>
<P>
Оператор  <code>HANDLER</code> представляет собой что-то наподобие низкоуровневой
команды. Например, он не обеспечивает целостности таблицы. Т.е. <code>HANDLER
... OPEN</code> НЕ делает моментального снимка таблицы и НЕ блокирует ее. Отсюда
следует, что после вызова команды <code>HANDLER ... OPEN</code> данные таблицы могут
быть модифицированы (этим или любым другим потоком), а сами модификации в
просмотрах таблицы при помощи <code>HANDLER ... NEXT</code> или <code>HANDLER ... PREV</code>  могут
появляться только частично.

</P>
<P>
Вот причины, по которым вы можете предпочесть HANDLER вместо обычного SQL:

</P>

<UL>
<LI>

Он быстрее чем <code>SELECT</code>, потому что: 

<UL>
<LI>

Выделенный код обработчика таблиц создается в потоке по вызову <code>HANDLER open</code>. 
<LI>

Меньше синтаксического анализа. 
<LI>

Нет нагрузки на оптимизацию и проверку. 
<LI>

Таблицу не нужно блокировать между запросами.
<LI>

Этот интерфейс не обязан предоставлять целостный вид данных (скажем, грязное
чтение допускается), что позволяет обработчику таблиц делать оптимизации
которые SQL обычно не допускает. 
</UL>

<LI>

Гораздо легче переносить на MySQL приложения, которые используют интерфейс, подобный ISAM.
<LI>

Такой интерфейс позволяет просматривать базу данных способом, который не 
так легко (или в некоторых случаях и вовсе невозможно) реализовать с помощью SQL.
Интерфейс HANDLER является более естественным способом получить данные, когда приходится
иметь дело с интерактивными пользовательскими приложениями.
</UL>



<H3><A NAME="INSERT" HREF="manual.ru_toc.html#INSERT">6.4.3  Синтаксис оператора <code>INSERT</code></A></H3>

<P>
<A NAME="IDX1387"></A>

</P>

<PRE>
    INSERT [LOW_PRIORITY | DELAYED] [IGNORE]
        [INTO] tbl_name [(col_name,...)]
        VALUES (expression,...),(...),...
        [ ON DUPLICATE KEY UPDATE col_name=expression, ... ]
или INSERT [LOW_PRIORITY | DELAYED] [IGNORE]
        [INTO] tbl_name [(col_name,...)]
        SELECT ...
или INSERT [LOW_PRIORITY | DELAYED] [IGNORE]
        [INTO] tbl_name
        SET col_name=(expression | DEFAULT), ...
        [ ON DUPLICATE KEY UPDATE col_name=expression, ... ]

</PRE>

<P>
<A NAME="IDX1388"></A>
<A NAME="IDX1389"></A>

</P>
<P>
Оператор <code>INSERT</code> вставляет новые строки в существующую таблицу. Форма
данной команды  <code>INSERT ... VALUES</code> вставляет строки в соответствии с точно
указанными в команде значениями. Форма <code>INSERT ... SELECT</code> вставляет строки,
выбранные из другой таблицы или таблиц. Форма <code>INSERT ... VALUES</code> со списком
из нескольких значений поддерживается в версии MySQL 3.22.5 и более
поздних. Синтаксис выражения <code>col_name=expression</code> поддерживается в версии
MySQL 3.22.10 и более поздних.

</P>
<P>
<code>tbl_name</code> задает таблицу, в которую должны быть внесены строки. Столбцы,
для которых заданы величины в команде, указываются в списке имен столбцов
или в части <code>SET</code>:

</P>

<UL>
<LI>

Если не указан список столбцов для <code>INSERT ... VALUES</code> или <code>INSERT ...
SELECT</code>, то величины для всех столбцов должны быть определены в списке
<code>VALUES()</code> или в результате работы <code>SELECT</code>. Если порядок столбцов в
таблице неизвестен, для его получения можно использовать <code>DESCRIBE tbl_name</code>.

<LI>

<A NAME="IDX1390"></A>
Любой столбец, для которого явно не указано значение, будет установлен
в свое значение по умолчанию. Например, если в заданном списке
столбцов не указаны все столбцы в данной таблице, то не упомянутые
столбцы устанавливаются в свои значения по умолчанию. Установка
значений по умолчанию описывается в разделе section <A HREF="manual.ru.html#CREATE_TABLE">6.5.3  Синтаксис оператора <code>CREATE TABLE</code></A>. 

Вы также можете использовать ключевое слово <code>DEFAULT</code> для того, чтобы
установить столбец в его значение по умолчанию (новшество в MySQL 4.0.3). Это
облегчает написание <code>INSERT</code>, присвающим значения всем, за исключением
одного-двух, столбцам, т.к. такой ситнаксис позволяет вам обойтись без указания
списка столбцов, которые оператор <code>INSERT</code> должен обновить. 

В MySQL всегда предусмотрено значение по умолчанию для каждого поля. Это
требование ``навязано'' MySQL, чтобы обеспечить возможность работы как с
таблицами, поддерживающими транзакции, так и с таблицами, не поддерживающими
их. 

Наша точка зрения (разработчиков) состоит в том, что проверка содержимого полей
должна производиться приложением, а не сервером баз данных.

<LI>

Выражение <code>expression</code> может относится к любому столбцу, который ранее
был внесен в список значений. Например, можно указать следующее:


<PRE>
mysql&#62; INSERT INTO tbl_name (col1,col2) VALUES(15,col1*2);
</PRE>

Но нельзя указать:


<PRE>
mysql&#62; INSERT INTO tbl_name (col1,col2) VALUES(col2*2,15);
</PRE>

<LI>

Если указывается ключевое слово <code>LOW_PRIORITY</code>, то выполнение данной
команды <code>INSERT</code> будет задержано до тех пор, пока другие клиенты не
завершат чтение этой таблицы. В этом случае данный клиент должен
ожидать, пока данная команда вставки не будет завершена, что в случае
интенсивного использования таблицы может потребовать значительного
времени. В противоположность этому команда <code>INSERT DELAYED</code> позволяет
данному клиенту продолжать операцию сразу же. See section <A HREF="manual.ru.html#INSERT_DELAYED">6.4.4  Синтаксис оператора <code>INSERT DELAYED</code></A>. 
Следует отметить, что указатель <code>LOW_PRIORITY</code> обычно не
используется с таблицами <code>MyISAM</code>, поскольку при его указании становятся
невозможными параллельные вставки. See section <A HREF="manual.ru.html#MyISAM">7.1  Таблицы <code>MyISAM</code></A>.

<LI>

Если в команде <code>INSERT</code> со строками, имеющими много значений,
указывается ключевое слово <code>IGNORE</code>, то все строки, имеющие
дублирующиеся ключи <code>PRIMARY</code> или <code>UNIQUE</code>  в этой таблице, будут
проигнорированы и не будут внесены. Если не указывать <code>IGNORE</code>, то
данная операция вставки прекращается при обнаружении строки, имеющей
дублирующееся значение существующего ключа. Количество строк,
внесенных в данную таблицу, можно определить при помощи функции C  API
<code>mysql_info()</code>.

<LI>

Если вы указываете <code>ON DUPLICATE KEY UPDATE</code> (новшество в MySQL 4.1.0), 
и производится вставка строки, которая вызывает ошибку дублирующегося первичного (<code>PRIMARY</code>) или 
уникального (<code>UNIQUE</code>) ключа, то вполняется <code>UPDATE</code> старой строки. 

Например: 


<PRE>
mysql&#62; INSERT INTO table (a,b,c) VALUES (1,2,3)
   --&#62; ON DUPLICATE KEY UPDATE c=c+1;
</PRE>

Если <code>a</code> определяется как <code>UNIQUE</code> и уже содержит <code>1</code>, то тогда
вышеуказанная команда будет аналогична следующей: 


<PRE>
mysql&#62; UPDATE table SET c=c+1 WHERE a=1;
</PRE>

<strong>Внимание:</strong> если столбец  <code>b</code> также является уникальным ключем, то 
<code>UPDATE</code> переписывается как: 


<PRE>
mysql&#62; UPDATE table SET c=c+1 WHERE a=1 OR b=2 LIMIT 1;
</PRE>

и если несколько записей соответствуют <code>a=1 OR b=2</code> только <strong>одна</strong> запись
будет обновлена! В общем случае, следует избегать использования <code>ON DUPLICATE KEY</code> на таблицах со множеством уникальных (<code>UNIQUE</code>) ключей. 

Когда используется <code>ON DUPLICATE KEY UPDATE</code>,
опция <code>DELAYED</code> будет проигнорирована.

<LI>

Если MySQL был сконфигурирован с использованием опции
<code>DONT_USE_DEFAULT_FIELDS</code>, то команда <code>INSERT</code> будет генерировать ошибку,
если явно не указать величины для всех столбцов, которые требуют
значений не-<code>NULL</code>. See section <A HREF="manual.ru.html#configure_options">2.3.3  Типичные опции <code>configure</code></A>.

<LI>

С помощью функции <code>mysql_insert_id</code> можно найти величину, использованную
для столбца <code>AUTO_INCREMENT</code>. See section <A HREF="manual.ru.html#mysql_insert_id">8.4.3.31  <code>mysql_insert_id()</code></A>.

</UL>

<P>
Если задается команда <code>INSERT ... SELECT</code> или <code>INSERT ... VALUES</code> со списками
из нескольких значений, то для получения информации о данном запросе можно
использовать функцию C API <code>mysql_info()</code>. Формат этой информационной строки
приведен ниже:

</P>

<PRE>
Records: 100 Duplicates: 0 Warnings: 0
</PRE>

<P>
<code>Duplicates</code> показывает число строк, которые не могли быть внесены,
поскольку они дублировали бы значения некоторых существующих уникальных
индексов. Указатель <code>Warnings</code> показывает число попыток внести величину в
столбец, который по какой-либо причине оказался проблематичным.
Предупреждения возникают при выполнении любого из следующих условий:

</P>

<UL>
<LI>

Внесение <code>NULL</code> в столбец, который был объявлен, как <code>NOT NULL</code>. Данный
столбец устанавливается в значение, заданное по умолчанию.

<LI>

Установка числового столбца в значение, лежащее за пределами его
допустимого диапазона. Данная величина усекается до соответствующей
конечной точки этого диапазона.

<LI>

Занесение в числовой столбец такой величины, как <code>'10.34 a'</code>. Конечные
данные удаляются и вносится только оставшаяся числовая часть. Если
величина вовсе не имеет смысла как число, то столбец устанавливается в
<code>0</code>.

<LI>

Внесение в столбцы типа <code>CHAR</code>, <code>VARCHAR</code>, <code>TEXT</code> или <code>BLOB</code> строки,
превосходящей максимальную длину столбца. Данная величина усекается до
максимальной длины столбца.

<LI>

Внесение в столбец даты или времени строки, недопустимой для данного
типа столбца. Этот столбец устанавливается в нулевую величину,
соответствующую данному типу.
</UL>

<P>
<A NAME="IDX1391"></A>
<A NAME="IDX1392"></A>

</P>


<H4><A NAME="INSERT_SELECT" HREF="manual.ru_toc.html#INSERT_SELECT">6.4.3.1  Синтаксис оператора <code>INSERT ... SELECT</code></A></H4>


<PRE>
INSERT [LOW_PRIORITY] [IGNORE] [INTO] tbl_name [(column list)] SELECT ...
</PRE>

<P>
Команда <code>INSERT ... SELECT</code> обеспечивает возможность быстрого внесения
большого количества строк в таблицу из одной или более таблиц.

</P>

<PRE>
INSERT INTO tblTemp2 (fldID) SELECT tblTemp1.fldOrder_ID 
        FROM tblTemp1
        WHERE tblTemp1.fldOrder_ID &#62; 100;
</PRE>

<P>
Для команды <code>INSERT ... SELECT</code> необходимо соблюдение следующих условий:

</P>

<UL>
<LI>

Целевая таблица команды <code>INSERT</code> не должна появляться в утверждении <code>FROM</code>
части <code>SELECT</code> данного запроса, поскольку в ANSI  SQL запрещено
производить выборку из той же таблицы, в которую производится вставка.
(Проблема заключается в том, что операция <code>SELECT</code>, возможно, найдет
записи, которые были внесены ранее в течение того же самого прогона
команды. При использовании команд, внутри которых содержатся
многоступенчатые выборки, можно легко попасть в очень запутанную
ситуацию!)

<LI>

Столбцы <code>AUTO_INCREMENT</code> работают, как обычно.

<LI>

Для получения информации о данном запросе можно использовать функцию C
API <code>mysql_info()</code>. See section <A HREF="manual.ru.html#INSERT">6.4.3  Синтаксис оператора <code>INSERT</code></A>.

<LI>

Чтобы гарантировать возможность использования журнала
обновлений/двоичного журнала для восстановления исходного состояния
таблиц, в MySQL во время выполнения команды <code>INSERT ... SELECT</code> 
параллельные вставки не разрешаются.
</UL>

<P>
Разумеется, для перезаписи старых строк можно вместо <code>INSERT</code>  использовать
<code>REPLACE</code>.

</P>


<H3><A NAME="INSERT_DELAYED" HREF="manual.ru_toc.html#INSERT_DELAYED">6.4.4  Синтаксис оператора <code>INSERT DELAYED</code></A></H3>

<P>
<A NAME="IDX1393"></A>
<A NAME="IDX1394"></A>

</P>
<P>
<A NAME="IDX1395"></A>

</P>


<PRE>
INSERT  DELAYED ...
</PRE>

<P>
Опция <code>DELAYED</code> для команды <code>INSERT</code> является специфической для MySQL
возможностью, которая очень полезна, если клиент не может ждать завершения
команды <code>INSERT</code>. Такая проблема встречается часто - она возникает, когда
MySQL используется для ведения журналов (проще говоря, для логгинга) и при
этом периодически запускаются команды <code>SELECT</code> и <code>UPDATE</code>, для выполнения
которых требуется много времени. Оператор <code>DELAYED</code> был введен в версию
MySQL 3.22.15. Он является расширением MySQL к ANSI  SQL92.

</P>
<P>
<code>INSERT DELAYED</code> работает только с таблицами типа <code>ISAM</code> и <code>MyISAM</code>. Следует
учитывать, что таблицы <code>MyISAM</code> поддерживают одновременное выполнение <code>SELECT</code>
и <code>INSERT</code>, поэтому если нет свободных блоков в середине файла данных, то
необходимость в применении <code>INSERT DELAYED</code> возникает очень редко. 
See section <A HREF="manual.ru.html#MyISAM">7.1  Таблицы <code>MyISAM</code></A>.

</P>
<P>
При использовании оператора <code>INSERT DELAYED</code> клиент сразу же получает
успешный ответ от сервера, а запись будет добавлена в таблицу сразу же
после того, как эту таблицу перестанет использовать другой поток.

</P>
<P>
Еще одно существенное преимущество применения оператора <code>INSERT DELAYED</code>
заключается в том, что данные от многих клиентов собираются вместе и
записываются одним блоком. Это намного быстрее, чем несколько отдельных
операций вставки.

</P>
<P>
Обратите внимание: в настоящее время все записи, поставленные в очередь на
добавление, хранятся только в памяти до тех пор, пока они не будут
записаны на диск. Отсюда следует, что если выполнение <code>mysqld</code> будет
завершено принудительно (<code>kill -9</code>) или программа умрет, то все находящиеся
в очереди данные, которые не записаны на диск, будут потеряны!.

</P>
<P>
Ниже детально описано, что происходит при использовании опции <code>DELAYED</code> в
командах <code>INSERT</code> или <code>REPLACE</code>. В этом описании ``поток'' понимается как
поток, принимающий команду <code>INSERT DELAYED</code>, а ``обработчик'' - это поток,
который обрабатывает все команды <code>INSERT DELAYED</code> в конкретной таблице.

</P>

<UL>
<LI>

При выполнении потоком команды <code>DELAYED</code> для таблицы создается
поток-обработчик для обработки всех команд <code>DELAYED</code> в данной таблице,
если подобный обработчик уже не существует.

<LI>

Данный поток проверяет, выполнил ли уже обработчик блокировку <code>DELAYED</code>;
если нет, то он предписывает обработчику сделать это. Блокировка
<code>DELAYED</code> может быть осуществлена даже в случае, если блокировки <code>READ</code>
или <code>WRITE</code> на данной таблице уже выполнены другими потоками. Однако
обработчик будет ожидать всех блокировок <code>ALTER TABLE</code> и завершения
всех команд <code>FLUSH TABLES</code>, чтобы убедиться в том, что структура
таблицы соответствует последнему обновлению.

<LI>

Поток выполняет команду <code>INSERT</code>, но вместо записи строки в таблицу он
ставит финальную копию этой строки в очередь, управляемую
потоком-обработчиком. Поток отмечает все синтаксические ошибки и
сообщает о них клиентской программе.

<LI>

Клиент не может уведомить о количестве дубликатов или значении
<code>AUTO_INCREMENT</code> для данной результирующей строки; он также не может
получить эти данные с сервера, поскольку команда <code>INSERT</code> возвращает
результат до полного завершения операции вставки. По той же причине
ничего существенного не даст и использование функции C  API 
<code>mysql_info()</code>.

<LI>

Обновление журнала обновлений производится потоком-обработчиком после
вставки строки в таблицу. В случае многострочной вставки обновление
журнала обновлений производится при записи первой строки.

<A NAME="IDX1396"></A>
<A NAME="IDX1397"></A>
<LI>

После записи каждых <code>delayed_insert_limit</code> строк, обработчик проверяет,
не находятся ли в ожидании выполнения какие-либо команды <code>SELECT</code>. Если
да, то обработчик перед продолжением своей работы ``пропускает их
вперед'' на выполнение.

<LI>

Если очередь обработчика больше не содержит строк, то с данной таблицы
будет снята блокировка. Если в течение <code>delayed_insert_timeout</code> секунд
не поступят никакие новые команды <code>INSERT DELAYED</code>, то обработчик
завершит свою работу.

<LI>

Если более, чем <code>delayed_queue_size</code> строк уже ожидают в очереди
обработчика, то поток, запрашивающий <code>INSERT DELAYED</code>, будет ждать,
пока не освободится место в очереди. Таким образом можно иметь
уверенность в том, что <code>mysqld</code> не займет всю память сервера для
хранения запросов данной очереди.

<LI>

Поток-обработчик будет наблюдаться в списке процессов MySQL  со
значением <code>delayed_insert</code> в столбце <code>Command</code>. Поток-обработчик можно
уничтожить запуском команды <code>FLUSH TABLES</code> или командой <code>KILL 
номер_потока</code>. Однако перед своим завершением он вначале сохранит в
таблице все поставленные в очередь строки. В процессе сохранения он не
будет принимать никаких новых команд <code>INSERT</code> от иного потока. При
выполнении после этого команды <code>INSERT DELAYED</code> будет создан новый
поток-обработчик. Обратите внимание: отсюда следует, что команды
<code>INSERT DELAYED</code> имеют более высокий приоритет, чем обычные команды
<code>INSERT</code>, если уже существует запущенный обработчик <code>INSERT DELAYED</code>!
Другие команды обновления должны ожидать, пока не опустеет очередь
<code>INSERT DELAYED</code> или же пока кто-либо не прекратит выполнение
потока-обработчика (с помощью <code>KILL номер_потока</code>) или не выполнит <code>FLUSH
TABLES</code>.

<LI>

Представленные в таблице переменные обеспечивают информацию об <code>INSERT 
DELAYED</code>:

<TABLE BORDER>
<TR><TD><strong>Переменная</strong> </TD><TD> <strong>Значение</strong>
</TD></TR>
<TR><TD><code>Delayed_insert_threads</code> </TD><TD> Количество потоков-обработчиков
</TD></TR>
<TR><TD><code>Delayed_writes</code> </TD><TD> Количество строк, записанных <code>INSERT DELAYED</code>
</TD></TR>
<TR><TD><code>Not_flushed_delayed_rows</code> </TD><TD> Количество строк, ожидающих записи
</TD></TR>
</TABLE>

<LI>

Чтобы увидеть эти переменные, следует вызвать команду <code>SHOW STATUS</code> или
выполнить команду <code>mysqladmin extended-status</code>.
</UL>

<P>
Обратите внимание: если данная таблица не используется, то команда  <code>INSERT
DELAYED</code> работает медленнее, чем обычная команда <code>INSERT</code>. Кроме того,
возникает дополнительная нагрузка на сервер, поскольку требуется управлять
отдельным потоком для каждой таблицы, для которой используется <code>INSERT 
DELAYED</code>. Это означает, что команду <code>INSERT DELAYED</code> следует применять
только тогда, когда в ней есть реальная необходимость!

</P>


<H3><A NAME="UPDATE" HREF="manual.ru_toc.html#UPDATE">6.4.5  Синтаксис оператора  <code>UPDATE</code></A></H3>

<P>
<A NAME="IDX1398"></A>

</P>

<PRE>
UPDATE [LOW_PRIORITY] [IGNORE] tbl_name
    SET col_name1=expr1 [, col_name2=expr2 ...]
    [WHERE where_definition]
    [ORDER BY ...]
    [LIMIT rows]

или

UPDATE [LOW_PRIORITY] [IGNORE] tbl_name [, tbl_name ...]
    SET col_name1=expr1 [, col_name2=expr2 ...]
    [WHERE where_definition]
</PRE>

<P>
Оператор <code>UPDATE</code> обновляет столбцы в соответствии с их новыми значениями в
строках существующей таблицы. В выражении <code>SET</code> указывается, какие именно
столбцы следует модифицировать и какие величины должны быть в них
установлены. В выражении <code>WHERE</code>, если оно присутствует, задается, какие
строки подлежат обновлению. В остальных случаях обновляются все строки.
Если задано выражение <code>ORDER BY</code>, то строки будут обновляться в указанном в
нем порядке.

</P>
<P>
Если указывается ключевое слово <code>LOW_PRIORITY</code>, то выполнение данной команды
<code>UPDATE</code> задерживается до тех пор, пока другие клиенты не завершат чтение
этой таблицы.

</P>
<P>
Если указывается ключевое слово <code>IGNORE</code>, то команда обновления не будет
прервана, даже если при обновлении возникнет ошибка дублирования ключей.
Строки, из-за которых возникают конфликтные ситуации, обновлены не будут.

</P>
<P>
Если доступ к столбцу из указанного выражения осуществляется по аргументу
<code>tbl_name</code>, то команда <code>UPDATE</code> использует для этого столбца его текущее
значение. Например, следующая команда устанавливает столбец <code>age</code> в
значение, на единицу большее его текущей величины:

</P>

<PRE>
mysql&#62; UPDATE persondata SET age=age+1;
</PRE>

<P>
Значения команда <code>UPDATE</code> присваивает слева направо. Например, следующая
команда удваивает значение в столбце <code>age</code>, затем инкрементирует его:

</P>

<PRE>
mysql&#62; UPDATE persondata SET age=age*2, age=age+1;
</PRE>

<P>
Если столбец устанавливается в его текущее значение, то MySQL замечает это
и не обновляет его.

</P>
<P>
Команда  <code>UPDATE</code> возвращает количество фактически измененных строк. В
версии MySQL 3.22 и более поздних функция C  API  <code>mysql_info()</code> возвращает
количество строк, которые были найдены и обновлены, и количество
предупреждений, имевших место при выполнении <code>UPDATE</code>.

</P>
<P>
В версии MySQL 3.23 можно использовать <code>LIMIT #</code>, чтобы убедиться, что было
изменено только заданное количество строк.

</P>
<P>
Начиная с версии MySQL 4.0.4 вы также можете выполнять <code>UPDATE</code>, охватывающий множество таблиц: 

</P>

<PRE>
UPDATE items,month SET items.price=month.price
WHERE items.id=month.id;
</PRE>

<P>
Обратите внимание:  вы не можете использовать <code>ORDER BY</code> или <code>LIMIT</code> для многотабличных обновлений.

</P>


<H3><A NAME="DELETE" HREF="manual.ru_toc.html#DELETE">6.4.6  Синтаксис оператора <code>DELETE</code></A></H3>

<P>
<A NAME="IDX1399"></A>

</P>

<PRE>
DELETE [LOW_PRIORITY] [QUICK] FROM table_name
       [WHERE where_definition]
       [ORDER BY ...]
       [LIMIT rows]
</PRE>

<P>
или

</P>

<PRE>
DELETE [LOW_PRIORITY] [QUICK] table_name[.*] [, table_name[.*] ...]
       FROM table-references
       [WHERE where_definition]
</PRE>

<P>
или

</P>

<PRE>
DELETE [LOW_PRIORITY] [QUICK]
       FROM table_name[.*] [, table_name[.*] ...]
       USING table-references
       [WHERE where_definition]
</PRE>

<P>
Оператор <code>DELETE</code> удаляет из таблицы <code>table_name</code> строки, удовлетворяющие
заданным в <code>where_definition</code> условиям, и возвращает число удаленных
записей.

</P>
<P>
Если оператор <code>DELETE</code> запускается без определения <code>WHERE</code>, то удаляются все
строки. При работе в режиме <code>AUTOCOMMIT</code> это будет аналогично использованию
оператора <code>TRUNCATE</code>. See section <A HREF="manual.ru.html#TRUNCATE">6.4.7  Синтаксис оператора <code>TRUNCATE</code></A>. В MySQL 3.23 оператор 
<code>DELETE</code> без определения <code>WHERE</code> возвратит ноль как число удаленных записей.

</P>
<P>
Если действительно необходимо знать число удаленных записей при удалении
всех строк, и если допустимы потери в скорости, то можно использовать
команду <code>DELETE</code> в следующей форме:

</P>

<PRE>
mysql&#62; DELETE FROM table_name WHERE 1&#62;0;
</PRE>

<P>
Следует учитывать, что эта форма работает намного медленнее, чем <code>DELETE 
FROM table_name</code> без выражения <code>WHERE</code>, поскольку строки удаляются
поочередно по одной.

</P>
<P>
Если указано ключевое слово <code>LOW_PRIORITY</code>, выполнение данной команды <code>DELETE</code>
будет задержано до тех пор, пока другие клиенты не завершат чтение этой
таблицы.

</P>
<P>
Если задан параметр <code>QUICK</code>, то обработчик таблицы при выполнении удаления
не будет объединять индексы - в некоторых случаях это может ускорить
данную операцию.

</P>
<P>
В таблицах <code>MyISAM</code> удаленные записи сохраняются в связанном списке, а
последующие операции <code>INSERT</code> повторно используют места, где располагались
удаленные записи. Чтобы возвратить неиспользуемое пространство и уменьшить
размер файлов, можно применить команду <code>OPTIMIZE TABLE</code> или утилиту
<code>myisamchk</code> для реорганизации таблиц. Команда <code>OPTIMIZE TABLE</code> проще, но
утилита <code>myisamchk</code> работает быстрее. See section <A HREF="manual.ru.html#OPTIMIZE_TABLE">4.5.1  Синтаксис  команды <code>OPTIMIZE TABLE</code></A>. See section <A HREF="manual.ru.html#Optimisation">4.4.6.10  Оптимизация  таблиц</A>.

</P>
<P>
Первый из числа приведенных в начале данного раздела многотабличный формат
команды <code>DELETE</code> поддерживается, начиная с MySQL 4.0.0. Второй
многотабличный формат поддерживается, начиная с MySQL 4.0.2.

</P>
<P>
Идея заключается в том, что удаляются только совпадающие строки из таблиц,
перечисленных перед выражениями <code>FROM</code> или <code>USING</code>. Это позволяет удалять
единовременно строки из нескольких таблиц, а также использовать для поиска
дополнительные таблицы.

</P>
<P>
Символы <code>.*</code> после имен таблиц требуются только для совместимости с Access:

</P>

<PRE>
DELETE t1,t2 FROM t1,t2,t3 WHERE t1.id=t2.id AND t2.id=t3.id
</PRE>

<P>
или

</P>

<PRE>
DELETE FROM t1,t2 USING t1,t2,t3 WHERE t1.id=t2.id AND t2.id=t3.id
</PRE>

<P>
В предыдущем случае просто удалены совпадающие строки из таблиц <code>t1</code> и <code>t2</code>.

</P>
<P>
Если применяется выражение <code>ORDER BY</code> (доступно с версии MySQL 4.0), то
строки будут удалены в указанном порядке. В действительности это выражение
полезно только в сочетании с <code>LIMIT</code>. Например:

</P>

<PRE>
DELETE FROM somelog
        WHERE user = 'jcole'
        ORDER BY timestamp
        LIMIT 1
</PRE>

<P>
Данный оператор удалит самую старую запись (по <code>timestamp</code>), в которой
строка соответствует указанной в выражении <code>WHERE</code>.

</P>
<P>
Специфическая для MySQL опция <code>LIMIT</code> для команды <code>DELETE</code> указывает
серверу максимальное количество строк, которые следует удалить до возврата
управления клиенту. Эта опция может использоваться для гарантии того, что
данная команда <code>DELETE</code> не потребует слишком много времени для выполнения.
Можно просто повторять команду <code>DELETE</code> до тех пор, пока количество
удаленных строк меньше, чем величина <code>LIMIT</code>.

</P>
<P>
С MySQL 4.0 вы можете указать множество таблиц в <code>DELETE</code> чтобы удалить записи из одной таблицы, основываясь на 
условии по множеству таблиц. Однако, с такой формой оператора <code>DELETE</code> нельзя использовать <code>ORDER BY</code> или <code>LIMIT</code>.

</P>


<H3><A NAME="TRUNCATE" HREF="manual.ru_toc.html#TRUNCATE">6.4.7  Синтаксис оператора <code>TRUNCATE</code></A></H3>

<P>
<A NAME="IDX1400"></A>

</P>

<PRE>
TRUNCATE TABLE table_name
</PRE>

<P>
В версии 3.23 <code>TRUNCATE TABLE</code> выполняет последовательность <code>"COMMIT ; DELETE
FROM table_name"</code>. See section <A HREF="manual.ru.html#DELETE">6.4.6  Синтаксис оператора <code>DELETE</code></A>.

</P>
<P>
<code>TRUNCATE TABLE</code> имеет следующие отличия от <code>DELETE FROM ...</code>:

</P>

<UL>
<LI>

Эта операция удаляет и воссоздает таблицу, что намного быстрее, чем
поочередное удаление строк.

<LI>

Операция является нетранзакционной; если одновременно выполняется
транзакция или активная блокировка таблицы, то можно получить ошибку.

<LI>

Не возвращает количество удаленных строк.

<LI>

Пока существует корректный файл <tt>`table_name.frm'</tt>, таблицу можно
воссоздать с его с помощью, даже если файлы данных или индексов
повреждены.
</UL>

<P>
<code>TRUNCATE</code> является расширением Oracle  SQL.

</P>


<H3><A NAME="REPLACE" HREF="manual.ru_toc.html#REPLACE">6.4.8  Синтаксис оператора <code>REPLACE</code></A></H3>

<P>
<A NAME="IDX1401"></A>

</P>

<PRE>
    REPLACE [LOW_PRIORITY | DELAYED]
        [INTO] tbl_name [(col_name,...)]
        VALUES (expression,...),(...),...
или REPLACE [LOW_PRIORITY | DELAYED]
        [INTO] tbl_name [(col_name,...)]
        SELECT ...
или REPLACE [LOW_PRIORITY | DELAYED]
        [INTO] tbl_name
        SET col_name=expression, col_name=expression,...
</PRE>

<P>
Оператор  <code>REPLACE</code> работает точно так же, как <code>INSERT</code>, за исключением того,
что если старая запись в данной таблице имеет то же значение индекса 
<code>UNIQUE</code> или <code>PRIMARY KEY</code>, что и новая, то старая запись перед занесением
новой будет удалена. See section <A HREF="manual.ru.html#INSERT">6.4.3  Синтаксис оператора <code>INSERT</code></A>.

</P>
<P>
Другими словами, команда <code>REPLACE</code> не предоставляет доступа к замещаемой
записи. В некоторых старых версиях MySQL такой доступ иногда оказывался
возможным, но это был дефект, который уже исправлен.

</P>
<P>
Для использования <code>REPLACE</code> у вас должны быть привилегии <code>INSERT</code> и <code>DELETE</code> для таблицы.

</P>
<P>
При использовании команды <code>REPLACE</code> функция <code>mysql_affected_rows()</code> вернет
значение, равное <code>2</code>, если старая строка была заменена новой. Объясняется
это тем, что в таблицу вставляется строка после того, как удаляется дубликат. 

</P>
<P>
Это позволяет легко определять, какое действие произвела команда <code>REPLACE</code> -
добавление или замещение строки. Достаточно просто проверить, какое число
вернула функция <code>mysql_affected_rows()</code> - <code>1</code> (строка добавлена) или <code>2</code>
(замещена).

</P>
<P>
Следует учитывать, что, если не используются индексы <code>UNIQUE</code> или <code>PRIMARY 
KEY</code>, то применение команды <code>REPLACE</code> не имеет смысла, так как она работает
просто как <code>INSERT</code>.

</P>


<H3><A NAME="LOAD_DATA" HREF="manual.ru_toc.html#LOAD_DATA">6.4.9  Синтаксис оператора  <code>LOAD DATA INFILE</code></A></H3>

<P>
<A NAME="IDX1402"></A>

</P>

<PRE>
LOAD DATA [LOW_PRIORITY | CONCURRENT] [LOCAL] INFILE 'file_name.txt'
    [REPLACE | IGNORE]
    INTO TABLE tbl_name
    [FIELDS
        [TERMINATED BY '\t']
        [[OPTIONALLY] ENCLOSED BY '']
        [ESCAPED BY '\\' ]
    ]
    [LINES TERMINATED BY '\n']
    [IGNORE number LINES]
    [(col_name,...)]
</PRE>

<P>
Команда <code>LOAD DATA INFILE</code> читает строки из текстового файла и вставляет
их в таблицу с очень высокой скоростью. Если задано ключевое слово <code>LOCAL</code>,
то файл читается с клиентского хоста. Если же <code>LOCAL</code> не указывается, то
файл должен находиться на сервере. (Опция <code>LOCAL</code> доступна в версии MySQL
3.22.6 и более поздних.)

</P>
<P>
Если текстовые файлы, которые нужно прочитать, находятся на сервере, то из
соображений безопасности эти файлы должны либо размещаться в директории
базы данных, либо быть доступными для чтения всем пользователям. Кроме
того, для применения команды <code>LOAD DATA INFILE</code> к серверным файлам
необходимо обладать привилегиями <code>FILE</code> для серверного хоста. 
See section <A HREF="manual.ru.html#Privileges_provided">4.2.7  Привилегии, предоставляемые MySQL</A>.

</P>
<P>
В версиях MySQL 3.23.49 и MySQL 4.0.2 команда  <code>LOCAL</code> не будет работать в
случаях, если демон <code>mysqld</code> запущен с параметром <code>--local-infile=0</code> или если
для клиента не включена возможность поддержки <code>LOCAL</code>. See section <A HREF="manual.ru.html#LOAD_DATA_LOCAL">4.2.4  Вопросы безопасности, относящиеся к команде LOAD DATA LOCAL</A>.

</P>
<P>
Если указывается ключевое слово <code>LOW_PRIORITY</code>, то выполнение данной команды
<code>LOAD DATA</code> будет задержано до тех пор, пока другие клиенты не завершат
чтение этой таблицы.

</P>
<P>
Если указывается ключевое слово <code>CONCURRENT</code> при работе с таблицами <code>MyISAM</code>,
то другие потоки могут извлекать данные из таблицы во время выполнения
команды <code>LOAD DATA</code>. Использование этой возможности, конечно, будет немного
влиять на производительность выполнения <code>LOAD DATA</code>, даже если никакой
другой поток не использует данную таблицу в это же время.

</P>
<P>
При применении опции <code>LOCAL</code> выполнение может происходить несколько
медленнее в сравнении с предоставлением серверу доступа к файлам напрямую,
поскольку содержимое файла должно переместиться с клиентского хоста на
сервер. С другой стороны, в этом случае нет необходимости в привилегиях
<code>FILE</code> для загрузки локальных файлов.

</P>
<P>
При использовании версий MySQL до 3.23.24 при помощи команды <code>LOAD DATA 
INFILE</code> нельзя выполнять чтение из <code>FIFO</code>. Если необходимо читать из <code>FIFO</code>
(например, стандартный вывод <code>gunzip</code>), следует использовать <code>LOAD DATA 
LOCAL INFILE</code>.

</P>
<P>
Можно также загружать файлы данных, используя утилиту <code>mysqlimport</code>. Эта
утилита выполняет загрузку файлов путем посылки на сервер команд <code>LOAD 
DATA INFILE</code>. Опция <code>--local</code> заставляет <code>mysqlimport</code> читать файлы данных с
клиентского хоста. Можно указать параметр <code>--compress</code>, чтобы получить
лучшую производительность при работе через медленные сети, если и клиент,
и сервер поддерживают протокол сжатия данных.

</P>
<P>
В случаях, когда файлы находятся на сервере, последний действует по
следующим правилам:

</P>

<UL>
<LI>

Если задан абсолютный (полный) путь к файлу, то сервер использует этот
путь без изменений.

<LI>

Если задан относительный путь к файлу с указанием одного или более
начальных каталогов, то поиск файла будет осуществляться относительно
указанных каталогов в каталоге данных сервера (<code>datadir</code>).

<LI>

Если дается путь к файлу без указания начальных каталогов, то сервер
ищет этот файл в директории используемой базы данных.
</UL>

<P>
Отсюда следует, что файл, заданный как <tt>`./myfile.txt'</tt>, читается из
серверного каталога данных, в то время как файл, заданный как <tt>`myfile.txt'</tt>,
читается из каталога используемой базы данных. Например, следующая команда
<code>LOAD DATA</code> читает файл <code>data.txt</code> в каталоге базы данных для <code>db1</code>, поскольку
<code>db1</code> является текущей базой данных, даже если эта команда явно содержит
указание загрузить файл в таблицу базы данных <code>db2</code>:

</P>

<PRE>
mysql&#62; USE db1;
mysql&#62; LOAD DATA INFILE "data.txt" INTO TABLE db2.my_table;
</PRE>

<P>
Ключевые слова <code>REPLACE</code> и <code>IGNORE</code> управляют обработкой входных записей,
которые дублируют существующие записи с теми же величинами уникальных
ключей. Если указать <code>REPLACE</code>, то новые строки заменят существующие с таким
же уникальным ключом. Если указать <code>IGNORE</code>, то входные строки, имеющие тот
же уникальный ключ, что и существующие, будут пропускаться. Если не указан
ни один из параметров, то при обнаружении дублирующегося значения ключа
возникает ошибка и оставшаяся часть текстового файла игнорируется.

</P>
<P>
Если данные загружаются из локального файла с использованием ключевого
слова <code>LOCAL</code>, то сервер не сможет прервать передачу данных посреди этой
операции, поэтому по умолчанию выполнение команды происходит так же, как и
в случае, когда указывается <code>IGNORE</code>.

</P>
<P>
При использовании <code>LOAD DATA INFILE</code> на пустых таблицах <code>MyISAM</code> все
неуникальные индексы создаются в отдельном пакете (как в <code>REPAIR</code>). Обычно
это значительно ускоряет работу <code>LOAD DATA INFILE</code> в случае большого
количества индексов.

</P>
<P>
Команда <code>LOAD DATA INFILE</code> является дополнительной к <code>SELECT ... INTO
OUTFILE</code>. See section <A HREF="manual.ru.html#SELECT">6.4.1  Синтаксис оператора <code>SELECT</code></A>. Чтобы записать данные из базы данных в
файл, используется <code>SELECT ... INTO OUTFILE</code>. Чтобы прочитать данные
обратно в базу данных, используется <code>LOAD DATA INFILE</code>. Синтаксис <code>FIELDS</code> и
<code>LINES</code> одинаков в обеих командах. Обе части являются необязательными, но
если указаны оба, то <code>FIELDS</code> должно предшествовать <code>LINES</code>.

</P>
<P>
Если указывается <code>FIELDS</code>, то каждое из его подвыражений (<code>TERMINATED BY</code>,
<code>[OPTIONALLY] ENCLOSED BY</code>, и  <code>ESCAPED BY</code>) также является
необязательным, однако необходимо указать по меньшей мере одно из них.

</P>
<P>
Если утверждение <code>FIELDS</code> не определено, то по умолчанию его параметры будут
принимать следующие значения:

</P>

<PRE>
FIELDS TERMINATED BY '\t' ENCLOSED BY '' ESCAPED BY '\\'
</PRE>

<P>
Если утверждение <code>LINES</code> не определено, то по умолчанию оно имеет следующую
структуру:

</P>

<PRE>
LINES TERMINATED BY '\n'
</PRE>

<P>
Иными словами, при установках по умолчанию команда <code>LOAD DATA INFILE</code> при
чтении входных данных будет работать следующим образом:

</P>

<UL>
<LI>

Искать концы строк в виде символов <samp>`\n'</samp>

<LI>

Разбивать строки на поля по символам табуляции.

<LI>

Не ожидать, что поля могут быть заключены в символы цитирования.

<LI>

Интерпретировать встречающиеся символы табуляции, новой строки или <samp>`\'</samp>,
предваренные <samp>`\'</samp>, как литералы, являющиеся частью значения поля.
</UL>

<P>
И, наоборот, если действуют установки по умолчанию при записи выходных
данных, команда <code>SELECT ... INTO OUTFILE</code> будет работать следующим образом:

</P>

<UL>
<LI>

Вставлять символы табуляции между полями.

<LI>

Не заключать поля в символы цитирования.

Использовать символы <samp>`\'</samp> для экранирования экземпляров символов
табуляции, новой строки или <samp>`\'</samp>, которые появляются среди величин
поля.

<LI>

Вставлять символы новой строки в конце каждой записи.
</UL>

<P>
Следует учитывать, что в записи <code>FIELDS ESCAPED BY <samp>`\'</samp></code> необходимо
указывать два обратных слеша для величины, которая должна читаться как
один обратный слеш.

</P>
<P>
Опцию <code>IGNORE number LINES</code> можно применять для игнорирования заголовка
имен столбцов в начале файла:

</P>

<PRE>
mysql&#62; LOAD DATA INFILE "/tmp/file_name" INTO TABLE test IGNORE 1 LINES;
</PRE>

<P>
При использовании <code>SELECT ... INTO OUTFILE</code> совместно с <code>LOAD DATA INFILE</code>
для того, чтобы данные из базы данных прочитать в файл, а затем - обратно
из файла в базу данных, опции, обрабатывающие поля и строки, для обеих
команд должны совпадать. В противном случае <code>LOAD DATA INFILE</code> не сможет
интерпретировать содержимое данного файла правильно. Предположим, что
команда <code>SELECT ... INTO OUTFILE</code> используется для записи в файл с полями,
разделенными запятыми:

</P>

<PRE>
mysql&#62; SELECT * INTO OUTFILE 'data.txt'
        FIELDS TERMINATED BY ','
        FROM ...;
</PRE>

<P>
Чтобы прочитать этот разделенный запятыми файл обратно в базу данных,
корректная команда должна иметь вид:

</P>

<PRE>
mysql&#62; LOAD DATA INFILE 'data.txt' INTO TABLE table2
        FIELDS TERMINATED BY ',';
</PRE>

<P>
Если вместо этого попытаться прочитать этот файл с помощью команды,
представленной ниже, то она не будет работать, поскольку предписывает
команде <code>LOAD DATA INFILE</code> искать символы табуляции между полями:

</P>

<PRE>
mysql&#62; LOAD DATA INFILE 'data.txt' INTO TABLE table2
        FIELDS TERMINATED BY '\t';
</PRE>

<P>
Похожий результат получился бы, если бы каждая входная строка
интерпретировалась как отдельное поле.

</P>
<P>
Команду  <code>LOAD DATA INFILE</code> можно также использовать для чтения файлов,
полученных из внешних источников. Например, поля в файле формата базе
данных dBASE будут разделены запятыми и заключены в двойные кавычки. Если
строки в данном файле заканчиваются символами новой строки, то для записи
файла можно использовать приведенную ниже команду, в которой
проиллюстрировано задание опций, обрабатывающих поля и строки:

</P>

<PRE>
mysql&#62; LOAD DATA INFILE 'data.txt' INTO TABLE tbl_name
        FIELDS TERMINATED BY ',' ENCLOSED BY '"'
        LINES TERMINATED BY '\n';
</PRE>

<P>
Любая из опций, обрабатывающих поля и строки, может задавать пустую строку
(''). Если строка не пустая, то величины опций <code>FIELDS [OPTIONALLY]
ENCLOSED BY</code> и <code>FIELDS ESCAPED BY</code> должны содержать один символ. Величины
опций <code>FIELDS TERMINATED BY</code> и <code>LINES TERMINATED BY</code> могут содержать более
чем один символ. Например, чтобы записать строки, заканчивающиеся парами
``возврат каретки - перевод строки'' (как в текстовых файлах MS  DOS или
Windows), необходимо задать следующее выражение: 
<code>LINES TERMINATED BY '\r\n'</code>.

</P>
<P>
Например, чтобы прочитать файл <tt>`jokes'</tt>, в котором строки разделены
символами <code>%%</code>, в таблицу SQL, необходимо сделать следующее:

</P>

<PRE>
CREATE TABLE jokes (
        a INT NOT NULL AUTO_INCREMENT PRIMARY KEY, 
        joke TEXT NOT NULL);

LOAD DATA INFILE "/tmp/jokes.txt" INTO TABLE jokes FIELDS TERMINATED BY "";

LINES TERMINATED BY "\n%%\n" (joke);
</PRE>

<P>
Опция  <code>FIELDS [OPTIONALLY] ENCLOSED BY</code> служит для управления полями,
заключенными в заданные символы. Если параметр <code>OPTIONALLY</code> опущен, то в
выводе <code>(SELECT ... INTO OUTFILE)</code> все поля будут заключены в символы,
заданные в <code>ENCLOSED BY</code>. Пример такого вывода (в котором в качестве
разделителя полей используется запятая) показан ниже:

</P>

<PRE>
"1","a string","100.20"
"2","a string containing a , comma","102.20"
"3","a string containing a \" quote","102.20"
"4","a string containing a \", quote and comma","102.20"
</PRE>

<P>
Если указан параметр <code>OPTIONALLY</code>, то заданным в <code>ENCLOSED BY</code> символом
выделяются только поля типа <code>CHAR</code> и <code>VARCHAR</code>:

</P>

<PRE>
1,"a string",100.20
2,"a string containing a , comma",102.20
3,"a string containing a \" quote",102.20
4,"a string containing a \", quote and comma",102.20
</PRE>

<P>
Следует учитывать, что появление символов <code>ENCLOSED BY</code> внутри величины
поля экранируется применением перед ними префикса из <code>ESCAPED BY</code>. Также
следует учитывать, что если в <code>ESCAPED BY</code> указана пустая величина, то
существует возможность создать вывод, который оператор <code>LOAD DATA INFILE</code>
не сможет правильно прочитать. Например, если символ экранирования
является пустой строкой, то вывод, представленный выше, окажется таким,
как показано ниже. Обратите внимание: второе поле в четвертой строке
содержит запятую, следующую за кавычкой, которая (ошибочно) появляется,
чтобы ограничить данное поле:

</P>

<PRE>
1,"a string",100.20
2,"a string containing a , comma",102.20
3,"a string containing a " quote",102.20
4,"a string containing a ", quote and comma",102.20
</PRE>

<P>
Для ввода символ <code>ENCLOSED BY</code>, если он есть, удаляется из обоих концов
величин полей. (Это справедливо независимо от того, указан или нет
параметр <code>OPTIONALLY</code>: при работе с входными данными параметр <code>OPTIONALLY</code> не
учитывается.) Если встречается символ <code>ENCLOSED BY</code>, которому предшествует
символ <code>ESCAPED BY</code>, то он интерпретируется как часть текущей величины
поля. Кроме того, двойные символы <code>ENCLOSED BY</code>, встречающиеся внутри поля,
интерпретируются как одиночные символы <code>ENCLOSED BY</code>, если данное поле само
начинается с этого символа. Например, если указывается <code>ENCLOSED BY '"'</code>,
то кавычки обрабатываются, как показано ниже:

</P>

<PRE>
"The ""BIG"" boss"  -&#62; The "BIG" boss
The "BIG" boss      -&#62; The "BIG" boss
The ""BIG"" boss    -&#62; The ""BIG"" boss
</PRE>

<P>
Опция  <code>FIELDS ESCAPED BY</code> служит для управления записью или чтением
специальных символов. Если символ <code>FIELDS ESCAPED BY</code> не пустой, он
используется в качестве префикса для следующих символов в выводе:

</P>

<UL>
<LI>

Символ <code>FIELDS ESCAPED BY</code>

<LI>

Символ <code>FIELDS [OPTIONALLY] ENCLOSED BY</code>

<LI>

Первый символ величин <code>FIELDS TERMINATED BY и LINES TERMINATED BY</code>

<LI>

Символ ASCII  <code>0</code> (в действительности после экранирующего символа
пишется ASCII <samp>`0'</samp>, а не байт с нулевой величиной)
</UL>

<P>
Если символ <code>FIELDS ESCAPED BY</code> пустой, то никакие символы не
экранируются. На самом деле указывать пустой экранирующий символ нет
смысла, особенно если величины полей в обрабатываемых данных содержат
какие-либо из символов, указанных в приведенном выше списке.

</P>
<P>
Если символ <code>FIELDS ESCAPED BY</code> не пуст, то в случае входных данных
вхождения такого символа удаляются и следующий за таким вхождением символ
принимается буквально как часть величины поля. Исключениями являются
экранированные <samp>`0'</samp> или <samp>`N'</samp> (например, <code>\0</code> или <code>\N</code>, если экранирующим
символом является <samp>`\'</samp>). Эти последовательности интерпретируются как ASCII 
<code>0</code> (байт с нулевой величиной) и <code>NULL</code>. См. ниже правила обработки величины
<code>NULL</code>.

</P>
<P>
Чтобы получить более полную информацию о синтаксисе экранирующего символа
<samp>`\'</samp> см. раздел section <A HREF="manual.ru.html#Literals">6.1.1  Литералы: представление строк и чисел</A>.

</P>
<P>
В ряде случаев опции обработки полей и строк взаимодействуют:

</P>

<UL>
<LI>

Если <code>LINES TERMINATED BY</code> является пустой строкой и <code>FIELDS 
TERMINATED BY</code> является не пустой строкой, то строки также
заканчиваются символами <code>FIELDS TERMINATED BY</code>.

<LI>

Если обе величины <code>FIELDS TERMINATED BY</code> и <code>FIELDS ENCLOSED BY</code>
являются пустыми (''), то применяется формат с фиксированной строкой
(без разделителей). В формате с фиксированной строкой не предусмотрены
никакие разделители между полями. Вместо этого при чтении и записи
величин столбцов используется ширина ``вывода'' столбцов. Например,
если столбец объявлен как <code>INT(7)</code>, значения для этого столбца
записываются с использованием полей шириной <code>7</code> символов. Входные
значения для этого столбца получаются чтением <code>7</code> символов. Формат с
фиксированной строкой влияет также на обработку величин <code>NULL</code> (см.
ниже). Отметим, что формат с фиксированными размерами не будет
работать при использовании мультибайтного набора символов.
</UL>

<P>
Значения <code>NULL</code> в зависимости от используемых опций <code>FIELDS</code> и <code>LINES</code> будут
обрабатываться по-разному:

</P>

<UL>
<LI>

Для установленных по умолчанию величин <code>FIELDS</code> и <code>LINES</code>  <code>NULL</code>
записывается как <code>\N</code> для вывода и <code>\N</code> читается как <code>NULL</code> для ввода
(исходя из предположения, что символ <code>ESCAPED BY</code> равен <samp>`\'</samp>).

<LI>

Если <code>FIELDS ENCLOSED BY</code> не является пустым, то поле, значение
которого представляет собой слово из букв <code>NULL</code>, читается как величина
<code>NULL</code> (в отличие от слова <code>NULL</code>, заключенного между символами <code>FIELDS 
ENCLOSED BY</code>, которое читается как строка '<code>NULL</code>').

<LI>

Если <code>FIELDS ESCAPED BY</code> является пустым, <code>NULL</code> записывается как слово
<code>NULL</code>.

<LI>

В формате с фиксированной строкой (который имеет место, если оба
спецификатора - <code>FIELDS TERMINATED BY</code> и <code>FIELDS ENCLOSED BY</code> -
являются пустыми), <code>NULL</code> записывается как пустая строка. Отметим, что
вследствие этого величина <code>NULL</code> и пустая строка в данной таблице будут
неразличимы при записи в файл, поскольку они обе записываются как
пустые строки. Если необходимо, чтобы эти величины были различными при
обратном чтении файла, то не следует использовать формат с
фиксированной строкой.
</UL>

<P>
Некоторые случаи, не поддерживаемые оператором <code>LOAD DATA INFILE</code>:

</P>

<UL>
<LI>

Строки с фиксированным размером (обе опции <code>FIELDS TERMINATED BY</code> и
<code>FIELDS ENCLOSED BY</code> пустые) и столбцы типа <code>BLOB</code> или <code>TEXT</code>.

<LI>

Если указывается разделитель, совпадающий с другим или являющийся
префиксом другого, то <code>LOAD DATA INFILE</code> не сможет интерпретировать
ввод правильно. Например, следующее утверждение <code>FIELDS</code> вызовет
проблемы:


<PRE>
FIELDS TERMINATED BY '"' ENCLOSED BY '"'
</PRE>

<LI>

Если опция <code>FIELDS ESCAPED BY</code> пустая, то содержащееся в значении поля
вхождение символа <code>FIELDS ENCLOSED BY</code> или <code>LINES TERMINATED BY</code>, за
которым следует символ <code>FIELDS TERMINATED BY</code>, приведет к
преждевременному завершению чтения поля или строки командой <code>LOAD DATA
INFILE</code>. Это происходит вследствие того, что <code>LOAD DATA INFILE</code> не
может правильно определить, где заканчивается поле или строка.
</UL>

<P>
Следующий пример загружает все столбцы таблицы <code>persondata</code>:

</P>

<PRE>
mysql&#62; LOAD DATA INFILE 'persondata.txt' INTO TABLE persondata;
</PRE>

<P>
Список полей не указывается, следовательно, команда <code>LOAD DATA INFILE</code>
ожидает входные строки для заполнения каждого столбца таблицы. При этом
используются значения <code>FIELDS</code> и <code>LINES</code> по умолчанию.

</P>
<P>
Если требуется загрузить только некоторые из столбцов таблицы, необходимо
задать список столбцов:

</P>

<PRE>
mysql&#62; LOAD DATA INFILE 'persondata.txt'
        INTO TABLE persondata (col1,col2,...);
</PRE>

<P>
Список полей необходимо задавать и в случаях, если порядок следования
полей во входном файле отличается от порядка столбцов в данной таблице. В
противном случае MySQL не сможет установить соответствие вводимых полей и
столбцов таблицы.

</P>
<P>
Если строка имеет слишком мало полей, то столбцы, для которых отсутствуют
поля во входном файле, устанавливаются в свои значения по умолчанию.
Назначение величин по умолчанию описывается в разделе section <A HREF="manual.ru.html#CREATE_TABLE">6.5.3  Синтаксис оператора <code>CREATE TABLE</code></A>.

</P>
<P>
Значение пустого поля интерпретируется иначе, чем отсутствие значения:

</P>

<UL>
<LI>

Для строковых типов столбец устанавливается в пустую строку.

<LI>

Для числовых типов столбец устанавливается в <code>0</code>.

<LI>

Для типов даты и времени столбец устанавливается в соответствующее
этому типу значение ``ноль''. See section <A HREF="manual.ru.html#Date_and_time_types">6.2.2  Типы данных даты и времени</A>.
</UL>

<P>
Отметим, что это те же самые величины, которые окажутся в столбце в
результате явного назначения пустой строки столбцам строкового, числового
типов, либо типов даты или времени в команде <code>INSERT</code> или <code>UPDATE</code>.

</P>
<P>
Столбцы типа <code>TIMESTAMP</code> устанавливаются только в текущую дату или время в
случаях, если для столбца назначено значение <code>NULL</code> или (только для первого
столбца <code>TIMESTAMP</code>) если столбец <code>TIMESTAMP</code> находится вне списка полей, если
такой список задан.

</P>
<P>
Если входная строка имеет слишком много полей, то лишние поля игнорируются
и количество предупреждений увеличится.

</P>
<P>
Команда  <code>LOAD DATA INFILE</code> интерпретирует все входные данные как строки,
поэтому нельзя указывать числовые величины для столбцов <code>ENUM</code> или <code>SET</code> так
же, как для команд <code>INSERT</code>. Все величины <code>ENUM</code> и <code>SET</code> должны быть заданы как
строки!

</P>
<P>
При использовании C  API можно получить информацию о запросе, вызвав
функцию API  <code>mysql_info()</code> по окончании запроса <code>LOAD DATA INFILE</code>. Ниже
показан формат строки информации для этого случая:

</P>

<PRE>
Records: 1 Deleted: 0 Skipped: 0 Warnings: 0
</PRE>

<P>
Предостережения выдаются при тех же обстоятельствах, что и при записи
величин командой <code>INSERT</code> (see section <A HREF="manual.ru.html#INSERT">6.4.3  Синтаксис оператора <code>INSERT</code></A>), за исключением того,
что команда <code>LOAD DATA INFILE</code> дополнительно генерирует предупреждения,
когда во входной строке слишком мало или слишком много полей.
Предостережения нигде не хранятся; количество предупреждений может
использоваться только для того, чтобы проверить, нормально ли выполнились
указанные действия. Если необходимо точно знать причины предупреждений, то
следует выполнить команду <code>SELECT ... INTO OUTFILE</code> в другой файл и
сравнить результат с первоначальным входным файлом - это единственный
способ получить такую информацию.

</P>
<P>
Если необходимо выполнить <code>LOAD DATA</code> для чтения из канала, можно применить
следующий трюк:

</P>


<PRE>
mkfifo /mysql/db/x/x
chmod 666 /mysql/db/x/x
cat &#60; /dev/tcp/10.1.1.12/4711 &#62; /nt/mysql/db/x/x
mysql -e "LOAD DATA INFILE 'x' INTO TABLE x" x
</PRE>

<P>
При использовании версии MySQL старше, чем 3.23.25, вышеприведенное можно
сделать только с <code>LOAD DATA LOCAL INFILE</code>.

</P>
<P>
Чтобы получить более подробную информацию об эффективности <code>INSERT</code> в
сравнении с <code>LOAD DATA INFILE</code> и увеличении скорости <code>LOAD DATA INFILE</code>,
см. раздел section <A HREF="manual.ru.html#Insert_speed">5.2.9  Скорость выполнения запросов <code>INSERT</code></A>.

</P>


<H3><A NAME="DO" HREF="manual.ru_toc.html#DO">6.4.10  Синтаксис оператора <code>DO</code></A></H3>

<P>
<A NAME="IDX1403"></A>

</P>

<PRE>
DO expression, [expression, ...]
</PRE>

<P>
Выполняет данное выражение, но не возвращает какой-либо результат.
Является сокращенной формой оператора <code>SELECT expression, expression</code>, но
преимущество его заключается в том, что он работает немного быстрее, если
нет необходимости в возвращении результата.

</P>
<P>
Оператор главным образом полезен при использовании с функциями, имеющими
побочные эффекты, такими как <code>RELEASE_LOCK</code>.

</P>


<H2><A NAME="Data_Definition" HREF="manual.ru_toc.html#Data_Definition">6.5  Определение данных: <code>CREATE</code>, <code>DROP</code>, <code>ALTER</code></A></H2>



<H3><A NAME="CREATE_DATABASE" HREF="manual.ru_toc.html#CREATE_DATABASE">6.5.1  Синтаксис оператора <code>CREATE DATABASE</code></A></H3>

<P>
<A NAME="IDX1404"></A>

</P>

<PRE>
CREATE DATABASE [IF NOT EXISTS] db_name
</PRE>

<P>
Оператор <code>CREATE DATABASE</code> создает базу данных с указанным именем. Правила
для допустимых имен базы данных приведены в разделе section <A HREF="manual.ru.html#Legal_names">6.1.2  Имена баз данных, таблиц, столбцов, индексы псевдонимы</A>. Если база данных уже существует и не
указан ключевой параметр <code>IF NOT EXISTS</code>, то возникает ошибка выполнения
команды.

</P>
<P>
Базы данных в MySQL реализуются как директории, содержащие файлы, которые
соответствуют таблицам в базе данных. Поскольку при первоначальном
создании база данных не содержит таблиц, то команда <code>CREATE DATABASE</code>
создает только соответствующую поддиректорию в директории данных MySQL.

</P>
<P>
Базы данных можно также создавать с помощью утилиты <code>mysqladmin</code>. 
See section <A HREF="manual.ru.html#Client-Side_Scripts">4.8  Клиентские сценарии и утилиты MySQL</A>.

</P>


<H3><A NAME="DROP_DATABASE" HREF="manual.ru_toc.html#DROP_DATABASE">6.5.2  Синтаксис оператора  <code>DROP DATABASE</code></A></H3>

<P>
<A NAME="IDX1405"></A>
<A NAME="IDX1406"></A>

</P>

<PRE>
DROP DATABASE [IF EXISTS] db_name
</PRE>

<P>
Оператор <code>DROP DATABASE</code> удаляет все таблицы в указанной базе данных и саму
базу. Если вы выполняете <code>DROP DATABASE</code> на базе данных, символически
связанной с другой, то удаляется как ссылка, так и оригинальная база
данных. Будьте <strong>ОЧЕНЬ</strong> внимательны при работе с этой командой!

</P>
<P>
Оператор <code>DROP DATABASE</code> возвращает количество файлов, которые были удалены
из директории базы данных. Как правило, это число равно количеству таблиц,
умноженному на три, поскольку обычно каждая таблица представлена тремя
файлами - <tt>`.MYD'</tt>-файлом, <tt>`MYI'</tt>-файлом и <tt>`.frm'</tt>-файлом.

</P>
<P>
Команда <code>DROP DATABASE</code> удаляет из директории указанной базы данных все
файлы со следующими расширениями:

</P>
<TABLE BORDER>
<TR><TD><strong>Расширение</strong> </TD><TD> <strong>Расширение</strong> </TD><TD> <strong>Расширение</strong> </TD><TD> <strong>Расширение</strong>
</TD></TR>
<TR><TD>.BAK </TD><TD> .DAT </TD><TD> .HSH </TD><TD> .ISD
</TD></TR>
<TR><TD>.ISM </TD><TD> .ISM </TD><TD> .MRG </TD><TD> .MYD
</TD></TR>
<TR><TD>.MYI </TD><TD> .db </TD><TD> .frm </TD><TD>
</TD></TR>
</TABLE>

<P>
Все поддиректории, имена которых состоят из двух цифр (<code>RAID</code>-директории),
также удаляются.

</P>
<P>
В версии MySQL 3.22 и более поздних можно использовать ключевые слова <code>IF 
EXISTS</code> для предупреждения ошибки, если указанная база данных не
существует.

</P>
<P>
<A NAME="IDX1407"></A>
Можно также удалять базы данных с помощью утилиты <code>mysqladmin</code>. 
See section <A HREF="manual.ru.html#Client-Side_Scripts">4.8  Клиентские сценарии и утилиты MySQL</A>.

</P>


<H3><A NAME="CREATE_TABLE" HREF="manual.ru_toc.html#CREATE_TABLE">6.5.3  Синтаксис оператора <code>CREATE TABLE</code></A></H3>

<P>
<A NAME="IDX1408"></A>

</P>

<PRE>
CREATE [TEMPORARY] TABLE [IF NOT EXISTS] tbl_name [(create_definition,...)]
[table_options] [select_statement]

или

CREATE [TEMPORARY] TABLE [IF NOT EXISTS] tbl_name LIKE old_table_name;

create_definition:
  col_name type [NOT NULL | NULL] [DEFAULT default_value] [AUTO_INCREMENT]
            [PRIMARY KEY] [reference_definition]
  или   PRIMARY KEY (index_col_name,...)
  или   KEY [index_name] (index_col_name,...)
  или   INDEX [index_name] (index_col_name,...)
  или   UNIQUE [INDEX] [index_name] (index_col_name,...)
  или   FULLTEXT [INDEX] [index_name] (index_col_name,...)
  или   [CONSTRAINT symbol] FOREIGN KEY [index_name] (index_col_name,...)
            [reference_definition]
  или   CHECK (expr)

type:
        TINYINT[(length)] [UNSIGNED] [ZEROFILL]
  или   SMALLINT[(length)] [UNSIGNED] [ZEROFILL]
  или   MEDIUMINT[(length)] [UNSIGNED] [ZEROFILL]
  или   INT[(length)] [UNSIGNED] [ZEROFILL]
  или   INTEGER[(length)] [UNSIGNED] [ZEROFILL]
  или   BIGINT[(length)] [UNSIGNED] [ZEROFILL]
  или   REAL[(length,decimals)] [UNSIGNED] [ZEROFILL]
  или   DOUBLE[(length,decimals)] [UNSIGNED] [ZEROFILL]
  или   FLOAT[(length,decimals)] [UNSIGNED] [ZEROFILL]
  или   DECIMAL(length,decimals) [UNSIGNED] [ZEROFILL]
  или   NUMERIC(length,decimals) [UNSIGNED] [ZEROFILL]
  или   CHAR(length) [BINARY]
  или   VARCHAR(length) [BINARY]
  или   DATE
  или   TIME
  или   TIMESTAMP
  или   DATETIME
  или   TINYBLOB
  или   BLOB
  или   MEDIUMBLOB
  или   LONGBLOB
  или   TINYTEXT
  или   TEXT
  или   MEDIUMTEXT
  или   LONGTEXT
  или   ENUM(value1,value2,value3,...)
  или   SET(value1,value2,value3,...)

index_col_name:
        col_name [(length)]

reference_definition:
        REFERENCES tbl_name [(index_col_name,...)]
                   [MATCH FULL | MATCH PARTIAL]
                   [ON DELETE reference_option]
                   [ON UPDATE reference_option]

reference_option:
        RESTRICT | CASCADE | SET NULL | NO ACTION | SET DEFAULT

table_options:
        TYPE = {BDB | HEAP | ISAM | InnoDB | MERGE | MRG_MYISAM | MYISAM }
или     AUTO_INCREMENT = #
или     AVG_ROW_LENGTH = #
или     CHECKSUM = {0 | 1}
или     COMMENT = "string"
или     MAX_ROWS = #
или     MIN_ROWS = #
или     PACK_KEYS = {0 | 1 | DEFAULT}
или     PASSWORD = "string"
или     DELAY_KEY_WRITE = {0 | 1}
или     ROW_FORMAT= { default | dynamic | fixed | compressed }
или     RAID_TYPE= {1 | STRIPED | RAID0 } RAID_CHUNKS=#  RAID_CHUNKSIZE=#
или     UNION = (table_name,[table_name...])
или     INSERT_METHOD= {NO | FIRST | LAST }
или     DATA DIRECTORY="абсолютный путь к каталогу"
или     INDEX DIRECTORY="абсолютный путь к каталогу"

select_statement:
        [IGNORE | REPLACE] SELECT ...  (любое корректное выражение SELECT)
</PRE>

<P>
Оператор <code>CREATE TABLE</code> создает таблицу с заданным именем в текущей базе
данных. Правила для допустимых имен таблицы приведены в разделе section <A HREF="manual.ru.html#Legal_names">6.1.2  Имена баз данных, таблиц, столбцов, индексы псевдонимы</A>. Если нет активной текущей базы
данных или указанная таблица уже существует, то возникает ошибка
выполнения команды.

</P>
<P>
В версии MySQL 3.22 и более поздних имя таблицы может быть указано как
<code>db_name.tbl_name</code>. Эта форма записи работает независимо от того, является
ли указанная база данных текущей.

</P>
<P>
Начиная с MySQL 3.23 при создании таблицы можно использовать ключевое слово
<code>TEMPORARY</code>. Временная таблица автоматически удаляется по завершении
соединения, а ее имя действительно только в течение данного соединения.
Это означает, что в двух разных соединениях могут использоваться временные
таблицы с одинаковыми именами без конфликта друг с другом или с
существующей таблицей с тем же именем (существующая таблица скрыта, пока
не удалена временная таблица). С версии MySQL 4.0.2 для создания временных
таблиц необходимо иметь привилегии <code>CREATE TEMPORARY TABLES</code>.

</P>
<P>
В версии MySQL 3.23 и более поздних можно использовать ключевые слова <code>IF 
NOT EXISTS</code> для того, чтобы не возникала ошибка, если указанная таблица
уже существует. Следует учитывать, что при этом не проверяется
идентичность структур этих таблиц.

</P>
<P>
В MySQL 4.1 вы можете указать <code>LIKE</code> чтобы создавать таблицу, основываясь на
определении другой, уже существующей, таблицы.  В MySQL 4.1 также можете
определять тип автоматически создаваемого столбца: 

</P>

<PRE>
CREATE TABLE foo (a tinyint not null) SELECT b+1 AS 'a' FROM bar;
</PRE>

<P>
Каждая таблица <code>tbl_name</code> представлена определенными файлами в директории
базы данных. В случае таблиц типа <code>MyISAM</code> это следующие файлы:

</P>
<TABLE BORDER>
<TR><TD><strong>Файл</strong> </TD><TD> <strong>Назначение</strong>
</TD></TR>
<TR><TD><code>tbl_name.frm</code> </TD><TD> Файл определения таблицы
</TD></TR>
<TR><TD><code>tbl_name.MYD</code> </TD><TD> Файл данных
</TD></TR>
<TR><TD><code>tbl_name.MYI</code> </TD><TD> Файл индексов
</TD></TR>
</TABLE>

<P>
Чтобы получить более полную информацию о свойствах различных типов
столбцов, section <A HREF="manual.ru.html#Column_types">6.2  Типы данных столбцов</A>:

</P>

<UL>
<LI>

Если не указывается ни <code>NULL</code>, ни <code>NOT NULL</code>, то столбец интерпретируется
так, как будто указано <code>NULL</code>.

<LI>

Целочисленный столбец может иметь дополнительный атрибут
<code>AUTO_INCREMENT</code>. При записи величины <code>NULL</code> (рекомендуется) или <code>0</code> в
столбец <code>AUTO_INCREMENT</code> данный столбец устанавливается в значение
<code>value+1</code>, где <code>value</code> представляет собой наибольшее для этого столбца
значение в таблице на момент записи. Последовательность <code>AUTO_INCREMENT</code>
начинается с <code>1</code>. See section <A HREF="manual.ru.html#mysql_insert_id">8.4.3.31  <code>mysql_insert_id()</code></A>. Если удалить строку,
содержащую максимальную величину для столбца <code>AUTO_INCREMENT</code>, то в
таблицах типа <code>ISAM</code> или <code>BDB</code> эта величина будет восстановлена, а в
таблицах типа <code>MyISAM</code> или <code>InnoDB</code> - нет. Если удалить все строки в
таблице командой <code>DELETE FROM table_name</code> (без выражения <code>WHERE</code>) в
режиме <code>AUTOCOMMIT</code>, то для таблиц всех типов последовательность
начнется заново. 

Примечание: в таблице может быть только один столбец
<code>AUTO_INCREMENT</code>, и он должен быть индексирован. Кроме того, версия
MySQL 3.23 будет правильно работать только с положительными величинами
столбца <code>AUTO_INCREMENT</code>. В случае внесения отрицательного числа оно
интерпретируется как очень большое положительное число. Это делается,
чтобы избежать проблем с точностью, когда числа ``заворачиваются'' от
положительного к отрицательному и, кроме того, для гарантии, что по
ошибке не будет получен столбец <code>AUTO_INCREMENT</code> со значением <code>0</code>. В
таблицах <code>MyISAM</code> и <code>BDB</code> можно указать вторичный столбец <code>AUTO_INCREMENT</code> с
многостолбцовым ключом. See section <A HREF="manual.ru.html#example-AUTO_INCREMENT">3.5.9  Использование атрибута AUTO_INCREMENT</A>. 

<A NAME="IDX1409"></A>
Последнюю
внесенную строку можно найти с помощью следующего запроса (чтобы
сделать MySQL совместимым с некоторыми ODBC-приложениями):


<PRE>
SELECT * FROM tbl_name WHERE auto_col IS NULL
</PRE>

<LI>

<code>CREATE TABLE</code> автоматически принимает текущую открытую транзакцию в InnoDB если 
в MySQL включен двоичный журнал. 

<LI>

Величины <code>NULL</code> для столбца типа <code>TIMESTAMP</code> обрабатываются иначе, чем для
столбцов других типов. В столбце <code>TIMESTAMP</code> нельзя хранить литерал
<code>NULL</code>; при установке данного столбца в <code>NULL</code> он будет установлен в
текущее значение даты и времени. Поскольку столбцы <code>TIMESTAMP</code> ведут
себя подобным образом, то атрибуты <code>NULL</code> и <code>NOT NULL</code> неприменимы в
обычном режиме и игнорируются при их задании. 

С другой стороны, чтобы
облегчить клиентам MySQL использование столбцов <code>TIMESTAMP</code>, сервер
сообщает, что таким столбцам могут быть назначены величины <code>NULL</code> (что
соответствует действительности), хотя реально <code>TIMESTAMP</code> никогда не
будет содержать величины <code>NULL</code>. Это можно увидеть, применив <code>DESCRIBE 
tbl_name</code> для получения описания данной таблицы. Следует учитывать, что
установка столбца <code>TIMESTAMP</code> в <code>0</code> не равнозначна установке его в <code>NULL</code>,
поскольку <code>0</code> для <code>TIMESTAMP</code>  является допустимой величиной.

<LI>

<A NAME="IDX1410"></A>
Величина <code>DEFAULT</code> должна быть константой, она не может быть функцией
или выражением. Если для данного столбца не задается никакой величины
<code>DEFAULT</code>, то MySQL автоматически назначает ее. Если столбец может
принимать <code>NULL</code> как допустимую величину, то по умолчанию присваивается
значение  <code>NULL</code>. Если столбец объявлен как <code>NOT NULL</code>, то значение по
умолчанию зависит от типа столбца:


<UL>
<LI>

Для числовых типов, за исключением объявленных с атрибутом
<code>AUTO_INCREMENT</code>, значение по умолчанию равно <code>0</code>. Для столбца
<code>AUTO_INCREMENT</code> значением по умолчанию является следующее значение
в последовательности для этого столбца.

<LI>

Для типов даты и времени, отличных от <code>TIMESTAMP</code>, значение по
умолчанию равно соответствующей нулевой величине для данного
типа. Для первого столбца <code>TIMESTAMP</code> в таблице значение по
умолчанию представляет собой текущее значение даты и времени. 
See section <A HREF="manual.ru.html#Date_and_time_types">6.2.2  Типы данных даты и времени</A>.

Для типов даты и времени, отличных от <code>TIMESTAMP</code>, значение по
умолчанию равно соответствующей нулевой величине для данного
типа. Для первого столбца <code>TIMESTAMP</code> в таблице значение по
умолчанию представляет собой текущее значение даты и времени. 
See section <A HREF="manual.ru.html#Date_and_time_types">6.2.2  Типы данных даты и времени</A>.

<LI>

Для строковых типов, кроме <code>ENUM</code>, значением по умолчанию является
пустая строка. Для <code>ENUM</code> значение по умолчанию равно первой
перечисляемой величине.
</UL>

Значения по умолчанию должны быть константами. Это означает, например, что
нельзя установить для столбца даты в качестве значения по умолчанию
величину функции, такой как <code>NOW()</code> или <code>CURRENT_DATE</code>.

<LI>

<code>KEY</code> является синонимом для <code>INDEX</code>.

<LI>

В MySQL ключ <code>UNIQUE</code> может иметь только различающиеся значения. При
попытке добавить новую строку с ключом, совпадающим с существующей
строкой, возникает ошибка выполнения команды.

<LI>

<A NAME="IDX1411"></A>
<code>PRIMARY KEY</code> представляет собой уникальный ключ <code>KEY</code> с дополнительным
ограничением, что все столбцы с данным ключом должны быть определены
как <code>NOT NULL</code>. В MySQL этот ключ называется <code>PRIMARY</code> (первичный).
Таблица может иметь только один первичный ключ <code>PRIMARY KEY</code>. Если
<code>PRIMARY KEY</code> отсутствует в таблицах, а некоторое приложение
запрашивает его, то MySQL может превратить в <code>PRIMARY KEY</code> первый ключ
<code>UNIQUE</code>, не имеющий ни одного столбца <code>NULL</code>.

<LI>

<code>PRIMARY KEY</code> может быть многостолбцовым индексом. Однако нельзя
создать многостолбцовый индекс, используя в определении столбца
атрибут ключа <code>PRIMARY KEY</code>. Именно таким образом только один столбец
будет отмечен как первичный. Необходимо использовать синтаксис <code>PRIMARY
KEY(index_col_name, ...</code>).

<LI>

Если ключ <code>PRIMARY</code> или <code>UNIQUE</code> состоит только из одного столбца и он
принадлежит к числовому типу, то на него можно сослаться также как на
<code>_rowid</code> (новшество версии 3.23.11).

<LI>

Если индексу не назначено имя, то ему будет присвоено первое имя в
<code>index_col_name</code>, возможно, с суффиксами (<code>_2</code>, <code>_3</code>, <code>...</code>), делающими это
имя уникальным. Имена индексов для таблицы можно увидеть, используя
<code>SHOW INDEX FROM tbl_name</code>. <code>SHOW Syntax</code>.

<LI>

<A NAME="IDX1412"></A>
Только таблицы типов <code>MyISAM</code>, <code>InnoDB</code> и <code>BDB</code> поддерживают индексы
столбцов, которые могут иметь величины <code>NULL</code>. В других случаях, во
избежание ошибки, необходимо объявлять такие столбцы как <code>NOT NULL</code>.

<LI>

С помощью выражения <code>col_name(length)</code> можно указать индекс, для
которого используется только часть столбца <code>CHAR</code> или <code>VARCHAR</code>. Это
поможет сделать файл индексов намного меньше. See section <A HREF="manual.ru.html#Indexes">5.4.4  Индексы столбцов</A>.

<LI>

<A NAME="IDX1413"></A>
<A NAME="IDX1414"></A>
<A NAME="IDX1415"></A>
<A NAME="IDX1416"></A>
Индексацию столбцов <code>BLOB</code> и <code>TEXT</code>  поддерживают только таблицы с типом
<code>MyISAM</code>. Назначая индекс столбцу с типом <code>BLOB</code> или <code>TEXT</code>, всегда
НЕОБХОДИМО указывать длину этого индекса:


<PRE>
CREATE TABLE test (blob_col BLOB, INDEX(blob_col(10)));
</PRE>

<LI>

При использовании выражений <code>ORDER BY</code> или <code>GROUP BY</code> со столбцом типа
<code>TEXT</code> или <code>BLOB</code> используются только первые <code>max_sort_length</code> байтов. 
See section <A HREF="manual.ru.html#BLOB">6.2.3.2  Типы данных <code>BLOB</code> и <code>TEXT</code></A>.

<LI>

В версии MySQL 3.23.23 и более поздних можно создавать также
специальные индексы <code>FULLTEXT</code>. Они применяются для полнотекстового
поиска. Эти индексы поддерживаются только таблицами типа <code>MyISAM</code> и они
могут быть созданы только из столбцов <code>CHAR</code>, <code>VARCHAR</code> и <code>TEXT</code>. Индексирование
всегда выполняется для всего столбца целиком, частичная индексация не
поддерживается. Более подробно эта операция описана в разделе MySQL 
section <A HREF="manual.ru.html#Fulltext_Search">6.8  Полнотекстовый поиск в MySQL</A>.

<LI>

Выражения <code>FOREIGN KEY</code>, <code>CHECK</code> и <code>REFERENCES</code> фактически ничего не
делают. Они введены только из соображений совместимости, чтобы
облегчить перенос кода с других SQL-серверов и запускать приложения,
создающие таблицы со ссылками. See section <A HREF="manual.ru.html#Extensions_to_ANSI">1.9.3  Расширения MySQL к ANSI SQL92</A>.

<LI>

В MySQL версии 3.23.44 или более поздней, таблицы InnoDB выполняют проверку
ограничений внешнего ключа.  See section <A HREF="manual.ru.html#InnoDB">7.5  Таблицы <code>InnoDB</code></A>. Однако обратите внимание, что
синтаксис <code>FOREIGN KEY</code> в InnoDB более строгий чем приведенный выше.
InnoDB не допускает указания <code>index_name</code>. Также столбцы таблицы, на
которую ссылаются, должны быть явно указаны.  Начиная с 4.0.8 InnoDB
поддерживает действия <code>ON DELETE</code> и <code>ON UPDATE</code>.

Для уточнения синтаксиса см. документацию по InnoDB. See section <A HREF="manual.ru.html#InnoDB">7.5  Таблицы <code>InnoDB</code></A>.  Для
остальных типов таблиц, MySQL делает синтаксической разбор указаний
<code>FOREIGN KEY</code>, <code>CHECK</code> и <code>REFERENCES</code> в <code>CREATE TABLE</code>, но
при этом успешно их игнорирует.  See section <A HREF="manual.ru.html#ANSI_diff_Foreign_Keys">1.9.4.5  Внешние ключи</A>.

<LI>

Для каждого столбца <code>NULL</code> требуется один дополнительный бит, при этом
величина столбца округляется в большую сторону до ближайшего байта.

<LI>

Максимальную длину записи в байтах можно вычислить следующим образом:


<PRE>
длина записи = 1
        + (сумма длин столбцов)
        + (количество столбцов с допустимым NULL + 7)/8
        + (количество столбцов с динамической длинной)
</PRE>

<LI>

Опции <code>table_options</code> и <code>SELECT</code> реализованы только в версиях MySQL 3.23 и
выше. Ниже представлены различные типы таблиц:

<TABLE BORDER>
<TR><TD><strong>Тип таблицы</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD>BDB или BerkeleyDB </TD><TD> Таблицы с поддержкой транзакций и блокировкой страниц. See section <A HREF="manual.ru.html#BDB">7.6  Таблицы <code>BDB</code> или BerkeleyDB</A>.
</TD></TR>
<TR><TD>HEAP </TD><TD> Данные для этой таблицы хранятся только в памяти.  See section <A HREF="manual.ru.html#HEAP">7.4  Таблицы <code>HEAP</code></A>.
</TD></TR>
<TR><TD>ISAM </TD><TD> Оригинальный обработчик таблиц. See section <A HREF="manual.ru.html#ISAM">7.3  Таблицы <code>ISAM</code></A>.
</TD></TR>
<TR><TD>InnoDB </TD><TD> Таблицы с поддержкой транзакций и блокировкой строк. See section <A HREF="manual.ru.html#InnoDB">7.5  Таблицы <code>InnoDB</code></A>.
</TD></TR>
<TR><TD>MERGE </TD><TD> Набор таблиц MyISAM, используемый как одна таблица. See section <A HREF="manual.ru.html#MERGE">7.2  Таблицы <code>MERGE</code></A>.
</TD></TR>
<TR><TD>MRG_MyISAM </TD><TD> Псевдоним для таблиц MERGE
</TD></TR>
<TR><TD>MyISAM </TD><TD> Новый обработчик, обеспечивающий переносимость таблиц в бинарном виде, который заменяет ISAM.  See section <A HREF="manual.ru.html#MyISAM">7.1  Таблицы <code>MyISAM</code></A>.
</TD></TR>
</TABLE>
See section <A HREF="manual.ru.html#Table_types">7  Типы  таблиц MySQL</A>. 

Если задается тип таблицы, который не
поддерживается данной версией, то MySQL выберет из возможных типов
ближайший к указанному. Например, если задается <code>TYPE=BDB</code> и данный
дистрибутив MySQL не поддерживает таблиц <code>BDB</code>, то вместо этого будет
создана таблица <code>MyISAM</code>. Другие табличные опции используются для
оптимизации характеристик таблицы. Эти опции в большинстве случаев не
требуют специальной установки. Данные опции работают с таблицами всех
типов, если не указано иное:

<TABLE BORDER>
<TR><TD><strong>Опция</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD>AUTO_INCREMENT </TD><TD> Следующая величина <code>AUTO_INCREMENT</code>, которую следует установить для данной таблицы (<code>MyISAM</code>).
</TD></TR>
<TR><TD>AVG_ROW_LENGTH </TD><TD> Приближенное значение средней длины строки для данной таблицы. Имеет смысл устанавливать только для обширных таблиц с записями переменной длины.
</TD></TR>
<TR><TD>CHECKSUM </TD><TD> Следует установить в <code>1</code>, чтобы в MySQL поддерживалась проверка контрольной суммы для всех строк (это делает таблицы немного более медленными при обновлении, но позволяет легче находить поврежденные таблицы) (<code>MyISAM</code>).
</TD></TR>
<TR><TD>COMMENT </TD><TD> Комментарий для данной таблицы длиной 60 символов.
</TD></TR>
<TR><TD>MAX_ROWS </TD><TD> Максимальное число строк, которые планируется хранить в данной таблице.
</TD></TR>
<TR><TD>MIN_ROWS </TD><TD> Минимальное число строк, которые планируется хранить в данной таблице.
</TD></TR>
<TR><TD>PACK_KEYS </TD><TD> Следует установить в <code>1</code> для получения меньшего индекса. Обычно это замедляет обновление и ускоряет чтение (<code>MyISAM</code>, <code>ISAM</code>). Установка в <code>0</code> отключит уплотнение ключей. При установке в <code>DEFAULT</code> (MySQL 4.0) обработчик таблиц будет уплотнять только длинные столбцы <code>CHAR/VARCHAR</code>.
</TD></TR>
<TR><TD>PASSWORD </TD><TD> Шифрует файл <tt>`.frm'</tt> с помощью пароля. Эта опция не функционирует в стандартной версии MySQL.
</TD></TR>
<TR><TD>DELAY_KEY_WRITE </TD><TD> Установка в <code>1</code> задерживает операции обновления таблицы ключей, пока не закроется указанная таблица (<code>MyISAM</code>).
</TD></TR>
<TR><TD>ROW_FORMAT </TD><TD> Определяет, каким образом должны храниться строки. В настоящее время эта опция работает только с таблицами <code>MyISAM</code>, которые поддерживают форматы строк <code>DYNAMIC</code> и <code>FIXED</code>. See section <A HREF="manual.ru.html#MyISAM_table_formats">7.1.2  Форматы таблиц <code>MyISAM</code></A>.
</TD></TR>
</TABLE>

При использовании таблиц <code>MyISAM</code> MySQL вычисляет выражение <code>max_rows *
avg_row_length</code>, чтобы определить, насколько велика будет результирующая
таблица. Если не задана ни одна из вышеупомянутых опций, то максимальный
размер таблицы будет составлять 4Гб (или 2Гб если данная операционная
система поддерживает только таблицы величиной до 2Гб). Это делается для
того, чтобы, если нет реальной необходимости в больших файлах, ограничить
размеры указателей, что позволит сделать индексы меньше и быстрее. Если
опция <code>PACK_KEYS</code> не используется, то по умолчанию уплотняются только
строки, но не числа. При использовании <code>PACK_KEYS=1</code> числа тоже будут
уплотняться. При уплотнении двоичных числовых ключей MySQL будет
использовать сжатие префиксов. Это означает, что выгода от этого будет
значительной только в случае большого количества одинаковых чисел. При
сжатии префиксов для каждого ключа требуется один дополнительный байт, в
котором указано, сколько байтов предыдущего ключа являются такими же, как
и для следующего (следует учитывать, что указатель на строку хранится в
порядке "старший-байт-в-начале" сразу после ключа - чтобы улучшить
компрессию).

Это означает, что при наличии нескольких одинаковых ключей в двух
строках записи все последующие ``аналогичные'' ключи будут занимать
только по 2 байта (включая указатель строки). Сравним: в обычном
случае для хранения последующих ключей требуется <code>размер_хранения_ключа
+ размер_указателя (обычно 4)</code> байтов. С другой стороны, если все ключи
абсолютно разные, каждый ключ будет занимать на 1 байт больше, если
данный ключ не может иметь величину <code>NULL</code> (в этом случае уплотненный
ключ будет храниться в том же байте, который используется для
указания, что ключ равен <code>NULL</code>).

<LI>

Если после команды <code>CREATE</code> указывается команда <code>SELECT</code>, то  MySQL
создаст новые поля для всех элементов в данной команде <code>SELECT</code>.
Например:


<PRE>
mysql&#62; CREATE TABLE test (a INT NOT NULL AUTO_INCREMENT,
        PRIMARY KEY (a), KEY(b))
        TYPE=MyISAM SELECT b,c FROM test2;
</PRE>

Эта команда создаст таблицу <code>MyISAM</code> с тремя столбцами <code>a</code>, <code>b</code> и <code>c</code>. Отметим,
что столбцы из команды <code>SELECT</code> присоединяются к таблице справа, а не
перекрывают ее. Рассмотрим следующий пример:


<PRE>
mysql&#62; SELECT * FROM foo;
+---+
| n |
+---+
| 1 |
+---+

mysql&#62; CREATE TABLE bar (m INT) SELECT n FROM foo;
Query OK, 1 row affected (0.02 sec)
Records: 1 Duplicates: 0 Warnings: 0

mysql&#62; SELECT * FROM bar;
+------+---+
| m    | n |
+------+---+
| NULL | 1 |
+------+---+
1 row in set (0.00 sec)
</PRE>

Каждая строка в таблице <code>foo</code> вносится в таблицу <code>bar</code> со своим значением из
<code>foo</code>, при этом в новые столбцы в таблице <code>bar</code> записываются величины,
заданные по умолчанию. Команда <code>CREATE TABLE ... SELECT</code> не создает
автоматически каких-либо индексов. Это сделано преднамеренно, чтобы
команда была настолько гибкой, насколько возможно. Чтобы иметь индексы в
созданной таблице, необходимо указать их перед данной командой <code>SELECT</code>:


<PRE>
mysql&#62; CREATE TABLE bar (UNIQUE (n)) SELECT n FROM foo;
</PRE>

Если возникает ошибка при копировании данных в таблицу, то они будут
автоматически удалены. Чтобы обеспечить возможность использовать для
восстановления таблиц журнал обновлений/двоичный журнал, в MySQL во время
выполнения команды <code>CREATE TABLE ... SELECT</code>  не разрешены параллельные
вставки.

<LI>

Воспользовавшись опцией <code>RAID_TYPE</code>, можно разбить файл данных <code>MyISAM</code> на
участки с тем, чтобы преодолеть 2Гб/4Гб лимит файловой системы под управлением ОС, 
не поддерживающих большие файлы. Разбиение не касается файла индексов.  
Следует учесть, что для файловых систем,
которые поддерживают большие файлы, эта опция не рекомендуется! Для
получения более высокой скорости ввода-вывода можно разместить
RAID-директории на различных физических дисках. <code>RAID_TYPE</code> будет
работать под любой операционной системой, если конфигурация MySQL
выполнена с параметром <code>--with-raid</code>. В настоящее время для опции
<code>RAID_TYPE</code> возможен только параметр <code>STRIPED</code> (<code>1</code> и <code>RAID0</code> являются
псевдонимами для него). Если указывается <code>RAID_TYPE=STRIPED</code> для таблицы
<code>MyISAM</code>, то <code>MyISAM</code> создаст поддиректории <code>RAID_CHUNKS</code> с именами <tt>`00'</tt>, <tt>`01'</tt>,
<tt>`02'</tt> в директории базы данных. В каждой из этих директорий <code>MyISAM</code>
создаст файл <tt>`table_name.MYD'</tt>. При записи данных в файл данных
обработчик RAID установит соответствие первых <code>RAID_CHUNKSIZE*1024</code>
байтов первому упомянутому файлу, следующих <code>RAID_CHUNKSIZE*1024</code>
байтов - следующему файлу и так далее.

<LI>

Опция <code>UNION</code> применяется, если необходимо использовать совокупность
идентичных таблиц как одну таблицу. Она работает только с таблицами
<code>MERGE</code>. See section <A HREF="manual.ru.html#MERGE">7.2  Таблицы <code>MERGE</code></A>. На данный момент для таблиц,
сопоставляемых с таблицей <code>MERGE</code>, необходимо иметь привилегии <code>SELECT</code>,
<code>UPDATE</code> и <code>DELETE</code>. Все сопоставляемые таблицы должны принадлежать той же
базе данных, что и таблица <code>MERGE</code>.

<LI>

Для внесения данных в таблицу <code>MERGE</code> необходимо указать с помощью
<code>INSERT_METHOD</code>, в какую таблицу данная строка должна быть внесена.
See section <A HREF="manual.ru.html#MERGE">7.2  Таблицы <code>MERGE</code></A>. Эта опция была введена в MySQL 4.0.0.

<LI>

В созданной таблице ключ <code>PRIMARY</code> будет помещен первым, за ним все
ключи <code>UNIQUE</code> и затем простые ключи. Это помогает оптимизатору MySQL
определять приоритеты используемых ключей, а также более быстро
определять сдублированные ключи <code>UNIQUE</code>.

<LI>

Используя опции <code>DATA DIRECTORY="каталог"</code> или <code>INDEX 
DIRECTORY="каталог"</code>, можно указать, где обработчик таблицы должен
помещать свои табличные и индексные файлы. Следует учитывать, что
указываемый параметр directory должен представлять собой полный путь к
требуемому каталогу (а не относительный путь). Данные опции работают
только для таблиц <code>MyISAM</code> в версии MySQL 4.0, если при этом не
используется опция <code>--skip-symlink</code>. See section <A HREF="manual.ru.html#Symbolic_links_to_tables">5.6.1.2  Использование символических ссылок для таблиц</A>.
</UL>



<H4><A NAME="Silent_column_changes" HREF="manual.ru_toc.html#Silent_column_changes">6.5.3.1  Молчаливые изменения определений столбцов</A></H4>

<P>
<A NAME="IDX1417"></A>

</P>
<P>
В некоторых случаях MySQL без уведомления изменяет определение столбца,
заданное командой <code>CREATE TABLE</code> (Это может осуществляться также для
команды <code>ALTER TABLE</code>):

</P>

<UL>
<LI>

Столбец <code>VARCHAR</code> с длиной меньше, чем четыре, преобразуется в столбец
<code>CHAR</code>.

<LI>

Если некоторый столбец в таблице имеет переменную длину, то и вся
строка в результате будет переменной длины. Следовательно, если
таблица содержит любые столбцы переменной длины (<code>VARCHAR</code>, <code>TEXT</code> или
<code>BLOB</code>), то все столбцы <code>CHAR</code> с длиной, превышающей три символа,
преобразуются в столбцы <code>VARCHAR</code>. Это в любом случае не влияет на
использование столбцов; в MySQL столбец  <code>VARCHAR</code> представляет собой
просто иной способ хранения символов. MySQL выполняет данное
преобразование, поскольку оно позволяет сэкономить память и сделать
табличные операции более быстрыми. See section <A HREF="manual.ru.html#Table_types">7  Типы  таблиц MySQL</A>.

<LI>

Количество выводящихся символов столбца  <code>TIMESTAMP</code> должно быть четным
и находиться в диапазоне от <code>2</code> до <code>14</code>. При задании размера вывода,
равного <code>0</code> или превышающего <code>14</code>, указанный размер приводится к <code>14</code>.
Нечетные величины размера вывода в пределах от <code>1</code> до <code>13</code> приводятся к
следующему четному числу.

<LI>

В столбце  <code>TIMESTAMP</code> не может храниться литерал <code>NULL</code>; установка
данного столбца в <code>NULL</code> устанавливает его в текущее значение даты и
времени. Поскольку столбцы <code>TIMESTAMP</code> ведут себя подобным образом, то
атрибуты <code>NULL</code> и <code>NOT NULL</code> неприменимы в обычном режиме и игнорируются
при их задании. <code>DESCRIBE tbl_name</code> всегда сообщает, что столбцу
<code>TIMESTAMP</code> могут быть присвоены величины <code>NULL</code>.

<LI>

MySQL приводит в соответствие определенные типы столбцов, используемые
другими производителями баз данных SQL, к типам, принятым в MySQL.
See section <A HREF="manual.ru.html#Other-vendor_column_types">6.2.5  Использование типов столбцов из других баз данных</A>.
</UL>

<P>
Если необходимо увидеть, использует ли MySQL иной тип столбца, чем был
первоначально задан, следует запустить команду <code>DESCRIBE tbl_name</code> после
создания или изменения данной таблицы.

</P>
<P>
Некоторые другие изменения типов столбцов могут происходить при сжатии
таблицы с использованием утилиты <code>myisampack</code>. See section <A HREF="manual.ru.html#Compressed_format">7.1.2.3  Характеристики сжатых таблиц</A>.

</P>


<H3><A NAME="ALTER_TABLE" HREF="manual.ru_toc.html#ALTER_TABLE">6.5.4  Синтаксис оператора <code>ALTER TABLE</code></A></H3>

<P>
<A NAME="IDX1418"></A>
<A NAME="IDX1419"></A>
<A NAME="IDX1420"></A>

</P>

<PRE>
ALTER [IGNORE] TABLE tbl_name alter_spec [, alter_spec ...]

alter_specification:
        ADD [COLUMN] create_definition [FIRST | AFTER column_name ]
  или   ADD [COLUMN] (create_definition, create_definition,...)
  или   ADD INDEX [index_name] (index_col_name,...)
  или   ADD PRIMARY KEY (index_col_name,...)
  или   ADD UNIQUE [index_name] (index_col_name,...)
  или   ADD FULLTEXT [index_name] (index_col_name,...)
  или   ADD [CONSTRAINT symbol] FOREIGN KEY [index_name] (index_col_name,...)
            [reference_definition]
  или   ALTER [COLUMN] col_name {SET DEFAULT literal | DROP DEFAULT}
  или   CHANGE [COLUMN] old_col_name create_definition
               [FIRST | AFTER column_name]
  или   MODIFY [COLUMN] create_definition [FIRST | AFTER column_name]
  или   DROP [COLUMN] col_name
  или   DROP PRIMARY KEY
  или   DROP INDEX index_name
  или   DISABLE KEYS
  или   ENABLE KEYS
  или   RENAME [TO] new_tbl_name
  или   ORDER BY col
  или   table_options
</PRE>

<P>
Оператор <code>ALTER TABLE</code> обеспечивает возможность изменять структуру
существующей таблицы. Например, можно добавлять или удалять столбцы,
создавать или уничтожать индексы или переименовывать столбцы либо саму
таблицу. Можно также изменять комментарий для таблицы и ее тип.
See section <A HREF="manual.ru.html#CREATE_TABLE">6.5.3  Синтаксис оператора <code>CREATE TABLE</code></A>.

</P>
<P>
Если оператор <code>ALTER TABLE</code> используется для изменения определения типа
столбца, но <code>DESCRIBE tbl_name</code> показывает, что столбец не изменился, то,
возможно, MySQL игнорирует данную модификацию по одной из причин,
описанных в разделе section <A HREF="manual.ru.html#Silent_column_changes">6.5.3.1  Молчаливые изменения определений столбцов</A>. Например, при
попытке изменить столбец <code>VARCHAR</code> на <code>CHAR</code>  MySQL будет продолжать
использовать <code>VARCHAR</code>, если данная таблица содержит другие столбцы с
переменной длиной.

</P>
<P>
Оператор <code>ALTER TABLE</code> во время работы создает временную копию исходной
таблицы. Требуемое изменение выполняется на копии, затем исходная таблица
удаляется, а новая переименовывается. Так делается для того, чтобы в новую
таблицу автоматически попадали все обновления кроме неудавшихся. Во время
выполнения <code>ALTER TABLE</code> исходная таблица доступна для чтения другими
клиентами. Операции обновления и записи в этой таблице приостанавливаются,
пока не будет готова новая таблица.

</P>
<P>
Следует отметить, что при использовании любой другой опции для <code>ALTER 
TABLE</code> кроме <code>RENAME</code>, MySQL всегда будет создавать временную таблицу, даже
если данные, строго говоря, и не нуждаются в копировании (например, при
изменении имени столбца). Мы планируем исправить это в будущем, однако,
поскольку <code>ALTER TABLE</code> выполняется не так часто, мы (разработчики MySQL)
не считаем эту задачу первоочередной. Для таблиц <code>MyISAM</code> можно увеличить
скорость воссоздания индексной части (что является наиболее медленной
частью в процессе восстановления таблицы) путем установки переменной
<code>myisam_sort_buffer_size</code> достаточно большого значения.

</P>

<UL>
<LI>

Для использования оператора <code>ALTER TABLE</code> необходимы привилегии <code>ALTER</code>,
<code>INSERT</code> и <code>CREATE</code> для данной таблицы.

<LI>

Опция  <code>IGNORE</code> является расширением MySQL по отношению к ANSI  SQL92.
Она управляет работой <code>ALTER TABLE</code> при наличии дубликатов уникальных
ключей в новой таблице. Если опция <code>IGNORE</code> не задана, то для данной
копии процесс прерывается и происходит откат назад. Если <code>IGNORE</code>
указывается, тогда для строк с дубликатами уникальных ключей только
первая строка используется, а остальные удаляются.

<LI>

Можно запустить несколько выражений <code>ADD</code>, <code>ALTER</code>, <code>DROP</code> и <code>CHANGE</code> в одной
команде <code>ALTER TABLE</code>. Это является расширением MySQL по отношению к
ANSI  SQL92, где допускается только одно выражение из упомянутых в
одной команде <code>ALTER TABLE</code>.

<LI>

Опции  <code>CHANGE col_name</code>, <code>DROP col_name</code> и <code>DROP INDEX</code> также являются
расширениями MySQL по отношению к ANSI  SQL92.

<LI>

Опция  <code>MODIFY</code> представляет собой расширение Oracle для команды <code>ALTER 
TABLE</code>.

<LI>

Необязательное слово <code>COLUMN</code> представляет собой ``белый шум'' и может
быть опущено.

<LI>

При использовании <code>ALTER TABLE имя_таблицы RENAME TO новое_имя</code> без
каких-либо других опций MySQL просто переименовывает файлы,
соответствующие заданной таблице. В этом случае нет
необходимости создавать временную таблицу. See section <A HREF="manual.ru.html#RENAME_TABLE">6.5.5  Синтаксис оператора  <code>RENAME TABLE</code></A>.

<LI>

В выражении  <code>create_definition</code> для <code>ADD</code> и <code>CHANGE</code> используется тот же
синтаксис, что и для <code>CREATE TABLE</code>. Следует учитывать, что этот
синтаксис включает имя столбца, а не просто его тип. See section <A HREF="manual.ru.html#CREATE_TABLE">6.5.3  Синтаксис оператора <code>CREATE TABLE</code></A>.

<LI>

Столбец можно переименовывать, используя выражение <code>CHANGE имя_столбца
create_definition</code>. Чтобы сделать это, необходимо указать старое и
новое имена столбца и его тип в настоящее время. Например, чтобы
переименовать столбец <code>INTEGER</code> из <code>a</code> в <code>b</code>, можно сделать следующее:


<PRE>
mysql&#62; ALTER TABLE t1 CHANGE a b INTEGER;
</PRE>

При изменении типа столбца, но не его имени синтаксис выражения <code>CHANGE</code> все
равно требует указания обоих имен столбца, даже если они одинаковы.
Например:


<PRE>
mysql&#62; ALTER TABLE t1 CHANGE b b BIGINT NOT NULL;
</PRE>

Однако начиная с версии MySQL 3.22.16a можно также использовать выражение
<code>MODIFY</code> для изменения типа столбца без переименовывания его:


<PRE>
mysql&#62; ALTER TABLE t1 MODIFY b BIGINT NOT NULL;
</PRE>

<LI>

При использовании <code>CHANGE</code> или <code>MODIFY</code> для того, чтобы уменьшить длину
столбца, по части которого построен индекс (например, индекс по первым
10 символам столбца <code>VARCHAR</code>), нельзя сделать столбец короче, чем число
проиндексированных символов.

<LI>

При изменении типа столбца с использованием <code>CHANGE</code> или <code>MODIFY</code>  MySQL
пытается преобразовать данные в новый тип как можно корректнее.

<LI>

В версии MySQL 3.22 и более поздних можно использовать <code>FIRST</code> или <code>ADD
... AFTER имя_столбца</code> для добавления столбца на заданную позицию внутри
табличной строки. По умолчанию столбец добавляется в конце. Начиная с
версии MySQL 4.0.1, можно также использовать ключевые слова <code>FIRST</code> и
<code>AFTER</code> в опциях <code>CHANGE</code> или <code>MODIFY</code>.

<A NAME="IDX1421"></A>
<A NAME="IDX1422"></A>
<A NAME="IDX1423"></A>
<A NAME="IDX1424"></A>
<A NAME="IDX1425"></A>
<LI>

Опция  <code>ALTER COLUMN</code> задает для столбца новое значение по умолчанию
или удаляет старое. Если старое значение по умолчанию удаляется и
данный столбец может принимать значение <code>NULL</code>, то новое значение по
умолчанию будет <code>NULL</code>. Если столбец не может быть <code>NULL</code>, то MySQL
назначает значение по умолчанию так, как описано в разделе section <A HREF="manual.ru.html#CREATE_TABLE">6.5.3  Синтаксис оператора <code>CREATE TABLE</code></A>.

<LI>

<A NAME="IDX1426"></A>
<A NAME="IDX1427"></A>
<A NAME="IDX1428"></A>
Опция  <code>DROP INDEX</code> удаляет индекс. Это является расширением MySQL по
отношению к ANSI  SQL92. See section <A HREF="manual.ru.html#DROP_INDEX">6.5.8  Синтаксис оператора  <code>DROP INDEX</code></A>.

<LI>

Если столбцы удаляются из таблицы, то эти столбцы удаляются также и из
любого индекса, в который они входят как часть. Если все столбцы,
составляющие индекс, удаляются, то данный индекс также удаляется.

<LI>

Если таблица содержит только один столбец, то этот столбец не может
быть удален. Вместо этого можно удалить данную таблицу, используя
команду <code>DROP TABLE</code>.

<LI>

<A NAME="IDX1429"></A>
<A NAME="IDX1430"></A>
Опция  <code>DROP PRIMARY KEY</code> удаляет первичный индекс. Если такого
индекса в данной таблице не существует, то удаляется первый индекс
<code>UNIQUE</code> в этой таблице. (MySQL отмечает первый уникальный ключ <code>UNIQUE</code>
как первичный ключ <code>PRIMARY KEY</code>, если никакой другой первичный ключ
<code>PRIMARY KEY</code> не был явно указан). При добавлении <code>UNIQUE INDEX</code> или
<code>PRIMARY KEY</code> в таблицу они хранятся перед остальными неуникальными
ключами, чтобы можно было определить дублирующиеся ключи как можно
раньше.

<LI>

<A NAME="IDX1431"></A>
Опция  <code>ORDER BY</code> позволяет создавать новую таблицу со строками,
размещенными в заданном порядке. Следует учитывать, что созданная
таблица не будет сохранять этот порядок строк после операций вставки и
удаления. В некоторых случаях такая возможность может облегчить
операцию сортировки в MySQL, если таблица имеет такое расположение
столбцов, которое вы хотели бы иметь в дальнейшем. Эта опция в
основном полезна, если заранее известен определенный порядок, в
котором преимущественно будут запрашиваться строки. Использование
данной опции после значительных преобразований таблицы дает
возможность получить более высокую производительность.

<LI>

<A NAME="IDX1432"></A>
При использовании команды <code>ALTER TABLE</code> для таблиц <code>MyISAM</code> все
неуникальные индексы создаются в отдельном пакете (подобно <code>REPAIR</code>).
Благодаря этому команда <code>ALTER TABLE</code> при наличии нескольких индексов
будет работать быстрее.

<LI>

Начиная с MySQL 4.0, вышеуказанная возможность может быть
активизирована явным образом. Команда <code>ALTER TABLE ... DISABLE KEYS</code>
блокирует в MySQL обновление неуникальных индексов для таблиц <code>MyISAM</code>.
После этого можно применить команду  <code>ALTER TABLE ... ENABLE KEYS</code> для
воссоздания недостающих индексов. Так как MySQL делает это с помощью
специального алгоритма, который намного быстрее в сравнении со
вставкой ключей один за другим, блокировка ключей может дать
существенное ускорение на больших массивах вставок.

<LI>

<A NAME="IDX1433"></A>
Применяя функцию C  API  <code>mysql_info()</code>, можно определить, сколько
записей было скопировано, а также (при использовании <code>IGNORE</code>) - сколько
записей было удалено из-за дублирования значений уникальных ключей.

<LI>

<A NAME="IDX1434"></A>
<A NAME="IDX1435"></A>
Выражения <code>FOREIGN KEY</code>, <code>CHECK</code> и <code>REFERENCES</code> фактически
ничего не делают во всех типах таблиц, кроме InnoDB. InnoDB поддерживает
<code>ADD CONSTRAINT FOREIGN KEY (...) REFERENCES ... (...)</code>.  Заметьте, что
InnoDB не допускает указания <code>index_name</code>. See section <A HREF="manual.ru.html#InnoDB">7.5  Таблицы <code>InnoDB</code></A>.  Поддержка
синтаксиса FOREIGH KEY введена только из соображений совместимости, чтобы
облегчить перенос кода с других серверов SQL и запуск приложений, создающих
таблицы со ссылками. See section <A HREF="manual.ru.html#Differences_from_ANSI">1.9.4  Отличия MySQL от ANSI SQL92</A>.  
</UL>

<P>
Ниже приводятся примеры, показывающие некоторые случаи употребления
команды <code>ALTER TABLE</code>. Пример начинается с таблицы <code>t1</code>, которая создается
следующим образом:

</P>

<PRE>
mysql&#62; CREATE TABLE t1 (a INTEGER,b CHAR(10));
</PRE>

<P>
Для того чтобы переименовать таблицу из <code>t1</code> в <code>t2</code>:

</P>

<PRE>
mysql&#62; ALTER TABLE t1 RENAME t2;
</PRE>

<P>
Для того чтобы изменить тип столбца с <code>INTEGER</code> на <code>TINYINT NOT NULL</code>
(оставляя имя прежним) и изменить тип столбца <code>b</code> с <code>CHAR(10)</code> на <code>CHAR(20)</code> с
переименованием его с <code>b</code> на <code>c</code>:

</P>

<PRE>
mysql&#62; ALTER TABLE t2 MODIFY a TINYINT NOT NULL, CHANGE b c CHAR(20);
</PRE>

<P>
Для того чтобы добавить новый столбец <code>TIMESTAMP</code> с именем <code>d</code>:

</P>

<PRE>
mysql&#62; ALTER TABLE t2 ADD d TIMESTAMP;
</PRE>

<P>
Для того чтобы добавить индекс к столбцу <code>d</code> и сделать столбец a первичным
ключом:

</P>

<PRE>
mysql&#62; ALTER TABLE t2 ADD INDEX (d), ADD PRIMARY KEY (a);
</PRE>

<P>
Для того чтобы удалить столбец <code>c</code>:

</P>

<PRE>
mysql&#62; ALTER TABLE t2 DROP COLUMN c;
</PRE>

<P>
Для того чтобы добавить новый числовой столбец <code>AUTO_INCREMENT</code> с именем <code>c</code>:

</P>

<PRE>
mysql&#62; ALTER TABLE t2 ADD c INT UNSIGNED NOT NULL AUTO_INCREMENT,
        ADD INDEX (c);
</PRE>

<P>
Заметьте, что столбец <code>c</code> индексируется, так как столбцы <code>AUTO_INCREMENT</code>
должны быть индексированы, кроме того, столбец <code>c</code> объявляется как <code>NOT 
NULL</code>, поскольку индексированные столбцы не могут быть <code>NULL</code>.

</P>
<P>
При добавлении столбца <code>AUTO_INCREMENT</code> значения этого столбца автоматически
заполняются последовательными номерами (при добавлении записей). Первый
номер последовательности можно установить путем выполнения команды <code>SET
INSERT_ID=#</code> перед <code>ALTER TABLE</code> или использования табличной опции
<code>AUTO_INCREMENT = #</code>. See section <A HREF="manual.ru.html#SET_OPTION">5.5.6  Синтаксис команды <code>SET</code></A>.

</P>
<P>
Если столбец <code>AUTO_INCREMENT</code> для таблиц <code>MyISAM</code>, не изменяется, то номер
последовательности остается прежним. При удалении столбца <code>AUTO_INCREMENT</code> и
последующем добавлении другого столбца <code>AUTO_INCREMENT</code> номера будут
начинаться снова с <code>1</code>.

</P>
<P>
See section <A HREF="manual.ru.html#ALTER_TABLE_problems">A.6.1  Проблемы с <code>ALTER TABLE</code></A>.

</P>


<H3><A NAME="RENAME_TABLE" HREF="manual.ru_toc.html#RENAME_TABLE">6.5.5  Синтаксис оператора  <code>RENAME TABLE</code></A></H3>

<P>
<A NAME="IDX1436"></A>

</P>

<PRE>
RENAME TABLE tbl_name TO new_tbl_name[, tbl_name2 TO new_tbl_name2,...]
</PRE>

<P>
Операция переименования должна осуществляться как атомарная, т.е. при
выполнении переименования никакому другому потоку не разрешается доступ к
указанным таблицам. Благодаря этому возможно замещение таблицы пустой
таблицей:

</P>

<PRE>
CREATE TABLE new_table (...);
RENAME TABLE old_table TO backup_table, new_table TO old_table;
</PRE>

<P>
Переименование производится слева направо. Таким образом, для обмена
именами между двумя таблицами необходимо выполнить следующие действия:

</P>

<PRE>
RENAME TABLE old_table TO backup_table,
        new_table TO old_table,
        backup_table TO new_table;
</PRE>

<P>
Для двух баз данных, находящихся на одном и том же диске, можно также
осуществлять обмен именами:

</P>

<PRE>
RENAME TABLE current_db.tbl_name TO other_db.tbl_name;
</PRE>

<P>
При выполнении команды <code>RENAME</code> не должны иметь место заблокированные
таблицы или активные транзакции. Необходимо также иметь привилегии <code>ALTER</code> и
<code>DROP</code> для исходной таблицы и привилегии <code>CREATE</code> и <code>INSERT</code> - для новой.

</P>
<P>
Если MySQL сталкивается с какой-либо ошибкой при переименовании нескольких
таблиц, то произойдет обратное переименование для всех переименованных
таблиц, чтобы вернуть все в исходное состояние.

</P>
<P>
Оператор <code>RENAME TABLE</code> был добавлен в MySQL 3.23.23.

</P>


<H3><A NAME="DROP_TABLE" HREF="manual.ru_toc.html#DROP_TABLE">6.5.6  Синтаксис оператора  <code>DROP TABLE</code></A></H3>

<P>
<A NAME="IDX1437"></A>
<A NAME="IDX1438"></A>
<A NAME="IDX1439"></A>

</P>

<PRE>
DROP [TEMPORARY] TABLE [IF EXISTS] tbl_name [, tbl_name,...] [RESTRICT | CASCADE]
</PRE>

<P>
Оператор <code>DROP TABLE</code> удаляет одну или несколько таблиц. Все табличные
данные и определения удаляются, так что будьте внимательны при работе с
этой командой!

</P>
<P>
В версии MySQL 3.22 и более поздних можно использовать ключевые слова <code>IF 
EXISTS</code>, чтобы предупредить ошибку, если указанные таблицы не существуют.

</P>
<P>
В 4.1 будет получено замечание (<code>NOTE</code>) для всех несуществующих таблиц при
использовании <code>IF EXISTS</code>.  See section <A HREF="manual.ru.html#SHOW_WARNINGS">4.5.6.9  <code>SHOW WARNINGS | ERRORS</code></A>.

</P>
<P>
Опции  <code>RESTRICT</code> и <code>CASCADE</code> позволяют упростить перенос программы. В данный
момент они не задействованы.

</P>
<P>
Примечание: <code>DROP TABLE</code> автоматически принимает текущую активную
транзакцию (за исключением случаев, когда вы используетее 4.1 и указано
ключевое слово <code>TEMPORARY</code>).

</P>
<P>
Опция <code>TEMPORARY</code> игнорируется в 4.0. В 4.1 эта опция работает следующим образом: 

</P>

<UL>
<LI>

Только уничтожает временные таблицы.
<LI>

Не закрывает открытую транзакцию.
<LI>

Права доступа не проверяются.
</UL>

<P>
Использование слова <code>TEMPORARY</code> - это хороший способ удостовериться что вы случайно
не уничтожите настоящую таблицу.

</P>


<H3><A NAME="CREATE_INDEX" HREF="manual.ru_toc.html#CREATE_INDEX">6.5.7  Синтаксис оператора <code>CREATE INDEX</code></A></H3>

<P>
<A NAME="IDX1440"></A>
<A NAME="IDX1441"></A>
<A NAME="IDX1442"></A>

</P>

<PRE>
CREATE [UNIQUE|FULLTEXT] INDEX index_name
        ON tbl_name (col_name[(length)],... )
</PRE>

<P>
Команда <code>CREATE INDEX</code> в версиях MySQL до 3.22 не выполняет никаких
действий. В версии 3.22 и более поздних <code>CREATE INDEX</code> соответствует
команде <code>ALTER TABLE</code> в части создания индексов. See section <A HREF="manual.ru.html#ALTER_TABLE">6.5.4  Синтаксис оператора <code>ALTER TABLE</code></A>.

</P>
<P>
Обычно все индексы создаются в таблице во время создания самой таблицы
командой <code>CREATE TABLE</code>. See section <A HREF="manual.ru.html#CREATE_TABLE">6.5.3  Синтаксис оператора <code>CREATE TABLE</code></A>. <code>CREATE INDEX</code> дает
возможность добавить индексы к существующим таблицам.

</P>
<P>
Список столбцов в форме <code>(col1,col2,...)</code> создает индекс для нескольких
столбцов. Величины индексов формируются путем конкатенации величин
указанных столбцов.

</P>
<P>
Для столбцов типов <code>CHAR</code> и <code>VARCHAR</code> с помощью параметра
<code>col_name(length)</code> могут создаваться индексы, для которых используется только
часть столбца (для столбцов <code>BLOB</code> и <code>TEXT</code> нужно указывать длину). Команда,
приведенная ниже, создает индекс, используя первые 10 символов столбца
name:

</P>

<PRE>
mysql&#62; CREATE INDEX part_of_name ON customer (name(10));
</PRE>

<P>
Поскольку большинство имен обычно имеют отличия друг от друга в первых 10
символах, данный индекс не должен быть намного медленнее, чем созданный из
столбца name целиком. Кроме того, используя неполные столбцы для индексов,
можно сделать файл индексов намного меньше, а это позволяет сэкономить
место на диске и к тому же повысить скорость операций <code>INSERT</code>!

</P>
<P>
Следует учитывать, что в версии MySQL 3.23.2 и более поздних для таблиц
типа <code>MyISAM</code> можно добавлять индекс только для столбцов, которые могут
принимать величины <code>NULL</code> или для столбцов <code>BLOB/TEXT</code>.

</P>
<P>
Чтобы получить более подробную информацию о том, как <code>MySQL</code> использует
индексы, See section <A HREF="manual.ru.html#MySQL_indexes">5.4.3  Использование индексов в MySQL</A>.

</P>
<P>
С помощью опции <code>FULLTEXT</code> можно индексировать только столбцы <code>VARCHAR</code> и <code>TEXT</code>
и только в таблицах <code>MyISAM</code>. Эта возможность доступна только в версии MySQL
3.23.23 и выше. See section <A HREF="manual.ru.html#Fulltext_Search">6.8  Полнотекстовый поиск в MySQL</A>.

</P>


<H3><A NAME="DROP_INDEX" HREF="manual.ru_toc.html#DROP_INDEX">6.5.8  Синтаксис оператора  <code>DROP INDEX</code></A></H3>

<P>
<A NAME="IDX1443"></A>
<A NAME="IDX1444"></A>
<A NAME="IDX1445"></A>

</P>

<PRE>
DROP INDEX index_name ON tbl_name
</PRE>

<P>
Оператор <code>DROP INDEX</code> удаляет индексы, указанные в <code>index_name</code> из таблицы
<code>tbl_name</code>. <code>DROP INDEX</code> не выполняет никаких действий в версиях MySQL до
3.22. В версиях 3.22 и более поздних <code>DROP INDEX</code> соответствует команде 
<code>ALTER TABLE</code> в части удаления индексов. See section <A HREF="manual.ru.html#ALTER_TABLE">6.5.4  Синтаксис оператора <code>ALTER TABLE</code></A>.

</P>


<H2><A NAME="Basic_User_Commands" HREF="manual.ru_toc.html#Basic_User_Commands">6.6  Основные команды пользовательских программ MySQL</A></H2>



<H3><A NAME="USE" HREF="manual.ru_toc.html#USE">6.6.1  Синтаксис команды <code>USE</code></A></H3>

<P>
<A NAME="IDX1446"></A>

</P>

<PRE>
USE db_name
</PRE>

<P>
Команда <code>USE db_name</code> предписывает MySQL использовать базу данных с именем
<code>db_name</code> в последующих запросах по умолчанию. Указанная база данных
остается в этом состоянии до конца данного сеанса или пока не будет выдана
еще одна команда <code>USE</code>:

</P>

<PRE>
mysql&#62; USE db1;
mysql&#62; SELECT COUNT(*) FROM mytable; # selects from db1.mytable
mysql&#62; USE db2;
mysql&#62; SELECT COUNT(*) FROM mytable; # selects from db2.mytable
</PRE>

<P>
То обстоятельство, что отдельная база данных посредством команды <code>USE</code>
выбирается как используемая в текущий момент по умолчанию, не является
препятствием для доступа к таблицам других баз данных. Следующий пример
иллюстрирует получение доступа к таблице <code>author</code> базы данных <code>db1</code> и к
таблице <code>editor</code> базы данных <code>db2</code>:

</P>

<PRE>
mysql&#62; USE db1;
mysql&#62; SELECT author_name,editor_name FROM author,db2.editor
        WHERE author.editor_id = db2.editor.editor_id;
</PRE>

<P>
<A NAME="IDX1447"></A>
Наличие команды <code>USE</code> обеспечивает совместимость с Sybase.

</P>


<H3><A NAME="DESCRIBE" HREF="manual.ru_toc.html#DESCRIBE">6.6.2  Синтаксис команды <code>DESCRIBE</code> (Получение информации о столбцах)</A></H3>

<P>
<A NAME="IDX1448"></A>
<A NAME="IDX1449"></A>

</P>

<PRE>
{DESCRIBE | DESC} tbl_name [col_name | wild]
</PRE>

<P>
Команда <code>DESCRIBE</code> представляет собой сокращенный вариант команды <code>SHOW
COLUMNS FROM</code>. See section <A HREF="manual.ru.html#SHOW_DATABASE_INFO">4.5.6.1  Получение информации по базам данных, таблицам, столбцам и индексам</A>.

</P>
<P>
Команда <code>DESCRIBE</code> предоставляет информацию о столбцах таблицы. Параметр
<code>col_name</code> может содержать имя столбца или строки, включающей такие
групповые символы SQL, как <samp>`%'</samp> и <samp>`_'</samp> (шаблонные символы, позволяющие
получить информацию о всех подходящих столбцах). В кавычки брать строку не нужно. 

</P>
<P>
Следует отметить, что типы столбцов в полученном описании могут отличаться
от ожидаемых, первоначально заданных командой <code>CREATE TABLE</code> при создании
таблицы, поскольку MySQL иногда изменяет типы столбцов. See section <A HREF="manual.ru.html#Silent_column_changes">6.5.3.1  Молчаливые изменения определений столбцов</A>.

</P>
<P>
<A NAME="IDX1450"></A>
Данная команда обеспечивает совместимость с Oracle.

</P>
<P>
Команда <code>SHOW</code> предоставляет аналогичную информацию.
See section <A HREF="manual.ru.html#SHOW">4.5.6  Синтаксис команды <code>SHOW</code></A>.

</P>


<H2><A NAME="Transactional_Commands" HREF="manual.ru_toc.html#Transactional_Commands">6.7  Команды управления транзакциями и блокировками в MySQL</A></H2>

<P>
 


<H3><A NAME="COMMIT" HREF="manual.ru_toc.html#COMMIT">6.7.1  Синтаксис команд <code>BEGIN/COMMIT/ROLLBACK</code></A></H3>

<P>
<A NAME="IDX1451"></A>
<A NAME="IDX1452"></A>
<A NAME="IDX1453"></A>
<A NAME="IDX1454"></A>

</P>
<P>
По умолчанию MySQL работает в режиме <code>autocommit</code>. Это означает, что при
выполнении обновления данных MySQL будет сразу записывать обновленные
данные на диск.

</P>
<P>
При использовании таблиц, поддерживающих транзакции (таких как <code>InnoDB</code>,
<code>BDB</code>), в  MySQL  можно отключить режим autocommit при помощи следующей
команды:

</P>

<PRE>
SET AUTOCOMMIT=0
</PRE>

<P>
После этого необходимо применить команду <code>COMMIT</code> для записи изменений на
диск или команду <code>ROLLBACK</code>, которая позволяет игнорировать изменения,
произведенные с начала данной транзакции.

</P>
<P>
Если необходимо переключиться из режима <code>AUTOCOMMIT</code> только для выполнения
одной последовательности команд, то для этого можно использовать команду <code>START TRANSACTION</code>
или <code>BEGIN</code> или <code>BEGIN WORK</code>:

</P>

<PRE>
START TRANSACTION;
SELECT @A:=SUM(salary) FROM table1 WHERE type=1;
UPDATE table2 SET summmary=@A WHERE type=1;
COMMIT;
</PRE>

<P>
<code>START TRANSACTION</code> была добавлена в MySQL 4.0.11. Это - рекомендованный
способ открыть транзакцию, в соответствии с синтаксисом ANSI SQL. 

</P>
<P>
Отметим, что при использовании таблиц, не поддерживающих транзакции,
изменения будут записаны сразу же, независимо от статуса режима
<code>autocommit</code>.

</P>
<P>
При выполнении команды <code>ROLLBACK</code> после обновления таблицы, не
поддерживающей транзакции, пользователь получит ошибку
(<code>ER_WARNING_NOT_COMPLETE_ROLLBACK</code>) в виде предупреждения. Все таблицы,
поддерживающие транзакции, будут перезаписаны, но ни одна таблица, не
поддерживающая транзакции, не будет изменена.

</P>
<P>
При выполнении команд <code>START TRANSACTION</code> или <code>SET AUTOCOMMIT=0</code> необходимо использовать
двоичный журнал MySQL для резервных копий вместо более старого
журнала записи изменений. Транзакции сохраняются в двоичном системном
журнале как одна порция данных (перед операцией <code>COMMIT</code>), чтобы
гарантировать, что транзакции, по которым происходит откат, не
записываются. See section <A HREF="manual.ru.html#Binary_log">4.9.4  Бинарный журнал обновлений</A>.

</P>
<P>
Следующие команды автоматически завершают транзакцию (как если бы перед
выполнением данной команды была сделана операция <code>COMMIT</code> ):

</P>
<TABLE BORDER>
<TR><TD><strong>Команда</strong> </TD><TD> <strong>Команда</strong> </TD><TD> <strong>Команда</strong>
</TD></TR>
<TR><TD><code>ALTER TABLE</code> </TD><TD> <code>BEGIN</code> </TD><TD> <code>CREATE INDEX</code>
</TD></TR>
<TR><TD><code>DROP DATABASE</code> </TD><TD> <code>DROP TABLE</code> </TD><TD> <code>RENAME TABLE</code>
</TD></TR>
<TR><TD><code>TRUNCATE</code> </TD><TD> </TD><TD> 
</TD></TR>
</TABLE>

<P>
Уровень изоляции для транзакций можно изменить с помощью команды <code>SET 
TRANSACTION ISOLATION LEVEL ...</code>. See section <A HREF="manual.ru.html#SET_TRANSACTION">6.7.3  Синтаксис команды <code>SET TRANSACTION</code></A>.

</P>


<H3><A NAME="LOCK_TABLES" HREF="manual.ru_toc.html#LOCK_TABLES">6.7.2  Синтаксис команд <code>LOCK TABLES/UNLOCK TABLES</code></A></H3>

<P>
<A NAME="IDX1455"></A>
<A NAME="IDX1456"></A>

</P>

<PRE>
LOCK TABLES tbl_name [AS alias] {READ [LOCAL] | [LOW_PRIORITY] WRITE}
            [, tbl_name [AS alias] {READ [LOCAL] | [LOW_PRIORITY] WRITE} ...]
...
UNLOCK TABLES
</PRE>

<P>
Команда <code>LOCK TABLES</code> блокирует указанные в ней таблицы для данного потока.
Команда <code>UNLOCK TABLES</code> снимает любые блокировки, удерживаемые данным
потоком. Все таблицы, заблокированные текущим потоком, автоматически
разблокируются при появлении в потоке иной команды <code>LOCK TABLES</code> или при
прекращении соединения с сервером.

</P>
<P>
Чтобы использовать команду <code>LOCK TABLES</code> в MySQL 4.0.2, необходимо иметь
глобальные привилегии <code>LOCK TABLES</code> и <code>SELECT</code> для заданных таблиц. В MySQL
3.23 для этого необходимы привилегии <code>SELECT</code>, <code>INSERT</code>, <code>DELETE</code> и <code>UPDATE</code> для
рассматриваемых таблиц.

</P>
<P>
Основные преимущества использования команды <code>LOCK TABLES</code> состоят в том,
что она позволяет осуществлять эмуляцию транзакций или получить более
высокую скорость при обновлении таблиц. Ниже это разъясняется более
подробно.

</P>
<P>
Если в потоке возникает блокировка операции <code>READ</code> для некоторой таблицы, то
только этот поток (и все другие потоки) могут читать из данной таблицы.
Если для некоторой таблицы в потоке существует блокировка <code>WRITE</code>, тогда
только поток, содержащий блокировку, может осуществлять операции чтения (<code>READ</code>) и
записи (<code>WRITE</code>) на данной таблице. Остальные потоки блокируются.

</P>

<P>
Различие между <code>READ LOCAL</code> и <code>READ</code> состоит в том, что <code>READ LOCAL</code> позволяет
выполнять неконфликтующие команды <code>INSERT</code> во время существования
блокировки. Однако эту команду нельзя использовать для работы с файлами
базы данных вне сервера MySQL во время данной блокировки.

</P>
<P>
При использовании команды <code>LOCK TABLES</code> необходимо блокировать все таблицы,
которые предполагается использовать в последующих запросах, употребляя при
этом те же самые псевдонимы, которые будут в запросах! Если таблица
упоминается в запросе несколько раз (с псевдонимами), необходимо
заблокировать каждый псевдоним!

</P>
<P>
Блокировка <code>WRITE</code> обычно имеет более высокий приоритет, чем блокировка <code>READ</code>,
чтобы гарантировать, что изменения обрабатываются так быстро, как
возможно. Это означает, что если один поток получает блокировку <code>READ</code> и
затем иной поток запрашивает блокировку <code>WRITE</code>, последующие запросы на
блокировку <code>READ</code> будут ожидать, пока поток <code>WRITE</code> не получит блокировку и не
снимет ее. Можно использовать блокировки <code>LOW_PRIORITY WRITE</code>, позволяющие
другим потокам получать блокировки <code>READ</code> в то время, как основной поток
находится в состоянии ожидания блокировки <code>WRITE</code>. Блокировки <code>LOW_PRIORITY</code> 
<code>WRITE</code> могут быть использованы только если есть уверенность, что в конечном
итоге будет период времени, когда ни один из потоков не будет иметь
блокировки <code>READ</code>.

</P>
<P>
Команда <code>LOCK TABLES</code> работает следующим образом:

</P>

<OL>
<LI>

Сортирует все блокируемые таблицы в порядке, который задан внутренним
образом, т.е. ``зашит'' (с точки зрения пользователя этот порядок не
задан).

<LI>

Блокировка <code>WRITE</code> ставится перед блокировкой  <code>READ</code>, если таблицы
блокируются с блокировками <code>READ</code> и <code>WRITE</code>.

<LI>

Блокирует одну таблицу единовременно, пока поток не получит все
блокировки.
</OL>

<P>
Описанный порядок действий гарантирует, что блокирование таблицы не
создает тупиковой ситуации. Однако есть и другие вещи, о которых
необходимо отдавать себе отчет при работе по описанной схеме:

</P>
<P>
Использование для таблицы блокировки <code>LOW_PRIORITY WRITE</code> всего лишь
означает, что MySQL будет выполнять данную конкретную блокировку, пока не
появится поток, запрашивающий блокировку <code>READ</code>. Если поток получил
блокировку <code>WRITE</code> и находится в ожидании блокировки следующей таблицы из
списка блокируемых таблиц, то все остальные потоки будут ожидать, пока
блокировка <code>WRITE</code> не будет снята. Если это представляет серьезную проблему
для вашего приложения, то следует подумать о преобразовании имеющихся
таблиц в таблицы иного вида, поддерживающие транзакции.

</P>
<P>
Поток, ожидающий блокировку таблицы, можно безопасно уничтожить с помощью
команды <code>KILL</code>. See section <A HREF="manual.ru.html#KILL">4.5.5  Синтаксис команды <code>KILL</code></A>.

</P>
<P>
Учтите, что нельзя блокировать любые таблицы, используемые совместно с
оператором <code>INSERT DELAYED</code>, поскольку в этом случае команда <code>INSERT</code>
выполняется как отдельный поток.

</P>
<P>
Обычно нет необходимости блокировать таблицы, поскольку все единичные
команды <code>UPDATE</code> являются неделимыми; никакой другой поток не может
взаимодействовать с какой-либо SQL-командой, выполняемой в данное время.
Однако в некоторых случаях предпочтительно тем или иным образом
осуществлять блокировку таблиц:

</P>

<UL>
<LI>

Если предполагается выполнить большое количество операций на группе
взаимосвязанных таблиц, то быстрее всего это сделать, блокировав
таблицы, которые вы собираетесь использовать. Конечно, это имеет свою
обратную сторону, поскольку никакой другой поток управления не может
обновить таблицу с блокировкой <code>READ</code> или прочитать таблицу с
блокировкой <code>WRITE</code>. При блокировке <code>LOCK TABLES</code> операции выполняются
быстрее потому, что в этом случае MySQL не производит запись на диск
содержимого кэша ключей для заблокированных таблиц, пока не будет
вызвана команда <code>UNLOCK TABLES</code> (обычно кэш ключей записывается на диск
после каждой SQL-команды). Применение <code>LOCK TABLES</code> увеличивает
скорость записи/обновления/удаления в таблицах типа <code>MyISAM</code>.

<LI>

Если вы используете таблицы, не поддерживающие транзакций, то при использовании
программы обработки таблиц необходимо применять команду <code>LOCK TABLES</code>
для гарантии, что никакой другой поток не вклинился между операциями
<code>SELECT</code> и <code>UPDATE</code>. Ниже показан пример, требующий использования <code>LOCK 
TABLES</code> для успешного выполнения операций:


<PRE>
mysql&#62; LOCK TABLES trans READ, customer WRITE;
mysql&#62; SELECT SUM(value) FROM trans WHERE customer_id=some_id;
mysql&#62; UPDATE customer SET total_value=sum_from_previous_statement
        WHERE customer_id=some_id;
mysql&#62; UNLOCK TABLES;
</PRE>

Без использования <code>LOCK TABLES</code> существует вероятность того, что какой-либо
иной поток управления может вставить новую строку в таблицу <code>trans</code> между
выполнением операций <code>SELECT</code> и <code>UPDATE</code>.
</UL>

<P>
Используя пошаговые обновления (<code>UPDATE customer SET 
value=value+new_value</code>) или функцию <code>LAST_INSERT_ID()</code>, применения команды
<code>LOCK TABLES</code>  во многих случаях можно избежать.

</P>
<P>
Некоторые проблемы можно также решить путем применения блокирующих функций
на уровне пользователя <code>GET_LOCK()</code> и <code>RELEASE_LOCK()</code>. Эти блоки хранятся в
хэш-таблице на сервере и, чтобы обеспечить высокую скорость, реализованы в
виде <code>pthread_mutex_lock()</code> и <code>pthread_mutex_unlock()</code>.
See section <A HREF="manual.ru.html#Miscellaneous_functions">6.3.6.2  Разные функции</A>.

</P>
<P>
Чтобы получить дополнительную информацию о механизме блокировки,
обращайтесь к разделу section <A HREF="manual.ru.html#Internal_locking">5.3.1  Как MySQL блокирует таблицы</A>.

</P>
<P>
Можно блокировать все таблицы во всех базах данных блокировкой <code>READ</code> с
помощью команды <code>FLUSH TABLES WITH READ LOCK</code>. See section <A HREF="manual.ru.html#FLUSH">4.5.3  Синтаксис команды <code>FLUSH</code></A>.
Это очень удобно для получения резервной копии файловой системы, подобной
Veritas, при работе в которой могут потребоваться заблаговременные копии
памяти.

</P>
<P>
Примечание: Команда <code>LOCK TABLES</code> не сохраняет транзакции и автоматически
фиксирует все активные транзакции перед попыткой блокировать таблицы.

</P>


<H3><A NAME="SET_TRANSACTION" HREF="manual.ru_toc.html#SET_TRANSACTION">6.7.3  Синтаксис команды <code>SET TRANSACTION</code></A></H3>

<P>
<A NAME="IDX1457"></A>
<A NAME="IDX1458"></A>

</P>

<PRE>
SET [GLOBAL | SESSION] TRANSACTION ISOLATION LEVEL
{ READ UNCOMMITTED | READ COMMITTED | REPEATABLE READ | SERIALIZABLE }
</PRE>

<P>
Устанавливает уровень изоляции транзакций.

</P>
<P>
По умолчанию уровень изоляции устанавливается для последующей (не
начальной) транзакции. При использовании ключевого слова <code>GLOBAL</code> данная
команда устанавливает уровень изоляции по умолчанию глобально для всех
новых соединений, созданных от этого момента. Однако для того чтобы
выполнить данную команду, необходима привилегия <code>SUPER</code>. При использовании
ключевого слова <code>SESSION</code> устанавливается уровень изоляции по умолчанию для
всех будущих транзакций, выполняемых в текущем соединении.

</P>
<P>
Установить глобальный уровень изоляции по умолчанию для утилиты <code>mysqld</code>
можно с помощью опции <code>--transaction-isolation=...</code>. See section <A HREF="manual.ru.html#Command-line_options">4.1.1  Параметры командной строки <code>mysqld</code></A>.

</P>


<H2><A NAME="Fulltext_Search" HREF="manual.ru_toc.html#Fulltext_Search">6.8  Полнотекстовый поиск в MySQL</A></H2>

<P>
<A NAME="IDX1459"></A>
<A NAME="IDX1460"></A>
<A NAME="IDX1461"></A>

</P>
<P>
С 3.23.23 MySQL поддерживает
полнотекстовый поиск и индексацию. Полнотекстовые индексы в MySQL обозначаются
как индексы типа <code>FULLTEXT</code>. Эти индексы могут быть созданы в таблицах
MyISAM в столбцах <code>VARCHAR</code> и <code>TEXT</code> во время создания таблицы
командой <code>CREATE TABLE</code> или добавлены позже с помощью команд <code>ALTER
TABLE</code> или <code>CREATE INDEX</code>.  Загрузка больших массивов данных в таблицу
будет происходить намного быстрее, если таблица не содержит индекс
<code>FULLTEXT</code>, который затем создается командой <code>ALTER TABLE</code> (или
<code>CREATE INDEX</code>). Загрузка данных в таблицу, уже имеющую индекс
<code>FULLTEXT</code>, будет более медленной.

</P>
<P>
Полнотекстовый поиск выполняется с помощью функции <code>MATCH()</code>.

</P>

<PRE>
mysql&#62; CREATE TABLE articles (
        id INT UNSIGNED AUTO_INCREMENT NOT NULL PRIMARY KEY,
        title VARCHAR(200),
        body TEXT,
        FULLTEXT (title,body)
        );
Query OK, 0 rows affected (0.00 sec)

mysql&#62; INSERT INTO articles VALUES
    -&#62; (NULL,'MySQL Tutorial', 'DBMS stands for DataBase ...'),
    -&#62; (NULL,'How To Use MySQL Efficiently', 'After you went through a ...'),
    -&#62; (NULL,'Optimising MySQL','In this tutorial we will show ...'),
    -&#62; (NULL,'1001 MySQL Tricks','1. Never run mysqld as root. 2. ...'),
    -&#62; (NULL,'MySQL vs. YourSQL', 'In the following database comparison ...'),
    -&#62; (NULL,'MySQL Security', 'When configured properly, MySQL ...');
Query OK, 6 rows affected (0.00 sec)
Records: 6 Duplicates: 0 Warnings: 0

mysql&#62; SELECT * FROM articles
        WHERE MATCH (title,body) AGAINST ('database');
+----+-------------------+------------------------------------------+
| id | title             | body                                     |
+----+-------------------+------------------------------------------+
|  5 | MySQL vs. YourSQL | In the following database comparison ... |
|  1 | MySQL Tutorial    | DBMS stands for DataBase ...             |
+----+-------------------+------------------------------------------+
2 rows in set (0.00 sec)
</PRE>

<P>
Функция <code>MATCH()</code> выполняет поиск в естественном языке, сравнивая строку с
содержимым текста (совокупность одного или более столбцов, включенных в
индекс <code>FULLTEXT</code>). Строка поиска задается как аргумент в выражении
<code>AGAINST()</code>. Поиск выполняется без учета регистра символов. Для каждой
строки столбца в заданной таблице команда <code>MATCH()</code> возвращает величину
релевантности, т.е. степень сходства между строкой поиска и текстом,
содержащимся в данной строке указанного в списке оператора <code>MATCH()</code> столбца.

</P>
<P>
Когда команда <code>MATCH()</code> используется в выражении <code>WHERE</code> (см. пример выше),
возвращенные строки столбцов автоматически сортируются, начиная с наиболее
релевантных. Величина релевантности представляет собой неотрицательное
число с плавающей точкой. Релевантность вычисляется на основе количества
слов в данной строке столбца, количества уникальных слов в этой строке,
общего количества слов в тексте и числа документов (строк), содержащих
отдельное слово.

</P>
<P>
Поиск возможен также в логическом режиме, это объясняется ниже в данном
разделе.

</P>
<P>
Предыдущий пример представляет собой общую иллюстрацию использования
функции <code>MATCH()</code>. Строки возвращаются в порядке уменьшения релевантности.

</P>
<P>
В следующем примере показано, как извлекать величины релевантности в явном
виде. В случае отсутствия выражений <code>WHERE</code> и <code>ORDER BY</code> возвращаемые строки
не упорядочиваются.

</P>

<PRE>
mysql&#62; SELECT id,MATCH (title,body) AGAINST ('Tutorial') FROM articles;
+----+-----------------------------------------+
| id | MATCH (title,body) AGAINST ('Tutorial') |
+----+-----------------------------------------+
|  1 |                        0.64840710366884 |
|  2 |                                       0 |
|  3 |                        0.66266459031789 |
|  4 |                                       0 |
|  5 |                                       0 |
|  6 |                                       0 |
+----+-----------------------------------------+
6 rows in set (0.00 sec)
</PRE>

<P>
Следующий пример - более сложный. Запрос возвращает значение релевантности
и, кроме того, сортирует строки в порядке убывания релевантности. Чтобы
получить такой результат, необходимо указать <code>MATCH()</code> дважды. Это не
приведет к дополнительным издержкам, так как оптимизатор MySQL учтет, что
эти два вызова <code>MATCH()</code> идентичны, и запустит код полнотекстового поиска
только однажды.

</P>


<PRE>
mysql&#62; SELECT id, body, MATCH (title,body) AGAINST
    -&#62; ('Security implications of running MySQL as root') AS score
    -&#62; FROM articles WHERE MATCH (title,body) AGAINST
    -&#62; ('Security implications of running MySQL as root');
+----+-------------------------------------+-----------------+
| id | body                                | score           |
+----+-------------------------------------+-----------------+
|  4 | 1. Never run mysqld as root. 2. ... | 1.5055546709332 |
|  6 | When configured properly, MySQL ... |   1.31140957288 |
+----+-------------------------------------+-----------------+
2 rows in set (0.00 sec)
</PRE>

<P>
Для разбивки текста на слова MySQL использует очень простой синтаксический
анализатор. ``Словом'' является любая последовательность символов,
состоящая из букв, чисел, знаков <samp>`''</samp> и <samp>`_'</samp>. Любое ``слово'',
присутствующее в стоп-списке (stopword) или просто слишком короткое (3
символа или меньше), игнорируется.

</P>
<P>
Каждое правильное слово в наборе проверяемых текстов и в данном запросе
оценивается в соответствии с его важностью в этом запросе или наборе
текстов. Таким образом, слово, присутствующее во многих документах, будет
иметь меньший вес (и даже, возможно, нулевой), как имеющее более низкое
смысловое значение в данном конкретном наборе текстов. С другой стороны,
редко встречающееся слово получит более высокий вес. Затем полученные
значения весов слов объединяются для вычисления релевантности данной
строки столбца.

</P>
<P>
Описанная техника подсчета лучше всего работает для больших наборов
текстов (фактически она именно для этого тщательно настраивалась). Для
очень малых таблиц распределение слов не отражает адекватно их смысловое
значение, и данная модель иногда может выдавать некорректные результаты.

</P>

<PRE>
mysql&#62; SELECT * FROM articles WHERE MATCH (title,body) AGAINST ('MySQL');
Empty set (0.00 sec)
</PRE>

<P>
Поиск по слову ``MySQL'' в предыдущем примере не приводит к каким-либо
результатам, так как это слово присутствует более чем в половине строк. По
существу, данное слово целесообразно трактовать как стоп-слово (т.е.
слово с нулевой смысловой ценностью). Это наиболее приемлемое решение -
запрос на естественном языке не должен возвращать каждую вторую строку из
таблицы размером 1Гб.

</P>
<P>
Маловероятно, что слово, встречающееся в половине строк таблицы,
определяет местонахождение релевантных документов. На самом деле, наиболее
вероятно, что будет найдено много не относящихся к делу документов.
Общеизвестно, что такое случается слишком часто при попытке найти что-либо
в Интернет с помощью поисковых машин. Именно на этом основании подобным
строкам должно быть назначено низкое смысловое значение в данном
конкретном наборе данных.

</P>
<P>
В MySQL 4.0.1 возможен полнотекстовый поиск также и в логическом режиме с
использованием модификатора <code>IN BOOLEAN MODE</code>.

</P>

<PRE>
mysql&#62; SELECT * FROM articles WHERE MATCH (title,body)
    -&#62;     AGAINST ('+MySQL -YourSQL' IN BOOLEAN MODE);
+----+------------------------------+-------------------------------------+
| id | title                        | body                                |
+----+------------------------------+-------------------------------------+
|  1 | MySQL Tutorial               | DBMS stands for DataBase ...        |
|  2 | How To Use MySQL Efficiently | After you went through a ...        |
|  3 | Optimising MySQL             | In this tutorial we will show ...   |
|  4 | 1001 MySQL Tricks            | 1. Never run mysqld as root. 2. ... |
|  6 | MySQL Security               | When configured properly, MySQL ... |
+----+------------------------------+-------------------------------------+
</PRE>

<P>
Данный запрос вывел все строки, содержащие слово ``MySQL'' (заметьте,
50-процентная пороговая величина здесь не используется), но эти строки не
содержат слова ``YourSQL''. Следует отметить, что логический режим поиска
не сортирует автоматически строки в порядке уменьшения релевантности. Это
видно по результату предыдущего запроса, где строка с наиболее высокой
релевантностью (содержащая слово ``MySQL'' дважды) помещена последней, а
не первой. Логический режим полнотекстового поиска может работать даже без
индекса <code>FULLTEXT</code>, хотя и очень медленно.

</P>
<P>
В логическом режиме полнотекстового поиска поддерживаются следующие
операторы:

</P>
<DL COMPACT>

<DT><code>+</code>
<DD>
Предшествующий слову знак ``плюс'' показывает, что это слово должно
присутствовать в каждой возвращенной строке.

<DT><code>-</code>
<DD>
Предшествующий слову знак ``минус'' означает, что это слово не должно
присутствовать в какой-либо возвращенной строке.

<DT><code></code>
<DD>
По умолчанию (если ни плюс, ни минус не указаны) данное слово является не
обязательным, но содержащие его строки будут оцениваться более высоко. Это
имитирует поведение команды <code>MATCH() ... AGAINST()</code> без модификатора <code>IN
BOOLEAN MODE</code>.

<DT><code>&#60; &#62;</code>
<DD>
Эти два оператора используются для того, чтобы изменить вклад слова в
величину релевантности, которое приписывается строке. Оператор <code>&#60;</code> уменьшает
этот вклад, а оператор <code>&#62;</code> - увеличивает его. См. пример ниже.

<DT><code>( )</code>
<DD>
Круглые скобки группируют слова в подвыражения.

<DT><code>~</code>
<DD>
Предшествующий слову знак ``тильда'' воздействует как оператор отрицания,
обуславливая негативный вклад данного слова в релевантность строки. Им
отмечают нежелательные слова. Строка, содержащая такое слово, будет
оценена ниже других, но не будет исключена совершенно, как в случае
оператора - ``минус''.

<DT><code>*</code>
<DD>
Звездочка является оператором усечения. В отличие от остальных операторов,
она должна добавляться в конце слова, а не в начале.

<DT><code>"</code>
<DD>
Фраза, заключенная в двойные кавычки, соответствует только строкам,
содержащим эту фразу, написанную буквально.
</DL>

<P>
Ниже приведен ряд примеров:

</P>
<DL COMPACT>

<DT><code>apple banana</code>
<DD>
находит строки, содержащие по меньшей мере одно из этих слов.

<DT><code>+apple +juice</code>
<DD>
... оба слова.

<DT><code>+apple macintosh</code>
<DD>
... слово ``apple'', но ранг строки выше, если она также содержит слово
``macintosh''.

<DT><code>+apple -macintosh</code>
<DD>
... слово ``apple'',  но не ``macintosh''.

<DT><code>+apple +(&#62;pie &#60;strudel)</code>
<DD>
... ``apple'' и ``pie'', или ``apple'' и ``strudel'' (в любом порядке), но
ранг ``apple pie'' выше, чем ``apple strudel''.

<DT><code>apple*</code>
<DD>
... ``apple'', ``apples'', ``applesauce'', и ``applet''.

<DT><code>"some words"</code>
<DD>
... ``some words of wisdom'', но не ``some noise words''.
</DL>



<H3><A NAME="Fulltext_Restrictions" HREF="manual.ru_toc.html#Fulltext_Restrictions">6.8.1  Ограничения для полнотекстового поиска</A></H3>


<UL>
<LI>

Все параметры функции <code>MATCH()</code> должны быть столбцами одной и той же
таблицы, т.е. частью одного и того же индекса <code>FULLTEXT</code>, за исключением
работы <code>MATCH()</code> в режиме <code>IN BOOLEAN MODE</code>.

<LI>

Список столбцов в команде <code>MATCH()</code> должен точно соответствовать списку
столбцов в определении индекса <code>FULLTEXT</code> для этой таблицы, за
исключением работы данной функции <code>MATCH()</code> в режиме <code>IN BOOLEAN MODE</code>.

<LI>

Аргумент в выражении <code>AGAINST()</code> должен быть неизменяемой строкой.
</UL>



<H3><A NAME="Fulltext_Fine-tuning" HREF="manual.ru_toc.html#Fulltext_Fine-tuning">6.8.2  Тонкая настройка полнотекстового поиска в MySQL</A></H3>

<P>
К сожалению, полнотекстовый поиск имеет еще мало настраиваемых
пользователем параметров, хотя для последующих модификаций добавление
некоторого их количества является очень важной задачей (TODO). Однако при
наличии исходного дистрибутива MySQL (see section <A HREF="manual.ru.html#Installing_source">2.3  Установка исходного дистрибутива MySQL</A>) имеется больше возможностей управлять полнотекстовым
поиском.

</P>
<P>
Следует отметить, что полнотекстовый поиск был тщательно настроен так,
чтобы обеспечить наилучшую эффективность выполнения данной операции. Если
изменить установленный по умолчанию режим работы, то в большинстве случаев
результаты поиска станут только хуже. Поэтому не вносите какие-либо правки
в код MySQL, если не знаете наверняка, что вы делаете!

</P>

<UL>
Минимальная длина подлежащих индексации слов определяется в MySQL
переменной <code>ft_min_word_len</code> (see section <A HREF="manual.ru.html#SHOW_VARIABLES">4.5.6.4  <code>SHOW VARIABLES</code></A>). Установите
желаемую величину этой переменной и создайте заново индексы <code>FULLTEXT</code>
(эта переменная доступна только в версии MySQL 4.0).

<LI>

Список стоп-слов может быть загружен с файла, указанного в переменной
<code>ft_stopword_file</code>.  See section <A HREF="manual.ru.html#SHOW_VARIABLES">4.5.6.4  <code>SHOW VARIABLES</code></A>.
После модификации стоп-листа перестройте ваши полнотекствые индексы. 
(Эта переменная введена в MySQL 4.0.10)

<LI>

50-процентный порог определяется выбранной конкретной схемой
присваивания весовых коэффициентов. Чтобы отменить ее, измените
следующую строку в <tt>`myisam/ftdefs.h'</tt>:


<PRE>
#define GWS_IN_USE GWS_PROB
</PRE>

на:


<PRE>
#define GWS_IN_USE GWS_FREQ
</PRE>

Затем перекомпилируйте MySQL. Создавать заново индексы в этом случае нет
необходимости. 

Примечание: таким образом вы существенно ухудшите
способность MySQL продуцировать адекватные величины релевантности для
функции <code>MATCH()</code>. Если действительно необходим поиск для таких
общеупотребительных слов, то было бы лучше использовать вместо этого поиск
в режиме <code>IN BOOLEAN MODE</code>, при котором не предусмотрен 50-процентный
порог.

<LI>

Иногда отладчик поисковой машины желает изменить операторы,
используемые для логического поиска по полному тексту. Эти операторы
определяются переменной <code>ft_boolean_syntax</code>. See section <A HREF="manual.ru.html#SHOW_VARIABLES">4.5.6.4  <code>SHOW VARIABLES</code></A>.
Однако эта переменная доступна только для чтения, ее значение
устанавливается в <tt>`myisam/ft_static.c'</tt>.
</UL>

<P>
Наиболее простым способом перестроить полнотекстовый индекс в тех случаях,
когда это нужно - это вот такая команда: 

</P>

<PRE>
mysql&#62; REPAIR TABLE tbl_name QUICK;
</PRE>



<H3><A NAME="Fulltext_TODO" HREF="manual.ru_toc.html#Fulltext_TODO">6.8.3  Предстоящие доработки по полнотекстовому поиску</A></H3>


<UL>
<LI>

Сделать все операции с индексом <code>FULLTEXT</code>  более быстрыми.

<LI>

Операторы схожести

<LI>

Поддержка для слов, тождественных индексам, - чтобы словами могли быть
любые строки, которые пользователь пожелает трактовать как слова,
например "C++", "AS/400", "TCP/IP" и т.д.

<LI>

Поддержка полнотекстового поиска в таблицах типа <code>MERGE</code>.

<LI>

Поддержка многобайтовых наборов символов.

<LI>

Сделать список стоп-слов (``stopword'') зависящим от языка данных.

<LI>

Стемминг (в зависимости от языка данных, конечно).

<LI>

Обобщенный синтаксический пре-анализатор с определяемым пользователем функциониями (UDF).

<LI>

Сделать данную модель поиска более гибкой (путем добавления ряда
регулируемых параметров к <code>FULLTEXT</code> в <code>CREATE/ALTER TABLE</code>).
</UL>



<H2><A NAME="Query_Cache" HREF="manual.ru_toc.html#Query_Cache">6.9  Кэш запросов в MySQL</A></H2>

<P>
<A NAME="IDX1462"></A>
<A NAME="IDX1463"></A>

</P>
<P>
Начиная с версии 4.0.1 сервер MySQL снабжен кэшем запросов. В процессе
работы кэш запросов хранит текст запроса <code>SELECT</code> вместе с соответствующим
результатом, который посылался клиенту. При получении другого идентичного
запроса сервер извлечет результаты из кэша запросов, а не
анализировать и выполнять снова тот же самый запрос.

</P>
<P>
Кэш запросов особенно полезен в средах, где (некоторые) таблицы не
обновляются слишком часто и присутствует много идентичных запросов. Эта
ситуация типична для многих веб-серверов с обширным активным
информационным наполнением.

</P>
<P>
Ниже приведены некоторые данные функционирования для кэша запросов (они
получены во время работы тестового комплекта MySQL под Linux Alpha 2x500
МГц с 2Гб ОЗУ и 64-мегабайтным кэшем запросов):

</P>

<UL>

<LI>

Если все производимые запросы являются простыми (такими как выбор
строки из таблицы с одной строкой), но различаются настолько, что не
могут быть кэшированы, непроизводительные затраты при активном
состоянии кэша запросов составляют 13%. Это можно было бы
рассматривать как сценарий наиболее неблагоприятного варианта. Однако
в реальной жизни запросы более сложны, чем приведенный простой пример,
так что непроизводительные затраты обычно значительно ниже.

<LI>

Поиск строки в таблице с одной строкой происходит на 238% быстрее.
Можно рассматривать эту величину, как близкую к минимальному
увеличению быстродействия, ожидаемого при кэшировании запроса.

<LI>

Если вы хотите запретить кеш запросов, установите переменную
<code>query_cache_size</code> в <code>0</code>. Запрещение кеша запросов не создает лишних
перегрузок для сервера. Вы можете целиком исключить код кеша запросов из
сервера путем указания при компиляции опции <code>--without-query-cache</code> в <code>configure</code>. 
</UL>



<H3><A NAME="Query_Cache_How" HREF="manual.ru_toc.html#Query_Cache_How">6.9.1  Как работает кэширование запросов</A></H3>

<P>
Перед синтаксическим анализом запросы сравниваются, поэтому запросы

</P>

<PRE>
SELECT * FROM tbl_name
</PRE>

<P>
и

</P>

<PRE>
Select * from tbl_name
</PRE>

<P>
для кэша запросов рассматриваются как различные, поскольку они должны быть
абсолютно одинаковыми (байт в байт), чтобы рассматриваться как идентичные.
Помимо этого, запрос может трактоваться как отличающийся, если, например,
какой-либо клиент использует протокол соединения нового формата или иной
набор символов, чем другой клиент.

</P>
<P>
Запросы, использующие различные базы данных, различные версии протоколов
или различные наборы символов по умолчанию, рассматриваются как различные
и кэшируются раздельно.

</P>
<P>
Рассматриваемый кэш надежно работает для запросов вида <code>SELECT CALC_ROWS
...</code> и <code>SELECT FOUND_ROWS() ...</code>, так как число найденных строк всегда
хранится в кэше.

</P>
<P>
Если результат запроса вернулся из кеша запросов, тогда статусная переменная
<code>Com_select</code> не будет увеличена, но вместо нее будет увеличена <code>Qcache_hits</code>.
See section <A HREF="manual.ru.html#Query_Cache_Status_and_Maintenance">6.9.4  Статус и поддержка кэша запросов</A>.

</P>
<P>
При изменениях таблицы (<code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>,
<code>TRUNCATE</code>, <code>ALTER</code> или <code>DROP TABLE|DATABASE</code>), все кэшированные
запросы, использовавшие данную таблицу (возможно, через таблицу
<code>MRG_MyISAM</code>!), становятся недействительными и удаляются из кэша.

</P>
<P>
Если изменения были произведены в поддерживающих транзакции таблицах вида
<code>InnoDB</code>, то все кэшированные запросы становятся недействительными при
выполнении команды <code>COMMIT</code>.

</P>
<P>
Запрос не будет кэширован, если содержит одну из приведенных ниже функций:

</P>
<TABLE BORDER>
<TR><TD><strong>Функция</strong>
 </TD><TD> <strong>Функция</strong>
 </TD><TD> <strong>Функция</strong>
</TD></TR>
<TR><TD><code>Определяемые пользователем функции (UDF)</code>
 </TD><TD> <code>CONNECTION_ID</code>
 </TD><TD> <code>FOUND_ROWS</code>
</TD></TR>
<TR><TD><code>GET_LOCK</code>
 </TD><TD> <code>RELEASE_LOCK</code>
 </TD><TD> <code>LOAD_FILE</code>
</TD></TR>
<TR><TD><code>MASTER_POS_WAIT</code>
 </TD><TD> <code>NOW</code>
 </TD><TD> <code>SYSDATE</code>
</TD></TR>
<TR><TD><code>CURRENT_TIMESTAMP</code>
 </TD><TD> <code>CURDATE</code>
 </TD><TD> <code>CURRENT_DATE</code>
</TD></TR>
<TR><TD><code>CURTIME</code>
 </TD><TD> <code>CURRENT_TIME</code>
 </TD><TD> <code>DATABASE</code>
</TD></TR>
<TR><TD><code>ENCRYPT</code> (с одним параметром)
 </TD><TD> <code>LAST_INSERT_ID</code>
 </TD><TD> <code>RAND</code>
</TD></TR>
<TR><TD><code>UNIX_TIMESTAMP</code> (без параметров)
 </TD><TD> <code>USER</code>
 </TD><TD> <code>BENCHMARK</code>
</TD></TR>
</TABLE>

<P>
Запрос также не будет кэширован, если он содержит переменные пользователя,
работает с системными таблицами <code>mysql</code>, 
или выражен в форме <code>SELECT ... IN SHARE MODE</code>,
<code>SELECT ... INTO OUTFILE ...</code>,
<code>SELECT ... INTO DUMPFILE ...</code> 
или в форме <code>SELECT * FROM 
AUTOINCREMENT_FIELD IS NULL</code> (для получения последнего ID - это для ODBC). 

</P>
<P>
Однако <code>FOUND ROWS()</code> возвратит правильную величину, даже если из кэша был
выбран предыдущий запрос.

</P>
<P>
В случае если запрос не использует таблиц, или использует временные таблицы,
или если пользователь обладает привилегиями уровня столбца на какую-либо из
задействованных таблиц, запрос не будет кеширован.

</P>
<P>
Перед выборкой запроса из кэша запросов MySQL проверит, обладает ли
пользователь привилегией <code>SELECT</code> для всех включенных баз данных и таблиц.
Если это не так, то результат кэширования не используется.

</P>


<H3><A NAME="Query_Cache_Configuration" HREF="manual.ru_toc.html#Query_Cache_Configuration">6.9.2  Конфигурация кэша запросов</A></H3>

<P>
Для кэша запросов в MySQL добавляется несколько системных переменных для
<code>mysqld</code>, которые могут быть установлены в конфигурационном файле или из
командной строки при запуске <code>mysqld</code>.

</P>

<UL>
<LI><code>query_cache_limit</code>

Не кэшировать результаты, большие, чем указано (по
умолчанию 1Мб).

<LI><code>query_cache_size</code>

Память, выделенная для хранения результатов старых
запросов. Если равно <code>0</code>, то кэширование запроса блокируется (по
умолчанию). Указывается в байтах.

<LI><code>query_cache_type</code>

Можно установить следующие (только
числовые) значения:

<TABLE BORDER>
<TR><TD><strong>Опция</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD>0 </TD><TD> <code>OFF</code> (``ВЫКЛЮЧЕНО''), результаты не кэшировать и не извлекать
</TD></TR>
<TR><TD>1 </TD><TD> <code>ON</code> (``ВКЛЮЧЕНО''), кэшировать все результаты, за исключением запросов <code>SELECT SQL_NO_CACHE ...</code>
</TD></TR>
<TR><TD>2 </TD><TD> <code>DEMAND</code> (``ПО ТРЕБОВАНИЮ''), кэшировать только запросы <code>SELECT SQL_CACHE ...</code>
</TD></TR>
</TABLE>

</UL>

<P>
Внутри потока (соединения) можно изменить функционирование кэша запросов
по сравнению с установленным по умолчанию. Синтаксис следующий:

</P>

<PRE>
QUERY_CACHE_TYPE = OFF | ON | DEMAND  
QUERY_CACHE_TYPE = 0   | 1  | 2
</PRE>

<TABLE BORDER>
<TR><TD><strong>Опция</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD>0 или OFF </TD><TD> Результаты не кэшировать и не извлекать.
</TD></TR>
<TR><TD>1 или ON </TD><TD> Кэшировать все результаты за исключением запросов <code>SELECT SQL_NO_CACHE ...</code>
</TD></TR>
<TR><TD>2 или DEMAND </TD><TD> Кэшировать только запросы <code>SELECT SQL_CACHE ...</code>
</TD></TR>
</TABLE>



<H3><A NAME="Query_Cache_in_SELECT" HREF="manual.ru_toc.html#Query_Cache_in_SELECT">6.9.3  Параметры кэша запросов в запросе <code>SELECT</code></A></H3>

<P>
<A NAME="IDX1464"></A>
<A NAME="IDX1465"></A>

</P>
<P>
В запросе <code>SELECT</code> можно указывать две опции для кэша запросов:

</P>
<TABLE BORDER>
<TR><TD><strong>Опция</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD><code>SQL_CACHE</code> </TD><TD> Если <code>QUERY_CACHE_TYPE</code> имеет опцию <code>DEMAND</code>, позволяет запросу
кэшироваться. Если <code>QUERY_CACHE_TYPE</code> имеет опцию <code>ON</code>, является
состоянием по умолчанию. Если <code>QUERY_CACHE_TYPE</code> имеет опцию
<code>OFF</code>, ничего не делать.
</TD></TR>
<TR><TD><code>SQL_NO_CACHE</code> </TD><TD> Делает данный запрос некэшируемым, не разрешает хранить в кэше данный запрос.
</TD></TR>
</TABLE>



<H3><A NAME="Query_Cache_Status_and_Maintenance" HREF="manual.ru_toc.html#Query_Cache_Status_and_Maintenance">6.9.4  Статус и поддержка кэша запросов</A></H3>

<P>
С помощью команды <code>FLUSH QUERY CACHE</code> можно дефрагментировать кэш запросов
с целью лучшего использования его памяти. Эта команда не удалит ни одного
запроса из кэша. Команда <code>FLUSH TABLES</code> также записывает на диск содержимое
кэша запросов.

</P>
<P>
Команда <code>RESET QUERY CACHE</code> удаляет все результаты запросов из кэша
запросов.

</P>
<P>
Можно контролировать функционирование кэша запросов в <code>SHOW STATUS</code>:

</P>
<TABLE BORDER>
<TR><TD><strong>Переменная</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD>Qcache_queries_in_cache </TD><TD> Количество запросов, зарегистрированных в кэше.
</TD></TR>
<TR><TD>Qcache_inserts </TD><TD> Количество запросов, добавленных в кэш.
</TD></TR>
<TR><TD>Qcache_hits </TD><TD> Количество результативных обращений в кэш.
</TD></TR>
<TR><TD>Qcache_lowmem_prunes </TD><TD> Количество запросов, удаленных из кеша по причине недостаточного количества памяти.
</TD></TR>
<TR><TD>Qcache_not_cached </TD><TD> Количество не кэшированных запросов (не подлежащих кэшированию или из-за установок QUERY_CACHE_TYPE).
</TD></TR>
<TR><TD>Qcache_free_memory </TD><TD> Величина свободной памяти для кэша запросов.
</TD></TR>
<TR><TD>Qcache_total_blocks </TD><TD> Общее количество блоков в кэше запросов.
</TD></TR>
<TR><TD>Qcache_free_blocks </TD><TD> Количество свободных блоков памяти в кэше запросов.
</TD></TR>
</TABLE>

<P>
Общее количество запросов = <code>Qcache_inserts + Qcache_hits +
Qcache_not_cached</code>.

</P>
<P>
Кэш запросов использует блоки переменной длины, так что параметры
<code>Qcache_total_blocks</code> и <code>Qcache_free_blocks</code> могут показывать фрагментацию
памяти кэша запросов. После команды <code>FLUSH QUERY CACHE</code> остается только
один (большой) свободный блок.

</P>
<P>
Примечание: каждый запрос нуждается как минимум в двух блоках (один для
текста данного запроса и один или больше - для результатов запроса). Для
каждой используемой в запросе таблицы также требуется один блок, но если
два или более запросов используют одну и ту же таблицу, требуется
выделение только одного блока.

</P>
<P>
Вы можете использовать переменную <code>Qcache_lowmem_prunes</code> для настройки
размера кеша запросов. В ней подсчитывается количество запросов, которые были
удалены из кеша для освобождения памяти под новые результаты запросов. Кеш
запросов использует стратегию <code>используется реже всего</code> (<code>least
recently used, LRU</code>) для принятия решений о о том, какие запросы удалить из
кеша. 

</P>



<H1><A NAME="Table_types" HREF="manual.ru_toc.html#Table_types">7  Типы  таблиц MySQL</A></H1>

<P>
<A NAME="IDX1466"></A>
<A NAME="IDX1467"></A>
<A NAME="IDX1468"></A>
<A NAME="IDX1469"></A>
<A NAME="IDX1470"></A>
<A NAME="IDX1471"></A>
<A NAME="IDX1472"></A>
<A NAME="IDX1473"></A>
<A NAME="IDX1474"></A>
<A NAME="IDX1475"></A>
<A NAME="IDX1476"></A>

</P>

<P>
В MySQL версии 3.23.6 можно было выбирать из трех основных форматов таблиц
(<code>ISAM</code>, <code>HEAP</code> и <code>MyISAM</code>). Более новые версии MySQL могут поддерживать
дополнительные типы таблиц (<code>InnoDB</code> или <code>BDB</code>) - в зависимости от варианта
установки.

</P>
<P>
При создании новой таблицы можно указать MySQL, какой тип таблицы для нее
использовать. 

</P>
<P>
Для таблицы и определений столбцов MySQL всегда создает файл
<tt>`.frm'</tt>. Индекс и данные хранятся в других файлах, в зависимости от типа
таблиц. 

</P>
<P>
Обратите внимание: если необходимо использовать таблицы <code>InnoDB</code>, при
запуске следует указать параметр <code>innodb_data_file_path</code>. See section <A HREF="manual.ru.html#InnoDB_start">7.5.2  Параметры запуска InnoDB</A>.

</P>
<P>
Если попытаться воспользоваться таблицей, которая не была активизирована или
добавлена при компиляции, MySQL вместо нее создаст таблицу типа <code>MyISAM</code>.
Это очень полезная функция, когда необходимо произвести копирование таблиц с
одного SQL-сервера на другой, а серверы поддерживают различные типы таблиц
(например, при копировании таблиц на подчиненный компьютер, который
оптимизирован для быстрой работы без использования транзакционных таблиц).  

</P>
<P>
Тем
не менее, такое автоматическое изменение таблиц может сбить с толку новых
пользователей MySQL. Мы планируем устранить эту проблему путем введения
предупреждений в новом клиент-серверном протоколе в MySQL 4.1, которые будут
выводиться при автоматическом изменении типов таблиц.

</P>
<P>
Преобразовывать таблицы из одного типа в другой можно при помощи оператора
<code>ALTER TABLE</code>. See section <A HREF="manual.ru.html#ALTER_TABLE">6.5.4  Синтаксис оператора <code>ALTER TABLE</code></A>.

</P>
<P>
Обратите внимание на то, что MySQL поддерживает два различных типа таблиц:
транзакционные (<code>InnoDB</code> и <code>BDB</code>) и без поддержки транзакций (<code>HEAP</code>, <code>ISAM</code>,
<code>MERGE</code> и <code>MyISAM</code>).

</P>
<P>
Преимущества транзакционных таблиц (Transaction-safe tables, TST):

</P>

<UL>
<LI>

Надежность. Даже если произойдет сбой в работе MySQL или возникнут
проблемы с оборудованием, свои данные вы сможете восстановить - либо
методом автоматического восстановления, либо при помощи резервной
копии и журнала транзакций.
<LI>

Можно сочетать несколько операторов и принимать все эти операторы
одной командой <code>COMMIT</code>.
<LI>

Можно запустить команду <code>ROLLBACK</code>, чтобы отменить внесенные изменения
(если работа не производится в режиме автоматической фиксации).
<LI>

Если произойдет сбой во время обновления, все изменения будут
восстановлены (в нетранзакционных таблицах все внесенные изменения не
могут быть отменены).
<LI>

Лучше обеспечивает параллелизм при одновременных обновлениях таблицы и чтении.
</UL>

<P>
Обратите внимание, что для использования таблиц InnoDB вам как минимум 
следует указать опцию <code>innodb_data_file_path</code>. See section <A HREF="manual.ru.html#InnoDB_start">7.5.2  Параметры запуска InnoDB</A>.

</P>
<P>
Преимущества нетранзакционных таблиц (non-transaction-safe
tables, NTST):

</P>

<UL>
<LI>

Работать с ними намного быстрее, так как не выполняются дополнительные
транзакции.
<LI>

Для них требуется меньше дискового пространства, так как не
применяются дополнительные транзакции.
<LI>

Для обновлений используется меньше памяти.
</UL>

<P>
В операторах можно сочетать таблицы TST и NTST, чтобы взять лучшее от
каждого типа.

</P>



<H2><A NAME="MyISAM" HREF="manual.ru_toc.html#MyISAM">7.1  Таблицы <code>MyISAM</code></A></H2>

<P>
Тип таблиц <code>MyISAM</code> принят по умолчанию в MySQL версии 3.23. Он основывается
на коде <code>ISAM</code> и обладает в сравнении с ним большим количеством полезных
дополнений.

</P>
<P>
Индекс хранится в файле с расширением <tt>`.MYI'</tt> (MYIndex), а данные - в файле
с расширением <tt>`.MYD'</tt> (MYData). Таблицы <code>MyISAM</code> можно
проверять/восстанавливать при помощи утилиты <code>myisamchk</code>. See section <A HREF="manual.ru.html#Crash_recovery">4.4.6.7  Использование myisamchk для послеаварийного восстановления</A>. Таблицы <code>MyISAM</code> можно сжимать при помощи
команды <code>myisampack</code>, после чего они будут занимать намного меньше места.
See section <A HREF="manual.ru.html#myisampack">4.7.4  <code>myisampack</code>, MySQL-генератор сжатых таблиц (только для чтения)</A>.

</P>
<P>
Новшества, которыми обладает тип <code>MyISAM</code>:

</P>

<UL>
<LI>

Флаг в файле <code>MyISAM</code>, указывающий, правильно была закрыта таблица или
нет. В случае запуска <code>mysqld</code> с параметром <code>--myisam-recover</code> таблицы
<code>MyISAM</code> будут автоматически проверяться и/или восстанавливаться при
открытии, если таблица была закрыта неправильно.
<LI>

При помощи команды <code>INSERT</code> можно вставлять новые строки в таблицу, в
середине файла данных которой нет свободных блоков, в то время как
другие потоки считывают из таблицы информацию (совмещенная вставка).
Свободный блок может быть получен при обновлении строки с динамической
длиной, когда большее количество данных заменяется меньшим количеством
или при удалении строк. Когда свободных блоков не остается, все
последующие блоки снова будут вставляться как совмещенные.
<LI>

Поддержка больших файлов (63 бита) в файловых/операционных системах,
которые поддерживают большие файлы.
<LI>

Хранение всех данных осуществляется с первым младшим байтом. Это
делает данные независимыми от операционной системы. Единственное
требование - в компьютере должны применяться дополненные до двух
байтов целые числа со знаком (как и во всех компьютерах в последние 20
лет) и формат с плавающей единичной запятой IEEE (также использующийся
в подавляющем большинстве серийных компьютеров). Единственными
компьютерами, которые могут не поддерживать бинарную совместимость,
являются встроенные системы (поскольку в них иногда применяются
специальные процессоры). При хранении данных с первым младшим байтом 
не происходит снижения скорости. Обычно байты в строке таблицы не
выровнены и нет большой разницы в том, как прочитать невыровненный
байт - в прямой последовательности или в обратной. Фактическое время
извлечения значения столбца также не критично по сравнению со временем
выполнения остального  кода.
<LI>

Все ключи номеров хранятся с первым старшим байтом, чтобы сжатие
индексов было более эффективным.
<LI>

Внутренняя обработка столбца <code>AUTO_INCREMENT</code>. <code>MyISAM</code> автоматически
обновляет его при выполнении команд <code>INSERT</code>/<code>UPDATE</code>. Значение
<code>AUTO_INCREMENT</code> может быть обнулено оператором <code>myisamchk</code>. После этого
столбец <code>AUTO_INCREMENT</code> будет быстрее (по крайней мере на 10%) и старые
номера не будут повторно использоваться, как со старым <code>ISAM</code>. Обратите
внимание: когда <code>AUTO_INCREMENT</code> задан в конце составного ключа, старое
поведение все еще сохраняется.
<LI>

При вставке в отсортированном порядке (как при использовании столбца
<code>AUTO_INCREMENT</code>) дерево ключей будет разделено таким образом, чтобы
верхний узел содержал только один ключ. При этом сокращается расход
пространства памяти в дереве ключей.
<LI>

Столбцы <code>BLOB</code> и <code>TEXT</code> могут быть проиндексированы.
<LI>

В индексных столбцах разрешены значения <code>NULL</code>. Они занимают 0-1 байта
на ключ.
<LI>

По умолчанию максимальная длина ключа составляет 500 байтов (это
значение может быть изменено при повторной компиляции). В случаях,
когда ключи больше 250 байтов, для них используются большие размеры
блока ключа, чем предусмотренные по умолчанию 1024 байта.
<LI>

По умолчанию в таблице может быть не более 32 ключей. Это значение
можно увеличить до 64 без повторной компиляции <code>myisamchk</code>.
<LI>

<code>myisamchk</code> будет отмечать таблицы как проверенные, если они запускаются
с параметром <code>--update-state</code>. <code>myisamchk --fast</code> будет проверять только
те таблицы, в которых отсутствует данная пометка.
<LI>

<code>myisamchk -a</code> сохраняет статистические данные по частям ключа (не
только для ключей целиком, как в <code>ISAM</code>).
<LI>

Строки с динамическим размером будут менее фрагментированными, чем при
смешивании удалений с обновлениями и вставками. Это осуществляется
путем автоматического сочетания удаленных смежных блоков и расширением
блоков, если следующий блок удален.
<LI>

<code>myisampack</code> может упаковывать столбцы <code>BLOB</code> и <code>VARCHAR</code>.
<LI>

Можно поместить файл данных и файл индексов в разные каталоги, чтобы
увеличить скорость (с параметром <code>DATA/INDEX DIRECTORY="path"</code> для
<code>CREATE TABLE</code>). See section <A HREF="manual.ru.html#CREATE_TABLE">6.5.3  Синтаксис оператора <code>CREATE TABLE</code></A>.
</UL>

<P>
<code>MyISAM</code> также поддерживает следующие функции, которые можно будет
использовать в MySQL в ближайшем будущем:

</P>

<UL>
<LI>

Поддержка типа <code>VARCHAR</code>; столбец <code>VARCHAR</code> начинается с длины, которая
хранится в 2 байтах.
<LI>

Таблицы с <code>VARCHAR</code> могут иметь фиксированную или динамическую длину
записей.
<LI>

<code>VARCHAR</code> и <code>CHAR</code> могут быть до 64 Кб длиной. У всех ключевых сегментов
есть свои собственные определения языка. Это позволяет задавать в
MySQL различные определения языка для каждого столбца.
<LI>

Для <code>UNIQUE</code> может использоваться вычисленный хэш-индекс. Это позволяет
использовать <code>UNIQUE</code> с любым сочетанием столбцов в таблице (тем не
менее, нельзя производить поиск по вычисленному <code>UNIQUE</code> индексу).
</UL>

<P>
Обратите внимание, что индексные файлы при использовании <code>MyISAM</code> обычно
намного меньше в сравнении с <code>ISAM</code>. Это означает, что для <code>MyISAM</code> обычно
задействуется меньше системных ресурсов, чем для <code>ISAM</code>, но больше
загружается процессор при вставке данных в сжатый индекс.

</P>
<P>
Приведенные ниже параметры <code>mysqld</code> могут использоваться для изменения
поведения таблиц <code>MyISAM</code>. See section <A HREF="manual.ru.html#SHOW_VARIABLES">4.5.6.4  <code>SHOW VARIABLES</code></A>. 

</P>
<TABLE BORDER>
<TR><TD><strong>Параметр</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD><code>--myisam-recover=#</code> </TD><TD> Автоматическое восстановление таблиц после сбоя.
</TD></TR>
<TR><TD><code>-O myisam_sort_buffer_size=#</code> </TD><TD> При восстановлении таблиц используется буфер.
</TD></TR>
<TR><TD><code>--delay-key-write=ALL</code> </TD><TD> Не сбрасывать на диск ключевые буферы между записями для любых таблиц <code>MyISAM</code>
</TD></TR>
<TR><TD><code>-O myisam_max_extra_sort_file_size=#</code> </TD><TD> Используется, чтобы помочь MySQL выбрать, когда использовать медленный, но надежный метод создания индекса кэша ключей. <strong>Обратите внимание</strong> на то, что этот параметр задается в мегабайтах!
</TD></TR>
<TR><TD><code>-O myisam_max_sort_file_size=#</code> </TD><TD> Не использовать метод быстрой сортировки индекса для созданных индексов, если временный файл превысит этот размер. <strong>Обратите внимание</strong> на то, что этот параметр задается в мегабайтах!
</TD></TR>
<TR><TD><code>-O bulk_insert_buffer_size=#</code> Размер кэша дерева, используемого при оптимизации групповых вставок. <strong>Обратите внимание</strong>: это ограничение на поток!
</TD></TR>
</TABLE>

<P>
Автоматическое восстановление активизируется при запуске <code>mysqld</code> с
параметром <code>--myisam-recover=#</code> (see section <A HREF="manual.ru.html#Command-line_options">4.1.1  Параметры командной строки <code>mysqld</code></A>).
Когда таблица открывается, производится проверка, не помечена ли она как
сбойная, не равна ли переменная счетчика открытий таблицы нулю (0) и не
производится ли запуск с параметром <code>--skip-external-locking</code>. Если хотя бы одно из
этих условий выполняется, произойдет следующее:

</P>

<UL>
<LI>

Будет произведена проверка таблицы на наличие ошибок;
<LI>

Если обнаружится ошибка, будет произведена попытка быстрого
восстановления (с сортировкой и без повторного создания файла данных)
таблицы;
<LI>

Если восстановление не удалось из-за ошибки в файле данных (например,
ошибка дублирующегося ключа), будет произведена вторая попытка, но на
этот раз с повторным созданием файла данных.
<LI>

Если восстановление не удастся, будет произведена еще одна попытка с
применением старого метода восстановления (запись по строкам без
сортировки), который обеспечивает устранение ошибок любого типа с
использованием незначительных ресурсов диска.
</UL>

<P>
Если не удается восстановить все строки из предыдущего выполненного
оператора, и не был указан параметр <code>FORCE</code> для <code>myisam-recover</code>,
автоматическое восстановление будет отменено со следующей ошибкой в файле
ошибок:

</P>

<PRE>
Error: Couldn't repair table: test.g00pages
</PRE>

<P>
Если в этом случае был указан параметр <code>FORCE</code>, вместо вышеуказанного
сообщения в файле ошибок будет присутствовать следующее предупреждение:

</P>

<PRE>
Warning: Found 344 of 354 rows when repairing ./test/g00pages
</PRE>

<P>
Обратите внимание: если запустить автоматическое восстановление с
параметром <code>BACKUP</code>, необходимо установить скрипт <code>cron</code>, который
автоматически перемещает файлы с именами <tt>`tablename-datetime.BAK'</tt> из
каталогов базы данных на носитель резервного копирования.

</P>
<P>
See section <A HREF="manual.ru.html#Command-line_options">4.1.1  Параметры командной строки <code>mysqld</code></A>.

</P>



<H3><A NAME="Key_space" HREF="manual.ru_toc.html#Key_space">7.1.1  Пространство, необходимое  для  ключей</A></H3>

<P>
<A NAME="IDX1477"></A>

</P>
<P>
В MySQL могут поддерживаться различные типы индексов, однако обычно это
тип <code>ISAM</code> или <code>MyISAM</code>. Для обоих типов используется индекс B-дерева, так что
приблизительно вычислить размер индексного файла можно по формуле (<code>длина
ключа+4)/0.67</code>, просуммированной по всем ключам (приведено значение для
самого худшего случая, когда все ключи вставлены в порядке сортировки и
сжатые ключи отсутствуют).

</P>
<P>
В индексах строк сжаты пробелы. Если первая часть индекса является
строкой, префикс также будет сжат. Сжатие пробелов позволяет уменьшить
индексный файл в сравнении со значениями, вычисляемыми по приведенной выше
формуле, если столбец строки содержит много пробелов в конце строки или
является столбцом  <code>VARCHAR</code>, который не всегда используется на полную
длину. Сжатие префикса используется с ключами, которые начинаются со
строки. Сжатие префикса полезно в случае, если имеется много строк с
одинаковыми префиксами.

</P>
<P>
В таблицах <code>MyISAM</code> можно также сжимать числа в префиксах, указывая при
создании таблицы <code>PACK_KEYS=1</code>. Это полезно в случае, когда имеется много
целочисленных ключей с одинаковыми префиксами, а числа хранятся с первым
старшим байтом.

</P>


<H3><A NAME="MyISAM_table_formats" HREF="manual.ru_toc.html#MyISAM_table_formats">7.1.2  Форматы таблиц <code>MyISAM</code></A></H3>

<P>
В <code>MyISAM</code> поддерживается три различных типа таблиц. Два из них выбираются
автоматически, в зависимости от типа используемых столбцов. Третий -
сжатые таблицы - может быть создан только при помощи инструмента
<code>myisampack</code>.

</P>
<P>
При использовании с таблицами команд <code>CREATE</code> или <code>ALTER</code> для таблиц, у
которых нет форсированной настройки <code>BLOB</code>, можно задать формат <code>DYNAMIC</code> или
<code>FIXED</code> с параметром таблицы <code>ROW_FORMAT=#</code>. В будущем можно будет
сжимать/разжимать таблицы, указывая <code>ROW_FORMAT=compressed | default</code> для
<code>ALTER TABLE</code>. See section <A HREF="manual.ru.html#CREATE_TABLE">6.5.3  Синтаксис оператора <code>CREATE TABLE</code></A>.

</P>



<H4><A NAME="Static_format" HREF="manual.ru_toc.html#Static_format">7.1.2.1  Характеристики статических таблиц (с фиксированной длиной)</A></H4>

<P>
Это формат, принятый по умолчанию. Он используется, когда таблица не
содержит столбцов <code>VARCHAR</code>, <code>BLOB</code> или <code>TEXT</code>.

</P>
<P>
Данный формат - самый простой и безопасный, а также наиболее быстрый при
работе с дисками. Скорость достигается за счет простоты поиска информации
на диске: в таблицах статического формата с индексом для этого достаточно
всего лишь умножить номер строки на ее длину.

</P>
<P>
Кроме того, при сканировании таблицы очень просто считывать постоянное
количество записей при каждом чтении с диска.

</P>
<P>
Если произойдет сбой во время записи в файл <code>MyISAM</code> фиксированного размера,
<code>myisamchk</code> в любом случае сможет легко определить, где начинается и
заканчивается любая строка. Поэтому обычно удается восстановить все
записи, кроме тех, которые были частично перезаписаны. Отметим, что в
MySQL все индексы могут быть восстановлены. Свойства статических таблиц
следующие:

</P>

<UL>
<LI>

Все столбцы <code>CHAR</code>, <code>NUMERIC</code> и <code>DECIMAL</code> расширены пробелами до ширины
столбца;
<LI>

Очень быстрые;
<LI>

Легко кэшируются;
<LI>

Легко восстанавливаются после сбоя, так как записи расположены в
фиксированных позициях;
<LI>

Не нуждаются в реорганизации (при помощи <code>myisamchk</code>), кроме случаев,
когда удаляется большое количество записей и необходимо вернуть
дисковое пространство операционной системе.
<LI>

Для них обычно используется больше дискового пространства, чем для
динамических таблиц.
</UL>



<H4><A NAME="Dynamic_format" HREF="manual.ru_toc.html#Dynamic_format">7.1.2.2  Характеристики динамических таблиц</A></H4>

<P>
<A NAME="IDX1478"></A>
<A NAME="IDX1479"></A>

</P>
<P>
Данный формат используется для таблиц, которые содержат столбцы <code>VARCHAR</code>,
<code>BLOB</code> или <code>TEXT</code>, а также если таблица была создана с параметром
<code>ROW_FORMAT=dynamic</code>.

</P>
<P>
Это несколько более сложный формат, так как у каждой строки есть
заголовок, в котором указана ее длина. Одна запись может заканчиваться
более чем в одном месте, если она была увеличена во время обновления.

</P>
<P>
<A NAME="IDX1480"></A>
Чтобы произвести дефрагментацию таблицы, можно воспользоваться командами
<code>OPTIMIZE table</code> или <code>myisamchk</code>. Если у вас есть статические данные, которые
часто считываются/изменяются в некоторых столбцах <code>VARCHAR</code> или <code>BLOB</code> одной и
той же таблицы, во избежание фрагментации эти динамические столбцы лучше
переместить в другие таблицы. Свойства динамических таблиц следующие:

</P>

<UL>
<LI>

Все столбцы со строками являются динамическими (кроме тех, у которых
длина меньше 4).
<LI>

Перед каждой записью помещается битовый массив, показывающий, какие
столбцы пусты (<code>''</code>) для строковых столбцов, или ноль для числовых
столбцов (это не то же самое, что столбцы, содержащие значение <code>NULL</code>).
Если длина строкового столбца равна нулю после удаления пробелов в
конце строки, или у числового столбца значение ноль, он отмечается в
битовом массиве и не сохраняется на диск. Строки, содержащие значения,
сохраняются в виде байта длины и строки содержимого.
<LI>

Обычно такие таблицы занимают намного меньше дискового пространства,
чем таблицы с фиксированной длиной.
<LI>

Для всех записей используется ровно столько места, сколько необходимо.
Если размер записи увеличивается, она разделяется на несколько частей
- по мере необходимости. Это приводит к фрагментации записей.
<LI>

Если в строку добавляется информация, превышающая длину строки, строка
будет фрагментирована. В этом случае для увеличения производительности
можно время от времени запускать команду <code>myisamchk -r</code>. Чтобы получить
статистические данные, воспользуйтесь командой <code>myisamchk -ei tbl_name</code>.
<LI>

Восстановление после сбоя для таких таблиц является более сложным
процессом, так как запись может быть фрагментированной и состоять из
нескольких частей, а ссылка (или фрагмент) могут отсутствовать.
<LI>

Предполагаемая длина строки для динамических записей вычисляется
следующим образом:


<PRE>
3
+ (число столбцов+ 7) / 8
+ (число столбцов char)
+ размер числовых столбцов в упакованном виде
+ длина строк
+ (число столбцов NULL + 7) / 8
</PRE>

На каждую ссылку добавляется по 6 байтов. Динамические записи связываются
при каждом увеличении записи во время обновления. Каждая новая ссылка
занимает по крайней мере 20 байтов, поэтому следующее увеличение может
произойти либо по этой же ссылке; либо по другой, если не хватит места.
Количество ссылок можно проверить при помощи команды <code>myisamchk -ed</code>. Все
ссылки можно удалить при помощи команды <code>myisamchk -r</code>.
</UL>



<H4><A NAME="Compressed_format" HREF="manual.ru_toc.html#Compressed_format">7.1.2.3  Характеристики сжатых таблиц</A></H4>

<P>
<A NAME="IDX1481"></A>
<A NAME="IDX1482"></A>
<A NAME="IDX1483"></A>
<A NAME="IDX1484"></A>

</P>
<P>
Таблицы этого тип предназначены только для чтения. Они генерируются при
помощи дополнительного инструмента <code>myisampack</code> (<code>pack_isam</code> для таблиц <code>ISAM</code>):

</P>

<UL>
<LI>

Все дистрибутивы MySQL, даже выпущенные до предоставления
общедоступной лицензии MySQL, могут читать таблицы, которые были сжаты
при помощи <code>myisampack</code>.
<LI>

Сжатые таблицы занимают очень мало дискового пространства; таким
образом при применении данного типа значительно снижается
использование дискового пространства. Это полезно при работе с
медленными дисками (такими как компакт-диски).
<LI>

Каждая запись сжимается отдельно (незначительные издержки при
доступе). Заголовки у записей фиксированные (1-3 байта), в зависимости
от самой большой записи в таблице. Все столбцы сжимаются по-разному.
Ниже приведено описание некоторых типов сжатия:

<UL>
<LI>

Обычно для каждого столбца используются разные таблицы Хаффмана.
<LI>

Сжимаются пробелы суффикса.
<LI>

Сжимаются пробелы префикса.
<LI>

Для хранения чисел со значением 0 отводится 1 бит.
<LI>

Если у значений в целочисленном столбце небольшой диапазон,
столбец сохраняется с использованием минимального по размерам
возможного типа. Например, столбец <code>BIGINT</code> (8 байт) может быть
сохранен как столбец <code>TINYINT</code> (1 байт) если все значения находятся
в диапазоне от <code>0</code> до <code>255</code>.
<LI>

Если в столбце содержится небольшое множество возможных значений,
тип столбца преобразовывается в <code>ENUM</code>.
<LI>

Столбец может содержать сочетание указанных выше сжатий.
</UL>

<LI>

Для таблиц этого типа возможна обработка записей с фиксированной или
динамической длиной.
<LI>

Таблицы данного типа могут быть распакованы при помощи команды myisamchk.
</UL>



<H3><A NAME="MyISAM_table_problems" HREF="manual.ru_toc.html#MyISAM_table_problems">7.1.3  Проблемы с таблицами <code>MyISAM</code>.</A></H3>

<P>
Формат  файлов, который  используется  для  хранения  данных  в MySQL,
тщательно  тестировался, но  всегда  существуют  обстоятельства, которые 
могут  привести  к  повреждениям  таблиц  баз  данных.

</P>



<H4><A NAME="Corrupted_MyISAM_tables" HREF="manual.ru_toc.html#Corrupted_MyISAM_tables">7.1.3.1  Повреждения таблиц <code>MyISAM</code></A></H4>

<P>
Несмотря на то, что формат таблиц <code>MyISAM</code> очень надежен (все изменения в
таблице записываются до возвращения значения оператора SQL), таблица, тем
не менее, может быть повреждена. Такое происходит в следующих случаях:

</P>

<UL>
<LI>

Процесс <code>mysqld</code> уничтожен во время осуществления записи;
<LI>

Неожиданное отключение компьютера (например, если выключилось
электропитание);
<LI>

Ошибка аппаратного обеспечения;
<LI>

Использование внешней программы (например <code>myisamchk</code>) на открытой
таблице.
<LI>

Ошибка программного обеспечения в коде MySQL или <code>MyISAM</code>.
</UL>

<P>
Типичные признаки поврежденной таблицы следующие:

</P>

<UL>
<LI>

Во время выбора данных из таблицы выдается ошибка <code>Incorrect key file
for table: '...'. Try to repair it</code>.
<LI>

Запросы не находят в таблице строки или выдают неполные данные.
</UL>

<P>
Проверить состояние таблицы можно при помощи команды <code>CHECK TABLE</code>. См.
раздел See section <A HREF="manual.ru.html#CHECK_TABLE">4.4.4  Синтаксис <code>CHECK TABLE</code></A>.

</P>
<P>
Для восстановления поврежденного файла можно применить команду <code>REPAIR
TABLE</code>. See section <A HREF="manual.ru.html#REPAIR_TABLE">4.4.5  Синтаксис <code>REPAIR TABLE</code></A>. Таблицу можно восстановить и в
случае, когда не запущен <code>mysqld</code>, при помощи  команды <code>myisamchk</code>. See section <A HREF="manual.ru.html#myisamchk_syntax">4.4.6.1  Синтаксис запуска <code>myisamchk</code></A>.

</P>
<P>
Если таблицы повреждены значительно, необходимо выяснить причину
произошедшего! See section <A HREF="manual.ru.html#Crashing">A.4.1  Что делать, если работа MySQL сопровождается постоянными сбоями</A>. 

</P>
<P>
Сначала  следует  определить, послужил  ли 
причиной повреждения таблицы сбой <code>mysqld</code> (это  можно  легко 
проверить, просмотрев последние строки <code>restarted mysqld</code> в файле 
ошибок <code>mysqld</code>). Если дело не в этом, то необходимо составить 
подробное  описание  произошедшего. See section <A HREF="manual.ru.html#Reproduceable_test_case">D.1.6  Создание контрольного примера при повреждении таблиц</A>.

</P>


<H4><A NAME="MyISAM_table_close" HREF="manual.ru_toc.html#MyISAM_table_close">7.1.3.2  Clients is using or hasn't closed the table properly</A></H4>

<P>
Клиенты неправильно используют таблицу или не закрыли ее надлежащим
образом

</P>
<P>
В заголовке каждого файла MyISAM  <tt>`.MYI'</tt> имеется счетчик, который может
использоваться для проверки правильности закрытия таблицы.

</P>
<P>
Если при выполнении команд <code>CHECK TABLE</code> или <code>myisamchk</code> выдается следующая
ошибка:

</P>

<PRE>
# clients is using or hasn't closed the table properly
</PRE>

<P>
значит, нарушена синхронность счетчика. Это не означает, что таблица
повреждена, но необходимо произвести проверку и убедиться, что все в
порядке.

</P>
<P>
Счетчик работает следующим образом:

</P>

<UL>
<LI>

Во время первого обновления таблицы в MySQL значение счетчика в
заголовках индексных файлов увеличивается.
<LI>

Во время следующих обновлений значение счетчика не изменяется.
<LI>

После закрытия последней записи таблицы (после применения команды
<code>FLUSH</code> или из-за отсутствия места в кэше таблицы) значение счетчика
уменьшается, если в таблицу были внесены изменения.
<LI>

Если производится проверка таблицы, или проверка показывает, что все в
порядке, счетчик устанавливается в значение 0.
<LI>

Чтобы избежать пересечения с другими процессами, которые могут
проверять таблицу, при закрытии значение счетчика не уменьшается, если
счетчик установлен в значение 0.
</UL>

<P>
Иначе говоря, синхронность может быть нарушена следующим образом:

</P>

<UL>
<LI>

Таблицы <code>MyISAM</code> копируются без команд <code>LOCK</code> и <code>FLUSH TABLES</code>.
<LI>

Между обновлением и последним закрытием произошел сбой MySQL (обратите
внимание: с таблицей все может быть в порядке, так как MySQL
документирует все изменения между выполнением каждого из операторов).
<LI>

Кто-то применил команду <code>myisamchk --recover</code> или <code>myisamchk
--update-state</code> к таблице, которая в данный момент использовалась
<code>mysqld</code>.
</UL>

<P>
Таблицу используют несколько серверов <code>mysqld</code>, и один из них выполнил
команду <code>REPAIR</code> или <code>CHECK</code> по отношению к таблице, с которой работал другой
сервер. В этом случае можно выполнить команду <code>CHECK</code> (даже если другие
серверы выдают предупреждения), но команды <code>REPAIR</code> следует избегать, так
как она заменяет файл данных новым, информация о котором не передается
другим серверам.

</P>


<H2><A NAME="MERGE" HREF="manual.ru_toc.html#MERGE">7.2  Таблицы <code>MERGE</code></A></H2>

<P>
<A NAME="IDX1485"></A>
<A NAME="IDX1486"></A>

</P>
<P>
Таблицы <code>MERGE</code> (объединение) являются новшеством версии MySQL 3.23.25. В
настоящее время код находится еще на стадии разработки, но, тем не менее,
должен быть достаточно стабилен.

</P>
<P>
Таблица <code>MERGE</code> (или таблица <code>MRG_MyISAM</code>) представляет собой совокупность
идентичных таблиц <code>MyISAM</code>, которые могут использоваться как одна таблица. К
совокупности таблиц можно применять только команды <code>SELECT</code>, <code>DELETE</code> и
<code>UPDATE</code>. Если же попытаться применить к таблице <code>MERGE</code> команду <code>DROP</code>, она
подействует только на определение <code>MERGE</code>.

</P>
<P>
Обратите внимание на то, что команда <code>DELETE FROM merge_table</code> без параметра
<code>WHERE</code> очищает только распределение для таблицы, но ничего не удаляет из
распределенных таблиц (мы планируем исправить это в версии 4.1).

</P>
<P>
Под идентичными таблицами подразумеваются таблицы, созданные с одинаковой
структурой и ключами. Нельзя объединять таблицы, в которых столбцы сжаты
разными методами или не совпадают, либо ключи расположены в другом
порядке. Тем не менее, некоторые таблицы можно сжимать при помощи команды
<code>myisampack</code>. See section <A HREF="manual.ru.html#myisampack">4.7.4  <code>myisampack</code>, MySQL-генератор сжатых таблиц (только для чтения)</A>.

</P>
<P>
При создании таблицы <code>MERGE</code> будут образованы файлы определений таблиц <tt>`.frm'</tt> 
и списка таблиц <tt>`.MRG'</tt>. Файл <tt>`.MRG'</tt> содержит список индексных файлов (файлы
<tt>`.MYI'</tt>), работа с которыми должна осуществляться как с единым файлом. Все
используемые таблицы должны размещаться в той же базе данных, что и
таблица <code>MERGE</code>.

</P>
<P>
На данный момент по отношению к таблицам, которые необходимо преобразовать
в таблицу <code>MERGE</code>,необходимо обладать привилегиями <code>SELECT</code>, <code>UPDATE</code> и <code>DELETE</code>.

</P>
<P>
Ниже перечислены возможности, которые обеспечивают таблицы <code>MERGE</code>:

</P>

<UL>
<LI>

Простое управление набором файлов журналов. Например, можно поместить
данные за различные месяцы в отдельные файлы, сжать некоторые из них
при помощи <code>myisampack</code>, а затем создать таблицу <code>MERGE</code>, чтобы
использовать их как одну таблицу.
<LI>

Увеличение скорости работы. Большую таблицу можно разделить по
некоторому критерию, а затем поместить различные части таблицы на
разные диски. В этом случае таблица <code>MERGE</code> может обрабатываться намного
быстрее, чем обычная большая таблица (можно, конечно, воспользоваться
дисковым массивом <code>RAID</code>, чтобы получить те же преимущества).
<LI>

Более эффективный поиск. Если точно известно, что вы ищете, можно
производить поиск по определенным запросам только в одной из
составляющих таблицу <code>MERGE</code> таблиц, одновременно используя таблицу
<code>MERGE</code> для других запросов. Можно даже иметь несколько активных таблиц
<code>MERGE</code> (возможно, с перекрывающимися файлами).
<LI>

Более простое восстановление. Гораздо легче восстановить отдельные
файлы, которые преобразованы в файл <code>MERGE</code>, чем пытаться восстановить
действительно большой файл.
<LI>

Быстрая обработка большого количества файлов как одного. Для таблицы
<code>MERGE</code> используются индексы отдельных таблиц; поддерживать для нее один
большой индекс нет необходимости. Благодаря этому создание или
изменение таблиц <code>MERGE</code> осуществляется ОЧЕНЬ быстро. Обратите внимание
на то, что при создании таблицы <code>MERGE</code> необходимо указывать определения
ключей!
<LI>

Если требуется объединить несколько таблиц в одну большую таблицу по
требованию или при формировании, лучше создать для них по требованию
таблицу <code>MERGE</code>. Это намного быстрее и позволит сэкономить дисковое
пространство.
<LI>

Таблицы <code>MERGE</code> позволяют обходить ограничения  на размер файлов в
операционных системах.
<LI>

Можно создать псевдоним/синоним для таблицы - для этого нужно просто
применить <code>MERGE</code> к одной таблице. Заметного падения производительности
при этом наблюдаться не будет (только пара непрямых вызовов и вызовы
<code>memcpy()</code> при каждом чтении).
</UL>

<P>
Недостатки таблиц <code>MERGE</code>:

</P>

<UL>
<LI>

Для создания таблицы <code>MERGE</code> можно использовать только идентичные
таблицы <code>MyISAM</code>.
<LI>

Не работает команда <code>REPLACE</code>.
<LI>

Для таблиц <code>MERGE</code> используется больше дескрипторов файлов. Если
применяется таблица <code>MERGE</code>, преобразованная из более чем 10 таблиц, к
которым получают доступ 10 пользователей, то используется 10*10 + 10
дескрипторов файлов (10 файлов данных для 10 пользователей и 10 общих
индексных файлов).
<LI>

Ключи считываются медленнее. При чтении ключа обработчику <code>MERGE</code>
необходимо прочитать все базовые таблицы, чтобы выяснить, какая из них
больше всего соответствует указанному ключу. Если после этого
выполнить команду ``читать следующий'', то обработчик объединенной
таблицы должен будет просмотреть буферы чтения, чтобы найти следующий
ключ. Только по завершении использования одного буфера ключей
обработчику понадобится прочитать следующий блок ключей. В связи с
этим ключи <code>MERGE</code> дают большое замедление при поиске <code>eq_ref</code>, однако не
такое значительное при поиске <code>ref</code>. See section <A HREF="manual.ru.html#EXPLAIN">5.2.1  Синтаксис оператора <code>EXPLAIN</code> (получение информации о <code>SELECT</code>)</A>.
<LI>

Нельзя выполнять команды
<code>DROP TABLE</code>,
<code>ALTER TABLE</code>,
<code>DELETE FROM table_name</code> без оператора <code>WHERE</code>
<code>REPAIR TABLE</code>,
<code>TRUNCATE TABLE</code>,
<code>OPTIMIZE TABLE</code>, или
<code>ANALYZE TABLE</code>
по отношению к таблицам, которые
размещены в таблице <code>MERGE</code> и открыты. Если это сделать, в таблице <code>MERGE</code>
останутся ссылки на исходную таблицу, и полученные результаты будут
совершенно непредсказуемыми. Самый легкий путь обойти эти трудности - выполнить
комманду <code>FLUSH TABLES</code>. Это удостоверит, что ни одна таблица
<code>MERGE</code> не будет открытой.  
</UL>

<P>
При создании таблицы <code>MERGE</code> необходимо указать при помощи
<code>UNION(list-of-tables)</code>, какие таблицы требуется использовать как одну. В
случае необходимости, если требуется производить вставку в таблицу <code>MERGE</code> в
первую или в последнюю таблицу в списке <code>UNION</code>, можно задать 
<code>INSERT_METHOD</code>. Если не указать <code>INSERT_METHOD</code> или выбрать <code>NO</code>, то все
команды <code>INSERT</code> для таблицы <code>MERGE</code> будут выдавать ошибку.

</P>
<P>
В приведенном ниже примере показано, как использовать таблицы <code>MERGE</code>:

</P>

<PRE>
CREATE TABLE t1 (a INT AUTO_INCREMENT PRIMARY KEY, message CHAR(20));
CREATE TABLE t2 (a INT AUTO_INCREMENT PRIMARY KEY, message CHAR(20));
INSERT INTO t1 (message) VALUES ("Testing"),("table"),("t1");
INSERT INTO t2 (message) VALUES ("Testing"),("table"),("t2");
CREATE TABLE total (a INT AUTO_INCREMENT PRIMARY KEY, message CHAR(20))
TYPE=MERGE UNION=(t1,t2) INSERT_METHOD=LAST;
</PRE>

<P>
Кроме того, можно управлять файлом <tt>`.MRG'</tt>, находясь за пределами сервера
MySQL:

</P>

<PRE>
shell&#62; cd /mysql-data-directory/current-database
shell&#62; ls -1 t1.MYI t2.MYI &#62; total.MRG
shell&#62; mysqladmin flush-tables
</PRE>

<P>
Теперь можно выполнять следующие действия:

</P>

<PRE>
mysql&#62; SELECT * FROM total;
+---+---------+
| a | message |
+---+---------+
| 1 | Testing |
| 2 | table   |
| 3 | t1      |
| 1 | Testing |
| 2 | table   |
| 3 | t2      |
+---+---------+
</PRE>

<P>
Обратите внимание на то, что столбец <code>a</code>, хотя и объявлен как
<code>PRIMARY KEY</code>, не является уникальным, так как таблица <code>MERGE</code> не может
обеспечивать уникальность для всех таблиц <code>MyISAM</code>.

</P>
<P>
Чтобы повторно преобразовать таблицу <code>MERGE</code>, можно выбрать один из
следующих вариантов:

</P>

<UL>
<LI>

Применить к таблице команду <code>DROP</code> и создать ее повторно
<LI>

Воспользоваться командой <code>ALTER TABLE table_name UNION(...)</code> 
<LI>

Изменить файл <tt>`.MRG'</tt> и выполнить команду <code>FLUSH TABLE</code> над таблицей <code>MERGE</code>
и всеми базовыми таблицами, чтобы обработчик прочитал новый файл
определения.
</UL>



<H3><A NAME="MERGE_table_problems" HREF="manual.ru_toc.html#MERGE_table_problems">7.2.1  Проблемы при работе с таблицами <code>MERGE</code></A></H3>

<P>
При работе с таблицами <code>MERGE</code> могут возникать следующие проблемы:

</P>

<UL>
<LI>

Для таблицы <code>MERGE</code> не могут поддерживаться ограничения <code>UNIQUE</code> по всей
таблице. При выполнении команды <code>INSERT</code> данные помещаются в первую или
последнюю таблицу (в соответствии с <code>INSERT_METHOD=xxx</code>) и для этой
таблицы <code>MyISAM</code> обеспечивается однозначность данных, но ей ничего не
известно об остальных таблицах <code>MyISAM</code>.
<LI>

Команда <code>DELETE FROM merge_table</code> без оператора <code>WHERE</code> очищает только
распределение для таблицы, ничего не удаляя из преобразованных таблиц.
<LI>

Использование команды <code>RENAME TABLE</code> над активной таблицей <code>MERGE</code> может
привести к повреждению таблицы. Эта ошибка будет исправлена в MySQL
4.0.x.
<LI>

При создании таблицы типа <code>MERGE</code> не проверяется совместимость типов
базовых таблиц. Создав таблицу <code>MERGE</code> на основе несовместимых типов, вы
можете столкнуться с непредсказуемыми проблемами.
<LI>

Если для первого добавления индекса <code>UNIQUE</code> в таблицу, преобразованную
в <code>MERGE</code>, используется команда <code>ALTER TABLE</code>, а затем командой <code>ALTER
TABLE</code> в таблицу <code>MERGE</code> добавляется нормальный индекс, порядок ключей
для таблиц будет разным, если в таблице был старый не однозначный
ключ. Это происходит потому, что команда <code>ALTER TABLE</code> помещает ключи
<code>UNIQUE</code> перед нормальными ключами, чтобы как можно раньше обнаружить
дублирующиеся ключи.
<LI>

Оптимизатор диапазона пока не может эффективно использовать таблицу
<code>MERGE</code>, в связи с чем иногда возникают неоптимальные соединения. Это
будет исправлено в MySQL 4.0.x.
</UL>

<P>
Команда <code>DROP TABLE</code> над таблицей, преобразованной в таблицу <code>MERGE</code>, не будет
работать под Windows, так как обработчик <code>MERGE</code> скрывает распределение
таблиц от верхнего уровня MySQL. Поскольку в Windows не разрешается
удалять открытые файлы, сначала необходимо сбросить на диск все таблицы
<code>MERGE</code> (при помощи команды <code>FLUSH TABLES</code>) или удалить таблицу <code>MERGE</code> перед
тем, как удалить таблицу. Эту ошибку мы планируем исправить одновременно с
введением <code>VIEW</code>.

</P>


<H2><A NAME="ISAM" HREF="manual.ru_toc.html#ISAM">7.3  Таблицы <code>ISAM</code></A></H2>

<P>
<A NAME="IDX1487"></A>

</P>
<P>
В MySQL пока еще можно применять  и устаревший тип таблиц <code>ISAM</code>. В
ближайшем времени этот тип будет исключен (возможно, в MySQL 5.0), так как
MyISAM является улучшенной реализацией тех же возможностей. В таблицах <code>ISAM</code>
используется индекс B-tree. Индекс хранится в файле с расширением <tt>`.ISM'</tt>, а
данные - в файле с расширением <tt>`.ISD'</tt>. Таблицы <code>ISAM</code> можно
проверять/восстанавливать при помощи утилиты <code>isamchk</code> (see section <A HREF="manual.ru.html#MyISAM">7.1  Таблицы <code>MyISAM</code></A>).

</P>
<P>
Ниже перечислены свойства таблиц <code>ISAM</code>:

</P>

<UL>
<LI>Ключи со сжатой и фиксированной длиной

<LI>Фиксированная и динамическая длина записи

<LI>16 ключей с 16 частями ключей/ключами

<LI>Максимальная длина ключа 256 (по умолчанию)

<LI>Данные хранятся в машинном формате; благодаря этому обеспечивается

скорость, но возникает зависимость от компьютера/ОС.
</UL>

<P>
Большинство параметров таблиц <code>MyISAM</code> также соответствуют таблицам <code>ISAM</code>.
See section <A HREF="manual.ru.html#MyISAM">7.1  Таблицы <code>MyISAM</code></A>. Ниже перечислены основные отличия таблиц <code>ISAM</code> от <code>MyISAM</code>:

</P>

<UL>
<LI>Таблицы <code>ISAM</code> не являются переносимыми в двоичном виде с одной

ОС/платформы на другую;
<LI>Невозможна работа с таблицами &#62; 4Гб.

<LI>В строках поддерживается только сжатие префикса.

<LI>Ограничения по маленьким ключам.

<LI>Динамические таблицы больше фрагментируются.

<LI>Таблицы сжимаются при помощи <code>pack_isam</code>, а не при помощи <code>myisampack</code>.

</UL>

<P>
Если вы хотите преобразовать таблицу <code>ISAM</code> в таблицу <code>MyISAM</code>, чтобы иметь
возможность работать с такими утилитами, как <code>mysqlcheck</code>, воспользуйтесь
оператором <code>ALTER TABLE</code>:

</P>

<PRE>
mysql&#62; ALTER TABLE tbl_name TYPE = MYISAM;
</PRE>

<P>
Встроенные версии MySQL не поддерживают таблицы <code>ISAM</code>.

</P>


<H2><A NAME="HEAP" HREF="manual.ru_toc.html#HEAP">7.4  Таблицы <code>HEAP</code></A></H2>

<P>
<A NAME="IDX1488"></A>

</P>
<P>
Для <code>HEAP</code>-таблиц используются хэш-индексы; эти таблицы хранятся в памяти.
Благодаря этому обработка их осуществляется очень быстро, однако в случае
сбоя MySQL будут утрачены все данные, которые в них хранились. Тип <code>HEAP</code>
очень хорошо подходит для временных таблиц!

</P>
<P>
Для внутренних <code>HEAP</code>-таблиц в MySQL используется 100%-ное динамическое
хэширование без областей переполнения; дополнительное пространство для
свободных списков не требуется. Отсутствуют при использовании <code>HEAP</code>-таблиц
и проблемы с командами удаления и вставки, которые часто применяются  в
хэшированных таблицах:

</P>

<PRE>
mysql&#62; CREATE TABLE test TYPE=HEAP SELECT ip,SUM(downloads) AS down
    -&#62; FROM log_table GROUP BY ip;
mysql&#62; SELECT COUNT(ip),AVG(down) FROM test;
mysql&#62; DROP TABLE test;
</PRE>

<P>
При использовании <code>HEAP</code>-таблиц необходимо обращать внимание на следующие
моменты:

</P>

<UL>
<LI>

Необходимо всегда указывать параметр <code>MAX_ROWS</code> в операторе <code>CREATE</code>,
чтобы случайным образом не занять всю память.
<LI>

Индексы будут использоваться только с <code>=</code> и <code>&#60;=&#62;</code> (но ОЧЕНЬ быстрые).
<LI>

В <code>HEAP</code>-таблицах для поиска строки могут использоваться только полные
ключи, в то время как для таблиц <code>MyISAM</code>  при поиске  строк может
применяться любой префикс ключа.
<LI>

Для <code>HEAP</code>-таблиц используется формат с фиксированной длиной записи.
<LI>

Для <code>HEAP</code>-таблиц не поддерживаются столбцы формата <code>BLOB</code>/<code>TEXT</code>.
<LI>

Для <code>HEAP</code>-таблиц не поддерживаются столбцы формата <code>AUTO_INCREMENT</code>.
<LI>

До версии 4.0.2 для <code>HEAP</code>-таблиц не поддерживаются индексы в столбцах формата <code>NULL</code>.
<LI>

В <code>HEAP</code>-таблицах могут встречаться совпадающие ключи (что не является
нормой для хэшированных таблиц).
<LI>

<code>HEAP</code>-таблицы используются совместно всеми клиентами (как и все другие
таблицы).
<LI>

Нельзя производить поиск следующей записи в порядке следования (т.е.
использовать индекс в команде <code>ORDER BY</code>).
<LI>

Данные <code>HEAP</code>-таблиц расположены в маленьких блоках. Таблицы на 100%
являются динамическими (при вставке). Нет необходимости ни в областях
переполнения, ни в дополнительных ключах. Удаленные строки помещаются
в связанный список и используются при вставке в таблицу новых данных.
<LI>

Следует позаботиться о том, чтобы имелось достаточное количество
дополнительной памяти  для всех <code>HEAP</code>-таблиц, которые будут
использоваться одновременно,.
<LI>

Чтобы освободить память, необходимо запустить команду <code>DELETE FROM
heap_table</code>, <code>TRUNCATE heap_table</code> или <code>DROP TABLE heap_table</code>.
<LI>

MySQL не может подсчитать, сколько строк находится между двумя
значениями (используется оптимизатором диапазонов для выбора
используемого индекса). Это может повлиять на некоторые запросы, если
преобразовать таблицу <code>MyISAM</code> в формат <code>HEAP</code>.
<LI>

При создании размер таблицы <code>HEAP</code> не может превышать
<code>max_heap_table_size</code>; это сделано для того, чтобы обеспечить защиту от
случайных неквалифицированных действий.
</UL>

<P>
Количество памяти, необходимой для одной строки в <code>HEAP</code>-таблице,
вычисляется следующим образом:

</P>

<PRE>
SUM_OVER_ALL_KEYS(max_length_of_key + sizeof(char*) * 2)
+ ALIGN(length_of_row+1, sizeof(char*))
</PRE>

<P>
<code>sizeof(char*)</code> составляет 4 на 32-разрядных компьютерах и 8 - на
64-разрядных.

</P>


<H2><A NAME="InnoDB" HREF="manual.ru_toc.html#InnoDB">7.5  Таблицы <code>InnoDB</code></A></H2>

<P>
<A NAME="IDX1489"></A>
<A NAME="IDX1490"></A>
<A NAME="IDX1491"></A>
<A NAME="IDX1492"></A>

</P>



<H3><A NAME="InnoDB_overview" HREF="manual.ru_toc.html#InnoDB_overview">7.5.1  Обзор таблиц InnoDB</A></H3>

<P>
Таблицы <code>InnoDB</code> в MySQL снабжены обработчиком таблиц, обеспечивающим
безопасные транзакции (уровня <code>ACID</code>) с возможностями фиксации транзакции,
отката и восстановления после сбоя. Для таблиц InnoDB осуществляется
блокировка на уровне строки, а также используется метод чтения без
блокировок в команде <code>SELECT</code> (наподобие применяющегося в Oracle).
Перечисленные функции позволяют улучшить взаимную совместимость и повысить
производительность в многопользовательском режиме. В InnoDB нет
необходимости в расширении блокировки, так как блоки строк в InnoDB
занимают очень мало места. Для таблиц InnoDB поддерживаются ограничивающие
условия <code>FOREIGN KEY</code>.

</P>
<P>
<code>InnoDB</code> предназначается для получения максимальной производительности при
обработке больших объемов данных. По эффективности использования
процессора этот тип намного превосходит другие модели реляционных баз
данных с памятью на дисках.

</P>
<P>
Технически InnoDB является завершенной системой управления базой данных в
рамках MySQL. В InnoDB есть свой собственный буферный пул для кэширования
данных и индексов в основной памяти. Таблицы и индексы InnoDB хранятся в
специальном пространстве памяти, которое может состоять из нескольких
файлов. В этом заключается отличие InnoDB от, например, таблиц MyISAM:
каждая таблица MyISAM хранится в отдельном файле. Таблицы InnoDB могут
быть любого размера даже в тех операционных системах, где установлено
ограничение файла в 2 Гб.

</P>
<P>
Свежую информацию по InnoDB можно найти на <a HREF="http://www.innodb.com/">http://www.innodb.com/</a>. Здесь
же находится последняя версия руководства по InnoDB. Кроме того, можно
заказать коммерческие лицензии и поддержку для InnoDB.

</P>
<P>
В настоящий момент (октябрь 2001 года) таблицы InnoDB применяются  на
нескольких больших сайтах баз данных, для которых важна высокая
производительность. Так, таблицы InnoDB используются на популярном сайте
новостей Slashdot.org. Формат InnoDB применяется для хранения более 1Тб
данных компании Mytrix, Inc; можно привести пример еще одного сайта, где
при помощи при помощи InnoDB обрабатывается средняя нагрузка объемом в 800
вставок/обновлений в секунду.

</P>
<P>
Таблицы InnoDB входят в дистрибутив исходных текстов MySQL, начиная с
версии 3.23.34a; они активизированы в исполняемом коде MySQL -Max. Для
Windows исполняемые коды -Max находятся в стандартном дистрибутиве.

</P>
<P>
Если вы загрузили исполняемую версию MySQL, которая включает поддержку
InnoDB, следует просто выполнить инструкции руководства MySQL по установке
исполняемой версии MySQL. В случае, если у вас уже установлен MySQL-3.23,
проще всего установить MySQL -Max, чтобы заменить исполняемый файл <tt>`mysqld'</tt>
соответствующим файлом из дистрибутива -Max. Различными  в MySQL и MySQL
-Max являются  только исполняемые файлы сервера. См. разделы section <A HREF="manual.ru.html#Installing_binary">2.2.10  Установка бинарного дистрибутива MySQL</A> и See section <A HREF="manual.ru.html#mysqld-max">4.7.5  <code>mysqld-max</code>, расширенный сервер <code>mysqld</code></A>.

</P>
<P>
Чтобы произвести компиляцию MySQL с поддержкой InnoDB, загрузите
MySQL-3.23.34a или более новую версию с <a HREF="http://www.mysql.com/">http://www.mysql.com/</a> и настройте
MySQL при помощи параметра <code>--with-innodb</code>. См. раздел руководства MySQL по
установке дистрибутива исходного кода MySQL, See section <A HREF="manual.ru.html#Installing_source">2.3  Установка исходного дистрибутива MySQL</A>.

</P>

<PRE>
cd /path/to/source/of/mysql-3.23.37
./configure --with-innodb
</PRE>

<P>
Чтобы  использовать InnoDB, необходимо  указать  параметры  запуска InnoDB
в  своем  файле  <tt>`my.cnf'</tt> или <tt>`my.ini'</tt>. Самый простой способ внести
изменения - добавить в раздел <code>[mysqld]</code> строку

</P>

<PRE>
innodb_data_file_path=ibdata:30M
</PRE>

<P>
Однако чтобы добиться высокой скорости работы, лучше указать рекомендуемые
параметры. See section <A HREF="manual.ru.html#InnoDB_start">7.5.2  Параметры запуска InnoDB</A>.

</P>
<P>
InnoDB распространяется на условиях общедоступной лицензии версии 2 (от
июня 1991 года). В дистрибутиве исходного кода MySQL InnoDB находится в
подкаталоге <tt>`innobase'</tt>.

</P>


<H3><A NAME="InnoDB_start" HREF="manual.ru_toc.html#InnoDB_start">7.5.2  Параметры запуска InnoDB</A></H3>

<P>
Чтобы использовать таблицы InnoDB в MySQL-Max-3.23, НЕОБХОДИМО задать
параметры конфигурации в разделе <code>[mysqld]</code> файла конфигурации <tt>`my.cnf'</tt> или
в файле параметров Windows <tt>`my.ini'</tt>.

</P>
<P>
В версии 3.23 как минимум необходимо указать имя и размер файлов данных в
<code>innodb_data_file_path</code>.  Если вы не указали <code>innodb_data_home_dir</code> в
<tt>`my.cnf'</tt> по умолчанию эти файлы создаются в директории данных MySQL. Если
вы указали <code>innodb_data_home_dir</code> как пустую строку, то вы должны указать
полный путь к вашим файлам данным в <code>innodb_data_file_path</code>. В MySQL 4.0
не требуется задавать даже <code>innodb_data_file_path</code>: по умолчанию для него
создается автоматически увеличивающийся файл размером в 10 Мб с именем
<tt>`ibdata1'</tt> в каталоге <tt>`datadir'</tt> MySQL. (в MySQL-4.0.0 и 4.0.1 размер
файла данных составляет 64 Мб и он не является автоматически увеличивающимся).

</P>
<P>
Если вы не хотите использовать <code>InnoDB</code> таблицы, вы можете добавить опцию
<code>skip-innodb</code> в конфигурационный файл MySQL. 

</P>
<P>
Однако для того, чтобы получить высокую производительность, НЕОБХОДИМО
явно задать параметры InnoDB, перечисленные в следующих примерах.

</P>
<P>
Начиная с версий 3.23.50 и 4.0.2  для InnoDB имеется возможность задавать
последний файл данных в <code>innodb_data_file_path</code> как автоматически
увеличивающийся. В этом случае для <code>innodb_data_file_path</code> используется
следующий синтаксис:

</P>

<PRE>
pathtodatafile:sizespecification;pathtodatafile:sizespecification;...
... ;pathtodatafile:sizespecification[:autoextend[:max:sizespecification]]
</PRE>

<P>
Если последний файл данных указан с параметром автоматического увеличения,
то в случае нехватки места для табличной области InnoDB будет увеличивать
последний файл данных; приращение файла каждый раз составляет 8 Мб.
Например, синтаксис:

</P>

<PRE>
innodb_data_home_dir =
innodb_data_file_path = /ibdata/ibdata1:100M:autoextend
</PRE>

<P>
указывает InnoDB создать один файл данных с начальным размером 100 Мб,
который будет увеличиваться на 8 Мб каждый раз, когда не будет хватать
места. Если текущий диск окажется заполненным, можно, к примеру, добавить
еще один файл данных на другой диск. При задании размера автоматически
увеличивающегося файла <tt>`ibdata1'</tt> следует округлить его текущий размер до
ближайшего числа, кратного 1024 * 1024 байтам (= 1 Мб), и явно указать
округленный размер <tt>`ibdata1'</tt> в <code>innodb_data_file_path</code>. После этой записи
можно добавить еще один файл данных:

</P>

<PRE>
innodb_data_home_dir =
innodb_data_file_path = /ibdata/ibdata1:988M;/disk2/ibdata2:50M:autoextend
</PRE>

<P>
Следует соблюдать осторожность при работе в файловых системах, в которых
установлено ограничение на размер файла в 2 Гб! Максимальный для данной
операционной системы размер файла InnoDB не известен. В таком случае
желательно указать максимальный размер файла данных:

</P>

<PRE>
innodb_data_home_dir =
innodb_data_file_path = /ibdata/ibdata1:100M:autoextend:max:2000M
</PRE>

<P>
<strong>Простой пример файла <tt>`my.cnf'</tt></strong>. Предположим, что у вас есть
компьютер с 128 Мб ОЗУ и одним жестким диском. Ниже приведены примеры возможных
параметров конфигурации в <tt>`my.cnf'</tt> или <tt>`my.ini'</tt> для InnoDB. Мы
предполагаем что у вас запущен MySQL-Max-3.23.50 и выше или MySQL-4.0.2 и выше.
Этот пример подходит для большинства пользователей работающих под Unix и
Windows, которые не хотят располагать файлы данных и журнальные файлы на
различных дисках. В этом примере создается автоматически увеличивающийся файл
<tt>`ibdata1'</tt> и два журнальных файла <tt>`ib_logfile0'</tt> и <tt>`ib_logfile1'</tt> в
в директории данных MySQL (обычно <tt>`/mysql/data'</tt>). Небольшой архивный
журнальный файл InnoDB <tt>`ib_arch_log_0000000000'</tt> также располагается в каталоге
<code>datadir</code>:

</P>

<PRE>
[mysqld]
# Сюда  можно  добавить  другие  опции MySQL
# ...
#
# Файлы  данных  должны  иметь  достаточно
# места  для  сохранения  ваших  данных  и
# индексов. Убедитесь что у вас достаточно 
# свободного места на диске.
innodb_data_file_path = ibdata1:10M:autoextend
# Размер  буферного  пула  следует  задавать
# как 50 - 80% памяти  компьютера
set-variable = innodb_buffer_pool_size=70M
set-variable = innodb_additional_mem_pool_size=10M
# Размер  файла  журналов  должен  составлять
# около 25% от  размера  буферного  пула
set-variable = innodb_log_file_size=20M
set-variable = innodb_log_buffer_size=8M
# Если  допустима  потеря  некоторых
# последних  транзакций, установите
# flush_log_в_trx_commit в 0
innodb_flush_log_at_trx_commit=1
</PRE>

<P>
<strong>Убедитесь, что MySQL server имеет права создавать файлы</strong> в <code>datadir</code>.

</P>
<P>
Не забывайте, что в некоторых файловых системах существует ограничение в 2
Гб на размер файла данных! Общий размер файлов журналов должен быть меньше
4 Гб, а общий размер файлов данных - больше или равен 10Мб.

</P>
<P>
При первом создании базы данных InnoDB лучше всего запустить сервер MySQL
из командной строки. Тогда на экран будет выводиться информация о создании базы
данных и вы сможете увидеть, что происходит. Смотрите следующий раздел, в
котором описано, на что должна быть похожа выводимая информация.  Например, в
Windows можно запустить <tt>`mysqld-max.exe'</tt> с параметрами:

</P>

<PRE>
your-path-to-mysqld&#62;mysqld-max --console
</PRE>

<P>
Где поместить файл <tt>`my.cnf'</tt> или <tt>`my.ini'</tt> в Windows? Для Windows существуют
следующие правила:

<UL>
<LI>Должен быть создан только один файл <tt>`my.cnf'</tt> или <tt>`my.ini'</tt>.

<LI>Файл <tt>`my.cnf'</tt> должен находиться в корневом каталоге диска <tt>`C:'</tt>.

<LI>Файл <tt>`my.ini'</tt> должен находиться в каталоге <tt>`WINDIR'</tt>, например в

<tt>`C:\WINDOWS'</tt> или <tt>`C:\WINNT'</tt>. Чтобы вывести значение <tt>`WINDIR'</tt>, можно
воспользоваться командой <code>SET</code> операционной системы MS-DOS.
<LI>Если на вашем компьютере применяется загрузчик операционной системы, в

котором диск <tt>`C:'</tt> не является загрузочным, то необходимо использовать
файл <tt>`my.ini'</tt>.
</UL>

<P>
<strong>Где указываются параметры в Unix?</strong>

</P>
<P>
В Unix <code>mysqld</code> считывает параметры из
следующих файлов, если они существуют, в таком порядке:

<UL>
<LI><tt>`/etc/my.cnf'</tt> - общие параметры.

<LI><tt>`COMPILATION_DATADIR/my.cnf'</tt> -- параметры для сервера.

<LI><tt>`defaults-extra-file'</tt> -- файл, указанный при помощи

<code>--defaults-extra-file=...</code>.
<LI><tt>`~/.my.cnf'</tt> - параметры для пользователя.

</UL>

<P>
<code>COMPILATION_DATADIR</code> представляет собой каталог данных MySQL, который был
указан как параметр <code>./configure</code> при компиляции <code>mysqld</code> (обычно
<tt>`/usr/local/mysql/data'</tt> для установки исполняемых файлов или <tt>`/usr/local/var'</tt> 
для установки исходного кода).

</P>
<P>
Если точно не известно, откуда <code>mysqld</code> считывает свои файлы <tt>`my.cnf'</tt> или
<tt>`my.ini'</tt>, можно задать путь как первый параметр командной строки для
сервера: <code>mysqld --defaults-file=your_path_to_my_cnf</code>.

</P>
<P>
InnoDB формирует полный путь к файлу данных путем соединения
<code>innodb_data_home_dir</code> и имени файла данных или пути в
<code>innodb_data_file_path</code>, добавляя при необходимости косую черту. Если
ключевое слово <code>innodb_data_home_dir</code> не упоминается в <tt>`my.cnf'</tt>
совсем, по умолчанию используется директория данных MySQL.

</P>
<P>
<strong>Пример расширенного файла <tt>`my.cnf'</tt></strong>

</P>
<P>
Предположим, что у вас есть
компьютер Linux с 2 Гб ОЗУ и тремя жесткими дисками по 60 Гб (с путями
каталогов <tt>``/''</tt>, <tt>``/dr2''</tt> and <tt>``/dr3''</tt>). Ниже приведен пример
возможных параметров конфигурации в <tt>`my.cnf'</tt> для InnoDB:

</P>
<P>
<strong>Учтите, что InnoDB не создает директории: вы должны создать их
самостоятельно</strong>. Используйте комманду Unix или MS-DOS <code>mkdir</code> для создания
домашней директории для InnoDB и домашней директории для группы журнальных
файлов.

</P>

<PRE>
[mysqld]
# Здесь  вы  можете  задать  другие  опции  сервера MySQL
# ...
#
innodb_data_home_dir = 
# Файлы  данных  должны  иметь  достаточно
# места  для  сохранения  ваших  данных  и
# индексов
innodb_data_file_path = /ibdata/ibdata1:2000M;/dr2/ibdata/ibdata2:2000M:autoextend
# Размер  буферного  пула  следует  задавать
# как 50 - 80% памяти  компьютера, но
# для Linux x86 следует  убедиться, что
# общий  расход  памяти  не  превышает 2 Гб
set-variable = innodb_buffer_pool_size=1G
set-variable = innodb_additional_mem_pool_size=20M
innodb_log_group_home_dir = /dr3/iblogs
# .._log_arch_dir должен  быть  такой
# же, как _log_group_home_dir
innodb_log_arch_dir = /dr3/iblogs
set-variable = innodb_log_files_in_group=3
# Размер  файла  журналов  должен  составлять
# около 15 % от  размера  буферного  пула
set-variable = innodb_log_file_size=150M
set-variable = innodb_log_buffer_size=8M
# Если  допустима  потеря  некоторых
# последних  транзакций, установите
# flush_log_в_trx_commit в 0
innodb_flush_log_at_trx_commit=1
set-variable = innodb_lock_wait_timeout=50
#innodb_flush_method=fdatasync
#set-variable = innodb_thread_concurrency=5
</PRE>

<P>
Обратите внимание на то, что два файла данных размещены на разных дисках.
InnoDB будет заполнять табличное пространство, образованное файлами
данных, снизу вверх. В некоторых случаях это позволяет увеличить
производительность баз данных, если не все данные размещены на одном
физическом диске. Размещение файлов журнала на другом диске очень часто
позволяет повысить производительность. Для файлов данных можно также
использовать разделы реального диска (реальные устройства): в некоторых
версиях Unix это ускоряет операции ввода/вывода. Информацию по указанию
параметров в <tt>`my.cnf'</tt> вы найдете в разделе руководства по управлению
пространством файлов InnoDB.

</P>
<P>
<strong>Предупреждение</strong>: в Linux x86 необходимо соблюдать осторожность, чтобы не
установить слишком высокое значение использования памяти. <code>glibc</code> может дать
процессу разрастись и превысить стеки потоков, что приведет к сбою
сервера. Степень риска значительно повышается, если значение

</P>

<PRE>
innodb_buffer_pool_size + key_buffer +
max_connections * (sort_buffer + read_buffer_size) + max_connections * 2 MB
</PRE>

<P>
приближается к значению 2 Гб или превышает его. Каждый поток будет
использовать стек (обычно 2 Мб, но в бинарной поставке MySQL AB только 256
Кб) и в худшем случае также дополнительную память <code>sort_buffer +
read_buffer_size</code>.

</P>
<P>
<strong>Как настроить другие параметры сервера mysqld?</strong>
Для большинства
пользователей подходят следующие стандартные значения:

</P>

<PRE>
skip-locking
set-variable = max_connections=200
set-variable = read_buffer_size=1M
set-variable = sort_buffer=1M
# Размер key_buffer следует  задавать  как
# 5%-50% от  вашего  ОЗУ, в  зависимости
# от  того, как  часто  у  вас  используются
# таблицы MyISAM, но key_buffer +
# размер  буферного  пула InnoDB не  должен
# превышать 80% вашего  ОЗУ
set-variable = key_buffer=...
</PRE>

<P>
Обратите внимание на то, что некоторые параметры представлены при помощи
формата числового параметра <tt>`my.cnf'</tt>: <code>set-variable = innodb... = 123</code>, а
остальные (строчные и логические параметры) - при помощи другого формата:
<code>innodb_... = ...</code>.

</P>
<P>
Параметры настройки имеют следующие значения:

</P>
<TABLE BORDER>
<TR><TD><strong>Параметр</strong> </TD><TD> <strong>Описание</strong>

</TD></TR>
<TR><TD><code>innodb_data_home_dir</code> </TD><TD> Общая часть пути к каталогу всех файлов
данных InnoDB. Если вы не указали этот параметр в <tt>`my.cnf'</tt>, то по
умолчанию для этого параметра принято значение <code>datadir</code> MySQL. Если
вы указали как пустою строку, то в этом случае вы можете использовать полный
путь в <code>innodb_data_file_path</code>. 
</TD></TR>
<TR><TD><code>innodb_data_file_path</code> </TD><TD> Пути к отдельным файлам данных и их размеры.
Полный путь к каталогу каждого файла данных   
получается путем объединения                  
<code>innodb_data_home_dir</code> с путем, который задается
данным параметром. Размеры файлов указаны в   
мегабайтах. InnoDB также ``понимает'' сокращение 'G', 1 G означает 1024 М. Начиная с
версии 3.23.44 в операционных системах, где   
поддерживаются большие файлы, можно задавать  
размер файла, превышающий 4 Гб. В некоторых   
операционных системах файлы должны быть &#60; 2   
Гб. Общий объем файлов должен быть как минимум
10 Мб.
</TD></TR>
<TR><TD><code>innodb_mirrored_log_groups</code> </TD><TD> Количество идентичных копий групп журналов, которые хранятся для базы данных. На данный
момент этому параметру должно быть присвоено  
значение 1.
</TD></TR>
<TR><TD><code>innodb_log_group_home_dir</code> </TD><TD> Путь к каталогу файлов журналов InnoDB.
</TD></TR>
<TR><TD><code>innodb_log_files_in_group</code> </TD><TD> Количество файлов журналов в группе журналов. InnoDB производит запись в файлы по круговому
способу. Для этого параметра рекомендуется установить значение "3".
</TD></TR>
<TR><TD><code>innodb_log_file_size</code> </TD><TD> Размер каждого файла журнала в группе журналов
(указывается в мегабайтах). Разумный диапазон 
значений составляет от 1М до 1/N от размера   
буферного пула, приведенного ниже, где N -    
количество файлов журналов в группе. Чем      
больше это значение, тем меньше требуется сбросов на диск информации из буферного пула, 
что сокращает количество дисковых операций    
ввода/вывода. Однако в случае сбоя            
восстановление при больших размерах файлов    
журналов займет больше времени. Общий размер  
файлов журналов на 32-разрядных компьютерах   
должен быть &#60; 4 Гб.
</TD></TR>
<TR><TD><code>innodb_log_buffer_size</code> </TD><TD> Размер буфера, который в InnoDB используется
для записи информации файлов журналов на диск.
Разумный диапазон значений составляет от 1М до 8М. 
Большой буфер журналов позволяет осуществлять 
объемные транзакции без записи журнала на диск
до завершения транзакции. Поэтому если ваши   
транзакции отличаются значительными объемами, 
увеличение буфера журналов сократит количество
операций ввода/вывода диска.
</TD></TR>
<TR><TD><code>innodb_flush_log_at_trx_commit</code> </TD><TD> Обычно этому параметру присваивается значение
1; при этом значении после завершения         
транзакции информация журнала записывается на 
диск и фиксируются изменения, внесенные       
транзакцией, благодаря чему данные сохраняются в случае сбоя базы данных. Если у вас         
выполняется большое количество маленьких      
транзакций и вы готовы пожертвовать такой     
возможностью, можно установить значение этого 
параметра в 0, чтобы снизить количество обращений к диску.
</TD></TR>
<TR><TD><code>innodb_log_arch_dir</code> </TD><TD> Каталог, в котором будут храниться заполненные
файлы журналов, если включено архивирование журналов. Значение этого параметра на         
настоящий момент должно задаваться таким же, как и для <code>innodb_log_group_home_dir</code>.
</TD></TR>
<TR><TD><code>innodb_log_archive</code> </TD><TD> На данный момент значение этого параметра
должно устанавливаться в 0. Поскольку восстановление из резервной копии MySQL       
осуществляет при помощи своих собственных     
файлов журналов, архивировать файлы журналов  
InnoDB нет необходимости.
</TD></TR>
<TR><TD><code>innodb_buffer_pool_size</code> </TD><TD> Размер буфера памяти, который InnoDB
использует для кэширования данных и индексов  
своих таблиц. Чем больше это значение, тем    
меньше обращений к диску осуществляется при   
получении доступа к данным таблиц. На специально выделенном сервере баз данных этот 
параметр можно установить в значение до 80%   
физической памяти компьютера. Однако для этого
параметра не следует задавать слишком большое 
значение, так как при  недостатке физической  
памяти операционная система будет вынуждена   
сбрасывать часть информации на диск.
</TD></TR>
<TR><TD><code>innodb_additional_mem_pool_size</code> </TD><TD> Размер пула памяти, который InnoDB использует
для хранения информации словаря данных и      
других внутренних структур данных. Разумным   
значением для этого параметра может быть 2М,  
но чем больше таблиц в вашем приложении, тем больше информации нужно будет разместить в    
этом пуле. Если памяти в этом пуле будет      
недостаточно для InnoDB, то будет выделятся   
память операционной системы, а в файл журнала 
MySQL будут записываться предупреждающие      
сообщения.
</TD></TR>
<TR><TD><code>innodb_file_io_threads</code> </TD><TD> Количество потоков ввода/вывода файлов в
InnoDB. Обычно этому параметру присваивается значение 4, но в Windows при помощи увеличения
данного значения можно сократить количество   
обращений к диску.
</TD></TR>
<TR><TD><code>innodb_lock_wait_timeout</code> </TD><TD> Время простоя (в секундах), на протяжении
которого транзакция InnoDB может ожидать      
блокировки прежде, чем будет произведен откат.
InnoDB автоматически обнаруживает зависшие    
транзакции в своей таблице блокировок и       
производит откат транзакций. Если в той же самой транзакции используется команда <code>LOCK 
TABLES</code>, или другие обработчики таблиц с       
безопасными транзакциями, отличными от InnoDB,
то может возникнуть зависание, которое не     
будет обнаружено InnoDB. В таких ситуациях    
параметр времени простоя помогает устранить   
проблему.
</TD></TR>
<TR><TD><code>innodb_flush_method</code> (Доступен, начиная с версий 3.23.40 и выше). По умолчанию для этого параметра принято
значение <code>fdatasync</code>. Другой возможный вариант - <code>O_DSYNC</code>.                                      
</TD></TR>
</TABLE>



<H3><A NAME="InnoDB_init" HREF="manual.ru_toc.html#InnoDB_init">7.5.3  Создание табличной области InnoDB</A></H3>

<P>
Предположим, что вы установили MySQL и внесли в файл <tt>`my.cnf'</tt> необходимые
параметры настройки InnoDB. Прежде чем запустить MySQL, необходимо
убедиться, что указанные каталоги для файлов данных и журналов InnoDB
существуют, и что у вас есть право доступа к этим каталогам. InnoDB может
создавать только файлы, но не каталоги. Проверьте также, достаточно ли у
вас свободного дискового пространства для файлов данных и журналов.

</P>
<P>
Теперь при запуске MySQL InnoDB начнет создавать ваши файлы данных и файлы
журналов. При этом будет выводиться примерно такая информация:

</P>

<PRE>
~/mysqlm/sql &#62; mysqld
InnoDB: The first specified datafile /home/heikki/data/ibdata1
did not exist:
InnoDB: a new database to be created!
InnoDB: Setting file /home/heikki/data/ibdata1 size to 134217728
InnoDB: Database physically writes the file full: wait...
InnoDB: datafile /home/heikki/data/ibdata2 did not exist:
new to be created
InnoDB: Setting file /home/heikki/data/ibdata2 size to 262144000
InnoDB: Database physically writes the file full: wait...
InnoDB: Log file /home/heikki/data/logs/ib_logfile0 did not exist:
new to be created
InnoDB: Setting log file /home/heikki/data/logs/ib_logfile0 size to
5242880
InnoDB: Log file /home/heikki/data/logs/ib_logfile1 did not exist:
new to be created
InnoDB: Setting log file /home/heikki/data/logs/ib_logfile1 size to
5242880
InnoDB: Log file /home/heikki/data/logs/ib_logfile2 did not exist:
new to be created
InnoDB: Setting log file /home/heikki/data/logs/ib_logfile2 size to
5242880
InnoDB: Started
mysqld: ready for connections
</PRE>

<P>
Сейчас была создана новая база данных InnoDB. К серверу MySQL вы можете
подключиться при помощи обычных клиентских программ MySQL, таких как
<code>mysql</code>. Если работа сервера MySQL завершается при помощи команды <code>mysqladmin
shutdown</code>, InnoDB выведет примерно следующее:

</P>

<PRE>
010321 18:33:34 mysqld: Normal shutdown
010321 18:33:34 mysqld: Shutdown Complete
InnoDB: Starting shutdown...
InnoDB: Shutdown completed
</PRE>

<P>
Теперь можно просмотреть каталоги файлов данных и журналов, чтобы увидеть,
какие файлы были созданы. В каталоге журналов будет также находиться
небольшой файл <code>ib_arch_log_0000000000</code>. Этот файл появляется в результате
создания базы данных, после чего InnoDB отключает архивирование журналов.
При новом запуске MySQL будет выведена примерно следующая информация:

</P>

<PRE>
~/mysqlm/sql &#62; mysqld
InnoDB: Started
mysqld: ready for connections
</PRE>



<H4><A NAME="Error_creating_InnoDB" HREF="manual.ru_toc.html#Error_creating_InnoDB">7.5.3.1  Если во время создания базы данных что-то происходит не так</A></H4>

<P>
Если InnoDB выдает ошибку операционной системы во время операции с файлом,
то причиной возникшей проблемы, как правило, является одна из следующих:

</P>

<UL>
Вы не создали каталоги для файлов данных или журналов InnoDB.
<LI>У <code>mysqld</code> нет прав на создание файлов в этих каталогах.

<LI><code>mysqld</code> не считал нужный файл <tt>`my.cnf'</tt> или <tt>`my.ini'</tt> и, соответственно,

не получил указанных вами параметров.
<LI>Диск переполнен или превышена квота использования диска.

<LI>Вы создали подкаталог, имя которого совпадает с указанным файлом

данных.
<LI>Синтаксическая  ошибка в <code>innodb_data_home_dir</code> или

<code>innodb_data_file_path</code>.
</UL>

<P>
Если что-то происходит не так во время создания базы данных InnoDB,
необходимо удалить все файлы, созданные InnoDB. В их число входят все
файлы данных, все файлы журналов, небольшой архивный файл журнала; если вы
уже создали какие-либо таблицы InnoDB, то следует также удалить
соответствующие им файлы <tt>`.frm'</tt>, которые находятся в каталогах баз данных
MySQL. После этого можно попробовать создать базу данные InnoDB еще раз.

</P>


<H3><A NAME="Using_InnoDB_tables" HREF="manual.ru_toc.html#Using_InnoDB_tables">7.5.4  Создание  таблиц InnoDB</A></H3>

<P>
Предположим, что у вас запущен клиент MySQL при помощи команды <code>mysql test</code>.
Чтобы создать таблицу в формате InnoDB, необходимо в команде создания
таблицы SQL указать <code>TYPE = InnoDB</code>:

</P>

<PRE>
CREATE TABLE CUSTOMER (A INT, B CHAR (20), INDEX (A)) TYPE = InnoDB;
</PRE>

<P>
Эта команда SQL создаст таблицу и индекс в столбце A табличной области
InnoDB. Кроме того, MySQL создаст файл <tt>`CUSTOMER.frm'</tt> каталоге баз данных
MySQL с именем <tt>`test'</tt>. В свой собственный словарь данных InnoDB добавит
запись для таблицы <code>test/CUSTOMER</code>. Таким образом, можно создать таблицу с
таким же именем <code>CUSTOMER</code> в другой базе данных MySQL, и это не приведет к
конфликту имен таблиц в рамках InnoDB.

</P>
<P>
Для любой таблицы, которая была создана с параметром <code>TYPE = InnoDB</code>, можно
запросить количество свободного пространства в табличной области InnoDB.
Для этого нужно выполнить команду запроса состояния таблицы. Количество
свободного пространства будет выводиться в разделе примечаний к таблице в
выходной информации команды <code>SHOW</code>.

</P>
<P>
Например:

</P>

<PRE>
SHOW TABLE STATUS FROM test LIKE 'CUSTOMER'
</PRE>

<P>
Обратите внимание на то, что статистические данные, которые команда <code>SHOW</code>
выдает по таблицам InnoDB, являются приблизительными: они используются для
оптимизации SQL. Точными являются зарезервированные размеры таблицы и
индекса, значения которых выдаются в байтах.

</P>


<H4><A NAME="SEC459" HREF="manual.ru_toc.html#SEC459">7.5.4.1  Преобразование таблиц MyISAM в формат InnoDB</A></H4>

<P>
В InnoDB отсутствует специальная оптимизация создания отдельных индексов.
Таким образом, этот формат не обеспечивает экспорта и импорта таблиц с
последующим созданием индексов. Самый быстрый способ преобразовать таблицу
в формат InnoDB - напрямую вставить данные в таблицу InnoDB,
воспользовавшись командой <code>ALTER TABLE ... TYPE=INNODB</code>, или создать пустую
таблицу InnoDB с такой же структурой и вставить строки при помощи команды
<code>INSERT INTO ... SELECT * FROM ...</code>.

</P>
<P>
Чтобы лучше контролировать процесс вставки, большие таблицы желательно
вставлять по частям:

</P>

<PRE>
INSERT INTO newtable SELECT * FROM oldtable
   WHERE yourkey &#62; something AND yourkey &#60;= somethingelse;
</PRE>

<P>
После того, как все данные будут вставлены, таблицы можно будет
переименовать.

</P>
<P>
Во время преобразования больших таблиц необходимо задать достаточно
большой размер динамического буфера InnoDB, чтобы снизить количество
дисковых операций ввода/вывода. Однако размер буфера не должен превышать
80% физической памяти компьютера. Следует установить большие размеры для
файлов журналов InnoDB, а также большой размер буфера журналов.

</P>
<P>
Убедитесь, что у вас достаточно свободного пространства для табличной
области: таблицы InnoDB занимают намного больше места, чем таблицы MyISAM.
Если во время выполнения команды <code>ALTER TABLE</code> будет исчерпано свободное
дисковое пространство, начнется выполнение отката, и это может занять
несколько часов, если диск заполнен. Во время вставок для таблицы InnoDB
используется буфер вставки, чтобы произвести объединение вторичных
индексных записей с индексными таблицами при помощи групповых операций.
Это позволяет значительно снизить интенсивность дисковых операций
ввода/вывода. При откате такой механизм не используется, поэтому откат
может занять в 30 раз больше времени, чем вставка.

</P>
<P>
В случае, если началось выполнение отката и база данных не содержит ценной
информации, лучше прервать этот процесс и удалить все данные InnoDB, файлы
журналов, а также все таблицы InnoDB (файлы с расширением <tt>`.frm'</tt>), и начать
свою работу сначала, а не ждать завершения выполнения миллионов операций
ввода/вывода диска.

</P>


<H4><A NAME="SEC460" HREF="manual.ru_toc.html#SEC460">7.5.4.2  Ограничения внешнего ключа</A></H4>

<P>
Начиная с версии 3.23.43b, в InnoDB включены ограничения внешних ключей.
InnoDB - первый формат таблиц MySQL, который обеспечивает возможность
задавать ограничения внешнего ключа, чтобы обеспечить целостность данных.

</P>
<P>
Синтаксис задания ограничения внешнего ключа в InnoDB следующий:

</P>

<PRE>
[CONSTRAINT symbol] FOREIGN KEY (index_col_name, ...)
                    REFERENCES table_name (index_col_name, ...)
                    [ON DELETE {CASCADE | SET NULL | NO ACTION
                                | RESTRICT}]
                    [ON UPDATE {CASCADE | SET NULL | NO ACTION
                                | RESTRICT}]
</PRE>

<P>
Обе таблицы должны быть InnoDB-типа; <strong>обязательно также наличие индекса, в
котором внешний ключ и ссылочный ключ должны находиться в ПЕРВЫХ столбцах</strong>.
Для таблиц InnoDB индексы по внешним ключам или ссылочным ключам не
создаются автоматически: их создание требуется задавать явно.

</P>
<P>
Соответствующие столбцы внешнего и ссылочного ключей в таблице InnoDB
должны содержать одинаковые типы данных, чтобы их можно было сравнивать
без преобразования типов. <strong>Размер и знак целочисленных типов должны быть
одинаковыми</strong>. Длины для строковых типов могут не совпадать.

</P>
<P>
Если вы указали действие <code>SET NULL</code>, убедитесь что <strong>вы не объявили</strong>
столбец в дочерней таблице как <code>NOT NULL</code>.

</P>
<P>
Если оператор MySQL <code>CREATE TABLE</code> выдает ошибку с номером 1005, и в строке
сообщения об ошибке присутствует ссылка на ошибку с номером 150, то
произошел сбой создания таблицы из-за того, что ограничения внешнего ключа
не были сформированы надлежащим образом. Аналогично и для оператора <code>ALTER
TABLE</code>: если происходит ошибка при выполнении оператора и в сообщении
присутствует ссылка на ошибку с номером 150, то определение внешнего ключа
для преобразовываемой таблицы сформировано неправильно.

</P>
<P>
Начиная с версии 3.23.50 с ограничением внешнего ключа можно также
связывать выражения <code>ON DELETE CASCADE</code> или <code>ON DELETE SET NULL</code>.
Начиная с версии 4.0.8 вы можете это же использовать с <code>ON UPDATE</code>.

</P>
<P>
Если указано выражение <code>ON DELETE CASCADE</code> и строка в родительской таблице
удалена, то в формате InnoDB все эти строки автоматически удаляются также
и из дочерней таблицы, значения внешнего ключа которой равны значениям
ссылочного ключа в строке родительской таблицы. Если указано выражение <code>ON
DELETE SET NULL</code>, строки дочерней таблицы автоматически обновляются,
поэтому столбцам во внешнем ключе также присваивается значение SQL <code>NULL</code>.

</P>
<P>
Начиная с версии 3.23.50 в InnoDB не осуществляется проверка ограничений
внешних ключей на наличие значений внешних или родительских ключей,
которые содержат столбец <code>NULL</code>.

</P>
<P>
Начиная с версии 3.23.50 синтаксический анализатор InnoDB обеспечивает
возможность использовать обратные кавычки (`), ограничивающие имена таблиц
и столбцов в <code>FOREIGN KEY ... REFERENCES ...</code>, однако синтаксический анализатор
InnoDB еще ``не знает'' об опции <code>lower_case_table_names</code>, которая может
быть задана в файле <tt>`my.cnf'</tt>.

</P>
<P>
Пример:

</P>

<PRE>
CREATE TABLE parent(id INT NOT NULL, PRIMARY KEY (id)) TYPE=INNODB;
CREATE TABLE child(id INT, parent_id INT, INDEX par_ind (parent_id),
	     FOREIGN KEY (parent_id) REFERENCES parent(id)
	     ON DELETE SET NULL
) TYPE=INNODB;
</PRE>

<P>
Начиная с версии 3.23.50, для таблиц InnoDB обеспечивается возможность
добавлять новые ограничения внешних ключей для таблиц при помощи

</P>

<PRE>
ALTER TABLE yourtablename
  ADD [CONSTRAINT symbol] FOREIGN KEY (...) REFERENCES anothertablename(...)
</PRE>

<P>
Однако не следует забывать предварительно создавать необходимые индексы. В
InnoDB версий &#60; 3.23.50 команды <code>ALTER TABLE</code> или <code>CREATE INDEX</code> не должны
использоваться совместно с таблицами, для которых установлены ограничения
внешнего ключа или на которые есть ссылки в ограничениях внешних ключей:
Команда <code>ALTER TABLE</code> удаляет все ограничения внешних ключей, определенные в
таблице. Не следует использовать команду <code>ALTER TABLE</code> для таблиц, на
которые есть ссылки; вместо этого необходимо применять команды <code>DROP TABLE</code> 
и <code>CREATE TABLE</code>, чтобы изменить логическую структуру. При выполнении
команды <code>ALTER TABLE</code> MySQL может использовать команду <code>RENAME TABLE</code>, что
нарушит ограничения внешнего ключа, относящиеся к таблице. Оператор <code>CREATE
INDEX</code> в MySQL обрабатывается таким же образом, как и <code>ALTER TABLE</code>, поэтому
приведенные выше ограничения распространяются и на этот оператор.

</P>
<P>
При проверке внешних ключей для таблиц InnoDB устанавливается совместно
используемая блокировка строк на подлежащих просмотру родительских или
дочерних записях. Проверка ограничений внешнего ключа для таблиц InnoDB
производится немедленно и не откладывается до принятия транзакции.

</P>
<P>
Формат InnoDB обеспечивает возможность удалить любую таблицу, даже если
это нарушит ограничения внешнего ключа, ссылающегося на таблицу. При
удалении таблицы также удаляются ограничения, определенные оператором ее
создания.

</P>
<P>
Если удаленная таблица создается повторно, ее определение должно быть
согласовано с ограничениями внешнего ключа, который на нее ссылается. В
этой таблице необходимо правильно задать имена и типы столбцов; в ней
также должны присутствовать индексы ключей, на которые производится
ссылка, как указано выше. Если эти условия не будут выполнены, MySQL
выдаст ошибку с номером 1005 и ссылку на ошибку с номером 150 в строке
сообщения об ошибке.

</P>
<P>
Начиная с версии 3.23.50 InnoDB возвращает определения внешних ключей
таблицы, если вызвать

</P>

<PRE>
SHOW CREATE TABLE yourtablename
</PRE>

<P>
Помимо этого, <code>mysqldump</code> выводит корректные определения таблиц в файл
дампа, ``не забывая'' о внешних ключах.

</P>
<P>
Список ограничений внешнего ключа таблицы <code>T</code> можно также вывести при помощи
команды

</P>

<PRE>
SHOW TABLE STATUS FROM yourdatabasename LIKE 'T'
</PRE>

<P>
Ограничения внешнего ключа выводятся в комментариях к таблице.

</P>


<H3><A NAME="Adding_and_removing" HREF="manual.ru_toc.html#Adding_and_removing">7.5.5  Добавление и удаление файлов данных и журналов InnoDB</A></H3>

<P>
Начиная с версий 3.23.50 и 4.0.2, можно указать последний файл данных
InnoDB как <code>autoextend</code>. Можно также увеличить табличную область, указав
дополнительные файлы данных. Для этого необходимо остановить сервер MySQL,
внести изменения в файл <tt>`my.cnf'</tt>, добавив новый файл данных к
<code>innodb_data_file_path</code>, а затем запустить сервер MySQL снова.

</P>
<P>
На данный момент нельзя удалить файл данных из InnoDB. Чтобы уменьшить
размер своей базы данных, необходимо воспользоваться <code>mysqldump</code>, чтобы
сделать дамп всех своих таблиц, создать новую базу данных и импортировать
таблицы в новую базу данных.

</P>
<P>
Если необходимо изменить количество или размер файлов журналов InnoDB,
необходимо остановить MySQL и убедиться, что работа была завершена без
ошибок. После этого нужно скопировать старые файлы журналов в безопасное
место - на случай, если завершение работы было произведено с ошибками и
потребуется восстановление базы данных. Затем следует удалить старые файлы
журналов из каталога файлов журналов, внести изменения в <tt>`my.cnf'</tt> и снова
запустить MySQL. InnoDB при запуске сообщит о создании новых файлов
журналов.

</P>


<H3><A NAME="Backing_up" HREF="manual.ru_toc.html#Backing_up">7.5.6  Создание резервных копий и восстановление баз данных InnoDB</A></H3>

<P>
Чтобы обеспечить безопасное управление базами данных, необходимо регулярно
создавать резервные копии.

</P>
<P>
Существует интерактивный инструмент, который можно использовать для
создания резервных копий своих баз данных InnoDB, когда они открыты, -
InnoDB Hot Backup. Для своей работы InnoDB Hot Backup не требует закрытия
базы данных, блокировки данных или нарушения обычного хода обработки базы
данных. InnoDB Hot Backup является платным дополнительным инструментом, не
входящим в стандартный дистрибутив MySQL. Чтобы получить дополнительную
информацию о нем и просмотреть копии экрана, см. домашнюю страницу InnoDB
Hot Backup <a HREF="http://www.innodb.com/hotbackup.html">http://www.innodb.com/hotbackup.html</a>.

</P>
<P>
Если у вас есть возможность остановить сервер MySQL, а затем создать
двоичную резервную копию своей базы данных, необходимо выполнить следующие
действия:

</P>

<UL>
<LI>

Закройте свою базу данных MySQL и убедитесь, что закрытие было
произведено без ошибок.
<LI>

Скопируйте все свои файлы данных в безопасное место.
<LI>

Скопируйте все свои файлы журналов InnoDB в безопасное место.
<LI>

Скопируйте свой файл конфигурации <tt>`my.cnf'</tt> в безопасное место.
<LI>

Скопируйте все файлы <tt>`.frm'</tt> своих таблиц InnoDB в безопасное место.
</UL>

<P>
В дополнение к двоичным резервным копиям, описанным выше, необходимо также
регулярно создавать дампы своих таблиц при помощи <code>mysqldump</code>. Дело в том,
что повреждение двоичного файла человеку заметить сложно. Дампы таблиц
сохраняются в текстовых файлах, которые могут прочитать люди и структура
которых намного проще двоичных файлов базы данных. Увидеть повреждение
таблицы в файле дампа легче, и благодаря простоте этого формата
вероятность серьезного повреждения данных меньше.

</P>
<P>
Дампы лучше всего создавать одновременно с созданием двоичной резервной
копии своей базы данных. Чтобы получить согласованную копию всех своих
таблиц в дампах, необходимо запретить всем клиентам доступ к базе данных.
Затем можно создать двоичную резервную копию и получить согласованные
копии своей базы данных в двух форматах.

</P>
<P>
Чтобы восстановить исходное состояние своей базы данных InnoDB из
описанной выше двоичной резервной копии, необходимо запустить свою базу
данных MySQL с включенными общим журналом и архивацией журналов MySQL
(здесь под общим журналом подразумевается механизм занесения записей в
журнал сервера MySQL, независимый от журналов InnoDB).

</P>
<P>
Единственное, что нужно сделать для восстановления процесса MySQL после
сбоя, - перезапустить его. InnoDB автоматически произведет проверку
журналов и выполнит восстановление базы данных, а также автоматически
произведет откат по незавершенным транзакциям, которые проводились на
момент сбоя. Во время восстановления InnoDB будет выводить примерно
следующую информацию:

</P>

<PRE>
~/mysqlm/sql &#62; mysqld
InnoDB: Database was not shut down normally.
InnoDB: Starting recovery from log files...
InnoDB: Starting log scan based on checkpoint at
InnoDB: log sequence number 0 13674004
InnoDB: Doing recovery: scanned up to log sequence number 0 13739520
InnoDB: Doing recovery: scanned up to log sequence number 0 13805056
InnoDB: Doing recovery: scanned up to log sequence number 0 13870592
InnoDB: Doing recovery: scanned up to log sequence number 0 13936128
...
InnoDB: Doing recovery: scanned up to log sequence number 0 20555264
InnoDB: Doing recovery: scanned up to log sequence number 0 20620800
InnoDB: Doing recovery: scanned up to log sequence number 0 20664692
InnoDB: 1 uncommitted transaction(s) which must be rolled back
InnoDB: Starting rollback of uncommitted transactions
InnoDB: Rolling back trx no 16745
InnoDB: Rolling back of trx no 16745 completed
InnoDB: Rollback of uncommitted transactions completed
InnoDB: Starting an apply batch of log records to the database...
InnoDB: Apply batch completed
InnoDB: Started
mysqld: ready for connections
</PRE>

<P>
Если ваша база данных повреждена или произошел сбой диска, необходимо
произвести восстановление из резервной копии. В случае повреждения сначала
необходимо найти целую резервную копию, а из резервной копии произвести
восстановление по файлам общего журнала MySQL в соответствии с
инструкциями руководства MySQL.

</P>



<H4><A NAME="InnoDB_checkpoints" HREF="manual.ru_toc.html#InnoDB_checkpoints">7.5.6.1  Контрольные точки</A></H4>

<P>
В InnoDB реализован механизм контрольных точек, который получил название
нечеткой контрольной точки. В InnoDB измененные страницы базы данных
сбрасываются из буфера на диск небольшими частями. Сбрасывать содержимое
буфера одним большим пакетом нет необходимости, так как это приведет к
временной остановке обработки операторов пользователей.

</P>
<P>
В случае восстановления после сбоя InnoDB производит поиск меток
контрольных точек, записанных в файлы журналов. Известно, что все
изменения базы данных, внесенные перед меткой, уже записаны в образ базы
данных на диске. Затем InnoDB производит сканирование файлов журналов
начиная от места контрольной точки, и вносит зафиксированные изменения в
базу данных.

</P>
<P>
Запись в файлы журналов в InnoDB осуществляется по круговому методу. Все
внесенные изменения, после которых страницы базы данных в буфере начинают
отличаться от образа на диске, должны быть записаны в файлы журналов, на
случай, если InnoDB понадобится произвести восстановление. Это означает,
что когда InnoDB начинает повторно использовать файл журнала по круговому
методу, производится проверка на наличие в образах страниц базы данных на
диске изменений, зафиксированных в файле журнала, который InnoDB
собирается повторно использовать. Иначе говоря, необходимость поставить
контрольную точку зачастую приводит к тому, что InnoDB сбрасывает
измененные страницы базы данных на диск.

</P>
<P>
Из сказанного выше становится понятно, почему при больших файлах журналов
сокращается количество дисковых операций ввода/вывода при создании
контрольных точек. Иногда имеет смысл задавать общий размер файлов
журналов равным буферному пулу или даже больше. Недостатком больших файлов
журналов является то, что восстановление после сбоя может длиться дольше,
так как к базе данных придется применить больше информации из файла
журнала.

</P>


<H3><A NAME="Moving" HREF="manual.ru_toc.html#Moving">7.5.7  Перенесение базы данных InnoDB на другой компьютер</A></H3>

<P>
Файлы данных и журналов InnoDB на двоичном уровне совместимы на всех
платформах, если на компьютерах совпадает формат чисел с плавающей
десятичной запятой. Базу данных InnoDB можно перенести, просто скопировав
все относящиеся к ней файлы (список которых был приведен в предыдущем
разделе, посвященном созданию резервных копий базы данных). Если
компьютеры имеют различные форматы чисел с плавающей десятичной запятой,
но типы данных <code>FLOAT</code> или <code>DOUBLE</code> в ваших таблицах не задействованы,
последовательность действий остается точно такой же: нужно просто
скопировать все относящиеся к базе данных файлы. Если же при наличии
различных форматов в ваших таблицах содержатся данные с плавающей
десятичной запятой, то для перемещения таких таблиц необходимо
воспользоваться командами <code>mysqldump</code> и <code>mysqlimport</code>.

</P>
<P>
Чтобы увеличить скорость обработки, можно отключить автоматическую
фиксацию транзакций при импортировании в свою базу данных, исходя из
предположения, что ваша табличная область содержит достаточно пространства
для отката большого сегмента на случай генерации большой транзакции
импортирования. Фиксация производится только после импорта всей таблицы
или сегмента таблицы.

</P>


<H3><A NAME="InnoDB_transaction_model" HREF="manual.ru_toc.html#InnoDB_transaction_model">7.5.8  Транзакционная  модель InnoDB</A></H3>

<P>
Назначение транзакционной модели InnoDB заключается в том, чтобы
совместить лучшие свойства многовариантной базы данных и традиционной
двухфазной блокировки. Для таблиц InnoDB осуществляется блокировка на
уровне строки и запросы по умолчанию запускаются как целостное считывание
без блокировок, подобно тому, как это реализовано в Oracle. Хранение
таблицы блокировок InnoDB организовано настолько экономично, что нет
необходимости в расширении блокировки: обычно несколько пользователей
могут блокировать любую строку или любой набор строк в базе данных, не
занимая всю память, доступную для InnoDB.

</P>
<P>
В таблицах InnoDB все действия пользователей осуществляются при помощи
транзакций. Если в MySQL используется режим автоматической фиксации, то
для каждого оператора SQL будет создаваться отдельная транзакция. MySQL всегда
открывает новое соединение с включенным режимом автоматической фиксации.

</P>
<P>
Если режим автоматической фиксации отключен при помощи <code>SET AUTOCOMMIT = 0</code>, то мы предполагаем, что у
пользователя постоянно имеется открытая транзакция. Если он выполняет
оператор SQL <code>COMMIT</code> или <code>ROLLBACK</code>, которые завершают текущую транзакцию,
сразу же запускается новая транзакция. Оба упомянутых оператора снимают
все блокировки InnoDB, которые были установлены во время выполнения
текущей транзакции. Оператор <code>COMMIT</code> означает, что изменения, внесенные во
время выполнения текущей транзакции, принимаются и становятся видимыми
для других пользователей. Оператор <code>ROLLBACK</code> отменяет все изменения,
внесенные текущей транзакцией.

</P>
<P>
Если в соединении установлено <code>AUTOCOMMIT = 1</code>, то пользователь, тем не менее, может
использовать транзакции, начиная их с <code>BEGIN</code> и заканчивая при помощи
<code>COMMIT</code> или <code>ROLLBACK</code>.

</P>
<P>
В терминах описания уровней изоляции транзакций (SQL-1992), InnoDB по умолчанию использует
<code>REPEATABLE READ</code>. Начиная с версии 4.0.5, InnoDB предлагает все 4 уровня
изоляции описанные в стандарте SQL-1992. Вы можете установить уровень изоляции
по умолчанию для всех соединений в секции <code>[mysqld]</code> файла <tt>`my.cnf'</tt>:

</P>

<PRE>
transaction-isolation = {READ-UNCOMMITTED | READ-COMMITTED
                         | REPEATABLE-READ | SERIALIZABLE}
</PRE>

<P>
Пользователь может изменить уровень изоляции для отдельно взятой сессии или
нового соединения таким образом: 

</P>

<PRE>
SET [SESSION | GLOBAL] TRANSACTION ISOLATION LEVEL
                       {READ UNCOMMITTED | READ COMMITTED
                        | REPEATABLE READ | SERIALIZABLE}
</PRE>

<P>
Обратите внимания что названия уровней изоляции пишется без дефиса в SQL-выражении.  
Если вы указали ключевое слово <code>GLOBAL</code> в указанном выше выражении,
оно будет определять уровень изоляции для новых соединений,
но не будет иметь эффекта для старых соединений.  Любой пользователь может
изменить уровень изоляции для своей сессии, даже внутри самой транзакции.  В
версиях старше 3.23.50 <code>SET TRANSACTION</code> не оказывает эффекта на таблицы
InnoDB. В версиях старше 4.0.5 вы можете использовать только <code>REPEATABLE
READ</code> и <code>SERIALIZABLE</code>.

</P>
<P>
Вы можете получить информацию об уровне изоляции, глобальном или для текущего соединения: 

</P>

<PRE>
SELECT @@global.tx_isolation;
SELECT @@tx_isolation;
</PRE>

<P>
В блокировке уровня строки InnoDB использует так называемую блокировку
следующего ключа. Это означает, что кроме индексных записей InnoDB может также
блокирует "интервал" перед индексной записью для блокировки вставок другими
пользователями непосредственно перед индексной записью. Блокировка следующего
ключа означает блокировку, которая ставится на индексную запись и интервал перед
ней. Блокировка интервала означает только блокировку интервала перед некоторыми
индексными записями.

</P>
<P>
Подробное описание каждого уровня изоляции в InnoDB:

</P>

<UL>
<LI>

<code>READ UNCOMMITTED</code> Также называется "грязным чтением": неблокирующиеся
выборки (<code>SELECT</code>) выполняются таким образом, что мы не видим возможные ранние
версии записи; таким образом они "несогласованно" читаются в этом уровне
изоляции; в остальных случаях этот уровень работает также как и <code>READ
COMMITTED</code>.

<LI>

<code>READ COMMITTED</code> 
Нечто похожее на уровень изоляции Oracle.  Все выражения
<code>SELECT ... FOR UPDATE</code> и <code>SELECT ... LOCK IN SHARE MODE</code> блокируют
только индексные записи и не блокируют интервал перед ними. Поэтому они
позволяют свободно добавлять новые записи после заблокированных.
<code>UPDATE</code> и <code>DELETE</code>, которые используют уникальный индекс и
уникальные условия поиска, блокируют только найденную индексную запись, и не
блокируют интервал перед ней.  Но в <code>UPDATE</code> и <code>DELETE</code> диапазонного
типа в InnoDB должны установить блокировку следующего ключа или интервальную
блокировку и блокировать добавления другими пользователями в интервал, покрытый
диапазоном. Это необходимо, т.к. "фантомные строки" должны быть блокированы для
успешной работы репликации и восстановления в MySQL.  <strong>Согласованное
чтение</strong> работает как и в Oracle: каждое согласованное чтение, даже внутри одной
транзакции, устанавливает и читает свой собственный снимок.

<LI>

<code>REPEATABLE READ</code> Этот уровень изоляции используется в InnoDB по умолчанию.
<code>SELECT ... FOR UPDATE</code>, <code>SELECT ... LOCK IN SHARE MODE</code>,
<code>UPDATE</code>, и <code>DELETE</code>, которые используют уникальные индексы и
уникальное условие поиска блокируют только найденную индексную запись и не
блокируют интервал перед ней. В остальных случаях эта операция использует
блокировку следующего ключа, блокирует диапазон индексов, просканированных
блокировкой следующего ключа или интервальной, и блокирует новые добавления
другими пользователями.

В <strong>согласованном чтении</strong> есть важное отличие от предыдущего уровня изоляции: 
на этом уровне все согласованные чтения внутри той же самой транзакции читают снимок,
сделанный для первого чтения. Это соглашение означает, что если вы выполните несколько 
простых выборок (<code>SELECT</code>) внутри той же самой транзакции, эти выборки будут целостными 
по отношению к друг другу.

<LI>

<code>SERIALIZABLE</code> Этот уровень похож на предыдущий, но простые <code>SELECT</code>
преобразовываются в <code>SELECT ... LOCK IN SHARE MODE</code>.
</UL>



<H4><A NAME="InnoDB_consistent_read" HREF="manual.ru_toc.html#InnoDB_consistent_read">7.5.8.1  Согласованное чтение</A></H4>

<P>
Согласованное чтение означает, что для того, чтобы предоставить запросу
копию базы данных на текущий момент времени, используется
многовариантность таблиц InnoDB. Для запроса доступны лишь те изменения,
которые были внесены транзакциями, зафиксированными на этот момент
времени, и не доступны изменения, сделанные незафиксированными или
проведенными позже транзакциями. Исключением из данного правила могут
стать только изменения, внесенные транзакцией, направляющей текущий
запрос.

</P>
<P>
Если вы используете уровень изоляции по умолчанию <code>REPEATABLE READ</code>, то
все выборки читают снимок, сделанный первым чтением в этой транзакции. Вы
можете получить более свежую копию для своих запросов - для этого следует
зафиксировать текущую транзакцию и направить новые запросы.

</P>
<P>
Согласованное чтение является режимом по умолчанию, в котором в InnoDB
обрабатываются операторы <code>SELECT</code> при <code>READ COMMITTED</code> или
<code>REPEATABLE READ</code> уровнях изоляции. При согласованном чтении не
устанавливаются блокировки на таблицы, к которым обращается запрос, и,
таким образом, остальные пользователи могут вносить изменения в эти
таблицы одновременно с согласованным чтением таблиц.

</P>


<H4><A NAME="InnoDB_locking_reads" HREF="manual.ru_toc.html#InnoDB_locking_reads">7.5.8.2  Чтение с блокировкой</A></H4>

<P>
В некоторых случаях использовать согласованное чтение нецелесообразно.
Приведем пример. Допустим, что необходимо добавить новую строку в таблицу
<code>CHILD</code>, предварительно убедившись, что для нее имеется родительская строка
в таблице <code>PARENT</code>.

</P>
<P>
Предположим, что для чтения таблицы <code>PARENT</code> было использовано согласованное
чтение, и в таблице была обнаружена родительская строка. Можно ли теперь
безопасно добавить дочернюю строку в таблицу <code>CHILD</code>? Нет, потому что в это
время другой пользователь мог без вашего ведома удалить родительскую
строку из таблицы <code>PARENT</code>.

</P>
<P>
В данной ситуации необходимо выполнить операцию <code>SELECT</code> в режиме 
блокировки, <code>LOCK IN SHARE MODE</code>.

</P>

<PRE>
SELECT * FROM PARENT WHERE NAME = 'Jones' LOCK IN SHARE MODE;
</PRE>

<P>
Выполнение чтения в режиме совместного использования (<code>share mode</code>)
означает, что считываются самые новые доступные данные и производится
блокировка строк, чтение которых осуществляется. Если последние данные
принадлежат еще не зафиксированной транзакции, мы ждем, пока транзакция
не будет зафиксирована. Блокировка в режиме совместного использования не
позволяет другим пользователям обновить или удалить читаемую строку. После
того, как указанный выше запрос вернет родительскую строку <code>'Jones'</code>, мы
можем безопасно добавить дочернюю строку в таблицу <code>CHILD</code> и зафиксировать
транзакцию. В этом примере показано, как использовать целостность
ссылочных данных в своей программе.

</P>
<P>
Рассмотрим еще один пример. Пусть у нас есть поле целочисленного счетчика
в таблице <code>CHILD_CODES</code>, которое мы используем для назначения уникального
идентификатора каждой дочерней записи, добавляемой к таблице <code>CHILD</code>.
Очевидно, что использование согласованного чтения или чтения в режиме
совместного доступа для получения текущего значения счетчика не подходит,
так как два пользователя базы данных могут получить одно и то же значение
счетчика и создать дублирующиеся ключи при добавлении двух дочерних
записей в таблицу.

</P>
<P>
Для этого случая возможны два способа произвести чтение и увеличить
значение счетчика: (1) сначала обновить значение счетчика, увеличив его на
1, и только после этого прочитать его или (2) сначала прочитать счетчик в
режиме блокировки <code>FOR UPDATE</code>, а после этого увеличить его значение:

</P>

<PRE>
SELECT COUNTER_FIELD FROM CHILD_CODES FOR UPDATE;
UPDATE CHILD_CODES SET COUNTER_FIELD = COUNTER_FIELD + 1;
</PRE>

<P>
Оператор <code>SELECT ... FOR UPDATE</code> прочитает последние доступные данные с
установкой отдельной блокировки на каждую считываемую строку. Таким
образом, блокировка на строки устанавливается точно так же, как и в случае
поиска по <code>UPDATE</code>.

</P>


<H4><A NAME="InnoDB_Next-key_locking" HREF="manual.ru_toc.html#InnoDB_Next-key_locking">7.5.8.3  Блокировка следующего ключа: устранение проблемы с фантомом</A></H4>

<P>
При блокировке на уровне строк в InnoDB используется алгоритм, который
получил название блокировки следующего ключа. В InnoDB осуществляется
блокировка на уровне строк, поэтому на время поиска или сканирования
индекса таблицы устанавливается совместно используемая или эксклюзивная
блокировка записей обрабатываемых индексов. Таким образом, более точно
блокировку на уровне строк можно определить как блокировку индексных
записей.

</P>
<P>
Блокировка, которая в InnoDB устанавливается на индексные записи, влияет
также на интервал перед этой индексной записью. Если у пользователя
имеется совместная или эксклюзивная блокировка записи R в индексе, то
другой пользователь не может вставить новую индексную запись перед R в
порядке следования индексов. Такая блокировка интервалов производится для
предотвращения так называемой проблемы с фантомом. Предположим, что
необходимо прочитать и заблокировать все дочерние записи с
идентификатором, превышающим 100, из таблицы <code>CHILD</code>, и обновить некоторые
поля в выбранных строках.

</P>

<PRE>
SELECT * FROM CHILD WHERE ID &#62; 100 FOR UPDATE;
</PRE>

<P>
Допустим, что создан индекс таблицы <code>CHILD</code> по столбцу <code>ID</code>. Наш запрос
произведет сканирование, начиная с первой записи, в которой <code>ID</code> больше 100.
Теперь, если установленная на записи индекса блокировка не заблокирует
вставки в интервалы, за это время в таблицу может быть вставлена новая
дочерняя запись. Если теперь в транзакции запустить

</P>

<PRE>
SELECT * FROM CHILD WHERE ID &#62; 100 FOR UPDATE;
</PRE>

<P>
еще раз, то в результате запроса будет выдана новая дочерняя запись. Это
противоречит принципу изоляции транзакции: транзакция должна запускаться
таким образом, чтобы считываемые ею данные не изменялись на протяжении
выполнения транзакции. Если мы рассматриваем набор строк как элемент
данных, то новая дочерняя ``запись-фантом'' нарушит этот принцип изоляции.

</P>
<P>
Когда InnoDB сканирует индекс, то возможна также блокировка интервалов
после последних записей в индексе. Именно это иллюстрируется в предыдущем
примере: блокировка, установленная InnoDB, предотвратит вставку в таблицу,
если <code>ID</code> будет больше 100.

</P>
<P>
Блокировку следующего ключа можно использовать для того, чтобы провести
проверку уникальности значений в своей программе. Если данные считываются
в режиме совместного доступа и отсутствует дубликат строки, которую
необходимо вставить, то можно безопасно вставлять свою строку и быть
уверенным, что благодаря блокировке следующего ключа, установленной на
предшествующей строке во время чтения, будет предотвращена вставка
дублирующейся строки. Таким образом, блокировка следующего ключа позволяет
``заблокировать'' отсутствие чего-либо в таблице.

</P>


<H4><A NAME="InnoDB_Locks_set" HREF="manual.ru_toc.html#InnoDB_Locks_set">7.5.8.4  Блокировка, осуществляемая различными операторами SQL в InnoDB</A></H4>


<UL>
<LI>

<code>SELECT ... FROM ...</code>: согласованное чтение, которое производится из
образа базы данных без блокировки.
<LI>

<code>SELECT ... FROM ... LOCK IN SHARE MODE</code>: устанавливает совместно
используемую блокировку следующего ключа на все считываемые индексные
записи.
<LI>

<code>SELECT ... FROM ... FOR UPDATE</code>: устанавливает эксклюзивную блокировку
следующего ключа на все считываемые индексные записи.
<LI>

<code>INSERT INTO ... VALUES (...)</code>: устанавливает эксклюзивную блокировку
на вставленную строку. Обратите внимание, что эта блокировка не
является блокировкой следующего ключа и не предотвращает вставку
другими пользователями записей в интервал перед вставленной строкой.
Если произойдет ошибка дублирующегося ключа, оператор устанавливает
блокировку совместного доступа на запись дублирующегося индекса.
<LI>

<code>INSERT INTO T SELECT ... FROM S WHERE ...</code> устанавливает эксклюзивную
(не следующего ключа) блокировку на каждую вставляемую в <code>T</code> строку.
Осуществляет поиск по <code>S</code> как согласованное чтение, но устанавливает
блокировки совместного доступа к следующему ключу на <code>S</code>, если включено
ведение журнала MySQL. InnoDB в последнем случае должен устанавливать
блокировки, так как при восстановлении работоспособности системы с
повтором всех завершенных транзакций из резервной копии все операторы
SQL должны запускаться точно таким же образом, как и изначально.
<LI>

<code>CREATE TABLE ... SELECT ...</code> выполняет операцию <code>SELECT</code> как
согласованное чтение или совместную блокировку, как и в предыдущем
пункте.
<LI>

<code>REPLACE</code> осуществляется так же, как и вставка, если нет конфликтов
уникальных ключей. В противном случае эксклюзивная блокировка
следующего ключа будет установлена на строку, которая должна быть
обновлена.
<LI>

<code>UPDATE ... SET ... WHERE ...</code>: устанавливает эксклюзивную блокировку
следующего ключа для каждой записи, по которой производится поиск.
<LI>

<code>DELETE FROM ... WHERE ...</code>: устанавливает эксклюзивную блокировку
следующего ключа для каждой записи, по которой производится поиск.
<LI>

Если для таблицы определены ограничения <code>FOREIGN KEY</code>, для любой
вставки, обновления или удаления, для которых требуется проверка
условий ограничения, устанавливается совместная блокировка на уровне
записей, которые просматриваются для проверки ограничения. В InnoDB
эти блокировки устанавливаются также  в случае нарушения ограничения.
<LI>

<code>LOCK TABLES ...</code>: устанавливает блокировку таблицы. Эта блокировка
производится кодом уровня MySQL. Механизм автоматического обнаружения
взаимоблокировок (<code>deadlock</code>) InnoDB не может детектировать
взаимоблокировки, в которых участвуют такие блокировки таблиц (см.
следующий раздел). Кроме того, поскольку MySQL ``знает'' о блокировке
на уровне строки, возможно установление блокировки таблицы, в которой
другой пользователь заблокировал строки. Но это не опасно для
целостности транзакции. See section <A HREF="manual.ru.html#InnoDB_restrictions">7.5.13  Ограничения для таблиц InnoDB</A>.
</UL>



<H4><A NAME="InnoDB_Deadlock_detection" HREF="manual.ru_toc.html#InnoDB_Deadlock_detection">7.5.8.5  Обнаружение и откат взаимоблокировки (deadlock)</A></H4>

<P>
InnoDB автоматически обнаруживает взаимоблокировку транзакций и производит
откат транзакции или транзакций для предотвращения взаимоблокировок. 
Начиная с версии 4.0.5 InnoDB будет пытаться выбрать меньшую транзакцию для
отката. Размер транзакции определяется количеством строк, которые должны быть
добавлены, обновлены или удалены. До версии 4.0.5 InnoDB всегда откатывал
транзакцию, запрос на блокировку которой вызвал возникновение взаимоблокировки,
то есть замкнутого цикла в графике ожиданий транзакций.

</P>
<P>
InnoDB не может обнаружить взаимоблокировку, установленную оператором
MySQL <code>LOCK TABLES</code>, или блокировку, установленную отличным от InnoDB
обработчиком таблиц. Такие ситуации необходимо исправлять при помощи
параметра <code>innodb_lock_wait_timeout</code>, который задается в <tt>`my.cnf'</tt>.

</P>
<P>
Когда InnoDB выполняет полный откат транзакции, все блокировки,
установленные транзакцией, снимаются. Тем не менее, если в результате
ошибки производится откат только одного оператора SQL, некоторые
блокировки, установленные оператором, могут остаться в силе. Это
происходит потому, что InnoDB хранит блокировку строк в формате, по
которому впоследствии нельзя определить, каким оператором SQL была
установлена блокировка.

</P>


<H4><A NAME="InnoDB_Consistent_read_example" HREF="manual.ru_toc.html#InnoDB_Consistent_read_example">7.5.8.6  Пример работы согласованного чтения в InnoDB</A></H4>

<P>
Допустим, вы используете уровень изоляции, установленый по умолчанию - <code>REPEATABLE READ</code>.
При выполнении согласованного чтения (т.е. обычного оператора <code>SELECT</code>)
InnoDB определяет для транзакции момент времени, по состоянию на который
запросу будет предоставляться информация из базы данных. Таким образом,
если транзакция удаляет строку и фиксирует это изменение после
назначенного момента времени, то вы не увидите, что строка была удалена.
Это справедливо также для вставок и обновлений.

</P>
<P>
Чтобы такой момент времени ``передвинуть вперед'', нужно зафиксировать
транзакцию, а затем выполнить новую команду <code>SELECT</code>.

</P>
<P>
Это называется многовариантным контролем совпадений.

</P>

<PRE>
		 Пользователь A 	  Пользователь B

		SET AUTOCOMMIT=0;	SET AUTOCOMMIT=0;

время
| 		SELECT * FROM t;
|		пустой набор данных
|					INSERT INTO t VALUES (1, 2);
|
v 		SELECT * FROM t;
		пустой набор данных
					COMMIT;
		SELECT * FROM t;
		пустой набор данных;

		COMMIT;

		SELECT * FROM t;
		---------------------
		| 1 | 2 |
		---------------------
</PRE>

<P>
Таким образом, пользователь A увидит строку, вставленную пользователем B
только после того, как B зафиксирует вставку, и A зафиксирует свою
собственную транзакцию, чтобы момент времени передвинулся на позицию,
находящуюся после фиксации, произведенной пользователем B.

</P>
<P>
Чтобы увидеть ``самое свежее'' состояние базы данных, необходимо
использовать чтение с блокировкой:

</P>

<PRE>
SELECT * FROM t LOCK IN SHARE MODE;
</PRE>



<H4><A NAME="Innodb_deadlocks" HREF="manual.ru_toc.html#Innodb_deadlocks">7.5.8.7  Каким образом избежать взаимоблокировок (deadlock)?</A></H4>

<P>
Взаимоблокировки - классическая проблема транзакционных баз данных. Они не
опасны до тех пор пока не становятся настолько частыми, что вы вообще не можете
запустить некоторые транзакции. Обычно вы можете написать свои
приложения таким образом, что они всегда будут подготавливать перезапуск
транзакции, если произошел откат из-за взаимоблокировок.

</P>
<P>
InnoDB использует автоматическую блокировку уровня строки. Вы можете создать
взаимоблокировку даже в случае транзакций, которые всего лишь добавляют или
удаляют единичную строку. Это происходит из-за того, что в действительности эти
операции не являются "атомарными": они автоматически устанавливают блокировку
на индексные записи добавляемых/удаляемых строк (или на несколько записей).

</P>
<P>
Вы можете избежать взаимоблокировок или уменьшить их количество, следуя следующим приемам:

</P>

<UL>
<LI>

Используйте <code>SHOW INNODB STATUS</code> в MySQL начиная с 3.23.52 и 4.0.3 для
определения причины последней взаимоблокировки. Это поможет вам настроить ваше
приложение, что бы избежать взаимоблокировок.
<LI>

Всегда подготавливайте перезапуск транзакции, если произошел откат из-за
взаимоблокировки. Взаимоблокировка не опасна: всего лишь попробуйте еще раз.
<LI>

Чаще фиксируйте свои транзакии. Маленькие транзакции меньше склонны к противоречиям.
<LI>

Если вы используете чтение с блокировкой <code>SELECT ... FOR UPDATE</code> или
<code>... LOCK IN SHARE MODE</code>, попробуйте использовать более низкий уровень
изоляции <code>READ COMMITTED</code>.
<LI>

Производите операции с вашими таблицам и строками в фиксированном порядке. Тогда
транзакции будут формировать очередь и не будет происходить взаимоблокировка.
<LI>

Добавьте хорошие индексы на ваши таблицы. Тогда ваши запросы будут сканировать
меньше индексных записей и, соответственно, будут устанавливать меньше
блокировок. Используйте <code>EXPLAIN SELECT</code> для того, чтобы узнать, выбирает
ли MySQL соответствующий индекс для ваших запросов.
<LI>

Используйте меньше блокировок: если вы можете допустить, чтобы <code>SELECT</code>
возвращал данные из старого снимка, не добавляйте к выражению <code>FOR UPDATE</code>
или <code>LOCK IN SHARE MODE</code>. Используйте уровень изоляции <code>READ
COMMITTED</code>, который больше всего подходит для данной ситуации, так как каждое
согласованное чтение внутри одной и той же транзакции читает свой собственный
свежий снимок.

<LI>

Если ничего не помогло, сериализируйте свои транзакции с блокировкой уровня
таблиц: <code>LOCK TABLES t1 WRITE, t2 READ, ... ; [здесь можете развлекаться 
с таблицами t1 и t2]; UNLOCK TABLES</code>. Блокировка на уровне таблиц выстраивает ваши
транзакции в очередь, и позволяет избежать взаимоблокировки. Заметьте, что
<code>LOCK TABLES</code> неявным образом начинает транзакцию наподобие <code>BEGIN</code>,
и <code>UNLOCK TABLES</code> неявным образом завершает ее в <code>COMMIT</code>.
<LI>

Другое решение для сериализации транзакций - это создание вспомагательного
"семафора" таблицы, где есть всего лишь одна строка. Каждая транзакция обновляет
эту строку перед доступом к другой таблице. В этом случае все транзакции
выполняются в виде очереди. Отметим что таким же образом в настоящий момент
работает и алгоритм определения взаимоблокировок в InnoDB, так как блокировка
сериализации - это блокировка уровня строки. При блокировке на уровне таблицы в
MySQL мы используем метод таймаута для разрешения взаимоблокировки.
</UL>

<P>
  

</P>


<H4><A NAME="Innodb_tuning" HREF="manual.ru_toc.html#Innodb_tuning">7.5.8.8  Рекомендации по увеличению производительности</A></H4>

<P>
<strong>1.</strong>
Если top операционной системы Unix или Task Manager Windows показывают
процент рабочей нагрузки процессора меньше 70%, это значит, что объем
рабочей нагрузки в основном сводится к обращениям к диску. Возможно,
слишком часто производится фиксация транзакций, или буферный пул слишком
мал. Здесь может помочь увеличение размера буферного пула, но не следует
устанавливать его значение большим, чем 80% физической памяти.

</P>
<P>
<strong>2.</strong>
Несколько изменений следует вносить за одну транзакцию. InnoDB должен
сбрасывать журнал на диск после каждой фиксации транзакции, если эта
транзакция вносит изменения в базу данных. Поскольку скорость вращения
диска обычно не превышает 167 оборотов в секунду, то количество фиксаций
ограничено 167 фиксациями в секунду, если, конечно, диск не обманывает
операционную систему.

</P>
<P>
<strong>3.</strong>
Если вы можете позволить себе потерять последние зафиксированные
транзакции, установите параметр <code>innodb_flush_log_at_trx_commit</code> в файле
<tt>`my.cnf'</tt> в нулевое значение. Так или иначе InnoDB пытается сохранить журнал
ежесекундно, и в этом случае сохранение не гарантируется.

</P>
<P>
<strong>4.</strong>
Увеличьте размеры файлов журналов, доведите их даже до размера
буферного пула. Когда InnoDB заполняет файлы журналов, он должен сохранить
измененное содержимое буферного пула на диск в виде моментального снимка
базы. Маленькие журналы будут вызывать множество ненужных записей на диск.
Есть и оборотная сторона медали - если файлы журналов большие, то время
восстановления транзакций (в случае сбоя) будет больше.

</P>
<P>
<strong>5.</strong>
Кроме того, буфер журнала должен быть достаточно большим, например 8
Мб.

</P>
<P>
<strong>6.</strong>
(Актуально для версии 3.23.39 и выше.) В некоторых версиях операционных
систем Linux и Unix запись файлов на диск при помощи команды Unix
<code>fdatasync</code> и других подобных методов производится на удивление медленно.
Принятый по умолчанию метод InnoDB использует функцию <code>fdatasync</code>. Если
скорость записи базы данных вас не устраивает, можно попробовать для
параметра <code>innodb_flush_method</code> в файле <tt>`my.cnf'</tt> задать значение <code>O_DSYNC</code>, хотя
на многих системах <code>O_DSYNC</code> обычно работает медленнее.

</P>
<P>
<strong>7.</strong>
При импортировании данных в InnoDB убедитесь что в MySQL не установлено
значение <code>autocommit=1</code>. Если оно установлено, то каждая вставка требует
сохранения журналов на диске. Поместите прямо в начале вашего файла с
данными:

</P>

<PRE>
SET AUTOCOMMIT=0;
</PRE>

<P>
и в конце

</P>

<PRE>
COMMIT;
</PRE>

<P>
Если используется параметр mysqldump  --opt, то вы получите файлы, которые
достаточно быстро импортируются в InnoDB, даже если их не окружить
вышеуказанными командами <code>SET AUTOCOMMIT=0; ... COMMIT;</code>.

</P>
<P>
<strong>8.</strong>
Осторожно относитесь к значительным откатам больших вставок InnoDB
использует буфер вставок для того, чтобы меньше ``дергать'' диск на
вставках, однако для соответствующего отката транзакции такой механизм не
предусмотрен.. Ограниченный производительностью диска откат может занять в
30 раз больше времени, чем вставка. Удаление процесса базы данных не
поможет, так как откат начнется снова после запуска базы данных.
Единственный способ избежать такого отката - это увеличить буферный пул
настолько, что откат станет зависеть только от производительности
процессора, перестанет ``равняться'' по диску и отработается быстро. Есть
еще один способ - это удаление базы данных InnoDB целиком.

</P>
<P>
<strong>9.</strong>
Следует также осторожно относиться к операциям со значительными
объемами данных, зависящим от производительности диска. Чтобы очистить
таблицу, используйте команды <code>DROP TABLE</code> или <code>TRUNCATE</code> (начиная с версии
MySQL-4.0 и выше), а не <code>DELETE FROM yourtable</code>.

</P>
<P>
<strong>10.</strong>
Используйте множественные вставки для уменьшения нагрузки на
коммуникации между клиентом и сервером, если вам нужно вставить множество
записей:

</P>

<PRE>
INSERT INTO yourtable VALUES (1, 2), (5, 5);
</PRE>

<P>
Эта рекомендация подходит для вставок в таблицы любого типа, а не только
InnoDB.

</P>


<H4><A NAME="Innodb_Monitor" HREF="manual.ru_toc.html#Innodb_Monitor">7.5.8.9  InnoDB Monitor</A></H4>

<P>
Начиная с версии 3.23.41 в состав InnoDB входит InnoDB Monitor, который
выводит информацию по внутреннему состоянию InnoDB. Когда InnoDB Monitor
включен, сервер MySQL <code>mysqld</code> выводит стандартный набор данных (обратите
внимание: клиент MySQL ничего не выводит) примерно каждые 15 секунд. Эти
данные могут пригодиться при настройке производительности. В операционной
системе Windows необходимо запустить <code>mysqld-max</code> из командной строки MS-DOS
с параметрами <code>--standalone --console</code>, чтобы направить выводимые данные в
окно MS-DOS.

</P>
<P>
Существует отдельная функция <code>innodb_lock_monitor</code>, которая выводит такую же
информацию как <code>innodb_monitor</code>, а также данные по блокировкам,
установленным каждой транзакцией.

</P>
<P>
Выводящаяся информация включает следующие данные:

<UL>
<LI>

по блокировкам, ожидающим транзакций;
<LI>

по семафорам, ожидающим потоков;
<LI>

по файлам, ожидающим ответа на запрос ввода/вывода;
<LI>

статистику  буферного пула;
<LI>

по активности буферов удаления и вставок в основном потоке InnoDB.
</UL>

<P>
InnoDB Monitor можно запустить при помощи следующей команды SQL:

</P>

<PRE>
CREATE TABLE innodb_monitor(a int) type = innodb;
</PRE>

<P>
а остановить его при помощи:

</P>

<PRE>
DROP TABLE innodb_monitor;
</PRE>

<P>
Вызов  команды <code>CREATE TABLE</code> является только способом передачи команды в
InnoDB через программу синтаксического анализа SQL. Факт создания таблицы
не играет никакой роли для InnoDB Monitor. Если вы останавливаете сервер,
когда монитор работает, и хотите запустить монитор заново, следует
уничтожить таблицу прежде, чем снова вызвать <code>CREATE TABLE</code> для запуска
монитора. Синтаксис может измениться в будущих версиях.

</P>
<P>
Пример информации, выводимой InnoDB Monitor:

</P>

<PRE>
================================
010809 18:45:06 INNODB MONITOR OUTPUT
================================
--------------------------
LOCKS HELD BY TRANSACTIONS
--------------------------
LOCK INFO:
Number of locks in the record hash table 1294
LOCKS FOR TRANSACTION ID 0 579342744
TABLE LOCK table test/mytable trx id 0 582333343 lock_mode IX
RECORD LOCKS space id 0 page no 12758 n bits 104 table test/mytable index
PRIMARY trx id 0 582333343 lock_mode X
Record lock, heap no 2 PHYSICAL RECORD: n_fields 74; 1-byte offs FALSE;
info bits 0
0: len 4; hex 0001a801; asc ;; 1: len 6; hex 000022b5b39f; asc ";;
2: len 7; hex 000002001e03ec; asc ;; 3: len 4; hex 00000001;
...
-----------------------------------------------
CURRENT SEMAPHORES RESERVED AND SEMAPHORE WAITS
-----------------------------------------------
SYNC INFO:
Sorry, cannot give mutex list info in non-debug version!
Sorry, cannot give rw-lock list info in non-debug version!
-----------------------------------------------------
SYNC ARRAY INFO: reservation count 6041054, signal count 2913432
4a239430 waited for by thread 49627477 op. S-LOCK file NOT KNOWN line 0
Mut ex 0 sp 5530989 r 62038708 sys 2155035;
rws 0 8257574 8025336; rwx 0 1121090 1848344
-----------------------------------------------------
CURRENT PENDING FILE I/O'S
--------------------------
Pending normal aio reads:
Reserved slot, messages 40157658 4a4a40b8
Reserved slot, messages 40157658 4a477e28
...
Reserved slot, messages 40157658 4a4424a8
Reserved slot, messages 40157658 4a39ea38
Total of 36 reserved aio slots
Pending aio writes:
Total of 0 reserved aio slots
Pending insert buffer aio reads:
Total of 0 reserved aio slots
Pending log writes or reads:
Reserved slot, messages 40158c98 40157f98
Total of 1 reserved aio slots
Pending synchronous reads or writes:
Total of 0 reserved aio slots
-----------
BUFFER POOL
-----------
LRU list length 8034
Free list length 0
Flush list length 999
Buffer pool size in pages 8192
Pending reads 39
Pending writes: LRU 0, flush list 0, single page 0
Pages read 31383918, created 51310, written 2985115
----------------------------
END OF INNODB MONITOR OUTPUT
============================
010809 18:45:22 InnoDB starts purge
010809 18:45:22 InnoDB purged 0 pages
</PRE>

<P>
Некоторые примечания по выводу:

</P>

<UL>
<LI>

Если раздел <code>LOCKS HELD BY TRANSACTIONS</code> содержит информацию по
ожидаемым блокировкам, то у вашей программы может быть конфликт
блокировок. Выводимая информация также может оказать помощь в
отслеживании причин возникновения взаимных блокировок.
<LI>

Если InnoDB скомпилировать при помощи <code>UNIV_SYNC_DEBUG</code>  в <tt>`univ.i'</tt>, то 
раздел <code>SYNC INFO</code> будет содержать информацию по зарезервированным
семафорам.
<LI>

Раздел <code>SYNC ARRAY INFO</code> содержит информацию по потокам, ожидающим
семафора, а также статистические данные по количеству повторных циклов
или ожиданий, выполненных потоками для семафоров или блокировок
чтения/записи. Большое количество потоков, ожидающих семафоров, может
возникнуть в результате частого выполнения операций ввода/вывода
диска, оно может быть также обусловлено конфликтами внутри самого
InnoDB. Конфликты могут возникать при большом количестве параллельных
запросов или в случае проблем операционной системы с планированием
потоков.
<LI>

В разделе <code>CURRENT PENDING FILE I/O'S</code> выводится список файлов,
ожидающих ответа на запрос ввода/вывода. Большое количество таких
файлов говорит о том, что рабочая нагрузка ограничена операциями
ввода/вывода диска.
<LI>

Раздел <code>BUFFER POOL</code> содержит статистическую информацию по записываемым
и считываемым страницам. По этим данным можно вычислить, сколько
запросов ввода/вывода по файлам данных выполняется на данный момент.
</UL>



<H3><A NAME="Implementation" HREF="manual.ru_toc.html#Implementation">7.5.9  Реализация многовариантности</A></H3>

<P>
Поскольку InnoDB является многовариантной базой данных, информация по
старым версиям строк в ней хранится в табличной области. Эта информация
содержится в структуре данных, которую мы по аналогии со структурой данных
в Oracle называем сегментом отката.

</P>
<P>
К каждому внутреннему представлению строки таблицы, хранящейся в базе
данных InnoDB, добавляется по два поля. В 6-байтовом поле хранится
идентификатор последней транзакции, которая производила вставку или
обновление строки. Удаление рассматривается как обновление, при котором
специальный бит удаления строки помечается соответствующим образом. Помимо
этого, каждая строка содержит также 7-байтовое поле, которое называется
указателем отката. Указатель отката указывает на запись журнала отмены,
занесенную в сегмент отката. Если строка была обновлена, запись журнала
отмены содержит необходимую информацию для восстановления содержимого
строки до обновления.

</P>
<P>
Информация из сегмента отката в базе данных InnoDB используется для того,
чтобы произвести отмену, необходимую для отката транзакции, а также для
создания предыдущих версий строки для согласованного чтения.

</P>
<P>
Журналы отмены в сегменте отката разделяются на журналы вставки и журналы
обновления. Журналы отмены вставки необходимы только для отката транзакций
и могут быть удалены сразу после фиксации транзакции. Журналы отмены
обновления используются для согласованного чтения, и их можно удалять
только после того, как не останется транзакций, для которых в InnoDB
определена копия, создающая при согласованном чтении раннюю версию строки
по информации из журнала отмены обновления.

</P>
<P>
Не забывайте регулярно фиксировать свои транзакции, включая транзакции,
использующие согласованное чтение. В противном случае InnoDB не сможет
удалить данные из журналов отмены обновления, что приведет к разрастанию
сегмента отката, который может занять всю вашу табличную область.

</P>
<P>
Физический размер записи журнала отмены в сегменте отката обычно меньше,
чем соответствующая вставка или обновленная строка. Эту информацию можно
использовать для вычисления размера пространства, необходимого для
сегмента отката.

</P>
<P>
В нашей многовариантной схеме строка физически не удаляется из базы данных
немедленно после удаления ее при помощи оператора SQL. Только после того,
как InnoDB сможет удалить запись журнала отмены обновления, занесенную для
удаления, соответствующая строка и ее индексная запись из базы данных
могут быть физически удалены. Эта операция удаления называется чисткой.
Она производится достаточно быстро - на нее уходит столько же времени, как
и на выполнение оператора удаления SQL.

</P>


<H3><A NAME="Table_and_index" HREF="manual.ru_toc.html#Table_and_index">7.5.10  Структуры таблиц и индексов</A></H3>

<P>
В MySQL информация словаря данных таблиц хранится в файлах <tt>`.frm'</tt>,
расположенных в каталогах баз данных. Но для каждой таблицы InnoDB имеются
также свои записи во внутренних словарях данных InnoDB в табличной
области. Когда MySQL удаляет таблицу или базу данных, необходимо удалить
как файлы <tt>`.frm'</tt>, так и соответствующие записи в словаре данных InnoDB.
Именно поэтому нельзя перемещать таблицы InnoDB между базами данных путем
простого перемещения файлов <tt>`.frm'</tt>. По этой же причине <code>DROP DATABASE</code> не
работал для таблиц InnoDB в MySQL версий &#60;= 3.23.43.

</P>
<P>
Для всех таблиц InnoDB есть специальный индекс, в котором хранятся данные
строк - он называется кластеризованным индексом. Если в таблице определить
<code>PRIMARY KEY</code>, то индекс первичного ключа будет кластеризированным индексом.

</P>
<P>
Если первичный ключ для таблицы не определен, то InnoDB самостоятельно
создаст кластеризированный индекс; строки в этом индексе будут упорядочены
по идентификатору строки, который InnoDB назначил строкам этой таблицы.
Идентификатор строки представляет собой 6-байтовое поле, значение которого
постоянно увеличивается при вставке новых строк. Таким образом, сортировка
по идентификатору строки фактически представляет собой сортировку по
последовательности вставки.

</P>
<P>
Доступ к строке через кластеризированный индекс осуществляется достаточно
быстро, поскольку данные строки находятся на той же странице, к которой
приводит поиск по индексу. Во многих базах данных информация и индексная
запись традиционно хранятся на разных страницах. При больших размерах
таблицы архитектура кластеризированных индексов часто позволяет сократить
количество дисковых операций ввода/вывода по сравнению с традиционными
решениями.

</P>
<P>
Записи в некластеризированных индексах (мы называем их также вторичными
индексами), в InnoDB содержат значение первичного ключа для строки. InnoDB
использует этот значение первичного ключа для поиска строки в
кластеризированном индексе. Следует учитывать, что если первичный ключ
достаточно велик, вторичные индексы будут занимать больше места.

</P>



<H4><A NAME="InnoDB_physical_structure" HREF="manual.ru_toc.html#InnoDB_physical_structure">7.5.10.1  Физическая структура индекса</A></H4>

<P>
Все индексы в InnoDB представляют собой B-деревья, в которых записи
индексов хранятся в страницах ответвления дерева. По умолчанию размер
индексной страницы составляет 16 Кб. При вставке новых записей InnoDB
старается оставить 1 / 16 страницы свободной - для будущих вставок и
обновлений индексных записей.

</P>
<P>
Если записи индекса вставлены в последовательном порядке (в порядке
возрастания или убывания), то получившиеся индексные страницы будут
заполнены примерно на 15/16. Для записей, которые вставляются в случайном
порядке, эти значения составят от 1/2 до 15/16. Если коэффициент
заполнения индексной страницы уменьшится и станет ниже 1/2, InnoDB
попытается объединить записи индексного дерева, чтобы освободить страницу.

</P>


<H4><A NAME="InnoDB_Insert_buffering" HREF="manual.ru_toc.html#InnoDB_Insert_buffering">7.5.10.2  Буферизация вставок</A></H4>

<P>
Нередко в программах для работы с базами данных первичный ключ является
уникальным идентификатором и новые строки вставляются в порядке
возрастания первичного ключа. Таким образом, вставки в кластеризированный
индекс не требуют проведения случайных считываний с диска.

</P>
<P>
Что же касается вторичных индексов, то они, напротив, обычно не являются
уникальными, так что вставки во вторичные индексы производятся в
относительно случайном порядке. Это приводит к выполнению большого
количества случайных дисковых операций ввода/вывода диска, если не
используется специальный механизм, применяемый в InnoDB.

</P>
<P>
Если требуется вставить запись индекса во вторичный индекс, который не
является уникальным, InnoDB проверяет, находится ли страница вторичного
индекса в буферном пуле. Если она там есть, InnoDB произведет вставку
непосредственно в страницу индекса. Но если страница индекса не найдена в
буферном пуле, InnoDB вставляет запись в специальную структуру буфера
вставок. Буфер вставок настолько мал, что полностью помещается в буферный
пул, и вставки в него могут производиться очень быстро.

</P>
<P>
Буфер вставок периодически объединяется с деревьями вторичных индексов в
базе данных. Часто, объединив несколько вставок на одной странице
индексного дерева, можно за счет этого сократить количество операций
ввода/вывода диска. Использование буфера вставки может ускорить вставку в
таблицу в 15 раз.

</P>


<H4><A NAME="InnoDB_Adaptive_hash" HREF="manual.ru_toc.html#InnoDB_Adaptive_hash">7.5.10.3  Адаптивный хешированный индекс</A></H4>

<P>
Если база данных почти полностью помещается в основной памяти, то самым
быстрым способом выполнения запросов по этой базе данных является
использование хешированных индексов. В InnoDB существует автоматический
механизм, который отслеживает поиск по индексу, осуществляемый по
индексам, определенным для таблицы, и если InnoDB посчитает, что запросы
выиграют от создания хешированного индекса, такой индекс будет создан
автоматически.

</P>
<P>
Но следует учитывать, что хешированный индекс всегда создается на основе
существующего индекса B-дерева таблицы. InnoDB может создать хешированный
индекс на префиксах любой длины ключа, определенного для B-дерева, в
зависимости от того, по какой схеме поиска InnoDB производит обзор индекса
the B-дерева. Хешированный индекс может быть частичным: не обязательно
кэшировать в буферном пуле весь индекс B-дерева. InnoDB будет создавать
хешированные индексы по запросу для тех страниц индекса, к которым часто
производится доступ.

</P>
<P>
Хотя механизм адаптивного хешированного индекса InnoDB приспосабливается к
большому количеству основной памяти, он больше подходит для архитектуры
баз данных основной памяти.

</P>


<H4><A NAME="InnoDB_Physical_record" HREF="manual.ru_toc.html#InnoDB_Physical_record">7.5.10.4  Физическая структура записи</A></H4>


<UL>
<LI>

У всех записей индекса в InnoDB есть заголовок, состоящий из 6 байтов.
Заголовок используется для связывания вместе последовательных записей,
а также при блокировке на уровне строк.
<LI>

Записи в кластеризированном индексе содержат поля для всех столбцов,
определенных пользователем. Кроме того, имеется 6-байтовое поле для
идентификатора транзакции и 7-байтовое поле для указателя строки.
<LI>

Если пользователь не определил для таблицы первичный ключ, то в каждой
записи кластеризированного индекса также содержится 6-байтовое поле
идентификатора строки.
<LI>

Все записи вторичного индекса содержат также все поля, определенные
для ключа кластеризированного индекса.
<LI>

Запись также содержит указатель на каждое поле записи. Если общая
длина полей в записи меньше 128 байтов, то размер указателя будет 1
байт, в противном случае - 2 байта.
</UL>



<H4><A NAME="SEC481" HREF="manual.ru_toc.html#SEC481">7.5.10.5  Как работают автоинкрементные столбцы в InnoDB</A></H4>

<P>
Когда пользователь после запуска базы данных осуществляет первую вставку в
таблицу T, где определен автоинкрементный столбец, и пользователь не
предоставляет конкретного значения для этого столбца, InnoDB выполняет
<code>SELECT MAX(auto-inc-column) FROM T</code>, затем присваивает это значение,
увеличенное на единицу, столбцу, и автоматически увеличивает счетчик
таблицы. Эту последовательность действий мы называем инициализацией
счетчика автоматического увеличения для таблицы <code>T</code>.

</P>
<P>
Ту же последовательность действий InnoDB выполняет и для инициализации
автоинкрементного счетчика вновь созданной таблицы.

</P>
<P>
Обратите внимание: если пользователь указывает при вставке значение
автоинкрементного столбца 0, то InnoDB обрабатывает строку так, как
будто значение не было указано.

</P>
<P>
Если после инициализации автоматического увеличения счетчика пользователь
вставляет строку, в которой он явно указывает значение столбца, и это
значение превышает текущее значение счетчика, то счетчик устанавливается в
указанное значение столбца. Если пользователь явно не указывает значение,
то InnoDB увеличивает счетчик на единицу и присваивает столбцу это новое
значение.

</P>
<P>
При присвоении значений из счетчика механизм автоматического увеличения
обходит блокировку и управление транзакциями. Вследствие этого могут
возникнуть пропуски в последовательности чисел в случае, если производится
откат транзакций, которые получили номера из счетчика.

</P>
<P>
Для случаев, когда пользователь присваивает столбцу отрицательное значение
или если значение превысит максимальное целое число, которое может
храниться в переменной целочисленного типа, поведение механизма
механического увеличения не определено.

</P>


<H3><A NAME="File_space_management" HREF="manual.ru_toc.html#File_space_management">7.5.11  Управление файловым пространством и дисковый ввод/вывод</A></H3>



<H4><A NAME="InnoDB_Disk_I_O" HREF="manual.ru_toc.html#InnoDB_Disk_I_O">7.5.11.1  Дисковый ввод/вывод</A></H4>

<P>
В операциях дискового ввода/вывода для таблиц InnoDB используется
асинхронный ввод/вывод. В Windows NT применяется собственный асинхронный
ввод/вывод, обеспечиваемый операционной системой, а в Unix - эмуляция
асинхронного ввода/вывода, встроенная в InnoDB (InnoDB создает
определенное количество потоков ввода/вывода, чтобы обеспечить операции
ввода/вывода, такие как опережающее считывание). В будущей версии мы
добавим поддержку эмуляции асинхронного ввода/вывода в Windows NT и
собственного асинхронного ввода/вывода в тех версиях Unix, в которых он
есть.

</P>
<P>
В Windows NT для таблиц InnoDB используется ввод/вывод без буферизации.
Это означает, что страницы на диске, которые записывает или считывает
InnoDB, не заносятся в файловый кэш операционной системы. При этом
экономится некоторое количество памяти.

</P>
<P>
Начиная с версии 3.23.41 в InnoDB используется новая техника сбрасывания
файлов на диск, которая получила название двойной записи. Она обеспечивает
большую безопасность при восстановлении после сбоев (таких как, например,
зависание операционной системы или отключение питания) и повышение
производительности на большинстве версий Unix, так как снижается
необходимость в операциях fsync.

</P>
<P>
``Двойная запись'' означает, что InnoDB перед записью страниц в файл данных
сначала записывает их в смежный участок табличной области, который
называется буфером двойной записи. Запись страниц в предназначенные для
них места файла данных осуществляется только после завершения записи и
сброса буфера двойной записи на диск. В случае сбоя системы во время
записи страницы InnoDB во время восстановления найдет в буфере двойной
записи пригодную копию страницы.

</P>
<P>
Начиная с версии 3.23.41 в качестве файла данных можно также использовать
раздел реального диска, хотя тестирование этой возможности еще не
проводилось. При создании нового файла данных в <code>innodb_data_file_path</code>
сразу после размера файла данных необходимо ввести ключевое слово newraw.
Раздел диска должен быть больше указанного размера или равен ему. Обратите
внимание: 1  Мб в InnoDB -это 1024 x 1024 байт, тогда как в
характеристиках диска 1 Мб обычно соответствует 1000 000 байт.

</P>

<PRE>
innodb_data_file_path=hdd1:5Gnewraw;hdd2:2Gnewraw
</PRE>

<P>
При новом запуске базы данных Вы <strong>должны</strong> изменить ключевое слово на <code>raw</code>. В
противном случае InnoDB перезапишет ваш раздел!

</P>

<PRE>
innodb_data_file_path=hdd1:5Graw;hdd2:2Graw
</PRE>

<P>
Используя реальный диск, в некоторых версиях Unix можно производить
небуферизованные операции ввода/вывода.

</P>
<P>
В InnoDB существует два эвристических метода опережающего считывания:
последовательное опережающее считывание и случайное опережающее
считывание. Метод последовательного опережающего считывания
предусматривает, что InnoDB, определив, что схема доступа к сегменту в
табличной области является последовательной, будет заранее направлять
системе ввода/вывода пакет считываний страниц базы данных. Метод
случайного опережающего считывания предполагает, что InnoDB, определив,
что некоторые части табличной области полностью считываются в буферный
пул, направляет оставшиеся считывания системе ввода/вывода.

</P>


<H4><A NAME="InnoDB_File_space" HREF="manual.ru_toc.html#InnoDB_File_space">7.5.11.2  Управление файловым пространством</A></H4>

<P>
Табличную область InnoDB составляют файлы данных, определенные в файле
конфигурации. Файлы  используются  последовательно, распределения  данных
(striping ) по  ним  не  производится. На данный момент вы не можете
непосредственно указать, где должны быть размещены таблицы. Можно только
воспользоваться знанием того факта, что для вновь созданной табличной
области InnoDB будет распределяться  место с начала памяти.

</P>
<P>
Табличная область состоит из страниц базы данных, принятый по умолчанию
размер которых составляет 16 Кб. Эти страницы сгруппированы в блоки по 64
последовательных страницы. 'Файлы' внутри табличной области в InnoDB
называются сегментами. Название 'сегмент отката' несколько не
соответствует действительности, так как фактически в нем содержится много
сегментов табличной области.

</P>
<P>
Для каждого индекса в InnoDB выделяется два сегмента: один - для конечных
узлов B-дерева, а другой - для остальных узлов. Идея заключается в том,
чтобы получить лучшее координирование конечных узлов, в которых содержатся
данные.

</P>
<P>
Когда сегмент внутри табличной области возрастает, InnoDB выделяет первые
32 специально для этого сегмента. После этого InnoDB начинает выделять
целые области для этого сегмента. Чтобы обеспечить хорошее координирование
данных, InnoDB может единовременно добавить к большому сегменту до 4
областей,.

</P>
<P>
Некоторые страницы табличной области содержат битовые образы других
страниц, поэтому несколько областей в табличной области InnoDB могут быть
выделены не для целого сегмента, а только для отдельных страниц.

</P>
<P>
Когда вы запускаете запрос <code>SHOW TABLE STATUS FROM ... LIKE ...</code> для
получения информации по доступному свободному пространству табличной
области, InnoDB предоставит данные по свободным областям табличной
области. InnoDB всегда резервирует области для очистки и других внутренних
операций. Зарезервированные области не включаются в объем свободного
пространства.

</P>
<P>
Если из таблицы удаляются данные, InnoDB объединяет соответствующие
индексы B-дерева. В зависимости от схемы удалений, когда освобождаются
отдельные страницы или области табличной области, это пространство
становится доступным для других пользователей. Удаление таблицы или
удаление всех ее строк гарантированно освободит пространство для других
пользователей, но не следует забывать, что физически строки удаляются
только после проведения чистки, после чего они больше не нужны при откате
транзакций или согласованном чтении.

</P>


<H4><A NAME="InnoDB_File_Defragmenting" HREF="manual.ru_toc.html#InnoDB_File_Defragmenting">7.5.11.3  Дефрагментация  таблицы</A></H4>

<P>
Если в индексной таблице производились случайные вставки или удаления,
индекс может стать фрагментированным. Под фрагментацией мы подразумеваем
то, что физическое расположение индексных страниц на диске значительно
отличается от алфавитного порядка страниц, или что в 64-страничных блоках
много пустых страниц, которые занесены в индекс.

</P>
<P>
Скорость сканирования индекса может возрасти, если периодически
использовать команду mysqldump для копирования дампа таблицы в текстовый
файл, записи диска на диск и повторного считывания таблицы из дампа. Есть
еще один способ произвести дефрагментацию - преобразовать таблицу при
помощи команды <code>ALTER</code> в тип <code>MyISAM</code>, а затем обратно в тип InnoDB. Обратите
внимание на то, что таблица типа <code>MyISAM</code> должна помещаться в один файл в
вашей операционной системе.

</P>
<P>
Если вставки в индекс всегда производятся последовательно, а удаления -
только с конца, то алгоритм управления файловым пространством InnoDB
гарантирует, что фрагментации индекса не возникнет.

</P>


<H3><A NAME="InnoDB_Error_handling" HREF="manual.ru_toc.html#InnoDB_Error_handling">7.5.12  Обработка ошибок</A></H3>

<P>
Обработка ошибок в InnoDB не всегда соответствует спецификациям, указанным
в стандарте ANSI SQL. В соответствии со стандартом ANSI любая ошибка,
произошедшая во время выполнения оператора SQL должна привести к откату
оператора. InnoDB иногда осуществляет откат только части оператора или
целой транзакции. Особенности обработки ошибок в InnoDB указаны в
приведенном ниже списке.

</P>

<UL>
<LI>

Если закончилось свободное место в табличной области, будет выдано
сообщение об ошибке MySQL <code>'Table is full'</code> и InnoDB произведет откат
оператора SQL.
<LI>

Взаимоблокировка транзакции или истечение времени ожидания при
блокировке приводят к откату целой транзакции в InnoDB.
<LI>

Ошибка дублирующегося ключа приводит к откату вставки только этой
определенной строки, даже в операторе <code>INSERT INTO ... SELECT ...</code>. Этот
алгоритм мы, возможно, изменим, с тем чтобы производился откат всего
оператора SQL, если для него не указан параметр <code>IGNORE</code>.
<LI>

Ошибка <code>'row too long'</code> приводит к откату оператора SQL.
<LI>

Большинство остальных ошибок обнаруживается на уровне кода MySQL, и
производится откат соответствующего оператора SQL.
</UL>



<H3><A NAME="InnoDB_restrictions" HREF="manual.ru_toc.html#InnoDB_restrictions">7.5.13  Ограничения для таблиц InnoDB</A></H3>


<UL>

<LI>

Предупреждение: <strong>НЕЛЬЗЯ</strong> преобразовывать системные таблицы MySQL из
формата MyISAM в формат InnoDB! Эта операция не поддерживается, и если
попытаться ее осуществить, MySQL не перезапустится, пока не будут
восстановлены старые системные таблицы из резервной копии, или пока не
будут созданы новые таблицы при помощи скрипта <code>mysql_install_db</code>.

<LI>

Команда <code>SHOW TABLE STATUS</code> не выдает точных статистических данных по
таблицам InnoDB, за исключением размера физического пространства,
зарезервированного для таблицы. Подсчет строк производится
приблизительно  так, как в оптимизации SQL.

<LI>

Если попытаться создать уникальный индекс на префиксе столбца, то
будет выдана ошибка:


<PRE>
CREATE TABLE T (A CHAR(20), B INT, UNIQUE (A(5))) TYPE = InnoDB;
</PRE>

Если на префиксе столбца создать неуникальный индекс, InnoDB создаст
индекс по всему столбцу.
<LI>

Для таблиц InnoDB не поддерживается команда <code>INSERT DELAYED</code>.
<LI>

Операция MySQL <code>LOCK TABLES</code> не знает про блокировки InnoDB на уровне
строк в уже выполненном операторе SQL: это означает, что можно
установить блокировку на таблицу, даже если существуют транзакции
других пользователей, которые установили блокировку этой же таблицы на
уровне строк. Таким образом, может оказаться, что ваши операции над
таблицей будут вынуждены ожидать, если такая блокировка будет
установлена другими пользователями: возможна также и взаимоблокировка.
Тем не менее, это не угрожает целостности транзакций, так как при
установке блокировки на таблицы InnoDB всегда соблюдается целостность.
Кроме того, блокировка таблицы не позволяет другим транзакциям
установить на таблицу дополнительные блокировки на уровне строки (в
режиме несовместимости блокировок).
<LI>

Нельзя установить ключ для столбцов типа <code>BLOB</code> или <code>TEXT</code>.
<LI>

Таблица не может содержать больше 1000 столбцов.
<LI>

Команда <code>DELETE FROM TABLE</code> не пересоздает таблицу, она удаляет все
строки по одной, что осуществляется не очень быстро. В будущих версиях
MySQL можно будет использовать команду <code>TRUNCATE</code>, которая намного
быстрее.
<LI>

Принятый по умолчанию размер страницы в InnoDB составляет 16  Кб.
Повторно скомпилировав код, можно установить значение от 8 Кб до 64
Кб. В версиях &#60;= 3.23.40 InnoDB максимальная длина строки несколько
меньше половины размера страницы базы данных. Начиная с релиза
исходного кода версии 3.23.41 столбцы типов <code>BLOB</code> и <code>TEXT</code> могут
достигать 4 Гб, общая длина строк также не должна превышать 4 Гб.
Поля с размером меньше или равным 128 байтам в InnoDB не хранятся на
отдельных страницах. После того как InnoDB изменит строку, сохранив
длинные поля на отдельных страницах, оставшаяся длина строки должна
быть меньше половины страницы базы данных. Максимальная длина ключа -
7000 байтов.
<LI>

В некоторых операционных системах файлы данных не должны превышать 2
Гб. Общий размер файлов журналов должен быть меньше 4 Гб.
<LI>

Максимальный размер табличной области составляет 4 миллиарда страниц
базы данных. Это также максимальный размер таблицы. Минимальный размер
табличной области составляет 10 Мб.
</UL>



<H3><A NAME="InnoDB_change_history" HREF="manual.ru_toc.html#InnoDB_change_history">7.5.14  История изменений InnoDB</A></H3>

<P>
Раздел в переводе.

</P>


<H3><A NAME="InnoDB_contact_information" HREF="manual.ru_toc.html#InnoDB_contact_information">7.5.15  Контактная информация для получения данных по InnoDB</A></H3>

<P>
Контактная информация компании Innobase Oy, которая создала модель InnoDB:
веб-сайт: <a HREF="http://www.innodb.com/">http://www.innodb.com/</a>, e-mail: <a HREF="mailto:Heikki.Tuuri@innodb.com">Heikki.Tuuri@innodb.com</a> 

</P>

<PRE>
Телефон: 358-9-6969 3250 (офис) 358-40-5617367 (мобильный)
Innobase Oy Inc.
World Trade Center Helsinki
Aleksanterinkatu 17
P.O.Box 800
00101 Helsinki
Finland
</PRE>



<H2><A NAME="BDB" HREF="manual.ru_toc.html#BDB">7.6  Таблицы <code>BDB</code> или BerkeleyDB</A></H2>

<P>
<A NAME="IDX1493"></A>
<A NAME="IDX1494"></A>

</P>



<H3><A NAME="BDB_overview" HREF="manual.ru_toc.html#BDB_overview">7.6.1  Обзор таблиц <code>BDB</code></A></H3>

<P>
Поддержка таблиц <code>BDB</code> включена в дистрибутив исходного кода MySQL начиная с
версии 3.23.34 и в бинарную версию MySQL-Max.

</P>
<P>
BerkeleyDB, доступный на веб-сайте <a HREF="http://www.sleepycat.com/">http://www.sleepycat.com/</a>, обеспечивает
транзакционный обработчик таблиц для MySQL. 

</P>
<P>
Использование BerkeleyDB
повышает для ваших таблиц шансы уцелеть после сбоев, а также предоставляет
возможность осуществлять операции <code>COMMIT</code> и <code>ROLLBACK</code> для транзакций.
Дистрибутив исходного кода MySQL поставляется с дистрибутивом <code>BDB</code>,
содержащим несколько небольших исправлений, которые позволяют устранить
определенные проблемы при работе с MySQL. Неисправленные версии <code>BDB</code> при
работе с MySQL использовать нельзя.

</P>
<P>
В целях поддержания высокого уровня и качества интерфейса MySQL/BDB
компания MySQL AB тесно сотрудничает с компанией Sleepycat.

</P>
<P>
Что касается поддержки таблиц <code>BDB</code>, то мы взяли на себя обязательство
оказывать помощь нашим пользователям в выявлении проблем и создании
воспроизводимых контрольных примеров для любых ошибок, возникающих при
использовании таблиц <code>BDB</code>. Все такие контрольные примеры направляются в
компанию Sleepycat, которая, в свою очередь, помогает нам выявлять и
исправлять ошибки. Поскольку эта операция состоит из двух этапов, решение
проблем с таблицами <code>BDB</code> может отнять у нас больше времени, чем устранение
ошибок других обработчиков таблиц. Тем не менее, поскольку помимо MySQL
код BerkeleyDB использовался с большим количеством других приложений, мы
не думаем, что с ним возникнут серьезные проблемы (see section <A HREF="manual.ru.html#Business_Services_Support">1.5.1.1  Поддержка</A>).

</P>


<H3><A NAME="BDB_install" HREF="manual.ru_toc.html#BDB_install">7.6.2  Установка <code>BDB</code></A></H3>

<P>
Если вы загрузили бинарную версию MySQL, которая включает поддержку
BerkeleyDB, просто выполните инструкции по установке бинарной версии MySQL
(см. разделы section <A HREF="manual.ru.html#Installing_binary">2.2.10  Установка бинарного дистрибутива MySQL</A> и see section <A HREF="manual.ru.html#mysqld-max">4.7.5  <code>mysqld-max</code>, расширенный сервер <code>mysqld</code></A>).

</P>
<P>
Чтобы произвести компиляцию MySQL с поддержкой Berkeley DB, загрузите
MySQL версии 3.23.34 или выше и выполните настройку MySQL при помощи
параметра <code>--with-berkeley-db</code> (see section <A HREF="manual.ru.html#Installing_source">2.3  Установка исходного дистрибутива MySQL</A>).

</P>

<PRE>
cd /path/to/source/of/mysql-3.23.34
./configure --with-berkeley-db
</PRE>

<P>
Чтобы получить самую последнюю информацию, обращайтесь к руководству,
которое поставляется с дистрибутивом BDB.

</P>
<P>
Хотя Berkeley DB детально протестирован и надежен, BDB-интерфейс MySQL
пока еще является бета-версией. Мы совершенствуем и оптимизируем его,
чтобы в скором времени добиться стабильной работы.

</P>


<H3><A NAME="BDB_start" HREF="manual.ru_toc.html#BDB_start">7.6.3  Параметры запуска <code>BDB</code></A></H3>

<P>
Если запуск производился с параметром <code>AUTOCOMMIT=0</code>, то изменения,
сделанные в в таблицах BDB, не вносятся, пока не будет выполнена команда
<code>COMMIT</code>. Кроме операции фиксации, можно запустить команду <code>ROLLBACK</code>, чтобы
отменить изменения (see section <A HREF="manual.ru.html#COMMIT">6.7.1  Синтаксис команд <code>BEGIN/COMMIT/ROLLBACK</code></A>).

</P>
<P>
Если вы работаете с параметром <code>AUTOCOMMIT=1</code> (значение по умолчанию),
внесенные изменения будут фиксироваться немедленно. Можно выполнить
расширенную транзакцию при помощи команды SQL <code>BEGIN WORK</code>, после которой
изменения не будут зафиксированы до запуска команды <code>COMMIT</code> (или будут
отменены при помощи команды <code>ROLLBACK</code>).

</P>
<P>
Чтобы изменить параметры таблиц <code>BDB</code>, можно воспользоваться следующими
опциями <code>mysqld</code>:

</P>
<TABLE BORDER>
<TR><TD><strong>Параметр</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD><code>--bdb-home=directory</code> </TD><TD> Базовый каталог для таблиц <code>BDB</code>.  Это должен быть тот же каталог, что и для <code>--datadir</code>.
</TD></TR>
<TR><TD><code>--bdb-lock-detect=#</code> </TD><TD> Обнаружение блокировки Berkeley; одно из значений: <code>DEFAULT</code>, <code>OLDEST</code>, <code>RANDOM</code> или <code>YOUNGEST</code>
</TD></TR>
<TR><TD><code>--bdb-logdir=directory</code> </TD><TD> Каталог файла журнала Berkeley DB
</TD></TR>
<TR><TD><code>--bdb-no-sync</code> </TD><TD> Отмена синхронной записи журналов на диск
</TD></TR>
<TR><TD><code>--bdb-no-recover</code> </TD><TD> Отмена запуска Berkeley DB в режиме восстановления
</TD></TR>
<TR><TD><code>--bdb-shared-data</code> </TD><TD> Запуск Berkeley DB в режиме параллельной обработки (при инициализации Berkeley DB не следует использовать <code>DB_PRIVATE</code>)
</TD></TR>
<TR><TD><code>--bdb-tmpdir=directory</code> </TD><TD> Имя временной директории Berkeley DB
</TD></TR>
<TR><TD><code>--skip-bdb</code> </TD><TD> Отмена использования таблиц <code>BDB</code>
</TD></TR>
<TR><TD><code>-O bdb_max_lock=1000</code> </TD><TD> Задает максимальное количество возможных блокировок (see section <A HREF="manual.ru.html#SHOW_VARIABLES">4.5.6.4  <code>SHOW VARIABLES</code></A>).
</TD></TR>
</TABLE>

<P>
Если используется параметр <code>--skip-bdb</code>, MySQL не будет инициализировать
библиотеку Berkeley DB, что позволит сэкономить большое количество памяти.
Разумеется, после включения этого параметра нельзя пользоваться таблицами
BDB. если вы попытаетесь создать таблицу <code>BDB</code>, то в этом случае MySQL
будет создавать таблицу <code>MyISAM</code>.

</P>
<P>
Обычно если предполагается использовать таблицы <code>BDB</code>, следует запускать
<code>mysqld</code> без параметра <code>--bdb-no-recover</code>. Однако если файлы журналов <code>BDB</code>
повреждены, то при попытке запуска mysqld могут возникнуть проблемы (see section <A HREF="manual.ru.html#Starting_server">2.4.2  Проблемы при запуске сервера MySQL</A>).

</P>
<P>
При помощи параметра <code>bdb_max_lock</code> задается максимальное количество
блокировок (10000 по умолчанию), которые могут быть установлены на таблицу
<code>BDB</code>. Это значение необходимо увеличить, если возникают ошибки <code>bdb: Lock
table is out of available locks или Got error 12 from ...</code> при проведении
длинных транзакций или когда <code>mysqld</code> должен просмотреть много строк, чтобы
произвести необходимые вычисления для запроса.

</P>
<P>
Можно также изменить <code>binlog_cache_size</code> и <code>max_binlog_cache_size</code>, если
используются большие многострочные транзакции (see section <A HREF="manual.ru.html#COMMIT">6.7.1  Синтаксис команд <code>BEGIN/COMMIT/ROLLBACK</code></A>).

</P>


<H3><A NAME="BDB_characteristics" HREF="manual.ru_toc.html#BDB_characteristics">7.6.4  Характеристики таблиц <code>BDB</code></A></H3>


<UL>
<LI>

Чтобы обеспечить возможность отката транзакций, для таблиц BDB
поддерживается ведение файлов журналов. Для достижения максимальной
производительности эти файлы необходимо разместить на разных с базой
данных дисках, воспользовавшись параметром <code>--bdb-logdir</code>.
<LI>

Каждый раз, когда создается новый файл журнала <code>BDB</code>, MySQL
устанавливает контрольные точки и удаляет все файлы журналов, которые
не нужны для текущих транзакций. Можно также в любое время запустить
команду <code>FLUSH LOGS</code>, чтобы установить контрольную точку для таблиц
Berkeley DB. Чтобы произвести восстановление после сбоя, необходимо
воспользоваться резервными копиями таблицы, а также бинарным журналом
MySQL (see section <A HREF="manual.ru.html#Backup">4.4.1  Резервное копирование баз данных</A>). Предупреждение: если удалить
используемые старые файлы журналов, BDB не сможет осуществить
восстановление, и в случае сбоя вы можете потерять данные.
<LI>

В MySQL все таблицы <code>BDB</code> должны иметь  первичные ключи, чтобы
обеспечить возможность обращаться к ранее считанным строкам. Если
первичный ключ не создан, MySQL создаст его и будет поддерживать
скрытый первичный ключ. Длина скрытого ключа составляет 5 байтов, а 
его значение увеличивается при каждой попытке вставки.
<LI>

Если все столбцы, к которым производится обращение в таблице <code>BDB</code>,
являются частью одного индекса или одного первичного ключа, то MySQL
может выполнить запрос, не обращаясь к самой строке. Для таблиц <code>MyISAM</code>
это справедливо только если столбцы являются частью одного индекса.
<LI>

Первичный ключ обеспечивает более быструю обработку, чем любой другой
ключ, так как он хранится вместе с данными строки. Поскольку остальные
ключи хранятся как данные ключа + <code>PRIMARY KEY</code>, очень важно иметь как
можно более короткие первичные ключи, чтобы сэкономить дисковое
пространство и увеличить производительность.
<LI>

Команда <code>LOCK TABLES</code> работает с таблицами <code>BDB</code> точно так же, как и с
другими таблицами. Если команда <code>LOCK TABLE</code> не используется, MySQL
устанавливает на таблицу внутреннюю множественную блокировку записи,
чтобы обеспечить правильную блокировку, если другой поток установит
блокировку таблицы.
<LI>

Внутренняя блокировка в таблицах <code>BDB</code> осуществляется на уровне страниц.
<LI>

Команда <code>SELECT COUNT(*) FROM table_name</code> выполняется медленно, так как
для таблиц <code>BDB</code> не поддерживается подсчет количества строк в таблице.
<LI>

Сканирование осуществляется медленнее, чем в таблицах <code>MyISAM</code>, так как
данные в таблицах <code>BDB</code> хранятся в B-деревьях, а не в отдельных файлах
данных.
<LI>

Приложение всегда должно быть готово к обработке ситуаций, в которых
любые изменения таблицы <code>BDB</code> могут привести к автоматическому откату и
любое считывание может вызвать сбой из-за возникновения
взаимоблокировки.
<LI>

Ключи не являются пакованными как в <code>MyISAM</code>. 
Иначе говоря, информация по ключам в таблицах BDB
займет несколько больше места по сравнению с таблицами <code>MyISAM</code>.
<LI>

В таблице <code>BDB</code> всегда имеются промежутки, благодаря чему можно
вставлять новые строки в середину дерева ключа. Из-за этого таблицы
<code>BDB</code> несколько больше, чем таблицы <code>MyISAM</code>.
<LI>

Оптимизатору необходимо знать приблизительное количество строк в
таблице. В MySQL этот вопрос решается путем подсчета количества
вставок и поддержки этой информации в отдельном сегменте каждой
таблицы <code>BDB</code>. Если операторов <code>DELETE</code> или <code>ROLLBACK</code> выполнялось не
слишком много, это количество должно быть достаточно точным для
оптимизатора MySQL, но MySQL сохраняет это число только при закрытии,
и оно в случае аварийного завершения работы MySQL может оказаться
неверным. Если число не соответствует действительности на 100% -
ничего страшного в этом нет. Количество строк можно обновить, запустив
команду <code>ANALYZE TABLE</code> или <code>OPTIMIZE TABLE</code> 
(см. разделы section <A HREF="manual.ru.html#ANALYZE_TABLE">4.5.2  Синтаксис команды <code>ANALYZE TABLE</code></A> и see section <A HREF="manual.ru.html#OPTIMIZE_TABLE">4.5.1  Синтаксис  команды <code>OPTIMIZE TABLE</code></A>).
<LI>

Если таблица <code>BDB</code> займет все пространство на диске, то будет выведено
сообщение об ошибке (возможно, ошибка 28) и выполнен откат транзакции. В
отличие от <code>BDB</code>, таблицы <code>MyISAM</code> и <code>ISAM</code> в <code>mysqld</code> будут ожидать, пока не
появится свободное место, а потом продолжат работу.
</UL>



<H3><A NAME="BDB_TODO" HREF="manual.ru_toc.html#BDB_TODO">7.6.5  Что нам нужно исправить в <code>BDB</code> в ближайшем будущем:</A></H3>


<UL>
<LI>

Процесс одновременного открытия многих таблиц <code>BDB</code> производится очень
медленно. Если вы собираетесь применять таблицы <code>BDB</code>, не следует
создавать очень большой кэш таблицы (например, больше 256  Кб) и
необходимо использовать параметр <code>--no-auto-rehash</code> для клиента <code>mysql</code>.
Мы планируем частично исправить это в версии 4.0.
<LI>

Команда <code>SHOW TABLE STATUS</code> еще не предоставляет достаточного количества
информации по таблицам <code>BDB</code>.
<LI>

Оптимизация производительности.
<LI>

Переход на запрет использования блокировок при сканировании таблиц.
</UL>



<H3><A NAME="BDB_portability" HREF="manual.ru_toc.html#BDB_portability">7.6.6  Операционные системы, поддерживаемые <code>BDB</code></A></H3>

<P>
На данный момент нам известно, что таблицы <code>BDB</code> работают со следующими
операционными системами.

</P>

<UL>
<LI>

Linux 2.x Intel
<LI>

Solaris SPARC
<LI>

Caldera (SCO) OpenServer
<LI>

Caldera (SCO) UnixWare 7.0.1
</UL>

<P>
И не работают со следующими:

</P>

<UL>
<LI>

Linux 2.x Alpha
<LI>

Max OS X
</UL>

<P>
Этот список неполон. Мы будем обновлять его по мере поступления свежей информации. 

</P>
<P>
Если вы собираете MySQL с поддержкой таблиц BDB и получаете вот такую ошибку в 
файле журнала при запуске <code>mysqld</code>: 

</P>

<PRE>
bdb: architecture lacks fast mutexes: applications cannot be threaded
Can't init dtabases
</PRE>

<P>
То это означает, что таблицы BDB не поддерживаются на вашей платформе. В этом
случае вам следует пересобрать MySQL без поддержки таблиц BDB.

</P>


<H3><A NAME="BDB_restrictions" HREF="manual.ru_toc.html#BDB_restrictions">7.6.7  Ограничения таблиц <code>BDB</code></A></H3>

<P>
Ниже приведены ограничения при использовании таблиц <code>BDB</code>:

</P>

<UL>
<LI>

Таблицы <code>BDB</code> хранятся в файле <tt>`.db'</tt>, который находится в том же каталоге,
где был создан (это сделано для того, чтобы была возможность
обнаруживать блокировки в многопользовательской среде с поддержкой
символических ссылок).

Но вследствие этого таблицы <code>BDB</code> нельзя
перемещать между каталогами!

<LI>

При создании резервных копий таблиц <code>BDB</code> необходимо использовать <code>mysqldump</code>
или создать резервные копии всех файлов <tt>`table_name.db'</tt> и файлов журналов
<code>BDB</code>. Файлы журналов <code>BDB</code> - это файлы в базовом каталоге донных с именами
<tt>`log.XXXXXX'</tt> (6 цифр). Обработчик таблицы <code>BDB</code> хранит незавершенные
транзакции в файлах журналов; их наличие требуется при запуске <code>mysqld</code>.
</UL>



<H3><A NAME="BDB_errors" HREF="manual.ru_toc.html#BDB_errors">7.6.8  Ошибки, которые могут возникнуть при использовании таблиц <code>BDB</code></A></H3>


<UL>
<LI>

Если в <tt>`hostname.err log'</tt> при запуске <code>mysqld</code> возникла следующая ошибка:


<PRE>
bdb: Ignoring log file: .../log.XXXXXXXXXX: unsupported log version #
</PRE>

это означает, что новая версия <code>BDB</code> не поддерживает старый формат файлов
журналов. В этом случае необходимо удалить все файлы журналов <code>BDB</code> из
каталога своей базы данных (файлы формата <tt>`log.XXXXXXXXXX'</tt> ) и перезапустить
<code>mysqld</code>. Мы  также  рекомендуем  сохранить  содержимое <code>BDB</code>-баз  данных  в 
файл  путем  вызова <code>mysqldump --opt</code>, удалить  старые  файлы  таблиц  и 
восстановить  базы  данных  из  сохраненного  файла.
<LI>

Если запуск производится не в режиме <code>auto_commit</code> и происходит удаление
таблицы, которая используется другим потоком, в файле ошибок MySQL
могут появится следующие записи:


<PRE>
001119 23:43:56 bdb: Missing log fileid entry
001119 23:43:56 bdb: txn_abort: Log undo failed for LSN:
1 3644744: Invalid
</PRE>

Это не смертельно, но мы не рекомендуем удалять таблицы, если вы не
находитесь в режиме <code>auto_commit</code>, пока эта проблема не будет решена (а
решить ее вовсе не просто).
</UL>



<H1><A NAME="Clients" HREF="manual.ru_toc.html#Clients">8  Интерфейсы для MySQL</A></H1>

<P>
<A NAME="IDX1495"></A>
<A NAME="IDX1496"></A>
<A NAME="IDX1497"></A>
<A NAME="IDX1498"></A>
<A NAME="IDX1499"></A>
<A NAME="IDX1500"></A>

</P>

<P>
Эта глава описывает доступные для MySQL интерфейсы, а также разъясняет,
где их можно получить и как их использовать. Интерфейс C API охвачен
наиболее широко, так как он был разработан командой MySQL и является базой
для большинства других интерфейсов.

</P>


<H2><A NAME="PHP" HREF="manual.ru_toc.html#PHP">8.1  Интерфейс PHP  API для MySQL</A></H2>

<P>
<A NAME="IDX1501"></A>
<A NAME="IDX1502"></A>

</P>
<P>
PHP представляет собой серверный язык программирования скриптов со
встраиваемым кодом HTML, который может использоваться для создания
динамических веб-страниц. Он содержит поддержку для доступа к нескольким
базам данных, включая MySQL. PHP может запускаться как отдельная программа
или компилироваться как модуль для использования с веб-сервером Apache.

</P>
<P>
Дистрибутив и документацию можно найти на веб-сайте PHP
(<a HREF="http://www.php.net/">http://www.php.net/</a>).

</P>



<H3><A NAME="PHP_problems" HREF="manual.ru_toc.html#PHP_problems">8.1.1  Общие проблемы MySQL и PHP</A></H3>


<UL>
<LI>Ошибка: "Максимальное время исполнения превышено" ("Maximum Execution

Time Exceeded"). Это ограничение PHP; откройте файл <tt>`php3.ini'</tt> и
измените максимальное время исполнения с 30 секунд на более высокую
величину, такую, какая вам необходима. Есть еще один неплохой способ -
удвоить разрешенный объем оперативной памяти с 8 Мб до 16 Мб на
скрипт.

<LI>Ошибка: "Неисправимая ошибка: Вызов неподдерживаемой или

неопределенной функции mysql_connect() в .." ("Fatal error: Call to
unsupported or undefined function mysql_connect() in ..") Это
означает, что ваша версия PHP не скомпилирована с поддержкой MySQL.
Можно либо скомпилировать динамический модуль MySQL и загрузить его в
PHP, либо перекомпилировать PHP со встроенной поддержкой MySQL. Это
подробно описывается в руководстве по PHP.

<LI>Ошибка: "неопределенная ссылка на `uncompress' (несжатый) "

("undefined reference to `uncompress'"). Это означает, что данная
клиентская библиотека скомпилирована с поддержкой сжатого
клиент-серверного протокола. Устранение этой проблемы заключается в
добавлении <code>-lz</code> в конце при линковании с <code>-lmysqlclient</code>.
</UL>



<H2><A NAME="Perl" HREF="manual.ru_toc.html#Perl">8.2  Интерфейс Perl  API для MySQL</A></H2>

<P>
<A NAME="IDX1503"></A>

</P>
<P>
Этот раздел снабжает документами для работы с интерфейсом Perl <code>DBI</code>. Более
ранний интерфейс назывался <code>mysqlperl</code>. В настоящее время интерфейс <code>DBI</code>/<code>DBD</code>
является рекомендуемым интерфейсом Perl, так что <code>mysqlperl</code> здесь не
документируется как устаревший.

</P>



<H3><A NAME="DBI_with_DBD" HREF="manual.ru_toc.html#DBI_with_DBD">8.2.1  <code>DBI</code> с помощью <code>DBD::mysql</code></A></H3>

<P>
<A NAME="IDX1504"></A>

</P>
<P>
<code>DBI</code> представляет собой общий интерфейс для многих баз данных. Это
означает, что можно написать скрипт, работающий со многими различными
процессорами баз данных без изменения. При этом для каждого типа базы
данных необходим определенный драйвер (DBD - это абревиатура DataBase 
Driver). Для MySQL этот драйвер называется <code>DBD::mysql</code>.

</P>
<P>
Для более подробной информации об интерфейсе Perl5 DBI, пожалуйста,
посетите веб-страницу <code>DBI</code> и прочитайте документацию:

<PRE>
<a HREF="http://dbi.perl.org/">http://dbi.perl.org/</a> 
</PRE>

<P>
Для более подробной информации об объектно ориентированном
программировании (OOП), описанном в Perl5, смотрите веб-страницу Perl 
OOP:

<PRE>
<a HREF="http://language.perl.com/info/documentation.html">http://language.perl.com/info/documentation.html</a> 
</PRE>

<P>
Следует учитывать, что, если вы хотите использовать транзакции с Perl, то
необходимо иметь модуль <code>Msql-Mysql-modules</code> версии 1.2216 или новее.

</P>
<P>
Рекомендуемый модуль для Perl: <code>DBD-mysql-2.1022</code> или новее.

</P>
<P>
Инструкции по установке поддержки Perl в MySQL даются в разделе See section <A HREF="manual.ru.html#Perl_support">2.7  Замечания по установке Perl</A>.

</P>
<P>
Если у вас уже установлены модули MySQL, то вы можете найти информацию о
специфике функциональности MySQL при помощи одной из следующих команд:

</P>

<PRE>
shell&#62; perldoc DBD/mysql
shell&#62; perldoc mysql
</PRE>



<H3><A NAME="Perl_DBI_Class" HREF="manual.ru_toc.html#Perl_DBI_Class">8.2.2  Интерфейс <code>DBI</code></A></H3>

<P>
<A NAME="IDX1505"></A>

</P>
<P>
<strong>Унифицированные методы DBI</strong>
 
<TABLE BORDER>
<TR><TD><strong>Метод</strong> </TD><TD> <strong>Описание</strong>

</TD></TR>
<TR><TD><code>connect</code> </TD><TD> Создает соединение с сервером
</TD></TR>
<TR><TD><code>disconnect</code> </TD><TD> Разрывает соединение с сервером
</TD></TR>
<TR><TD><code>prepare</code> </TD><TD> Готовит SQL-запрос к выполнению
</TD></TR>
<TR><TD><code>execute</code> </TD><TD> Выполняет приготовленный запрос
</TD></TR>
<TR><TD><code>do</code> </TD><TD> Готовит и выполняет запрос
</TD></TR>
<TR><TD><code>quote</code> </TD><TD> Заключает в символы цитирования строки или <code>BLOB</code>-значения, которые вы собираетесь внести
</TD></TR>
<TR><TD><code>fetchrow_array</code> </TD><TD> Возвращает следующую запись как массив
</TD></TR>
<TR><TD><code>fetchrow_arrayref</code> </TD><TD> Возвращает следующую запись как ссылку на массив
</TD></TR>
<TR><TD><code>fetchrow_hashref</code> </TD><TD> Возвращает следующую запись как ссылку на хеш
</TD></TR>
<TR><TD><code>fetchall_arrayref</code> </TD><TD> Возвращает всю информацию как массив массивов
</TD></TR>
<TR><TD><code>finish</code> </TD><TD> Завершает выражение и освобождает системные ресурсы
</TD></TR>
<TR><TD><code>rows</code> </TD><TD> Возвращает количество измененных/удаленных строк
</TD></TR>
<TR><TD><code>data_sources</code> </TD><TD> Возвращает массив, список баз данных, доступных на сервере
</TD></TR>
<TR><TD><code>ChopBlanks</code> </TD><TD> Определяет, будут ли методы <code>fetchrow_*</code> убирать начальные и оконечные пробелы
</TD></TR>
<TR><TD><code>NUM_OF_PARAMS</code> </TD><TD> Количество символов-заполнителей в приготовленном выражении
</TD></TR>
<TR><TD><code>NULLABLE</code> </TD><TD> Возвращает ссылку на массив значений, которые определяют, могут ли столбцы содержать значения <code>NULL</code>. Возможные значения для каждого элемента массива: 0 или пустая строка, если столбец не может быть <code>NULL</code>, 1 - если может, и 2, если статус <code>NULL</code> для столбца неизвестен
</TD></TR>
<TR><TD><code>trace</code> </TD><TD> Производит трассировку для отладки
</TD></TR>
</TABLE>

</P>
<P>
<strong>Методы, определенные только для MySQL</strong>

</P>
<TABLE BORDER>
<TR><TD><strong>Метод</strong> </TD><TD> <strong>Описание</strong>

</TD></TR>
<TR><TD><code>insrtid</code> </TD><TD> Значение <code>AUTO_INCREMENT</code>, которое было присвоено последним
</TD></TR>
<TR><TD><code>is_blob</code> </TD><TD> Какие столбцы имеют тип <code>BLOB</code>
</TD></TR>
<TR><TD><code>is_key</code> </TD><TD> Какие столбцы являются ключами
</TD></TR>
<TR><TD><code>is_num</code> </TD><TD> Какие столбцы имеют числовой тип
</TD></TR>
<TR><TD><code>is_pri_key</code> </TD><TD> Какие столбцы являются первичными ключами
</TD></TR>
<TR><TD><code>is_not_null</code> </TD><TD> Столбцы, которые НЕ МОГУТ иметь значение <code>NULL</code>. См. <code>NULLABLE</code>
</TD></TR>
<TR><TD><code>length</code> </TD><TD> Максимально допустимые размеры содержимого столбцов
</TD></TR>
<TR><TD><code>max_length</code> </TD><TD> Максимальные размеры столбцов, присутствующих в результате
</TD></TR>
<TR><TD><code>NAME</code> </TD><TD> Имена столбцов
</TD></TR>
<TR><TD><code>NUM_OF_FIELDS</code> </TD><TD> Количество полей, возвращенных в результате операции
</TD></TR>
<TR><TD><code>table</code> </TD><TD> Имена таблиц в результате
</TD></TR>
<TR><TD><code>type</code> </TD><TD> Типы всех столбцов
</TD></TR>
</TABLE>

<P>
Более детально методы Perl DBI описаны в следующих разделах. Возвращаемые
переменные:
<DL COMPACT>

<DT><code>$dbh</code>
<DD>
Дескриптор базы данных

<DT><code>$sth</code>
<DD>
Дескриптор выражения

<DT><code>$rc</code>
<DD>
Код возврата (часто статус)

<DT><code>$rv</code>
<DD>
Возвращенное значение (часто количество строк)
</DL>

<P>
<strong>Унифицированные методы DBI</strong>

</P>
<P>
<A NAME="IDX1506"></A>
<A NAME="IDX1507"></A>
<DL COMPACT>

<DT><code>connect($data_source, $username, $password)</code>
<DD>
Метод <code>connect</code> используется для подсоединения к источнику данных
(СУБД). Строка <code>$data_source</code> должна начинаться с <code>DBI:имя драйвера:</code>. Примеры
вызова connect с драйвером <code>DBD::mysql</code>:

<PRE>
$dbh = DBI-&#62;connect("DBI:mysql:$database", $user, $password);
$dbh = DBI-&#62;connect("DBI:mysql:$database:$hostname", $user,
		$password);
$dbh = DBI-&#62;connect("DBI:mysql:$database:$hostname:$port", $user,
		$password);
</PRE>

Если не определены имя пользователя либо пароль, <code>DBI</code> использует
значения переменных окружения <code>DBI_USER</code> и <code>DBI_PASS</code>. Если не указано имя
хоста, используется значение по умолчанию - <code>localhost</code>. Если не указан
номер порта, также используется   значение по умолчанию (3306).

Начиная с <code>Msql-Mysql-modules</code> версии 1.2009, доступны следующие модификаторы
<code>$data_source</code>:

<DL COMPACT>

<DT><code>mysql_read_default_file=file_name</code>
<DD>
Читать файл <tt>`file_name'</tt> как файл настроек. За более подробной
информацией о файлах настройки обращайтесь к разделу See section <A HREF="manual.ru.html#Option_files">4.1.2  Файлы параметров <tt>`my.cnf'</tt></A>.

<DT><code>mysql_read_default_group=group_name</code>
<DD>
По умолчанию используется группа <code>[client]</code> файла настроек. Опцией
<code>mysql_read_default_group</code>, группа по умолчанию устанавливается в
<code>[group_name]</code>.

<DT><code>mysql_compression=1</code>
<DD>
Использовать сжатие при обмене клиента и сервера (MySQL версий
3.22.3 и выше).

<DT><code>mysql_socket=/path/to/socket</code>
<DD>
Указывает путь к Unix-сокету, который будет использоваться для
соединения с сервером. (MySQL версии 3.21.15 и более поздние).
</DL>

Можно указывать не один модификатор, а несколько; при этом каждый
должен предваряться точкой с запятой.

Например, если вы не хотите явно
указывать имя пользователя и пароль в программе, использующей <code>DBI</code>, можно
внести эту информацию в файл <tt>`~/.my.cnf'</tt>, написав вызов <code>connect</code>. Это
делается следующим образом:

<PRE>
$dbh = DBI -&#62; connect("DBI:mysql:$database",
		  ";mysql_read_default_file=$ENV{HOME}/.my.cnf",
  		  $user, $password);
</PRE>

Данный пример считает настройки из группы <code>[client]</code> файла <tt>`~/.my.cnf'</tt>.
Чтобы выполнить те же действия, но с настройками, взятыми из группы
<code>[perl]</code>, нужно использовать следующую форму записи:

<PRE>
$dbh = DBI -&#62; connect("DBI:mysql:$database",
		  ";mysql_read_default_file=$ENV{HOME}/.my.cnf"
		  . ";mysql_read_default_group=perl",
		  $user, $password);
</PRE>

<A NAME="IDX1508"></A>
<A NAME="IDX1509"></A>
<DT><code>disconnect</code>
<DD>
Метод disconnect разрывает соединение с базой данных. Это стоит делать
перед выходом из программы.
Пример:

<PRE>
$rc = $dbh-&#62;disconnect;
</PRE>

<A NAME="IDX1510"></A>
<A NAME="IDX1511"></A>

<DT><code>prepare($statement)</code>
<DD>
Подготавливает SQL-запрос <code>$statement</code> к исполнению сервером. Возвращает
дескриптор  выражения (<code>$sth</code>), который затем используется для вызова метода
<code>execute</code>. Обычно работа с запросами типа <code>SELECT</code> (так же, как и
аналогичными, такими как <code>SHOW</code>, <code>DESCRIBE</code>, <code>EXPLAIN</code>) сводится к вызову
методов <code>prepare</code> и <code>execute</code>.
Пример:

<PRE>
$sth = $dbh -&#62; prepare($statement)
or die "Не  могу  подготовить $statement: $dbh -&#62; errstr\n";
</PRE>

Если вы хотите считывать большие результаты вашим клиентом, вы можете указать
использование <code>mysql_use_result()</code> в Perl:


<PRE>
my $sth = $dbh-&#62;prepare($statement { "mysql_use_result" =&#62; 1});
</PRE>

<A NAME="IDX1512"></A>
<A NAME="IDX1513"></A>
<DT><code>execute</code>
<DD>
Метод <code>execute</code> выполняет приготовленный запрос. Если запрос не <code>SELECT</code>,
метод возвращает количество строк, которые были подверглись воздействию
запроса. Если таковых нет, <code>execute</code> возвращает <code>"0E0"</code>, что Perl
интерпретирует как нуль, но воспринимает как значение ``истина'' (true).
Если возникает ошибка, execute возвращает <code>undef</code>. Для запросов SELECT метод
только инициирует выполнение запроса SQL-сервером и для получения данных
необходимо использовать один из методов <code>fetch_*</code>.
Пример:

<PRE>
$rv = $sth -&#62; execute or die "Не могу выполнить: $sth -&#62; errstr";
</PRE>

<A NAME="IDX1514"></A>
<A NAME="IDX1515"></A>
<DT><code>do($statement)</code>
<DD>
Метод <code>do</code> готовит SQL-запрос к выполнению, выполняет его и возвращает
количество строк, подвергшихся воздействию. Если  нет ни одной такой
строки, как результат возвращается значение <code>"0E0"</code>, что Perl интерпретирует
как нуль, но воспринимает как значение ``истина'' (true).. Этот метод
обычно используется для выражений, не являющихся операторами <code>SELECT</code>,
которые не могут быть подготовлены заранее (из-за ограничений драйвера)
или же выполняются только один раз (операции вставки, удаления и т.д.).
Например:

<PRE>
$rv = $dbh-&#62;do($statement)
or die "Не могу выполнить: $sth -&#62; errstr";
</PRE>

Обычно использование 'do' существенно быстрей (и предпочтительней) для
запросов без параметров, чем пара <code>prepare</code>/<code>execute</code>.

<A NAME="IDX1516"></A>
<A NAME="IDX1517"></A>
<A NAME="IDX1518"></A>

<DT><code>quote($string)</code>
<DD>
Метод <code>quote</code> используется для экранирования специальных символов в
запросе символами экранирования, а также заключения данных в необходимые
внешние символы цитирования (например кавычки).
Пример:

<PRE>
$sql = $dbh-&#62;quote($string)
</PRE>

<A NAME="IDX1519"></A>
<A NAME="IDX1520"></A>
<DT><code>fetchrow_array</code>
<DD>
Этот метод выбирает очередную строку данных и возвращает ее как массив
значений полей.
Пример:

<PRE>
while(@row = $sth -&#62; fetchrow_array) {
print qw($row[0]\t$row[1]\t$row[2]\n);
}
</PRE>

<A NAME="IDX1521"></A>
<A NAME="IDX1522"></A>
<DT><code>fetchrow_arrayref</code>
<DD>
Этот метод выбирает очередную строку данных и возвращает ссылку на
массив значений полей.
Пример:

<PRE>
while($row_ref = $sth -&#62; fetchrow_arrayref) {
print qw($row_ref -&#62; [0]\t$row_ref -&#62; [1]\t$row_ref -&#62;
[2]\n);
}
</PRE>

<A NAME="IDX1523"></A>
<A NAME="IDX1524"></A>
<DT><code>fetchrow_hashref</code>
<DD>
Этот метод выбирает строку данных и возвращает ссылку на хеш,
содержащий пары имя/значение. Данный метод намного менее эффективен, чем
использование пописанных выше ссылок на массивы.
Пример:

<PRE>
while($hash_ref = $sth -&#62; fetchrow_hashref) {
print qw($hash_ref -&#62; {firstname}\t$hash_ref -&#62;
{lastname}\t$hash_ref -&#62;{title}\n);
}
</PRE>

<A NAME="IDX1525"></A>
<A NAME="IDX1526"></A>
<DT><code>fetchall_arrayref</code>
<DD>
Этот метод выдает все данные (все строки), получаемые как результат
SQL-запроса. Он возвращает ссылку на массив ссылок на массивы отдельных
строк. Соответственно, для обращения к этим данным нужно использовать
вложенный цикл.
Пример:

<PRE>
my $table = $sth -&#62; fetchall_arrayref
or die "$sth -&#62; errstr\n";
my($i, $j);
for $i ( 0 .. $#{$table}} ) {
for $j ( 0 .. $#{$table -&#62; [$i]} )  {
print "$table -&#62; [$i][$j]\t";
}
print "\n";
}
</PRE>

<A NAME="IDX1527"></A>
<A NAME="IDX1528"></A>
<DT><code>finish</code>
<DD>
Указывает, что данные этого дескриптора запроса больше не нужны. После
вызова этого метода программа освобождает дескриптор запроса и все
системные ресурсы, которые используются для работы с ним.
Пример:

<PRE>
$rc = $sth -&#62; finish;
</PRE>

<A NAME="IDX1529"></A>
<A NAME="IDX1530"></A>
<DT><code>rows</code>
<DD>
Возвращает число измененных/удаленных последней командой (<code>UPDATE</code>,
<code>DELETE</code> и т.д.) строк. Это обычно требуется после выполнения метода <code>execute</code>
над запросами, не являющимися запросами <code>SELECT</code>.
Например:

<PRE>
$rv = $sth -&#62; rows;
</PRE>

<A NAME="IDX1531"></A>
<A NAME="IDX1532"></A>
<DT><code>NULLABLE</code>
<DD>
Возвращает ссылку на массив значений, которые указывают, может столбец
принимать значения <code>NULL</code> или нет. Возможные значения для каждого элемента
массива - это 0 или пустая строка, если столбец не может содержать значения
<code>NULL</code>, 1 - если может и 2 - если статус столбца относительно значения
<code>NULL</code> не определен.

Например:

<PRE>
$null_possible = $sth -&#62; {NULLABLE};
</PRE>

<A NAME="IDX1533"></A>
<A NAME="IDX1534"></A>
<DT><code>NUM_OF_FIELDS</code>
<DD>
Значение этого атрибута равно числу полей в результате запроса (<code>SELECT</code>
или <code>SHOW FIELDS</code>). Его можно использовать его для проверки, возвращает ли
запрос результат вообще: нулевое значение соответствует запросам типа
<code>INSERT</code>, <code>DELETE</code>, <code>UPDATE</code> - т.е. всем, кроме <code>SELECT</code>.
Например:

<PRE>
$nr_of_fields = $sth -&#62; {NUM_OF_FIELDS};
</PRE>

<A NAME="IDX1535"></A>
<A NAME="IDX1536"></A>
<DT><code>data_sources($driver_name)</code>
<DD>
Этот метод возвращает массив с именами баз данных, доступных на
локальном MySQL-сервере (на <code>localhost</code>).
Пример:

<PRE>
@dbs = DBI-&#62;data_sources("mysql");
</PRE>

<A NAME="IDX1537"></A>
<A NAME="IDX1538"></A>
<DT><code>ChopBlanks</code>
<DD>
Этот атрибут определяет, будут ли методы <code>fetchrow_*</code> убирать начальные
и оконечные пробелы из результатов.
Пример:

<PRE>
$sth -&#62; {'ChopBlanks'} = 1;
</PRE>

<A NAME="IDX1539"></A>
<A NAME="IDX1540"></A>
<DT><code>trace($trace_level)</code>
<DD>
<DT><code>trace($trace_level, $trace_filename)</code>
<DD>
Метод trace разрешает  или  запрещает  трассировку. Если он вызывается
как метод класса <code>DBI</code>, он влияет на разрешение трассировки всех
дескрипторов. В случае же обращения к нему как к методу дескриптора
запроса либо базы данных он разрешает/запрещает трассировку для этой базы
данных или этого запроса (и всех будущих потомков). <code>$trace_level</code> указывает
уровень детализации трассировочной информации, так установка <code>$trace_level</code> 
в 2 включает детализированную трассировку. Установка <code>$trace_level</code> в 0
запрещает трассировку. По умолчанию вывод трассировочной информации
осуществляется на стандартное устройство вывода ошибок (<code>stderr</code>). Если
указан параметр <code>$trace_filename</code>, его значение используется как имя файла,
в который выводится трассировочная информация <strong>ВСЕХ</strong> дескрипторов, для
которых разрешена трассировка.
Пример:

<PRE>
DBI-&#62;trace(2);                # трассировка всего
DBI-&#62;trace(2,"/tmp/dbi.out"); # трассировка всего в /tmp/dbi.out
$dth-&#62;trace(2);               # трассировка всех запросов к этой базе
данных
$sth-&#62;trace(2);               # трассировка этого запроса
</PRE>

<A NAME="IDX1541"></A>
<A NAME="IDX1542"></A>

Трассировку <code>DBI</code> можно также включить при помощи переменной окружения
<code>DBI_TRACE</code>. Присвоение числового значения эквивалентно вызову
<code>DBI-&#62;trace(значение)</code>. Строковое значение (имя файла) эквивалентно вызову
<code>DBI-&#62;trace(2,значение)</code>.
</DL>

<P>
<strong>Методы, специфичные для MySQL</strong>

</P>
<P>
Описанные здесь методы специфичны для MySQL и не являются частью стандарта
<code>DBI</code>. Сейчас считается, что часть из них использовать не стоит: <code>is_blob</code>,
<code>is_key</code>, <code>is_num</code>, <code>is_pri_key</code>, <code>is_not_null</code>, <code>length</code>, <code>max_length</code> и <code>table</code>. Ниже
указаны возможные стандартные альтернативы, если они существуют:

</P>
<DL COMPACT>

<DT><code>insertid</code>
<DD>
<A NAME="IDX1543"></A>
 <A NAME="IDX1544"></A>
 <A NAME="IDX1545"></A>
 
Если вы используете специфичную для MySQL функцию <code>AUTO_INCREMENT</code>,
здесь будут сохраняться автоматически увеличенные значения.
Пример:

<PRE>
$new_id = $sth-&#62;{insertid};
</PRE>

В качестве альтернативы можно использовать <code>$dbh -&#62; {'mysql_insertid'}</code>.

<A NAME="IDX1546"></A>
<A NAME="IDX1547"></A>
<DT><code>is_blob</code>
<DD>
Возвращает ссылку на массив булевых значений; для каждого элемента
массива значение ``истина'' указывает, что соответствующий столбец имеет
тип <code>BLOB</code>.
Например:

<PRE>
$keys = $sth -&#62; {is_blob};
</PRE>

<A NAME="IDX1548"></A>
<A NAME="IDX1549"></A>
<DT><code>is_key</code>
<DD>
Возвращает ссылку на массив булевых значений; для каждого элемента
массива значение ``истина'' указывает, что соответствующий столбец
является ключом.
Пример:

<PRE>
$keys = $sth -&#62; {is_key};
</PRE>

<A NAME="IDX1550"></A>
<A NAME="IDX1551"></A>
<DT><code>is_num</code>
<DD>
Возвращает ссылку на массив булевых значений; для каждого элемента
массива, значение ``истина'' указывает, что соответствующий столбец
содержит числовые значения.
Например:

<PRE>
$nums = $sth -&#62; {is_num};
</PRE>

<A NAME="IDX1552"></A>
<A NAME="IDX1553"></A>
<DT><code>is_pri_key</code>
<DD>
Возвращает ссылку на массив булевых значений; для каждого элемента
массива, значение ``истина'' указывает, что соответствующий столбец
является первичным ключом.
Пример:

<PRE>
$pri_keys = $sth -&#62; {is_pri_key};
</PRE>

<A NAME="IDX1554"></A>
<A NAME="IDX1555"></A>
<DT><code>is_not_null</code>
<DD>
Возвращает ссылку на массив б булевых значений; для каждого элемента
массива значение ``ложь'' указывает на то, что столбец может содержать
значения <code>NULL</code>.
Например:

<PRE>
$not_nulls = $sth -&#62; {is_not_null};
</PRE>

<code>is_not_null</code> не рекомендуется к применению; предпочтительно
использование <code>NULLABLE</code> (описан ранее), поскольку это стандартный для <code>DBI</code>
метод.

<A NAME="IDX1556"></A>
<A NAME="IDX1557"></A>
<A NAME="IDX1558"></A>
<A NAME="IDX1559"></A>
<DT><code>length</code>
<DD>
<DT><code>max_length</code>
<DD>
Каждый из этих методов возвращает ссылку на массив размеров столбцов.
Массив, соответствующий <code>length</code>, содержит максимальные допустимые размеры
каждого столбца (из описания таблицы). Массив <code>max_length</code> содержит
максимальные размеры элементов, присутствующих в результирующей таблице.
Например:

<PRE>
$lengths = $sth -&#62; {length};
$max_lengths = $sth -&#62; {max_length};
</PRE>

<A NAME="IDX1560"></A>
<A NAME="IDX1561"></A>
<DT><code>NAME</code>
<DD>
Возвращает ссылку на массив имен столбцов.
Например:

<PRE>
$names = $sth -&#62; {NAME};
</PRE>

<A NAME="IDX1562"></A>
<A NAME="IDX1563"></A>
<DT><code>table</code>
<DD>
Возвращает ссылку на массив названий таблиц.
Например:

<PRE>
$tables = $sth -&#62; {table};
</PRE>

<A NAME="IDX1564"></A>
<A NAME="IDX1565"></A>
<DT><code>type</code>
<DD>
Возвращает ссылку на массив типов столбцов.
Пример:

<PRE>
$types = $sth -&#62; {type};
</PRE>

</DL>



<H3><A NAME="DBI-info" HREF="manual.ru_toc.html#DBI-info">8.2.3  Больше информации по <code>DBI</code>/<code>DBD</code></A></H3>

<P>
<A NAME="IDX1566"></A>

</P>
<P>
Вы можете использовать команду <code>perldoc</code> для получения больше информации по
<code>DBI</code>.

</P>

<PRE>
perldoc DBI
perldoc DBI::FAQ
perldoc DBD::mysql
</PRE>

<P>
Конечно, вы можете использовать <code>pod2man</code>, <code>pod2html</code> и другие утилиты для
трансляции в другие форматы.

</P>
<P>
Самая свежая информация по <code>DBI</code> живет на веб-сайте <code>DBI</code>:
<a HREF="http://dbi.perl.org/">http://dbi.perl.org/</a>.

</P>


<H2><A NAME="ODBC" HREF="manual.ru_toc.html#ODBC">8.3  Поддержка ODBC в MySQL</A></H2>

<P>
<A NAME="IDX1567"></A>
<A NAME="IDX1568"></A>
<A NAME="IDX1569"></A>

</P>

<P>
MySQL обеспечивает поддержку для ODBC посредством программы <code>MyODBC</code>. В этом
разделе показано, как устанавливать и использовать <code>MyODBC</code>. Здесь также
приведен список программ общего применения, о которых известно, что они
работают с <code>MyODBC</code>.

</P>


<H3><A NAME="Installing_MyODBC" HREF="manual.ru_toc.html#Installing_MyODBC">8.3.1  Как установить MyODBC</A></H3>

<P>
<code>MyODBC</code> 2.50 представляет собой 32-разрядный драйвер ODBC спецификации уровня 0 (с
возможностями уровней 1 и 2) для подсоединения совместимого с ODBC
приложения к MySQL. <code>MyODBC</code> работает под Windows 9x/Me/NT/2000/XP и на
большинстве платформ Unix.

</P>
<P>
<code>MyODBC</code> 3.51 это усовершенствованная версия ODBC со спецификационным
уровнем 1 (полностью ядро API + уровень возможности 2).

</P>
<P>
<code>MyODBC</code> является свободно доступным. Самую свежую версию можно найти на
<a HREF="http://www.mysql.com/downloads/api-myodbc.html">http://www.mysql.com/downloads/api-myodbc.html</a>.

</P>
<P>
Обратите внимание, что версии 2.50.х распространяются под <code>LGPL</code>
лицензией, тогда как 3.51.х версии под лицензией <code>GPL</code>.

</P>
<P>
Если существуют проблемы с <code>MyODBC</code>, а программа также работает и с OLEDB,
то следует попробовать работать с драйвером OLEDB.

</P>
<P>
Обычно установка <code>MyODBC</code> требуется только на компьютерах под Windows. Для
Unix необходимость в <code>MyODBC</code> возникает только для программ, подобных
ColdFusion, которые работают на Unix-машинах и используют ODBC для
подключения к базам данных.

</P>
<P>
Для установки <code>MyODBC</code> на Unix-машину понадобится также программа управления
ODBC. MyODBC, как известно, работает с большинством программ управления
ODBC для Unix.

</P>
<P>
Для того чтобы установить <code>MyODBC</code> на Windows, необходимо загрузить
соответствующий файл <code>MyODBC</code> <tt>`.zip'</tt>, распаковать его с помощью <code>WinZIP</code> или
другой подобной программы и выполнить исполняемый файл <tt>`SETUP.EXE'</tt>.

</P>
<P>
При попытке установить <code>MyODBC</code> под Windows/NT/XP можно получить следующую
ошибку:

</P>

<PRE>
An error occurred while copying C:\WINDOWS\SYSTEM\MFC30.DLL. Restart
Windows and try installing again (before running any applications which
use  ODBC)
</PRE>

<P>
Проблема здесь заключается в том, что некоторая другая программа в это же
время использует ODBC и из-за конструктивных особенностей Windows в данном
случае может оказаться невозможным установить новый драйвер ODBC с помощью
поставляемой Microsoft программы установки. В большинстве случаев можно
продолжать установку, просто нажимая <code>Ignore</code> для копирования оставшихся
файлов <code>MyODBC</code>, при этом заключительная установка должна работать. Если она
не работает, то выход состоит в следующем: перезагрузите систему в
безопасном режиме (safe mode) (для перехода в этот режим следует нажать
F8 непосредственно перед тем, как компьютер начинает запускать Windows во
время перезагрузки), установите <code>MyODBC</code> и перезагрузите Windows в обычном
режиме.

</P>

<UL>
<LI>

Чтобы установить подсоединение к Unix-компьютеру от Windows-компьютера
с помощью приложения ODBC (которое само по себе не поддерживает
MySQL), необходимо вначале установить MyODBC на Windows-машине.

<LI>

Данный пользователь и Windows-машина должны обладать привилегиями
доступа к серверу MySQL на Unix-машине. Это устанавливается с помощью
команды GRANT (see section <A HREF="manual.ru.html#GRANT">4.3.1  Синтаксис команд <code>GRANT</code> и <code>REVOKE</code></A>).

<LI>

Необходимо создать новую запись DSN  ODBC следующим образом:

<LI>

Открыть Control  Panel (Панель управления) на Windows-компьютере.

<LI>

Выполнить двойной щелчок на пиктограмме ODBC  Data  Sources
32-bit (Источники данных ODBC (32бит)).

<LI>

Щелкнуть на закладке User  DSN (Пользовательский DSN).

<LI>

Щелкнуть на кнопке Add (Добавить).

<LI>

Выбрать MySQL в окне Create  New  Data  Source (Создание нового
источника данных) и щелкнуть на кнопке Finish (Готово).

<LI>

Откроется окно конфигурации драйвера MySQL по умолчанию (see section <A HREF="manual.ru.html#ODBC_administrator">8.3.2  Как заполнять различные поля в Администраторе ODBC</A>).

<LI>

Теперь запустите свое приложение и выберите драйвер ODBC с помощью
DSN, заданного вами в Администраторе источников данных ODBC.
</UL>

<P>
Обратите внимание: существуют и другие возможности конфигурации в окне
MySQL (трассировка, не подсказывать соединение и так далее), которые вы
можете опробовать, если столкнетесь с какими-либо проблемами.

</P>


<H3><A NAME="ODBC_administrator" HREF="manual.ru_toc.html#ODBC_administrator">8.3.2  Как заполнять различные поля в Администраторе ODBC</A></H3>

<P>
<A NAME="IDX1570"></A>

</P>
<P>
Для Windows 95 существует три возможности задания имени сервера:

</P>

<UL>
<LI>

Использовать IP-адрес сервера.

<LI>

Добавить файл \windows\lmhosts  со следующей информацией:


<PRE>
ip hostname
</PRE>

Например:


<PRE>
194.216.84.21 my_hostname
</PRE>

<LI>

Сконфигурировать ПК для использования DNS.
</UL>

<P>
Пример заполнения при установке ODBC:

</P>

<PRE>
Windows DSN name:   test
Description:        This is my test database
MySql Database:     test
Server:             194.216.84.21
User:               monty
Password:           my_password
Port:
</PRE>

<P>
Значением поля <code>Windows DSN name</code> может быть любое имя, уникальное для
данной установки ODBC.

</P>
<P>
Не обязательно указывать значения для полей <code>Server</code>, <code>User</code>, <code>Password</code> или
<code>Port</code> в окне установки ODBC. Однако если вы это сделали, данные величины в
дальнейшем при установке соединения будут использованы как значения по
умолчанию. Тогда же можно будет изменить эти значения.

</P>
<P>
Если номер порта не задан, то используется его значение по умолчанию 
(3306).

</P>
<P>
Если задается опция <code>Read options from C:\my.cnf</code>, то группы <code>client</code> и
<code>odbc</code> будут читаться из файла <tt>`C:\my.cnf'</tt>. Можно применять все опции,
используемые в <code>mysql_options()</code> (see section <A HREF="manual.ru.html#mysql_options">8.4.3.39  <code>mysql_options()</code></A>).

</P>


<H3><A NAME="MyODBC_connect_parameters" HREF="manual.ru_toc.html#MyODBC_connect_parameters">8.3.3  Параметры подключения для MyODBC</A></H3>

<P>
Можно указать следующие параметры для <code>MyODBC</code> в разделе <code>[Servername]</code> файла
<tt>`ODBC.INI'</tt> или через аргумент <code>InConnectionString</code> при вызове функции
<code>SQLDriverConnect()</code>.
<TABLE BORDER>
<TR><TD><strong>Параметр</strong> </TD><TD> <strong>Величина по умолчанию</strong> </TD><TD> <strong>Комментарий</strong>
</TD></TR>
<TR><TD>user </TD><TD> ODBC (под Windows)@tab Имя пользователя, используемое для подключения к MySQL.
</TD></TR>
<TR><TD>server </TD><TD> localhost </TD><TD> Имя хоста сервера MySQL.
</TD></TR>
<TR><TD>database@tab </TD><TD> База данных по умолчанию.
</TD></TR>
<TR><TD>option </TD><TD> 0 </TD><TD> Целое число, с помощью которого можно указать, как должен работать драйвер MyODBC (см. ниже).
</TD></TR>
<TR><TD>port </TD><TD> 3306 </TD><TD> Используемый порт TCP/IP, если значением <code>server</code> не является <code>localhost</code>.
</TD></TR>
<TR><TD>stmt </TD><TD> </TD><TD> Команда, которая будет выполняться при подключении к MySQL.
</TD></TR>
<TR><TD>password@tab </TD><TD> Пароль для комбинации <code>server user</code>.
</TD></TR>
<TR><TD>socket </TD><TD> </TD><TD> Сокет или канал Windows для подключения.
</TD></TR>
</TABLE>

</P>
<P>
Аргумент ``option'' используется для указания <code>MyODBC</code>, что данный клиент
не на 100% соответствует ODBC. Под Windows обычно устанавливается флаг
опций путем переключения различных опций в окне данного соединения, но
можно также установить это в аргументе ``option''. Следующие опции
перечислены в том же порядке, в котором они перечислены в окне подключения
<code>MyODBC</code>:
<TABLE BORDER>
<TR><TD><strong>Бит</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD>1 </TD><TD> Данный клиент не может отследить, что драйвер <code>MyODBC</code> возвращает реальную ширину столбца.
</TD></TR>
<TR><TD>2 </TD><TD> Данный клиент не может отследить, что драйвер <code>MyODBC</code> возвращает реальную величину подвергшихся воздействию строк. Если этот флаг установлен, то взамен MySQL возвращает ``найденные строки''. Необходима версия MySQL 3.21.14 или более новая, чтобы эта опция работала.
</TD></TR>
<TR><TD>4 </TD><TD> Создает журнал отладки в c:\myodbc.log. Это то же самое, что задать <code>MYSQL_DEBUG=d:t:O,c::\myodbc.log</code> в <tt>`AUTOEXEC.BAT'</tt>
</TD></TR>
<TR><TD>8 </TD><TD> Не устанавливать никаких пакетных ограничений для результатов и параметров.
</TD></TR>
<TR><TD>16 </TD><TD> Не выводить подсказки для вопросов, даже если драйвер захотел бы предложить это
</TD></TR>
<TR><TD>32 </TD><TD> Имитировать драйвер ODBC 1.0 в определенной ситуации.
</TD></TR>
<TR><TD>64 </TD><TD> Игнорировать использование имени базы данных в <code>database.table.column</code>.
</TD></TR>
<TR><TD>128 </TD><TD> Заставляет использовать указатели менеджера ODBC (экспериментальная).
</TD></TR>
<TR><TD>256 </TD><TD> Отключить использование расширенной выборки (экспериментальная).
</TD></TR>
<TR><TD>512 </TD><TD> Заполнить поля <code>CHAR</code> до полной длины столбца.
</TD></TR>
<TR><TD>1024 </TD><TD> Функция SQLDescribeCol() будет возвращать полностью уточненные имена столбцов
</TD></TR>
<TR><TD>2048 </TD><TD> Использовать сжатие в клиент-серверном протоколе
</TD></TR>
<TR><TD>4096 </TD><TD> Предписывает серверу игнорировать пробел после имени функции и перед <samp>`('</samp> (необходимо для PowerBuilder). Это сделает имена всех функций ключевыми словами!
</TD></TR>
<TR><TD>8192 </TD><TD> Соединяет с именованными каналами сервер <code>mysqld</code>, работающий под NT.
</TD></TR>
<TR><TD>16384 </TD><TD> Изменяет тип столбцов <code>LONGLONG</code> на <code>INT</code> (некоторые приложения не могут обрабатывать LONGLONG).
</TD></TR>
<TR><TD>32768 </TD><TD> Возвращает параметр <code>user</code> как <code>Table_qualifier</code> и <code>Table_owner</code> из SQL-таблиц (экспериментальная)
</TD></TR>
<TR><TD>65536 </TD><TD> Читает параметры из групп <code>client</code> и <code>odbc</code> из файла <tt>`my.cnf'</tt>
</TD></TR>
<TR><TD>131072 </TD><TD> Добавляет некоторые дополнительные проверки безопасности (не должно понадобиться, но...)
</TD></TR>
</TABLE>

</P>
<P>
Если необходимо иметь много опций, следует добавить вышеуказанные флаги!
Например, установка опции в 12 (4+8) дает отладку без ограничений пакетов!

</P>
<P>
По умолчанию <tt>`MYODBC.DLL'</tt> компилируется для оптимальной производительности.
Если необходимо отладить <code>MyODBC</code> (например, включить трассировку), следует
вместо этого использовать <tt>`MYODBCD.DLL'</tt>. Для установки этого файла следует
скопировать <tt>`MYODBCD.DLL'</tt> поверх установленного файла <tt>`MYODBC.DLL'</tt>.

</P>


<H3><A NAME="ODBC_Problems" HREF="manual.ru_toc.html#ODBC_Problems">8.3.4  Как сообщать о проблемах с MyODBC</A></H3>

<P>
Драйвер <code>MyODBC</code> был протестирован с Access, Admndemo.exe, C++-Builder,
Borland  Builder 4, Centura  Team  Developer (первоначально Gupta 
SQL/Windows), ColdFusion (под Solaris и NT с пакетом обновлений svc  pack
5), Crystal  Reports, DataJunction, Delphi, ERwin, Excel, iHTML, FileMaker
Pro, FoxPro, Notes 4.5/4.6, SBSS, Perl  DBD-ODBC, Paradox, Powerbuilder,
32-разрядным Powerdesigner, VC++ и Visual  Basic.

</P>
<P>
Если вам известны какие- либо другие приложения, работающие с MyODBC,
пожалуйста, пошлите сообщение об этом по адресу <a HREF="mailto:myodbc@lists.mysql.com">myodbc@lists.mysql.com</a>!

</P>
<P>
При работе с некоторыми программами можно получить ошибку вроде:
<code>Another user has modifies the record that you have modified</code>.

</P>
<P>
В большинстве случаев эту проблему можно устранить одним из следующих способов:

</P>

<UL>
<LI>

Добавить первичный ключ для данной таблицы, если он еще не создан.
<LI>

Добавить столбец <code>TIMESTAMP</code>, если он еще не создан.
<LI>

Использовать поля только с числами с плавающей запятой двойной
точности. Некоторые программы могут не срабатывать при сравнении чисел
с плавающей запятой одинарной точности.
</UL>

<P>
Если перечисленные выше способы не помогают, необходимо сделать
трассировочный файл <code>MyODBC</code> и попробовать определить, в чем дело.

</P>


<H3><A NAME="MyODBC_clients" HREF="manual.ru_toc.html#MyODBC_clients">8.3.5  Программы, работающие с MyODBC</A></H3>

<P>
Большинство программ должно работать с <code>MyODBC</code>, но для каждой из
перечисленных ниже мы либо провели тестирование сами, либо получили
подтверждение от пользователей, что она действительно работает:

</P>
<DL COMPACT>

<DT><strong>Программа</strong>
<DD>
<strong>Комментарий</strong>
<A NAME="IDX1571"></A>
<DT>Access
<DD>
Чтобы заставить Access работать:

<UL>
<LI>

При использовании Access 2000 необходимо установить самую последнюю
версию (2.6 или выше) Microsoft MDAC (<code>Microsoft Data Access 
Components</code>), которую можно найти на <a HREF="http://www.microsoft.com/data/">http://www.microsoft.com/data/</a>.
Это позволит устранить ошибку в Access, которая проявляется в том, что
при экспорте данных в MySQL не указываются имена таблиц и столбцов.
Еще один способ обойти эту ошибку заключается в модернизации <code>MyODBC</code> до
версии 2.50.33 и MySQL до версии 3.23.x - оба апгрейда вместе
обеспечивают обход данной ошибки!

Необходимо также получить и
использовать Microsoft  Jet 4.0 Service  Pack 5 (SP5), который можно
найти на <a HREF="http://support.microsoft.com/support/kb/articles/Q
239/1/14.ASP">http://support.microsoft.com/support/kb/articles/Q
239/1/14.ASP</a>. Это позволит исключить некоторые случаи, когда столбцы в
Access отмечаются как <code>#deleted#</code>. Следует учитывать, что при
использовании версии MySQL 3.22 необходимо применять патч для MDAC и
использовать MyODBC 2.50.32 или 2.50.34 и выше, чтобы обойти эту
проблему.
<LI>

Для всех версий Access необходимо включить для MyODBC флаг опции
<code>Return matching rows</code>. Для Access 2.0 следует дополнительно включить
Simulate  ODBC 1.0.
<LI>

Все таблицы, в которых вы хотите иметь возможность обновления, должны
содержать столбец типа <code>TIMESTAMP</code> для временных меток. Для максимальной
переносимости рекомендуется <code>TIMESTAMP(14)</code> или просто <code>TIMESTAMP</code> вместо
других вариантов <code>TIMESTAMP(X)</code>.
<LI>

Таблица должна иметь первичный ключ. Если не имеет, то новые или
обновленные строки могут выводиться как <code>#DELETED#</code>.
<LI>

Используйте поля с числами с плавающей запятой только двойной точности
(типа <code>DOUBLE</code>). Access отказывается работать при сравнении чисел с
плавающей запятой одинарной точности. Проявляется это обычно в том,
что новые или обновленные строки могут выводиться как <code>#DELETED#</code> или в
том, что вы не можете найти или обновить строки.
<LI>

При связывании через MyODBC таблицы, один из столбцов которой имеет
тип <code>BIGINT</code>, результат будет выводиться как <code>#DELETED#</code>. Обходное решение
заключается в следующем:

<UL>
<LI>

Добавьте еще один пустой столбец с <code>TIMESTAMP</code> в качестве типа
данных, предпочтительно <code>TIMESTAMP(14)</code>.
<LI>

Проверьте <code>Change BIGINT columns to INT</code> в диалоговом окне
опций подключения в Администраторе источников данных ODBC  DSN
<LI>

Удалите данную табличную связь из Access и создайте ее вновь.
</UL>

После этого старые записи все равно будут представлены как <code>#DELETED#</code>, а
заново добавленные/обновленные записи будут уже выводиться правильно.
<LI>

Если после добавления столбца <code>TIMESTAMP</code> все еще появляется ошибка
<code>Another user has changed your data</code>, то, возможно, поможет
следующий трюк. Не используйте режим работы ``Таблица''. Вместо этого
создайте форму с желаемыми полями и используйте режим работы
``Форма''. Следует установить свойство <code>DefaultValue</code> для столбца
<code>TIMESTAMP</code> в <code>NOW()</code>. Возможно, было бы неплохо убрать столбец <code>TIMESTAMP</code>
из поля зрения, чтобы не смущать пользователей.
<LI>

В некоторых случаях Access может создавать недопустимые запросы SQL,
которые MySQL не может понять. Это можно устранить путем выбора в меню
Access опции <code>Query|SQLSpecific|Pass-Through</code>.
<LI>

Access под NT будет сообщать о столбцах <code>BLOB</code> как об объектах OLE. Если
вместо этого вы хотите иметь столбцы <code>MEMO</code>, то необходимо изменить тип
столбца на <code>TEXT</code> с помощью <code>ALTER TABLE</code>.
<LI>

Access не всегда может правильно обработать столбцы типа <code>DATE</code>. Если с
ними возникают проблемы, следует изменить тип этих столбцов на
<code>DATETIME</code>.
<LI>

Если Access содержит столбец, определенный как <code>BYTE</code>, то Access будет
пытаться экспортировать его как <code>TINYINT</code> вместо <code>TINYINT UNSIGNED</code>. Это
будет вызывать проблемы, если величины в данном столбце превышают 127!
</UL>

<A NAME="IDX1572"></A>
<DT>ADO
<DD>
При написании программ с привлечением интерфейса ADO API и <code>MyODBC</code>
необходимо обратить внимание на некоторые исходные свойства, которые не
поддерживаются сервером MySQL. Например, использование свойства
<code>CursorLocation</code>  как <code>adUseServer</code> будет возвращать для свойства <code>RecordCount</code>
результат -1. Чтобы получить правильную величину, необходимо установить
данное свойство в <code>adUseClient</code>, как показано в коде VB ниже:


<PRE>
Dim myconn As New ADODB.Connection
Dim myrs As New Recordset
Dim mySQL As String
Dim myrows As Long

myconn.Open "DSN=MyODBCsample"
mySQL = "SELECT * from user"
myrs.Source = mySQL
Set myrs.ActiveConnection = myconn
myrs.CursorLocation = adUseClient
myrs.Open
myrows = myrs.RecordCount

myrs.Close
myconn.Close
</PRE>

Еще один обходной путь состоит в том, чтобы для такого запроса
использовать команду <code>SELECT COUNT(*)</code>, чтобы получить правильное
количество строк.

<DT>Активные серверные страницы (ASP)
<DD>
Необходимо использовать флаг опции <code>Return matching rows</code>.

<DT>BDE-приложения
<DD>
Чтобы заставить их работать, следует установить флаги опций <code>Don't 
optimize column widths</code> и <code>Return matching rows</code>.

<A NAME="IDX1573"></A>
<DT>Borland Builder 4
<DD>
При запуске запроса можно использовать свойство <code>Active</code> или метод <code>Open</code>.
Следует учитывать, что <code>Active</code> будет начинать работу при автоматической
выдаче запроса <code>SELECT * FROM ...</code>, что может оказаться не так уж и хорошо
для больших таблиц!

<DT>ColdFusion (Под Unix)
<DD>
Приведенные далее сведения взяты из документации по ColdFusion. Для
применения драйвера unixODBC с источником данных <code>MyODBC</code> следует
использовать следующую информацию. Корпорация Allaire подтвердила, что
версия MyODBC 2.50.26 работает с версией MySQL 3.22.27 и ColdFusion для
Linux (любая более новая версия также должна работать). Драйвер <code>MyODBC</code>
можно загрузить с <a HREF="http://www.mysql.com/downloads/api-myodbc.html">http://www.mysql.com/downloads/api-myodbc.html</a> 

<A NAME="IDX1574"></A>
В версии
ColdFusion 4.5.1 можно использовать Администратор источников данных
ColdFusion для добавления источника данных MySQL. Однако данный драйвер не
включен в версию ColdFusion 4.5.1. Чтобы драйвер MySQL появился в
выпадающем списке источников данных ODBC, необходимо создать драйвер
<code>MyODBC</code> и скопировать его в каталог <tt>`/opt/coldfusion/lib/libmyodbc.so'</tt>.
Каталог <tt>`Contrib'</tt> содержит программу <tt>`mydsn-xxx.zip'</tt>, которая позволяет
создавать и удалять файл реестра DSN для драйвера <code>MyODBC</code> для приложений
Coldfusion.

<A NAME="IDX1575"></A>
<DT>DataJunction
<DD>
Необходимо изменить эту программу для вывода <code>VARCHAR</code> вместо <code>ENUM</code>,
поскольку экспорт <code>ENUM</code> происходит таким образом, что вызывает неприятности
в MySQL.

<A NAME="IDX1576"></A>
<DT>Excel
<DD>
Работает. Несколько замечаний:

<UL>
<LI>

Если существуют проблемы с датами, попробуйте выбирать их как строки,
используя функцию <code>CONCAT()</code>. Например:

<PRE>
select CONCAT(rise_time), CONCAT(set_time)
	from sunrise_sunset;
</PRE>

Величины, извлеченные как строки этим способом, должны корректно
распознаваться программой Excel97 как значения времени. Назначение функции
<code>CONCAT()</code> в этом примере состоит в том, чтобы ``обмануть'' ODBC, заставив
интерпретировать столбец как столбец ``строкового типа''. Без функции
<code>CONCAT()</code> ODBC будет считать, что это столбец временного типа, и Excel не
распознает его. Следует заметить, что это является ошибкой Excel,
поскольку он автоматически преобразует строку в значения времени. Это
замечательно если источником является текстовый файл, но это глупо, когда источником является подключение ODBC, дающее точные
типы данных для каждого столбца.
</UL>

<A NAME="IDX1577"></A>
<DT>Word
<DD>
Для извлечения данных из MySQL в документы Word/Excel следует использовать
драйвер <code>MyODBC</code> и помощь встроенной программы Microsoft Query. Для
создания, например, базы данных <code>db</code> с таблицей, содержащей 2 столбца с
текстом, необходимо выполнить следующие действия:


<UL>
<LI>

Вставьте строки, используя командную строку клиента <code>mysql</code>.
<LI>

Создайте файл DSN, используя менеджер ODBC, например, my для созданной
выше базы данных <code>db</code>.
<LI>

Откройте приложение Word.
<LI>

Создайте новый пустой документ.
<LI>

Используя панель инструментов вызванной базы данных, нажмите кнопку
Insert database.
<LI>

Нажмите кнопку Get Data.
<LI>

В окне Get Data справа нажмите кнопку Ms Query.
<LI>

В окне Ms Query создайте новый источник данных, используя файл DSN 
my.
<LI>

Выберите новый запрос.
<LI>

Выберите желаемый столбец.
<LI>

Создайте фильтр (при желании).
<LI>

Создайте сортировку (при желании).
<LI>

Выберите Return Data to Microsoft Word.
<LI>

Нажмите кнопку Finish.
<LI>

Нажмите Insert data и выбирайте записи.
<LI>

Нажмите Ok. Вы увидите выбранные строки в своем документе в Word.
</UL>

<A NAME="IDX1578"></A>
<DT>odbcadmin
<DD>
Тестовая программа для ODBC.

<A NAME="IDX1579"></A>
<DT>Delphi
<DD>
Необходимо использовать версию BDE 3.2 или более новую. Установите поле
опции <code>Don't optimize column width</code> при подключении к MySQL. Кроме того,
ниже приводится потенциально полезный код Delphi, который устанавливает
вхождения для драйвера MyODBC как в ODBC, так и в BDE. (Запись в BDE
требует наличия редактора псевдонимов BDE  Alias  Editor, который доступен
бесплатно на Delphi Super Page. Спасибо за это Брайену Брантону (Bryan 
Brunton <a HREF="mailto:bryan@flesherfab.com">bryan@flesherfab.com</a>)):


<PRE>
fReg:= TRegistry.Create;
fReg.OpenKey('\Software\ODBC\ODBC.INI\DocumentsFab', True);
fReg.WriteString('Database', 'Documents');
fReg.WriteString('Description', ' ');
fReg.WriteString('Driver', 'C:\WINNT\System32\myodbc.dll');
fReg.WriteString('Flag', '1');
fReg.WriteString('Password', '');
fReg.WriteString('Port', ' ');
fReg.WriteString('Server', 'xmark');
fReg.WriteString('User', 'winuser');
fReg.OpenKey('\Software\ODBC\ODBC.INI\ODBC Data Sources', True);
fReg.WriteString('DocumentsFab', 'MySQL');
fReg.CloseKey;
fReg.Free;

Memo1.Lines.Add('DATABASE NAME=');
Memo1.Lines.Add('USER NAME=');
Memo1.Lines.Add('ODBC DSN=DocumentsFab');
Memo1.Lines.Add('OPEN MODE=READ/WRITE');
Memo1.Lines.Add('BATCH COUNT=200');
Memo1.Lines.Add('LANGDRIVER=');
Memo1.Lines.Add('MAX ROWS=-1');
Memo1.Lines.Add('SCHEMA CACHE DIR=');
Memo1.Lines.Add('SCHEMA CACHE SIZE=8');
Memo1.Lines.Add('SCHEMA CACHE TIME=-1');
Memo1.Lines.Add('SQLPASSTHRU MODE=SHARED AUTOCOMMIT');
Memo1.Lines.Add('SQLQRYMODE=');
Memo1.Lines.Add('ENABLE SCHEMA CACHE=FALSE');
Memo1.Lines.Add('ENABLE BCD=FALSE');
Memo1.Lines.Add('ROWSET SIZE=20');
Memo1.Lines.Add('BLOBS TO CACHE=64');
Memo1.Lines.Add('BLOB SIZE=32');
AliasEditor.Add('DocumentsFab','MySQL',Memo1.Lines);
</PRE>

<A NAME="IDX1580"></A>
<DT>C++ Builder
<DD>
Проведено тестирование с версией BDE 3.0. Единственная обнаруженная
проблема состоит в том, что при изменениях схемы таблиц не обновляются
поля запросов. Хотя BDE не распознает первичных ключей, а только индекс
<code>PRIMARY</code>, тем не менее, это не было проблемой.

<DT>Vision
<DD>
Необходимо использовать флаг опции <code>Return matching rows</code>.

<A NAME="IDX1581"></A>
<DT>Visual Basic
<DD>
Чтобы обеспечить возможность обновить таблицу, для нее необходимо
определить первичный ключ. Visual Basic с ADO не обрабатывает больших
целых чисел. Это означает, что некоторые запросы вроде <code>SHOW PROCESSLIST</code> 
не будут работать правильно. Для устранения данной проблемы нужно добавить
опцию <code>OPTION=16384</code> в строке подключения ODBC или установить опцию <code>Change
BIGINT columns to INT</code> в окне подключения <code>MyODBC</code>. Можно также установить
опцию <code>Return matching rows</code>.

<DT>VisualInterDev
<DD>
Если возникает ошибка <code>[Microsoft][ODBC Driver Manager] Driver does not
support this parameter</code>, то ее причина может заключаться в том, что
результат содержит данные типа <code>BIGINT</code>. Попробуйте установить опцию <code>Change
BIGINT columns to INT</code> в окне подключения <code>MyODBC</code>.

<DT>Visual Objects
<DD>
Необходимо использовать флаг опции <code>Don't optimize column widths</code>.
</DL>



<H3><A NAME="ODBC_and_last_insert_id" HREF="manual.ru_toc.html#ODBC_and_last_insert_id">8.3.6  Как получить значение столбца AUTO_INCREMENT в ODBC</A></H3>

<P>
<A NAME="IDX1582"></A>

</P>
<P>
Существует распространенная проблема, заключающаяся в том, как получить
значение автоматически сгенерированного <code>ID</code> из <code>INSERT</code>. С помощью ODBC можно
сделать что-то наподобие следующего (предполагается, что auto представляет
собой поле <code>AUTO_INCREMENT</code> ):

</P>

<PRE>
INSERT INTO foo (auto,text) VALUES(NULL,'text');
SELECT LAST_INSERT_ID();
</PRE>

<P>
Или, если вы просто собираетесь вставить данный <code>ID</code> в другую таблицу, то
можно сделать так:

</P>

<PRE>
INSERT INTO foo (auto,text) VALUES(NULL,'text');
INSERT INTO foo2 (id,text) VALUES(LAST_INSERT_ID(),'text');
</PRE>

<P>
See section <A HREF="manual.ru.html#Getting_unique_ID">8.4.6.3  Как получить уникальный идентификатор для последней внесенной строки?</A>.

</P>
<P>
Для некоторых приложений ODBC (по крайней мере, для Delphi и Access),
чтобы найти недавно вставленную строку, можно использовать следующий
запрос:

</P>

<PRE>
SELECT * FROM tbl_name WHERE auto IS NULL;
</PRE>



<H3><A NAME="MyODBC_bug_report" HREF="manual.ru_toc.html#MyODBC_bug_report">8.3.7  Составление отчетов о проблемах с MyODBC</A></H3>

<P>
<A NAME="IDX1583"></A>
<A NAME="IDX1584"></A>
<A NAME="IDX1585"></A>

</P>
<P>
Если встречаются трудности с применением <code>MyODBC</code>, то следует начинать с
получения системного журнала менеджера ODBC (журнал, получаемый при
затребовании записей в Администраторе ODBC) и журнала <code>MyODBC</code>.

</P>
<P>
Чтобы получить журнал <code>MyODBC</code>, необходимо выполнить следующие действия:

</P>

<OL>
<LI>

Убедитесь, что вы используете <tt>`myodbcd.dll'</tt>, а не <tt>`myodbc.dll'</tt>. Наиболее
простой способ - получить файл <tt>`myodbcd.dll'</tt> из дистрибутива <code>MyODBC</code> и
скопировать его поверх файла <tt>`myodbc.dll'</tt>, который должен находиться в
вашем каталоге <tt>`C:\windows\system32'</tt> или <tt>`C:\winnt\system32'</tt>. Однако после
окончания тестирования целесообразно восстановить старый файл
<tt>`myodbc.dll'</tt>, поскольку он намного быстрее, чем <tt>`myodbcd.dll'</tt>.
<LI>

Включите опцию <code>Trace</code> <code>MyODBC</code> в окне подключения/конфигурации <code>MyODBC</code>.
Информация будет записываться в файл <tt>`C:\myodbc.log'</tt>. Если опция
трассировки не запоминается при возвращении к предыдущему окну, то это
означает, что сейчас драйвер <tt>`myodbcd.dll'</tt> не используется (см. пункт
выше).
<LI>

Запустите свое приложение и попытайтесь получить отказ в работе.
</OL>

<P>
Проверьте трассировочный файл <code>MyODBC</code>, что бы попытаться выяснить, в чем
дело. Можно также найти сделанные вами запросы в файле <tt>`myodbc.log'</tt> -
поищите в нем строку  <code>&#62;mysql_real_query</code>.

</P>
<P>
Попробуйте также выполнить дублирование этих запросов с помощью монитора
<code>mysql</code> или <code>admndemo</code>, чтобы определить, где возникает ошибка - в MyODBC или
в MySQL.

</P>
<P>
Если вы обнаружите какую-либо ошибку, то присылайте, пожалуйста, только
строки, имеющие отношение к ней (максимум 40 строк), по адресу
<a HREF="mailto:myodbc@lists.mysql.com">myodbc@lists.mysql.com</a>. Просьба никогда не присылать полностью весь
системный журнал MyODBC или ODBC!

</P>
<P>
Если у вас нет возможности определить, что именно у вас не так, остается
последняя возможность - создать архив (tar или zip), содержащий
трассировочный файл MyODBC, системный журнал ODBC и файл README с
описанием своей проблемы. Вы можете послать это по адресу
<a HREF="ftp://support.mysql.com/pub/mysql/secret/">ftp://support.mysql.com/pub/mysql/secret/</a>. В MySQL  AB только мы будем
иметь доступ к присланным вами файлам. Гарантируем, что с ними мы будем
обращаться очень осторожно!

</P>
<P>
Если вы можете создать программу для демонстрации данной проблемы,
присылайте, пожалуйста, и ее тоже!

</P>
<P>
Если эта программа работает с некоторыми другими серверами SQL, следует
сделать системный журнал ODBC, где вы делаете в точности то же самое в
другом сервере SQL.

</P>
<P>
Помните, что чем больше информации вы нам предоставите, тем больше
вероятность, что мы сможем решить данную проблему!

</P>


<H2><A NAME="C" HREF="manual.ru_toc.html#C">8.4  Интерфейс C для MySQL</A></H2>

<P>
<A NAME="IDX1586"></A>
<A NAME="IDX1587"></A>
<A NAME="IDX1588"></A>
<A NAME="IDX1589"></A>

</P>

<P>
Исходный код программного интерфейса (API) C распространяется вместе с
MySQL. Он включает в себя библиотеку <code>mysqlclient</code> и обеспечивает
возможность доступа к базе данных программам на С.

</P>
<P>
Многие клиенты исходного дистрибутива MySQL написаны на C. Они являются
хорошими примерами для демонстрации использования интерфейса C. Их можно
найти их в каталоге <code>clients</code> исходного дистрибутива MySQL.

</P>
<P>
Большинство других клиентских интерфейсов (за исключением Java) для
соединения с сервером MySQL используют библиотеку <code>mysqlclient</code>. Это
означает, что, например, можно извлечь определенную выгоду, используя те
же переменные окружения, что и в других клиентских программах, поскольку
на них есть ссылки из библиотеки (see section <A HREF="manual.ru.html#Client-Side_Scripts">4.8  Клиентские сценарии и утилиты MySQL</A>, где приведен список этих переменных).

</P>
<P>
Клиент имеет максимальный размер буфера связи. Начальный размер этого
буфера составляет 16 Kб и автоматически увеличивается до максимального
значения 16 Mб. Поскольку размеры буфера увеличиваются только при
подтверждении запроса на это, то просто увеличение максимального предела
по умолчанию само по себе не обеспечит увеличения используемых ресурсов.
Проверка этого размера в основном используется для ошибочных запросов и
коммуникационных пакетов.

</P>
<P>
Буфер связи должен быть достаточно большим, чтобы вмещать целую
SQL-команду (для потока клиент-сервер) и целую строку возвращенных данных
(для потока сервер-клиент). Буфер связи для каждого из потоков динамически
увеличивается до максимального значения, чтобы обработать любой запрос или
строку. Например, для данных типа <code>BLOB</code> объемом до 16 Mб необходим предел
буфера связи по меньшей мере в 16 Mб (как для сервера, так и для клиента).
Максимальное значение по умолчанию для клиента составляет 16 Mб, а для
сервера максимум по умолчанию равен 1Mб. Можно увеличить этот объем,
изменив величину параметра <code>max_allowed_packet</code> при запуске сервера (see section <A HREF="manual.ru.html#Server_parameters">5.5.2  Настройка параметров сервера</A>).

</P>
<P>
Сервер MySQL сжимает каждый буфер связи до величины <code>net_buffer_length</code>
байтов после каждого запроса. Для клиентов размер буфера, связанного с
соединением, не уменьшается, пока не будет закрыто данное соединение и при
этом не будет освобождена выделенная клиенту память.

</P>
<P>
Программирование с учетом потоков описано в разделе See section <A HREF="manual.ru.html#Threaded_clients">8.4.8  Как создать клиентскую программу с потоками</A>. При создании автономного приложения, включающего и "сервер", и
"клиент" в одной и той же программе (и не взаимодействующего с внешним
сервером MySQL), обращайтесь к разделу See section <A HREF="manual.ru.html#libmysqld">8.4.9  libmysqld, встраиваемая библиотека сервера MySQL</A>.

</P>



<H3><A NAME="C_API_datatypes" HREF="manual.ru_toc.html#C_API_datatypes">8.4.1  Типы данных C API</A></H3>

<DL COMPACT>

<DT><code>MYSQL</code>
<DD>
<A NAME="IDX1590"></A>
 
Данная структура представляет дескриптор соединения с базой данных.
Используется почти во всех функциях MySQL.

<A NAME="IDX1591"></A>
<DT><code>MYSQL_RES</code>
<DD>
Эта структура содержит результат запроса, возвратившего строки (<code>SELECT</code>,
<code>SHOW</code>, <code>DESCRIBE</code>, <code>EXPLAIN</code>). Возвращенная из запроса информация далее в этом
разделе называется результирующим набором данных.

<A NAME="IDX1592"></A>
<DT><code>MYSQL_ROW</code>
<DD>
Является ``типобезопасным'' представлением данных одной строки.
В настоящее время этот тип реализован как массив строк с фиксированным
количеством байтов (их нельзя трактовать как строки с нулевым символом в
конце, если величины полей могут содержать двоичные данные, поскольку они
могут содержать ноль байтов). Строки можно получить вызовом функции
<code>mysql_fetch_row()</code>.

<A NAME="IDX1593"></A>
<DT><code>MYSQL_FIELD</code>
<DD>
Данная структура содержит информацию об отдельном поле таблицы: имя поля,
тип и его размер. Элементы данной структуры детально описаны в этом
разделе ниже. Для каждого поля можно получить структуру <code>MYSQL_FIELD</code>,
последовательно вызывая функцию <code>mysql_fetch_field()</code>. Величины полей не
являются частью данной структуры, они содержатся в структуре <code>MYSQL_ROW</code>.

<A NAME="IDX1594"></A>
<DT><code>MYSQL_FIELD_OFFSET</code>
<DD>
``Типобезопасное'' представление позиции поля в списке полей MySQL.
(используется функцией <code>mysql_field_seek()</code>). Позиции представляют собой
номера полей внутри строки, причем нумерация начинается с нуля.

<A NAME="IDX1595"></A>
<A NAME="IDX1596"></A>
<DT><code>my_ulonglong</code>
<DD>
Данный тип используется для возврата количества строк, а также в функциях
<code>mysql_affected_rows()</code>, <code>mysql_num_rows()</code> и <code>mysql_insert_id()</code>. Этот тип
обеспечивает диапазон изменений величин от 0 до 1.84e19. Может не работать
в некоторых системах при выводе величины типа <code>my_ulonglong</code>. Для вывода
подобной величины следует преобразовать ее в тип <code>unsigned long</code> и
использовать формат <code>%lu</code>. Пример:

<PRE>
printf (Количество  строк: %lu\n", (unsigned long) mysql_num_rows(result));
</PRE>

</DL>

<P>
Структура <code>MYSQL_FIELD</code> содержит следующие перечисленные ниже элементы:

</P>
<DL COMPACT>

<DT><code>char * name</code>
<DD>
Имя данного поля, заданное строкой с нулевым символом в конце.

<DT><code>char * table</code>
<DD>
Имя таблицы, содержащей это поле, если оно невычисляемое. Для полей,
получаемых в результате вычислений, величина <code>table</code> представляет собой
пустую строку.

<DT><code>char * def</code>
<DD>
Значение по умолчанию этого поля, заданное строкой с нулевым символом в
конце. Задается только при использовании функции <code>mysql_list_fields()</code>.

<DT><code>enum enum_field_types type</code>
<DD>
Тип данного поля. Величина <code>type</code> может быть одной из следующих:

<TABLE BORDER>
<TR><TD><strong>Тип величины</strong> </TD><TD> <strong>Описание типа</strong>
</TD></TR>
<TR><TD><code>FIELD_TYPE_TINY</code> </TD><TD> Поле <code>TINYINT</code>
</TD></TR>
<TR><TD><code>FIELD_TYPE_SHORT</code> </TD><TD> Поле <code>SMALLINT</code>
</TD></TR>
<TR><TD><code>FIELD_TYPE_LONG</code> </TD><TD> Поле <code>INTEGER</code>
</TD></TR>
<TR><TD><code>FIELD_TYPE_INT24</code> </TD><TD> Поле <code>MEDIUMINT</code>
</TD></TR>
<TR><TD><code>FIELD_TYPE_LONGLONG</code> </TD><TD> Поле <code>BIGINT</code>
</TD></TR>
<TR><TD><code>FIELD_TYPE_DECIMAL</code> </TD><TD> Поле <code>DECIMAL</code> или <code>NUMERIC</code>
</TD></TR>
<TR><TD><code>FIELD_TYPE_FLOAT</code> </TD><TD> Поле <code>FLOAT</code>
</TD></TR>
<TR><TD><code>FIELD_TYPE_DOUBLE</code> </TD><TD> Поле <code>DOUBLE</code> или <code>REAL</code>
</TD></TR>
<TR><TD><code>FIELD_TYPE_TIMESTAMP</code> </TD><TD> Поле <code>TIMESTAMP</code>
</TD></TR>
<TR><TD><code>FIELD_TYPE_DATE</code> </TD><TD> Поле <code>DATE</code>
</TD></TR>
<TR><TD><code>FIELD_TYPE_TIME</code> </TD><TD> Поле <code>TIME</code>
</TD></TR>
<TR><TD><code>FIELD_TYPE_DATETIME</code> </TD><TD> Поле <code>DATETIME</code>
</TD></TR>
<TR><TD><code>FIELD_TYPE_YEAR</code> </TD><TD> Поле <code>YEAR</code>
</TD></TR>
<TR><TD><code>FIELD_TYPE_STRING</code> </TD><TD> Строка поля (<code>CHAR</code> или <code>VARCHAR</code>)
</TD></TR>
<TR><TD><code>FIELD_TYPE_BLOB</code> </TD><TD> <code>BLOB</code> или <code>TEXT</code> поле (используется <code>max_length</code> для определения максимальной длинны)
</TD></TR>
<TR><TD><code>FIELD_TYPE_SET</code> </TD><TD> Поле типа <code>SET</code>
</TD></TR>
<TR><TD><code>FIELD_TYPE_ENUM</code> </TD><TD> Поле типа <code>ENUM</code>
</TD></TR>
<TR><TD><code>FIELD_TYPE_NULL</code> </TD><TD> Поле типа <code>NULL</code>
</TD></TR>
<TR><TD><code>FIELD_TYPE_CHAR</code> </TD><TD> Не рекомендуется; лучше использовать <code>FIELD_TYPE_TINY</code>
</TD></TR>
</TABLE>

Можно использовать макрос <code>IS_NUM()</code> для проверки, является ли тип поля
числовым. В макросе <code>IS_NUM()</code> следует указать величину <code>type</code> и, если поле
имеет числовой тип, будет возвращено значение <code>TRUE</code>:


<PRE>
if (IS_NUM(field-&#62;type))
   printf("Field is numeric\n");
</PRE>

<DT><code>unsigned int length</code>
<DD>
Размер данного поля в том виде, в каком он указан в определении таблицы.

<DT><code>unsigned int max_length</code>
<DD>
Максимальный размер данного поля в результирующем наборе данных (длина
самой большой величины поля для строк в текущем результирующем наборе
данных). При использовании <code>mysql_store_result()</code> или <code>mysql_list_fields()</code> 
данная переменная содержит максимальную длину для данного поля. При
использовании <code>mysql_use_result()</code> значение этой переменной равно нулю.

<DT><code>unsigned int flags</code>
<DD>
Различные двоичные флаги для данного поля. Величина <code>flags</code> может иметь ноль
или больше двоичных значений следующего набора флагов:

<TABLE BORDER>
<TR><TD><strong>Значение флага</strong> </TD><TD> <strong>описание флага</strong>
</TD></TR>
<TR><TD><code>NOT_NULL_FLAG</code> </TD><TD> Поле не может содержать значение <code>NULL</code>
</TD></TR>
<TR><TD><code>PRI_KEY_FLAG</code> </TD><TD> Поле является частью первичного ключа
</TD></TR>
<TR><TD><code>UNIQUE_KEY_FLAG</code> </TD><TD> Поле является частью уникального ключа
</TD></TR>
<TR><TD><code>MULTIPLE_KEY_FLAG</code> </TD><TD> Поле является частью не уникального ключа
</TD></TR>
<TR><TD><code>UNSIGNED_FLAG</code> </TD><TD> Поле  имеет  атрибут <code>UNSIGNED</code>
</TD></TR>
<TR><TD><code>ZEROFILL_FLAG</code> </TD><TD> Поле  имеет  атрибут <code>ZEROFILL</code>
</TD></TR>
<TR><TD><code>BINARY_FLAG</code> </TD><TD> Поле  имеет  атрибут <code>BINARY</code>
</TD></TR>
<TR><TD><code>AUTO_INCREMENT_FLAG</code> </TD><TD> Поле  имеет  атрибут <code>AUTO_INCREMENT</code>
</TD></TR>
<TR><TD><code>ENUM_FLAG</code> </TD><TD> Поле имеет тип <code>ENUM</code> (не рекомендуется)
</TD></TR>
<TR><TD><code>SET_FLAG</code> </TD><TD> Поле имеет тип <code>SET</code> (не рекомендуется)
</TD></TR>
<TR><TD><code>BLOB_FLAG</code> </TD><TD> Поле имеет тип <code>BLOB</code> или <code>TEXT</code> (не рекомендуется)
</TD></TR>
<TR><TD><code>TIMESTAMP_FLAG</code> </TD><TD> Поле имеет тип <code>TIMESTAMP</code> (не рекомендуется)
</TD></TR>
</TABLE>

Использование флагов <code>BLOB_FLAG</code>, <code>ENUM_FLAG</code>, <code>SET_FLAG</code> и <code>TIMESTAMP_FLAG</code> не
рекомендуется, поскольку они указывают скорее тип поля, чем атрибут этого
типа. Вместо этого более предпочтительно определять тип поля описанным
выше способом <code>field-&#62;type</code> в отношении полей <code>FIELD_TYPE_BLOB</code>,
<code>FIELD_TYPE_ENUM</code>, <code>FIELD_TYPE_SET</code> или <code>FIELD_TYPE_TIMESTAMP</code>. Следующий пример
иллюстрирует типичное использование величины <code>flags</code>:


<PRE>
if (field-&#62;flags &#38; NOT_NULL_FLAG)
   printf("Field can't be null\n");
</PRE>

Можно использовать следующие возможности макросов для определения булевого
значения величины <code>flags</code>:

<TABLE BORDER>
<TR><TD><strong>Статус флага</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD><code>IS_NOT_NULL(flags)</code> </TD><TD> Возвращает TRUE, если данное поле определено как <code>NOT NULL</code>
</TD></TR>
<TR><TD><code>IS_PRI_KEY(flags)</code> </TD><TD> Возвращает TRUE, если данное поле является первичным ключом
</TD></TR>
<TR><TD><code>IS_BLOB(flags)</code> </TD><TD> Возвращает TRUE, если данное поле имеет тип <code>BLOB</code> или <code>TEXT</code> (не рекомендуется; более предпочтительно <code>field-&#62;type</code>)
</TD></TR>
</TABLE>

<DT><code>unsigned int decimals</code>
<DD>
Возвращает число десятичных знаков для числовых полей.
</DL>



<H3><A NAME="C_API_function_overview" HREF="manual.ru_toc.html#C_API_function_overview">8.4.2  Обзор функций интерфейса C</A></H3>

<P>
<A NAME="IDX1597"></A>
<A NAME="IDX1598"></A>

</P>
<P>
В приведенной ниже таблице перечислены доступные в интерфейсе C функции.
Более детально они описаны в следующем разделе (see section <A HREF="manual.ru.html#C_API_functions">8.4.3  Описание функций интерфейса C</A>).
<TABLE BORDER>
<TR><TD><strong>Функция</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD><strong>mysql_affected_rows()</strong> </TD><TD>
Возвращает количество строк, измененных/удаленных/вставленных последним запросом <code>UPDATE</code>, <code>DELETE</code> или <code>INSERT</code>.
</TD></TR>
<TR><TD><strong>mysql_change_user()</strong> </TD><TD> Переключает пользователя и базу данных для открытого соединения.

</TD></TR>
<TR><TD><strong>mysql_character_set_name()</strong> </TD><TD> Возвращает название кодировки, установленной для данного соединения.

</TD></TR>
<TR><TD><strong>mysql_close()</strong> </TD><TD> Закрывает соединение с сервером.

</TD></TR>
<TR><TD><strong>mysql_connect()</strong> </TD><TD> Создает соединение с сервером баз данных MySQL. Данная функция не рекомендуется; вместо нее следует использовать функцию <code>mysql_real_connect()</code>.

</TD></TR>
<TR><TD><strong>mysql_create_db()</strong> </TD><TD> Создает базу данных. Данная функция не рекомендуется; вместо нее следует использовать команду SQL <code>CREATE DATABASE</code>.

</TD></TR>
<TR><TD><strong>mysql_data_seek()</strong> </TD><TD> Ищет произвольную строку в результирующем наборе запроса.

</TD></TR>
<TR><TD><strong>mysql_debug()</strong> </TD><TD> Выполняет отладочные операции <code>DBUG_PUSH</code> с заданной строкой.

</TD></TR>
<TR><TD><strong>mysql_drop_db()</strong> </TD><TD> Удаляет базу данных. Эта функция не рекомендуется; вместо нее следует использовать команду SQL <code>DROP DATABASE</code>.

</TD></TR>
<TR><TD><strong>mysql_dump_debug_info()</strong> </TD><TD> Заставляет сервер записывать отладочную информацию в журнал.

</TD></TR>
<TR><TD><strong>mysql_eof()</strong> </TD><TD> Определяет, была ли данная строка последней из прочитанных в результирующем наборе данных. Эта функция не рекомендуется; <code>mysql_errno()</code> или <code>mysql_error()</code> могут быть использованы вместо нее.

</TD></TR>
<TR><TD><strong>mysql_errno()</strong> </TD><TD> Возвращает номер ошибки для последней запущенной функции MySQL.

</TD></TR>
<TR><TD><strong>mysql_error()</strong> </TD><TD> Возвращает сообщение об ошибке для последней запущенной функции MySQL.

</TD></TR>
<TR><TD><strong>mysql_escape_string()</strong> </TD><TD> Экранирует специальные символы в строке, чтобы ее было возможно использовать в команде SQL.

</TD></TR>
<TR><TD><strong>mysql_fetch_field()</strong> </TD><TD> Возвращает тип следующего поля таблицы.

</TD></TR>
<TR><TD><strong>mysql_fetch_field_direct()</strong> </TD><TD> Возвращает тип поля таблицы по заданному номеру поля.

</TD></TR>
<TR><TD><strong>mysql_fetch_fields()</strong> </TD><TD> Возвращает массив структур, содержащих информацию обо всех полях.

</TD></TR>
<TR><TD><strong>mysql_fetch_lengths(</strong>) </TD><TD> Возвращает массив длин всех столбцов в текущей строке.

</TD></TR>
<TR><TD><strong>mysql_fetch_row()</strong> </TD><TD> Извлекает следующую строку из результирующего набора.

</TD></TR>
<TR><TD><strong>mysql_field_seek()</strong> </TD><TD> Устанавливает курсор столбцов на заданный столбец.

</TD></TR>
<TR><TD><strong>mysql_field_count()</strong> </TD><TD> Возвращает количество столбцов в результате для последнего запроса.

</TD></TR>
<TR><TD><strong>mysql_field_tell()</strong> </TD><TD> Возвращает значение положения курсора поля для последнего вызова <code>mysql_fetch_field()</code>.

</TD></TR>
<TR><TD><strong>mysql_free_result(</strong>) </TD><TD> Освобождает память, использованную для результирующего набора.

</TD></TR>
<TR><TD><strong>mysql_get_client_info()</strong> </TD><TD> Возвращает информацию о версии клиента.

</TD></TR>
<TR><TD><strong>mysql_get_host_info()</strong> </TD><TD> Возвращает строку, описывающую параметры текущего соединения.

</TD></TR>
<TR><TD><code>mysql_get_server_version()</code> </TD><TD> Возвращает номер версии сервера как целое число (новое с 4.1)

</TD></TR>
<TR><TD><strong>mysql_get_proto_info()</strong> </TD><TD> Возвращает версию протокола, используемого для данного соединения.

</TD></TR>
<TR><TD><strong>mysql_get_server_info()</strong> </TD><TD> Возвращает номер версии сервера баз данных.

</TD></TR>
<TR><TD><strong>mysql_info()</strong> </TD><TD> Возвращает информацию о последнем выполненном запросе.

</TD></TR>
<TR><TD><strong>mysql_init()</strong> </TD><TD> Выделяет или инициализирует какую-либо структуру MYSQL.

</TD></TR>
<TR><TD><strong>mysql_insert_id()</strong> </TD><TD> Возвращает идентификатор, сгенерированный для столбца <code>AUTO_INCREMENT</code> предыдущим запросом.

</TD></TR>
<TR><TD><strong>mysql_kill()</strong> </TD><TD> Уничтожает заданный поток.

</TD></TR>
<TR><TD><strong>mysql_list_dbs()</strong> </TD><TD> Возвращает имена баз данных, совпадающие с простым регулярным выражением.

</TD></TR>
<TR><TD><strong>mysql_list_fields()</strong> </TD><TD> Возвращает имена полей, совпадающих с простым регулярным выражением.

</TD></TR>
<TR><TD><strong>mysql_list_processes()</strong> </TD><TD> Возвращает список текущих потоков на сервере.

</TD></TR>
<TR><TD><strong>mysql_list_tables()</strong> </TD><TD> Возвращает имена таблиц, совпадающих с простым регулярным выражением.

</TD></TR>
<TR><TD><strong>mysql_num_fields()</strong> </TD><TD> Возвращает количество столбцов в результирующем наборе.

</TD></TR>
<TR><TD><strong>mysql_num_rows()</strong> </TD><TD> Возвращает количество строк в результирующем наборе.

</TD></TR>
<TR><TD><strong>mysql_options()</strong> </TD><TD> Устанавливает параметры соединения для <code>mysql_connect()</code>.

</TD></TR>
<TR><TD><strong>mysql_ping()</strong> </TD><TD> Проверяет, работает ли данное соединение с сервером, и восстанавливает соединение при необходимости.

</TD></TR>
<TR><TD><strong>mysql_query()</strong> </TD><TD> Выполняет SQL-запрос, заданный в виде строки с нулевым символом в конце.

</TD></TR>
<TR><TD><strong>mysql_real_connect()</strong> </TD><TD> Создает соединение с сервером баз данных MySQL.

</TD></TR>
<TR><TD><strong>mysql_real_escape_string()</strong> </TD><TD> Экранирует специальные символы в строке, чтобы обеспечить возможность использования ее в команде SQL, с учетом установленной для данного соединения кодировки.

</TD></TR>
<TR><TD><strong>mysql_real_query()</strong> </TD><TD> Выполняет SQL-запрос, заданный в виде фиксированной строки.

</TD></TR>
<TR><TD><strong>mysql_reload()</strong> </TD><TD> Предписывает серверу перегрузить таблицы привилегий.

</TD></TR>
<TR><TD><strong>mysql_row_seek()</strong> Устанавливает курсор на заданную строку в результирующем наборе, используя величину, возвращенную из <code>mysql_row_tell()</code>.

</TD></TR>
<TR><TD><strong>mysql_row_tell()</strong> </TD><TD> Возвращает положение курсора строки.

</TD></TR>
<TR><TD><strong>mysql_select_db()</strong> </TD><TD> Выбирает базу данных.

</TD></TR>
<TR><TD><strong>mysql_shutdown()</strong> </TD><TD> Останавливает сервер баз данных.

</TD></TR>
<TR><TD><strong>mysql_stat()</strong> </TD><TD> Возвращает информацию о текущем статусе сервера баз данных в виде строки.

</TD></TR>
<TR><TD><strong>mysql_store_result()</strong> </TD><TD> Извлекает полный результирующий набор для данного клиента.

</TD></TR>
<TR><TD><strong>mysql_thread_id()</strong> </TD><TD> Возвращает идентификатор текущего потока.

</TD></TR>
<TR><TD><strong>mysql_thread_safe()</strong> </TD><TD> Возвращает 1, если клиенты скомпилированы как поддерживающие потоки.

</TD></TR>
<TR><TD><strong>mysql_use_result()</strong> </TD><TD> Инициализирует построчное извлечение результирующего набора.
</TD></TR>
</TABLE>

</P>
<P>
При подсоединения к серверу необходимо вызвать функцию <code>mysql_init()</code> для
инициализации дескриптора соединения, затем с этим дескриптором вызвать
функцию <code>mysql_real_connect()</code> (которая содержит такую информацию, как имя
данного хоста, имя пользователя и пароль). После соединения функция
<code>mysql_real_connect()</code> устанавливает флаг <code>reconnect</code> (часть данной структуры
MYSQL) в значение <code>1</code>. Этот флаг указывает, что в случае, если запрос не
может быть выполнен из-за потери соединения, следует попытаться
восстановить соединение с сервером до окончательного отказа от него. Для
закрытия соединения вызывается функция <code>mysql_close()</code>.

</P>
<P>
При активном соединении клиент может посылать SQL-запросы на сервер,
используя функции <code>mysql_query()</code> или <code>mysql_real_query()</code>. Разница между
этими двумя функциями состоит в том, что <code>mysql_query()</code> работает с
запросом, представленным в виде строки с нулевыми окончаниями, в то время,
как <code>mysql_real_query()</code> работает со строками фиксированной длины. Если
данная строка содержит двоичные данные (которые могут состоять из нуля
байтов), то необходимо использовать <code>mysql_real_query()</code>.

</P>
<P>
Для каждого запроса без выборки данных (т.е. не вида <code>SELECT</code>, а, например,
<code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>) можно узнать количество измененных (затронутых)
строк путем вызова функции <code>mysql_affected_rows()</code>.

</P>
<P>
Для запросов <code>SELECT</code> можно извлечь выбранные строки как результирующий
набор. (Следует учитывать, что некоторые команды сходны с <code>SELECT</code> в том
смысле, что они тоже возвращают строки. Это команды <code>SHOW</code>, <code>DESCRIBE</code> и
<code>EXPLAIN</code>. Они должны трактоваться тем же образом, что и команды <code>SELECT</code>.)

</P>
<P>
Для клиента существует два способа обработки результирующих наборов
данных. Первый состоит в извлечении сразу всего результирующего набора
целиком вызовом функции <code>mysql_store_result()</code>. Эта функция забирает с
сервера все строки, возвращенные запросом, и хранит их в данном клиенте.
Второй способ заключается в инициализации для клиента построчного
извлечения результирующего набора путем вызова функции <code>mysql_use_result()</code>.
Эта функция инициализирует указанное извлечение, но фактически не получает
с сервера ни одной строки.

</P>
<P>
В обоих случаях доступ к строкам происходит с помощью функции
<code>mysql_fetch_row()</code>. Совместно с <code>mysql_store_result()</code> <code>mysql_fetch_row()</code> 
осуществляет доступ к строкам, уже извлеченным с сервера. Совместно с
<code>mysql_use_result()</code> <code>mysql_fetch_row()</code> реально получает данную строку с
сервера. Информацию о размере данных в каждой строке можно получить
вызовом функции <code>mysql_fetch_lengths()</code>.

</P>
<P>
После выполнения операций с результирующим набором необходимо вызвать
функцию <code>mysql_free_result()</code>, чтобы освободить использованную для этого
память.

</P>
<P>
Два описанных выше механизма извлечения данных являются
взаимодополняющими. Клиентские программы должны выбирать наиболее
подходящий для их требований способ. На практике клиенты обычно стремятся
использовать функцию <code>mysql_store_result()</code>.

</P>
<P>
Преимущество функции <code>mysql_store_result()</code> состоит в том, что, поскольку
все строки выбраны и находятся у клиента, то возможен не только
последовательный доступ к строкам. В результирующем наборе данных можно
перемещаться назад и вперед в, используя функции <code>mysql_data_seek()</code> или
<code>mysql_row_seek()</code>, чтобы изменить положение текущей строки внутри
результирующего набора. Можно также узнать количество находящихся в нем
строк, вызвав функцию <code>mysql_num_rows()</code>. С другой стороны, для
<code>mysql_store_result()</code> требования к памяти могут быть очень высокими для
обширных результирующих наборов, что может привести к нехватке памяти.

</P>
<P>
Преимущество функции <code>mysql_use_result()</code> заключается в том, что клиент
требует меньше памяти для результирующего набора, поскольку он сохраняет
только одну строку единовременно (и, так как это меньше перегружает
память, то функция <code>mysql_use_result()</code> может быть быстрее). Недостатками
являются: необходимость обрабатывать каждую строку быстро, чтобы избежать
связывания сервера, невозможность произвольного доступа к строкам внутри
результирующего набора (возможен только последовательный доступ к
строкам), невозможность узнать количество строк в результирующем наборе до
его полного извлечения. Более того, необходимо извлекать все строки, даже
если в середине извлечения станет ясно, что искомая информация найдена.

</P>
<P>
Благодаря интерфейсу клиенты получают возможность соответствующим образом
реагировать на запросы (извлекать строки только при необходимости) без
уточнения, являлся или нет данный запрос выборкой. Это можно делать,
вызывая функцию <code>mysql_store_result()</code> после каждого вызова <code>mysql_query()</code> 
(или <code>mysql_real_query()</code>). Если вызов результирующего набора был успешным,
то данный запрос принадлежал к виду <code>SELECT</code> и можно производить чтение
строк. Если вызов результирующего набора не удался, можно вызвать функцию
<code>mysql_field_count()</code> для определения, можно ли было действительно ожидать
результат. Если <code>mysql_field_count()</code> возвращает нуль, то данный запрос не
возвратил никаких данных (это указывает, что запрос был вида <code>INSERT</code>,
<code>UPDATE</code>, <code>DELETE</code> и т.д.), и не следовало ожидать возвращенных строк. Если
функция <code>mysql_field_count()</code> является ненулевой, данный запрос должен был
возвратить результат, но не сделал этого. Это указывает, что данный запрос
был типа <code>SELECT</code>, но его выполнение оказалось неуспешным (см. пример в
описании функции <code>mysql_field_count()</code>).

</P>
<P>
Как <code>mysql_store_result()</code> так и <code>mysql_use_result()</code> позволяют получить
информацию о полях, составляющих результирующий набор (количество полей,
их имена и типы и т.д.). Можно получить последовательный доступ к
информации о полях внутри строки путем повторного вызова функции
<code>mysql_fetch_field()</code> или к номеру поля внутри строки с помощью функции
<code>mysql_fetch_field_direct()</code>. Текущее положение курсора поля может быть
изменено вызовом функции <code>mysql_field_seek()</code>. Установка курсора
производится последующим вызовом функции <code>mysql_fetch_field()</code>. Можно также
получить информацию для всех полей сразу с помощью функции
<code>mysql_fetch_fields()</code>.

</P>
<P>
Для обнаружения ошибок и сообщения о них MySQL обеспечивает доступ к
информации об ошибках посредством функций <code>mysql_errno()</code> и <code>mysql_error()</code>.
Они возвращают код ошибки или сообщение об ошибке для последней запущенной
функции (которая может быть успешной или не выполниться), позволяя
определить место возникновения и характер ошибки.

</P>


<H3><A NAME="C_API_functions" HREF="manual.ru_toc.html#C_API_functions">8.4.3  Описание функций интерфейса C</A></H3>

<P>
В приведенных здесь описаниях параметр или возвращаемая величина,
обозначенная как <code>NULL</code>, означает <code>NULL</code> в терминах языка программирования C,
а не величину <code>NULL</code> в MySQL.

</P>
<P>
Функции, возвращающие величину, обычно возвращают указатель или целое
число. Если не указано иначе, то функции, возвращающие указатель,
возвращают величину не-<code>NULL</code> при успешном выполнении или величину <code>NULL</code>,
указывающую на ошибку, а функции, возвращающие целое число, возвращают
нуль при успешном выполнении или ненулевую величину при возникновении
ошибки. Следует учитывать, что термин ``ненулевая величина'' означает
именно это. Если в описании функции не сказано иначе, то не следует
пробовать интерпретировать эту величину иначе, чем нуль:

</P>

<PRE>
if (result)		 /* правильно */
   ... error ...
if (result &#60; 0)		 /* неправильно */
   ... error ...
if (result == -1)	 /* неправильно */
   ... error ...
</PRE>

<P>
Если функция возвращает ошибку, то возможные типы ошибок представлены в ее
описании в подраздел <strong>Ошибки</strong>. Вызвав функцию <code>mysql_errno()</code>, можно узнать,
какие именно ошибки произошли. Строковое представление ошибки можно
получить, вызывая функцию <code>mysql_error()</code>.

</P>


<H4><A NAME="mysql_affected_rows" HREF="manual.ru_toc.html#mysql_affected_rows">8.4.3.1  <code>mysql_affected_rows()</code></A></H4>

<P>
<A NAME="IDX1599"></A>

</P>
<P>
<code>my_ulonglong mysql_affected_rows(MYSQL *mysql)</code>

</P>

<H4>Описание</H4>

<P>
Возвращает количество строк, измененных последней командой <code>UPDATE</code>,
удаленных последней командой <code>DELETE</code> или вставленных последней командой
<code>INSERT</code>. Может быть вызвана немедленно после <code>mysql_query()</code> для команд
<code>UPDATE</code>, <code>DELETE</code> или <code>INSERT</code>. Для команд <code>SELECT</code> <code>mysql_affected_rows()</code> 
работает аналогично <code>mysql_num_rows()</code>.

</P>

<H4>Возвращаемые значения</H4>

<P>
Целое число больше нуля равно количеству строк, подвергшихся воздействию
или извлеченных. Нуль указывает, что ни одна из записей не была обновлена
для команды <code>UPDATE</code>, ни одна из строк не совпала с утверждением <code>WHERE</code> в
данном запросе или что ни один запрос еще не был выполнен. Значение -1
показывает, что данный запрос возвратил ошибку или что для запроса <code>SELECT</code>
функция <code>mysql_affected_rows()</code> была вызвана прежде вызова функции
<code>mysql_store_result()</code>.

</P>

<H4>Ошибки</H4>

<P>
Нет.

</P>

<H4>Пример</H4>


<PRE>
mysql_query(&#38;mysql,"UPDATE products SET cost=cost*1.25 WHERE group=10");
printf("%ld products updated",(long) mysql_affected_rows(&#38;mysql));
</PRE>

<P>
Если указывается флаг <code>CLIENT_FOUND_ROWS</code> при подключении к <code>mysqld</code>, то
<code>mysql_affected_rows()</code> возвратит количество строк, соответствующих
выражению <code>WHERE</code> для команд <code>UPDATE</code>.

</P>
<P>
Следует отметить, что при использовании команды <code>REPLACE</code> функция
<code>mysql_affected_rows()</code> возвратит значение 2, если новая строка заменила
старую. Это происходит по той причине, что в данном случае одна строка
была внесена после того как дублирующая была удалена.

</P>


<H4><A NAME="mysql_change_user" HREF="manual.ru_toc.html#mysql_change_user">8.4.3.2  <code>mysql_change_user()</code></A></H4>

<P>
<A NAME="IDX1600"></A>

</P>
<P>
<code>my_bool mysql_change_user(MYSQL *mysql, const char *user, const
char *password, const char *db)</code>

</P>

<H4>Описание</H4>

<P>
Изменяет пользователя и устанавливает базу данных, указанную в аргументе
<code>db</code> в качестве текущей по базы данных для соединения, заданного в аргументе
<code>mysql</code>. В последующих запросах эта база данных является текущей по
умолчанию для табличных ссылок, которые не содержат явного указателя базы
данных.

</P>
<P>
Эта функция была введена в версию MySQL 3.23.3.

</P>
<P>
Функция <code>mysql_change_user()</code> не выполняется, если подключенный пользователь
не может быть аутентифицирован или если он не имеет разрешения на
использование этой базы данных. В таком случае данный пользователь и база
данных не изменяются.

</P>
<P>
Параметр <code>db</code> может быть установлен в <code>NULL</code>, если база данных по умолчанию не
нужна.

</P>
<P>
Начиная с версии 4.0.6 будет всегда производить откат любой начатой транзакции,
закрывать все временные таблицы, снимать блокировку со всех заблокированных
таблиц и переустанавливать состояние, если произошло новое соединение. Это
будет происходить даже в том случае, если имя пользователя не изменится.

</P>

<H4>Возвращаемые значения</H4>

<P>
Нуль при успешном выполнении. Ненулевая величина, если возникла ошибка.

</P>

<H4>Ошибки</H4>

<P>
Те же, что и для <code>mysql_real_connect()</code>.

</P>
<DL COMPACT>

<DT><code>CR_COMMANDS_OUT_OF_SYNC</code>
<DD>
Команды были выполнены в ненадлежащем порядке.

<DT><code>CR_SERVER_GONE_ERROR</code>
<DD>
Сервер MySQL неожиданно завершил работу.

<DT><code>CR_SERVER_LOST</code>
<DD>
Соединение с сервером прервалось в процессе данного запроса.

<DT><code>CR_UNKNOWN_ERROR</code>
<DD>
Произошла неизвестная ошибка.

<DT><code>ER_UNKNOWN_COM_ERROR</code>
<DD>
Сервер MySQL не обеспечивает выполнение этой команды (возможно, старая
версия сервера)

<DT><code>ER_ACCESS_DENIED_ERROR</code>
<DD>
Пользователь или пароль ошибочны.

<DT><code>ER_BAD_DB_ERROR</code>
<DD>
Данная база данных не существует.

<DT><code>ER_DBACCESS_DENIED_ERROR</code>
<DD>
Данный пользователь не имеет прав доступа к этой базе данных.

<DT><code>ER_WRONG_DB_NAME</code>
<DD>
Имя базы данных было слишком длинным.
</DL>


<H4>Пример</H4>


<PRE>
if (mysql_change_user(&#38;mysql, "user", "password", "new_database"))
{
  fprintf(stderr, "Failed to change user. Error: %s\n",
  mysql_error(&#38;mysql));
}
</PRE>



<H4><A NAME="mysql_character_set_name" HREF="manual.ru_toc.html#mysql_character_set_name">8.4.3.3  <code>mysql_character_set_name()</code></A></H4>
<P>
<A NAME="IDX1601"></A>

</P>
<P>
<code>const char *mysql_character_set_name(MYSQL *mysql)</code>

</P>

<H4>Описание</H4>

<P>
Возвращает установленную кодировку для текущего подключения.

</P>

<H4>Возвращаемые значения</H4>

<P>
Кодировка, установленная по умолчанию.

</P>

<H4>Ошибки</H4>

<P>
Нет.

</P>


<H4><A NAME="mysql_close" HREF="manual.ru_toc.html#mysql_close">8.4.3.4  <code>mysql_close()</code></A></H4>
<P>
<A NAME="IDX1602"></A>

</P>
<P>
<code>void mysql_close(MYSQL *mysql)</code>

</P>

<H4>Описание</H4>

<P>
Закрывает ранее открытое соединение. Функция <code>mysql_close()</code> также
освобождает дескриптор данного соединения, указанный в <code>mysql</code>, если данный
дескриптор был выделен автоматически функциями <code>mysql_init()</code> или
<code>mysql_connect()</code>.

</P>

<H4>Возвращаемые значения</H4>

<P>
Нет.

</P>

<H4>Ошибки</H4>

<P>
Нет.

</P>


<H4><A NAME="mysql_connect" HREF="manual.ru_toc.html#mysql_connect">8.4.3.5  <code>mysql_connect()</code></A></H4>
<P>
<A NAME="IDX1603"></A>

</P>
<P>
<code>MYSQL *mysql_connect(MYSQL *mysql, const char *host, const char *user, const char *passwd)</code>

</P>

<H4>Описание</H4>

<P>
Данная функция не рекомендуется. Вместо нее предпочтительно использовать
функцию <code>mysql_real_connect()</code>.

</P>
<P>
<code>mysql_connect()</code> пытается установить соединение с сервером баз данных MySQL
, работающим на хосте <code>host</code>. До успешного завершения функции
<code>mysql_connect()</code> нельзя выполнять никакие другие функции интерфейса, за
исключением <code>mysql_get_client_info()</code>.

</P>
<P>
Значения параметров являются теми же самыми, что и для соответствующих
параметров функции <code>mysql_real_connect()</code>, с той разницей, что параметр
соединения может быть <code>NULL</code>. В этом случае интерфейс C автоматически
выделяет память для структуры соединения и освобождает ее при вызове
функции <code>mysql_close()</code>. Недостаток данного подхода состоит в том, что при
падении соединения нельзя получить сообщение об ошибке (чтобы получить
информацию об ошибке из функций <code>mysql_errno()</code> или <code>mysql_error()</code>,
необходимо обеспечить адекватный указатель структуры MYSQL).

</P>

<H4>Возвращаемые значения</H4>

<P>
Те же, что и для <code>mysql_real_connect()</code>.

</P>

<H4>Ошибки</H4>

<P>
Те же, что и для <code>mysql_real_connect()</code>.

</P>


<H4><A NAME="mysql_create_db" HREF="manual.ru_toc.html#mysql_create_db">8.4.3.6  <code>mysql_create_db()</code></A></H4>
<P>
<A NAME="IDX1604"></A>

</P>
<P>
<code>int mysql_create_db(MYSQL *mysql, const char *db)</code>

</P>

<H4>Описание</H4>

<P>
Создает базу данных, указанную в параметре <code>db</code>.

</P>
<P>
Данная функция не рекомендуется. Вместо нее предпочтительно использовать
функцию <code>mysql_query()</code> для выполнения SQL-команды <code>CREATE DATABASE</code>.

</P>

<H4>Возвращаемые значения</H4>

<P>
Нуль, если база данных создана успешно. Ненулевая величина, если произошла
ошибка.

</P>

<H4>Ошибки</H4>

<DL COMPACT>

<DT><code>CR_COMMANDS_OUT_OF_SYNC</code>
<DD>
Команды были выполнены в ненадлежащем порядке.

<DT><code>CR_SERVER_GONE_ERROR</code>
<DD>
Сервер MySQL неожиданно завершил работу.

<DT><code>CR_SERVER_LOST</code>
<DD>
Соединение с сервером прервалось в процессе данного запроса.

<DT><code>CR_UNKNOWN_ERROR</code>
<DD>
Произошла неизвестная ошибка.
</DL>


<H4>Пример</H4>


<PRE>
if(mysql_create_db(&#38;mysql, "my_database"))
{
  fprintf(stderr, "Failed to create new database. Error: %s\n", mysql_error(&#38;mysql));
}
</PRE>



<H4><A NAME="mysql_data_seek" HREF="manual.ru_toc.html#mysql_data_seek">8.4.3.7  <code>mysql_data_seek()</code></A></H4>
<P>
<A NAME="IDX1605"></A>

</P>
<P>
<code>void mysql_data_seek(MYSQL_RES *result, my_ulonglong offset)</code>

</P>

<H4>Описание</H4>

<P>
Ищет произвольную строку в результирующем наборе запроса. Для этого
требуется, чтобы структура результирующего набора содержала целиком весь
результат данного запроса, поэтому <code>mysql_data_seek()</code> может использоваться
только в сочетании с <code>mysql_store_result()</code>, но не с <code>mysql_use_result()</code>.

</P>
<P>
Адрес смещения должен быть величиной в диапазоне от 0 до
<code>mysql_num_rows(result)-1</code>.

</P>

<H4>Возвращаемые значения</H4>

<P>
Нет.

</P>

<H4>Ошибки</H4>

<P>
Нет.

</P>


<H4><A NAME="mysql_debug" HREF="manual.ru_toc.html#mysql_debug">8.4.3.8  <code>mysql_debug()</code></A></H4>
<P>
<A NAME="IDX1606"></A>

</P>
<P>
<code>void mysql_debug(const char *debug)</code>

</P>

<H4>Описание</H4>

<P>
Выполняет отладочные операции <code>DBUG_PUSH</code> с заданной строкой. Функция
<code>mysql_debug()</code> использует отладочную библиотеку <code>Fred Fish debug</code>. Для
использования этой функции необходимо компилировать библиотеку клиента с
поддержкой отладки (см. разделы section <A HREF="manual.ru.html#Debugging_server">D.1  Отладка сервера MySQL</A> и see section <A HREF="manual.ru.html#Debugging_client">D.2  Отладка клиента MySQL</A>).

</P>

<H4>Возвращаемые значения</H4>

<P>
Нет.

</P>

<H4>Ошибки</H4>

<P>
Нет.

</P>

<H4>Пример</H4>

<P>
Представленный здесь вызов функции заставляет библиотеку клиента
генерировать трассировочный файл в каталоге <tt>`/tmp/client.trace'</tt> на
клиентской машине:

</P>

<PRE>
mysql_debug("d:t:O,/tmp/client.trace");
</PRE>



<H4><A NAME="mysql_drop_db" HREF="manual.ru_toc.html#mysql_drop_db">8.4.3.9  <code>mysql_drop_db()</code></A></H4>
<P>
<A NAME="IDX1607"></A>

</P>
<P>
<code>int mysql_drop_db(MYSQL *mysql, const char *db)</code>

</P>

<H4>Описание</H4>

<P>
Уничтожает базу данных, указанную в параметре <code>db</code>.

</P>
<P>
Данная функция не рекомендуется. Вместо нее предпочтительно использовать
функцию <code>mysql_query()</code> для выполнения SQL-команды <code>DROP DATABASE</code>.

</P>

<H4>Возвращаемые значения</H4>

<P>
Нуль, если база данных удалена успешно. Ненулевая величина, если произошла
ошибка.

</P>

<H4>Ошибки</H4>

<DL COMPACT>

<DT><code>CR_COMMANDS_OUT_OF_SYNC</code>
<DD>
Команды были выполнены в ненадлежащем порядке.

<DT><code>CR_SERVER_GONE_ERROR</code>
<DD>
Сервер MySQL неожиданно завершил работу.

<DT><code>CR_SERVER_LOST</code>
<DD>
Соединение с сервером прервалось в процессе данного запроса.

<DT><code>CR_UNKNOWN_ERROR</code>
<DD>
Произошла неизвестная ошибка.
</DL>


<H4>Пример</H4>


<PRE>
if(mysql_drop_db(&#38;mysql, "my_database"))
fprintf(stderr, "Failed to drop the database: Error: %s\n", mysql_error(&#38;mysql));
</PRE>



<H4><A NAME="mysql_dump_debug_info" HREF="manual.ru_toc.html#mysql_dump_debug_info">8.4.3.10  <code>mysql_dump_debug_info()</code></A></H4>
<P>
<A NAME="IDX1608"></A>

</P>
<P>
<code>int mysql_dump_debug_info(MYSQL *mysql)</code>

</P>

<H4>Описание</H4>

<P>
Предписывает серверу производить запись отладочной информации в журнал.
Для работы функции необходимо, чтобы подключенный пользователь имел
привилегию <code>SUPER</code>.

</P>

<H4>Возвращаемые значения</H4>

<P>
Нуль, если команда выполнена успешно. Ненулевая величина, если произошла
ошибка.

</P>

<H4>Ошибки</H4>

<DL COMPACT>

<DT><code>CR_COMMANDS_OUT_OF_SYNC</code>
<DD>
Команды были выполнены в ненадлежащем порядке.

<DT><code>CR_SERVER_GONE_ERROR</code>
<DD>
Сервер MySQL неожиданно завершил работу.

<DT><code>CR_SERVER_LOST</code>
<DD>
Соединение с сервером прервалось в процессе данного запроса.

<DT><code>CR_UNKNOWN_ERROR</code>
<DD>
Произошла неизвестная ошибка.
</DL>



<H4><A NAME="mysql_eof" HREF="manual.ru_toc.html#mysql_eof">8.4.3.11  <code>mysql_eof()</code></A></H4>
<P>
<A NAME="IDX1609"></A>

</P>
<P>
<A NAME="IDX1610"></A>

</P>
<P>
<code>my_bool mysql_eof(MYSQL_RES *result)</code>

</P>

<H4>Описание</H4>

<P>
Данная функция не рекомендуется. Вместо нее можно использовать функции
<code>mysql_errno()</code> или <code>mysql_error()</code>.

</P>
<P>
Функция <code>mysql_eof()</code> определяет, была ли данная строка последней из
прочитанных в результирующем наборе данных.

</P>
<P>
Если результирующий набор получен путем успешного вызова функции
<code>mysql_store_result()</code>, то данный клиент получает полный набор данных за
одну операцию. В этом случае возврат <code>NULL</code> из <code>mysql_fetch_row()</code> всегда
означает, что достигнут конец результирующего набора и нет необходимости в
вызове функции <code>mysql_eof()</code>. При использовании совместно с
<code>mysql_store_result()</code> функция <code>mysql_eof()</code> всегда будет возвращать <code>TRUE</code>.

</P>
<P>
С другой стороны, при использовании <code>mysql_use_result()</code> для инициализации
извлечения результирующего набора, клиент получает строки набора с сервера
поочередно при повторных вызовах функции <code>mysql_fetch_row()</code>. Поскольку в
этом процессе может возникнуть ошибка в соединении, <code>NULL</code>, полученный от
<code>mysql_fetch_row()</code>, не всегда означает что конец результата был достигнут
корректно. В этом случае вы можете использовать <code>mysql_eof()</code>, чтобы
выяснить, что же случилось. <code>mysql_eof()</code> вернет ненулевую величину, если
конец результирующего набора был достигнут, и нуль, если произошла ошибка.

</P>
<P>
Исторически сложилось так, что <code>mysql_eof()</code> по своим задачам сходна со
стандартными функциями обработки ошибок MySQL <code>mysql_errno()</code> и
<code>mysql_error()</code>. Поскольку эти функции дают одну и ту же информацию, их
использование более предпочтительно чем <code>mysql_eof()</code>, которая сейчас
выведена из употребления (в действительности они предоставляют еще больше
информации, т.к. <code>mysql_eof()</code> возвращает только булево значение, в то время
как функции обработки ошибок сообщают причину, по которой ошибка
произошла).

</P>

<H4>Возвращаемые значения</H4>

<P>
Нуль, если ошибок не произошло. Ненулевая величина, если конец
результирующего набора данных достигнут.

</P>

<H4>Ошибки</H4>

<P>
Никаких.

</P>

<H4>Пример</H4>

<P>
Следующий пример иллюстрирует применение <code>mysql_eof()</code>:

</P>

<PRE>
mysql_query(&#38;mysql,"SELECT * FROM some_table");
result = mysql_use_result(&#38;mysql);
while((row = mysql_fetch_row(result)))
{
	// делаем что-то с данными
}
if(!mysql_eof(result)) // mysql_fetch_row() сбойнул из-за ошибки
{
	fprintf(stderr, "Error: %s\n", mysql_error(&#38;mysql));
}
</PRE>

<P>
Того же эффекта вы можете достичь с помощью стандартных функций ошибок
MySQL:

</P>

<PRE>
mysql_query(&#38;mysql,"SELECT * FROM some_table");
result = mysql_use_result(&#38;mysql);
while((row = mysql_fetch_row(result)))
{
	// что-то делаем с данными
}
if(mysql_errno(&#38;mysql)) // mysql_fetch_row() сбойнул из-за ошибки
{
fprintf(stderr, "Error: %s\n", mysql_error(&#38;mysql));
}
</PRE>



<H4><A NAME="mysql_errno" HREF="manual.ru_toc.html#mysql_errno">8.4.3.12  <code>mysql_errno()</code></A></H4>
<P>
<A NAME="IDX1611"></A>

</P>
<P>
<code>unsigned int mysql_errno(MYSQL *mysql)</code>

</P>

<H4>Описание</H4>

<P>
Для соединения, указанного в <code>mysql</code>, функция <code>mysql_errno()</code> возвращает код
ошибки для последней запущенной функции интерфейса, которая может быть
успешной или не выполниться. Возвращение нулевой величины означает, что
ошибка не возникала. Номера сообщений об ошибке для клиентов перечислены в
заголовочном файле MySQL <tt>`errmsg.h'</tt>. Номера серверных сообщений об ошибке
даны в файле <tt>`mysqld_error.h'</tt>. В исходном дистрибутиве MySQL можно найти
полный список сообщений об ошибках и номеров ошибок в файле
<tt>`Docs/mysqld_error.txt'</tt>.

</P>

<H4>Возвращаемые значения</H4>

<P>
Значение кода ошибки. Нуль, если ошибка не возникала.

</P>

<H4>Ошибки</H4>

<P>
Нет.

</P>


<H4><A NAME="mysql_error" HREF="manual.ru_toc.html#mysql_error">8.4.3.13  <code>mysql_error()</code></A></H4>
<P>
<A NAME="IDX1612"></A>

</P>
<P>
<code>char *mysql_error(MYSQL *mysql)</code>

</P>

<H4>Описание</H4>

<P>
Для соединения, указанного в <code>mysql</code>, функция <code>mysql_error()</code> возвращает
сообщение об ошибке для последней вызванной функции интерфейса, которая
может быть успешной или не выполниться. Если ошибка не возникала, то
возвращается пустая строка (<code>""</code>). Это означает, что следующие две проверки
эквивалентны:

</P>

<PRE>
if(mysql_errno(&#38;mysql))
{
	// ошибка  возникла
}
if(mysql_error(&#38;mysql)[0] != '\0')
{
	// ошибка возникла
}
</PRE>

<P>
Язык клиентских сообщений об ошибке может быть изменен путем
перекомпилирования клиентской библиотеки MySQL. В настоящее время можно
выбирать для вывода сообщений об ошибке один из нескольких различных
естественных языков (see section <A HREF="manual.ru.html#Languages">4.6.2  Сообщения об ошибках на языках, отличных от английского</A>).

</P>

<H4>Возвращаемые значения</H4>

<P>
Символьная строка с описанием ошибки. Пустая строка, если ошибка не
возникала.

</P>

<H4>Ошибки</H4>

<P>
Нет.

</P>


<H4><A NAME="mysql_escape_string" HREF="manual.ru_toc.html#mysql_escape_string">8.4.3.14  <code>mysql_escape_string()</code></A></H4>
<P>
<A NAME="IDX1613"></A>

</P>
<P>
Вместо этой функции следует использовать функцию
<code>mysql_real_escape_string()</code>!

</P>
<P>
Данная функция идентична функции <code>mysql_real_escape_string()</code>, за
исключением  того, что <code>mysql_real_escape_string()</code> принимает дескриптор
соединения в качестве своего первого аргумента и экранирует строку в
соответствии с текущей кодировкой. Функция <code>mysql_escape_string()</code> не
требует параметров соединения в качестве аргумента и не учитывает
установки текущей кодировки.

</P>


<H4><A NAME="mysql_fetch_field" HREF="manual.ru_toc.html#mysql_fetch_field">8.4.3.15  <code>mysql_fetch_field()</code></A></H4>
<P>
<A NAME="IDX1614"></A>

</P>
<P>
<code>MYSQL_FIELD *mysql_fetch_field(MYSQL_RES *result)</code>

</P>

<H4>Описание</H4>

<P>
Возвращает определение одного столбца из результирующего набора в виде
структуры <code>MYSQL_FIELD</code>. Для извлечения информации обо всех столбцах в
результирующем наборе следует вызывать эту функцию повторно. Если полей
больше не остается, функция <code>mysql_fetch_field()</code> возвращает <code>NULL</code>.

</P>
<P>
Каждый раз при выполнении нового запроса <code>SELECT</code> функция
<code>mysql_fetch_field()</code> сбрасывается в исходное состояние, чтобы возвращать
информацию о первом поле. На поле, возвращенное функцией
<code>mysql_fetch_field()</code>, также  можно воздействовать, вызвав функцию
<code>mysql_field_seek()</code>.

</P>
<P>
Если вызвана функция <code>mysql_query()</code> для выполнения команды <code>SELECT</code> на
таблице, но не вызвана функция <code>mysql_store_result</code>(), то MySQL возвращает
установленную по умолчанию длину данных типа <code>BLOB</code> (8 Kб) при вызове
функции <code>mysql_fetch_field</code>() для выяснения длины поля <code>BLOB</code> (Размер 8 Kб
выбран потому, что MySQL в этом случае не знает максимальной длины для
<code>BLOB</code>. Когда-нибудь эта конфигурация будет сделана перестраиваемой.)
Поскольку результирующий набор извлечен, то выражение <code>field-&#62;max_length</code> 
содержит длину наибольшей величины для данного столбца в указанном
запросе.

</P>

<H4>Возвращаемые значения</H4>

<P>
Структура <code>MYSQL_FIELD</code> для текущего столбца. <code>NULL</code>, если полей больше не
остается.

</P>

<H4>Ошибки</H4>

<P>
Нет.

</P>

<H4>Пример</H4>


<PRE>
MYSQL_FIELD *field;
while((field = mysql_fetch_field(result)))
{
	printf("field name %s\n", field-&#62;name);
}
</PRE>



<H4><A NAME="mysql_fetch_field_direct" HREF="manual.ru_toc.html#mysql_fetch_field_direct">8.4.3.16  <code>mysql_fetch_field_direct()</code></A></H4>
<P>
<A NAME="IDX1615"></A>

</P>
<P>
<code>MYSQL_FIELD *mysql_fetch_field_direct(MYSQL_RES *result, unsigned int fieldnr)</code>

</P>

<H4>Описание</H4>

<P>
По заданному номеру поля <code>fieldnr</code> для столбца внутри результирующего набора
возвращает определение данного поля столбца как структуру <code>MYSQL_FIELD</code>. Эту
функцию можно использовать для извлечения определения для произвольного
столбца. Величина <code>fieldnr</code> должна находиться в диапазоне от 0 до
<code>mysql_num_fields(result)-1</code>.

</P>

<H4>Возвращаемые значения</H4>

<P>
Структура <code>MYSQL_FIELD</code> для указанного столбца.

</P>

<H4>Ошибки</H4>

<P>
Нет.

</P>

<H4>Пример</H4>


<PRE>
unsigned int num_fields;
unsigned int i;
MYSQL_FIELD *field;
num_fields = mysql_num_fields(result);
for(i = 0; i &#60; num_fields; i++)
{
	field = mysql_fetch_field_direct(result, i);
	printf("Field %u is %s\n", i, field-&#62;name);
}
</PRE>



<H4><A NAME="mysql_fetch_fields" HREF="manual.ru_toc.html#mysql_fetch_fields">8.4.3.17  <code>mysql_fetch_fields()</code></A></H4>
<P>
<A NAME="IDX1616"></A>

</P>
<P>
<code>MYSQL_FIELD *mysql_fetch_fields(MYSQL_RES *result)</code>

</P>

<H4>Описание</H4>

<P>
Возвращает массив всех структур <code>MYSQL_FIELD</code> для результирующего набора
данных. Каждая структура предоставляет определение данного поля в одном
столбце результирующего набора.

</P>

<H4>Возвращаемые значения</H4>

<P>
Массив структур <code>MYSQL_FIELD</code> для всех столбцов результирующего набора.

</P>

<H4>Ошибки</H4>

<P>
Нет.

</P>

<H4>Пример</H4>


<PRE>
unsigned int num_fields;
unsigned int i;
MYSQL_FIELD *fields;

num_fields = mysql_num_fields(result);
fields = mysql_fetch_fields(result);
for(i = 0; i &#60; num_fields; i++)
{
	printf("Field %u is %s\n", i, fields[i].name);
}
</PRE>



<H4><A NAME="mysql_fetch_lengths" HREF="manual.ru_toc.html#mysql_fetch_lengths">8.4.3.18  <code>mysql_fetch_lengths()</code></A></H4>
<P>
<A NAME="IDX1617"></A>

</P>
<P>
<code>unsigned long *mysql_fetch_lengths(MYSQL_RES *result)</code>

</P>

<H4>Описание</H4>

<P>
Возвращает длины столбцов текущей строки внутри результирующего набора
данных. Если вы планируете копировать величины столбцов, то эта информация
о длинах полезна также для оптимизации, поскольку помогает избежать вызова
функции <code>strlen()</code>. Кроме того, если результирующий набор содержит двоичные
данные, то необходимо использовать рассматриваемую функцию для определения
размера этих данных, поскольку функция <code>strlen()</code> возвращает некорректные
результаты для поля, содержащего символы <code>NULL</code>.

</P>
<P>
Искомая длина для пустых столбцов и для столбцов, содержащих величины
<code>NULL</code>, равна нулю. Чтобы увидеть, как следует различать эти два случая, см.
описание для функции <code>mysql_fetch_row()</code>.

</P>

<H4>Возвращаемые значения</H4>

<P>
Массив беззнаковых целых чисел, представляющий собой размер каждого
столбца (не включая конечные нулевые символы). <code>NULL</code> если произошла ошибка.

</P>

<H4>Ошибки</H4>

<P>
Функция <code>mysql_fetch_lengths()</code> действительна только для данной текущей
строки в результирующем наборе данных. Она возвращает <code>NULL</code>, если ее вызов
происходит до вызова функции <code>mysql_fetch_row()</code> или после извлечения всех
строк в результате.

</P>

<H4>Пример</H4>

<PRE>
MYSQL_ROW row;
unsigned long *lengths;
unsigned int num_fields;
unsigned int i;

row = mysql_fetch_row(result);
if (row)
{
	num_fields = mysql_num_fields(result);
	lengths = mysql_fetch_lengths(result);
	for(i = 0; i &#60; num_fields; i++)
	{
		printf("Column %u is %lu bytes in length.\n", i, lengths[i]);
	}
}
</PRE>



<H4><A NAME="mysql_fetch_row" HREF="manual.ru_toc.html#mysql_fetch_row">8.4.3.19  <code>mysql_fetch_row()</code></A></H4>
<P>
<A NAME="IDX1618"></A>

</P>
<P>
<code>MYSQL_ROW mysql_fetch_row(MYSQL_RES *result)</code>

</P>

<H4>Описание</H4>

<P>
Извлекает следующую строку в результирующем наборе данных. При
использовании после функции <code>mysql_store_result()</code> функция <code>mysql_fetch_row()</code> 
возвращает <code>NULL</code>, если больше не осталось строк для извлечения. При
использовании после функции <code>mysql_use_result()</code> функция
<code>mysql_fetch_row()</code> возвращает <code>NULL</code>, если больше не осталось строк для
извлечения или если произошла ошибка.

</P>
<P>
Количество величин в данной строке задается в <code>mysql_num_fields(result)</code>.
Если параметр <code>row</code> содержит возвращенные значения из вызова функции
<code>mysql_fetch_row()</code>, то указатели на эти величины имеют значения от <code>row[0]</code> 
до <code>row[mysql_num_fields(result)-1]</code>. Величины <code>NULL</code> в данной строке
отмечаются указателями <code>NULL</code>.

</P>
<P>
Размеры полей в данной строке можно получить, вызывая функцию
<code>mysql_fetch_lengths()</code>. Пустые поля и поля, содержащие <code>NULL</code>, в обоих
случаях имеют длину 0; их можно различить, проверив указатель для данной
величины поля. Если указатель равен <code>NULL</code>, то данное поле содержит <code>NULL</code>; в
противном случае, данное поле является пустым.

</P>

<H4>Возвращаемые значения</H4>

<P>
Структура <code>MYSQL_ROW</code> для следующей строки. <code>NULL</code>, если нет больше строк для
извлечения или произошла ошибка.

</P>

<H4>Ошибки</H4>

<DL COMPACT>

<DT><code>CR_SERVER_LOST</code>
<DD>
Соединение с сервером прервалось в процессе данного запроса.

<DT><code>CR_UNKNOWN_ERROR</code>
<DD>
Произошла неизвестная ошибка.
</DL>


<H4>Пример</H4>


<PRE>
MYSQL_ROW row;
unsigned int num_fields;
unsigned int i;

num_fields = mysql_num_fields(result);
while ((row = mysql_fetch_row(result)))
{
	unsigned long *lengths;
	lengths = mysql_fetch_lengths(result);
	for(i = 0; i &#60; num_fields; i++)
	{
		printf("[%.*s] ", (int) lengths[i], row[i] ? row[i] : "NULL");
	}
	printf("\n");
}
</PRE>



<H4><A NAME="mysql_field_count" HREF="manual.ru_toc.html#mysql_field_count">8.4.3.20  <code>mysql_field_count()</code></A></H4>
<P>
<A NAME="IDX1619"></A>

</P>
<P>
<code>unsigned int mysql_field_count(MYSQL *mysql)</code>

</P>
<P>
При использовании более ранней, чем 3.22.24, версии MySQL необходимо
вместо этого выражения использовать следующее: <code>unsigned int mysql_num_fields(MYSQL *mysql)</code>.

</P>

<H4>Описание</H4>

<P>
Возвращает количество столбцов для последнего запроса в данном соединении.

</P>
<P>
Обычно эту функцию используют в случае, когда функция <code>mysql_store_result()</code> 
возвращает <code>NULL</code> (и, следовательно, нет ни одного указателя для
результирующего набора). В этом случае можно вызвать функцию
<code>mysql_field_count()</code> для определения, может ли функция <code>mysql_store_result()</code> 
выдать непустой результат. Это дает возможность данной клиентской
программе выполнить соответствующее действие без уточнения, был ли данный
запрос командой вида <code>SELECT</code> (или похожей на <code>SELECT</code>). Приведенный ниже
пример иллюстрирует, как это можно сделать.

</P>
<P>
See section <A HREF="manual.ru.html#NULL_mysql_store_result">8.4.6.1  Почему после успешных возвратов функции <code>mysql_query()</code> функция <code>mysql_store_result()</code> иногда возвращает <code>NULL</code>?</A>.

</P>

<H4>Возвращаемые значения</H4>

<P>
Беззнаковое целое число, представляющее количество полей в результирующем
наборе.

</P>

<H4>Ошибки</H4>

<P>
Нет.

</P>

<H4>Пример</H4>

<PRE>
MYSQL_RES *result;
unsigned int num_fields;
unsigned int num_rows;

if (mysql_query(&#38;mysql,query_string))
{
	// ошибка
}
else // запрос выполнен, обработка возвращенных им данных
{
	result = mysql_store_result(&#38;mysql);
	if (result) // содержит строки
	{
		num_fields = mysql_num_fields(result);
		// извлечение строк, затем вызов mysql_free_result(result)
	}
	else // mysql_store_result() не вернула ничего; может ли что-либо вернуть?
	{
		if(mysql_field_count(&#38;mysql) == 0)
		{
			// запрос не возвращает данные
			// (запрос не был вида SELECT)
			num_rows = mysql_affected_rows(&#38;mysql);
		}
		else // mysql_store_result() должна была вернуть данные
		{
			fprintf(stderr, "Error: %s\n", mysql_error(&#38;mysql));
		}
	}
}
</PRE>

<P>
Альтернатива состоит в замене вызова функции <code>mysql_field_count(&#38;mysql)</code> 
вызовом функции <code>mysql_errno(&#38;mysql)</code>. В этом случае можно проверить, была
ли данная команда вида <code>SELECT</code>, непосредственно по ошибке от
<code>mysql_store_result()</code>, а не делать логический вывод по величине функции
<code>mysql_field_count()</code>.

</P>


<H4><A NAME="mysql_field_seek" HREF="manual.ru_toc.html#mysql_field_seek">8.4.3.21  <code>mysql_field_seek()</code></A></H4>
<P>
<A NAME="IDX1620"></A>

</P>
<P>
<code>MYSQL_FIELD_OFFSET mysql_field_seek(MYSQL_RES *result, MYSQL_FIELD_OFFSET offset)</code>

</P>

<H4>Описание</H4>

<P>
Устанавливает курсор поля в заданную позицию. Дальнейший вызов функции
<code>mysql_fetch_field()</code> будет извлекать определение данного поля в столбце,
ассоциированном с данной позицией курсора.

</P>
<P>
Для поиска начала строки необходимо установить величину <code>offset</code> в нуль.

</P>

<H4>Возвращаемые значения</H4>

<P>
Предыдущая величина курсора поля.

</P>

<H4>Ошибки</H4>

<P>
Нет.

</P>


<H4><A NAME="mysql_field_tell" HREF="manual.ru_toc.html#mysql_field_tell">8.4.3.22  <code>mysql_field_tell()</code></A></H4>
<P>
<A NAME="IDX1621"></A>

</P>
<P>
<code>MYSQL_FIELD_OFFSET mysql_field_tell(MYSQL_RES *result)</code>

</P>

<H4>Описание</H4>

<P>
Возвращает позицию курсора поля, использованную для последнего вызова
функции <code>mysql_fetch_field()</code>. Эта величина может использоваться как
аргумент в функции <code>mysql_field_seek()</code>.

</P>

<H4>Возвращаемые значения</H4>

<P>
Текущая позиция курсора поля.

</P>

<H4>Ошибки</H4>

<P>
Нет.

</P>


<H4><A NAME="mysql_free_result" HREF="manual.ru_toc.html#mysql_free_result">8.4.3.23  <code>mysql_free_result()</code></A></H4>
<P>
<A NAME="IDX1622"></A>

</P>
<P>
<code>void mysql_free_result(MYSQL_RES *result)</code>

</P>

<H4>Описание</H4>

<P>
Освобождает память, выделенную для результирующего набора данных функциями
<code>mysql_store_result()</code>, <code>mysql_use_result()</code>, <code>mysql_list_dbs()</code> и т.д. После
выполнения операций с результирующим набором необходимо освободить
используемую под него память вызовом функции <code>mysql_free_result()</code>.

</P>

<H4>Возвращаемые значения</H4>

<P>
Нет.

</P>

<H4>Ошибки</H4>

<P>
Нет.

</P>


<H4><A NAME="mysql_get_client_info" HREF="manual.ru_toc.html#mysql_get_client_info">8.4.3.24  <code>mysql_get_client_info()</code></A></H4>
<P>
<A NAME="IDX1623"></A>

</P>
<P>
<code>char *mysql_get_client_info(void)</code>

</P>

<H4>Описание</H4>

<P>
Возвращает строку, представляющую версию библиотеки данного клиента.

</P>

<H4>Возвращаемые значения</H4>

<P>
Символьная строка, которая представляет версию библиотеки данного клиента
MySQL.

</P>

<H4>Ошибки</H4>

<P>
Нет.

</P>


<H4><A NAME="mysql_get_server_version" HREF="manual.ru_toc.html#mysql_get_server_version">8.4.3.25  <code>mysql_get_server_version()</code></A></H4>

<P>
<A NAME="IDX1624"></A>

</P>
<P>
<code>unsigned long mysql_get_server_version(MYSQL *mysql)</code>

</P>

<H4>Описание</H4>

<P>
Возвращает номер версии сервера как целое число (новое с 4.1)

</P>

<H4>Возвращаемые значения</H4>

<P>
Число, представляющее версию сервера MySQL, в следующем формате:

</P>
<P>
main_version*10000 + minor_version *100 + sub_version

</P>
<P>
Например, 4.1.0 будет возвращена как 40100.

</P>
<P>
Это полезно для быстрого определения версии сервера в клиентской программе
для того, чтобы узнать, поддерживаются ли некоторые возможности.

</P>

<H4>Ошибки</H4>

<P>
Нет.

</P>


<H4><A NAME="mysql_get_host_info" HREF="manual.ru_toc.html#mysql_get_host_info">8.4.3.26  <code>mysql_get_host_info()</code></A></H4>
<P>
<A NAME="IDX1625"></A>

</P>
<P>
<code>char *mysql_get_host_info(MYSQL *mysql)</code>

</P>

<H4>Описание</H4>

<P>
Возвращает строку, описывающую тип используемого соединения, включая имя
серверного хоста.

</P>

<H4>Возвращаемые значения</H4>

<P>
Символьная строка, представляющая имя серверного хоста и тип данного
соединения.

</P>

<H4>Ошибки</H4>

<P>
Нет.


<H4><A NAME="mysql_get_proto_info" HREF="manual.ru_toc.html#mysql_get_proto_info">8.4.3.27  <code>mysql_get_proto_info()</code></A></H4>
<P>
<A NAME="IDX1626"></A>

</P>
<P>
<code>unsigned int mysql_get_proto_info(MYSQL *mysql)</code>

</P>

<H4>Описание</H4>

<P>
Возвращает версию протокола, используемую для текущего соединения.

</P>

<H4>Возвращаемые значения</H4>

<P>
Беззнаковое целое число, представляющее версию протокола, используемую для
текущего соединения.

</P>

<H4>Ошибки</H4>

<P>
Нет.

</P>


<H4><A NAME="mysql_get_server_info" HREF="manual.ru_toc.html#mysql_get_server_info">8.4.3.28  <code>mysql_get_server_info()</code></A></H4>
<P>
<A NAME="IDX1627"></A>

</P>
<P>
<code>char *mysql_get_server_info(MYSQL *mysql)</code>

</P>

<H4>Описание</H4>

<P>
Возвращает строку, представляющую номер версии сервера.

</P>

<H4>Возвращаемые значения</H4>

<P>
Символьная строка, представляющая номер версии сервера.

</P>

<H4>Ошибки</H4>

<P>
Нет.

</P>


<H4><A NAME="mysql_info" HREF="manual.ru_toc.html#mysql_info">8.4.3.29  <code>mysql_info()</code></A></H4>
<P>
<A NAME="IDX1628"></A>

</P>
<P>
<code>char *mysql_info(MYSQL *mysql)</code>

</P>

<H4>Описание</H4>

<P>
Извлекает строку, представляющую информацию о последнем выполненном
запросе, но только для команд, перечисленных ниже. Для других команд
функция <code>mysql_info()</code> возвращает <code>NULL</code>. Строка имеет различный формат в
зависимости от типа запроса, как описано ниже. Числа приведены только для
иллюстрации; данная строка будет содержать величины, соответствующие
конкретному запросу.

</P>
<DL COMPACT>

<DT><code>INSERT INTO ... SELECT ...</code>
<DD>
Формат  строки: <code>Records: 100 Duplicates: 0 Warnings: 0</code> 

<DT><code>INSERT INTO ... VALUES (...),(...),(...)...</code>
<DD>
Формат  строки: <code>Records: 3 Duplicates: 0 Warnings: 0</code> 

<DT><code>LOAD DATA INFILE ...</code>
<DD>
Формат  строки: <code>Records: 1 Deleted: 0 Skipped: 0 Warnings: 0</code> 

<DT><code>ALTER TABLE</code>
<DD>
Формат  строки: <code>Records: 3 Duplicates: 0 Warnings: 0</code> 

<DT><code>UPDATE</code>
<DD>
Формат  строки: <code>Rows matched: 40 Changed: 40 Warnings: 0</code> 
</DL>

<P>
Следует учитывать, что функция <code>mysql_info()</code> возвращает величину не-<code>NULL</code>
для команды <code>INSERT ... VALUES</code>, только если в данной команде заданы
множественные списки величин.

</P>

<H4>Возвращаемые значения</H4>

<P>
Символьная строка, представляющая дополнительную информацию о последнем
выполненном запросе. <code>NULL</code>, если нет никакой доступной информации по
данному запросу.

</P>

<H4>Ошибки</H4>

<P>
Нет.

</P>


<H4><A NAME="mysql_init" HREF="manual.ru_toc.html#mysql_init">8.4.3.30  <code>mysql_init()</code></A></H4>
<P>
<A NAME="IDX1629"></A>

</P>
<P>
<code>MYSQL *mysql_init(MYSQL *mysql)</code>

</P>

<H4>Описание</H4>

<P>
Выделяет или инициализирует объект MYSQL, подходящий для функции
<code>mysql_real_connect()</code>. Если аргумент <code>mysql</code> представляет собой указатель
<code>NULL</code>, то эта функция выделяет, инициализирует и возвращает новый объект. В
противном случае инициализируется указанный объект и возвращается его
адрес. Если функция <code>mysql_init()</code> выделяет новый объект, то он будет
освобожден при вызове функции <code>mysql_close()</code>, чтобы закрыть данное
соединение.

</P>

<H4>Возвращаемые значения</H4>

<P>
Инициализированный дескриптор <code>MYSQL*</code>. <code>NULL</code> при недостатке памяти для
выделения нового объекта.

</P>

<H4>Ошибки</H4>

<P>
В случае нехватки памяти возвращается <code>NULL</code>.

</P>


<H4><A NAME="mysql_insert_id" HREF="manual.ru_toc.html#mysql_insert_id">8.4.3.31  <code>mysql_insert_id()</code></A></H4>
<P>
<A NAME="IDX1630"></A>

</P>
<P>
<code>my_ulonglong mysql_insert_id(MYSQL *mysql)</code>

</P>

<H4>Описание</H4>

<P>
Возвращает идентификатор <code>ID</code>, сгенерированный для столбца <code>AUTO_INCREMENT</code>
предыдущим запросом. Эту функцию следует использовать после выполнения
запроса <code>INSERT</code> в таблице, содержащей поле <code>AUTO_INCREMENT</code>.

</P>
<P>
Следует учитывать, что функция <code>mysql_insert_id()</code> возвращает 0, если
предыдущий запрос не сформировал величину <code>AUTO_INCREMENT</code>. Если необходимо
сохранить эту величину в дальнейшем, то следует позаботиться о вызове
функции <code>mysql_insert_id()</code> немедленно после запроса, который создает
указанную величину.

</P>
<P>
Функция <code>mysql_insert_id()</code> обновляется после команд <code>INSERT</code> и <code>UPDATE</code>,
которые генерируют величину <code>AUTO_INCREMENT</code> или устанавливают величину
столбца в значение <code>LAST_INSERT_ID(expr)</code>. See section <A HREF="manual.ru.html#Miscellaneous_functions">6.3.6.2  Разные функции</A>.

</P>
<P>
Следует также иметь в виду, что величина SQL-функции <code>LAST_INSERT_ID()</code> 
всегда содержит самое последнее сгенерированное значение <code>AUTO_INCREMENT</code> и
не обновляется между запросами, так как величина этой функции сохраняется
сервером.

</P>

<H4>Возвращаемые значения</H4>

<P>
Величина поля <code>AUTO_INCREMENT</code>, обновленного предыдущим запросом.
Возвращает нуль, если перед этим не было запроса в данном соединении или
если данный запрос не обновил величину <code>AUTO_INCREMENT</code>.

</P>

<H4>Ошибки</H4>

<P>
Нет.

</P>


<H4><A NAME="mysql_kill" HREF="manual.ru_toc.html#mysql_kill">8.4.3.32  <code>mysql_kill()</code></A></H4>
<P>
<A NAME="IDX1631"></A>

</P>
<P>
<code>int mysql_kill(MYSQL *mysql, unsigned long pid)</code>

</P>

<H4>Описание</H4>

<P>
Предписывает серверу уничтожить поток, указанный в аргументе <code>pid</code>.

</P>

<H4>Возвращаемые значения</H4>

<P>
Нуль при успешном выполнении. Отличная от нуля величина при ошибке.

</P>

<H4>Ошибки</H4>
<DL COMPACT>

<DT><code>CR_COMMANDS_OUT_OF_SYNC</code>
<DD>
Команды были выполнены в ненадлежащем порядке.

<DT><code>CR_SERVER_GONE_ERROR</code>
<DD>
Сервер MySQL неожиданно завершил работу.

<DT><code>CR_SERVER_LOST</code>
<DD>
Соединение с сервером прервалось в процессе данного запроса.

<DT><code>CR_UNKNOWN_ERROR</code>
<DD>
Произошла неизвестная ошибка.
</DL>



<H4><A NAME="mysql_list_dbs" HREF="manual.ru_toc.html#mysql_list_dbs">8.4.3.33  <code>mysql_list_dbs()</code></A></H4>
<P>
<A NAME="IDX1632"></A>

</P>
<P>
<code>MYSQL_RES *mysql_list_dbs(MYSQL *mysql, const char *wild)</code>

</P>

<H4>Описание</H4>

<P>
Возвращает результирующий набор, состоящий из имен баз данных на сервере,
которые встречаются в простом регулярном выражении, указанном в параметре
<code>wild</code>. Параметр <code>wild</code> может содержать шаблонные символы <samp>`%'</samp> или <samp>`_'</samp>, а также
может быть указателем <code>NULL</code>, что соответствует всем базам данных. Вызов
функции <code>mysql_list_dbs()</code>аналогичен выполнению запроса <code>SHOW databases [LIKE
wild]</code>.

</P>
<P>
Результирующий набор необходимо освободить с помощью функции
<code>mysql_free_result()</code>.

</P>

<H4>Возвращаемые значения</H4>

<P>
Результирующий набор <code>MYSQL_RES</code> при успешном выполнении. <code>NULL</code>, если
произошла ошибка.

</P>

<H4>Ошибки</H4>
<DL COMPACT>

<DT><code>CR_COMMANDS_OUT_OF_SYNC</code>
<DD>
Команды были выполнены в ненадлежащем порядке.

<DT><code>CR_OUT_OF_MEMORY</code>
<DD>
Нехватка  памяти.

<DT><code>CR_SERVER_GONE_ERROR</code>
<DD>
Сервер MySQL неожиданно завершил работу.

<DT><code>CR_SERVER_LOST</code>
<DD>
Соединение с сервером прервалось в процессе данного запроса.

<DT><code>CR_UNKNOWN_ERROR</code>
<DD>
Произошла неизвестная ошибка.
</DL>



<H4><A NAME="mysql_list_fields" HREF="manual.ru_toc.html#mysql_list_fields">8.4.3.34  <code>mysql_list_fields()</code></A></H4>
<P>
<A NAME="IDX1633"></A>

</P>
<P>
<code>MYSQL_RES *mysql_list_fields(MYSQL *mysql, const char *table, const char *wild)</code>

</P>

<H4>Описание</H4>

<P>
Возвращает результирующий набор, состоящий из имен полей в заданной
таблице, встречающихся в простом регулярном выражении, указанном в
параметре <code>wild</code>. Параметр <code>wild</code> может содержать шаблонные символы <samp>`%'</samp> или
<samp>`_'</samp>, а также может быть указателем <code>NULL</code>, что соответствует всем полям.
Вызов функции <code>mysql_list_fields()</code> аналогичен выполнению запроса <code>SHOW
COLUMNS FROM tbl_name [LIKE wild]</code>.

</P>
<P>
Следует учитывать, что рекомендуется использовать команду <code>SHOW COLUMNS
FROM tbl_nam</code>e вместо функции <code>mysql_list_fields()</code>.

</P>
<P>
Результирующий набор необходимо освободить с помощью функции
<code>mysql_free_result()</code>.

</P>

<H4>Возвращаемые значения</H4>

<P>
Результирующий набор <code>MYSQL_RES</code> при успешном выполнении. <code>NULL</code>, если
произошла ошибка.

</P>

<H4>Ошибки</H4>

<DL COMPACT>

<DT><code>CR_COMMANDS_OUT_OF_SYNC</code>
<DD>
Команды были выполнены в ненадлежащем порядке.

<DT><code>CR_SERVER_GONE_ERROR</code>
<DD>
Сервер MySQL неожиданно завершил  работу.

<DT><code>CR_SERVER_LOST</code>
<DD>
Соединение с сервером прервалось в процессе данного запроса.

<DT><code>CR_UNKNOWN_ERROR</code>
<DD>
Произошла неизвестная ошибка.
</DL>



<H4><A NAME="mysql_list_processes" HREF="manual.ru_toc.html#mysql_list_processes">8.4.3.35  <code>mysql_list_processes()</code></A></H4>
<P>
<A NAME="IDX1634"></A>

</P>
<P>
<A NAME="IDX1635"></A>

</P>
<P>
<code>MYSQL_RES *mysql_list_processes(MYSQL *mysql)</code>

</P>

<H4>Описание</H4>

<P>
Возвращает результирующий набор, описывающий текущие потоки на сервере.
Предоставляет тот же тип информации, который выдается утилитой <code>mysqladmin</code>
processlist или запросом <code>SHOW PROCESSLIST</code>.

</P>
<P>
Результирующий набор необходимо освободить с помощью функции
<code>mysql_free_result()</code>.

</P>

<H4>Возвращаемые значения</H4>

<P>
Результирующий набор <code>MYSQL_RES</code> при успешном выполнении. <code>NULL</code>, если
произошла ошибка.

</P>

<H4>Ошибки</H4>

<DL COMPACT>

<DT><code>CR_COMMANDS_OUT_OF_SYNC</code>
<DD>
Команды были выполнены в ненадлежащем порядке.

<DT><code>CR_SERVER_GONE_ERROR</code>
<DD>
Сервер MySQL неожиданно завершил работу.

<DT><code>CR_SERVER_LOST</code>
<DD>
Соединение с сервером прервалось в процессе данного запроса.

<DT><code>CR_UNKNOWN_ERROR</code>
<DD>
Произошла неизвестная ошибка.
</DL>



<H4><A NAME="mysql_list_tables" HREF="manual.ru_toc.html#mysql_list_tables">8.4.3.36  <code>mysql_list_tables()</code></A></H4>
<P>
<A NAME="IDX1636"></A>

</P>
<P>
<A NAME="IDX1637"></A>

</P>
<P>
<code>MYSQL_RES *mysql_list_tables(MYSQL *mysql, const char *wild)</code>

</P>

<H4>Описание</H4>

<P>
Возвращает результирующий набор, состоящий из имен таблиц в текущей базе
данных, которые встречаются в простом регулярном выражении, указанном в
параметре <code>wild</code>. Параметр <code>wild</code> может содержать шаблонные символы <samp>`%'</samp> или
<samp>`_'</samp>, а также может быть указателем <code>NULL</code>, что соответствует всем таблицам.
Вызов функции <code>mysql_list_tables()</code>аналогичен выполнению запроса <code>SHOW tables
[LIKE wild]</code>.

</P>
<P>
Результирующий набор необходимо освободить с помощью функции
<code>mysql_free_result()</code>.

</P>

<H4>Возвращаемые значения</H4>

<P>
Результирующий набор <code>MYSQL_RES</code> при успешном выполнении. <code>NULL</code>, если
произошла ошибка.

</P>

<H4>Ошибки</H4>

<DL COMPACT>

CR_COMMANDS_OUT_OF_SYNC
Команды были выполнены в ненадлежащем порядке.

CR_SERVER_GONE_ERROR
Сервер MySQL неожиданно завершил работу.

CR_SERVER_LOST
Соединение с сервером прервалось в процессе данного запроса.

CR_UNKNOWN_ERROR
Произошла неизвестная ошибка.
</DL>



<H4><A NAME="mysql_num_fields" HREF="manual.ru_toc.html#mysql_num_fields">8.4.3.37  <code>mysql_num_fields()</code></A></H4>

<P>
<A NAME="IDX1638"></A>
<A NAME="IDX1639"></A>

</P>
<P>
<code>unsigned int mysql_num_fields(MYSQL_RES *result)</code>

</P>
<P>
или

</P>
<P>
<code>unsigned int mysql_num_fields(MYSQL *mysql)</code> 

</P>
<P>
Вторая форма не работает на версии MySQL 3.22.24 или более новой. Вместо
аргумента в параметре <code>MYSQL*</code> необходимо использовать выражение <code>unsigned
int mysql_field_count(MYSQL *mysql)</code> 

</P>

<H4>Описание</H4>

<P>
Возвращает количество столбцов в результирующем наборе.

</P>
<P>
Следует отметить, что можно получить искомое количество столбцов с помощью
указателя или на результирующий набор, или на дескриптор соединения.
Дескриптор соединения необходимо использовать, если функции
<code>mysql_store_result()</code> или <code>mysql_use_result()</code> возвратили <code>NULL</code> (и,
следовательно, отсутствует указатель результирующего набора). В этом
случае можно вызвать функцию <code>mysql_field_count()</code>для определения, может ли
функция <code>mysql_store_result()</code>выдать непустой результат. Это дает
возможность данной клиентской программе выполнить соответствующее действие
без уточнения, был ли данный запрос командой вида <code>SELECT</code> (или похожей на
<code>SELECT</code>). В приведенном ниже примере иллюстрируется, как это можно сделать.

</P>
<P>
See section <A HREF="manual.ru.html#NULL_mysql_store_result">8.4.6.1  Почему после успешных возвратов функции <code>mysql_query()</code> функция <code>mysql_store_result()</code> иногда возвращает <code>NULL</code>?</A>.

</P>

<H4>Возвращаемые значения</H4>

<P>
Беззнаковое целое число, представляющее количество полей в результирующем
наборе.

</P>

<H4>Ошибки</H4>

<P>
Нет.

</P>

<H4>Пример</H4>


<PRE>
MYSQL_RES *result;
unsigned int num_fields;
unsigned int num_rows;

if (mysql_query(&#38;mysql,query_string))
{
	// ошибка
}
else // запрос выполнен, обработка возвращенных им данных
{
	result = mysql_store_result(&#38;mysql);
	if (result) // содержит строки {
		num_fields = mysql_num_fields(result);
		// извлечение строк, затем вызов mysql_free_result(result)
	}
	else // mysql_store_result()не вернула ничего; может ли что-либо вернуть?
	{
		if (mysql_errno(&#38;mysql))
		{
			fprintf(stderr, "Error: %s\n", mysql_error(&#38;mysql));
		}
		else if (mysql_field_count(&#38;mysql) == 0)
		{
			// запрос не возвращает данные
			// (запрос не был вида SELECT)
			num_rows = mysql_affected_rows(&#38;mysql);
		}
	}
}
</PRE>

<P>
Альтернатива (если известно, что данный запрос должен вернуть
результирующий набор) состоит в замене вызова функции <code>mysql_errno(&#38;mysql)</code> 
на проверку, равна ли 0 функция <code>mysql_field_count(&#38;mysql)</code>. Это может
случиться, только если что-нибудь происходило не так.

</P>


<H4><A NAME="mysql_num_rows" HREF="manual.ru_toc.html#mysql_num_rows">8.4.3.38  <code>mysql_num_rows()</code></A></H4>
<P>
<A NAME="IDX1640"></A>

</P>
<P>
<code>my_ulonglong mysql_num_rows(MYSQL_RES *result)</code>

</P>

<H4>Описание</H4>

<P>
Возвращает количество строк в результирующем наборе.

</P>
<P>
Использование функции <code>mysql_num_rows()</code> зависит от того, какая функция -
<code>mysql_store_result()</code> или <code>mysql_use_result()</code> применяется для возвращения
результирующего набора. Если используется <code>mysql_store_result()</code>, то функция
<code>mysql_num_rows()</code> может вызываться немедленно. Если используется
<code>mysql_use_result()</code>,то функция <code>mysql_num_rows()</code> не будет возвращать
правильную величину до тех пор, пока все строки в результирующем наборе не
будут извлечены.

</P>

<H4>Возвращаемые значения</H4>

<P>
Количество строк в результирующем наборе.

</P>

<H4>Ошибки</H4>

<P>
Нет.

</P>


<H4><A NAME="mysql_options" HREF="manual.ru_toc.html#mysql_options">8.4.3.39  <code>mysql_options()</code></A></H4>
<P>
<A NAME="IDX1641"></A>

</P>
<P>
<code>int mysql_options(MYSQL *mysql, enum mysql_option option, const char *arg)</code>

</P>

<H4>Описание</H4>

<P>
Может использоваться для установки дополнительных опций соединения и
влияет на режим работы соединения. Эта функция может вызываться
многократно для установки нескольких опций.

</P>
<P>
Функция <code>mysql_options()</code> должна вызываться после функции <code>mysql_init()</code> и
перед функцией <code>mysql_connect()</code> или <code>mysql_real_connect()</code>.

</P>
<P>
Аргумент <code>option</code> представляет собой опцию, которую требуется установить;
аргумент <code>arg</code> является величиной этой опции. Если данная опция является
целым числом, то аргумент arg должен указывать на величину целого числа.

</P>
<P>
Возможные значения опций:

</P>
<TABLE BORDER>
<TR><TD><strong>Опция</strong> </TD><TD> <strong>Тип аргумента</strong> </TD><TD> <strong>Функция</strong>
</TD></TR>
<TR><TD><code>MYSQL_OPT_CONNECT_TIMEOUT</code> </TD><TD> <code>unsigned int *</code> </TD><TD> Время ожидания для соединения в секундах.
</TD></TR>
<TR><TD><code>MYSQL_OPT_COMPRESS</code> </TD><TD> Не используется </TD><TD> Использовать сжатие в клиент-серверном протоколе.
</TD></TR>
<TR><TD><code>MYSQL_OPT_LOCAL_INFILE</code> </TD><TD> Опциональный указатель на uint </TD><TD> Если указатель не задан или указывает на <code>unsigned int != 0</code> команда <code>LOAD LOCAL INFILE</code> разрешена.
</TD></TR>
<TR><TD><code>MYSQL_OPT_NAMED_PIPE</code> </TD><TD> Не используется </TD><TD> Использовать именованные каналы для соединения с сервером MySQL на NT.
</TD></TR>
<TR><TD><code>MYSQL_INIT_COMMAND</code> </TD><TD> <code>char *</code> </TD><TD> Команда для исполнения при подключении к серверу MySQL. При восстановлении соединения будет снова автоматически выполнена.
</TD></TR>
<TR><TD><code>MYSQL_READ_DEFAULT_FILE</code> </TD><TD> <code>char *</code> </TD><TD> Читать опции из указанного файла опций вместо чтения из файла <tt>`my.cnf'</tt>.
</TD></TR>
<TR><TD><code>MYSQL_READ_DEFAULT_GROUP</code> </TD><TD> <code>char *</code> </TD><TD> Читать опции из указанной группы из файла <tt>`my.cnf'</tt> или из файла заданного в <code>MYSQL_READ_DEFAULT_FILE</code>.
</TD></TR>
</TABLE>

<P>
Следует помнить, что группа <code>client</code> читается всегда при использовании
<code>MYSQL_READ_DEFAULT_FILE</code> или <code>MYSQL_READ_DEFAULT_GROUP</code>.

</P>
<P>
Упомянутая группа в файле опций может содержать следующие опции:

</P>
<TABLE BORDER>
<TR><TD><strong>Опция</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD><code>connect-timeout</code> </TD><TD> Время ожидания для соединения в секундах. Для Linux это время ожидания используется также для ожидания первого ответа с сервера.
</TD></TR>
<TR><TD><code>compress</code> </TD><TD> Использовать сжатие в клиент-серверном протоколе.
</TD></TR>
<TR><TD><code>database</code> </TD><TD> Подключиться к этой базе данных, если никакая база данных не была указана в данной команде подключения.
</TD></TR>
<TR><TD><code>debug</code> </TD><TD> Опции отладки.
</TD></TR>
<TR><TD><code>disable-local-infile</code> </TD><TD> Блокировка использования <code>LOAD DATA LOCAL</code>.
</TD></TR>
<TR><TD><code>host</code> </TD><TD> Имя хоста по умолчанию.
</TD></TR>
<TR><TD><code>init-command</code> </TD><TD> Команда для исполнения при подключении к серверу MySQL. При восстановлении соединения будет снова автоматически выполнена.
</TD></TR>
<TR><TD><code>interactive-timeout</code> </TD><TD> Аналогично  заданию  <code>CLIENT_INTERACTIVE</code>  в <code>mysql_real_connect()</code>. See section <A HREF="manual.ru.html#mysql_real_connect">8.4.3.42  <code>mysql_real_connect()</code></A>.
</TD></TR>
<TR><TD><code>local-infile[=(0|1)]</code> </TD><TD> Если аргумент не задан или указан аргумент <code>!= 0</code>, то разрешено использование <code>LOAD DATA LOCAL</code>.
</TD></TR>
<TR><TD><code>max_allowed_packet</code> </TD><TD> Максимальный размер пакета, который клиент может читать с сервера.
</TD></TR>
<TR><TD><code>password</code> </TD><TD> Пароль по умолчанию.
</TD></TR>
<TR><TD><code>pipe</code> </TD><TD> Использовать именованные каналы для соединения с сервером MySQL на NT.
</TD></TR>
<TR><TD><code>protocol=(TCP | SOCKET | PIPE | MEMORY)</code> </TD><TD> Какой протокол использовать для подключения к серверу (новшество 4.1.0).
</TD></TR>
<TR><TD><code>port</code> </TD><TD> Номер порта по умолчанию.
</TD></TR>
<TR><TD><code>return-found-rows</code> </TD><TD> Предписывает <code>mysql_info()</code> возвращать найденные строки вместо обновления их при выполнении <code>UPDATE</code>.
</TD></TR>
<TR><TD><code>shared-memory-base-name=name</code> </TD><TD> Имя блока общей памяти (shared memory name), которое следует использовать для подключения к серверу (по умолчанию "MySQL"). Новшество в MySQL 4.1.
</TD></TR>
<TR><TD><code>socket</code> </TD><TD> Номер сокета по умолчанию.
</TD></TR>
<TR><TD><code>user</code> </TD><TD> Пользователь по умолчанию.
</TD></TR>
</TABLE>

<P>
Следует помнить, что <code>timeout</code> замещен на <code>connect-timeout</code>, но <code>timeout</code>
временно еще работает.

</P>
<P>
Для более подробной информации о файлах опций см. раздел See section <A HREF="manual.ru.html#Option_files">4.1.2  Файлы параметров <tt>`my.cnf'</tt></A>.

</P>

<H4>Возвращаемые значения</H4>

<P>
Нуль при успешном выполнении. Величина, отличная от нуля, если
используется неизвестная опция.

</P>

<H4>Пример</H4>


<PRE>
MYSQL mysql;

mysql_init(&#38;mysql);
mysql_options(&#38;mysql,MYSQL_OPT_COMPRESS,0);
mysql_options(&#38;mysql,MYSQL_READ_DEFAULT_GROUP,"odbc");
if
(!mysql_real_connect(&#38;mysql,"host","user","passwd","database",0,NULL,0))
{
	fprintf(stderr, "Failed to connect to database: Error: %s\n",
	mysql_error(&#38;mysql));
}
</PRE>

<P>
Вышеприведенный пример запрашивает клиента использовать сжатый
клиент-серверный протокол и читать дополнительные опции из секции <code>odbc</code> в
файле <tt>`my.cnf'</tt>.

</P>


<H4><A NAME="mysql_ping" HREF="manual.ru_toc.html#mysql_ping">8.4.3.40  <code>mysql_ping()</code></A></H4>
<P>
<A NAME="IDX1642"></A>

</P>
<P>
<code>int mysql_ping(MYSQL *mysql)</code>

</P>

<H4>Описание</H4>

<P>
Проверяет, работает ли данное соединение с сервером. Если соединение
прервано, то пытается автоматически восстановить его.

</P>
<P>
Эта функция может использоваться клиентами, долгое время находящимися в
состоянии простоя, для проверки, закрыл ли сервер данное соединение, и для
восстановления соединения при необходимости.

</P>

<H4>Возвращаемые значения</H4>

<P>
Нуль, если сервер в активном состоянии. Величина, отличная от нуля, если
произошла ошибка.

</P>

<H4>Ошибки</H4>

<DL COMPACT>

<DT><code>CR_COMMANDS_OUT_OF_SYNC</code>
<DD>
Команды были выполнены в ненадлежащем порядке.

<DT><code>CR_SERVER_GONE_ERROR</code>
<DD>
Сервер MySQL неожиданно завершил работу.

<DT><code>CR_UNKNOWN_ERROR</code>
<DD>
Произошла неизвестная ошибка.
</DL>



<H4><A NAME="mysql_query" HREF="manual.ru_toc.html#mysql_query">8.4.3.41  <code>mysql_query()</code></A></H4>
<P>
<A NAME="IDX1643"></A>

</P>
<P>
<code>int mysql_query(MYSQL *mysql, const char *query)</code>

</P>

<H4>Описание</H4>

<P>
Выполняет запрос SQL, указанный в аргументе <code>query</code> в виде строки с нулевыми
окончаниями. Данный запрос должен состоять из одной команды SQL. Нельзя
добавлять к этой команде в качестве завершающих элементов точку с запятой
(<samp>`;'</samp>) или <code>\g</code>.

</P>
<P>
Функция <code>mysql_query()</code> не может использоваться для запросов, содержащих
двоичные данные; вместо этого необходимо использовать функцию
<code>mysql_real_query()</code> (двоичные данные могут содержать символ <samp>`\0'</samp>, который
<code>mysql_query()</code> интерпретирует как окончание строки запроса).

</P>
<P>
Для проверки, вернул данный запрос результирующий набор или нет, можно
использовать функцию <code>mysql_field_count()</code>. See section <A HREF="manual.ru.html#mysql_field_count">8.4.3.20  <code>mysql_field_count()</code></A>.

</P>

<H4>Возвращаемые значения</H4>

<P>
Нуль при успешном выполнении запроса. Величина, отличная от нуля, если
произошла ошибка.

</P>

<H4>Ошибки</H4>

<DL COMPACT>

<DT><code>CR_COMMANDS_OUT_OF_SYNC</code>
<DD>
Команды были выполнены в ненадлежащем порядке.

<DT><code>CR_SERVER_GONE_ERROR</code>
<DD>
Сервер MySQL неожиданно завершил работу.

<DT><code>CR_SERVER_LOST</code>
<DD>
Соединение с сервером прервалось в процессе данного запроса.

<DT><code>CR_UNKNOWN_ERROR</code>
<DD>
Произошла неизвестная ошибка.
</DL>



<H4><A NAME="mysql_real_connect" HREF="manual.ru_toc.html#mysql_real_connect">8.4.3.42  <code>mysql_real_connect()</code></A></H4>
<P>
<A NAME="IDX1644"></A>

</P>
<P>
<code>MYSQL *mysql_real_connect(MYSQL *mysql, const char *host,
   const char *user, const char *passwd, const char *db,
   unsigned int port, const char *unix_socket,
   unsigned int client_flag)</code>
						   


<P><STRONG>Описание</STRONG></P>

</P>
<P>
Функция <code>mysql_real_connect()</code> пытается установить соединение с сервером баз
данных MySQL, работающим на хосте <code>host</code>. До успешного завершения функции
<code>mysql_real_connect()</code> нельзя выполнять никакие другие функции интерфейса, за
исключением <code>mysql_get_client_info()</code>.

</P>
<P>
Параметры этой функции указываются следующим образом:

</P>

<UL>
<LI>

Первым параметром должен быть указатель существующей структуры <code>MYSQL</code>.
До вызова функции <code>mysql_real_connect</code>() необходимо вызвать функцию
<code>mysql_init()</code> для инициализации данной структуры <code>MYSQL</code>. Вызов функции
<code>mysql_options()</code> позволяет изменить многие опции данного соединения.
See section <A HREF="manual.ru.html#mysql_options">8.4.3.39  <code>mysql_options()</code></A>.

<LI>

<code>host</code> может быть как именем хоста, так и IP-адресом. Если host равен
<code>NULL</code> или строке <code>"localhost"</code>, то подразумевается соединение с локальным
хостом. Если операционная система поддерживает сокеты (Unix) или
именованные каналы (Windows), то они используются вместо протокола
TCP/IP для соединения с сервером.

<LI>

Параметр user содержит имя данного пользователя MySQL. Если параметр
user равен <code>NULL</code>, то подразумевается текущий пользователь. Под
операционной системой Unix, это будет текущее имя входа в систему. Под
Windows ODBC имя пользователя должно быть указано явным образом. См.
раздел See section <A HREF="manual.ru.html#ODBC_administrator">8.3.2  Как заполнять различные поля в Администраторе ODBC</A>.

<LI>

Параметр <code>passwd</code> содержит пароль для user. Если параметр <code>passwd</code> равен
<code>NULL</code>, то только записи в таблице <code>user</code> для пользователя, имеющего
чистое (пустое) поле пароля, будут проверяться на совпадение. Это дает
возможность администратору базы данных устанавливать систему прав
MySQL таким образом, что пользователи получают различные права, в
зависимости от того, имеют они или нет установленный пароль.

Замечание: не следует пытаться шифровать пароль перед вызовом функции
<code>mysql_real_connect()</code>; шифрование пароля производится автоматически
библиотекой.

<LI>

Параметр <code>db</code> представляет собой имя базы данных. Если параметр <code>db</code> не
равен <code>NULL</code>, то данное соединение установит эту величину в качестве
базы данных по умолчанию.

<LI>

Если параметр <code>port</code> не равен 0, то данная величина будет использована в
качестве порта для соединения TCP/IP. Следует учитывать, что тип
соединения определяется параметром <code>host</code>.

<LI>

Если параметр <code>unix_socket</code> не равен <code>NULL</code>, то данная строка указывает
сокет или именованный канал, который следует использовать. Следует
учитывать, что тип соединения определяется параметром <code>host</code>.

<LI>

Величина параметра <code>client_flag</code> обычно равна 0, но при особых
обстоятельствах может быть установлена как комбинация следующих
флагов:
<TABLE BORDER>
<TR><TD><strong>Имя флага</strong> </TD><TD> <strong>Описание флага</strong>
</TD></TR>
<TR><TD><code>CLIENT_COMPRESS</code> </TD><TD> Использовать сжатие в протоколе.
</TD></TR>
<TR><TD><code>CLIENT_FOUND_ROWS</code> </TD><TD> Возвращать количество найденных (совпавших) строк, а не количество строк, подвергшихся воздействию.
</TD></TR>
<TR><TD><code>CLIENT_IGNORE_SPACE</code> </TD><TD> Допускать пробелы после имен функций. Сделать имена всех функций зарезервированными словами.
</TD></TR>
<TR><TD><code>CLIENT_INTERACTIVE</code> </TD><TD> Допускать простой длительностью <code>interactive_timeout</code> секунд (вместо <code>wait_timeout</code> секунд) перед закрытием данного соединения.
</TD></TR>
<TR><TD><code>CLIENT_NO_SCHEMA</code> </TD><TD> Запретить использование формы <code>db_name.tbl_name.col_name</code>. Это делается для ODBC и заставляет  синтаксический анализатор генерировать ошибку при использовании данного синтаксиса, который полезен для выявления ошибок в некоторых программах ODBC.
</TD></TR>
<TR><TD><code>CLIENT_ODBC</code> </TD><TD> Клиентом является клиент ODBC. Настраивает <code>mysqld</code> для большей совместимости с ODBC.
</TD></TR>
<TR><TD><code>CLIENT_SSL</code> </TD><TD> Использовать SSL (протокол шифрования).
</TD></TR>
</TABLE>
</UL>


<H4>Возвращаемые значения</H4>

<P>
Дескриптор соединения <code>MYSQL*</code>, если соединение было успешным, <code>NULL</code> если
соединение было неудачным. Для успешного соединения возвращаемая величина
та же, что и величина первого параметра.

</P>

<H4>Ошибки</H4>
<DL COMPACT>

<DT><code>CR_CONN_HOST_ERROR</code>
<DD>
Не удалось соединиться с сервером MySQL.

<DT><code>CR_CONNECTION_ERROR</code>
<DD>
Не удалось соединиться с локальным сервером MySQL.

<DT><code>CR_IPSOCK_ERROR</code>
<DD>
Не удалось создать IP-сокет.

<DT><code>CR_OUT_OF_MEMORY</code>
<DD>
Недостаток  памяти.

<DT><code>CR_SOCKET_CREATE_ERROR</code>
<DD>
Не удалось создать Unix сокет.

<DT><code>CR_UNKNOWN_HOST</code>
<DD>
Не удалось найти IP-адрес для данного имени хоста.

<DT><code>CR_VERSION_ERROR</code>
<DD>
Несоответствие протокола, что явилось результатом попытки соединения с
сервером с клиентской библиотекой, использующей иную версию протокола. Это
может произойти при использовании очень старой клиентской библиотеки для
подключения к новому серверу, при запуске которого не была установлена
опция <code>--old-protocol</code>.

<DT><code>CR_NAMEDPIPEOPEN_ERROR</code>
<DD>
Не удалось создать именованный канал на Windows.

<DT><code>CR_NAMEDPIPEWAIT_ERROR</code>
<DD>
Не удалось дождаться именованного канала на Windows.

<DT><code>CR_NAMEDPIPESETSTATE_ERROR</code>
<DD>
Не удалось получить обработчик канала на Windows.

<DT><code>CR_SERVER_LOST</code>
<DD>
Если connect_timeout &#62; 0 и требовалось больше, чем connect_timeout секунд
для соединения с сервером или если сервер прекратил работу во время
выполнения init-command.
</DL>


<H4>Пример</H4>


<PRE>
MYSQL mysql;

mysql_init(&#38;mysql);
mysql_options(&#38;mysql,MYSQL_READ_DEFAULT_GROUP,"your_prog_name");
if
(!mysql_real_connect(&#38;mysql,"host","user","passwd","database",0,NULL,0))
{
	fprintf(stderr, "Failed to connect to database: Error: %s\n",
	mysql_error(&#38;mysql));
}
</PRE>

<P>
Используя функцию <code>mysql_options()</code>, библиотека MySQL будет читать секции
<code>[client]</code> и <code>[your_prog_name]</code> в конфигурационном файле <tt>`my.cnf'</tt>, что будет
гарантировать нормальную работу данной программы, даже если MySQL будет
установлен нестандартным образом.

</P>
<P>
Следует заметить, что во время соединения функция <code>mysql_real_connect()</code> 
устанавливает флаг <code>reconnect</code> (часть данной структуры <code>MYSQL</code>) в значение,
равное <code>1</code>. Этот флаг показывает, что в случае, если запрос не может быть
выполнен из-за потери соединения, то следует попытаться восстановить
соединение прежде, чем отказаться от него.

</P>


<H4><A NAME="mysql_real_escape_string" HREF="manual.ru_toc.html#mysql_real_escape_string">8.4.3.43  <code>mysql_real_escape_string()</code></A></H4>
<P>
<A NAME="IDX1645"></A>

</P>
<P>
<code>unsigned long mysql_real_escape_string(MYSQL *mysql, char *to, const char *from, unsigned long length)</code>

</P>

<H4>Описание</H4>

<P>
Эта функция используется для создания допустимой SQL- строки, которую
можно использовать в команде SQL. See section <A HREF="manual.ru.html#String_syntax">6.1.1.1  Cтроки</A>.

</P>
<P>
Строка из секции <code>from</code> кодируется в экранированную SQL-строку, принимая во
внимание текущую кодировку данного соединения. Результат помещается в
секцию to с добавлением концевого нулевого байта. Кодируются  следующие 
символы: <code>NUL</code> (ASCII 0), <samp>`\n'</samp>, <samp>`\r'</samp>, <samp>`\'</samp>, <samp>`''</samp>, <samp>`"'</samp>  и Ctrl-Z (see section <A HREF="manual.ru.html#Literals">6.1.1  Литералы: представление строк и чисел</A>).
(Строго говоря, MySQL требует только чтобы обратная косая черта и кавычки,
используемые для квотинга строк в запросе, были проэкранированы. Эта функция
экранирует и другие символы, делая их более легкими для чтения в журнальных
файлах.)

</P>
<P>
Строка, указанная в секции <code>from</code>, должна быть длиной <code>length</code> байтов.
Необходимо выделить для секции to буфер величиной по меньшей мере
<code>length*2+1</code> байтов (в наихудшем случае каждый символ может потребовать
кодировки с использованием двух байтов и, кроме того, необходимо место для
концевого нулевого байта). При возврате функции <code>mysql_real_escape_string()</code> 
содержимое секции to будет представлять собой строку с нулевым окончанием.
Возвращаемая величина представляет собой длину данной кодированной строки,
не включая концевой нулевой символ.

</P>

<H4>Пример</H4>

<PRE>

char query[1000],*end;

end = strmov(query,"INSERT INTO test_table values(");
*end++ = '\'';
end += mysql_real_escape_string(&#38;mysql, end,"What's this",11);
*end++ = '\'';
*end++ = ',';
*end++ = '\'';
end += mysql_real_escape_string(&#38;mysql, end,"binary data: \0\r\n",16);
*end++ = '\'';
*end++ = ')';

if (mysql_real_query(&#38;mysql,query,(unsigned int) (end - query)))
{
	fprintf(stderr, "Failed to insert row, Error: %s\n",
	mysql_error(&#38;mysql));
}
</PRE>

<P>
Функция <code>strmov()</code>, использованная в этом примере, присутствует в библиотеке
<code>mysqlclient</code> и работает подобно функции <code>strcpy()</code>, но возвращает указатель
на концевой нуль первого параметра.

</P>

<H4>Возвращаемые значения</H4>

<P>
Длина величины, помещенной в секции to, не включая концевой нулевой
символ.

</P>

<H4>Ошибки</H4>

<P>
Нет.

</P>


<H4><A NAME="mysql_real_query" HREF="manual.ru_toc.html#mysql_real_query">8.4.3.44  <code>mysql_real_query()</code></A></H4>
<P>
<A NAME="IDX1646"></A>

</P>
<P>
<code>int mysql_real_query(MYSQL *mysql, const char *query, unsigned long length)</code>

</P>

<H4>Описание</H4>

<P>
Выполняет SQL-запрос, указанный в query, который должен быть строкой
длиною <code>length</code> байтов. Данный запрос должен состоять из одной команды SQL.
Нельзя добавлять к этой команде в качестве завершающих элементов точку с
запятой (<samp>`;'</samp>) или <code>\g</code>.

</P>
<P>
Необходимо использовать функцию <code>mysql_real_query()</code> вместо функции
<code>mysql_query()</code>для запросов, содержащих двоичные данные, поскольку двоичные
данные могут содержать символ <samp>`\0'</samp>. Кроме того, функция <code>mysql_real_query()</code> 
быстрее, чем <code>mysql_query()</code> так как она не вызывает функцию <code>strlen()</code> в
строке запроса.

</P>
<P>
Для проверки того, вернул данный запрос результирующий набор или нет,
можно использовать функцию <code>mysql_field_count()</code>. 
See section <A HREF="manual.ru.html#mysql_field_count">8.4.3.20  <code>mysql_field_count()</code></A>.

</P>

<H4>Возвращаемые значения</H4>

<P>
Нуль при успешном выполнении запроса. Величина, отличная от нуля, если
произошла ошибка.

</P>

<H4>Ошибки</H4>
<DL COMPACT>

<DT><code>CR_COMMANDS_OUT_OF_SYNC</code>
<DD>
Команды были выполнены в ненадлежащем порядке.

<DT><code>CR_SERVER_GONE_ERROR</code>
<DD>
Сервер MySQL неожиданно завершил работу.

<DT><code>CR_SERVER_LOST</code>
<DD>
Соединение с сервером прервалось в процессе данного запроса.

<DT><code>CR_UNKNOWN_ERROR</code>
<DD>
Произошла неизвестная ошибка.
</DL>



<H4><A NAME="mysql_reload" HREF="manual.ru_toc.html#mysql_reload">8.4.3.45  <code>mysql_reload()</code></A></H4>
<P>
<A NAME="IDX1647"></A>

</P>
<P>
<code>int mysql_reload(MYSQL *mysql)</code>

</P>

<H4>Описание</H4>

<P>
Запрашивает сервер MySQL перегрузить таблицы привилегий. Подключенный
пользователь должен обладать правом <code>RELOAD</code>.

</P>
<P>
Данная функция не рекомендуется. Вместо нее предпочтительно использовать
функцию <code>mysql_query()</code> для вызова SQL-команды <code>FLUSH PRIVILEGES</code>.

</P>

<H4>Возвращаемые значения</H4>

<P>
Нуль при успешном выполнении запроса. Величина, отличная от нуля, если
произошла ошибка.

</P>

<H4>Ошибки</H4>
<DL COMPACT>

<DT><code>CR_COMMANDS_OUT_OF_SYNC</code>
<DD>
Команды были выполнены в ненадлежащем порядке.

<DT><code>CR_SERVER_GONE_ERROR</code>
<DD>
Сервер MySQL неожиданно завершил работу.

<DT><code>CR_SERVER_LOST</code>
<DD>
Соединение с сервером прервалось в процессе данного запроса.

<DT><code>CR_UNKNOWN_ERROR</code>
<DD>
Произошла неизвестная ошибка.
</DL>



<H4><A NAME="mysql_row_seek" HREF="manual.ru_toc.html#mysql_row_seek">8.4.3.46  <code>mysql_row_seek()</code></A></H4>
<P>
<A NAME="IDX1648"></A>

</P>
<P>
<code>MYSQL_ROW_OFFSET mysql_row_seek(MYSQL_RES *result, MYSQL_ROW_OFFSET offset)</code>

</P>

<H4>Описание</H4>

<P>
Устанавливает курсор строки на произвольную заданную строку в
результирующем наборе запроса. Это требует, чтобы структура
результирующего набора содержала целиком весь результат данного запроса,
поэтому функция <code>mysql_row_seek()</code> может использоваться только в соединении с
<code>mysql_store_result()</code>, но не с <code>mysql_use_result()</code>.

</P>
<P>
Адрес смещения должен быть величиной, возвращенной в результате вызова
функций <code>mysql_row_tell()</code> или <code>mysql_row_seek()</code>. Эта величина не является
номером строки, поэтому для проведения поиска строки внутри
результирующего набора по номеру строки вместо данной функции следует
использовать функцию <code>mysql_data_seek()</code>.

</P>

<H4>Возвращаемые значения</H4>

<P>
Предыдущая позиция курсора строки. Эта величина может быть получена
последовательным вызовом <code>mysql_row_seek()</code>.

</P>

<H4>Ошибки</H4>

<P>
Нет.

</P>


<H4><A NAME="mysql_row_tell" HREF="manual.ru_toc.html#mysql_row_tell">8.4.3.47  <code>mysql_row_tell()</code></A></H4>
<P>
<A NAME="IDX1649"></A>

</P>
<P>
<code>MYSQL_ROW_OFFSET mysql_row_tell(MYSQL_RES *result)</code>

</P>

<H4>Описание</H4>

<P>
Возвращает позицию курсора строки, использованную для последнего вызова
функции <code>mysql_fetch_row()</code>.Эта величина может использоваться как аргумент в
функции <code>mysql_row_seek()</code>.

</P>
<P>
Функцию <code>mysql_row_tell()</code> следует использовать только после функции
<code>mysql_store_result()</code>, но не после <code>mysql_use_result()</code>.

</P>

<H4>Возвращаемые значения</H4>

<P>
Текущая позиция курсора строки.

</P>

<H4>Ошибки</H4>

<P>
Нет.

</P>


<H4><A NAME="mysql_select_db" HREF="manual.ru_toc.html#mysql_select_db">8.4.3.48  <code>mysql_select_db()</code></A></H4>
<P>
<A NAME="IDX1650"></A>

</P>
<P>
<code>int mysql_select_db(MYSQL *mysql, const char *db)</code>

</P>

<H4>Описание</H4>

<P>
Устанавливает базу данных, указанную в <code>db</code>, в качестве текущей базы данных
по умолчанию для соединения, указанного в <code>mysql</code>. В последующих запросах
эта база данных является текущей по умолчанию для табличных ссылок,
которые не содержат явного указателя базы данных.

</P>
<P>
Функция <code>mysql_select_db()</code> не работает, пока подключенный пользователь не
сможет быть аутентифицирован как имеющий право на использование
запрашиваемой базы данных.

</P>

<H4>Возвращаемые значения</H4>

<P>
Нуль при успешном выполнении запроса. Величина, отличная от нуля, если
произошла ошибка.

</P>

<H4>Ошибки</H4>
<DL COMPACT>

<DT><code>CR_COMMANDS_OUT_OF_SYNC</code>
<DD>
Команды были выполнены в ненадлежащем порядке.

<DT><code>CR_SERVER_GONE_ERROR</code>
<DD>
Сервер MySQL неожиданно завершил работу.

<DT><code>CR_SERVER_LOST</code>
<DD>
Соединение с сервером прервалось в процессе данного запроса.

<DT><code>CR_UNKNOWN_ERROR</code>
<DD>
Произошла неизвестная ошибка.
</DL>



<H4><A NAME="mysql_shutdown" HREF="manual.ru_toc.html#mysql_shutdown">8.4.3.49  <code>mysql_shutdown()</code></A></H4>
<P>
<A NAME="IDX1651"></A>

</P>
<P>
<code>int mysql_shutdown(MYSQL *mysql)</code>

</P>

<H4>Описание</H4>

<P>
Останавливает сервер баз данных. Подключенный пользователь должен иметь
права <code>SHUTDOWN</code>.

</P>

<H4>Возвращаемые значения</H4>

<P>
Нуль при успешном выполнении запроса. Величина, отличная от нуля, если
произошла ошибка.

</P>

<H4>Ошибки</H4>
<DL COMPACT>

<DT><code>CR_COMMANDS_OUT_OF_SYNC</code>
<DD>
Команды были выполнены в ненадлежащем порядке.

<DT><code>CR_SERVER_GONE_ERROR</code>
<DD>
Сервер MySQL неожиданно завершил работу.

<DT><code>CR_SERVER_LOST</code>
<DD>
Соединение с сервером прервалось в процессе данного запроса.

<DT><code>CR_UNKNOWN_ERROR</code>
<DD>
Произошла неизвестная ошибка.
</DL>



<H4><A NAME="mysql_stat" HREF="manual.ru_toc.html#mysql_stat">8.4.3.50  <code>mysql_stat()</code></A></H4>
<P>
<A NAME="IDX1652"></A>

</P>
<P>
<code>char *mysql_stat(MYSQL *mysql)</code>

</P>

<H4>Описание</H4>

<P>
Возвращает символьную строку, содержащую информацию, подобную
предоставляемой командой <code>mysqladmin status</code>. Информация включает в себя
время работы сервера в секундах, а также количество запущенных потоков,
запросов, перегрузок и открытых таблиц.

</P>

<H4>Возвращаемые значения</H4>

<P>
Символьная строка с описанием статуса сервера. <code>NULL</code>, если возникла ошибка.

</P>

<H4>Ошибки</H4>
<DL COMPACT>

<DT><code>CR_COMMANDS_OUT_OF_SYNC</code>
<DD>
Команды были выполнены в ненадлежащем порядке.

<DT><code>CR_SERVER_GONE_ERROR</code>
<DD>
Сервер MySQL неожиданно завершил работу.

<DT><code>CR_SERVER_LOST</code>
<DD>
Соединение с сервером прервалось в процессе данного запроса.

<DT><code>CR_UNKNOWN_ERROR</code>
<DD>
Произошла неизвестная ошибка.
</DL>



<H4><A NAME="mysql_store_result" HREF="manual.ru_toc.html#mysql_store_result">8.4.3.51  <code>mysql_store_result()</code></A></H4>
<P>
<A NAME="IDX1653"></A>

</P>
<P>
<code>MYSQL_RES *mysql_store_result(MYSQL *mysql)</code>

</P>

<H4>Описание</H4>

<P>
Функцию <code>mysql_store_result()</code> или <code>mysql_use_result()</code> необходимо вызывать
после каждого выполненного запроса, извлекающего данные (<code>SELECT</code>, <code>SHOW</code>,
<code>DESCRIBE</code>, <code>EXPLAIN</code>).

</P>
<P>
Нет необходимости в вызове функции <code>mysql_store_result()</code> или
<code>mysql_use_result()</code> для других запросов, но не будет никакого вреда или
заметной потери производительности, если функция <code>mysql_store_result()</code> 
будет вызываться во всех случаях. Можно определить, вернул ли данный
запрос результирующий набор, проверкой, возвращает ли 0 функция
<code>mysql_store_result()</code> (более подробно об этом см. дальше).

</P>
<P>
Для проверки того, вернул данный запрос результирующий набор или нет,
можно использовать функцию <code>mysql_field_count()</code>. 
See section <A HREF="manual.ru.html#mysql_field_count">8.4.3.20  <code>mysql_field_count()</code></A>.

</P>
<P>
Функция <code>mysql_store_result()</code> читает весь результат запроса данного
клиента, выделяет структуру <code>MYSQL_RES</code> и помещает результат в эту
структуру.

</P>
<P>
Функция <code>mysql_store_result()</code> возвращает нулевой указатель, если данный
запрос не вернул результирующий набор (если этот запрос был, например,
командой <code>INSERT</code>).

</P>
<P>
Функция <code>mysql_store_result()</code> также возвращает нулевой указатель, если
чтение результирующего набора завершилось неудачно. Выяснить, произошла ли
ошибка, можно следующим образом: если <code>mysql_error()</code> не возвращает нулевой
указатель, если <code>mysql_errno()</code> возвращает величину &#60;&#62; 0 или если
<code>mysql_field_count()</code>возвращает величину &#60;&#62; 0.

</P>
<P>
Пустой результирующий набор возвращается в случае, если нет ни одной
возвращенной строки. (Пустой результирующий набор и нулевой указатель -
разные вещи в контексте возвращаемых величин.)

</P>
<P>
Если была вызвана функция <code>mysql_store_result()</code> и полученный результат не
является нулевым указателем, то можно вызвать функцию <code>mysql_num_rows()</code> для
определения количества строк в результирующем наборе.

</P>
<P>
Можно вызвать функцию <code>mysql_fetch_row()</code> для выборки строк из
результирующего набора или функции <code>mysql_row_seek()</code> и <code>mysql_row_tell()</code> для
получения или установки положения текущей строки внутри данного
результирующего набора.

</P>
<P>
Необходимо вызвать функцию <code>mysql_free_result()</code> сразу же после окончания
действий с результирующим набором.

</P>
<P>
See section <A HREF="manual.ru.html#NULL_mysql_store_result">8.4.6.1  Почему после успешных возвратов функции <code>mysql_query()</code> функция <code>mysql_store_result()</code> иногда возвращает <code>NULL</code>?</A>.

</P>

<H4>Возвращаемые значения</H4>

<P>
Результирующая структура <code>MYSQL_RES</code> с результатами. <code>NULL</code>, если произошла
ошибка.

</P>

<H4>Ошибки</H4>
<DL COMPACT>

<DT><code>CR_COMMANDS_OUT_OF_SYNC</code>
<DD>
Команды были выполнены в ненадлежащем порядке.

<DT><code>CR_OUT_OF_MEMORY</code>
<DD>
Нехватка  памяти.

<DT><code>CR_SERVER_GONE_ERROR</code>
<DD>
Сервер MySQL неожиданно завершил работу.

<DT><code>CR_SERVER_LOST</code>
<DD>
Соединение с сервером прервалось в процессе данного запроса.

<DT><code>CR_UNKNOWN_ERROR</code>
<DD>
Произошла неизвестная ошибка.
</DL>



<H4><A NAME="mysql_thread_id" HREF="manual.ru_toc.html#mysql_thread_id">8.4.3.52  <code>mysql_thread_id()</code></A></H4>
<P>
<A NAME="IDX1654"></A>

</P>
<P>
<code>unsigned long mysql_thread_id(MYSQL *mysql)</code>

</P>

<H4>Описание</H4>

<P>
Возвращает идентификатор данного потока для текущего соединения. Эта
величина может быть использована как аргумент для функции <code>mysql_kill()</code> для
уничтожения данного потока.

</P>
<P>
Если соединение прерывается и осуществляется его восстановление с помощью
функции <code>mysql_ping()</code>, то идентификатор данного потока изменится. Это
означает, что нельзя получить идентификатор данного потока и хранить его
для последующего использования. Следует определять его, когда в этом есть
необходимость.

</P>

<H4>Возвращаемые значения</H4>

<P>
Идентификатор данного потока для текущего соединения.

</P>

<H4>Ошибки</H4>

<P>
Нет.

</P>


<H4><A NAME="mysql_use_result" HREF="manual.ru_toc.html#mysql_use_result">8.4.3.53  <code>mysql_use_result()</code></A></H4>
<P>
<A NAME="IDX1655"></A>

</P>
<P>
<code>MYSQL_RES *mysql_use_result(MYSQL *mysql)</code>

</P>

<H4>Описание</H4>

<P>
Функцию <code>mysql_store_result()</code> или <code>mysql_use_result()</code> необходимо вызывать
после каждого выполненного запроса, извлекающего данные (<code>SELECT</code>, <code>SHOW</code>,
<code>DESCRIBE</code>, <code>EXPLAIN</code>).

</P>
<P>
Функция <code>mysql_use_result()</code> инициализирует извлечение результирующего
набора, но фактически не производит чтение в клиенте подобно тому, как это
делает функция <code>mysql_store_result()</code>. Вместо этого каждая строка должна
извлекаться индивидуально посредством вызова функции <code>mysql_fetch_row()</code>.
При этом методе результат запроса читается непосредственно на сервере без
промежуточного хранения его во временной таблице или локальном буфере, что
быстрее и требует намного меньше памяти, чем использование функции
<code>mysql_store_result()</code>. Клиент будет выделять память только для текущей
строки и буфер связи может расти до величины <code>max_allowed_packet</code> байтов.

</P>
<P>
С другой стороны, функцию <code>mysql_use_result()</code> нельзя использовать, если
выполняется много операций по обработке каждой строки на клиентской
стороне, или если вывод делается на терминал, на котором пользователь
может нажать <code>^S</code> (остановить вывод).

</P>
<P>
Это будет ограничивать работу сервера и будет мешать другим потокам в
обновлении таблиц, из которых выбираются данные.

</P>
<P>
При использовании <code>mysql_use_result()</code> необходимо выполнять
<code>mysql_fetch_row()</code>, пока не возвратится величина <code>NULL</code>, в противном случае
невыбранные строки данного запроса будут возвращены как часть
результирующего набора для следующего запроса. Если вы забыли сделать это,
то интерфейс C будет выдавать ошибку <code>Commands out of sync; you can't run
this command now!</code> 

</P>
<P>
Нельзя использовать функции <code>mysql_data_seek()</code>, <code>mysql_row_seek()</code>,
<code>mysql_row_tell()</code>, <code>mysql_num_rows()</code> или <code>mysql_affected_rows()</code> для обработки
результата, возвращенного функцией <code>mysql_use_result()</code>, а также нельзя
запускать другие запросы, пока функция <code>mysql_use_result()</code> не завершится
(однако после выборки всех строк функция <code>mysql_num_rows()</code> будет корректно
возвращать количество выбранных строк).

</P>
<P>
Необходимо вызвать функцию <code>mysql_free_result()</code> сразу же после окончания
действий с результирующим набором.

</P>

<H4>Возвращаемые значения</H4>

<P>
Результирующая структура <code>MYSQL_RES</code> с результатами. <code>NULL</code>, если произошла
ошибка.

</P>

<H4>Ошибки</H4>
<DL COMPACT>

<DT><code>CR_COMMANDS_OUT_OF_SYNC</code>
<DD>
Команды были выполнены в ненадлежащем порядке.

<DT><code>CR_OUT_OF_MEMORY</code>
<DD>
Нехватка  памяти.

<DT><code>CR_SERVER_GONE_ERROR</code>
<DD>
Сервер MySQL неожиданно завершил работу.

<DT><code>CR_SERVER_LOST</code>
<DD>
Соединение с сервером прервалось в процессе данного запроса.

<DT><code>CR_UNKNOWN_ERROR</code>
<DD>
Произошла неизвестная ошибка.
</DL>



<H3><A NAME="C_Thread_functions" HREF="manual.ru_toc.html#C_Thread_functions">8.4.4  Описания функций C, связанных с потоками</A></H3>

<P>
Эти функции необходимо вызывать для сборки клиента с поддержкой потоков.
See section <A HREF="manual.ru.html#Threaded_clients">8.4.8  Как создать клиентскую программу с потоками</A>.

</P>



<H4><A NAME="my_init" HREF="manual.ru_toc.html#my_init">8.4.4.1  <code>my_init()</code></A></H4>
<P>
<A NAME="IDX1656"></A>

</P>
<P>
<code>void my_init(void)</code>

</P>

<H4>Описание</H4>

<P>
Данную функцию необходимо вызывать однажды во время запуска программы
перед вызовом любой функции MySQL. Ее вызовом инициализируются необходимые
для MySQL глобальные переменные. При использовании клиентской библиотеки,
поддерживающей потоки, эта функция будет также вызывать функцию
<code>mysql_thread_init()</code> для этого потока.

</P>
<P>
Данная функция вызывается автоматически функциями <code>mysql_init()</code>,
<code>mysql_server_init()</code> и <code>mysql_connect()</code>.

</P>

<H4>Возвращаемые величины</H4>

<P>
Нет.

</P>


<H4><A NAME="mysql_thread_init" HREF="manual.ru_toc.html#mysql_thread_init">8.4.4.2  <code>mysql_thread_init()</code></A></H4>
<P>
<A NAME="IDX1657"></A>

</P>
<P>
<code>my_bool mysql_thread_init(void)</code>

</P>

<H4>Описание</H4>

<P>
Эту функцию необходимо вызывать для каждого созданного потока - для
инициализации его специфических переменных.

</P>
<P>
Данная функция вызывается автоматически функциями <code>my_init()</code> и
<code>mysql_connect()</code>.

</P>

<H4>Возвращаемые величины</H4>

<P>
Нет.

</P>


<H4><A NAME="mysql_thread_end" HREF="manual.ru_toc.html#mysql_thread_end">8.4.4.3  <code>mysql_thread_end()</code></A></H4>
<P>
<A NAME="IDX1658"></A>

</P>
<P>
<code>void mysql_thread_end(void)</code>

</P>

<H4>Описание</H4>

<P>
Данную функцию необходимо вызывать перед вызовом функции <code>pthread_exit()</code> 
для освобождения памяти, выделенной функцией <code>mysql_thread_init()</code>.

</P>
<P>
Следует учитывать, что эта функция не вызывается автоматически клиентской
библиотекой. Во избежание утечки памяти она должна вызываться явно.

</P>

<H4>Возвращаемые величины</H4>

<P>
Нет.

</P>


<H4><A NAME="mysql_thread_safe" HREF="manual.ru_toc.html#mysql_thread_safe">8.4.4.4  <code>mysql_thread_safe()</code></A></H4>
<P>
<A NAME="IDX1659"></A>

</P>
<P>
<code>unsigned int mysql_thread_safe(void)</code>

</P>

<H4>Описание</H4>

<P>
Эта функция возвращает значение, показывающее, компилировался ли данный
клиент как поддерживающий потоки.

</P>

<H4>Возвращаемые величины</H4>

<P>
1 - если данный клиент поддерживает потоки, 0 - в противном случае.

</P>


<H3><A NAME="C_Embedded_Server_func" HREF="manual.ru_toc.html#C_Embedded_Server_func">8.4.5  Описания функций C, доступных во встраиваемом сервере</A></H3>

<P>
Эти функции можно использовать при линковании с библиотекой встраиваемого
сервера MySQL.

</P>
<P>
See section <A HREF="manual.ru.html#libmysqld">8.4.9  libmysqld, встраиваемая библиотека сервера MySQL</A>.

</P>
<P>
Если данная программа слинкована с <code>-lmysqlclient</code>, а не с  <code>-lmysqld</code>, то эти
функции не делают ничего. Это обеспечивает возможность выбора между
встраиваемым сервером MySQL и автономным без какой-либо модификации кода.

</P>



<H4><A NAME="mysql_server_init" HREF="manual.ru_toc.html#mysql_server_init">8.4.5.1  <code>mysql_server_init()</code></A></H4>
<P>
<A NAME="IDX1660"></A>

</P>
<P>
<code>int mysql_server_init(int argc, char **argv, char **groups)</code>

</P>

<H4>Описание</H4>

<P>
Данную функцию необходимо вызывать только один раз во время работы
программы, использующей встроенный сервер. Это функцию следует вызвать
перед вызовом любой другой функции MySQL. Она запускает сервер
и инициализирует все подсистемы (<code>mysys</code>, InnoDB и т.д.), используемые
сервером. Без вызова этой функции произойдет аварийное завершение данной
программы. При использовании пакета <code>DBUG</code>, поставляемого вместе с MySQL,
данную функцию следует вызывать после функции <code>MY_INIT()</code>.

</P>
<P>
Аргументы <code>argc</code> и <code>argv</code> аналогичны аргументам в <code>main</code>(). Первый элемент
аргумента <code>argv</code> игнорируется (обычно он содержит имя программы). Для
удобства аргумент argc может быть равен 0 (нуль) - если не задано ни
одного аргумента командной строки для данного сервера.
<code>mysql_server_init()</code> делает копию аргументов, т.е. она безопастна для
уничтожения <code>argv</code> или <code>groups</code> после вызова.

</P>
<P>
Аргумент <code>groups</code> представляет собой список строк, заканчивающийся <code>NULL</code>.
Этот аргумент задает активные группы в файлах опций (see section <A HREF="manual.ru.html#Option_files">4.1.2  Файлы параметров <tt>`my.cnf'</tt></A>). Для удобства аргумент groups может быть равен <code>NULL</code> - в
этом случае будут активны группы <code>[server]</code> и <code>[emedded]</code>.

</P>

<H4>Пример</H4>


<PRE>
#include &#60;mysql.h&#62;
#include &#60;stdlib.h&#62;

static char *server_args[] = {
  "this_program", /* эта строка не используется */
  "--datadir=.",
  "--key_buffer_size=32M"
};

static char *server_groups[] = {
  "embedded",
  "server",
  "this_program_SERVER",
  (char *)NULL
};

int main(void) {
  mysql_server_init(sizeof(server_args) / sizeof(char *),
  server_args, server_groups);
  /* Здесь используются любые функции MySQL  API */
  mysql_server_end();
  return EXIT_SUCCESS;
}
</PRE>


<H4>Возвращаемые значения</H4>

<P>
0 - если все в порядке, 1 - если произошла ошибка.

</P>


<H4><A NAME="mysql_server_end" HREF="manual.ru_toc.html#mysql_server_end">8.4.5.2  <code>mysql_server_end()</code></A></H4>
<P>
<A NAME="IDX1661"></A>

</P>
<P>
<code>void mysql_server_end(void)</code>

</P>

<H4>Описание</H4>

<P>
Эту функцию в программе необходимо вызывать только единожды, после всех
остальных функций MySQL. Она останавливает <code>libmysqld</code>, встраиваемый сервер
MySQL.

</P>

<H4>Возвращаемые значения</H4>

<P>
Нет.

</P>


<H3><A NAME="C_API_problems" HREF="manual.ru_toc.html#C_API_problems">8.4.6  Основные вопросы и проблемы в использовании интерфейса C</A></H3>

<P>
<A NAME="IDX1662"></A>
<A NAME="IDX1663"></A>

</P>



<H4><A NAME="NULL_mysql_store_result" HREF="manual.ru_toc.html#NULL_mysql_store_result">8.4.6.1  Почему после успешных возвратов функции <code>mysql_query()</code> функция <code>mysql_store_result()</code> иногда возвращает <code>NULL</code>?</A></H4>

<P>
Для функции <code>mysql_store_result()</code> после успешного вызова функции
<code>mysql_query()</code> возможен возврат величины <code>NULL</code>. Это может означать
следующее:

</P>

<UL>
<LI>

Произошел сбой в выполнении функции <code>mallow()</code> (например, если
результирующий набор данных слишком велик).
<LI>

Данные не могли быть прочитаны (возникла ошибка в соединении).

Запрос не вернул никаких данных (например, это был запрос вида <code>INSERT</code>,
<code>UPDATE</code> или <code>DELETE</code>).
</UL>

<P>
Проверить, вернула ли данная команда не пустой результирующий набор,
всегда можно с помощью вызова функции <code>mysql_field_count()</code>. Если функция
<code>mysql_field_count()</code> возвращает нуль, то данный результирующий набор
является пустым и последний запрос представлял собой команду, которая не
возвращает результирующие величины (например, <code>INSERT</code> или <code>DELETE</code>). Если
функция <code>mysql_field_count()</code> возвращает величину, отличную от нуля, то
данная команда должна была вернуть не пустой результат (см. описание
функции <code>mysql_field_count()</code>).

</P>
<P>
Можно протестировать описанные ситуации на ошибку, вызывая функции
<code>mysql_error()</code> или <code>mysql_errno()</code>.

</P>


<H4><A NAME="Query_results" HREF="manual.ru_toc.html#Query_results">8.4.6.2  Какие результаты можно получить из запроса?</A></H4>

<P>
В дополнение к возвращенному запросом результирующему набору данных можно
также получить следующую информацию:

</P>

<UL>
<LI>

Функция <code>mysql_affected_rows()</code> возвращает количество строк,
подвергшихся воздействию во время последнего запроса при выполнении
<code>INSERT</code>, <code>UPDATE</code> или <code>DELETE</code>. Исключение составляет случай использования
команды <code>DELETE</code> без выражения <code>WHERE</code>, когда таблица воссоздается как
пустая, а это намного быстрее! В таком случае функция
<code>mysql_affected_rows()</code> в качестве количества подвергшихся воздействию
записей возвращает нуль.

<LI>

Функция <code>mysql_num_rows()</code> возвращает количество строк в результирующем
наборе данных. Функция <code>mysql_num_rows()</code> может вызываться сразу же
после возвращения функции <code>mysql_store_result()</code>. Совместно с функцией
<code>mysql_use_result()</code> функция <code>mysql_num_rows()</code> может вызываться только
после того, как извлечены все строки с помощью функции
<code>mysql_fetch_row()</code>.

<LI>

Функция <code>mysql_insert_id()</code> возвращает идентификатор, созданный
последним запросом, внесшим строку в таблицу с автоинкрементным полем
(<code>AUTO_INCREMENT</code>, <code>mysql_insert_id()</code>).

<LI>

Некоторые запросы (<code>LOAD DATA INFILE ...</code>, <code>INSERT INTO ... SELECT ...</code>,
<code>UPDATE</code>) возвращают дополнительную информацию. Ее можно получить с помощью
функции <code>mysql_info()</code>. Описание формата возвращаемой строки смотрите в
описании функции <code>mysql_info()</code>. Если дополнительная информация отсутствует,
то функция <code>mysql_info()</code> возвращает указатель <code>NULL</code>.
</UL>



<H4><A NAME="Getting_unique_ID" HREF="manual.ru_toc.html#Getting_unique_ID">8.4.6.3  Как получить уникальный идентификатор для последней внесенной строки?</A></H4>

<P>
<A NAME="IDX1664"></A>
<A NAME="IDX1665"></A>
<A NAME="IDX1666"></A>

</P>
<P>
При внесении записи в таблицу, содержащую столбец с атрибутом
<code>AUTO_INCREMENT</code>, последний сгенерированный идентификатор можно получить,
вызвав функцию <code>mysql_insert_id()</code>.

</P>
<P>
Для извлечения этого <code>id</code> можно также использовать функцию <code>LAST_INSERT_ID()</code> 
в строке запроса, передаваемой в <code>mysql_query()</code>.

</P>
<P>
Для проверки, используется или нет поле <code>AUTO_INCREMENT</code>, можно выполнить
следующий код. Этот код также проверяет, был ли данный запрос вида <code>INSERT</code>
с использованием <code>AUTO_INCREMENT</code>:

</P>

<PRE>
if (mysql_error(&#38;mysql)[0] == 0 &#38;&#38;
mysql_num_fields(result) == 0 &#38;&#38;
mysql_insert_id(&#38;mysql) != 0)
{
	used_id = mysql_insert_id(&#38;mysql);
}
</PRE>

<P>
Самое последнее сгенерированное значение идентификатора сохраняется на
сервере в течение времени жизни данного соединения. Это значение не может
быть изменено другим клиентом, более того, оно не будет изменено даже при
обновлении другого столбца <code>AUTO_INCREMENT</code> конкретной величиной (т.е. не
<code>NULL</code> или <code>0</code>).

</P>
<P>
Идентификатор, который был сгенерирован для одной таблицы, можно вставить
в другую таблицу, используя команды SQL, как показано ниже:

</P>

<PRE>
INSERT INTO foo (auto,text)
    VALUES(NULL,'text'); # генерация ID вставкой NULL
INSERT INTO foo2 (id,text)
    VALUES(LAST_INSERT_ID(),'text'); # использование ID во второй таблице
</PRE>



<H4><A NAME="C_API_linking_problems" HREF="manual.ru_toc.html#C_API_linking_problems">8.4.6.4  Проблемы линкования с интерфейсом C</A></H4>

<P>
<A NAME="IDX1667"></A>
<A NAME="IDX1668"></A>

</P>
<P>
При линковании программы с клиентской библиотекой C в некоторых системах
могут возникать следующие проблемы:

</P>

<PRE>
gcc -g -o client test.o -L/usr/local/lib/mysql -lmysqlclient -lsocket -lnsl

Undefined        first referenced
 symbol          in file
floor            /usr/local/lib/mysql/libmysqlclient.a(password.o)
ld: fatal: Symbol referencing errors. No output written to client
</PRE>

<P>
Если это случилось в вашей системе, то необходимо подключить
математическую библиотеку путем добавления параметра <code>-lm</code> в конец строки
компилирования/линкования.

</P>


<H3><A NAME="Building_clients" HREF="manual.ru_toc.html#Building_clients">8.4.7  Сборка клиентских программ</A></H3>

<P>
<A NAME="IDX1669"></A>
<A NAME="IDX1670"></A>
<A NAME="IDX1671"></A>
<A NAME="IDX1672"></A>

</P>
<P>
Клиенты MySQL, созданные собственноручно или полученные от сторонних фирм,
при компилировании должны линковаться с использованием опций <code>-lmysqlclient
-lz</code> в команде линкования. Возможно, потребуется задать опцию <code>-L</code>, чтобы
указать компоновщику местоположение данной библиотеки. Например, если
библиотека установлена в каталоге <tt>`/usr/local/mysql/lib'</tt>, следует
использовать в команде линкования выражение <code>-L/usr/local/mysql/lib
-lmysqlclient -lz</code>.

</P>
<P>
Для клиентов, использующих файлы заголовков MySQL, при компиляции,
возможно, потребуется задать опцию <code>-I</code> (например,
<code>-I/usr/local/mysql/include</code>), чтобы компилятор мог найти требуемые файлы
заголовков.

</P>
<P>
Для того что бы сделать вышеизложенное более простым под Unix мы предоставляем
для вас скрипт <code>mysql_config</code>. See section <A HREF="manual.ru.html#mysql_config">4.8.9  <code>mysql_config</code>, Получение опций компиляции для компиляции клиентских программ</A>.

</P>
<P>
Вы можете использовать его, компилируя клиента MySQL следующим образом:

</P>

<PRE>
CFG=/usr/local/mysql/bin/mysql_config
sh -c "gcc -o progname `$CFG --cflags` progname.c `$CFG --libs`"
</PRE>

<P>
<code>sh -c</code> необходимо чтобы оболочка не воспринимала вывод
<code>mysql_config</code> как одно слово.

</P>


<H3><A NAME="Threaded_clients" HREF="manual.ru_toc.html#Threaded_clients">8.4.8  Как создать клиентскую программу с потоками</A></H3>

<P>
<A NAME="IDX1673"></A>
<A NAME="IDX1674"></A>
<A NAME="IDX1675"></A>

</P>
<P>
Клиентская библиотека почти безопасна при использовании в мультипоточном
режиме. Наибольшая проблема заключается в том, что функции в <tt>`net.c'</tt>,
читающие из сокетов, не поддерживают прерываний. Они были спроектированы
исходя из предположения, что пользователь может захотеть иметь свой
собственный аварийный сигнал, который способен прерывать слишком долгое
чтение с сервера. При установке обработчиков прерываний для прерывания
<code>SIGPIPE</code> управление сокетами должно быть поддерживающим потоки.

</P>
<P>
В более ранних бинарных поставках MySQL, которые мы (разработчики MySQL)
распространяли с нашего веб-сайта (<a HREF="http://www.mysql.com/">http://www.mysql.com/</a>), клиентские
библиотеки обычно не компилировались с возможностью поддержки потоков
(бинарные поставки для Windows по умолчанию компилируются как
поддерживающие потоки). Более новые бинарные поставки должны иметь как
нормальную, так и поддерживающую потоки клиентскую библиотеку.

</P>
<P>
Чтобы получить поддерживающую потоки клиентскую программу с возможностью
прерывать ее из других потоков и устанавливать блокировки по времени при
соединении с сервером MySQL, необходимо использовать библиотеки <code>-lmysys</code>,
<code>-lmystrings</code> и <code>-ldbug libraries</code>, а также код <tt>`net_serv.o'</tt>, используемый
данным сервером.

</P>
<P>
Если нет необходимости в прерываниях или временных блокировках, то можно
просто скомпилировать поддерживающую потоки клиентскую библиотеку
(<code>mysqlclient_r</code>) и использовать ее (see section <A HREF="manual.ru.html#C">8.4  Интерфейс C для MySQL</A>). В этом случае
нет необходимости заботиться об объектном файле net_serv.o или других
библиотеках MySQL.

</P>
<P>
Если необходимо применять временные блокировки и прерывания при
использовании поддерживающего потоки клиента, то можно с успехом
использовать подпрограммы из файла <tt>`thr_alarm.c'</tt>. При использовании
подпрограмм из библиотеки mysys  следует помнить только о том, что сначала
следует вызвать функцию  <code>my_init()</code>! See section <A HREF="manual.ru.html#C_Thread_functions">8.4.4  Описания функций C, связанных с потоками</A>.

</P>
<P>
Все функции, за исключением <code>mysql_real_connect()</code>, по умолчанию являются
поддерживающими потоки. Ниже приводятся рекомендации, как следует
компилировать поддерживающую потоки клиентскую библиотеку и использовать
ее в этом режиме (замечания по функции <code>mysql_real_connect()</code> справедливы
также и для функции <code>mysql_connect()</code>, но поскольку функция <code>mysql_connect()</code> 
не рекомендуется, то в любом случае следует использовать функцию
<code>mysql_real_connect()</code>).

</P>
<P>
Для того чтобы сделать функцию <code>mysql_real_connect()</code> поддерживающей потоки,
необходимо перекомпилировать клиентскую библиотеку со следующей командой:

</P>

<PRE>
shell&#62; ./configure --enable-thread-safe-client
</PRE>

<P>
Это создаст поддерживающую потоки клиентскую библиотеку <code>libmysqlclient_r</code>
(предполагается, что данная операционная система включает поддерживающую
потоки функцию <code>gethostbyname_r()</code>). Эта библиотека является поддерживающей
потоки для данного соединения. Можно позволить двум потокам использовать
одно и то же соединение со следующими оговорками:

</P>

<UL>
<LI>

Два потока не могут посылать запрос серверу MySQL в одно и то же время
на одном и том же соединении. В особенности необходимо быть уверенным,
что в промежутках между вызовом функций <code>mysql_query()</code> и
<code>mysql_store_result()</code> никакой другой поток не использует это же
соединение.
<LI>

Многие потоки имеют доступ к различным результирующим наборам данных,
извлекаемых функцией <code>mysql_store_result()</code>.
<LI>

При использовании функции <code>mysql_use_result</code> необходимо быть уверенным,
что никакой другой поток не использует это же соединение, пока данный
результирующий набор не будет обработан. Однако действительно
наилучший вариант для потоковых клиентов, совместно использующих одно
и то же соединение, - это применять функцию <code>mysql_store_result()</code>.
<LI>

Если необходимо использовать большое количество потоков на одном и том
же соединении, то следует иметь синхронизирующую блокировку в
отношении вызова комбинации функций <code>mysql_query()</code> и
<code>mysql_store_result()</code>. Как только выполнение функции
<code>mysql_store_result()</code> заканчивается, данная блокировка может сниматься
и другие потоки могут запрашивать это же самое соединение.
<LI>

Если вы программируете с использованием потоков <code>POSIX</code>, то можно
использовать функции <code>pthread_mutex_lock()</code> и <code>pthread_mutex_unlock()</code> для
установки и освобождения синхронизирующей блокировки.
</UL>

<P>
Необходимо знать следующее: если имеется вызываемый функцией MySQL поток,
который не создавал данное соединение с базой данных MySQL, то:

</P>
<P>
При вызове функций <code>mysql_init()</code> или <code>mysql_connect()</code> MySQL создаст
специальные переменные для этого потока, которые (среди прочих применений)
используются библиотекой отладки.

</P>
<P>
При вызове функции MySQL до того, как поток вызвал функции <code>mysql_init()</code> 
или <code>mysql_connect()</code>, данный поток в этом случае не будет иметь необходимых
специальных переменных потока и, вероятно, программа рано или поздно умрет
с дампом оперативной памяти.

</P>
<P>
Для более плавной работы программы необходимо выполнить следующие
действия:

</P>

<OL>
<LI>

Вызвать функцию <code>my_init()</code> при запуске данной программы, если она
вызывает какую-либо другую функцию MySQL до  вызова  функции 
<code>mysql_real_connect()</code>.
<LI>

Вызвать функцию <code>mysql_thread_init()</code> в обработчике потока до вызова
иной функции MySQL.
<LI>

В данном потоке вызвать функцию <code>mysql_thread_end()</code> перед вызовом
<code>pthread_exit()</code>. Это освободит память, занятую специальными переменными
потока для MySQL.
</OL>

<P>
Следует учитывать, что можно получить некоторые ошибки из-за наличия
неопределенных символов при связывании клиента с библиотекой
<code>libmysqlclient_r</code>. В большинстве случаев это происходит вследствие того,
что в строку связывания/компилирования не включены библиотеки потока.

</P>


<H3><A NAME="libmysqld" HREF="manual.ru_toc.html#libmysqld">8.4.9  libmysqld, встраиваемая библиотека сервера MySQL</A></H3>

<P>
<A NAME="IDX1676"></A>
<A NAME="IDX1677"></A>

</P>



<H4><A NAME="libmysqld_overview" HREF="manual.ru_toc.html#libmysqld_overview">8.4.9.1  Обзор библиотеки встраиваемого сервера MySQL</A></H4>

<P>
Библиотека встраиваемого сервера MySQL обеспечивает возможность запуска
полнофункционального сервера MySQL внутри клиентского приложения. Основные
преимущества, которые дает ее использование, - увеличение скорости и более
простое управление для встраиваемых приложений.

</P>
<P>
Интерфейсы API для встраиваемой версии MySQL и для версии клиент/сервер
идентичны. Чтобы реализовать возможность использования встраиваемого
сервера в старом приложении с потоками, обычно необходимо только добавить
вызовы следующих функций:

</P>
<TABLE BORDER>
<TR><TD><strong>Функция</strong> </TD><TD> <strong>Когда вызывается</strong>
</TD></TR>
<TR><TD><code>mysql_server_init()</code> </TD><TD> Должна вызываться перед любой другой функцией MySQL, предпочтительно раньше, чем функция main().
</TD></TR>
<TR><TD><code>mysql_server_end()</code> </TD><TD> Должна вызываться перед выходом из данной программы.
</TD></TR>
<TR><TD><code>mysql_thread_init()</code> </TD><TD> Должна вызываться в каждом создаваемом потоке, который будет работать с MySQL.
</TD></TR>
<TR><TD><code>mysql_thread_end()</code> </TD><TD> Должна вызываться перед вызовом pthread_exit()
</TD></TR>
</TABLE>

<P>
После добавления функций необходимо связать данный код с библиотекой
<tt>`libmysqld.a'</tt> вместо <tt>`libmysqlclient.a'</tt>.

</P>
<P>
Вышеприведенные функции типа <code>mysql_server_xxx</code> также включены в
<tt>`libmysqlclient.a'</tt> - таким образом обеспечивается возможность переключаться
между встраиваемой и клиент-серверной версиями просто линкованием
конкретного приложения с соответствующей библиотекой. См.раздел 
See section <A HREF="manual.ru.html#mysql_server_init">8.4.5.1  <code>mysql_server_init()</code></A>.

</P>


<H4><A NAME="libmysqld_compiling" HREF="manual.ru_toc.html#libmysqld_compiling">8.4.9.2  Компиляция программ с libmysqld</A></H4>

<P>
Чтобы получить библиотеку <code>libmysqld</code>, необходимо сконфигурировать (при
помощи <code>configure</code>) сборку MySQL с опцией <code>--with-embedded-server</code>.

</P>
<P>
При связывании программы с <code>libmysqld</code> необходимо также включать
специфические для данной системы библиотеки <code>pthread</code> и другие библиотеки,
используемые сервером MySQL. Полный список библиотек можно получить,
выполнив <code>mysql_config --libmysqld-libs</code>.

</P>
<P>
Для компиляции и связывания должны использоваться флаги компиляции
потоковой программы, даже если никакие потоковые функции в данном коде
явно не вызываются.

</P>


<H4><A NAME="libmysqld_restrictions" HREF="manual.ru_toc.html#libmysqld_restrictions">8.4.9.3  Ограничения при использовании встраиваемого сервера MySQL</A></H4>

<P>
встраиваемый сервер имеет следующие ограничения:

</P>

<UL>
<LI>

Не поддерживает таблицы <code>ISAM</code> (это сделано главным образом для
уменьшения размеров библиотеки)
<LI>

Не поддерживает функции <code>UDF</code> (функции, определяемые пользователем).
<LI>

Не отслеживаются стеки на дампе оперативной памяти.
<LI>

Нет внутренней поддержки <code>RAID</code> (обычно этого не требуется, так как
большинство операционных систем в настоящее время имеют поддержку для
больших файлов).
<LI>

встраиваемый сервер MySQL нельзя установить как головной или
подчиненный сервер репликации
<LI>

К встраиваемому серверу нельзя подсоединиться из внешнего процесса
через сокеты или по протоколу TCP/IP.
</UL>

<P>
Некоторые из этих ограничений могут быть изменены путем редактирования
включаемого файла <tt>`mysql_embed.h'</tt> и перекомпилирования MySQL.

</P>


<H4><A NAME="libmysqld_options" HREF="manual.ru_toc.html#libmysqld_options">8.4.9.4  Использование файлов опций с встраиваемым сервером</A></H4>

<P>
<A NAME="IDX1678"></A>

</P>
<P>
Ниже приводятся рекомендации по использованию файлов опций для облегчения
перехода между клиент-серверным приложением и приложением с встраиваемым
MySQL (see section <A HREF="manual.ru.html#Option_files">4.1.2  Файлы параметров <tt>`my.cnf'</tt></A>).

</P>

<UL>
<LI>

Следует помещать общие опции в раздел <code>[server]</code>. Они будут читаться
обеими версиями MySQL.
<LI>

Следует помещать специфические клиент-серверные опции в раздел
<code>[mysqld]</code>.
<LI>

Следует помещать специфические опции встраиваемого MySQL в раздел
<code>[embedded]</code>.
<LI>

Следует помещать специфические опции приложения в раздел
<code>[ApplicationName_SERVER]</code>.
</UL>



<H4><A NAME="libmysqld_TODO" HREF="manual.ru_toc.html#libmysqld_TODO">8.4.9.5  Что осталось сделать по встраиваемомуому серверу (TODO)</A></H4>

<P>
<A NAME="IDX1679"></A>

</P>

<UL>
<LI>

Предполагается обеспечить возможность не включать некоторые части
MySQL, чтобы сделать библиотеку меньше.
<LI>

Многое еще нужно сделать для оптимизации скорости.
<LI>

Ошибки записываются в <code>stderr</code>. Предполагается добавить возможность
указывать для них имя файла.
<LI>

Необходимо изменить InnoDB, чтобы вывод этого обработчика не был бы
настолько подробным во встраиваемой версии.
</UL>



<H4><A NAME="libmysqld_example" HREF="manual.ru_toc.html#libmysqld_example">8.4.9.6  Пример простого встраиваемого сервера</A></H4>

<P>
Этот пример программы и сборочного файла должен работать без каких-либо
изменений под операционными системами Linux или FreeBSD. Для других
операционных систем потребуются небольшие изменения. При разработке
данного примера мы ставили перед собой цель предоставить достаточно
информации для понимания рассматриваемой темы и в то же время не
перегружать текст руководства лишними деталями, специфическими для
реального приложения.

</P>
<P>
Чтобы запустить этот пример, создайте каталог <tt>`test_libmysqld'</tt> там же, где
находится каталог исходного кода mysql-4.0. Сохраните исходный код
<tt>`test_libmysqld.c'</tt> и <tt>`GNUmakefile'</tt> в данном каталоге и запустите GNU
<tt>`make'</tt> в каталоге <tt>`test_libmysqld'</tt>.

</P>
<P>
<tt>`test_libmysqld.c'</tt> 

<PRE>
/*
* Клиент простого примера с использованием библиотеки встраиваемого
сервера MySQL
*/
#include &#60;mysql.h&#62;
#include &#60;stdarg.h&#62;
#include &#60;stdio.h&#62;
#include &#60;stdlib.h&#62;

MYSQL *db_connect(const char *dbname);
void db_disconnect(MYSQL *db);
void db_do_query(MYSQL *db, const char *query);

const char *server_groups[] = {
    "test_libmysqld_SERVER", "embedded", "server", NULL
};

int
main(int argc, char **argv)
{
  MYSQL *one, *two;
  /* Функцию mysql_server_init() необходимо вызывать перед любыми другими *
  функциями mysql.
  * Можно задать mysql_server_init(0, NULL, NULL); тогда для
  * инициализации сервера будут использоваться группы "server",
  * "embedded", NULL
  *}.
  *
  * В файле $HOME/.my.cnf можно указать:

[test_libmysqld_SERVER]
language = /path/to/source/of/mysql/sql/share/english

* Можно было бы, конечно, модифицировать argc и argv непосредственно
  * перед передачей их в эту функцию или создать
  * новые аргументы - для этого годится любой выбранный вами способ.
  * Однако все аргументы в argv (кроме argv[0], который
  * представляет собой имя программы) должны быть допустимыми опциями
  * для сервера MySQL.
  *
  * Если данный клиент линкуется с нормальной библиотекой mysqlclient,
  * то эта функция является просто заглушкой, ничего не делающей.
  */

mysql_server_init(argc, argv, (char **)server_groups);
one = db_connect("test");
two = db_connect(NULL);
db_do_query(one, "SHOW TABLE STATUS");
db_do_query(two, "SHOW DATABASES");
mysql_close(two);
mysql_close(one);

/* Эта функция должна вызываться после всех других функций mysql */

mysql_server_end();
exit(EXIT_SUCCESS);

}

static void
die(MYSQL *db, char *fmt, ...)
{
  va_list ap;
  va_start(ap, fmt);
  vfprintf(stderr, fmt, ap);
  va_end(ap);
  (void)putc('\n', stderr);
  if (db)
  db_disconnect(db);
  exit(EXIT_FAILURE);
}

MYSQL *
db_connect(const char *dbname)
{
  MYSQL *db = mysql_init(NULL);
  if (!db)
  die(db, "mysql_init failed: no memory");

/*
* Обратите внимание: клиент и сервер используют разные имена групп.
* Это обязательное условие, поскольку сервер не должен использовать опции
* клиента и наоборот.
*/

mysql_options(db, MYSQL_READ_DEFAULT_GROUP, "test_libmysqld_CLIENT");
if (!mysql_real_connect(db, NULL, NULL, NULL, dbname, 0, NULL, 0))
die(db, "mysql_real_connect failed: %s", mysql_error(db));
return db;
}

void
db_disconnect(MYSQL *db)
{
  mysql_close(db);
}

void
db_do_query(MYSQL *db, const char *query)
{
  if (mysql_query(db, query) != 0)
  goto err;
  if (mysql_field_count(db) &#62; 0)
  {
	MYSQL_RES *res;
	MYSQL_ROW row, end_row;
	int num_fields;
	if (!(res = mysql_store_result(db)))
	goto err;
	num_fields = mysql_num_fields(res);
	while ((row = mysql_fetch_row(res)))
	{
	   (void)fputs("&#62;&#62; ", stdout);
	   for (end_row = row + num_fields; row &#60; end_row; ++row)
	   (void)printf("%s\t", row ? (char*)*row : "NULL");
	   (void)fputc('\n', stdout);
	}
	(void)fputc('\n', stdout);
}
else
(void)printf("Affected rows: %lld\n", mysql_affected_rows(db));
return;
err:
die(db, "db_do_query failed: %s [%s]", mysql_error(db), query);
}
</PRE>

<P>
<tt>`GNUmakefile'</tt>

<PRE>
# Предполагается, что программное обеспечение MySQL установлено в
#/usr/local/mysql

inc := /usr/local/mysql/include/mysql
lib := /usr/local/mysql/lib

# Если программное обеспечение MySQL еще не установлено, сделайте такую
замену:

#inc := $(HOME)/mysql-4.0/include
#lib := $(HOME)/mysql-4.0/libmysqld

CC := gcc
CPPFLAGS := -I$(inc) -D_THREAD_SAFE -D_REENTRANT
CFLAGS := -g -W -Wall
LDFLAGS := -static

# Можно изменить -lmysqld на -lmysqlclient для того, чтобы использовать
# обычную клиент-серверную библиотеку

LDLIBS = -L$(lib) -lmysqld -lz -lm -lcrypt
ifneq (,$(shell grep FreeBSD /COPYRIGHT 2&#62;/dev/null))

# Для FreeBSD

LDFLAGS += -pthread
else

# Предполагается Linux

LDLIBS += -lpthread
endif

# Это работает для простых однофайловых тестовых программ

sources := $(wildcard *.c)
objects := $(patsubst %c,%o,$(sources))
targets := $(basename $(sources))
all: $(targets)
clean:
rm -f $(targets) $(objects) *.core
</PRE>



<H4><A NAME="libmysqld_licensing" HREF="manual.ru_toc.html#libmysqld_licensing">8.4.9.7  Лицензирование  встраиваемого  сервера</A></H4>

<P>
Исходный  код MySQL подпадает  под  действие  лицензии GNU GPL (see section <A HREF="manual.ru.html#GPL_license">G  GNU General Public License</A>). Одно из следствий этого заключается в том,
что любая программа, включающая (посредством связывания с <code>libmysqld</code>)
исходный код MySQL, должна выпускаться как открытое программное
обеспечение (под лицензией, совместимой с GPL).

</P>
<P>
Мы стараемся всячески способствовать всем, кто распространяет открытое
программное обеспечение, выпуская код под GPL или совместимой лицензией.
Для тех же, кому эти условия не подходят, существует другая возможность -
покупка коммерческой лицензии для кода MySQL у компании MySQL AB. Более
подробная информация об этом находится в разделе See section <A HREF="manual.ru.html#MySQL_licenses">1.6.3  Лицензии на ПО MySQL</A>.

</P>


<H2><A NAME="Cplusplus" HREF="manual.ru_toc.html#Cplusplus">8.5  Интерфейсы C++</A></H2>

<P>
<A NAME="IDX1680"></A>

</P>
<P>
MySQL Connector/C++ (или <code>MySQL++</code>) является официальным MySQL API для
C++. Больше информации вы можете найти на
<a HREF="http://www.mysql.com/products/mysql++/">http://www.mysql.com/products/mysql++/</a>.

</P>


<H3><A NAME="Borland_C++" HREF="manual.ru_toc.html#Borland_C++">8.5.1  Интерфейс Borland C++</A></H3>

<P>
<A NAME="IDX1681"></A>

</P>
<P>
Исходный код MySQL можно скомпилировать под Windows с Borland C++ 5.02
(исходный код Windows включает в себя только проекты для Microsoft VC++, а
для Borland C++ файлы проекта необходимо сделать самостоятельно).

</P>
<P>
Одна известная проблема, связанная с Borland C++, заключается в том, что в
нем применяется иное, чем в VC++, упорядочивание структур. Это означает,
что при попытке использовать имеющуюся по умолчанию библиотеку
<tt>`libmysql.dll'</tt> (которая была скомпилирована с VC++) совместно с Borland C++
вы столкнетесь с проблемами. Избежать этих проблем можно одним из
следующих способов.

</P>

<UL>
<LI>

Можно использовать статические библиотеки MySQL для Borland C++,
которые находятся на <a HREF="http://www.mysql.com/downloads/os-win32.html">http://www.mysql.com/downloads/os-win32.html</a>.
<LI>

Вызывать функцию <code>mysql_init()</code> только с аргументом <code>NULL</code>, не выделяя
предварительно структуру MYSQL.
</UL>



<H2><A NAME="Java" HREF="manual.ru_toc.html#Java">8.6  Взаимодействие MySQL и Java (JDBC)</A></H2>

<P>
<A NAME="IDX1682"></A>
<A NAME="IDX1683"></A>

</P>
<P>
Имеется два поддерживаемых драйвера JDBC для MySQL (драйвер Connector/J и драйвер
Reisin  JDBC). Копию драйвера Connector/J можно найти на
<a HREF="http://www.mysql.com/products/connector-j/">http://www.mysql.com/products/connector-j/</a>, а драйвера Reisin - на
<a HREF="http://www.caucho.com/projects/jdbc-mysql/index.xtp">http://www.caucho.com/projects/jdbc-mysql/index.xtp</a>. По вопросам,
касающимся документации, обращайтесь к любой документации по JDBC, а по
вопросам, касающимся присущих MySQL специфических особенностей, - к
собственной документации по конкретному драйверу.

</P>


<H2><A NAME="Python" HREF="manual.ru_toc.html#Python">8.7  Интерфейсы Python API для MySQL</A></H2>

<P>
<A NAME="IDX1684"></A>

</P>
<P>
MySQLdb предоставляет поддержку MySQL для Python, в соответствии с
интерфейсом баз данных, принятом в Python (Python DB API). Вы можете найти его
здесь: <a HREF="http://sourceforge.net/projects/mysql-python/">http://sourceforge.net/projects/mysql-python/</a>. 

</P>


<H2><A NAME="Tcl" HREF="manual.ru_toc.html#Tcl">8.8  Интерфейсы Tcl API для MySQL</A></H2>

<P>
<A NAME="IDX1685"></A>

</P>
<P>
MySQLtcl - это простой API для доступа к базам данным MySQL при помощи Tcl. Вы
можете найти его здесь: <a HREF="http://www.xdobry.de/mysqltcl/">http://www.xdobry.de/mysqltcl/</a>. 

</P>


<H2><A NAME="Eiffel" HREF="manual.ru_toc.html#Eiffel">8.9  Оболочка Eiffel для MySQL</A></H2>

<P>
<A NAME="IDX1686"></A>

</P>
<P>
Eiffel MySQL - это интерфейс к базам данным MySQL для языка 
Eiffel, написанный Майклом Рэвитсом (Michael Ravits). Вы можете найти его здесь:
<a HREF="http://efsa.sourceforge.net/archive/ravits/mysql.htm">http://efsa.sourceforge.net/archive/ravits/mysql.htm</a>. 

</P>


<H1><A NAME="Extending_MySQL" HREF="manual.ru_toc.html#Extending_MySQL">9  Расширение MySQL</A></H1>



<H2><A NAME="MySQL_internals" HREF="manual.ru_toc.html#MySQL_internals">9.1  Внутреннее устройство MySQL</A></H2>

<P>
<A NAME="IDX1687"></A>
<A NAME="IDX1688"></A>
<A NAME="IDX1689"></A>

</P>
<P>
В этом разделе рассматривается многое из того, что необходимо знать при
работе над кодом MySQL. Если вы намерены принять участие в разработке
MySQL, желаете получить доступ к самому последнему промежуточному коду
версий или просто хотите

</P>
<P>
оставаться в курсе процесса разработки, необходимо выполнять инструкции из
раздела See section <A HREF="manual.ru.html#Installing_source_tree">2.3.4  Установка из экспериментального набора исходных кодов</A>. Тем, кого интересует
внутреннее устройство MySQL, следует подписаться на наш список рассылки
<code>internals</code>. Активность этого списка сравнительно невысока. За подробностями
относительно подписки, пожалуйста, обращайтесь к разделу See section <A HREF="manual.ru.html#Mailing-list">1.8.1.1  Списки рассылки MySQL</A>. Все разработчики из MySQL AB участвуют в списке <code>internals</code>, помогая
другим людям, работающим над кодом MySQL. Не стесняйтесь использовать этот
список как для того, чтобы задавать вопросы по коду, так и для посылки
патчей, которые вы бы хотели приобщить к проекту MySQL!

</P>



<H3><A NAME="MySQL_threads" HREF="manual.ru_toc.html#MySQL_threads">9.1.1  Потоки MySQL</A></H3>

<P>
Сервер создает следующие потоки:

</P>

<UL>

<LI>

Поток TCP/IP-соединений обрабатывает все запросы подключения и создает
новые выделенные потоки для проведения аутентификации и обработки SQL
запросов для каждого соединения.

<LI>

В Windows NT есть поток обслуживания именованного канала, который
выполняет ту же работу, что и поток TCP/IP-соединений, но только по
запросам на соединение именованного канала.

<LI>

Поток сигналов обрабатывает все сигналы. Обычно этот поток также
обрабатывает сигналы таймера и обращается к <code>process_alarm()</code> для
принудительного объявления таймаутов на соединениях, которые слишком долго
простаивали.

<LI>

Если <code>mysqld</code> скомпилирован с <code>-DUSE_ALARM_THREAD</code>, то создается выделенный
поток, обрабатывающий сигналы таймера. Используется только в некоторых
системах, в которых возникают проблемы с <code>sigwait()</code>, или если есть
необходимость использовать код <code>thr_alarm()</code> в приложении без выделенного
потока обработки сигналов.

<LI>

Если применяется опция <code>--flush_time=#</code>, то создается выделенный поток для
периодического сбрасывания на диск всех таблиц с заданным интервалом.

<LI>

Каждое соединение имеет свой поток.

<LI>

Каждая отдельная таблица, на которой используется <code>INSERT DELAYED</code>,
получает свой отдельный поток.

<LI>

Если применяется <code>--master-host</code>, то запускается поток репликации
подчиненного сервера для чтения и применения обновлений от головного.
</UL>

<P>
<code>mysqladmin processlist</code> выводит только потоки соединений, <code>INSERT DELAYED</code> и
поток репликации.

</P>


<H3><A NAME="MySQL_test_suite" HREF="manual.ru_toc.html#MySQL_test_suite">9.1.2  Пакет тестирования MySQL</A></H3>

<P>
<A NAME="IDX1690"></A>
<A NAME="IDX1691"></A>

</P>
<P>
До последнего времени наш основной всесторонний пакет для тестирования
основывался на конфиденциальных данных заказчиков и по этой причине не был
общедоступным. Процесс тестирования был открытым только частично -
доступными являлись тест <code>crash-me</code>, содержащийся в каталоге <tt>`sql-bench'</tt> код
оценки производительности на Perl <code>DBI</code>/<code>DBD</code>, и различные тесты,
расположенные в каталоге <tt>`tests'</tt>. Из-за отсутствия стандартизованного
доступного пакета как нашим пользователям, так и разработчикам было сложно
выполнять регрессионные тесты кода MySQL. Чтобы решить эту проблему, мы
создали новую систему тестирования, которая включается в поставку
исходного кода и в двоичную поставку начиная с версии 3.23.29.

</P>
<P>
При помощи текущего набора контрольных тестов нельзя выполнить
всестороннюю проверку MySQL, однако он позволяет обнаружить большинство
очевидных ошибок в коде обработки SQL, проблемы ОС/библиотек, а также
достаточно полно протестировать репликацию. Нашей конечной целью является
создание тестов, охватывающих 100% кода. Мы приветствуем разработки,
дополняющие наш тестовый пакет. Пользователи должны быть заинтересованы в
том, чтобы добавить к этому пакету тесты, исследующие критические для их
систем функциональные возможности, поскольку это будет гарантировать
работу всех будущих версий MySQL с их собственными приложениями.

</P>



<H4><A NAME="running_mysqltest" HREF="manual.ru_toc.html#running_mysqltest">9.1.2.1  Выполнение тестового пакета MySQL</A></H4>

<P>
Система тестирования включает в себя интерпретатор языка тестирования
(<code>mysqltest</code>), shell-сценарий для выполнения всех тестов (<code>mysql-test-run</code>),
сами контрольные тесты, написанные на специальном языке тестирования, и
ожидаемые для них результаты. Чтобы запустить тестовый пакет в системе
после сборки, необходимо, находясь в корне каталога исходных текстов,
ввести <code>make test</code> или <code>mysql-test/mysql-test-run</code>. Если же у вас установлена
бинарная поставка, то следует перейти при помощи <code>cd</code> в корень инсталляции
(например <code>/usr/local/mysql</code>) и выполнить <code>scripts/mysql-test-run</code>. Все тесты
должны пройти успешно. В противном случае следует попробовать отыскать
причину неудачи и, если это ошибка MySQL, сообщить о ней. Обращайтесь  к 
разделу See section <A HREF="manual.ru.html#Reporting_mysqltest_bugs">9.1.2.3  Отчет об ошибках в тестовом пакете MySQL</A>.

</P>
<P>
Если на машине, которую необходимо протестировать, работает экземпляр
<code>mysqld</code>, то останавливать его не обязательно, лишь бы он не использовал
порты <code>9306</code> и <code>9307</code>. Если один из этих портов занят, то нужно
отредактировать <code>mysql-test-run</code> и изменить значения для порта головного
и/или вспомогательного серверов на номер доступного порта.

</P>
<P>
Можно выполнить один отдельный контрольный тест посредством
<code>mysql-test/mysql-test-run test_name</code>.

</P>
<P>
Если один из тестов окончился неуспешно, то чтобы узнать, как обстоит дело
с оставшимися тестами, следует проводить тестирование, запуская
<code>mysql-test-run</code> с опцией <code>--force</code>.

</P>


<H4><A NAME="extending_mysqltest" HREF="manual.ru_toc.html#extending_mysqltest">9.1.2.2  Расширение тестового пакета MySQL</A></H4>

<P>
Для создания собственных контрольных тестов можно использовать язык
<code>mysqltest</code>. К сожалению, полная документация по языку пока еще не написана,
но мы планируем в скором времени это сделать. Можно, однако, обратиться к
имеющимся контрольным тестам и использовать их в качестве примера. В
качестве отправных точек должны служить следующие моменты:

</P>

<UL>
<LI>

Тесты должны быть расположены в <code>mysql-test/t/*.test</code> 

<LI>

Контрольные тесты должны состоять из завершающихся точкой с запятой
<code>;</code> команд и должны соответствовать вводу для клиента командной строки
<code>mysql</code>. Команда по умолчанию является запросом, который предназначен
для посылки серверу MySQL, за исключением тех случаев, когда она
распознается как внутренняя команда (напр. <code>sleep</code>).

<LI>

Все запросы, выдающие результаты, - например <code>SELECT</code>, <code>SHOW</code>, <code>EXPLAIN</code> и
т.д. должны предваряться <code>@/path/to/result/file</code>. Файл должен содержать
ожидаемые результаты. Такой файл результатов можно легко
сгенерировать, запустив <code>mysqltest -r &#60; t/test-case-name.test</code> из
каталога <code>mysql-test</code>, а затем при необходимости можно отредактировать
сгенерированные файлы результатов для подгонки вывода к ожидаемому
виду. В этом случае следует быть особенно внимательным, чтобы не
добавить или удалить каких-либо невидимых символов - внимательно
следите за тем, чтобы только изменялся текст и/или удалялись строки.
Если необходимо вставить строку, то нужно следить за тем, чтобы поля
были разделены символами жесткой табуляции, и такой же символ жесткой
табуляции должен присутствовать в конце. Для проверки того, что
текстовый редактор ничего не напутал в процессе редактирования, может
пригодиться <code>od -c</code>. Мы, конечно, надеемся, что никому не придется
редактировать вывод <code>mysqltest -r</code>, поскольку потребность в этом
возникает только в случае обнаружения ошибки.

<LI>

Чтобы получить соответствие нашей конфигурации, следует разместить
файлы результатов в каталоге <code>mysql-test/r</code> и назвать их
<code>test_name.result</code>. Если тест производит более одного результата,
следует использовать <code>test_name.a.result</code>, <code>test_name.b.result</code> и т.д.

<LI>

Если команда возвращает ошибку, то необходимо в предыдущей строке
указать <code>--error error-number</code>. <code>error-number может</code> быть списком номеров
возможных ошибок, разделенных <code>','</code>.

<LI>

При написании контрольного теста репликации необходимо в первой строке
тестового файла поместить <code>source include/master-slave.inc;</code>. Для
переключения между головным и подчиненным серверами используется
<code>connection master;</code> и <code>connection slave;</code>. Если что-то требуется сделать
на дополнительном соединении, то можно выполнить <code>connection master1</code>;
для головного и <code>connection slave1;</code> для подчиненного.

<LI>

Если необходимо что-либо выполнять в цикле, то можно использовать
нечто в таком духе:


<PRE>
let $1=1000;
while ($1)
{
	# здесь выполняются ваши запросы
	dec $1;
}
</PRE>

<LI>

Для паузы между запросами используется команда <code>sleep</code>. Она поддерживает
десятые  доли  секунды, таким образом можно, например, делать <code>sleep
1.3;</code> для временной задержки в 1,3 секунды.

<LI>

Чтобы для определенного контрольного теста запускать подчиненный
сервер с дополнительными опциями, нужно поместить эти опции в формате
командной строки в <code>mysql-test/t/test_name-slave.opt</code>. Для головного
сервера опции помещаются в <code>mysql-test/t/test_name-master.opt</code>.

<LI>

Если у вас возникнут вопросы по тестовому пакету или если вы хотите
добавить контрольный тест, шлите e-mail на <a HREF="mailto:internals@lists.mysql.com">internals@lists.mysql.com</a>.
Поскольку в списке не допускаются присоединенные файлы, все нужные
файлы следует положить на: <a HREF="ftp://support.mysql.com/pub/mysql/Incoming/">ftp://support.mysql.com/pub/mysql/Incoming/</a> 
</UL>



<H4><A NAME="Reporting_mysqltest_bugs" HREF="manual.ru_toc.html#Reporting_mysqltest_bugs">9.1.2.3  Отчет об ошибках в тестовом пакете MySQL</A></H4>

<P>
Если используемая версия MySQL не проходит через тестовый пакет, следует
поступать следующим образом:

</P>

<UL>
<LI>

Прежде всего, не отсылайте отчет об ошибке, пока не соберете
максимального количества сведений по проблеме, с которой вы столкнулись!
Большая просьба к вам - используйте для этого сценарий <code>mysqlbug</code>, чтобы мы
имели возможность получить как можно больше информации о вашей системе и
версии MySQL (see section <A HREF="manual.ru.html#Bug_reports">1.8.1.3  Как отправлять отчеты об ошибках или проблемах</A>).
<LI>

Проследите за тем, чтобы в отчет был включен вывод <code>mysql-test-run</code>, а
также содержимое всех файлов <code>.reject</code> из каталога <code>mysql-test/r</code>.
<LI>

Если тест из тестового пакета терпит неудачу, проверьте, будет ли он
также неуспешным при выполнении его самого по себе:


<PRE>
cd mysql-test
mysql-test-run --local test-name
</PRE>

Если тест не проходит, то следует сконфигурировать MySQL с <code>--with-debug</code> и
запустить <code>mysql-test-run</code> с опцией <code>--debug</code>. Если он не пройдет и в этом
случае, следует положить трассировочный файл <tt>`var/tmp/master.trace'</tt> на
<a HREF="ftp://support.mysql.com/pub/mysql/secret">ftp://support.mysql.com/pub/mysql/secret</a>, чтобы мы могли его изучить.
Пожалуйста, не забудьте также включить полное описание используемой
системы, версию исполняемого файла <code>mysqld</code> и описание того, как он был
скомпилирован.
<LI>

Попробуйте также выполнить <code>mysql-test-run</code> с опцией <code>--force</code>, чтобы
выяснить, есть ли еще тесты, которые система не проходит.
<LI>

Если вы компилировали MySQL собственноручно, сверьтесь с нашим
руководством в той его части, где дается описание компиляции MySQL на
используемой платформе или (что более предпочтительно) используйте одну из
откомпилированных нами для вас бинарных поставок
<a HREF="http://www.mysql.com/downloads/">http://www.mysql.com/downloads/</a>. Все наши стандартные бинарные
дистрибутивы должны проходить тестовый пакет!
<LI>

Если получена ошибка, подобная <code>Result length mismatch</code> или <code>Result content
mismatch</code>, то это означает, что нет точного совпадения между выходными
данными теста и контрольными выходными данными. Это может говорить об
ошибке в MySQL или о том, что при некоторых обстоятельствах используемая
версия <code>mysqld</code> выдает слегка отличающиеся результаты. Результаты неудачных
тестов помещаются в файл с тем же именем, что и у файла результатов, но с
расширением <code>.reject</code>. Если контрольный тест терпит неудачу, то по этим двум
файлам следует выполнить <code>diff</code>. Если не удается обнаружить, в чем их
отличия, исследуйте оба файла с помощью <code>od -c</code>, а также проверьте их
размеры.
<LI>

Если тест полностью потерпел фиаско, то для выяснения причины неполадок
следует обратиться к файлам журналов в каталоге <code>mysql-test/var/log</code>.
<LI>

Если MySQL был скомпилирован в отладочном режиме, то можно попробовать
выполнить отладку, запустив <code>mysql-test-run</code> с опциями <code>--gdb</code> и/или <code>-debug</code> 
(see section <A HREF="manual.ru.html#Making_trace_files">D.1.2  Создание трассировочных файлов</A>). Если MySQL не был скомпилирован для
отладки, то это стоит сделать - просто задайте опции <code>--with-debug</code> для
<code>configure</code>! Обращайтесь к разделу See section <A HREF="manual.ru.html#Installing_source">2.3  Установка исходного дистрибутива MySQL</A>.
</UL>



<H2><A NAME="Adding_functions" HREF="manual.ru_toc.html#Adding_functions">9.2  Добавление новых функций в MySQL</A></H2>

<P>
<A NAME="IDX1692"></A>
<A NAME="IDX1693"></A>
<A NAME="IDX1694"></A>
<A NAME="IDX1695"></A>
<A NAME="IDX1696"></A>

</P>
<P>
Существует два способа добавления функций в MySQL:

</P>

<UL>
<LI>Можно добавить функцию посредством интерфейса определяемых пользователем

функций (user-definable function - <code>UDF</code>). Определяемые пользователем
функции добавляются и удаляются динамически с помощью команд <code>CREATE
FUNCTION</code> и <code>DROP FUNCTION</code> (see section <A HREF="manual.ru.html#CREATE_FUNCTION">9.2.1  Синтаксис <code>CREATE FUNCTION/DROP FUNCTION</code></A>).

<LI>Можно добавить функцию как ``родную'' (встроенную) функцию MySQL.

``Родные'' функции компилируются вместе с остальным кодом сервера <code>mysqld</code> и
становятся постоянно доступными.
</UL>

<P>
Каждый метод имеет преимущества и недостатки:

</P>

<UL>
<LI>

Если вы пишете определяемую пользователем функцию, то помимо сервера
необходимо инсталлировать объектный файл. В этом нет необходимости при
компиляции функции вместе с сервером.
<LI>

UDFы можно добавить в бинарную поставку MySQL. Для ``родных'' функций
необходимо изменять поставку исходного кода.
<LI>

При обновлении поставки MySQL можно продолжать использовать ранее
инсталлированные UDFы. Для ``родных функций нужно при каждом обновлении
вносить изменения повторно.
</UL>

<P>
Независимо от выбранного метода добавления новых функций, их можно
использовать точно так же, как и встроенные функции, подобные <code>ABS()</code> или
<code>SOUNDEX()</code>.

</P>



<H3><A NAME="CREATE_FUNCTION" HREF="manual.ru_toc.html#CREATE_FUNCTION">9.2.1  Синтаксис <code>CREATE FUNCTION/DROP FUNCTION</code></A></H3>

<P>
<A NAME="IDX1697"></A>
<A NAME="IDX1698"></A>
<A NAME="IDX1699"></A>
<A NAME="IDX1700"></A>
<A NAME="IDX1701"></A>
<A NAME="IDX1702"></A>
<A NAME="IDX1703"></A>

</P>


<PRE>
CREATE [AGGREGATE] FUNCTION function_name RETURNS {STRING|REAL|INTEGER}
       SONAME shared_library_name

DROP FUNCTION function_name
</PRE>

<P>
Определяемая пользователем функция (UDF) - это средство, позволяющее
расширить MySQL за счет новой функции, которая работает подобно ``родным''
(встроенным) функциям MySQL, таким как <code>ABS()</code> и <code>CONCAT()</code>.

</P>
<P>
<code>AGGREGATE</code> - новая опция для версии MySQL 3.23. <code>AGGREGATE</code> - функция работает
точно так же, как и ``родные'' <code>GROUP</code>-функции MySQL <code>GROUP</code> вроде <code>SUM</code> или
<code>COUNT()</code>.

</P>
<P>
<code>CREATE FUNCTION</code> сохраняет имя, тип и имя разделяемой библиотеки функции в
системной таблице <code>mysql.func</code>. Чтобы создавать и удалять функции,
необходимо обладать привилегиями <code>INSERT</code> и <code>DELETE</code> для базы данных <code>mysql</code>.

</P>
<P>
Все активные функции подгружаются при каждом запуске сервера, за
исключением случая, когда <code>mysqld</code> запускается с опцией <code>--skip-grant-tables</code>.
Тогда инициализация UDF пропускается и UDFы недоступны (активная функция -
это функция, которая была загружена посредством <code>CREATE FUNCTION</code> и не
удалена с помощью <code>DROP FUNCTION</code>).

</P>
<P>
Инструкции по написанию определяемых пользователем функций находятся в
разделе See section <A HREF="manual.ru.html#Adding_functions">9.2  Добавление новых функций в MySQL</A>. Чтобы механизм UDF работал, функции
должны быть написаны на C или C++, используемая операционная система
должна поддерживать динамическую загрузку и <code>mysqld</code> должен быть
скомпилирован динамически (а не статически).

</P>
<P>
Отметим, что для того, чтобы работала <code>AGGREGATE</code>, таблица <code>mysql.func</code> должна
содержать столбец <code>type</code>. В противном случае следует запустить сценарий
<code>mysql_fix_privilege_tables</code>, чтобы внести нужные исправления.

</P>


<H3><A NAME="Adding_UDF" HREF="manual.ru_toc.html#Adding_UDF">9.2.2  Добавление новой определяемой пользователем функции</A></H3>

<P>
<A NAME="IDX1704"></A>
<A NAME="IDX1705"></A>
<A NAME="IDX1706"></A>

</P>

<P>
Для того чтобы работал  механизм UDF, функции должны быть написаны на C
или на C++, а используемая операционная система должна поддерживать
динамическую загрузку. В поставку исходного кода входит файл
<tt>`sql/udf_example.cc'</tt>, в котором определены пять новых функций. К этому файлу
следует обращаться, если нужно узнать, как работает соглашение о вызовах
UDF.

</P>
<P>
Чтобы <code>mysqld</code> имел возможность использовать UDF-функции, необходимо
сконфигурировать MySQL с <code>--with-mysqld-ldflags=-rdynamic</code>. Причина здесь в
том, что на многих платформах (включая Linux) можно загружать динамическую
библиотеку (посредством <code>dlopen()</code>) из статически скомпонованной программы,
получаемой при использовании <code>--with-mysqld-ldflags=-all-static</code>. Если есть
потребность использовать UDF, которой нужно обращаться к символам из
mysqld (как в примере функции <code>methaphone</code> из <tt>`sql/udf_example.cc'</tt>, которая
использует <code>default_charset_info</code>), то программу необходимо компоновать с
<code>-rdynamic</code> (обращайтесь к <code>man dlopen</code>).

</P>
<P>
Для каждой функции, которую предполагается использовать в командах SQL,
следует определять соответствующие функции C (или C++). В дальнейшем в
качестве имени для примера функции мы будем использовать имя xxx. Чтобы
различать применение в SQL и C/C++, для вызова SQL-функции мы будем
использовать обозначение <code>XXX()</code> (прописными), а <code>xxx()</code> (строчными) - для
вызова функции C/C++.

</P>
<P>
Для реализации интерфейса для <code>XXX()</code> требуются следующие функции C/C++:

</P>
<DL COMPACT>

<DT><code>xxx()</code> (обязательная)
<DD>
Главная функция. Она вычисляет результат функции. Соответствие между
типами SQL и возвращаемым типом функции C/C++ показано в приведенной ниже
таблице:

<TABLE BORDER>
<TR><TD><strong>Тип SQL</strong> </TD><TD> <strong>Тип C/C++</strong>
</TD></TR>
<TR><TD><code>STRING</code> </TD><TD> <code>char *</code>
</TD></TR>
<TR><TD><code>INTEGER</code> </TD><TD> <code>long long</code>
</TD></TR>
<TR><TD><code>REAL</code> </TD><TD> <code>double</code>
</TD></TR>
</TABLE>

<DT><code>xxx_init()</code> (необязательная)
<DD>
Функция инициализации для <code>xxx()</code>. Может быть использована:


<UL>
<LI>

для проверки количества аргументов к <code>XXX()</code>;
<LI>

для проверки того, что аргументы имеют требуемый тип или, в противном
случае, для указания MySQL приводить аргументы к нужным типам при вызове
главной функции;
<LI>

для распределения всей памяти, требуемой основной функцией;
<LI>

для задания максимальной длины результата;
<LI>

для задания (для REAL-функций) максимального числа десятичных знаков
после запятой;
<LI>

для указания, может ли результатом быть NULL.
</UL>

<DT><code>xxx_deinit()</code> (необязательная)
<DD>
Функция деинициализации для <code>xxx()</code>. Должна освобождать всю память,
выделенную функцией инициализации.
</DL>

<P>
При запуске SQL-команды <code>XXX()</code> MySQL вызывает функцию инициализации
<code>xxx_init()</code>, чтобы дать ей возможность выполнить все необходимые установки,
такие как проверка аргументов и распределение памяти. Если <code>xxx_init()</code> 
возвращает ошибку, то выполнение SQL-команды прерывается с сообщением об
ошибке, а главная функция и функция деинициализации не вызываются. В
противном случае для каждой строки вызывается главная функция <code>xxx()</code>. После
того как будут обработаны все строки, вызывается функция деинициализации
<code>xxx_deinit()</code>, чтобы выполнить необходимую очистку.

</P>
<P>
Для агрегатных функций (подобных <code>SUM()</code>) необходимо также подготовить
следующие функции:

</P>
<DL COMPACT>

<DT><code>xxx_reset()</code> (обязательная)
<DD>
Сбрасывает сумму и обрабатывает аргумент как начальное значение для новой
группы.
<DT><code>xxx_add()</code> (обязательная)
<DD>
Добавляет аргумент к имеющейся сумме.
</DL>

<P>
При использовании агрегатных UDF-функций MySQL работает следующим образом:

</P>

<OL>
<LI>

Вызывается <code>xxx_init()</code>, чтобы агрегатная функция могла распределить
память, которая понадобится для хранения результатов.
<LI>

Таблица сортируется в соответствии с выражением <code>GROUP BY</code>.
<LI>

Для первой строки новой группы вызывается функция <code>xxx_reset()</code>.
<LI>

Для каждой новой строки, принадлежащей к той же группе, вызывается
функция <code>xxx_add()</code>.
<LI>

Когда группа меняется, или после завершения обработки последней строки
вызывается <code>xxx()</code> для получения итога.
<LI>

Повторяются шаги 3-5, пока не будут обработаны все строки.
<LI>

Вызывается <code>xxx_deinit()</code>, чтобы UDF могла освободить всю распределенную
ею память.
</OL>

<P>
Все функции должны поддерживать многопоточность (не только главная, но
также и функции инициализации и деинициализации). Это означает, что
непозволительно распределять какие-либо глобальные или статические
переменные с изменяющимися значениями! Если требуется память, то ее
следует распределять в <code>xxx_init()</code> и освобождать в <code>xxx_deinit()</code>.

</P>


<H4><A NAME="UDF_calling" HREF="manual.ru_toc.html#UDF_calling">9.2.2.1  Последовательность вызова UDF для простых функций</A></H4>

<P>
<A NAME="IDX1707"></A>

</P>

<P>
Главная функция должна быть определена, как это показано здесь. Обратите
внимание на то, что тип возвращаемого значения и параметры варьируются в
зависимости от того, как определена SQL-функция <code>XXX()</code> в команде <code>CREATE
FUNCTION</code> - как возвращающая <code>STRING</code>, <code>INTEGER</code> или <code>REAL</code>:

</P>
<P>
Для <code>STRING</code>-функций:

<PRE>
char *xxx(UDF_INIT *initid, UDF_ARGS *args,
	  char *result, unsigned long *length,
	  char *is_null, char *error);
</PRE>

<P>
Для <code>INTEGER</code>-функций:

<PRE>
long long xxx(UDF_INIT *initid, UDF_ARGS *args,
	      char *is_null, char *error);
</PRE>

<P>
Для <code>REAL</code>-функций:

<PRE>
double xxx(UDF_INIT *initid, UDF_ARGS *args,
	   char *is_null, char *error);
</PRE>

<P>
Функции инициализации и деинициализации объявляются следующим образом:

</P>

<PRE>
my_bool xxx_init(UDF_INIT *initid, UDF_ARGS *args, char *message);

void xxx_deinit(UDF_INIT *initid);
</PRE>

<P>
Параметр <code>initid</code> передается всем трем функциям. Он указывает на структуру
<code>UDF_INIT</code>, используемую для передачи информации между функциями. Поля
структуры <code>UDF_INIT</code> перечислены ниже. Функция инициализации должна
заполнять все поля, которые ей следует изменить (чтобы использовать для
поля значение по умолчанию, его необходимо оставить в неизменном виде):

</P>
<DL COMPACT>

<DT><code>my_bool maybe_null</code>
<DD>
<code>xxx_init()</code> должна устанавливать <code>maybe_null</code> в <code>1</code>, если <code>xxx()</code> может
возвращать <code>NULL</code>. Значение по умолчанию будет <code>1</code>, если хоть один аргумент
объявлен как <code>maybe_null</code>.

<DT><code>unsigned int decimals</code>
<DD>
Количество знаков после запятой. По умолчанию используется максимальное
количество знаков для аргументов, переданных в основную функцию.
(Например, если функции передаются 1,34, 1,345 и 1,3, то значением по
умолчанию будет 3, поскольку 1,345 имеет 3 знака после запятой.

<DT><code>unsigned int max_length</code>
<DD>
Максимальная длина строкового результата. Значение по умолчанию зависит от
типа результата функции. Для строковых функций по умолчанию используется
размер наиболее длинного аргумента. Для целочисленных функций значение по
умолчанию составляет 21 цифру. Для вещественных функций по умолчанию
берется 13 плюс количество знаков после запятой, которое задается
<code>initid-&#62;decimals</code> (для числовых функций длина включает знак и символ
десятичной точки). Если требуется возвращать значение типа <code>BLOB</code>, то поле
можно установить равным либо 65  Kб либо 16  Mб; эта память не
распределяется, а применяется для определения того, какой использовать тип
столбцов, если понадобится временно хранить данные.

<DT><code>char *ptr</code>
<DD>
Указатель, используемый функцией по своему усмотрению. Например, функции
могут применять <code>initid-&#62;ptr</code> для передачи между функциями распределенной
памяти. В <code>xxx_init()</code> память распределяется и назначается этому указателю:


<PRE>
initid-&#62;ptr = allocated_memory;
</PRE>

В <code>xxx()</code> и <code>xxx_deinit()</code> должны обращаться к <code>initid-&#62;ptr</code> для использования
или освобождения памяти.
</DL>



<H4><A NAME="UDF_aggr._calling" HREF="manual.ru_toc.html#UDF_aggr._calling">9.2.2.2  Последовательность вызова UDF для агрегатных функций</A></H4>

<P>
<A NAME="IDX1708"></A>

</P>
<P>
Ниже приведено описание функций, которые необходимо определить при
создании агрегатной UDF-функции.

</P>

<PRE>
char *xxx_reset(UDF_INIT *initid, UDF_ARGS *args,
		char *is_null, char *error);
</PRE>

<P>
Эта функция вызывается, когда MySQL находит первую строку в новой группе.
В функции необходимо сбросить все внутренние переменные, в которых
накапливаются значения, и затем установить переданный аргумент как первый
аргумент в группе.

</P>
<P>
Во многих случаях это реализуется путем сброса всех переменных и
последующего вызова <code>xxx_add()</code>.

</P>

<PRE>
char *xxx_add(UDF_INIT *initid, UDF_ARGS *args,
	      char *is_null, char *error);
</PRE>

<P>
Эта функция вызывается для всех строк, принадлежащих к одной группе, за
исключением первой. В функции к внутренней накопительной переменной
следует добавить значение <code>UDF_ARGS</code>.

</P>
<P>
Функция <code>xxx()</code> должна быть объявлена точно так же, как это делается при
определении простой UDF-функции (see section <A HREF="manual.ru.html#UDF_calling">9.2.2.1  Последовательность вызова UDF для простых функций</A>).

</P>
<P>
Вызов этой функции происходит, когда все строки в группе обработаны.
Обычно функция не должна обращаться к переменной <code>args</code>, а возвращаемое
значение должно базироваться на внутренних накопительных переменных.

</P>
<P>
Какая бы то ни было, обработка аргументов в <code>xxx_reset()</code> и <code>xxx_add()</code> должна
проводиться точно так же, как для нормальных UDF-функций (see section <A HREF="manual.ru.html#UDF_arguments">9.2.2.3  Обработка  аргументов</A>).

</P>
<P>
Организация возврата значений в <code>xxx()</code> эквивалентна  используемой для
нормальной UDF (see section <A HREF="manual.ru.html#UDF_return_values">9.2.2.4  Возвращаемые значения и обработка ошибок</A>).

</P>
<P>
Аргументы-указатели <code>is_null</code> и <code>error</code> одинаковы для всех вызовов
<code>xxx_reset()</code>, <code>xxx_add()</code> и <code>xxx()</code>. Их можно использовать для запоминания
того, что произошла ошибка, или когда функция <code>xxx()</code> должна возвращать
<code>NULL</code>. Заметьте, что сохранять строку в <code>*error</code> нельзя! Это всего лишь
1-байтовый флаг!

</P>
<P>
<code>is_null</code> сбрасывается для каждой группы (перед вызовом <code>xxx_reset()</code>). <code>error</code>
не сбрасывается никогда.

</P>
<P>
Если <code>is_null</code> или <code>error</code> окажется установленным после <code>xxx()</code>, MySQL вернет
<code>NULL</code> в качестве результата групповой функции.

</P>


<H4><A NAME="UDF_arguments" HREF="manual.ru_toc.html#UDF_arguments">9.2.2.3  Обработка  аргументов</A></H4>

<P>
<A NAME="IDX1709"></A>

</P>
<P>
Параметр args указывает на структуру UDF_ARGS, содержащую перечисленные
ниже поля:

</P>
<DL COMPACT>

<DT><code>unsigned int arg_count</code>
<DD>
Количество аргументов. Это значение следует проверять в функции
инициализации, если необходимо, чтобы функция вызывалась с определенным
количеством аргументов. Например:


<PRE>
if (args-&#62;arg_count != 2)
{
	strcpy(message,"XXX() requires two arguments");
	return 1;
}
</PRE>

<DT><code>enum Item_result *arg_type</code>
<DD>
Тип для каждого аргумента. Возможные  значения  типа: <code>STRING_RESULT</code>,
<code>INT_RESULT</code> и <code>REAL_RESULT</code>. Чтобы контролировать принадлежность аргументов к
нужному типу и возвращать ошибку, если это не так, следует проверить
массив <code>arg_type</code> в функции инициализации. Например:


<PRE>
if (args-&#62;arg_type[0] != STRING_RESULT ||
args-&#62;arg_type[1] != INT_RESULT)
{
	strcpy(message,"XXX() requires a string and an integer");
	return 1;
}
</PRE>

В качестве альтернативы требованию, чтобы аргументы были определенного
типа, можно использовать функцию инициализации для назначения элементам
<code>arg_type</code> выбранных типов. В этом случае MySQL будет приводить аргументы к
этим типам для каждого вызова <code>xxx()</code>. Например, чтобы указать на приведение
первых двух аргументов к строковому и целочисленному типам, выполните в
<code>xxx_init()</code>:


<PRE>
args-&#62;arg_type[0] = STRING_RESULT;
args-&#62;arg_type[1] = INT_RESULT;
</PRE>

<DT><code>char **args</code>
<DD>
<code>args-&#62;args</code> передает в функцию инициализации информацию общего характера об
аргументах, с которыми была вызвана функция. Для константного аргумента <code>i</code>
<code>args-&#62;args[i]</code> указывает на значение аргумента (ниже приведены инструкции о
том, как правильно получать доступ к значениям). Для неконстантого
аргумента <code>args-&#62;args[i]</code> есть <code>0</code>. Константный аргумент - это выражение, в
котором используются только константы, вроде <code>3</code> или <code>4*7-2</code> или <code>SIN(3.14)</code>.
Неконстантный аргумент - это выражение, ссылающееся на значения, которые
могут изменяться от строки к строке, такие как имена столбцов или
обращения к функциям с неконстантными аргументами.

Для каждого вызова главной функции <code>args-&#62;args</code> содержит фактические аргументы, переданные для
обрабатываемой в данный момент строки.

Функции могут ссылаться на аргумент <code>i</code> следующим образом:


<UL>
<LI>

Аргумент типа <code>STRING_RESULT</code> передается в виде указателя на строку плюс
длина, чтобы обеспечить обработку двоичных данных или данных произвольной
длины. Содержимое строки доступно посредством <code>args-&#62;args[i]</code>, а длина
строки представляет собой <code>args-&#62;lengths[i]</code>. Не следует исходить из
предположения, что символ <code>\0</code> отмечает конец строки.
<LI>

Для аргумента типа <code>INT_RESULT</code> необходимо привести <code>args-&#62;args[i]</code> к
значению типа <code>long long</code>:


<PRE>
long long int_val;
int_val = *((long long*) args-&#62;args[i]);
</PRE>

<LI>

Для аргумента типа <code>REAL_RESULT</code> необходимо привести <code>args-&#62;args[i]</code> к
значению типа <code>double</code>:


<PRE>
double real_val;
real_val = *((double*) args-&#62;args[i]);
</PRE>

</UL>

<DT><code>unsigned long *lengths</code>
<DD>
Для функции инициализации массив <code>lengths</code> указывает максимальную длину
строки для каждого аргумента. Изменять этот массив нельзя. При каждом
вызове главной функции <code>lengths</code> содержит фактические длины всех строковых
аргументов, переданных для обрабатываемой в текущий момент строки. Для
типов аргументов <code>INT_RESULT</code> или <code>REAL_RESULT</code> <code>lengths</code> также содержит
максимальную длину аргумента (как для функции инициализации).
</DL>



<H4><A NAME="UDF_return_values" HREF="manual.ru_toc.html#UDF_return_values">9.2.2.4  Возвращаемые значения и обработка ошибок</A></H4>

<P>
<A NAME="IDX1710"></A>
<A NAME="IDX1711"></A>
<A NAME="IDX1712"></A>

</P>
<P>
Функция инициализации должна возвращать <code>0</code>, если ошибок нет, и <code>1</code> в
противном случае. Если происходит ошибка, <code>xxx_init()</code> должна поместить
сообщение об ошибке с завершающим <code>'\0'</code> в параметр message. Сообщение будет
возвращено клиенту. Буфер сообщения имеет длину <code>MYSQL_ERRMSG_SIZE</code>
символов, но надо стараться, чтобы сообщение не превышало 80 символов -
для соответствия  ширине стандартного экрана терминала.

</P>
<P>
Возвращаемое главной функцией <code>xxx()</code> значение является значением функции
для функций <code>long long</code> и <code>double</code>. Строковые функции должны возвращать
указатель на результат и помещать длину строки в аргумент <code>length</code>.

</P>
<P>
Эти величины следует устанавливать равными содержимому и длине
возвращаемого значения. К  примеру:

</P>

<PRE>
memcpy(result, "result string", 13);
*length = 13;
</PRE>

<P>
Размер буфера <code>result</code>,  передаваемого вычислительной функции, составляет
255 байтов. Если этого достаточно для полученного результата, то о
распределении памяти для результатов беспокоиться нечего.

</P>
<P>
Если строковая функция должна возвращать строку длиннее, чем 255 байтов,
то для строки необходимо выделять память с помощью <code>malloc()</code> в функции
<code>xxx_init()</code> или в <code>функции xxx()</code> и освобождать ее в функции <code>xxx_deinit()</code>.
Указатель на распределенную память можно сохранить в поле <code>ptr</code> структуры
<code>UDF_INIT</code>, чтобы в последующих вызовах <code>xxx()</code> использовать эту память
повторно (see section <A HREF="manual.ru.html#UDF_calling">9.2.2.1  Последовательность вызова UDF для простых функций</A>.

</P>
<P>
Чтобы указать в главной функции на возврат значения <code>NULL</code>, <code>is_null</code>
устанавливается в <code>1</code>:

</P>

<PRE>
*is_null = 1;
</PRE>

<P>
Чтобы указать в главной функции на возврат ошибки, в <code>1</code> устанавливается
параметр <code>error</code>:

</P>

<PRE>
*error = 1;
</PRE>

<P>
Если <code>xxx()</code> устанавливает для какой-либо строки <code>*error</code> в <code>1</code>, то значение
функции будет <code>NULL</code> для этой и всех последующих строк, обрабатываемых
командой, в которой вызывается <code>XXX()</code> (для последующих строк <code>xxx()</code> даже не
будет вызываться). <strong>Примечание</strong>: в версиях MySQL до 3.22.10 было необходимо
устанавливать как <code>*error</code> так и <code>*is_null</code>:

</P>

<PRE>
*error = 1;
*is_null = 1;
</PRE>



<H4><A NAME="UDF_compiling" HREF="manual.ru_toc.html#UDF_compiling">9.2.2.5  Компиляция и установка определяемых пользователем функций</A></H4>

<P>
<A NAME="IDX1713"></A>
<A NAME="IDX1714"></A>

</P>
<P>
Файлы, реализующие UDFы, должны компилироваться и устанавливаться на
машине, где работает сервер. Эта процедура описана ниже для файла примеров
UDF <tt>`udf_example.cc'</tt>, входящего в поставку исходного кода MySQL. Данный файл
содержит следующие функции:

</P>

<UL>
<LI>

<code>metaphon()</code> возвращает <code>metaphon</code>-строку для строкового аргумента. Эта
строка в общем напоминает <code>soundex</code>-строку, но более приспособлена для
английского языка.
<LI>

<code>myfunc_double()</code> возвращает отношение суммы ASCII-значений символов своих
аргументов к суммарной длине аргументов.
<LI>

<code>myfunc_int()</code> возвращает суммарную длину своих аргументов.
<LI>

<code>sequence([const int])</code> возвращает последовательность, начиная с заданного
номера, либо с 1, если номер не задан.
<LI>

<code>lookup()</code> возвращает IP-адрес для имени удаленного компьютера.
<LI>

<code>reverse_lookup()</code> возвращает имя удаленного компьютера для IP-адреса.
Функция может вызываться для строки <code>"xxx.xxx.xxx.xxx"</code> либо для четырех
чисел.
</UL>

<P>
Динамически загружаемый файл должен компилироваться как разделяемый
объектный файл с помощью команды следующего вида:

</P>

<PRE>
shell&#62; gcc -shared -o udf_example.so myfunc.cc
</PRE>

<P>
Корректные опции компилятора для своей системы можно легко получить,
запустив следующую команду в каталоге <tt>`sql'</tt> дерева исходных текстов MySQL:

</P>

<PRE>
shell&#62; make udf_example.o
</PRE>

<P>
Следует выполнить команду компиляции, подобную приведенной выше <code>make</code>, с
той разницей, что надо удалить опцию <code>-c</code> ближе к концу строки и добавить <code>-o</code> 
<tt>`udf_example.so'</tt> в конце строки (в некоторых системах, возможно, <code>-c</code> придется
оставить в команде).

</P>
<P>
После компиляции разделяемого объектного файла, содержащего UDFы, следует
установить его и дать о нем знать MySQL. В результате компиляции
разделяемого объектного модуля из <tt>`udf_example.cc'</tt> получается файл с именем
наподобие <tt>`udf_example.so'</tt> (точное имя может на разных платформах может быть
различным). Скопируйте этот файл в какой-нибудь просматриваемый <code>ld</code>
каталог, вроде <tt>`/usr/lib'</tt>. Во многих системах можно устанавливать переменную
окружения <code>LD_LIBRARY</code> или <code>LD_LIBRARY_PATH</code> для указания каталога, в котором
размещены файлы UDF-функций. В руководстве по <code>dlopen</code> указывается, какую
переменную следует использовать в данной системе. Необходимо сделать
соответствующие установки в скриптах запуска <code>mysql.server</code> или <code>safe_mysqld</code> и перезапустить
<code>mysqld</code>.

</P>
<P>
После установки библиотеки следует уведомить <code>mysqld</code> о новых функциях
следующими командами:

</P>

<PRE>
mysql&#62; CREATE FUNCTION metaphon RETURNS STRING SONAME "udf_example.so";
mysql&#62; CREATE FUNCTION myfunc_double RETURNS REAL SONAME "udf_example.so";
mysql&#62; CREATE FUNCTION myfunc_int RETURNS INTEGER SONAME "udf_example.so";
mysql&#62; CREATE FUNCTION lookup RETURNS STRING SONAME "udf_example.so";
mysql&#62; CREATE FUNCTION reverse_lookup
    -&#62; RETURNS STRING SONAME "udf_example.so";
mysql&#62; CREATE AGGREGATE FUNCTION avgcost
    -&#62; RETURNS REAL SONAME "udf_example.so";
</PRE>

<P>
Функции могут быть удалены с помощью <code>DROP FUNCTION</code>:

</P>

<PRE>
mysql&#62; DROP FUNCTION metaphon;
mysql&#62; DROP FUNCTION myfunc_double;
mysql&#62; DROP FUNCTION myfunc_int;
mysql&#62; DROP FUNCTION lookup;
mysql&#62; DROP FUNCTION reverse_lookup;
mysql&#62; DROP FUNCTION avgcost;
</PRE>

<P>
Команды <code>CREATE FUNCTION</code> и <code>DROP FUNCTION</code> обновляют  системную  таблицу <code>func</code>
в  базе данных <code>mysql</code>. В таблицу записываются имя функции, ее тип и имя
разделяемой библиотеки. Для создания и удаления функций необходимо
обладать привилегиями <code>INSERT</code> и <code>DELETE</code> для базы данных <code>mysql</code>.

</P>
<P>
Недопустимо использовать <code>CREATE FUNCTION</code> для добавления функции, которая
уже была создана. Если необходимо переустановить функцию, ее следует
удалить с помощью <code>DROP FUNCTION</code> и затем переустановить посредством <code>CREATE
FUNCTION</code>. Эти действия приходится выполнять, например, когда компилируется
новая версия данной функции, и надо, чтобы <code>mysqld</code> получил новую версию.
Иначе сервер будет продолжать пользоваться старой версией.

</P>
<P>
Активные функции подгружаются при каждом запуске сервера, за исключением
случая, когда <code>mysqld</code> запускается с опцией <code>--skip-grant-tables</code>. Тогда
инициализация UDF пропускается и UDFы недоступны (активная функция - это
функция, которая была загружена посредством <code>CREATE FUNCTION</code> и не удалена с
помощью <code>DROP FUNCTION</code>).

</P>


<H3><A NAME="Adding_native_function" HREF="manual.ru_toc.html#Adding_native_function">9.2.3  Добавление новых родных функции</A></H3>

<P>
<A NAME="IDX1715"></A>
<A NAME="IDX1716"></A>

</P>
<P>
В этом разделе приведена процедура добавления новой ``родной'' функции.
Следует учитывать, что в бинарную поставку ``родные'' функции добавить
невозможно, поскольку эта процедура требует изменения исходного кода
MySQL. Поэтому необходимо собственноручно компилировать MySQL из поставки
исходного текста. Кроме того, при переходе на другую версию MySQL
(например, при выпуске новой версии) все изменения придется повторить для
этой новой версии.

</P>
<P>
Чтобы добавить новую ``родную'' функцию MySQL, необходимо выполнить
следующие действия:

</P>

<OL>
<LI>

Добавьте в <tt>`lex.h'</tt> одну строку, определяющую имя новой функции в
массиве <code>sql_functions[]</code>.
<LI>

Если прототип функции простой (вообще без аргументов или принимает
один, два или три аргумента), то в <tt>`lex.h'</tt> вторым аргументом в массиве
<code>sql_functions[]</code> следует указать <code>SYM(FUNC_ARG#)</code> (где # количество
аргументов) и добавить в <tt>`item_create.cc'</tt> функцию, создающую объект
функции. В качестве примеров можно рассмотреть <code>ABS</code> и
<code>create_funcs_abs()</code>. Если прототип функции сложный (например,
принимает переменное число аргументов), то следует добавить две
строки в <tt>`sql_yacc.yy'</tt>. Одна строка служит для указания препроцессору,
какой символ должен определить <code>yacc</code> (строку следует добавить в
начало файла). Затем определяются параметры функции и правило
разбора <code>simple_expr</code> пополняется "элементом" с этими параметрами.
Чтобы получить представление о том, как это делается, в качестве
примера просмотрите все вхождения <code>ATAN</code> в <tt>`sql_yacc.yy'</tt>.
<LI>

В <tt>`item_func.h'</tt> объявляется класс, наследуемый от <code>Item_num_func</code> или
<code>Item_str_func</code>, в зависимости от того, какое значение возвращает
функция - числовое или строковое.
<LI>

В <tt>`item_func.cc'</tt> добавьте одно из следующих объявлений, в зависимости
от того, какая функция определяется - числовая или строковая:


<PRE>
double Item_func_newname::val()
longlong Item_func_newname::val_int()
String *Item_func_newname::Str(String *str)
</PRE>

Если объект наследуется от любого стандартного элемента (подобного
<code>Item_num_func</code>), то, возможно, потребуется определить только одну из
перечисленных выше функций и возложить на родительский объект заботу об
остальных функциях. Например, класс <code>Item_str_func</code> определяет функцию
<code>val()</code>, выполняющую <code>atof()</code> над значением, возвращенным <code>::str()</code>.
<LI>

Возможно, понадобится также определить следующую функцию объекта:


<PRE>
void Item_func_newname::fix_length_and_dec()
</PRE>

Эта функция должна как минимум вычислять <code>max_length</code> на основе переданных
аргументов. <code>max_length</code> является максимальным количеством символов, которое
может возвращать функция. Эта функция также должна устанавливать
<code>maybe_null = 0</code>, если невозможно, чтобы главная функция возвратила значение
<code>NULL</code>. Узнать, может ли какой-либо аргумент функции возвращать <code>NULL</code>,
функция может путем проверки поля/переменной <code>maybe_null</code> аргумента. В
качестве типичного примера того, как это делается, можно рассмотреть
<code>Item_func_mod::fix_length_and_dec</code>.
</OL>

<P>
Все функции должны поддерживать многопоточность (другими словами,
непозволительно использовать какие-либо глобальные или статические
переменные в функции без их защиты  примитивами взаимного исключения).

</P>
<P>
Если желательно возвращать <code>NULL</code>, из <code>::val()</code>, <code>::val_int()</code> или <code>::str()</code>, то
необходимо устанавливать <code>null_value</code> в <code>1</code> и возвращать <code>0</code>.

</P>
<P>
Для функции объекта <code>::str()</code> существуют следующие дополнительные аспекты:

</P>

<UL>
<LI>

Аргумент <code>String *str</code> обеспечивает строковый буфер, который может быть
использован для размещения результата (дополнительную информацию о типе
<code>String</code> можно найти в файле <tt>`sql_string.h'</tt>).
<LI>

Функция <code>::str()</code> должна возвращать строку, содержащую результат, или
<code>(char*) 0</code>, если результат <code>NULL</code>.
<LI>

На сегодняшний день при написании всех строковых функций принято
избегать какого бы то ни было распределения памяти, за исключением
случаев, когда это абсолютно необходимо!
</UL>



<H2><A NAME="Adding_procedures" HREF="manual.ru_toc.html#Adding_procedures">9.3  Добавление новой процедуры в MySQL</A></H2>

<P>
<A NAME="IDX1717"></A>
<A NAME="IDX1718"></A>
<A NAME="IDX1719"></A>

</P>
<P>
В MySQL, можно определить процедуру на C++, которая обращается к данным в
запросе и изменяет их до того, как они будут посланы клиенту. Изменение
может быть выполнено на построчном уровне, либо на уровне <code>GROUP BY</code>.

</P>
<P>
Чтобы продемонстрировать то, как это можно сделать, мы создали пример
процедуры в версии MySQL 3.23.

</P>
<P>
Дополнительно мы рекомендуем обратить внимание <code>mylua</code>. Располагая <code>mylua</code>,
можно использовать язык <code>LUA</code> для загрузки процедуры в <code>mysqld</code> во время
выполнения.

</P>



<H3><A NAME="procedure_analyse" HREF="manual.ru_toc.html#procedure_analyse">9.3.1  Процедура Analyse</A></H3>

<P>
<code>analyse([max elements,[max memory]])</code> 

</P>
<P>
Эта процедура определена в <tt>`sql/sql_analyse.cc'</tt>. Она исследует результат
запроса и возвращает анализ результатов:

</P>

<UL>
<LI>

<code>max elements</code> (по умолчанию 256) - максимальное число различных значений,
которые analyse будет распознавать в столбце. Аргумент используется
<code>analyse</code> для проверки того, является ли тип <code>ENUM</code> оптимальным типом столбца.
<LI>

<code>max memory</code> (по умолчанию 8192) - максимальное количество памяти, которую
должна выделять <code>analyse</code> для столбца  в процессе поиска всех различных
значений.
</UL>


<PRE>
SELECT ... FROM ... WHERE ... PROCEDURE ANALYSE([max elements,[max memory]])
</PRE>



<H3><A NAME="Writing_a_procedure" HREF="manual.ru_toc.html#Writing_a_procedure">9.3.2  Написание  процедуры</A></H3>

<P>
На данный момент единственной документацией по этой теме является исходный
код.

</P>
<P>
Всю информацию о процедурах можно найти, изучив следующие файлы:

</P>

<UL>
<LI><tt>`sql/sql_analyse.cc'</tt>

<LI><tt>`sql/procedure.h'</tt>

<LI><tt>`sql/procedure.cc'</tt>

<LI><tt>`sql/sql_select.cc'</tt>

</UL>



<H1><A NAME="Problems" HREF="manual.ru_toc.html#Problems">A  Проблемы и распространенные ошибки</A></H1>

<P>
<A NAME="IDX1720"></A>
<A NAME="IDX1721"></A>

</P>
<P>
В этой главе перечислены некоторые распространенные проблемы и сообщения
об ошибках, с которыми приходится сталкиваться пользователям. Вы научитесь
выяснять, в чем заключается проблема и что следует сделать для ее решения.
Кроме того, здесь даны правильные решения некоторых распространенных
проблем.

</P>



<H2><A NAME="What_is_crashing" HREF="manual.ru_toc.html#What_is_crashing">A.1  Как определить, чем вызваны проблемы</A></H2>

<P>
При возникновении проблемы прежде всего следует обнаружить ее источник -
программу или элемент оборудования:

</P>

<UL>
<LI>

Если присутствует один из следующих симптомов, то проблема, скорее
всего, связана с аппаратным обеспечением (с памятью, материнской
платой, процессором или жестким диском) либо с ядром:


<UL>
<LI>

Не работает клавиатура. Обычно ее работоспособность можно проверить по
реакции на нажатие <code>Caps Lock</code>. Если индикатор <code>Caps Lock</code> не меняется, то
клавиатуру необходимо заменить (прежде чем это сделать, следует
попробовать перезагрузить компьютер и проверить все кабели к
клавиатуре).

<LI>

Не перемещается курсор мыши.

<LI>

Машина не отвечает на ping-запросы удаленной машины.

<LI>

Различные не связанные между собой программы не работают, как надо.

<LI>

Система неожиданно перезагрузилась (дефектная программа
пользовательского уровня <strong>никогда</strong> не должна быть способна вызвать отказ
системы).
</UL>

В этом случае необходимо начать с проверки всех кабелей и запуска
диагностических средств для проверки аппаратуры! Следует также проверить,
нет ли патчей, обновлений, сервисных пакетов (<code>service pack</code>) для
используемой операционной системы, при помощи которых вы, возможно, могли
бы решить проблемы. Кроме того, следует удостовериться, что у вас
установлены достаточно свежие версии библиотек (таких как <code>glibc</code>). 

Для
раннего обнаружения проблем хорошо использовать машину с ECC-памятью!

<LI>

В случае блокировки клавиатуры положение можно исправить, если войти
на свою машину с другой машины и выполнить на своей машине <code>kbd_mode</code>
-a.

<LI>

Исследуйте свой системный журнальный файл (<tt>`/var/log/messages'</tt> или т.п.)
на предмет причин возникающих проблем. Если есть основания полагать,
что проблема - в MySQL, то следует также изучить журнальные файлы
MySQL (see section <A HREF="manual.ru.html#Update_log">4.9.3  Журнал обновлений (update)</A>).

<LI>

Если вы считаете, что аппаратные проблемы отсутствуют, следует
попробовать обнаружить вызывающую проблемы программу. Попробуйте с
помощью <code>top</code>, <code>ps</code>, <code>taskmanager</code> или подобной программы проверить, какая
программа забирает все ресурсы процессора или блокирует машину.

<LI>

Проверьте с помощью <code>top</code>, <code>df</code> или подобной программы, нет ли нехватки
памяти, дискового пространства, дескрипторов для открытия файлов или
каких-либо других критических ресурсов.

<LI>

Если проблема связана с бесконтрольным процессом, то всегда можно
попробовать уничтожить его. Если он не хочет уничтожаться, то,
вероятно, существует ошибка в операционной системе.
</UL>

<P>
Если после изучения всех возможных причин вы сделали вывод, что источником
проблемы является именно MySQL-сервер или клиент, то следует сделать отчет
об ошибке для нашего списка рассылки или команды поддержки. В отчете об
ошибке постарайтесь дать очень подробное описание поведения системы и свое
мнение по поводу происходящего. Следует также объяснить, почему вы
считаете, что проблемы вызывает именно MySQL. Примите во внимание все
ситуации, описанные в данном разделе. Опишите все проблемы в точности так,
как они наблюдаются при исследовании системы. При помещении в отчет для
всего вывода программ и/или их сообщений об ошибках и/или подобной
информации из журнальных файлов  используйте метод "вырезать и
вставить"!

</P>
<P>
Просьба детально описать, какая именно программа не работает, и какие
симптомы вы наблюдали! Нам доводилось получать много отчетов об ошибках,
где просто утверждалось, что "система не работает", - такие отчеты не
давали  никакой информации о характере возможной проблемы.

</P>
<P>
Если программа сбоит, то всегда полезно выяснить:

</P>

<UL>
<LI>

Не вызвала ли данная программа ошибки сегментации (<code>core dump</code>)?

<LI>

Не забирает ли программа все ресурсы процессора? Проверьте с помощью
<code>top</code>. Дайте программе немного поработать - возможно, она занимается
сложными вычислениями.

<LI>

Если проблемы вызваны именно сервером <code>mysqld</code>, то можно ли выполнить
<code>mysqladmin -u root ping</code> или <code>mysqladmin -u root processlist</code>?

<LI>

Что сообщает клиентская программа (попробуйте  поработать, например, с
<code>mysql</code>) при попытке соединиться с MySQL? Происходит ли заклинивание
клиента? Выдает ли программа какой-нибудь вывод?
</UL>

<P>
При посылке отчета об ошибке необходимо придерживаться схемы, описанной в
этом руководстве (see section <A HREF="manual.ru.html#Asking_questions">1.8.1.2  Как задавать вопросы и направлять сообщения об ошибках</A>).

</P>


<H2><A NAME="Common_errors" HREF="manual.ru_toc.html#Common_errors">A.2  Распространенные ошибки при использовании MySQL</A></H2>

<P>
<A NAME="IDX1722"></A>

</P>
<P>
В этом разделе перечислены некоторые ошибки, с которыми часто приходится
сталкиваться пользователям; дается описание этих ошибок и способы их
исправления.

</P>


<H3><A NAME="Error_Access_denied" HREF="manual.ru_toc.html#Error_Access_denied">A.2.1  Ошибка <code>Access denied</code></A></H3>

<P>
<A NAME="IDX1723"></A>
<A NAME="IDX1724"></A>
<A NAME="IDX1725"></A>

</P>
<P>
See section <A HREF="manual.ru.html#Access_denied">4.2.11  Причины появления ошибок <code>Access denied</code> ("в доступе отказано")</A>.
See section <A HREF="manual.ru.html#Privileges">4.2.6  Как работает система привилегий</A>.

</P>


<H3><A NAME="Gone_away" HREF="manual.ru_toc.html#Gone_away">A.2.2  Ошибка <code>MySQL server has gone away</code></A></H3>

<P>
Все изложенное в данном разделе относится также и к родственной ошибке
<code>Lost connection to server during query</code>.

</P>
<P>
Наиболее часто ошибка MySQL  server  has  gone  away возникает в
результате тайм-аута соединения и его закрытия сервером. По умолчанию
сервер закрывает соединение по прошествии 8 часов бездействия. Можно
изменить лимит времени, установив при запуске <code><code>mysqld</code></code>  переменную
<code>wait_timeout</code>.

</P>
<P>
Другой распространенной причиной получения ошибки MySQL  server  has  gone
away является выдача команды "закрытия" на соединении MySQL с последующей
попыткой выполнить запрос на закрытом соединении.

</P>
<P>
Если это получено в скрипте, то достаточно просто повторить запрос от
клиента, чтобы соединение автоматически восстановилось.

</P>
<P>
Обычно в этом случае выдаются следующие коды ошибки (какой из них вы
получите, зависит от ОС):

</P>
<TABLE BORDER>
<TR><TD><strong>Код ошибки</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD>
<code>CR_SERVER_GONE_ERROR</code> </TD><TD> Клиент не может послать запрос серверу.
</TD></TR>
<TR><TD>
<code>CR_SERVER_LOST</code> </TD><TD> Клиент не получил ошибки при передаче запроса серверу, но
он не получил также полного ответа (или хоть какого-то ответа) на запрос.
</TD></TR>
</TABLE>

<P>
Ошибка будет также выдана, если кто-нибудь уничтожит выполняющийся поток
посредством <code>kill номерпотока</code>.

</P>
<P>
Проверить, что MySQL на ходу, можно, запустив <code>mysqladmin version</code> и изучив
время работы (<code>uptime</code>). Если проблема в аварийном завершении <code><code>mysqld</code></code>, то
необходимо сосредоточиться на поиске причины аварии. В этом случае следует
сначала проверить, не будет ли уничтожен MySQL снова при повторном задании
запроса (see section <A HREF="manual.ru.html#Crashing">A.4.1  Что делать, если работа MySQL сопровождается постоянными сбоями</A>).

</P>
<P>
Эти ошибки будут также выдаваться при посылке серверу неверного или
слишком длинного запроса. Если <code><code>mysqld</code></code> получает неправильный или слишком
большой пакет, то сервер предполагает, что с клиентом что-то не так, и
закрывает соединение. Если необходимо выполнять объемные запросы
(например, при работе с большими столбцами типа <code>BLOB</code>), можно увеличить
предельный размер запроса, запустив <code><code>mysqld</code></code> с опцией <code>-O</code> 
<code>max_allowed_packet=#</code> (по умолчанию 1 Mб). Дополнительная память выделяется
по требованию, так что <code><code>mysqld</code></code> будет выделять больше памяти только в
случае, когда выдан большой запрос или когда <code><code>mysqld</code></code> должен возвратить
большую строку результата!

</P>
<P>
Вы также можете получить разрыв соединения, если вы отправили пакет больше
16Мб, если ваш клиент старше чем 4.0.8, а ваш сервер 4.0.8 или новее.

</P>
<P>
Если у вас возникнет желание сделать отчет об ошибке по этой проблеме, то
не забудьте включить в него следующие сведения:

</P>

<UL>
<LI>

Информацию о том, упал MySQL или нет (это можно определить по файлу
<code>hostname.err</code> (see section <A HREF="manual.ru.html#Crashing">A.4.1  Что делать, если работа MySQL сопровождается постоянными сбоями</A>).

<LI>

Если определенный запрос уничтожает <code>mysqld</code>, а используемые в нем
таблицы перед выполнением запроса проверялись с помощью <code>CHECK TABLE</code>,
то желательно составить контрольный тест (see section <A HREF="manual.ru.html#Reproduceable_test_case">D.1.6  Создание контрольного примера при повреждении таблиц</A>).

<LI>

Значение переменной <code>wait_timeout</code> в сервере (это значение выдает
<code>mysqladmin variables</code>).

<LI>

Информацию о том, пробовали ли вы запускать <code>mysqld</code> с <code>--log</code> и
проверять, появляется ли выданный запрос в журнале.
</UL>

<P>
Обращайтесь к разделу See section <A HREF="manual.ru.html#Asking_questions">1.8.1.2  Как задавать вопросы и направлять сообщения об ошибках</A>.

</P>


<H3><A NAME="Can_not_connect_to_server" HREF="manual.ru_toc.html#Can_not_connect_to_server">A.2.3  Ошибка <code>Can't connect to [local] MySQL server</code></A></H3>

<P>
Клиент MySQL на Unix может соединиться с сервером <code>mysqld</code> двумя различными
способами: используя либо Unix-сокеты, когда соединение происходит через
файл в файловой системе (по умолчанию <tt>`/tmp/mysqld.sock'</tt>), либо TCP/IP с
соединением через номер порта. Unix-сокеты обеспечивают большую скорость,
чем TCP/IP, но могут применяться только при соединении с сервером на том
же компьютере. Unix-сокеты используются, если не задано имя хоста или если
задано специальное имя <code>localhost</code>.

</P>
<P>
В Windows, если сервер <code>mysqld</code> выполняется в 9x/Me, возможно соединение
только через TCP/IP. Если сервер работает на NT/2000/XP и <code>mysqld</code> запущен с
<code>--enable-named-pipe</code>, то можно также устанавливать соединение с помощью
именованных каналов. Имя именованного канала - MySQL. Если имя хоста не
указано при соединении с <code>mysqld</code>, то клиент MySQL сначала попробует
подключиться к именованному каналу, а если этого сделать не удастся, то к
порту TCP/IP. Можно предписать использование именованных каналов в
Windows, используя <code>.</code> в качестве имени хоста.

</P>
<P>
Ошибка <code>(2002) Can't connect to ...</code> обычно говорит о том, что MySQL не
запущен на данной системе или что при попытке соединиться с сервером
<code>mysqld</code> используется неверный сокет-файл или порт TCP/IP.

</P>
<P>
Для начала проверьте (с помощью <code>ps</code> или <code>диспетчера задач</code> в Windows),
выполняется ли на сервере процесс с именем <code>mysqld</code>! Если процесса <code>mysqld</code>
нет, то его необходимо запустить (see section <A HREF="manual.ru.html#Starting_server">2.4.2  Проблемы при запуске сервера MySQL</A>).

</P>
<P>
Если процесс <code>mysqld</code> выполняется, то можно проверить сервер, пробуя
использовать следующие различные соединения (конечно, номер порта и путь
сокета для вашей конфигурации могут быть другими):

</P>

<PRE>
shell&#62; mysqladmin version
shell&#62; mysqladmin variables
shell&#62; mysqladmin -h `hostname` version variables
shell&#62; mysqladmin -h `hostname` --port=3306 version
shell&#62; mysqladmin -h 'ip for your host' version
shell&#62; mysqladmin --protocol=socket --socket=/tmp/mysql.sock version
</PRE>

<P>
Обратите внимание на то, что для <code>hostname</code> используются обратные кавычки
вместо прямых; это задает подстановку вывода <code>hostname</code> (т.е. текущего имени
хоста) в команду <code>mysqladmin</code>.

</P>
<P>
Ниже приводится несколько причин, которые могут вызывать ошибку <code>Can't 
connect to local MySQL server</code>:

</P>

<UL>
<LI>

<code>mysqld</code> не выполняется.

<LI>

Сервер запущен на системе, использующей MIT-потоки. При работе на
системе, в которой отсутствуют "родные" потоки, <code>mysqld</code> использует пакет
<code>MIT-pthreads</code> (see section <A HREF="manual.ru.html#Which_OS">2.2.5  Операционные системы, поддерживаемые MySQL</A>). Однако не
во всех версиях MIT-потоков поддерживаются Unix-сокеты. В системе без
поддержки сокетов при соединении с сервером всегда необходимо явно
указывать имя хоста. Попробуйте проверить соединение с сервером с помощью
следующей команды:


<PRE>
shell&#62; mysqladmin -h `hostname` version
</PRE>

<LI>

Кто-либо удалил Unix-сокет, используемый <code>mysqld</code> (по умолчанию
<tt>`/tmp/mysqld.sock'</tt>). Возможно, есть задание <code>cron</code>, которое удаляет сокет
MySQL (например, задание, удаляющее старые файлы в каталоге <tt>`/tmp'</tt>). В таком
случае всегда можно выполнить <code>mysqladmin version</code> и проверить,
действительно ли существует сокет, который используется <code>mysqladmin</code>.
Решение здесь заключается в следующем: можно либо изменить задание cron с
тем, чтобы оно не удаляло <tt>`mysqld.sock'</tt>, либо поместить сокет в каком-нибудь
другом месте (see section <A HREF="manual.ru.html#Problems_with_mysql.sock">A.4.5  Как защитить или изменить сокет-файл MySQL <tt>`/tmp/mysql.sock'</tt></A>).

<LI>

Сервер <code>mysqld</code> запущен с опцией <code>--socket=/path/to/socket</code>. Если путь к
сокету для сервера был изменен, то необходимо уведомить о новом пути и
клиентов MySQL. Это можно сделать, передав клиенту путь к сокету в
качестве аргумента. see section <A HREF="manual.ru.html#Problems_with_mysql.sock">A.4.5  Как защитить или изменить сокет-файл MySQL <tt>`/tmp/mysql.sock'</tt></A>.

<LI>

Используется Linux, и один из потоков аварийно завершился (<code>core dump</code>). В
этом случае, перед тем как заново запустить MySQL, необходимо уничтожить
все остальные потоки <code>mysqld</code> (например, с помощью сценария <code>mysql_zap</code>).
Обращайтесь к разделу See section <A HREF="manual.ru.html#Crashing">A.4.1  Что делать, если работа MySQL сопровождается постоянными сбоями</A>.

<LI>

Возможно, пользователь, от которого запущен MySQL-сервер, не имеет
привилегий чтения и записи для каталога, содержащего сокет-файл, либо
для самого сокет-файла. В этом случае необходимо либо изменить
привилегии для каталога/файла, либо перезапустить <code>mysqld</code>, так чтобы
сервер использовал каталог, к которому пользователь имеет доступ.
</UL>

<P>
Если получено сообщение об ошибке <code>Can't connect to MySQL server on 
some_hostname</code>, то чтобы выяснить, в чем проблема, можно попробовать
выполнить следующие действия:

</P>

<UL>
<LI>

Проверить, запущен ли сервер, выполнив <code>telnet your-host-name 
tcp-ip-port-number</code>, и несколько раз нажать Enter. Если MySQL работает на
этом порту, то должен быть получен ответ, включающий номер версии
запущенного сервера. Если будет выдана ошибка вроде <code>telnet: Unable to 
connect to remote host: Connection refused</code>, то на указанном порту
сервер не работает.

<LI>

Попробуйте соединиться с демоном <code>mysqld</code> на локальной машине и проверьте
с помощью <code>mysqladmin variables</code>, какой порт TCP/IP сконфигурирован для
использования <code>mysqld</code> (переменная port).

<LI>

Проверьте, не запускается ли сервер <code>mysqld</code> с опцией <code>--skip-networking</code>.
</UL>



<H3><A NAME="Blocked_host" HREF="manual.ru_toc.html#Blocked_host">A.2.4  Ошибка <code>Host '...' is blocked</code></A></H3>

<P>
Ошибка, подобная следующей:

</P>

<PRE>
Host 'hostname' is blocked because of many connection errors.
Unblock with 'mysqladmin flush-hosts'
</PRE>

<P>
говорит о том, что от хоста <code>hostname</code> имело место большое количество
(<code>max_connect_errors</code>) прерванных посредине запросов на соединение к <code>mysqld</code>.
После <code>max_connect_errors</code> неудачных запросов <code>mysqld</code> делает предположение,
что что-то не так (может, атака от кракера), и блокирует последующие
соединения с узла до того момента, пока кто-нибудь не выполнит команду
<code>mysqladmin flush-hosts</code>.

</P>
<P>
По умолчанию <code>mysqld</code> блокирует хост после 10 ошибок соединения. Это
значение можно легко отрегулировать, запустив сервер следующим образом:

</P>

<PRE>
shell&#62; safe_mysqld -O max_connect_errors=10000 &#38;
</PRE>

<P>
Заметим, что если для некоторого хоста получено это сообщение об ошибке,
то следует сначала проверить, все ли в порядке с TCP/IP-соединениями от
этого хоста. Если TCP/IP-соединения не работают, то увеличивать значение
переменной <code>max_connect_errors</code> бесполезно!

</P>


<H3><A NAME="Too_many_connections" HREF="manual.ru_toc.html#Too_many_connections">A.2.5  Ошибка <code>Too many connections</code></A></H3>

<P>
Получение ошибки <code>Too many connections</code> при попытке соединиться с MySQL
означает, что уже есть <code>max_connections</code> клиентов, соединившихся с сервером
<code>mysqld</code>.

</P>
<P>
Если есть потребность в большем количестве соединений, чем задано по
умолчанию (100), то следует перезапустить <code>mysqld</code> с заданием большего
значения для переменной max_connections.

</P>
<P>
Заметим, что фактически <code>mysqld</code> разрешает соединяться (<code>max_connections</code>+1)
клиентам. Последнее соединение зарезервировано для пользователя с
привилегией <code>SUPER</code>. Если не наделять этой привилегией обычных пользователей
(они могут обойтись и без нее), то администратор, располагая этой
привилегией, может войти и использовать <code>SHOW PROCESSLIST</code> для выяснения
причин неполадок (see section <A HREF="manual.ru.html#SHOW_PROCESSLIST">4.5.6.6  <code>SHOW PROCESSLIST</code></A>).

</P>
<P>
Максимальное число соединений MySQL зависит от того, насколько хорошей
является библиотека потоков на данной платформе. Linux или Solaris должны
быть в состоянии поддерживать 500-1000 одновременных соединений, в
зависимости от количества имеющейся памяти и того, чем занимаются клиенты.

</P>


<H3><A NAME="Non-transactional_tables" HREF="manual.ru_toc.html#Non-transactional_tables">A.2.6  Ошибка <code>Some non-transactional changed tables couldn't be rolled back</code></A></H3>

<P>
<A NAME="IDX1726"></A>

</P>
<P>
Получение ошибки/предупреждения: <code>Warning: Some non-transactional changed
tables couldn't be rolled back</code> при попытке сделать <code>ROLLBACK</code> означает,
что для некоторых использованных в транзакции таблиц не поддерживаются
транзакции. Команда <code>ROLLBACK</code> на эти нетранзакционные таблицы не
подействует.

</P>
<P>
Наиболее типичный случай возникновения такой ошибки связан с попыткой
создать таблицу, тип которой не поддерживается бинарником <code>mysqld</code>. Если
<code>mysqld</code> не поддерживает тип таблиц (или тип таблиц отключен опцией при
запуске), то сервер создаст таблицу с типом, наиболее близким к
запрошенному (скорее всего, <code>MyISAM</code>).

</P>
<P>
Чтобы проверить тип таблицы, следует выполнить:

</P>
<P>
<code>SHOW TABLE STATUS LIKE 'table_name'</code>. See section <A HREF="manual.ru.html#SHOW_TABLE_STATUS">4.5.6.2  <code>SHOW TABLE STATUS</code></A>.

</P>
<P>
Можно проверить, какие расширения поддерживает исполняемый файл <code>mysqld</code>,
выполнив:

</P>
<P>
<code>show variables like 'have_%'</code>. See section <A HREF="manual.ru.html#SHOW_VARIABLES">4.5.6.4  <code>SHOW VARIABLES</code></A>.

</P>


<H3><A NAME="Out_of_memory" HREF="manual.ru_toc.html#Out_of_memory">A.2.7  Ошибка <code>Out of memory</code></A></H3>

<P>
По выданному запросу может быть получена ошибка следующего вида:

</P>
<P>
<code>mysql: Out of memory at line 42, 'malloc.c'</code>

</P>
<P>
<code>mysql: needed 8136 byte (8k), memory in use: 12481367 bytes (12189k)</code>

</P>
<P>
<code>ERROR 2008: MySQL client ran out of memory</code>

</P>
<P>
Как видим, в ней есть ссылка на MySQL-клиент <code>mysql</code>. Причина этой ошибки в
том, что клиенту просто не хватает памяти для размещения всего результата.

</P>
<P>
Чтобы устранить данную проблему, сначала проверьте правильность запроса.
Действительно ли есть необходимость в том, чтобы запрос возвращал так
много строк? Если да, то можно использовать <code>mysql --quick</code>, где для
извлечения результирующего множества применяется <code>mysql_use_result()</code>. При
этом уменьшается загрузка клиента (но увеличивается загрузка сервера).

</P>


<H3><A NAME="Packet_too_large" HREF="manual.ru_toc.html#Packet_too_large">A.2.8  Ошибка <code>Packet too large</code></A></H3>

<P>
Когда клиент MySQL или сервер <code>mysqld</code> получают пакет с размерами,
превышающими <code>max_allowed_packet</code> байтов, программа выдает ошибку <code>Packet 
too large</code> и закрывает соединение.

</P>
<P>
В MySQL 3.23 размер самого большого возможного пакета составляет 16 Mб
(из-за ограничений клиент-серверного протокола). В MySQL 4.0.1 и выше
размер пакета ограничивается только количеством имеющейся на сервере
памяти (вплоть до теоретического максимума в 2 Гб).

</P>
<P>
Коммуникационный пакет - это одна команда SQL, посылаемая серверу, или
одна строка, посылаемая клиенту.

</P>
<P>
Когда клиент MySQL или сервер <code>mysqld</code> получают пакет, размеры которого
превышают <code>max_allowed_packet</code> байтов, программа выдает ошибку <code>Packet too 
large</code> и закрывает соединение. Если коммуникационный пакет слишком велик,
то в некоторых клиентах может быть выдана ошибка <code>Lost connection to 
MySQL server during query</code>.

</P>
<P>
Отметим, что и клиент, и сервер имеют свои собственные переменные
<code>max_allowed_packet</code>. Если требуется обрабатывать большие пакеты, то эту
переменную необходимо увеличить как для клиента, так и для сервера.

</P>
<P>
Увеличение переменной не опасно, поскольку память выделяется только при
необходимости; эта переменная скорее является мерой предосторожности для
"отлавливания" неправильных пакетов между клиентом и сервером, а также
для того, чтобы предупредить ситуацию нехватки памяти, вследствие
случайного использования больших пакетов.

</P>
<P>
Если используется клиент <code>mysql</code>, то можно задать больший буфер, запустив
клиент посредством <code>mysql --set-variable=max_allowed_packet=8M</code>. Для других
клиентов существуют собственные методы установки этой переменной.
Обратите внимание, что начиная с 4.0 использование <code>--set-variable</code> не
рекомендуется, используйте просто <code>--max-allowed-packet=8M</code>.

</P>
<P>
Для установки <code>max_allowed_packet</code> большего размера в <code>mysqld</code> можно также
использовать файл опций. Например, если в таблице предполагается хранить
значение типа <code>MEDIUMBLOB</code> максимальной длины, то нужно запускать сервер с
опцией <code>set-variable=max_allowed_packet=16M</code>.

</P>
<P>
При использовании больших пакетов могут также возникать непредсказуемые
проблемы, если вы работаете с большими значениями типа <code>BLOB</code>, и <code>mysqld</code> не
был предоставлен доступ к достаточному объему памяти для обработки
запроса. Если есть подозрение, что дело в этом, попробуйте добавить <code>ulimit
-d 256000</code> в начале скрипта <code>safe_mysqld</code> и перезапустить <code>mysqld</code>.

</P>


<H3><A NAME="Communication_errors" HREF="manual.ru_toc.html#Communication_errors">A.2.9  Коммуникационные ошибки / Оборванные соединения</A></H3>

<P>
<A NAME="IDX1727"></A>
<A NAME="IDX1728"></A>
<A NAME="IDX1729"></A>

</P>
<P>
Начиная с MySQL 3.23.40 ошибка <code>Aborted connection</code> выдается только в
случае, если <code>mysqld</code> запущен с <code>--warnings</code>.

</P>
<P>
В журнале ошибок могут присутствовать ошибки наподобие этой:

</P>
<P>
<code>010301 14:38:23 Aborted connection 854 to db: 'users' user: 'josh'</code>

</P>
<P>
(see section <A HREF="manual.ru.html#Error_log">4.9.1  Журнал ошибок</A>).

</P>
<P>
Такие ошибки сигнализируют об одной из следующих ситуаций:

</P>

<UL>
<LI>

Клиентская программа не выполнила <code>mysql_close()</code> перед выходом.

<LI>

Клиент бездействовал на протяжении более чем <code>wait_timeout</code> или
<code>interactive_timeout</code> (see section <A HREF="manual.ru.html#SHOW_VARIABLES">4.5.6.4  <code>SHOW VARIABLES</code></A>).

<LI>

Клиентская программа внезапно завершилась посреди передачи.
</UL>

<P>
В подобных ситуациях увеличивается значение переменной сервера
<code>Aborted_clients</code>.

</P>
<P>
Значение переменной сервера <code>Aborted_connects</code> увеличивается в следующих
случаях:

</P>

<UL>
<LI>

Когда пакет соединения содержит неверную информацию.

<LI>

Когда пользователь не имеет привилегий для соединения с базой данных.

<LI>

Когда пользователь использует неверный пароль.

<LI>

Когда на получение пакета соединения уходит более <code>connect_timeout</code>
секунд. See section <A HREF="manual.ru.html#SHOW_VARIABLES">4.5.6.4  <code>SHOW VARIABLES</code></A>.
</UL>

<P>
Обратите внимание: все перечисленное выше может свидетельствовать о
попытке взлома базы данных!

</P>
<P>
Ниже перечислены другие причины проблем, которые могут возникнуть с
оборванными клиентами или разорванными соединениями.

</P>

<UL>
<LI>

Использование как полудуплексного, так и полного дуплексного
Ethernet-протокола под Linux. Данная ошибка присутствует во многих
Linux-драйверах Ethernet. Выполните тест на данную ошибку - для этого
следует передать очень большой файл через ftp-соединение между этими двумя
машинами. Если передача проходит в режиме всплеск-пауза-всплеск-пауза ...,
то можно констатировать наличие дуплексного синдрома Linux. Единственное
решение проблемы - отключить как полу-, так и полнодуплексную передачу на
концентраторах и коммутаторах.

<LI>

Некоторая проблема с библиотекой потоков, вызывающая прерывания при
чтении.

<LI>

"Криво" сконфигурированный TCP/IP.

<LI>

Дефектные Ethernet-карты, концентраторы, коммутаторы или кабели... Такие
проблемы можно как следует диагностировать только путем замены
оборудования.

<LI>

<code>max_allowed_packet</code> слишком мала, или запросам требуется памяти больше,
чем было выделено для <code>mysqld</code> (see section <A HREF="manual.ru.html#Packet_too_large">A.2.8  Ошибка <code>Packet too large</code></A>).
</UL>



<H3><A NAME="Full_table" HREF="manual.ru_toc.html#Full_table">A.2.10  Ошибка <code>The table is full</code></A></H3>

<P>
<A NAME="IDX1730"></A>

</P>
<P>
Существует несколько случаев, когда выдается эта ошибка:

</P>

<UL>
<LI>

Используется старая версия MySQL (до 3.23.0), а размещенная в памяти
временная таблица становится больше, чем <code>tmp_table_size</code> байтов. Для
решения этой проблемы можно использовать опцию <code>-O tmp_table_size=#</code>,
чтобы <code>mysqld</code> увеличил размер временных таблиц, или опцию SQL 
<code>SQL_BIG_TABLES</code>, перед тем как выдать сомнительный запрос (see section <A HREF="manual.ru.html#SET_OPTION">5.5.6  Синтаксис команды <code>SET</code></A>). 
Можно также запускать <code>mysqld</code> с опцией <code>--big-tables</code> -
эффект здесь будет таким же, как и от использования <code>SQL_BIG_TABLES</code> для
всех запросов. В версии MySQL 3.23 размещенные в памяти временные
таблицы после того, как размер таблицы превысит <code>tmp_table_size</code>,
автоматически преобразуются в расположенные на диске таблицы типа
<code>MyISAM</code>.

<LI>

Используются таблицы <code>InnoDB</code> и исчерпалось место в табличном
пространстве <code>InnoDB</code>. В таком случае следует увеличить табличное
пространство <code>InnoDB</code>.

<LI>

Используются таблицы <code>ISAM</code> или <code>MyISAM</code> в операционной системе, которая
поддерживает файлы размером до 2 Гб, и файл данных или индексный файл
достигли этого предела.

<LI>

Используются таблицы <code>MyISAM</code>, и размер требуемых данных или индекса
превышает тот, который предусматривался MySQL при выделении указателей
(если <code>MAX_ROWS</code> не указано в <code>CREATE TABLE</code>, MySQL выделяет указатели,
предусматривающие размещение только 4 Гб данных). Проверить
максимальные размеры данных/индекса можно посредством


<PRE>
SHOW TABLE STATUS FROM database LIKE 'table_name';
</PRE>

или с помощью <code>myisamchk -dv база_данных/таблица</code>. Если проблема связана с
указателями, то это можно исправить с помощью команды наподобие следующей:


<PRE>
ALTER TABLE table_name MAX_ROWS=1000000000 AVG_ROW_LENGTH=nnn;
</PRE>

Указывать <code>AVG_ROW_LENGTH</code> нужно только для таблиц с полями типа <code>BLOB/TEXT</code>,
поскольку в этом случае MySQL не может оптимизировать требуемое
пространство, исходя только из количества строк.
</UL>



<H3><A NAME="Cannot_create" HREF="manual.ru_toc.html#Cannot_create">A.2.11  Ошибка <code>Can't create/write to file</code></A></H3>

<P>
Получение для некоторых запросов ошибки вида:

</P>
<P>
<code>Can't create/write to file '\\sqla3fe_0.ism'</code>.

</P>
<P>
означает, что MySQL не может создать в заданном временном каталоге
временный файл для результирующего набора (приведенное сообщение об ошибке
типично для Windows, примерно такой же вид имеет сообщение об ошибке
Unix). Чтобы решить проблему, запустите <code>mysqld</code> с <code>--tmpdir=path</code> или
добавьте в своем файле опций:

</P>

<PRE>
[mysqld]
tmpdir=C:/temp
</PRE>

<P>
исходя из предположения, что каталог <tt>`c:\\temp'</tt> существует 
(see section <A HREF="manual.ru.html#Option_files">4.1.2  Файлы параметров <tt>`my.cnf'</tt></A>).

</P>
<P>
Проверьте также код полученной ошибки с помощью perror. Одной из причин
также может быть ошибка переполнения диска;

</P>

<PRE>
shell&#62; perror 28
Error code 28: No space left on device
</PRE>



<H3><A NAME="Commands_out_of_sync" HREF="manual.ru_toc.html#Commands_out_of_sync">A.2.12  Ошибка в клиенте <code>Commands out of sync</code></A></H3>

<P>
<A NAME="IDX1731"></A>

</P>
<P>
Если получена ошибка <code>Commands out of sync; you can't run this 
command now</code> в клиентском коде, то клиентские функции вызываются в
неправильном порядке!

</P>
<P>
Это может произойти, например, если используется <code>mysql_use_result()</code> и
делается попытка выполнить новый запрос до того, как вызвана
<code>mysql_free_result()</code>, или если клиент пытается выполнить два возвращающих
данные запроса без обращения к <code>mysql_use_result()</code> либо
<code>mysql_store_result()</code> в промежутке между ними.

</P>


<H3><A NAME="Ignoring_user" HREF="manual.ru_toc.html#Ignoring_user">A.2.13  Ошибка <code>Ignoring user</code></A></H3>

<P>
Получение следующей ошибки:

</P>
<P>
<code>Found wrong password for user: 'some_user@some_host'; ignoring user</code>

</P>
<P>
означает, что при запуске <code>mysqld</code> или при перезагрузке таблиц привилегий
сервер нашел в таблице <code>user</code> запись с неправильным паролем и в результате
запись просто игнорируется системой привилегий.

</P>
<P>
Причины проблемы и способы ее решения могут быть следующими:

</P>

<UL>
<LI>

Возможно, работает новая версия <code>mysqld</code> со старой таблицей user. Это
можно проверить путем выполнения <code>mysqlshow mysql user</code>, чтобы
посмотреть, короче ли поле пароля, чем 16 символов. Если это так, то
положение можно исправить, запустив сценарий
<tt>`scripts/add_long_password'</tt>.

<LI>

У пользователя старый пароль (длиной в 8 символов), а <code>mysqld</code> запущен
без опции <code>--old-protocol</code>. Обновите данные пользователя в таблице user,
задав новый пароль, или перезапустите <code>mysqld</code> с <code>--old-protocol</code>.

<LI>

Пароль был установлен в таблице user без применения функции
<code>PASSWORD()</code>. Воспользуйтесь <code>mysql</code> для обновления пароля пользователя в
таблице <code>user</code>. Позаботьтесь о том, чтобы была использована функция
<code>PASSWORD()</code>:


<PRE>
mysql&#62; UPDATE user SET password=PASSWORD('your password')
    -&#62;             WHERE user='XXX';
</PRE>

</UL>



<H3><A NAME="Cannot_find_table" HREF="manual.ru_toc.html#Cannot_find_table">A.2.14  Ошибка <code>Table 'xxx' doesn't exist</code></A></H3>

<P>
Получение ошибки <code>Table 'xxx' doesn't exist</code> или <code>Can't find file: 'xxx'
(errno: 2)</code>, означает, что в текущей базе данных не существует таблицы с
именем <code>xxx</code>.

</P>
<P>
Обратите внимание: поскольку в MySQL для хранения баз данных и таблиц
используются каталоги и файлы, то имена баз данных и каталогов <strong>являются</strong>
зависимыми от регистра символов! (Под Windows имена баз данных и таблиц не
зависят от регистра символов, но для всех ссылок на заданную таблицу в
пределах запроса должен использоваться одинаковый регистр!)

</P>
<P>
Проверить, какие таблицы имеются в текущей базе данных, можно с помощью
<code>SHOW TABLES</code>. see section <A HREF="manual.ru.html#SHOW">4.5.6  Синтаксис команды <code>SHOW</code></A>.

</P>


<H3><A NAME="Cannot_initialize_character_set" HREF="manual.ru_toc.html#Cannot_initialize_character_set">A.2.15  Ошибка <code>Can't initialize character set xxx</code></A></H3>

<P>
<A NAME="IDX1732"></A>

</P>
<P>
Получение ошибки наподобие:

</P>
<P>
<code>MySQL Connection Failed: Can't initialize character set xxx</code>

</P>
<P>
Означает, что имеется одна из следующих ситуаций:

</P>

<UL>
<LI>

Кодировка является многобайтовой и не поддерживается клиентом. В этом
случае необходимо перекомпилировать клиент с <code>--with-charset=xxx</code> или с
<code>--with-extra-charsets=xxx</code> (see section <A HREF="manual.ru.html#configure_options">2.3.3  Типичные опции <code>configure</code></A>).
Весь стандартный бинарный код MySQL откомпилирован с
<code>--with-extra-character-sets=complex</code>, что обеспечивает поддержку всех
многобайтовых кодировок (see section <A HREF="manual.ru.html#Character_sets">4.6.1  Набор символов, применяющийся для записи данных и сортировки</A>).

<LI>

Кодировка является простой кодировкой, не скомпилированной в <code>mysqld</code>, и
файлы определения кодировки находятся не там, где рассчитывает их
найти клиент. В этом случае необходимо:


<UL>
<LI>

Перекомпилировать клиент с поддержкой этой кодировки (see section <A HREF="manual.ru.html#configure_options">2.3.3  Типичные опции <code>configure</code></A>).

<LI>

Указать клиенту, где расположены файлы определения кодировки. Для многих
клиентов это можно сделать с помощью опции
<code>--character-sets-dir=path-to-charset-dir</code>.

<LI>

Скопировать файлы определения кодировки туда, где, по мнению клиента,
они должны находиться.
</UL>

</UL>



<H3><A NAME="Not_enough_file_handles" HREF="manual.ru_toc.html#Not_enough_file_handles">A.2.16  Не найден файл (<code>File not found</code>)</A></H3>

<P>
Получение от MySQL <code>ERROR '...' not found (errno: 23), Can't open file: ...
(errno: 24)</code>, или любой другой ошибки с номером 23 или 24 означает, что
для MySQL выделено недостаточно файловых дескрипторов. Можно использовать
утилиту perror для получения описания ошибки с определенным номером:

</P>

<PRE>
shell&#62; perror 23
File table overflow
shell&#62; perror 24
Too many open files
shell&#62; perror 11
Resource temporarily unavailable
</PRE>

<P>
Проблема здесь в том, что <code>mysqld</code> пытается одновременно держать открытыми
слишком много файлов. Можно либо указать <code>mysqld</code> не открывать так много
файлов одновременно, либо увеличить количество файловых дескрипторов,
доступных <code>mysqld</code>.

</P>
<P>
Чтобы предписать <code>mysqld</code> держать одновременно открытыми меньше файлов,
можно уменьшить табличный кэш, задав <code>safe_mysqld</code> опцию <code>-O table_cache=32</code>
(значение по умолчанию 64). Уменьшение значения <code>max_connections</code> также
уменьшит количество открытых файлов (по умолчанию значение переменной 90).

</P>
<P>
Чтобы изменить число доступных <code>mysqld</code> файловых дескрипторов, можно
использовать опцию <code>--open-files-limit=#</code> в <code>safe_mysqld</code> или опцию 
<code>-O open-files-limit=#</code> в <code>mysqld</code> (see section <A HREF="manual.ru.html#SHOW_VARIABLES">4.5.6.4  <code>SHOW VARIABLES</code></A>). Проще всего это
сделать путем добавления опции в файл опций (see section <A HREF="manual.ru.html#Option_files">4.1.2  Файлы параметров <tt>`my.cnf'</tt></A>).
Если используется ранняя версия <code>mysqld</code>, не поддерживающая эту
возможность, можно отредактировать скрипт <code>safe_mysqld</code>. В скрипте есть
закомментированная строка <code>ulimit -n 256</code>; можно, убрав символ <samp>`#'</samp>,
раскомментировать эту строку и, заменив значение 256 другим, повлиять на
количество доступных <code>mysqld</code> файловых дескрипторов.

</P>
<P>
При помощи <code>ulimit</code> (и <code>open-files-limit</code>) можно увеличить количество файловых
дескрипторов только до предела, установленного в операционной системе.
Существует также "жесткий" предел, который может быть переопределен
только при запуске <code>safe_mysqld</code> или <code>mysqld</code> от имени пользователя <code>root</code> (но
помните, что в этом случае также следует использовать опцию <code>--user=...</code>).
Если необходимо увеличить предел ОС по количеству доступных отдельному
процессу файловых дескрипторов, обращайтесь к документации по своей
операционной системе.

</P>
<P>
Обратите внимание: при использовании <code>tcsh ulimit</code> работать не будет! Кроме
того, <code>tcsh</code> будет сообщать неверные значения при запросе текущих пределов!
В этом случае необходимо запускать <code>safe_mysqld</code> с использованием <code>sh</code>!

</P>


<H2><A NAME="Installation_Issues" HREF="manual.ru_toc.html#Installation_Issues">A.3  Вопросы, связанные с инсталляцией</A></H2>



<H3><A NAME="Link_errors" HREF="manual.ru_toc.html#Link_errors">A.3.1  Проблемы при линковании с клиентской библиотекой MySQL</A></H3>

<P>
<A NAME="IDX1733"></A>
<A NAME="IDX1734"></A>
<A NAME="IDX1735"></A>

</P>
<P>
Если при линковании программы получены ошибки неразрешенных ссылок на
символы, имена которых начинаются с <code>mysql_</code>, подобные следующим:

</P>


<PRE>
/tmp/ccFKsdPa.o: In function `main':
/tmp/ccFKsdPa.o(.text+0xb): undefined reference to `mysql_init'
/tmp/ccFKsdPa.o(.text+0x31): undefined reference to `mysql_real_connect'
/tmp/ccFKsdPa.o(.text+0x57): undefined reference to `mysql_real_connect'
/tmp/ccFKsdPa.o(.text+0x69): undefined reference to `mysql_error'
/tmp/ccFKsdPa.o(.text+0x9a): undefined reference to `mysql_close'
</PRE>

<P>
то их можно устранить, добавив <code>-Lpath-to-the-mysql-library -lmysqlclient</code> 
<strong>в самом конце</strong> используемой команды линкования.

</P>
<P>
Если выдаются ошибки <code>undefined reference</code> для функции <code>uncompress</code> или
<code>compress</code>, добавьте <strong>в самом конце</strong> команды линкования <code>-lz</code> и повторите
попытку!

</P>
<P>
Если получены ошибки <code>undefined reference</code> для функций, которые должны
присутствовать в системе, таких как <code>connect</code>, то сверьтесь по странице
руководства для данной функции, какие библиотеки необходимо добавить в
команде линкования!

</P>
<P>
Получение ошибок <code>undefined reference</code> для функций, отсутствующих в
используемой системе, наподобие следующего:

</P>

<PRE>
mf_format.o(.text+0x201): undefined reference to `__lxstat'
</PRE>

<P>
обычно означает, что библиотека скомпилирована в системе, которая не на
100% совместима с системой пользователя. В этом случае необходимо
загрузить последнюю поставку с исходными текстами MySQL и откомпилировать
библиотеку самостоятельно (see section <A HREF="manual.ru.html#Installing_source">2.3  Установка исходного дистрибутива MySQL</A>).

</P>
<P>
Если при попытке выполнить программу выдаются ошибки о ненайденных
символах, начинающихся с <code>mysql_</code>, или о том, что не удается найти
библиотеку <code>mysqlclient</code>, то это означает, что система не может найти
динамической библиотеки <tt>`libmysqlclient.so'</tt>.

</P>
<P>
Чтобы исправить это, необходимо предписать системе проводить поиск
динамических библиотек в каталоге с клиентской библиотекой MySQL. Это
можно сделать одним из следующих способов:

</P>

<UL>
<LI>

Добавить в переменную окружения <code>LD_LIBRARY_PATH</code> путь к каталогу,
содержащему <tt>`libmysqlclient.so'</tt>.

<LI>

Добавить в переменную окружения <code>LD_LIBRARY</code> путь к каталогу, содержащему
<tt>`libmysqlclient.so'</tt>.

<LI>

Скопировать <tt>`libmysqlclient.so'</tt> в каталог, просматриваемый системой при
поиске библиотек, таких как <tt>`/lib'</tt>, и обновить информацию о распределенных
библиотеках, выполнив <code>ldconfig</code>.

</UL>

<P>
Другой способ решения этой проблемы заключается в статическом линковании
программы с использованием <code>-static</code>, или в удалении динамических библиотек
MySQL до линкования своего кода. Во втором случае необходимо
удостовериться, что динамические библиотеки не используются другими
программами!

</P>


<H3><A NAME="Changing_MySQL_user" HREF="manual.ru_toc.html#Changing_MySQL_user">A.3.2  Запуск MySQL от обычного пользователя</A></H3>

<P>
<A NAME="IDX1736"></A>
<A NAME="IDX1737"></A>

</P>
<P>
Сервер <code>mysqld</code> может запускаться и работать от любого пользователя. Чтобы
настроить <code>mysqld</code> для работы под Unix-пользователем <code>user_name</code>, необходимо
выполнить следующие действия:

</P>

<OL>
<LI>

Если сервер работает, остановите его (используйте <code>mysqladmin 
shutdown</code>).

<LI>

Измените каталоги и файлы баз данных так, чтобы <code>user_name</code> имел
привилегии для чтения и записи файлов в этих каталогах (возможно, это
нужно будет делать из Unix-аккаунта <code>root</code>):


<PRE>
shell&#62; chown -R user_name /path/to/mysql/datadir
</PRE>

Если среди каталогов или файлов в каталоге данных MySQL присутствуют
символические ссылки, то нужно будет также перейти по этим ссылкам и
изменить каталоги и файлы, на которые они указывают. <code>chown -R</code> может не
отработать символических ссылок.

<LI>

Запустите сервер из аккаунта <code>user_name</code> или, если у вас MySQL 3.22 и
выше, запустите <code>mysqld</code> из Unix-аккаунта <code>root</code> и используйте опцию
<code>--user=user_name</code>. <code>mysqld</code> переключится на выполнение в контексте
Unix-пользователя <code>user_name</code> до того, как начнет обслуживать запросы на
соединение.

<LI>

Чтобы запускать сервер от имени данного пользователя автоматически
в ходе загрузки системы, добавьте строку user, указывающую имя
пользователя, в группе <code>[mysqld]</code> файла опций <tt>`/etc/my.cnf'</tt> или файла
опций <tt>`my.cnf'</tt> из каталога данных сервера. Например:


<PRE>
[mysqld]
user=user_name
</PRE>

</OL>

<P>
К этому моменту процесс <code>mysqld</code> должен без помех работать под
Unix-пользователем <code>user_name</code>. Однако содержимое таблиц привилегий не
изменяется. По умолчанию (сразу после выполнения скрипта инсталляции
таблиц привилегий <code>mysql_install_db</code>) MySQL-пользователь <code>root</code> является
единственным пользователем с правами на доступ к базе данных <code>mysql</code>, а
также на создание и удаление баз данных. Если вы не меняли этих
полномочий, они по-прежнему действительны. То, что вы вошли в систему как
Unix-пользователь, отличный от <code>root</code>, не может вам помешать получить доступ
к MySQL в качестве MySQL-пользователя root; просто задайте клиентской
программе опцию <code>-u root</code>.

</P>
<P>
Отметим, что работа с MySQL в качестве MySQL-пользователя <code>root</code> посредством
указания <code>-u root</code> в командной строке <strong>не имеет ничего общего</strong> с выполнением
MySQL под Unix-пользователем <code>root</code>, или вообще под каким бы то ни было
Unix-пользователем. Привилегии доступа и имена пользователей MySQL никак
не связаны с именами Unix-пользователей. Единственная связь с именами
Unix-пользователей заключается в том, что если при запуске клиентской
программы не задана опция <code>-u</code>, то клиент попытается соединиться, используя
в качестве имени MySQL-пользователя имя Unix-аккаунта.

</P>
<P>
Если Unix-сервер не слишком хорошо защищен или не нуждается в повышенных
мерах безопасности, следует как минимум установить в таблицах привилегий
пароль для MySQL-<code>пользователя</code> root. В противном случае любой пользователь
с аккаунтом на данной машине сможет запустить <code>mysql -u root db_name</code> и
делать в MySQL все, что ему заблагорассудится.

</P>


<H3><A NAME="File_permissions" HREF="manual.ru_toc.html#File_permissions">A.3.3  Проблемы с правами доступа к файлам</A></H3>

<P>
<A NAME="IDX1738"></A>
<A NAME="IDX1739"></A>
<A NAME="IDX1740"></A>

</P>
<P>
Если существуют проблемы с правами доступа к файлам, например, если <code>mysql</code>
при создании таблицы выдает следующее сообщение об ошибке:

</P>
<P>
<code>ERROR: Can't find file: 'path/with/filename.frm' (Errcode: 13)</code>

</P>
<P>
<A NAME="IDX1741"></A>
<A NAME="IDX1742"></A>

</P>
<P>
то, возможно, при запуске сервера <code>mysqld</code> неправильно устанавливается
переменная окружения <code>UMASK</code>. По умолчанию значение  <code>umask 0660</code>. Его можно
изменить, запуская <code>safe_mysqld</code> следующим образом:

</P>

<PRE>
shell&#62; UMASK=384 # = 600 in octal
shell&#62; export UMASK
shell&#62; /path/to/safe_mysqld &#38;
</PRE>

<P>
<A NAME="IDX1743"></A>
<A NAME="IDX1744"></A>

</P>
<P>
По умолчанию MySQL создает каталоги баз данных и RAID-каталоги с правами
доступа <code>0700</code>. Такое поведение можно изменить, установив переменную
<code>UMASK_DIR</code>. Если установить эту переменную, то при создании новых каталогов
используется комбинация <code>UMASK</code> и <code>UMASK_DIR</code>. Например, если требуется, чтобы
доступ ко всем новым каталогам получала группа, то можно выполнить:

</P>

<PRE>
shell&#62; UMASK_DIR=504 # = 770 in octal
shell&#62; export UMASK_DIR
shell&#62; /path/to/safe_mysqld &#38;
</PRE>

<P>
В версии MySQL 3.23.25 и выше MySQL предполагает, что значения для <code>UMASK</code> и
<code>UMASK_DIR</code>, начинающиеся с нуля, восьмеричные.

</P>
<P>
see section <A HREF="manual.ru.html#Environment_variables">E  Переменные окружения</A>.

</P>


<H2><A NAME="Administration_Issues" HREF="manual.ru_toc.html#Administration_Issues">A.4  Вопросы, связанные с администрированием</A></H2>



<H3><A NAME="Crashing" HREF="manual.ru_toc.html#Crashing">A.4.1  Что делать, если работа MySQL сопровождается постоянными сбоями</A></H3>

<P>
<A NAME="IDX1745"></A>

</P>
<P>
Перед официальным выпуском все версии MySQL тестируются на многих
платформах. Это не означает, что в MySQL совсем нет ошибок, но если они и
есть, то мало, и их не так просто отыскать. В любом случае, столкнувшись с
какой-либо проблемой, всегда полезно попытаться точно определить, что
вызывает аварию системы, - тогда шансы, что проблема будет устранена в
скором времени, станут значительно выше.

</P>
<P>
Сначала надо попробовать локализовать проблему. Определите, что
происходит: то ли демон <code>mysqld</code> прекращает работу, то ли проблема связана с
клиентом. Узнать, сколько времени сервер <code>mysqld</code> уже работает, можно,
выполнив <code>mysqladmin version</code>. Если <code>mysqld</code> прекратил выполнение, то для
выяснения причин можно изучить файл  <tt>`mysql-data-directory/`hostname`.err'</tt>
(see section <A HREF="manual.ru.html#Error_log">4.9.1  Журнал ошибок</A>).

</P>
<P>
Причиной многих аварий MySQL являются поврежденные индексные файлы или
файлы данных. MySQL обновляет данные на диске, используя системный вызов
<code>write()</code>, после каждой команды SQL и до того, как клиент будет уведомлен о
результате (однако при выполнении с <code>delay_key_write</code> это не так: 
записываются только данные). Отсюда следует, что данные не пострадают даже
в случае аварийного завершения <code>mysqld</code>, поскольку ОС позаботится о том,
чтобы те данные, которые не сброшены, были записаны на диск. Можно
заставить MySQL сбрасывать все на диск после каждой SQL-команды, запустив
<code>mysqld</code> с <code>--flush</code>.

</P>
<P>
Все это означает, что обычно таблицы не должны повреждаться; исключение
составляют следующие случаи:

</P>

<UL>
<LI>

Кто-нибудь/что-нибудь убьет процесс <code>mysqld</code> или выключит машину посреди
операции обновления.

<LI>

Проявила себя ошибка в <code>mysqld</code>, вызывающая прекращение его выполнения
посреди операции обновления.

<LI>

Кто-нибудь работает с файлами данных или индексными файлами вне <code>mysqld</code> и
при этом не делает блокировку таблиц как следует.

<LI>

Если работает несколько серверов <code>mysqld</code> с одними данными на системе без
пристойной поддержки блокировок  файловой системы (обычно реализуется
демоном <code>lockd</code>) или если выполняется несколько серверов со <code>--skip-external-locking</code>

<LI>

Существует поврежденный индексный файл или файл данных, содержащий очень
неправильные данные, которые вводят в заблуждение <code>mysqld</code>.

<LI>

Проявила себя  в коде записи данных. Это маловероятно, но в общем случае
возможно. В этом случае можно попробовать изменить формат файла на
соответствующий другому обработчику баз данных, используя <code>ALTER TABLE</code> на
исправленной копии таблицы!
</UL>

<P>
Поскольку найти причину сбоя всегда непросто, сначала можно попробовать 
выяснить, что из того, что работает у других, вызывает аварии у вас.
Попытайтесь выполнить следующие действия:

</P>

<UL>
<LI>

Остановите демон <code>mysqld</code> с помощью <code>mysqladmin shutdown</code>, выполните
<code>myisamchk --silent --force */*.MYI</code> на всех таблицах и перезапустите
демон <code>mysqld</code>. Этим гарантируется безошибочность исходного состояния
(see section <A HREF="manual.ru.html#MySQL_Database_Administration">4  Администрирование баз данных</A>).

<LI>

Используйте <code>mysqld --log</code> и попытайтесь определить по информации в
журналах, не вызвано ли прекращение работы сервера каким-либо
специфическим запросом. Около 95% всех ошибок обусловлены конкретными
запросами! Обычно это один из последних запросов в журнальном файле
непосредственно до перезапуска MySQL (see section <A HREF="manual.ru.html#Query_log">4.9.2  Общий журнал запросов</A>). Если вы сумеете повторно вызвать  отказ MySQL при помощи одного
из запросов, даже когда таблицы были проверены непосредственно перед
выполнением запроса, то возможна локализация ошибки и подготовка
отчета об ошибке! see section <A HREF="manual.ru.html#Bug_reports">1.8.1.3  Как отправлять отчеты об ошибках или проблемах</A>.

<LI>

Попробуйте сделать контрольный тест, который мы могли бы использовать,
чтобы воспроизвести проблему (see section <A HREF="manual.ru.html#Reproduceable_test_case">D.1.6  Создание контрольного примера при повреждении таблиц</A>).

<LI>

Попробуйте выполнить входящий в поставку тест <code>mysql-test</code> и тесты
производительности MySQL (see section <A HREF="manual.ru.html#MySQL_test_suite">9.1.2  Пакет тестирования MySQL</A>). Эти тесты
должны довольно хорошо протестировать MySQL. Вы можете также добавить
в тесты производительности код для имитации своего приложения! Тесты
производительности можно найти в каталоге bench в поставке с исходными
кодами или, в случае бинарной поставки, в подкаталоге <code>sql-bench</code> своего
каталога инсталляции MySQL.

<LI>

Попробуйте <code>fork_test.pl</code> и <code>fork2_test.pl</code>.

<LI>

Если что-то пойдет не так, то собирать информацию о возможных ошибках
будет значительно проще, если MySQL сконфигурирован для отладки.
Переконфигурируйте MySQL, применяя <code>configure</code> с опцией <code>--with-debug</code> или
<code>--with-debug=full</code>, и затем перекомпилируйте (see section <A HREF="manual.ru.html#Debugging_server">D.1  Отладка сервера MySQL</A>).

<LI>

Конфигурирование MySQL в отладочном режиме приводит к включению
безопасного распределителя памяти, который может находить некоторые
ошибки. Помимо этого, отладочная версия выдает большое количество
информации о том, что происходит.

<LI>

Выясните, применены ли последние патчи для используемой операционной
системы.

<LI>

Используйте опцию <code>--skip-external-locking</code> к <code>mysqld</code>. На некоторых системах
менеджер блокировок <code>lockd</code> не работает как следует; опция
<code>--skip-external-locking</code> указывает <code>mysqld</code> не применять внешнюю блокировку (это
означает, что нельзя выполнять два сервера <code>mysqld</code> на одних данных и
что необходимо быть осторожным при использовании <code>myisamchk</code>, однако
применение этой опции может принести большую пользу для целей
тестирования).

<LI>

Если возникнет ситуация, когда кажется, что <code>mysqld</code> запущен, но не
отвечает, стоит попробовать выполнить <code>mysqladmin -u root processlist</code>.
Иногда <code>mysqld</code> не является зависшим, даже если кажется, что это так.
Проблема может быть в том, что все соединения используются, или,
возможно, имеется некая внутренняя проблема с блокировками. <code>mysqladmin
processlist</code> обычно способна установить соединение даже в таких случаях
и выдать полезную информацию о текущем количестве соединений и их
состоянии.

<LI>

Выполните команду в отдельном окне <code>mysqladmin -i 5 status</code> или
<code>mysqladmin -i 5 -r</code> для вывода статистики, пока будут выполняться
другие запросы.

<LI>

Попробуйте выполнить следующие действия:


<OL>
<LI>

Запустите <code>mysqld</code> в <code>gdb</code> (или в другом отладчике).
See section <A HREF="manual.ru.html#Using_gdb_on_mysqld">D.1.3  Отладка mysqld при помощи gdb</A>.

<LI>

Запустите тестовые скрипты.

<LI>

Отобразите стек (<code>backtrace</code>) и локальные переменные на трех нижних
уровнях. В <code>gdb</code> это можно сделать следующими командами после аварийного
завершения <code>mysqld</code> внутри <code>gdb</code>:


<PRE>
backtrace
info local
up
info local
up
info local
</PRE>

С помощью <code>gdb</code> можно также выяснить, какие имеются потоки (посредством <code>info
threads</code>), и переключиться на определенный поток посредством <code>thread #</code>, где
<code>#</code> - номер потока.
</OL>

<LI>

Попробуйте имитировать работу своего приложения с помощью
Perl-скрипта, который бы вызвал аварийное завершение или неправильное
функционирование MySQL.

<LI>

Отправьте нам обычный отчет об ошибке (see section <A HREF="manual.ru.html#Bug_reports">1.8.1.3  Как отправлять отчеты об ошибках или проблемах</A>). Любые подробности будут нелишними. Поскольку MySQL
нормально эксплуатируется в очень многих местах, то, возможно, авария
вызвана причиной, которая свойственна только вашему компьютеру
(например, ошибка, связанная с вашими особенными системными
библиотеками).

<LI>

Если возникла проблема с таблицами, имеющими динамическую длину строк,
и не используются столбцы типа <code>BLOB/TEXT</code> (а только столбцы типа
<code>VARCHAR</code>), то можно попробовать изменить все <code>VARCHAR</code> на <code>CHAR</code> с помощью
<code>ALTER TABLE</code>. Это заставит MySQL использовать строки фиксированного
размера. Для строк фиксированного размера понадобится немного
дополнительной памяти, однако они гораздо менее чувствительны к
повреждениям! Сегодняшний код динамических строк без  каких бы то ни
было проблем эксплуатируется в MySQL AB по крайней мере 3 года, но в
принципе строки динамической длины более подвержены ошибкам, поэтому
данный рецепт, возможно, сможет вам чем-то помочь!
</UL>



<H3><A NAME="Resetting_permissions" HREF="manual.ru_toc.html#Resetting_permissions">A.4.2  Как переустановить забытый пароль пользователя <code>root</code></A></H3>

<P>
<A NAME="IDX1746"></A>
<A NAME="IDX1747"></A>
<A NAME="IDX1748"></A>

</P>
<P>
Если для MySQL пароль пользователя <code>root</code> никогда не устанавливался, то для
соединения с сервером в качестве пользователя <code>root</code> пароль не потребуется.
Рекомендуется всегда устанавливать пароль для каждого пользователя 
(see section <A HREF="manual.ru.html#Security">4.2.2  Как обезопасить MySQL от хакеров</A>).

</P>
<P>
Если вы забыли установленный для <code>root</code> пароль, то новый пароль можно задать
при помощи следующей процедуры:

</P>

<OL>
<LI>

Остановите сервер <code>mysqld</code>; для этого нужно послать <code>kill</code> (но не <code>kill -9</code>)
серверу <code>mysqld</code>. Номер процесса хранится в файле <tt>`.pid'</tt>, обычно расположенном в каталоге
баз данных MySQL:


<PRE>
shell&#62; kill `cat /mysql-data-directory/hostname.pid`
</PRE>

Чтобы выполнить  эту команду, необходимо быть либо Unix-пользователем
<code>root</code>, либо пользователем, под которым работает <code>mysqld</code>.

<LI>

Перезапустите <code>mysqld</code> с опцией <code>--skip-grant-tables</code>.

<LI>

Установите новый пароль с помощью команды <code>mysqladmin password</code>:


<PRE>
shell&#62; mysqladmin -u root password 'mynewpassword'
</PRE>

<LI>

Теперь можно либо просто остановить <code>mysqld</code> и заново запустить его
обычным способом, либо просто загрузить таблицы привилегий посредством:


<PRE>
shell&#62; mysqladmin -h hostname flush-privileges
</PRE>

<LI>

После этого можно будет соединяться, пользуясь новым паролем.
</OL>

<P>
Есть и другой способ установки нового пароля - с помощью клиента <code>mysql</code>:

</P>

<OL>
Остановите <code>mysqld</code> и перезапустите его с опцией <code>--skip-grant-tables</code>, как
было описано ранее.

<LI>

Соединитесь с сервером <code>mysqld</code> посредством:


<PRE>
shell&#62; mysql -u root mysql
</PRE>

<LI>

Выполните следующие команды из клиента <code>mysql</code>:


<PRE>
mysql&#62; UPDATE user SET Password=PASSWORD('mynewpassword')
    -&#62; WHERE User='root';
mysql&#62; FLUSH PRIVILEGES;
</PRE>

<LI>

После этого можно будет соединяться по новому паролю.

<LI>

Остановите <code>mysqld</code> и запустите его заново, как обычно.
</OL>



<H3><A NAME="Full_disk" HREF="manual.ru_toc.html#Full_disk">A.4.3  Как MySQL реагирует на переполнение диска</A></H3>

<P>
<A NAME="IDX1749"></A>
<A NAME="IDX1750"></A>
<A NAME="IDX1751"></A>

</P>

<P>
Когда возникает ситуация переполнения диска, MySQL реагирует следующим
образом:

</P>

<UL>
Один раз в минуту сервер проверяет, достаточно ли места для записи
текущей строки. Если места достаточно, то сервер продолжает работу так,
как будто ничего не произошло.

<LI>

Каждые 6 минут сервер помещает в журнальный файл запись с
предупреждением о ситуации переполнения диска.
</UL>

<P>
Для снижения остроты проблемы можно принять следующие меры:

</P>

<UL>
<LI>

Чтобы продолжать работу, необходимо просто освободить на диске место,
достаточное для вставки всех записей.

<LI>

Чтобы прервать поток, необходимо послать потоку <code>mysqladmin kill</code>. Поток
будет аварийно прекращен, когда он в следующий раз проверит диск (в
течение 1 минуты).

<LI>

Учтите, что таблицу, вызвавшую ситуацию переполнения диска, могут
ожидать другие потоки. Если существует несколько "блокированных" потоков,
то удаление одного потока, ожидающего по причине переполнения диска,
позволит продолжаться другим.
</UL>

<P>
Исключение составляет использование <code>REPAIR</code> или <code>OPTIMIZE</code>, а также случай,
когда индексы создаются в пакете после команды <code>LOAD DATA INFILE</code> или <code>ALTER
TABLE</code>.

</P>
<P>
Все упомянутые команды могут использовать большие временные файлы,
которые, если их оставить без внимания, могут вызвать большие проблемы во
всей системе. Если MySQL сталкивается с переполнением диска при выполнении
одной из указанных операций, то сервер удаляет большие временные файлы и
отмечает таблицу как поврежденную (за исключением <code>ALTER TABLE</code>, для
которого старая таблица остается без изменений).

</P>


<H3><A NAME="Temporary_files" HREF="manual.ru_toc.html#Temporary_files">A.4.4  Где MySQL хранит временные файлы</A></H3>

<P>
Переменная окружения <code>TMPDIR</code> содержит полное имя каталога, в котором в
MySQL хранит временные  файлы. Если <code>TMPDIR</code> не установлена, то MySQL
использует каталог, заданный в системе  по умолчанию (обычно это <tt>`/tmp'</tt> или
<tt>`/usr/tmp'</tt>). Если файловая система, в которой находится каталог временных
файлов, слишком мала, то следует, отредактировав <code>safe_mysqld</code>, присвоить
<code>TMPDIR</code> значение, указывающее на каталог в "более просторной" файловой
системе! Временный каталог можно также задавать с помощью опции <code>--tmpdir</code> к
<code>mysqld</code>.

</P>
<P>
Все временные файлы  MySQL создает как скрытые; таким образом
гарантируется, что временные файлы будут удалены, если <code>mysqld</code> умрет.
Недостаток использования скрытых файлов в том, что не будут видны большие
временные файлы, забирающие место в файловой системе, где расположен
каталог временных файлов.

</P>
<P>
При сортировке (<code>ORDER BY</code> или <code>GROUP BY</code>) MySQL обычно использует один или
два временных файла. Максимальный размер требующегося для этого
пространства  на диске составляет:

</P>

<PRE>
(размер сортируемых данных + sizeof(указатель базы данных))
* количество совпавших записей
* 2
</PRE>

<P>
<code>sizeof(указатель базы данных)</code> обычно равен 4, но со временем для очень больших
таблиц может увеличиться.

</P>
<P>
Для некоторых запросов <code>SELECT</code> MySQL также создает временные SQL-таблицы.
Они не скрытые и имеют имена вида <tt>`SQL_*'</tt>.

</P>
<P>
<code>ALTER TABLE</code> создает временную таблицу в одном каталоге с исходной
таблицей.

</P>
<P>
Если вы используете версию 4.1 или более новую - вы можете распределять нагрузку
между несколькими физическими дисками путем установления <code>--tmpdir</code> в
список путей, разделенных двоеточием <code>:</code> (точкой с запятой <code>;</code> - под
Winodws). Они будут использоваться в ротации. <strong>Замечание:</strong> эти пути
должны представлять различные <strong>физические</strong> диски, а не различные разделы
одного и того же диска.

</P>



<H3><A NAME="Problems_with_mysql.sock" HREF="manual.ru_toc.html#Problems_with_mysql.sock">A.4.5  Как защитить или изменить сокет-файл MySQL <tt>`/tmp/mysql.sock'</tt></A></H3>

<P>
<A NAME="IDX1752"></A>
<A NAME="IDX1753"></A>

</P>
<P>
Если возникают проблемы с тем, что кто угодно  может удалить
коммуникационный сокет MySQL <tt>`/tmp/mysql.sock'</tt>, то в большинстве версий Unix
можно защитить содержимое <tt>`/tmp'</tt>, установив на каталоге ``липучий'' (sticky)
бит. Войдите в систему как пользователь <code>root</code> и выполните следующую
команду:

</P>

<PRE>
shell&#62; chmod +t /tmp
</PRE>

<P>
Это защитит ваш каталог <tt>`/tmp'</tt>: теперь удалять в нем файлы смогут только их
владельцы или суперпользователь (<code>root</code>).

</P>
<P>
Проверить, установлен ли ``липучий'' (sticky) бит, можно, выполнив 
<code>ls -ld /tmp</code>. Если последним битом прав является <code>t</code>, то 
бит установлен.

</P>
<P>
Изменить путь к каталогу, где MySQL открывает сокет-файл, можно,
воспользовавшись одним из следующих способов:

</P>

<UL>
<LI>

Укажите путь в глобальном или локальном файле опций. Например, поместите
в <tt>`/etc/my.cnf'</tt>:


<PRE>
[client]
socket=path-for-socket-file

[mysqld]
socket=path-for-socket-file
</PRE>

See section <A HREF="manual.ru.html#Option_files">4.1.2  Файлы параметров <tt>`my.cnf'</tt></A>.

<LI>

Укажите, где расположен файл, в командной строке <code>safe_mysqld</code> и
большинства клиентов с помощью опции <code>--socket=путь-к-файлу-сокета</code>.

<LI>

Укажите путь к сокету в переменной окружения <code>MYSQL_UNIX_PORT</code>.

<LI>

Определите путь с помощью опции конфигурирования
<code>--with-unix-socket-path=путь-к-файлу-сокета</code> (see section <A HREF="manual.ru.html#configure_options">2.3.3  Типичные опции <code>configure</code></A>).
</UL>

<P>
Проверить, работает ли сокет, можно следующей командой:

</P>

<PRE>
shell&#62; mysqladmin --socket=/path/to/socket version
</PRE>



<H3><A NAME="Timezone_problems" HREF="manual.ru_toc.html#Timezone_problems">A.4.6  Проблемы с часовыми поясами</A></H3>

<P>
<A NAME="IDX1754"></A>
<A NAME="IDX1755"></A>

</P>
<P>
<A NAME="IDX1756"></A>
<A NAME="IDX1757"></A>

</P>
<P>
Если есть проблема с тем, что <code>SELECT NOW()</code> возвращает значения GMT, а не
местное время, то необходимо установить переменную окружения <code>TZ</code> равной
местному часовому поясу. Это должно быть сделано для окружения, в котором
работает сервер, например, в <code>safe_mysqld</code> или <code>mysql.server</code> (see section <A HREF="manual.ru.html#Environment_variables">E  Переменные окружения</A>).

</P>


<H2><A NAME="Query_Issues" HREF="manual.ru_toc.html#Query_Issues">A.5  Проблемы, относящиеся к запросам</A></H2>



<H3><A NAME="Case_sensitivity" HREF="manual.ru_toc.html#Case_sensitivity">A.5.1  Чувствительность к регистру при поиске</A></H3>

<P>
<A NAME="IDX1758"></A>
<A NAME="IDX1759"></A>
<A NAME="IDX1760"></A>
<A NAME="IDX1761"></A>

</P>
<P>
По умолчанию поиск в MySQL является независимым от регистра символов (хотя
существуют некоторые кодировки, которые всегда чувствительны к регистру,
такие как <code>czech</code>). Это означает, что при поиске с помощью <code>col_name LIKE
'a%'</code> будут выданы все значения столбца, начинающиеся на A или a. Если
необходимо выполнить тот же поиск с учетом регистра, для проверки префикса
следует использовать что-то вроде <code>INSTR(col_name, "A")=1</code> или
<code>STRCMP(col_name, "A") = 0</code>, если значение в столбце точно равно <code>A</code>.

</P>
<P>
Простые операции сравнения (<code>&#62;=, &#62;, =, &#60;, &#60;=</code>, сортировка и группировка)
основываются на "сорте" каждого символа. Символы одного сорта (такие как
<code>E</code>, <code>e</code> и <code>E</code>) обрабатываются как одинаковые символы!

</P>
<P>
В старых версиях MySQL сравнения по <code>LIKE</code> выполнялись над символами,
переведенными в верхний регистр (<code>E == e</code>, но <code>E &#60;&#62; E</code>). В новых версиях MySQL
<code>LIKE</code> работает точно так же, как другие операторы сравнения.

</P>
<P>
Если необходимо, чтобы столбец всегда обрабатывался в с учетом регистра,
объявите его с типом <code>BINARY</code> (see section <A HREF="manual.ru.html#CREATE_TABLE">6.5.3  Синтаксис оператора <code>CREATE TABLE</code></A>).

</P>
<P>
Если вы используете китайские данные в так называемой кодировке <code>big5</code>, то
имеет смысл объявить все символьные столбцы как <code>BINARY</code>. Сортировка таких
столбцов будет работать, поскольку порядок сортировки символов в кодировке
<code>big5</code> основывается на порядке кодов <code>ASCII</code>.

</P>


<H3><A NAME="Using_DATE" HREF="manual.ru_toc.html#Using_DATE">A.5.2  Проблемы с использованием столбцов типа <code>DATE</code></A></H3>

<P>
<A NAME="IDX1762"></A>

</P>
<P>
<A NAME="IDX1763"></A>
<A NAME="IDX1764"></A>

</P>
<P>
Значения типа <code>DATE</code> имеют формат <code>YYYY-MM-DD</code>; согласно стандарту ANSI SQL,
никакой другой формат не допускается. Пользователь должен применять этот
формат в выражениях <code>UPDATE</code> и в определении <code>WHERE</code> операторов <code>SELECT</code>.
Например:

</P>

<PRE>
mysql&#62; SELECT * FROM tbl_name WHERE date &#62;= '1997-05-05';
</PRE>

<P>
Из соображений удобства MySQL автоматически преобразовывает дату в число,
если дата используется в числовом контексте (и наоборот). Благодаря своей
``разумности'' MySQL допускает также ``мягкую'' строковую форму при обновлении
и в определении <code>WHERE</code>, сравнивающем дату со столбцом типа <code>TIMESTAMP, DATE</code>
или <code>DATETIME</code> ("мягкая" форма означает, что для разделения составляющих
даты можно использовать любой знак пунктуации; например, <code>1998-08-15</code> и
<code>1998#08#15</code> эквивалентны). MySQL может также преобразовывать в даты
строки, не содержащие разделителей (наподобие <code>19980815</code>), при условии,
что представляемая строкой дата не лишена смысла.

</P>
<P>
Специальная дата <code>0000-00-00</code> может записываться и извлекаться в виде
<code>0000-00-00</code>. При использовании даты <code>0000-00-00</code> из <code>MyODBC</code> она будет
автоматически преобразована в <code>NULL</code> в версии <code>MyODBC 2.50.12</code> и выше, так как
<code>ODBC</code> не обеспечивает обработку такого рода дат.

</P>
<P>
Поскольку в MySQL выполняются описанные выше преобразования, следующие
команды будут работать:

</P>

<PRE>
mysql&#62; INSERT INTO tbl_name (idate) VALUES (19970505);
mysql&#62; INSERT INTO tbl_name (idate) VALUES ('19970505');
mysql&#62; INSERT INTO tbl_name (idate) VALUES ('97-05-05');
mysql&#62; INSERT INTO tbl_name (idate) VALUES ('1997.05.05');
mysql&#62; INSERT INTO tbl_name (idate) VALUES ('1997 05 05');
mysql&#62; INSERT INTO tbl_name (idate) VALUES ('0000-00-00');
mysql&#62; SELECT idate FROM tbl_name WHERE idate &#62;= '1997-05-05';
mysql&#62; SELECT idate FROM tbl_name WHERE idate &#62;= 19970505;
mysql&#62; SELECT MOD(idate,100) FROM tbl_name WHERE idate &#62;= 19970505;
mysql&#62; SELECT idate FROM tbl_name WHERE idate &#62;= '19970505';
</PRE>

<P>
Однако приведенные ниже команды работать не будут:

</P>

<PRE>
mysql&#62; SELECT idate FROM tbl_name WHERE STRCMP(idate,'19970505')=0;
</PRE>

<P>
<code>STRCMP()</code> - строковая функция, следовательно, она преобразует <code>idate</code> в
строку и сравнивает строки. Функция не станет преобразовывать <code>19970505</code> в
дату и сравнивать даты.

</P>
<P>
Заметим, что MySQL осуществляет очень ограниченную проверку правильности дат, поэтому такая
некорректная дата, как <code>1998-2-31</code>, будет занесена в базу. 

</P>
<P>
Поскольку MySQL пакует даты для сохранения, он не может сохранить любую дату,
так как она может не поместится в результирующий буфер. Правила принятия дат
следующие:

</P>

<UL>
<LI>

Если MySQL может хранить и выбирать заданную дату, неправильная дата принимается
для столбцов <code>DATE</code> и <code>DATETIME</code>.
<LI>

Все значения дней между 0-31 принимаются для любой даты, это удобно для
приложения, где вы запрашиваете год, месяц и день в 3х различных полях.
<LI>

День или месяц могут быть нулем. Это удобно когда вы хотите хранить дату
рождения в столбце <code>DATE</code> и знаете только часть ее.
</UL>

<P>
Если же дату нельзя преобразовать в какое-нибудь разумное значение, в поле типа
DATE заносится 0. Проверка правильности дат не делается - в основном из
соображений, связанных со скоростью: мы считаем, что проверкой дат должно
заниматься приложение, а не сервер.

</P>



<H3><A NAME="Problems_with_NULL" HREF="manual.ru_toc.html#Problems_with_NULL">A.5.3  Проблемы со значением <code>NULL</code></A></H3>

<P>
<A NAME="IDX1765"></A>

</P>
<P>
<A NAME="IDX1766"></A>

</P>
<P>
Концепция <code>NULL</code>-значения часто вводит в заблуждение новичков в SQL, которые
считают, что <code>NULL</code> - то же, что и пустая строка <code>""</code>. Это ошибка! Например,
следующие команды совершенно различны:

</P>

<PRE>
mysql&#62; INSERT INTO my_table (phone) VALUES (NULL);
mysql&#62; INSERT INTO my_table (phone) VALUES ("");
</PRE>

<P>
Обе команды вставляют значение в столбец <code>phone</code>, но первая - значение <code>NULL</code>,
а вторая - пустую строку. Смысл первого можно передать как ``номер телефона
неизвестен'', смысл второго - ``у нее нет телефона''.

</P>
<P>
В SQL сравнение значения <code>NULL</code> с любым другим значением, даже со значением
<code>NULL</code>, всегда ложно. Выражение, содержащее <code>NULL</code>, всегда дает значение <code>NULL</code>,
за исключением случаев, специально оговоренных в документации по
операторам и функциям, присутствующим в выражении. Все столбцы в следующем
примере возвращают <code>NULL</code>:

</P>

<PRE>
mysql&#62; SELECT NULL,1+NULL,CONCAT('Invisible',NULL);
</PRE>

<P>
Если в столбце нужно найти значения <code>NULL</code>, то нельзя использовать условие
<code>=NULL</code>. Следующая команда не возвращает ни одной строки, поскольку для
любого выражения <code>expr = NULL</code> ЛОЖНО:

</P>

<PRE>
mysql&#62; SELECT * FROM my_table WHERE phone = NULL;
</PRE>

<P>
Для поиска значений <code>NULL</code> необходимо использовать проверку <code>IS NULL</code>. Ниже
показано, как найти телефонный номер <code>NULL</code> и пустой телефонный номер:

</P>

<PRE>
mysql&#62; SELECT * FROM my_table WHERE phone IS NULL;
mysql&#62; SELECT * FROM my_table WHERE phone = "";
</PRE>

<P>
Заметим, что добавлять индекс по столбцу, в котором допускаются значения
<code>NULL</code>, можно только в случае, если вы работаете с версией MySQL 3.23.2 или
выше, а используемый тип таблиц - <code>MyISAM</code> или <code>InnoDB</code>. В более ранних
версиях или для других типов таблиц необходимо объявлять такие столбцы с
атрибутом <code>NOT NULL</code>. Это также подразумевает, что тогда нельзя вставлять
<code>NULL</code> в индексированный столбец.

</P>
<P>
<A NAME="IDX1767"></A>
При чтении данных с помощью <code>LOAD DATA INFILE</code> пустые поля обновляются
значениями ''. Если необходимо поместить в столбец <code>значение</code> NULL, то в
текстовом файле следует использовать <code>\N</code>. Также при некоторых
обстоятельствах можно использовать слово-литерал <code>NULL</code> (see section <A HREF="manual.ru.html#LOAD_DATA">6.4.9  Синтаксис оператора  <code>LOAD DATA INFILE</code></A>).

</P>
<P>
При использовании <code>ORDER BY</code> значения <code>NULL</code> выдаются первыми.
В версиях предшествующих 4.0.2, при сортировке в убывающем порядке при помощи
<code>DESC</code>, значения <code>NULL</code> также выдаются последними.
При использовании <code>GROUP BY</code> все значения <code>NULL</code> считаются равными.

</P>
<P>
Для обработки <code>NULL</code> предназначены операторы <code>IS NULL</code> и <code>IS NOT NULL</code>, а также
функция <code>IFNULL()</code>.

</P>
<P>
<A NAME="IDX1768"></A>
<A NAME="IDX1769"></A>
<A NAME="IDX1770"></A>
<A NAME="IDX1771"></A>
Для некоторых типов столбцов значения <code>NULL</code> обрабатываются специальным
образом. Если <code>NULL</code> вставляется в первый в таблице столбец типа <code>TIMESTAMP</code>,
то в него помещается значение текущей даты и времени. При вставке <code>NULL</code> в
<code>AUTO_INCREMENT</code>-столбец вставляется следующее число последовательности.

</P>


<H3><A NAME="Problems_with_alias" HREF="manual.ru_toc.html#Problems_with_alias">A.5.4  Проблемы  с <code>alias</code></A></H3>

<P>
<A NAME="IDX1772"></A>

</P>
<P>
Псевдонимы можно использовать для ссылки на столбец в <code>GROUP BY, ORDER BY</code>
или в части <code>HAVING</code>, а также для лучшего именования столбцов:

</P>

<PRE>
SELECT SQRT(a*b) as rt FROM table_name GROUP BY rt HAVING rt &#62; 0;
SELECT id,COUNT(*) AS cnt FROM table_name GROUP BY id HAVING cnt &#62; 0;
SELECT id AS "Customer identity" FROM table_name;
</PRE>

<P>
Заметим, что в ANSI SQL запрещено ссылаться на псевдоним в определении
<code>WHERE</code>. Вызвано это тем, что при выполнении кода <code>WHERE</code> значение столбца
может быть еще не определенным. Например, следующий запрос <strong>недопустим</strong>:

</P>

<PRE>
SELECT id,COUNT(*) AS cnt FROM table_name WHERE cnt &#62; 0 GROUP BY id;
</PRE>

<P>
Выражение <code>WHERE</code> выполняется, чтобы определить, какие строки следует
включить в часть <code>GROUP BY</code>, тогда как <code>HAVING</code> используется для тех строк из
результирующего множества, которые должны использоваться.

</P>


<H3><A NAME="Deleting_from_related_tables" HREF="manual.ru_toc.html#Deleting_from_related_tables">A.5.5  Удаление строк из взаимосвязанных таблиц</A></H3>

<P>
<A NAME="IDX1773"></A>
<A NAME="IDX1774"></A>
<A NAME="IDX1775"></A>

</P>
<P>
Поскольку MySQL до 4.1.0 не поддерживает вложенных запросов, а также
использование более одной таблицы в команде <code>DELETE</code> (до версии 4.0), то
для удаления строк из 2 взаимосвязанных таблиц следует использовать следующий
подход:

</P>

<OL>
<LI>

Выполните в главной таблице <code>SELECT</code> строк на основе некоторого условия
<code>WHERE</code>.

<LI>

Выполните <code>DELETE</code> строк главной таблицы на основе этого же условия.

<LI>

<code>DELETE FROM related_table WHERE related_column IN (selected_rows)</code>.
</OL>

<P>
где <code>selected_rows</code> - количество строк, выбранных по запросу в п.1.

</P>
<P>
Если общее количество символов в запросе с <code>related_column</code> больше 1048576
(значение <code>max_allowed_packet</code> по умолчанию), то следует разбить запрос на
меньшие части и выполнить несколько команд <code>DELETE</code>. Если <code>related_column</code>
является индексом/индексирован, то самый быстрый <code>DELETE</code> получится при
удалении 100-1000 идентификаторов <code>related_column</code> за запрос. Если
<code>related_column</code> не индекс, то скорость не зависит  от количества аргументов
в операторе <code>IN</code>.

</P>


<H3><A NAME="No_matching_rows" HREF="manual.ru_toc.html#No_matching_rows">A.5.6  Решение проблем с отсутствием строк, удовлетворяющих условиям поиска</A></H3>

<P>
<A NAME="IDX1776"></A>
<A NAME="IDX1777"></A>

</P>
<P>
Если сложный запрос на множестве таблиц совсем не возвращает строк, то для
выяснения причин его неуспешного выполнения необходимо выполнить следующую
последовательность действий:

</P>

<OL>
<LI>

Проверьте запрос с помощью <code>EXPLAIN</code> и посмотрите, не присутствуют ли в
нем явно неправильные записи (see section <A HREF="manual.ru.html#EXPLAIN">5.2.1  Синтаксис оператора <code>EXPLAIN</code> (получение информации о <code>SELECT</code>)</A>).

<LI>

Выберите только поля, используемые в выражении <code>WHERE</code>.

<LI>

По одной убирайте из запроса таблицы до тех пор, пока не станут
возвращаться какие-нибудь строки. Если таблицы большие, то в запросе имеет
смысл использовать <code>LIMIT 10</code>.

<LI>

Выполните <code>SELECT</code> для столбца, который должен был дать совпадение строки
с последней исключенной из запроса таблицей.

<LI>

Если столбцы типа <code>FLOAT</code> или <code>DOUBLE</code> сравниваются с имеющими дробную
часть числами, то нельзя использовать <samp>`='</samp>. Это распространенная проблема в
большинстве компьютерных языков, поскольку значения с плавающей запятой не
являются точными. В большинстве случаев проблему решает изменение <code>FLOAT</code> на
<code>DOUBLE</code>. See section <A HREF="manual.ru.html#Problems_with_float">A.5.7  Проблемы со сравнением чисел с плавающей точкой</A>.

<LI>

Если так и не удалось выяснить, в чем загвоздка, то для демонстрации
возникших у вас проблем создайте минимальный тест, запускающийся при
помощи <code>mysql test &#60; query.sql</code>. Тестовый файл можно создать,
воспользовавшись <code>mysqldump --quick database tables &#62; query.sql</code>. Далее
откройте файл в редакторе, удалите некоторые команды вставки (если их
слишком много) и добавьте в конце файла свою команду выборки. Убедитесь,
что проблема по-прежнему проявляется, посредством:


<PRE>
shell&#62; mysqladmin create test2
shell&#62; mysql test2 &#60; query.sql
</PRE>

Используя <code>mysqlbug</code>, пошлите тестовый файл в список рассылки на <a HREF="mailto:mysql@lists.mysql.com">mysql@lists.mysql.com</a>.
</OL>



<H3><A NAME="Problems_with_float" HREF="manual.ru_toc.html#Problems_with_float">A.5.7  Проблемы со сравнением чисел с плавающей точкой</A></H3>

<P>
Числа с плавающей точкой иногда служат источником неприятностей, поскольку
эти числа архитектурно хранятся в компьютере не как точные числа. То, что
обычно мы видим на экране, не является точным значением числа.

</P>
<P>
Поля типов FLOAT, DOUBLE и DECIMAL следующие.

</P>

<PRE>
CREATE TABLE t1 (i INT, d1 DECIMAL(9,2), d2 DECIMAL(9,2));
INSERT INTO t1 VALUES (1, 101.40, 21.40), (1, -80.00, 0.00),
(2, 0.00, 0.00), (2, -13.20, 0.00), (2, 59.60, 46.40),
(2, 30.40, 30.40), (3, 37.00, 7.40), (3, -29.60, 0.00),
(4, 60.00, 15.40), (4, -10.60, 0.00), (4, -34.00, 0.00),
(5, 33.00, 0.00), (5, -25.80, 0.00), (5, 0.00, 7.20),
(6, 0.00, 0.00), (6, -51.40, 0.00);

mysql&#62; SELECT i, SUM(d1) AS a, SUM(d2) AS b
    -&#62; FROM t1 GROUP BY i HAVING a &#60;&#62; b;
+------+--------+-------+
| i    | a      | b     |
+------+--------+-------+
|    1 |  21.40 | 21.40 |
|    2 |  76.80 | 76.80 |
|    3 |   7.40 |  7.40 |
|    4 |  15.40 | 15.40 |
|    5 |   7.20 |  7.20 |
|    6 | -51.40 |  0.00 |
+------+--------+-------+
</PRE>

<P>
Результат правильный. Хотя кажется, что первые пять записей должны быть
отброшены, не выдержав проверки на сравнение, тем не менее, они могут
удовлетворить условиям по той причине, что в зависимости от архитектуры
компьютера между числами проявляются отличия примерно на уровне десятого
знака.

</P>
<P>
С помощью <code>ROUND()</code> (или подобной функции) проблема не может быть решена,
поскольку результат все равно будет числом с плавающей запятой, например:

</P>

<PRE>
mysql&#62; SELECT i, ROUND(SUM(d1), 2) AS a, ROUND(SUM(d2), 2) AS b
    -&#62; FROM t1 GROUP BY i HAVING a &#60;&#62; b;
+------+--------+-------+
| i    | a      | b     |
+------+--------+-------+
|    1 |  21.40 | 21.40 |
|    2 |  76.80 | 76.80 |
|    3 |   7.40 |  7.40 |
|    4 |  15.40 | 15.40 |
|    5 |   7.20 |  7.20 |
|    6 | -51.40 |  0.00 |
+------+--------+-------+
</PRE>

<P>
Вот как выглядят числа в столбце 'a':

</P>

<PRE>
mysql&#62; SELECT i, ROUND(SUM(d1), 2)*1.0000000000000000 AS a,
    -&#62; ROUND(SUM(d2), 2) AS b FROM t1 GROUP BY i HAVING a &#60;&#62; b;
+------+----------------------+-------+
| i    | a                    | b     |
+------+----------------------+-------+
|    1 |  21.3999999999999986 | 21.40 |
|    2 |  76.7999999999999972 | 76.80 |
|    3 |   7.4000000000000004 |  7.40 |
|    4 |  15.4000000000000004 | 15.40 |
|    5 |   7.2000000000000002 |  7.20 |
|    6 | -51.3999999999999986 |  0.00 |
+------+----------------------+-------+
</PRE>

<P>
В вашей системе результаты могут либо такими, либо нет - это зависит от
архитектуры компьютера. Каждый процессор выполняет вычисления с плавающей
точкой по-своему. Например, на некоторых машинах можно получить
``правильные'' результаты, если умножить оба аргумента на 1 (см. пример
ниже).

</P>
<P>
<strong>ПРЕДУПРЕЖДЕНИЕ: НИКОГДА НЕ ПОЛАГАЙТЕСЬ НА ДАННЫЙ МЕТОД В СВОЕМ ПРИЛОЖЕНИИ,
ЭТО ПРИМЕР ТОГО, КАКИЕ МЕТОДЫ НЕ СЛЕДУЕТ ИСПОЛЬЗОВАТЬ!!!</strong>

</P>

<PRE>
mysql&#62; SELECT i, ROUND(SUM(d1), 2)*1 AS a, ROUND(SUM(d2), 2)*1 AS b
    -&#62; FROM t1 GROUP BY i HAVING a &#60;&#62; b;
+------+--------+------+
| i    | a      | b    |
+------+--------+------+
|    6 | -51.40 | 0.00 |
+------+--------+------+
</PRE>

<P>
Приведенный выше пример вроде бы работает. Но это случайность, поскольку
именно на той конкретной машине, где выполнялась проверка, процессор
выполняет арифметические операции с плавающей точкой таким образом, что
числа округляются до одинаковых значений. Однако полагаться на то, что так
будут работать все без исключения процессоры, нельзя.

</P>
<P>
Правильный способ сравнения чисел с плавающей запятой заключается в том,
чтобы сначала определиться с допустимым отклонением одного числа от
другого, а затем при сравнении учитывать этот допуск. Например, если мы
договоримся, что числа должны считаться одинаковыми, если они равны с
точностью до одной десятитысячной (0,0001), то сравнение должно
проводиться следующим образом:

</P>

<PRE>
mysql&#62; SELECT i, SUM(d1) AS a, SUM(d2) AS b FROM t1
    -&#62; GROUP BY i HAVING ABS(a - b) &#62; 0.0001;
+------+--------+------+
| i    | a      | b    |
+------+--------+------+
|    6 | -51.40 | 0.00 |
+------+--------+------+
1 row in set (0.00 sec)
</PRE>

<P>
И наоборот, если мы хотим оставить строки, в которых числа одинаковы, то
проверка должна быть следующей:

</P>

<PRE>
mysql&#62; SELECT i, SUM(d1) AS a, SUM(d2) AS b FROM t1
    -&#62; GROUP BY i HAVING ABS(a - b) &#60; 0.0001;
+------+-------+-------+
| i    | a     | b     |
+------+-------+-------+
|    1 | 21.40 | 21.40 |
|    2 | 76.80 | 76.80 |
|    3 |  7.40 |  7.40 |
|    4 | 15.40 | 15.40 |
|    5 |  7.20 |  7.20 |
+------+-------+-------+
</PRE>



<H2><A NAME="Table_Definition_Issues" HREF="manual.ru_toc.html#Table_Definition_Issues">A.6  Вопросы, связанные с определением таблиц</A></H2>



<H3><A NAME="ALTER_TABLE_problems" HREF="manual.ru_toc.html#ALTER_TABLE_problems">A.6.1  Проблемы с <code>ALTER TABLE</code></A></H3>

<P>
<A NAME="IDX1778"></A>
<A NAME="IDX1779"></A>
<A NAME="IDX1780"></A>

</P>
<P>
<code>ALTER TABLE</code> изменяет таблицу в соответствии с текущей кодировкой. Если при
выполнении <code>ALTER TABLE</code> выдается ошибка дублирующегося ключа, то причина
либо в том, что новая кодировка отображает ключи в одинаковые значения,
либо в том, что таблица повреждена. В последнем случае на таблице
необходимо выполнить <code>REPAIR TABLE</code>.

</P>
<P>
Если работа <code>ALTER TABLE</code> прекращается с ошибкой, подобной приведенной ниже:

</P>
<P>
<code>Error on rename of './database/name.frm' to './database/B-a.frm' (Errcode:
17)</code>

</P>
<P>
то проблема может быть связана с тем, что MySQL аварийно завершился на
предыдущей команде <code>ALTER TABLE</code> и осталась старая таблица с именем
<tt>`A-что_нибудь'</tt> или <tt>`B-что_нибудь'</tt>. В этом случае перейдите в каталог
данных MySQL и удалите все файлы, имена которых начинаются с <code>A-</code> или <code>B-</code> (их
можно и не удалять, а куда-либо переместить).

</P>
<P>
<code>ALTER TABLE</code> работает следующим образом:

</P>

<UL>
<LI>

Создается новая таблица с именем <tt>`A-xxx'</tt> с заданными в запросе
изменениями.

<LI>

Все строки старой таблицы копируются в <tt>`A-xxx'</tt>.

<LI>

Старая таблица переименовывается в <tt>`B-xxx'</tt>.

<LI>

<tt>`A-xxx'</tt> переименовывается в имя старой таблицы.

<LI>

Удаляется <tt>`B-xxx'</tt>.
</UL>

<P>
Если что-то приключится при операции переименования, MySQL попытается
отменить изменения. Если случится что-то серьезное (чего произойти,
конечно, не должно), MySQL может оставить старую таблицу именованной как
<tt>`B-xxx'</tt> - в этом случае, однако, для восстановления данных достаточно будет
просто переименовать ее на системном уровне.

</P>


<H3><A NAME="Change_column_order" HREF="manual.ru_toc.html#Change_column_order">A.6.2  Как изменить порядок столбцов в таблице</A></H3>

<P>
<A NAME="IDX1781"></A>
<A NAME="IDX1782"></A>
<A NAME="IDX1783"></A>
<A NAME="IDX1784"></A>

</P>
<P>
Основная идея SQL заключается в том, чтобы разделить приложения и формат
хранения данных. Всегда следует указывать порядок извлечения данных,
например:

</P>

<PRE>
SELECT col_name1, col_name2, col_name3 FROM tbl_name;
</PRE>

<P>
возвратит столбцы в порядке <code>col_name1, col_name2, col_name3</code>, тогда как:

</P>

<PRE>
SELECT col_name1, col_name3, col_name2 FROM tbl_name;
</PRE>

<P>
возвратит столбцы в порядке <code>col_name1, col_name3, col_name2</code>.

</P>
<P>
В приложения <strong>никогда</strong> нельзя использовать <code>SELECT *</code> и извлекать столбцы,
полагаясь на их позиции, поскольку порядок, в котором возвращаются
столбцы, <strong>не может быть гарантирован</strong>. Простое
изменение в базе данных может катастрофически сказаться на поведении
приложения.

</P>
<P>
Если порядок столбцов все-таки требуется изменить, то сделать это можно
следующим образом:

</P>

<OL>
<LI>

Создайте новую таблицу со столбцами в правильном порядке.

<LI>

Выполните <code>INSERT INTO new_table SELECT поля-в-желаемом-порядке FROM
old_table</code>.

<LI>

Удалите или переименуйте <code>old_table</code>.

<LI>

<code>ALTER TABLE new_table RENAME old_table</code>.
</OL>



<H3><A NAME="Temporary_table_problems" HREF="manual.ru_toc.html#Temporary_table_problems">A.6.3  Проблемы, относящиеся к временным (<code>TEMPORARY</code>) таблицам</A></H3>

<P>
<A NAME="IDX1785"></A>

</P>
<P>
Ниже перечислены ограничения, относящиеся к временным таблицам.

</P>

<UL>
<LI>

Временной может быть только таблица типа <code>HEAP</code>, <code>ISAM</code>, <code>MyISAM</code>, <code>MERGE</code> или <code>InnoDB</code>.

<LI>

Временная таблица не может использоваться в одном запросе более одного
раза. Например, следующий запрос работать не будет.


<PRE>
mysql&#62; SELECT * FROM temporary_table, temporary_table AS t2;
</PRE>

<LI>

Нельзя использовать <code>RENAME</code> на таблице с атрибутом <code>TEMPORARY</code>. Отметим,
однако, что <code>ALTER TABLE оригинальное_имя RENAME новое_имя</code> работает!
</UL>



<H1><A NAME="Credits" HREF="manual.ru_toc.html#Credits">B  Благодарности</A></H1>

<P>
<A NAME="IDX1786"></A>

</P>
<P>
В этом приложении перечисляются разработчики, помощники и спонсоры,
которые помогли сделать MySQL таким, какой он есть сегодня.

</P>



<H2><A NAME="Developers" HREF="manual.ru_toc.html#Developers">B.1  Разработчики MySQL AB</A></H2>

<P>
Здесь представлен список разработчиков, занимающихся в настоящее
разработкой программного обеспечения сервера баз данных MySQL в компании
MySQL AB или занимавшихся этой разработкой ранее, приблизительно в том
порядке, в котором они начинали работать с нами. После личных данных
каждого разработчика следует небольшой список задач, за которые он
отвечал, или выполненных им работ. Все разработчеки вовлечены в техническую поддержку.

</P>
<DL COMPACT>

<DT>Майкл (Монти) Видениус (Michael (Monty) Widenius)
<DD>

<UL>
<LI>

Главный программист и главный автор MySQL сервера (<code>mysqld</code>).
<LI>

Новые функции для строковой библиотеки.
<LI>

Большая часть библиотеки <code>mysys</code>.
<LI>

Библиотеки <code>ISAM</code> и <code>MyISAM</code> (обработчики индексного файла B-tree с
уплотнением индексов и различными форматами записи).
<LI>

Библиотека <code>HEAP</code>. Система таблиц памяти с разработанным нами
превосходным полностью динамическим хешированием. В эксплуатации
находится с 1981 года; опубликована приблизительно в 1984 году.
<LI>

Программа <code>replace</code> (гляньте на нее, это <strong>КРУТО</strong>!).
<LI>

<code>MyODBC</code>, драйвер ODBC для Windows95.
<LI>

Устранение ошибок в потоках MIT-pthreads для обеспечения их работы в
сервере MySQL. А также Unireg, прикладная среда с интерфейсом Curses
со многими полезными утилитами.
<LI>

Осуществил перенос из mSQL таких средств, как <code>msqlperl</code>, <code>DBD</code>/<code>DBI</code> и
<code>DB2mysql</code>.
<LI>

Большинство тестов <code>crash-me</code> и организация эталонных тестов для MySQL.
</UL>

<DT>Дэвид Эксмарк (David  Axmark)
<DD>

<UL>
<LI>

Первый основной автор справочного руководства, включая
модернизацию <code>texi2html</code>.
<LI>

Автоматический веб-сайт, обновляющийся из данного руководства.
<LI>

Первоначальная поддержка <code>Autoconf</code>, <code>Automake</code> и <code>Libtool</code>.
<LI>

Лицензирование.
<LI>

Участие в написании всех текстовых файлов (из них в настоящее время
остался только файл <tt>`README'</tt>: остальные вошли в состав руководства).
<LI>

Большой объем работы по тестированию новых возможностей.
<LI>

Наш домашний юрист по программному обеспечению с открытым кодом (Free 
Software).
<LI>

Ответственный за поддержку списка рассылки (у которого никогда нет
времени делать это как следует...).
<LI>

Автор нашего оригинального кода, обеспечивающего переносимость
(которому сейчас более 10 лет). В настоящее время от <code>mysys</code> остались
только некоторые части.
<LI>

А также человек, которому Монти всегда может позвонить среди ночи,
когда только что заработало новое программное средство.
<LI>

Старший специалист по открытому коду (связь с общественностью MySQL).
</UL>

<DT>Яни Толонен (Jani Tolonen)
<DD>

<UL>
<LI>

<code>mysqlimport</code>
<LI>

Большое количество расширений для клиентов командной строки.
<LI>

<code>PROCEDURE ANALYSE()</code> 
</UL>

<DT>Синиша Миливоевич (Sinisa Milivojevic)
<DD>

<UL>
<LI>

Компрессия (с помощью <code>zlib</code>) в протоколе клиент-сервер.
<LI>

Превосходное хеширование для фазы лексического анализатора.
<LI>

Многострочная команда <code>INSERT</code>
<LI>

Опция <code>mysqldump -e</code> 
<LI>

<code>LOAD DATA LOCAL INFILE</code> 
<LI>

Опция <code>SQL_CALC_FOUND_ROWS</code> для  <code>SELECT</code>
<LI>

Опция <code>--max-user-connections=...</code> 
<LI>

<code>net_read</code> и <code>net_write_timeout</code>
<LI>

<code>GRANT</code>/<code>REVOKE</code> и <code>SHOW GRANTS FOR</code> 
<LI>

Новый клиент-серверный протокол для версии 4.0
<LI>

<code>UNION</code> в 4.0.
<LI>

Многотабличные команды <code>DELETE</code>/<code>UPDATE</code>
<LI>

Вторичные таблицы в 4.1.
<LI>

Управление пользовательскими ресурсами.
<LI>

Первый автор <code>MySQL++</code> C API и клиента <code>MySQLGUI</code>.
</UL>

<DT>Тону Сэмюэл (Tonu Samuel) (разработчик в прошлом)
<DD>

<UL>
<LI>

Интерфейс VIO (основы клиент-серверного протокола с шифрованием).
<LI>

MySQL  Filesystem (технология использования баз данных MySQL как
файловой системы).
<LI>

Выражение <code>CASE</code>.
<LI>

Функции <code>MD5()</code> и <code>COALESCE()</code>.
<LI>

Поддержка <code>RAID</code> для таблиц <code>MyISAM</code>.
</UL>

<DT>Саша Пачев (Sasha  Pachev)
<DD>

<UL>
<LI>

Начальная реализация репликации (до версии 4.0).
<LI>

<code>SHOW CREATE TABLE</code>.
<LI>

<code>mysql-bench</code> 
</UL>

<DT>Мэт Вагнер (Matt Wagner)
<DD>

<UL>
<LI>

Набор тестов для MySQL
<LI>

Веб-мастер (до 2002).
<LI>

Координатор разработки.
</UL>

<DT>Мигуэл Солорцано (Miguel  Solorzano)
<DD>

<UL>
<LI>

Разработка Win32 и выпуск бинарных версий.
<LI>

Код сервера под Windows NT.
<LI>

<code>WinMySQLAdmin</code>.
</UL>

<DT>Тимоти Смит (Timothy Smith) (разработчик в прошлом)
<DD>

<UL>
<LI>

Поддержка динамических символов (dynamic character).
<LI>

configure, пакеты RPM и другие части сборочной системы.
<LI>

Начальный разработчик <code>libmysqld</code>, встраиваемого сервера.
</UL>

<DT>Сергей Голубчик (Sergei Golubchik)
<DD>

<UL>
<LI>

Полнотекстовый поиск.
<LI>

Добавление ключей к библиотеке <code>MERGE</code>.
</UL>

<DT>Джереми Коул (Jeremy Cole)
<DD>

<UL>
<LI>

Чтение корректуры и редактирование этого замечательного руководства на
английском языке.
<LI>

<code>ALTER TABLE ... ORDER BY ...</code>.
<LI>

<code>UPDATE ... ORDER BY ...</code>.
<LI>

<code>DELETE ... ORDER BY ...</code>.
</UL>

<DT>Индрек Сиитан (Indrek Siitan)
<DD>

<UL>
<LI>

Разработка/программирование веб-интерфейса.
<LI>

Автор нашей системы управления списком рассылки.
</UL>

<DT>Джордж дел Конде (Jorge del Conde)
<DD>

<UL>
<LI>

Центр Управления MySQL <code>MyCC</code> (<code>MySQL Control Center</code>).
<LI>

Разработка Win32
<LI>

Начальная реализация веб-портала.
</UL>

<DT>Вену Аннуганти (Venu Anuganti)
<DD>

<UL>
<LI>

MyODBC 3.51
<LI>

Новый клиент/серверный протокол для 4.1 (для подготовленных выражений).
<LI>

</UL>

<DT>Арйен Ленц (Arjen Lentz)
<DD>

<UL>
<LI>

Поддерживает справочное руководство по MySQL.
<LI>

Подготовка печатного издания справочного руководства в издательстве O'Reilly.
</UL>

<DT>Александр Барков (Alexander (Bar) Barkov), Алексей Бочков (Alexey (Holyfoot)
<DD>
Botchkov), и Рамиль Калимуллин (Ramil Kalimullin)

<UL>
<LI>

Пространственные данные (GIS) и реализация R-Деревьев в 4.1
<LI>

Unicode и набор символов в 4.1
</UL>

<DT>Александр Белкин (Oleksandr (Sanja) Byelkin)
<DD>

<UL>
<LI>

Кэш запросов в 4.0
<LI>

Реализация вложенных запросов (4.1).
</UL>

<DT>Алексей Кишкин (Aleksey (Walrus) Kishkin) и Алексей Строганов (Alexey (Ranger) Stroganov)
<DD>

<UL>
<LI>

Разработка тестов скорости работы и анализ.
<LI>

Поддержка набора тестов для MySQL.
</UL>

<DT>Зэк Гринт (Zak Greant)
<DD>

<UL>
<LI>

Адвокат по открытому коду, связь MySQL с общественностью.
</UL>

<DT>Карстен Педерсен (Carsten Pedersen)
<DD>

<UL>
<LI>

Сертификационная программа MySQL.
</UL>

<DT>Ленц Гриммер (Lenz Grimmer)
<DD>

<UL>
<LI>

Технология производства (сборка и выпуск).
</UL>

<DT>Петр Зайцев (Peter Zaitsev)
<DD>

<UL>
<LI>

<code>SHA1()</code>, <code>AES_ENCRYPT()</code> и <code>AES_DECRYPT()</code> функции.
<LI>

Отладка, чистка различных возможностей.
</UL>

<DT>Александр Керемидарский (Alexander (Salle) Keremidarski)
<DD>

<UL>
<LI>

Документирование существующего кода и алгоритмов в MySQL.
<LI>

Отладка.
</UL>

<DT>Пер-Эрик Мартин (Per-Erik Martin)
<DD>

<UL>
<LI>

Главный разработчик хранимых процедур и триггеров.
</UL>

<DT>Джим Уинстед (Jim Winstead)
<DD>

<UL>
<LI>

Главный веб-разработчик.
</UL>

<DT>Марк Мэтьюз (Mark Matthews)
<DD>

<UL>
<LI>

Драйвер Connector/J (Java).
</UL>

</DL>



<H2><A NAME="Contributors" HREF="manual.ru_toc.html#Contributors">B.2  Наши помощники, которые сделали вклад в развитие MySQL</A></H2>

<P>
<A NAME="IDX1787"></A>

</P>
<P>
В то время как <code>MySQL AB</code> обладает всеми авторскими правами на сервер MySQL
и документацию по MySQL, мы хотим отдать дань уважения тем, кто в той или
иной степени лично способствовал разработке MySQL. Ниже в произвольном
порядке перечислены наши помощники, которые сделали вклад в развитие в
MySQL:

</P>
<DL COMPACT>

<DT>Пол Дюбуа (Paul DuBois)
<DD>
В настоящее время помощь в приведении данного справочного руководства (Reference Manual) к
корректному и понятному виду. Другими словами, перевод текстов Монти и
Дэвида с их собственного английского на английский, понятный другим людям.

<DT>Джанмассимо Вигаццола (Gianmassimo  Vigazzola) <a HREF="mailto:qwerg@mbox.vol.it">qwerg@mbox.vol.it</a> или
<DD>
<a HREF="mailto:qwerg@tin.it">qwerg@tin.it</a> 
Первоначальный перенос на Win32/NT.

<DT>Ким Олдэйл (Kim  Aldale)
<DD>
Помог переписать самые первые тексты Монти и Дэвида с их собственного
английского на нормальный английский.

<DT>Пер Эрик Олссон (Per Eric Olsson)
<DD>
Благодарность за более или менее конструктивную критику и первоклассное
тестирование формата динамической записи.

<DT>Ирэна Панциров (Irena  Pancirov) <a HREF="mailto:irena@mail.yacc.it">irena@mail.yacc.it</a>
<DD>
Перенос Win32 с помощью компилятора Borland. <code>mysqlshutdown.exe</code> и
<code>mysqlwatch.exe</code> 

<DT>Дэвид Дж. Хьюз (David J. Hughes)
<DD>
Благодарность за вклад в создание SQL-базы данных, распространяемой по
принципу <code>shareware</code>. Начав свою работу в компании TcX (предшественник MySQL
AB) с mSQL, мы, однако, пришли к выводу, что эта база данных не
удовлетворяет нашим требованиям. Поэтому вместо нее был написан интерфейс
SQL к нашему компоновщику приложений Unireg. На программу <code>mysqladmin</code> и
клиент <code>mysql</code> оказали значительное влияние их двойники в mSQL. Мы приложили
много усилий, чтобы сделать синтаксис MySQL расширенным вариантом mSQL.
Многие идеи API были заимствованы из mSQL, чтобы упростить перенос
свободно распространяемых программ mSQL в MySQL  API. Программное
обеспечение MySQL не содержит никакого кода из mSQL. Два файла в
дистрибутиве (<tt>`client/insert_test.c'</tt> и <tt>`client/select_test.c'</tt>) базируются
на соответствующих (не защищенных авторскими правами) файлах дистрибутива
mSQL, но они модифицированы в примеры, показывающие, какие изменения
необходимы для преобразования кода из mSQL в сервер MySQL. (авторское
право на mSQL принадлежит Дэвиду Дж. Хьюзу (David J. Hughes.))

<DT>Фред Фиш (Fred Fish)
<DD>
Благодарность за его великолепную отладку C и библиотеку трассировки.
Монти сделал ряд небольших улучшений к этой библиотеке (скорость и другие
возможности).

<DT>Ричард А. О'Кифи (Richard A. O'Keefe)
<DD>
Благодарность за его общедоступную строковую библиотеку.

<DT>Генри Спенсер (Henry Spencer)
<DD>
Благодарность за его библиотеку регулярных выражений, использованную в
<code>WHERE column REGEXP regexp</code>.

<DT>Ассоциация Свободного ПО (Free  Software  Foundation)
<DD>
От этой ассоциации мы получили прекрасный компилятор (<code>gcc</code>), библиотеку
<code>libc</code> (из которой заимствовали <tt>`strto.c'</tt> для того, чтобы получить код,
работающий под Linux) и библиотеку <code>readline</code> (для клиента <code>mysql</code>).

<DT>Ассоциация Свободного ПО (Free  Software  Foundation) и команда
<DD>
разработчиков Xemacs (The XEmacs development team)
Благодарность за действительно великолепный редактор/среду, который
использовали практически все в MySQL AB/TcX/detron.

<DT>Патрик Линч (Patrick Lynch)
<DD>
Благодарность за помощь в получении <a HREF="http://www.mysql.com/">http://www.mysql.com/</a>.

<DT>Фред Линдберг (Fred Lindberg)
<DD>
Благодарность за установку <code>qmail</code> для управления списком рассылки MySQL и
за неоценимую помощь, которую мы получили в управлении списком рассылки
MySQL.

<DT>Игорь Романенко (Igor Romanenko) <a HREF="mailto:igor@frog.kiev.ua">igor@frog.kiev.ua</a>
<DD>
<code>mysqldump</code> (ранее <code>msqldump</code>, Монти осуществил перенос этой утилиты и
усовершенствовал ее).

<DT>Юрий Дарио (Yuri Dario)
<DD>
Благодарность за поддержку и расширение переноса MySQL на OS/2.

<DT>Тим Банке (Tim Bunce, Alligator Descartes)
<DD>
Благодарность за интерфейс <code>DBD</code> (Perl).

<DT>Тим Банке (Tim Bunce)
<DD>
Автор <code>mysqlhotcopy</code>.

<DT>Эндриас Коуниг (Andreas  Koenig) <a HREF="mailto:a.koenig@mind.de">a.koenig@mind.de</a>
<DD>
Благодарность за интерфейс Perl для сервера MySQL.

<DT>Юджин Чан (Eugene Chan) <a HREF="mailto:eugene@acenet.com.sg">eugene@acenet.com.sg</a>
<DD>
Благодарность за перенос PHP для сервера MySQL.

<DT>Майкл Дж. Миллер мл. (Michael J. Miller Jr.) <a HREF="mailto:mke@terrapin.turbolift.com">mke@terrapin.turbolift.com</a>
<DD>
Благодарность за первое руководство по MySQL. И за большое количество
орфографических и грамматических правок в разделе FAQ (который уже давно
превратился в руководство по MySQL).

<DT>Ян Кайлин (Yan Cailin)
<DD>
Первый перевод справочного руководства по MySQL на упрощенный китайский
язык в начале 2000 года; на этом руководстве базировались версии,
кодированные на Big5 и HK (<a HREF="http://mysql.hitstar.com/">http://mysql.hitstar.com/</a>). Персональная домашняя страничка на linuxdb.yeah.net.

<DT>Джованни Маруцелли (Giovanni Maruzzelli) <a HREF="mailto:maruzz@matrice.it">maruzz@matrice.it</a>
<DD>
Благодарность за перенос iODBC (Unix ODBC).

<DT>Крис Провензано (Chris Provenzano)
<DD>
Переносимые потоки pthreads пользовательского уровня. Выдержка из
документа по авторским правам на MySQL: "Этот продукт включает в себя
программное обеспечение, разработанное Крисом Провензано, Калифорнийский
университет, Беркли (Chris  Provenzano, the  University  of  California,
Berkeley) и его помощниками". В настоящее время мы используем версию
1_60_beta6 с патчами Монти (см. <tt>`mit-pthreads/Changes-mysql'</tt>).

<DT>Ксавьер Лерой (Xavier Leroy) <a HREF="mailto:Xavier.Leroy@inria.fr">Xavier.Leroy@inria.fr</a>
<DD>
Автор LinuxThreads (используемых сервером MySQL под Linux).

<DT>Зарко Мокник (Zarko Mocnik) <a HREF="mailto:zarko.mocnik@dem.si">zarko.mocnik@dem.si</a>
<DD>
Упорядочение для словенского языка и разработка модуля <tt>`cset.tar.gz'</tt>,
который облегчает добавление других кодировок.

<DT>"ТАМИТО" ("TAMITO") <a HREF="mailto:tommy@valley.ne.jp">tommy@valley.ne.jp</a>
<DD>
Макрос кодировки <code>_MB</code> и наборы символов <code>ujis</code> и <code>sjis</code>.

<DT>Джошуа Чамас (Joshua Chamas) <a HREF="mailto:joshua@chamas.com">joshua@chamas.com</a>
<DD>
Основы для параллельной вставки, расширенный синтаксис даты, отладка под
NT и ответы по списку рассылки MySQL.

<DT>Ив Карлиер (Yves Carlier) <a HREF="mailto:Yves.Carlier@rug.ac.be">Yves.Carlier@rug.ac.be</a>
<DD>
mysqlaccess, программа, показывающая права доступа для пользователя.

<DT>Рис Джонс (Rhys Jones) <a HREF="mailto:rhys@wales.com">rhys@wales.com</a> (И GWE Technologies Limited)
<DD>
Благодарность за JDBC, модуль для извлечения данных из базы данных MySQL
при помощи помощью Java-клиента.

<DT>Др. Ксайэокун Келвин ZHU (Dr Xiaokun Kelvin ZHU) <a HREF="mailto:X.Zhu@brad.ac.uk">X.Zhu@brad.ac.uk</a>
<DD>
Дальнейшая разработка JDBC-драйвера и других относящихся к MySQL 
Java-программ.

<DT>Джеймс Купер (James Cooper) <a HREF="mailto:pixel@organic.com">pixel@organic.com</a>
<DD>
Благодарность за установку архива списка рассылки с возможностью поиска на
его сайте.

<DT>Рик Мехелик (Rick Mehalick) <a HREF="mailto:Rick_Mehalick@i-o.com">Rick_Mehalick@i-o.com</a>
<DD>
Благодарность за <code>xmysql</code>, графический X-клиент для сервера MySQL.

<DT>Дуг Сиск (Doug Sisk) <a HREF="mailto:sisk@wix.com">sisk@wix.com</a>
<DD>
Благодарность за разработку пакетов RPM для MySQL под RedHat  Linux.

<DT>Дайменд Александер В. (Diemand Alexander V.) <a HREF="mailto:axeld@vial.ethz.ch">axeld@vial.ethz.ch</a>
<DD>
Благодарность за разработку пакетов RPM для MySQL под RedHat  Linux-Alpha.

<DT>Энтони Пеймес Олив (Antoni Pamies Olive) <a HREF="mailto:toni@readysoft.es">toni@readysoft.es</a>
<DD>
Благодарность за разработку пакетов RPM многих клиентов MySQL для Intel и
SPARC.

<DT>Джей Бладвортс (Jay  Bloodworth) <a HREF="mailto:jay@pathways.sde.state.sc.us">jay@pathways.sde.state.sc.us</a>
<DD>
Благодарность за разработку пакетов RPM для версии MySQL 3.21.

<DT>Джошен Видманн (Jochen  Wiedmann) <a HREF="mailto:wiedmann@neckar-alb.de">wiedmann@neckar-alb.de</a>
<DD>
Благодарность за поддержку модуля Perl <code>DBD::mysql</code>.

<DT>Терьен Джилберт (Therrien  Gilbert) <a HREF="mailto:gilbert@ican.net">gilbert@ican.net</a>, Джин - Марк Поуйот
<DD>
(Jean-Marc  Pouyot) j<a HREF="mailto:mp@scalaire.fr">mp@scalaire.fr</a> 
Сообщения об ошибках на французском языке.

<DT>Петр Снайдр (Petr  snajdr), <a HREF="mailto:snajdr@pvt.net">snajdr@pvt.net</a>
<DD>
Сообщения об ошибках на чешском языке.

<DT>Ярослав Левандовски (Jaroslaw Lewandowski) <a HREF="mailto:jotel@itnet.com.pl">jotel@itnet.com.pl</a>
<DD>
Сообщения об ошибках на польском языке.

<DT>Мигель Эйнджел Фернандес Роиз (Miguel Angel Fernandez Roiz)
<DD>
Сообщения об ошибках на испанском языке.

<DT>Рой - Магн Моу (Roy-Magne Mo) <a HREF="mailto:rmo@www.hivolda.no">rmo@www.hivolda.no</a>
<DD>
Сообщения об ошибках на норвежском языке и тестирование версии 3.21.#.

<DT>Тимур И. Бакеев (Timur I. Bakeyev) <a HREF="mailto:root@timur.tatarstan.ru">root@timur.tatarstan.ru</a>
<DD>
Сообщения об ошибках на русском языке.

<DT>brenno@dewinter.com и Филиппо Грасилли (&#38; Filippo  Grassilli)
<DD>
<a HREF="mailto:phil@hyppo.com">phil@hyppo.com</a> 
Сообщения об ошибках на итальянском языке.

<DT>Дирк Мюнцингер (Dirk Munzinger) <a HREF="mailto:dirk@trinity.saar.de">dirk@trinity.saar.de</a>
<DD>
Сообщения об ошибках на немецком языке.

<DT>Биллик Стефан (Billik  Stefan) <a HREF="mailto:billik@sun.uniag.sk">billik@sun.uniag.sk</a>
<DD>
Сообщения об ошибках на словацком языке.

<DT>Стефан Сарою (Stefan  Saroiu) <a HREF="mailto:tzoompy@cs.washington.edu">tzoompy@cs.washington.edu</a>
<DD>
Сообщения об ошибках на румынском языке.

<DT>Петер Фехер (Peter Feher)
<DD>
Сообщения об ошибках на венгерском языке.

<DT>Роберто М. Серкуейра (Roberto M. Serqueira)
<DD>
Сообщения об ошибках на португальском языке.

<DT>Карстен Х. Педерсен (Carsten H. Pedersen)
<DD>
Сообщения об ошибках на датском языке.

<DT>Арйен Дж. Ленц (Arjen G. Lentz)
<DD>
Сооббщения об ошибках на немецком языке, завершение ранее начатого перевода.

<DT>Дэвид Сеседоут (David Sacerdote) <a HREF="mailto:davids@secnet.com">davids@secnet.com</a>
<DD>
Идеи по проверке безопасности DNS-имен хостов.

<DT>Вэй-Джу Чен (Wei-Jou Chen) <a HREF="mailto:jou@nematic.ieo.nctu.edu.tw">jou@nematic.ieo.nctu.edu.tw</a>
<DD>
Поддержка китайских символов (BIG5).

<DT>Вэй Хи (Wei He) <a HREF="mailto:hewei@mail.ied.ac.cn">hewei@mail.ied.ac.cn</a>
<DD>
Большое количество функциональных возможностей для китайской (GBK)
кодировки.

<DT>Зеев Зураски (Zeev Suraski) <a HREF="mailto:bourbon@netvision.net.il">bourbon@netvision.net.il</a>
<DD>
Форматирование значений времени в <code>FROM_UNIXTIME()</code>, функции <code>ENCRYPT()</code>;
кроме того, он является консультантом по <code>bison</code>. Активный член списка
рассылки.

<DT>Лук де Боуер (Luuk de Boer) <a HREF="mailto:luuk@wxs.nl">luuk@wxs.nl</a>
<DD>
Перенос (и расширение) набора тестов производительности для <code>DBI</code>/<code>DBD</code>.
Оказал большую помощь по тестам <code>crash-me</code> и тестам производительности.
Некоторые новые функции даты. Скрипт <code>mysql_setpermissions</code>.

<DT>Джей Флагерти (Jay Flaherty) <a HREF="mailto:fty@mediapulse.com">fty@mediapulse.com</a>
<DD>
Большая часть раздела <code>DBI</code>/<code>DBD</code> в этом руководстве.

<DT>Пол Саузвортс (Paul Southworth) <a HREF="mailto:pauls@etext.org">pauls@etext.org</a>, Рэй Лоуйзага (Ray
<DD>
Loyzaga) <a HREF="mailto:yar@cs.su.oz.au">yar@cs.su.oz.au</a> 
Корректура данного справочного руководства на английском языке.

<DT>Алексей Михайлов (Alexis Mikhailov) <a HREF="mailto:root@medinf.chuvashia.su">root@medinf.chuvashia.su</a>
<DD>
Определяемые пользователем функции (UDF); функции <code>CREATE</code> и <code>DROP</code>.

<DT>Андреас Бобак (Andreas F. Bobak) <a HREF="mailto:bobak@relog.ch">bobak@relog.ch</a>
<DD>
Расширение <code>AGGREGATE</code> к функциям UDF.

<DT>Росс Уэйклин (Ross Wakelin) <a HREF="mailto:R.Wakelin@march.co.uk">R.Wakelin@march.co.uk</a>
<DD>
Помощь в установке InstallShield для MySQL-Win32.

<DT>Джетро Райт III (Jethro Wright III) <a HREF="mailto:jetman@li.net">jetman@li.net</a>
<DD>
Библиотека <tt>`libmysql.dll'</tt>.

<DT>Джеймс Перейра (James Pereria) <a HREF="mailto:jpereira@iafrica.com">jpereira@iafrica.com</a>
<DD>
Mysqlmanager, Win32 GUI-программа для администрирования сервера MySQL.

<DT>Курт Сэмпсон (Curt Sampson) <a HREF="mailto:cjs@portal.ca">cjs@portal.ca</a>
<DD>
Перенос потоков MIT-pthreads на NetBSD/Alpha и NetBSD 1.3/i386.

<DT>Энтони Т. Куртис (Antony T. Curtis) <a HREF="mailto:antony.curtis@olcs.net">antony.curtis@olcs.net</a>
<DD>
Перенос программного обеспечения базы данных MySQL на OS/2.

<DT>Мартин Рамш (Martin Ramsch) <a HREF="mailto:m.ramsch@computer.org">m.ramsch@computer.org</a>
<DD>
Примеры в учебнике MySQL.

<DT>Стив Харвей (Steve Harvey)
<DD>
Благодарность за более безопасное выполнение <code>mysqlaccess</code>.

<DT>Конарк IA-64, Центр устойчивых систем, частная компания с ограниченной
<DD>
ответственностью (Konark IA-64 Centre of Persistent Systems Private
Limited)
<a HREF="http://www.pspl.co.in/konark/">http://www.pspl.co.in/konark/</a>.
Помощь в переносе сервера MySQL на Win64.

<DT>Алберт Чин-Эй-Янг (Albert Chin-A-Young).
<DD>
Конфигурирование обновлений для Tru64, поддержка больших файлов и
улучшенная поддержка оболочек TCP.

<DT>Джон Бирел (John Birrell)
<DD>
Эмуляция pthread_mutex() для OS/2.

<DT>Бенджамин Пфлюгманн (Benjamin Pflugmann)
<DD>
Расширение таблиц <code>MERGE</code> для обработки запросов <code>INSERT</code>. Активный член
списков рассылки MySQL.

<DT>Гильем Бишо (Guilhem Bichot)
<DD>
Исправление трактовки показателя степени для <code>DECIMAL</code>.
Автор <code>mysql_tableinfo</code>.

<DT>Джоселин Фурнье (Jocelyn Fournier)
<DD>
Отличное исследование и описание бесчисленного количества ошибок (особенно в
коде вложенных запросов в MySQL 4.1)

<DT>Джордж Ричтер (Georg Richter)
<DD>
Тестирование и выявление ошибок в MySQL 4.1
Новое PHP 5.0 расширение <code>mysqli</code> (API) для использования с MySQL 4.1 и выше.

<DT>Марк Лиянаж (Marc Liyanage)
<DD>
Поддерживает пакеты для Mac OS X и дает бесценную информацию о том, как создавать
PKG для Mac OS X. 
</DL>

<P>
Другие помощники, те, кто нашел ошибки, и тестировщики: Джеймс Х. Томпсон
(James  H. Thompson), Морицио Менгини (Maurizio  Menghini), Войцех Трик
(Wojciech  Tryc), Лука Берра (Luca  Berra), Зарко Мокник (Zarko  Mocnik),
Уим Бонис (Wim  Bonis), Элмар Хейнке (Elmar  Haneke), <a HREF="mailto:jehamby@lightside">jehamby@lightside</a>,
<a HREF="mailto:psmith@BayNetworks.com">psmith@BayNetworks.com</a>, <a HREF="mailto:duane@connect.com.au">duane@connect.com.au</a>, Тед Депнер (Ted  Deppner)
<a HREF="mailto:ted@psyber.com">ted@psyber.com</a>, Майк Саймонс (Mike  Simons), Джакко Хайватти (Jaakko 
Hyvatti).

</P>
<P>
Наша благодарность - за множество сообщений об ошибках и их исправлениях
от участников списка рассылки.

</P>
<P>
Огромное уважение - тем, кто помогает нам отвечать на вопросы списка
рассылки <a HREF="mailto:mysql@lists.mysql.com">mysql@lists.mysql.com</a>:

</P>
<DL COMPACT>

<DT>Дэниэл Кох (Daniel Koch) <a HREF="mailto:dkoch@amcity.com">dkoch@amcity.com</a>
<DD>
Установка Irix.

<DT>Лук де Боуер (Luuk de Boer) <a HREF="mailto:luuk@wxs.nl">luuk@wxs.nl</a>
<DD>
Вопросы по тестам производительности.

<DT>Тим Сэйлер (Tim Sailer) <a HREF="mailto:tps@users.buoy.com">tps@users.buoy.com</a>
<DD>
Вопросы по <code>DBD-mysql</code>.

<DT>Бойд Лин Гербер (Boyd Lynn Gerber) <a HREF="mailto:gerberb@zenez.com">gerberb@zenez.com</a>
<DD>
Вопросы, относящиеся к SCO.

<DT>Ричард Мехелик (Richard Mehalick) <a HREF="mailto:RM186061@shellus.com">RM186061@shellus.com</a>
<DD>
Вопросы, относящиеся к <code>xmysql</code>, и вопросы базовой инсталляции.

<DT>Зеев Зураски (Zeev  Suraski) <a HREF="mailto:bourbon@netvision.net.il">bourbon@netvision.net.il</a>
<DD>
Вопросы по конфигурации модулей Apache (log &#38; auth), вопросы, относящиеся
к PHP, синтаксису SQL и другие общие вопросы.

<DT>Франциск Гуаш (Francesc Guasch) <a HREF="mailto:frankie@citel.upc.es">frankie@citel.upc.es</a>
<DD>
Общие вопросы.

<DT>Джонатан Дж Смит (Jonathan J Smith) <a HREF="mailto:jsmith@wtp.net">jsmith@wtp.net</a>
<DD>
Вопросы, относящиеся к специфике операционных систем Linux, синтаксису SQL
и другим вещам, которые могут понадобиться в работе.

<DT>Дэвид Склар (David Sklar) <a HREF="mailto:sklar@student.net">sklar@student.net</a>
<DD>
Использование MySQL совместно с PHP и Perl.

<DT>Элистер МакДоналд (Alistair MacDonald) <a HREF="mailto:A.MacDonald@uel.ac.uk">A.MacDonald@uel.ac.uk</a>
<DD>
Пока не определился, легко переходит к новым темам, может справиться с
Linux и, возможно, с HP-UX. Пытается заставить пользователей применять
<code>mysqlbug</code>.

<DT>Джон Лайен (John Lyon) <a HREF="mailto:jlyon@imag.net">jlyon@imag.net</a>
<DD>
Вопросы по инсталляции MySQL на системах Linux с использованием либо
файлов <tt>`.rpm'</tt>, либо компиляции из исходного кода.

<DT>Лорвид Лтд. (Lorvid Ltd.) <a HREF="mailto:lorvid@WOLFENET.com">lorvid@WOLFENET.com</a>
<DD>
Простые вопросы выписки счетов, лицензии, поддержки, авторских прав.

<DT>Патрик Шерил (Patrick Sherrill) <a HREF="mailto:patrick@coconet.com">patrick@coconet.com</a>
<DD>
Вопросы по ODBC и интерфейсу VisualC++.

<DT>Рэнди Хармон (Randy Harmon) <a HREF="mailto:rjharmon@uptimecomputers.com">rjharmon@uptimecomputers.com</a>
<DD>
Вопросы по <code>DBD</code>, Linux, некоторые вопросы по синтаксису SQL.
</DL>



<H2><A NAME="Supporters" HREF="manual.ru_toc.html#Supporters">B.3  Спонсоры MySQL</A></H2>

<P>
<A NAME="IDX1788"></A>

</P>
<P>
В то время как <code>MySQL AB</code> обладает всеми авторскими правами на <code>сервер MySQL</code> 
и <code>документацию по MySQL</code>, мы хотим отдать дань уважения следующим
компаниям, оказывавшим нам финансовую помощь в разработке MySQL, такую как
оплата разработки новых возможностей или снабжение техническими
средствами.

</P>
<DL COMPACT>

<DT>VA Linux / Andover.net
<DD>
Финансирование репликации.
<DT>NuSphere
<DD>
Редактирование руководства по MySQL.
<DT>Студия Stork Design (Stork Design studio)
<DD>
Веб-сайт MySQL, использовавшийся в 1998-2000гг.
<DT>Intel
<DD>
Эта компания внесла вклад в разработку для платформ Windows и Linux.
<DT>Compaq
<DD>
Эта компания внесла вклад в разработку для Linux/Alpha.
<DT>SWSoft
<DD>
Разработка встроенной версии <code>mysqld</code>.
<DT>FutureQuest
<DD>
<code>--skip-show-databasea</code> 
</DL>



<H1><A NAME="News" HREF="manual.ru_toc.html#News">C  История изменений и обновлений MySQL</A></H1>

<P>
Раздел в стадии перевода. 

</P>



<H2><A NAME="News-4.1.x" HREF="manual.ru_toc.html#News-4.1.x">C.1  Изменения в версии 4.1.x (Alpha)</A></H2>

<P>
Раздел в стадии перевода.

</P>



<H3><A NAME="News-4.1.0" HREF="manual.ru_toc.html#News-4.1.0">C.1.1  Изменения в версии 4.1.0</A></H3>

<P>
Раздел в стадии перевода.

</P>


<H2><A NAME="News-4.0.x" HREF="manual.ru_toc.html#News-4.0.x">C.2  Изменения в версии 4.0.x (В разработке; Альфа)</A></H2>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-4.0.2" HREF="manual.ru_toc.html#News-4.0.2">C.2.1  Изменения в версии 4.0.2</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-4.0.1" HREF="manual.ru_toc.html#News-4.0.1">C.2.2  Изменения в версии 4.0.1 (23 Дек 2001)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-4.0.0" HREF="manual.ru_toc.html#News-4.0.0">C.2.3  Изменения в версии 4.0.0 (Окт 2001: Альфа)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H2><A NAME="News-3.23.x" HREF="manual.ru_toc.html#News-3.23.x">C.3  Изменения в версии 3.23.x  (Стабильная)</A></H2>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.52" HREF="manual.ru_toc.html#News-3.23.52">C.3.1  Изменения в версии 3.23.52</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.51" HREF="manual.ru_toc.html#News-3.23.51">C.3.2  Изменения в версии 3.23.51 (31 Май 2002)</A></H3>

<P>
Раздел в стадии перевода. 

</P>


<H3><A NAME="News-3.23.50" HREF="manual.ru_toc.html#News-3.23.50">C.3.3  Изменения в версии 3.23.50 (21 Апр 2002)</A></H3>

<P>
Раздел в стадии перевода. 

</P>


<H3><A NAME="News-3.23.49" HREF="manual.ru_toc.html#News-3.23.49">C.3.4  Изменения в версии 3.23.49</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.48" HREF="manual.ru_toc.html#News-3.23.48">C.3.5  Изменения в версии 3.23.48 (07 Фев 2002)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.47" HREF="manual.ru_toc.html#News-3.23.47">C.3.6  Изменения в версии 3.23.47 (27 Дек 2001)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.46" HREF="manual.ru_toc.html#News-3.23.46">C.3.7  Изменения в версии 3.23.46 (29 Ноя 2001)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.45" HREF="manual.ru_toc.html#News-3.23.45">C.3.8  Изменения в версии 3.23.45 (22 Ноя 2001)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.44" HREF="manual.ru_toc.html#News-3.23.44">C.3.9  Изменения в версии 3.23.44 (31 Окт 2001)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.43" HREF="manual.ru_toc.html#News-3.23.43">C.3.10  Изменения в версии 3.23.43</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.42" HREF="manual.ru_toc.html#News-3.23.42">C.3.11  Изменения в версии 3.23.42 (08 Сен 2001)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.41" HREF="manual.ru_toc.html#News-3.23.41">C.3.12  Изменения в версии 3.23.41 (11 Авг 2001)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.40" HREF="manual.ru_toc.html#News-3.23.40">C.3.13  Изменения в версии 3.23.40</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.39" HREF="manual.ru_toc.html#News-3.23.39">C.3.14  Изменения в версии 3.23.39 (12 Июн 2001)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.38" HREF="manual.ru_toc.html#News-3.23.38">C.3.15  Изменения в версии 3.23.38 (09 Май 2001)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.37" HREF="manual.ru_toc.html#News-3.23.37">C.3.16  Изменения в версии 3.23.37 (17 Апр 2001)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.36" HREF="manual.ru_toc.html#News-3.23.36">C.3.17  Изменения в версии 3.23.36 (27 Мар 2001)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.35" HREF="manual.ru_toc.html#News-3.23.35">C.3.18  Изменения в версии 3.23.35 (15 Мар 2001)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.34a" HREF="manual.ru_toc.html#News-3.23.34a">C.3.19  Изменения в версии 3.23.34a</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.34" HREF="manual.ru_toc.html#News-3.23.34">C.3.20  Изменения в версии 3.23.34 (10 Мар 2001)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.33" HREF="manual.ru_toc.html#News-3.23.33">C.3.21  Изменения в версии 3.23.33 (09 Фев 2001)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.32" HREF="manual.ru_toc.html#News-3.23.32">C.3.22  Изменения в версии 3.23.32 (22 Янв 2001: Стабильная)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.31" HREF="manual.ru_toc.html#News-3.23.31">C.3.23  Изменения в версии 3.23.31 (17 Янв 2001)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.30" HREF="manual.ru_toc.html#News-3.23.30">C.3.24  Изменения в версии 3.23.30 (04 Янв 2001)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.29" HREF="manual.ru_toc.html#News-3.23.29">C.3.25  Изменения в версии 3.23.29 (16 Дек 2000)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.28" HREF="manual.ru_toc.html#News-3.23.28">C.3.26  Изменения в версии 3.23.28 (22 Ноя 2000: Гамма)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.27" HREF="manual.ru_toc.html#News-3.23.27">C.3.27  Изменения в версии 3.23.27 (24 Окт 2000)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.26" HREF="manual.ru_toc.html#News-3.23.26">C.3.28  Изменения в версии 3.23.26</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.25" HREF="manual.ru_toc.html#News-3.23.25">C.3.29  Изменения в версии 3.23.25</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.24" HREF="manual.ru_toc.html#News-3.23.24">C.3.30  Изменения в версии 3.23.24 (08 Сен 2000)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.23" HREF="manual.ru_toc.html#News-3.23.23">C.3.31  Изменения в версии 3.23.23</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.22" HREF="manual.ru_toc.html#News-3.23.22">C.3.32  Изменения в версии 3.23.22 (31 Июл 2000)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.21" HREF="manual.ru_toc.html#News-3.23.21">C.3.33  Изменения в версии 3.23.21</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.20" HREF="manual.ru_toc.html#News-3.23.20">C.3.34  Изменения в версии 3.23.20</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.19" HREF="manual.ru_toc.html#News-3.23.19">C.3.35  Изменения в версии 3.23.19</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.18" HREF="manual.ru_toc.html#News-3.23.18">C.3.36  Изменения в версии 3.23.18</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.17" HREF="manual.ru_toc.html#News-3.23.17">C.3.37  Изменения в версии 3.23.17</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.16" HREF="manual.ru_toc.html#News-3.23.16">C.3.38  Изменения в версии 3.23.16</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.15" HREF="manual.ru_toc.html#News-3.23.15">C.3.39  Изменения в версии 3.23.15 (Май 2000: Бета)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.14" HREF="manual.ru_toc.html#News-3.23.14">C.3.40  Изменения в версии 3.23.14</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.13" HREF="manual.ru_toc.html#News-3.23.13">C.3.41  Изменения в версии 3.23.13</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.12" HREF="manual.ru_toc.html#News-3.23.12">C.3.42  Изменения в версии 3.23.12</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.11" HREF="manual.ru_toc.html#News-3.23.11">C.3.43  Изменения в версии 3.23.11</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.10" HREF="manual.ru_toc.html#News-3.23.10">C.3.44  Изменения в версии 3.23.10</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.9" HREF="manual.ru_toc.html#News-3.23.9">C.3.45  Изменения в версии 3.23.9</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.8" HREF="manual.ru_toc.html#News-3.23.8">C.3.46  Изменения в версии 3.23.8</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.7" HREF="manual.ru_toc.html#News-3.23.7">C.3.47  Изменения в версии 3.23.7</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.6" HREF="manual.ru_toc.html#News-3.23.6">C.3.48  Изменения в версии 3.23.6</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.5" HREF="manual.ru_toc.html#News-3.23.5">C.3.49  Изменения в версии 3.23.5</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.4" HREF="manual.ru_toc.html#News-3.23.4">C.3.50  Изменения в версии 3.23.4</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.3" HREF="manual.ru_toc.html#News-3.23.3">C.3.51  Изменения в версии 3.23.3</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.2" HREF="manual.ru_toc.html#News-3.23.2">C.3.52  Изменения в версии 3.23.2</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.1" HREF="manual.ru_toc.html#News-3.23.1">C.3.53  Изменения в версии 3.23.1</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.23.0" HREF="manual.ru_toc.html#News-3.23.0">C.3.54  Изменения в версии 3.23.0 (Сен 1999: Альфа)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H2><A NAME="News-3.22.x" HREF="manual.ru_toc.html#News-3.22.x">C.4  Изменения в версии 3.22.x (Старая; все еще поддерживается)</A></H2>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.35" HREF="manual.ru_toc.html#News-3.22.35">C.4.1  Изменения в версии 3.22.35</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.34" HREF="manual.ru_toc.html#News-3.22.34">C.4.2  Изменения в версии 3.22.34</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.33" HREF="manual.ru_toc.html#News-3.22.33">C.4.3  Изменения в версии 3.22.33</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.32" HREF="manual.ru_toc.html#News-3.22.32">C.4.4  Изменения в версии 3.22.32</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.31" HREF="manual.ru_toc.html#News-3.22.31">C.4.5  Изменения в версии 3.22.31</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.30" HREF="manual.ru_toc.html#News-3.22.30">C.4.6  Изменения в версии 3.22.30</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.29" HREF="manual.ru_toc.html#News-3.22.29">C.4.7  Изменения в версии 3.22.29</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.28" HREF="manual.ru_toc.html#News-3.22.28">C.4.8  Изменения в версии 3.22.28</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.27" HREF="manual.ru_toc.html#News-3.22.27">C.4.9  Изменения в версии 3.22.27</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.26" HREF="manual.ru_toc.html#News-3.22.26">C.4.10  Изменения в версии 3.22.26</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.25" HREF="manual.ru_toc.html#News-3.22.25">C.4.11  Изменения в версии 3.22.25</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.24" HREF="manual.ru_toc.html#News-3.22.24">C.4.12  Изменения в версии 3.22.24</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.23" HREF="manual.ru_toc.html#News-3.22.23">C.4.13  Изменения в версии 3.22.23</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.22" HREF="manual.ru_toc.html#News-3.22.22">C.4.14  Изменения в версии 3.22.22</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.21" HREF="manual.ru_toc.html#News-3.22.21">C.4.15  Изменения в версии 3.22.21</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.20" HREF="manual.ru_toc.html#News-3.22.20">C.4.16  Изменения в версии 3.22.20</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.19" HREF="manual.ru_toc.html#News-3.22.19">C.4.17  Изменения в версии 3.22.19 (Мар 1999: Стабильная)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.18" HREF="manual.ru_toc.html#News-3.22.18">C.4.18  Изменения в версии 3.22.18</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.17" HREF="manual.ru_toc.html#News-3.22.17">C.4.19  Изменения в версии 3.22.17</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.16" HREF="manual.ru_toc.html#News-3.22.16">C.4.20  Изменения в версии 3.22.16 (Фев 1999: Гамма)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.15" HREF="manual.ru_toc.html#News-3.22.15">C.4.21  Изменения в версии 3.22.15</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.14" HREF="manual.ru_toc.html#News-3.22.14">C.4.22  Изменения в версии 3.22.14</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.13" HREF="manual.ru_toc.html#News-3.22.13">C.4.23  Изменения в версии 3.22.13</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.12" HREF="manual.ru_toc.html#News-3.22.12">C.4.24  Изменения в версии 3.22.12</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.11" HREF="manual.ru_toc.html#News-3.22.11">C.4.25  Изменения в версии 3.22.11</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.10" HREF="manual.ru_toc.html#News-3.22.10">C.4.26  Изменения в версии 3.22.10</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.9" HREF="manual.ru_toc.html#News-3.22.9">C.4.27  Изменения в версии 3.22.9</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.8" HREF="manual.ru_toc.html#News-3.22.8">C.4.28  Изменения в версии 3.22.8</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.7" HREF="manual.ru_toc.html#News-3.22.7">C.4.29  Изменения в версии 3.22.7 (Сен 1998: Бета)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.6" HREF="manual.ru_toc.html#News-3.22.6">C.4.30  Изменения в версии 3.22.6</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.5" HREF="manual.ru_toc.html#News-3.22.5">C.4.31  Изменения в версии 3.22.5</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.4" HREF="manual.ru_toc.html#News-3.22.4">C.4.32  Изменения в версии 3.22.4</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.3" HREF="manual.ru_toc.html#News-3.22.3">C.4.33  Изменения в версии 3.22.3</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.2" HREF="manual.ru_toc.html#News-3.22.2">C.4.34  Изменения в версии 3.22.2</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.1" HREF="manual.ru_toc.html#News-3.22.1">C.4.35  Изменения в версии 3.22.1 (Июн 1998: Альфа)</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.22.0" HREF="manual.ru_toc.html#News-3.22.0">C.4.36  Изменения в версии 3.22.0</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H2><A NAME="News-3.21.x" HREF="manual.ru_toc.html#News-3.21.x">C.5  Изменения в версии 3.21.x</A></H2>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.33" HREF="manual.ru_toc.html#News-3.21.33">C.5.1  Изменения в версии 3.21.33</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.32" HREF="manual.ru_toc.html#News-3.21.32">C.5.2  Изменения в версии 3.21.32</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.31" HREF="manual.ru_toc.html#News-3.21.31">C.5.3  Изменения в версии 3.21.31</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.30" HREF="manual.ru_toc.html#News-3.21.30">C.5.4  Изменения в версии 3.21.30</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.29" HREF="manual.ru_toc.html#News-3.21.29">C.5.5  Изменения в версии 3.21.29</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.28" HREF="manual.ru_toc.html#News-3.21.28">C.5.6  Изменения в версии 3.21.28</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.27" HREF="manual.ru_toc.html#News-3.21.27">C.5.7  Изменения в версии 3.21.27</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.26" HREF="manual.ru_toc.html#News-3.21.26">C.5.8  Изменения в версии 3.21.26</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.25" HREF="manual.ru_toc.html#News-3.21.25">C.5.9  Изменения в версии 3.21.25</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.24" HREF="manual.ru_toc.html#News-3.21.24">C.5.10  Изменения в версии 3.21.24</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.23" HREF="manual.ru_toc.html#News-3.21.23">C.5.11  Изменения в версии 3.21.23</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.22" HREF="manual.ru_toc.html#News-3.21.22">C.5.12  Изменения в версии 3.21.22</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.21a" HREF="manual.ru_toc.html#News-3.21.21a">C.5.13  Изменения в версии 3.21.21a</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.21" HREF="manual.ru_toc.html#News-3.21.21">C.5.14  Изменения в версии 3.21.21</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.20" HREF="manual.ru_toc.html#News-3.21.20">C.5.15  Изменения в версии 3.21.20</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.19" HREF="manual.ru_toc.html#News-3.21.19">C.5.16  Изменения в версии 3.21.19</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.18" HREF="manual.ru_toc.html#News-3.21.18">C.5.17  Изменения в версии 3.21.18</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.17" HREF="manual.ru_toc.html#News-3.21.17">C.5.18  Изменения в версии 3.21.17</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.16" HREF="manual.ru_toc.html#News-3.21.16">C.5.19  Изменения в версии 3.21.16</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.15" HREF="manual.ru_toc.html#News-3.21.15">C.5.20  Изменения в версии 3.21.15</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.14b" HREF="manual.ru_toc.html#News-3.21.14b">C.5.21  Изменения в версии 3.21.14b</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.14a" HREF="manual.ru_toc.html#News-3.21.14a">C.5.22  Изменения в версии 3.21.14a</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.13" HREF="manual.ru_toc.html#News-3.21.13">C.5.23  Изменения в версии 3.21.13</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.12" HREF="manual.ru_toc.html#News-3.21.12">C.5.24  Изменения в версии 3.21.12</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.11" HREF="manual.ru_toc.html#News-3.21.11">C.5.25  Изменения в версии 3.21.11</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.10" HREF="manual.ru_toc.html#News-3.21.10">C.5.26  Изменения в версии 3.21.10</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.9" HREF="manual.ru_toc.html#News-3.21.9">C.5.27  Изменения в версии 3.21.9</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.8" HREF="manual.ru_toc.html#News-3.21.8">C.5.28  Изменения в версии 3.21.8</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.7" HREF="manual.ru_toc.html#News-3.21.7">C.5.29  Изменения в версии 3.21.7</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.6" HREF="manual.ru_toc.html#News-3.21.6">C.5.30  Изменения в версии 3.21.6</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.5" HREF="manual.ru_toc.html#News-3.21.5">C.5.31  Изменения в версии 3.21.5</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.4" HREF="manual.ru_toc.html#News-3.21.4">C.5.32  Изменения в версии 3.21.4</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.3" HREF="manual.ru_toc.html#News-3.21.3">C.5.33  Изменения в версии 3.21.3</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.2" HREF="manual.ru_toc.html#News-3.21.2">C.5.34  Изменения в версии 3.21.2</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.21.0" HREF="manual.ru_toc.html#News-3.21.0">C.5.35  Изменения в версии 3.21.0</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H2><A NAME="News-3.20.x" HREF="manual.ru_toc.html#News-3.20.x">C.6  Изменения в версии 3.20.x</A></H2>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.20.18" HREF="manual.ru_toc.html#News-3.20.18">C.6.1  Изменения в версии 3.20.18</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.20.17" HREF="manual.ru_toc.html#News-3.20.17">C.6.2  Изменения в версии 3.20.17</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.20.16" HREF="manual.ru_toc.html#News-3.20.16">C.6.3  Изменения в версии 3.20.16</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.20.15" HREF="manual.ru_toc.html#News-3.20.15">C.6.4  Изменения в версии 3.20.15</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.20.14" HREF="manual.ru_toc.html#News-3.20.14">C.6.5  Изменения в версии 3.20.14</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.20.13" HREF="manual.ru_toc.html#News-3.20.13">C.6.6  Изменения в версии 3.20.13</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.20.11" HREF="manual.ru_toc.html#News-3.20.11">C.6.7  Изменения в версии 3.20.11</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.20.10" HREF="manual.ru_toc.html#News-3.20.10">C.6.8  Изменения в версии 3.20.10</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.20.9" HREF="manual.ru_toc.html#News-3.20.9">C.6.9  Изменения в версии 3.20.9</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.20.8" HREF="manual.ru_toc.html#News-3.20.8">C.6.10  Изменения в версии 3.20.8</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.20.7" HREF="manual.ru_toc.html#News-3.20.7">C.6.11  Изменения в версии 3.20.7</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.20.6" HREF="manual.ru_toc.html#News-3.20.6">C.6.12  Изменения в версии 3.20.6</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.20.3" HREF="manual.ru_toc.html#News-3.20.3">C.6.13  Изменения в версии 3.20.3</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.20.0" HREF="manual.ru_toc.html#News-3.20.0">C.6.14  Изменения в версии 3.20.0</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H2><A NAME="News-3.19.x" HREF="manual.ru_toc.html#News-3.19.x">C.7  Изменения в версии 3.19.x</A></H2>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.19.5" HREF="manual.ru_toc.html#News-3.19.5">C.7.1  Изменения в версии 3.19.5</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.19.4" HREF="manual.ru_toc.html#News-3.19.4">C.7.2  Изменения в версии 3.19.4</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H3><A NAME="News-3.19.3" HREF="manual.ru_toc.html#News-3.19.3">C.7.3  Изменения в версии 3.19.3</A></H3>

<P>
Раздел в стадии перевода. 

</P>



<H1><A NAME="Porting" HREF="manual.ru_toc.html#Porting">D  Перенос на другие системы</A></H1>

<P>
<A NAME="IDX1789"></A>
<A NAME="IDX1790"></A>
<A NAME="IDX1791"></A>

</P>

<P>
Цель данного раздела - обеспечить помощь в переносе MySQL на другие
операционные системы. Но сначала необходимо ознакомиться со списком
поддерживаемых в настоящее время операционных систем (see section <A HREF="manual.ru.html#Which_OS">2.2.5  Операционные системы, поддерживаемые MySQL</A>). Если вы создали новую версию переноса
MySQL, пожалуйста, сообщите нам - тогда мы включим ее в настоящий список и
в список на нашем веб-сайте (<a HREF="http://www.mysql.com/">http://www.mysql.com/</a>) и сможем рекомендовать
ее другим пользователям.

</P>
<P>
Примечание: те, кто создаст новую версию переноса MySQL, имеют право
размножать и распространять на условиях лицензии GPL, но это не делает их
обладателями авторского права на MySQL.

</P>
<P>
Для сервера необходима рабочая библиотека Posix-потоков. Под операционной
системой Solaris 2.5 мы используем потоки Sun  PThreads ("родная"
поддержка потоков в версии 2.4 и более ранних не является достаточно
хорошей), а под Linux мы используем LinuxThreads, разработку Ксавье Лероя
(Xavier  Leroy, <a HREF="mailto:Xavier.Leroy@inria.fr">Xavier.Leroy@inria.fr</a>).

</P>
<P>
При переносе на новый вариант Unix без хорошей поддержки собственных
потоков наиболее трудной частью является перенос потоков MIT-pthreads. См.
<tt>`mit-pthreads/README'</tt>  и Programming POSIX Threads (Программирование 
POSIX-потоков) (<a HREF="http://www.humanfactor.com/pthreads/">http://www.humanfactor.com/pthreads/</a>).

</P>
<P>
В состав поставки MySQL входит исправленная версия Pthreads Провензано
(Provenzano) от MIT (см. веб-страницу MIT  Pthreads на
<a HREF="http://www.mit.edu:8001/people/proven/pthreads.html">http://www.mit.edu:8001/people/proven/pthreads.html</a>). Эту версию можно
применять для операционных систем, не имеющих POSIX-потоков.

</P>
<P>
Можно использовать и другой пакет потоков пользовательского уровня - FSU
Pthreads (<a HREF="http://www.informatik.hu-berlin.de/~mueller/pthreads.html">
страница FSU Pthreads</a>). Эта реализация применяется для переноса SCO.

</P>
<P>
Для ознакомления этими проблемами и анализа их следует изучить программы
<tt>`thr_lock.c'</tt> и <tt>`thr_alarm.c'</tt> в каталоге <tt>`mysys'</tt>.

</P>
<P>
И сервер, и клиент нуждаются в работающем компиляторе C++ (мы используем
<code>gcc</code>, испытывали также SPARCworks). Еще одним работающим компилятором
является Irix  <code>cc</code>.

</P>
<P>
Для компиляции только клиентской части используйте 
<code>./configure --without-server</code>.

</P>
<P>
Компиляция отдельно серверной части в настоящее время не поддерживается, и
добавлять такую возможность не планируется до тех пор, пока для этого не
будет веских оснований.

</P>
<P>
Если необходимо изменить любой <tt>`Makefile'</tt> или скрипт конфигурации, следует
использовать <code>Automake</code> и <code>Autoconf</code>. Мы применяли версии <code>automake-1.2</code> и
<code>autoconf-2.12</code>.

</P>
<P>
Ниже перечислены действия, необходимые для того, чтобы собрать все заново
из базовых файлов:

</P>

<PRE>
/bin/rm */.deps/*.P
/bin/rm -f config.cache
aclocal
autoheader
aclocal
automake
autoconf
./configure --with-debug=full --prefix='your installation directory'

# makefiles были сгенерированы для GNU make 3.75 или более новой,
# обозначенной как gmake строчкой ниже

gmake clean all install init-db
</PRE>

<P>
Если вы столкнетесь с проблемами новой версии переноса, то, возможно,
потребуется произвести некоторую отладку MySQL! See section <A HREF="manual.ru.html#Debugging_server">D.1  Отладка сервера MySQL</A>.

</P>
<P>
<strong>Примечание:</strong> прежде чем запускать отладку <code>mysqld</code>, нужно добиться, чтобы
заработала тестовая программа <tt>`mysys/thr_alarm'</tt>  and  <tt>`mysys/thr_lock'</tt>, -
тогда у вас появится хотя бы призрачный шанс получить рабочие потоки.

</P>



<H2><A NAME="Debugging_server" HREF="manual.ru_toc.html#Debugging_server">D.1  Отладка сервера MySQL</A></H2>

<P>
Если вы используете в MySQL совершенно новую функциональную возможность,
то можно попробовать запустить <code>mysqld</code> с параметром <code>--skip-new</code> (при этом
все новые, потенциально ненадежные функции будут заблокированы) или с
параметром <code>--safe-mode</code> - он отключает ряд оптимизаций, которые могут
вызвать проблемы. See section <A HREF="manual.ru.html#Crashing">A.4.1  Что делать, если работа MySQL сопровождается постоянными сбоями</A>.

</P>
<P>
Если <code>mysqld</code> не хочет стартовать, то необходимо посмотреть, не влияют ли на
ваши настройки какие-либо конфигурационные файлы! Вы можете проверить
аргументы файла <tt>`my.cnf'</tt> с помощью <code>mysqld --print-defaults</code> и, чтобы
запретить их использование, стартовать <code>mysqld</code>  с параметром <code>--no-defaults ....</code>

</P>
<P>
Если для запуска <code>mysqld</code> требуется большое количество ресурсов центрального
процессора или памяти, а также в случае зависания программы можно
использовать команду <code>mysqladmin processlist status</code>. Эта команда позволит
определить, какой именно запрос требует столь длительного времени
выполнения. При изучении проблем, связанных с производительностью или
трудностями при подсоединении новых клиентов, иногда полезно запустить
команду <code>mysqladmin -i10 processlist status</code> в другом окне.

</P>
<P>
Команда <code>mysqladmin debug</code> выводит в журнальный файл информацию о
применяемых блокировках, используемой памяти и работе с запросами запросов
- возможно, это поможет вам решить некоторые проблемы. Данная команда
снабдит вас полезной информацией даже в том случае, если код MySQL не был
скомпилирован для отладки!

</P>
<P>
Если проблема заключается в том, что некоторые таблицы справляются с
работой все медленнее и медленнее, то такие таблицы необходимо попробовать
оптимизировать с помощью команды <code>OPTIMIZE TABLE</code> или <code>myisamchk</code>. 
See section <A HREF="manual.ru.html#MySQL_Database_Administration">4  Администрирование баз данных</A>. Для проверки медленных запросов можно также
использовать <code>EXPLAIN</code>.

</P>
<P>
Кроме того, чтобы решить уникальные для конкретных условий эксплуатации
проблемы, необходимо изучить раздел данного руководства, в котором
описывается специфика определенной операционной системы. 
See section <A HREF="manual.ru.html#Operating_System_Specific_Notes">2.6  Заметки по операционным системам</A>.

</P>



<H3><A NAME="Compiling_for_debugging" HREF="manual.ru_toc.html#Compiling_for_debugging">D.1.1  Компиляция MySQL для отладки</A></H3>

<P>
Иногда в случае каких-либо очень специфических проблем помогает отладка
MySQL. Для этого необходимо сконфигурировать сборку MySQL с параметрами
<code>--with-debug</code> или <code>--with-debug=full</code>. Чтобы проверить, был ли код MySQL
скомпилирован с возможностью отладки, нужно запустить команду: <code>mysqld
--help</code>. Если среди опций присутствует флаг <code>--debug</code>, то отладка доступна.
Кроме того, если задана возможность отладки, команда <code>mysqladmin ver</code>
выводит версию <code>mysqld</code> как <code>mysql ... --debug</code>.

</P>
<P>
При использовании компиляторов gcc или egcs рекомендуется следующая
конфигурационная строка:

</P>

<PRE>
CC=gcc CFLAGS="-O2" CXX=gcc CXXFLAGS="-O2 -felide-constructors \
   -fno-exceptions -fno-rtti" ./configure --prefix=/usr/local/mysql \
   --with-debug --with-extra-charsets=complex
</PRE>

<P>
Такая запись позволит избежать проблем с библиотекой <code>libstdc++</code> и
исключениями C++ (многие компиляторы имеют проблемы с исключениями C++ в
кодах потоков) и скомпилировать версию MySQL с поддержкой всех кодировок.

</P>
<P>
Если есть подозрение, что может возникнуть ошибка переполнения памяти, то
можно сконфигурировать MySQL с параметром <code>--with-debug=full</code>, чтобы
установить программу контроля выделения памяти (<code>SAFEMALLOC</code>). Однако
<code>SAFEMALLOC</code> замедляет работу системы, поэтому при возникновении проблем с
производительностью необходимо запустить <code>mysqld</code> с опцией
<code>--skip-safemalloc</code>. Эта опция заблокирует проверки переполнения памяти для
каждого вызова <code>malloc</code> и <code>free</code>.

</P>
<P>
Если <code>mysqld</code> перестает падать в аварийном режиме при компиляции ее с
параметром <code>--with-debug</code>, то, возможно, вы нашли ошибку в компиляторе или
произошла ошибка синхронизации внутри MySQL. В этом случае можно
попытаться добавить к переменным <code>CFLAGS</code> и <code>CXXFLAGS</code> в приведенной выше
конфигурационной строке <code>-g</code> и не использовать параметр <code>--with-debug</code>. Если
<code>mysqld</code> и после этого будет падать, то можно по меньшей мере подключить к
ней отладчик <code>gdb</code> или использовать <code>gdb</code> для core-файла, чтобы выяснить, что
происходит.

</P>
<P>
Если MySQL сконфигурирован для отладки, то автоматически становятся
доступными множество дополнительных функций контроля надежности, которые
отслеживают состояние <code>mysqld</code>. Если они обнаруживают что-либо
"неожиданное", то информация об этом будет записана в поток вывода
<code>stderr</code>, который <code>safe_mysqld</code> направит в журнал ошибок! Таким образом, если
возникают какие-либо неожиданные проблемы с MySQL и при этом доступен
исходный код дистрибутива, то первое, что необходимо сделать, -
сконфигурировать MySQL для отладки! (А второе необходимое действие - это,
конечно, послать письмо на <a HREF="mailto:mysql@lists.mysql.com">mysql@lists.mysql.com</a> и попросить помощи).
Пожалуйста, для всех сообщений о сбоях или вопросов относительно
используемой версии MySQL используйте скрипт <code>mysqlbug</code>!

</P>
<P>
В поставке MySQL для Windows файл <code>mysqld.exe</code> по умолчанию скомпилирован с
поддержкой трассировочных файлов.

</P>


<H3><A NAME="Making_trace_files" HREF="manual.ru_toc.html#Making_trace_files">D.1.2  Создание трассировочных файлов</A></H3>

<P>
Если сервер <code>mysqld</code> не запускается или если вы можете вызвать его скорую
аварийную остановку, то для выяснения причин неполадок можно попытаться
создать трассировочный файл.

</P>
<P>
Для этого необходимо иметь <code>mysqld</code>, скомпилированный для отладки.
Проверить, скомпилирован ли <code>mysqld</code> для отладки можно, выполнив <code>mysqld -V</code>.
Если номер данной версии заканчивается на <code>-debug</code>, то она скомпилирована с
поддержкой трассировочных файлов.

</P>
<P>
Запустите сервер <code>mysqld</code> с журналом трассировки в каталоге
<tt>`/tmp/mysqld.trace'</tt> (или <tt>`C:\mysqld.trace'</tt> под Windows):

</P>

<PRE>
mysqld --debug
</PRE>

<P>
Под Windows необходимо также использовать флаг <code>--standalone</code>, чтобы <code>mysqld</code>
не стартовал как сервис:

</P>
<P>
В окне DOS введите следующее:

</P>

<PRE>
mysqld --debug --standalone
</PRE>

<P>
После этого можно использовать клиента командной строки <code>mysql.exe</code> во
втором окне DOS, чтобы воспроизвести проблему. Для остановки описанного
выше сервера <code>mysqld</code> следует воспользоваться командой <code>mysqladmin shutdown</code>.

</P>
<P>
Следует учесть, что трассировочный файл получится очень большим! Чтобы
получить трассировочный файл меньшего размера, можно использовать
что-нибудь вроде:

</P>

<PRE>
mysqld --debug=d,info,error,query,general,where:O,/tmp/mysqld.trace
</PRE>

<P>
при этом в каталог <tt>`/tmp/mysqld.trace'</tt> будет выводиться только информация
с наиболее интересными для вас признаками.

</P>
<P>
Если вы создаете отчет о подобных ошибках, то, пожалуйста, присылайте в
соответствующий список рассылки только те строки из трассировочного файла,
которые, по вашему мнению, имеют непосредственное отношение к ошибке! Те
же, кто затрудняются определить место ошибки, могут загрузить на ftp
трассировочный файл вместе с отчетом об ошибках по адресу
<a HREF="ftp://support.mysql.com/pub/mysql/secret/">ftp://support.mysql.com/pub/mysql/secret/</a>, чтобы разработчики MySQL могли
взглянуть на него.

</P>
<P>
Трассировочный файл создается с помощью пакета <code>DBUG</code>, автором которого
является Фред Фиш (Fred  Fish). See section <A HREF="manual.ru.html#The_DBUG_package">D.3  Пакет DBUG</A>.

</P>


<H3><A NAME="Using_gdb_on_mysqld" HREF="manual.ru_toc.html#Using_gdb_on_mysqld">D.1.3  Отладка mysqld при помощи gdb</A></H3>

<P>
В большинстве операционных систем можно запускать <code>mysqld</code> под отладчиком
<code>gdb</code> - это позволяет получить больше информации при аварийных остановках
<code>mysqld</code>,

</P>
<P>
С некоторыми более старыми версиями <code>gdb</code> под Linux, чтобы обеспечить
возможность отладки потоков <code>mysqld</code>, необходимо использовать run
<code>--one-thread</code>. В этом случае в каждый момент времени доступен для отладки
только один поток. Нам остается только рекомендовать вам как можно быстрее
заменить старые версии отладчика на версию <code>gdb</code> 5.1, поскольку отладка
потоков в этой версии работает намного лучше!

</P>
<P>
При работе <code>mysqld</code> под отладчиком <code>gdb</code> необходимо заблокировать трассировку
стеков при помощи <code>--skip-stack-trace</code>, что обеспечит возможность выявить
ошибки сегмантацию внутри <code>gdb</code>.

</P>
<P>
Если постоянно подсоединяются новые пользователи, то отладка MySQL под <code>gdb</code>
может оказаться достаточно сложным делом, поскольку <code>gdb</code> не освобождает
память, занимаемую старыми потоками. Эту проблему можно устранить,
запустив <code>mysqld</code> с параметрами <code>-O thread_cache_size='max_connections+1'</code>.
В большинстве случаев даже простое использование <code>-O thread_cache_size=5</code>
может очень помочь!

</P>
<P>
Для получения дампа оперативной памяти под Linux, если <code>mysqld</code> падает по
сигналу <code>SIGSEGV</code>, можно запустить <code>mysqld</code> с опцией <code>--core-file</code>. Этот файл
оперативной памяти (core) можно использовать для обратной трассировки при
выявлении причин останова <code>mysqld</code>:

</P>

<PRE>
shell&#62; gdb mysqld core
gdb&#62; backtrace full
gdb&#62; exit
</PRE>

<P>
See section <A HREF="manual.ru.html#Crashing">A.4.1  Что делать, если работа MySQL сопровождается постоянными сбоями</A>.

</P>
<P>
При использовании версии <code>gdb</code> 4.17.x или выше под Linux необходимо
установить в текущем каталоге файл <tt>`.gdb'</tt> со следующей информацией:

</P>

<PRE>
set print sevenbit off
handle SIGUSR1 nostop noprint
handle SIGUSR2 nostop noprint
handle SIGWAITING nostop noprint
handle SIGLWP nostop noprint
handle SIGPIPE nostop
handle SIGALRM nostop
handle SIGHUP nostop
handle SIGTERM nostop noprint
</PRE>

<P>
Если при отладке потоков с помощью <code>gdb</code> возникают проблемы, необходимо
загрузить версию <code>gdb</code> 5.x и попробовать использовать ее вместо прежней.
Новая версия отладчика <code>gdb</code> обеспечивает значительно улучшенную обработку
потоков!

</P>
<P>
Ниже приводится пример отладки mysqld:

</P>

<PRE>
shell&#62; gdb /usr/local/libexec/mysqld
gdb&#62; run
...
backtrace full # Делайте это при аварийной остановке mysqld
</PRE>

<P>
Включите полученный вывод в письмо, сгенерированное с помощью <code>mysqlbug</code>, и
пошлите это письмо по адресу <a HREF="mailto:mysql@lists.mysql.com">mysql@lists.mysql.com</a>.

</P>
<P>
Если <code>mysqld</code> зависает, можно попробовать использовать некоторые системные
средства наподобие <code>strace</code> или <code>/usr/proc/bin/pstack</code> для выяснения, где
именно произошло зависание <code>mysqld</code>.

</P>

<PRE>
strace /tmp/log libexec/mysqld
</PRE>

<P>
Если используется интерфейс Perl  <code>DBI</code>, то можно получить отладочную
информацию, используя метод <code>trace</code> или установив переменную окружения
<code>DBI_TRACE</code>. See section <A HREF="manual.ru.html#Perl_DBI_Class">8.2.2  Интерфейс <code>DBI</code></A>.

</P>


<H3><A NAME="Using_stack_trace" HREF="manual.ru_toc.html#Using_stack_trace">D.1.4  Использование трассировки стека</A></H3>

<P>
В некоторых операционных системах журнал ошибок в случае смерти <code>mysqld</code> 
будет содержать трассировку стека. Эти данные можно использовать для
выяснения, где (и, может быть, почему) умер <code>mysqld</code> (see section <A HREF="manual.ru.html#Error_log">4.9.1  Журнал ошибок</A>). Для получения трассировки стека не следует компилировать <code>mysqld</code> с
опцией <code>-fomit-frame-pointer</code> для <code>gcc</code> (see section <A HREF="manual.ru.html#Compiling_for_debugging">D.1.1  Компиляция MySQL для отладки</A>).

</P>
<P>
Если файл ошибок содержит что-нибудь похожее на следующее:

</P>

<PRE>
mysqld got signal 11;
The manual section 'Debugging a MySQL server' tells you how to use a
stack trace and/or the core file to produce a readable backtrace that may
help in finding out why mysqld died
Attemping backtrace. You can use the following information to find out
where mysqld died.  If you see no messages after this, something went
terribly wrong
stack range sanity check, ok, backtrace follows
0x40077552
0x81281a0
0x8128f47
0x8127be0
0x8127995
0x8104947
0x80ff28f
0x810131b
0x80ee4bc
0x80c3c91
0x80c6b43
0x80c1fd9
0x80c1686
</PRE>

<P>
то можно определить, где произошла остановка <code>mysqld</code>. Для этого нужно
выполнить следующие действия:

</P>

<OL>
<LI>

Скопируйте приведенные выше числовые значения в файл, например
<code>mysqld.stack</code>.

<LI>

Создайте файл символов для сервера <code>mysqld</code>:


<PRE>
nm -n libexec/mysqld &#62; /tmp/mysqld.sym
</PRE>

Следует учесть, что во многих бинарных поставках MySQL приведенный
выше файл с именем <tt>`mysqld.sym.gz'</tt>  уже имеется. В этом случае
необходимо распаковать его следующим образом:


<PRE>
gunzip &#60; bin/mysqld.sym.gz &#62; /tmp/mysqld.sym
</PRE>

<LI>

Выполните  <code>resolve_stack_dump -s /tmp/mysqld.sym -n mysqld.stack</code>,
чтобы  вывести  место  остановки  <code>mysqld</code>. Если и это не поможет
определить причину останова <code>mysqld</code>, то следует сделать отчет об ошибке
и включить в него данный вывод с комментарием. Следует учитывать,
однако, что в большинстве случаев наличие лишь только трассировки
стеков не поможет нам определить причину данной проблемы. Чтобы иметь
возможность локализовать данный сбой или рекомендовать обходной путь,
нам, как правило, необходимо знать, какой именно запрос привел к
остановке mysqld и, желательно, иметь контрольный пример, чтобы мы
могли воспроизвести данную проблему! See section <A HREF="manual.ru.html#Bug_reports">1.8.1.3  Как отправлять отчеты об ошибках или проблемах</A>.
</OL>



<H3><A NAME="Using_log_files" HREF="manual.ru_toc.html#Using_log_files">D.1.5  Использование журналов для определения причин ошибок в mysqld</A></H3>

<P>
Обратите внимание: перед запуском <code>mysqld</code> с <code>--log</code> необходимо проверить все
используемые таблицы с помощью <code>myisamchk</code> (see section <A HREF="manual.ru.html#MySQL_Database_Administration">4  Администрирование баз данных</A>).

</P>
<P>
Если демон <code>mysqld</code> умрет или зависнет, следует запустить <code>mysqld</code> с опцией
<code>--log</code>. Если аварийное завершение <code>mysqld</code> снова повторится, то можно
исследовать часть журнала, относящуюся к запросу, убившему <code>mysqld</code>.

</P>
<P>
При использовании опции <code>--log</code> без имени файла данный журнал хранится в
каталоге базе данных как <tt>``hostname`.log'</tt>. В большинстве случаев именно
последний запрос в системном журнале приводит к смерти <code>mysqld</code>, но при
возможности лучше в этом убедиться: перезапустите <code>mysqld</code> и выполните
найденный запрос из командной строки <code>mysql</code>. Если запрос выполняется, то
следует протестировать все сложные запросы, которые не завершились.

</P>
<P>
Можно также попробовать выполнить команду <code>EXPLAIN</code> для всех выражений
<code>SELECT</code>, которые занимают длительное время, чтобы убедиться, что <code>mysqld</code>
правильно использует индексы. See section <A HREF="manual.ru.html#EXPLAIN">5.2.1  Синтаксис оператора <code>EXPLAIN</code> (получение информации о <code>SELECT</code>)</A>.

</P>
<P>
Запросы, требующие слишком длительного времени для выполнения, можно
выявить, запустив <code>mysqld</code> с параметром <code>--log-slow-queries</code>. See section <A HREF="manual.ru.html#Slow_query_log">4.9.5  Журнал медленных запросов</A>.

</P>
<P>
Если в журнале ошибок (обычно он имеет имя <tt>``hostname`.err'</tt>) присутствует
запись "<code>mysqld restarted</code>", то у вас есть шанс найти запрос, вызывающий
смерть <code>mysqld</code>. В этом случае необходимо проверить все таблицы с помощью
команды <code>myisamchk</code> (see section <A HREF="manual.ru.html#MySQL_Database_Administration">4  Администрирование баз данных</A>) и проанализировать
запросы в журналах MySQL, чтобы определить, какой из них не работает. Если
такой запрос найден, прежде всего необходимо попытаться сделать апгрейд
MySQL до новейшей версии. Если же это не помогает и нет ничего похожего в
архиве списка рассылки <code>mysql</code>, пришлите отчет о данном сбое по адресу
<a HREF="mailto:mysql@lists.mysql.com">mysql@lists.mysql.com</a>. Ссылки на архивы списка рассылки доступны по адресу
<a HREF="http://lists.mysql.com/">http://lists.mysql.com/</a>.

</P>
<P>
Если демон <code>mysqld</code> был запущен с параметром <code>myisam-recover</code>, то MySQL
автоматически проверяет и пытается восстановить таблицы MyISAM (если они
отмечены как "таблица не закрыта правильно" или "таблица повреждена").
В этом случае MySQL запишет в файл <tt>`hostname.err'</tt> предупреждение:
"<code>Warning: Checking table ...</code>", за которым следует "<code>Warning: Repairing
table</code>", если данную таблицу следует исправить. Если таких ошибок в
журнале много, а <code>mysqld</code> перед этим не умирал со сбоем, то что-то работает
неправильно и необходимы дальнейшие исследования. See section <A HREF="manual.ru.html#Command-line_options">4.1.1  Параметры командной строки <code>mysqld</code></A>.

</P>
<P>
Конечно, неожиданная смерть <code>mysqld</code> - событие малоприятное, но в этом
случае следует не изучать сообщения "<code>Checking table...</code>", а попытаться
найти причины остановки <code>mysqld</code>.

</P>


<H3><A NAME="Reproduceable_test_case" HREF="manual.ru_toc.html#Reproduceable_test_case">D.1.6  Создание контрольного примера при повреждении таблиц</A></H3>

<P>
Когда таблицы оказываются поврежденными или <code>mysqld</code> всегда дает сбой после
некоторых команд, то можно провести испытания (если данный сбой
воспроизводим). Для этого нужно выполнить следующие действия:

</P>

<UL>
<LI>

Остановите демон MySQL (с помощью команды <code>mysqladmin shutdown</code>).

<LI>

Сделайте резервную копию таблиц (в качестве меры предосторожности на
случай, если процесс исправления таблиц пройдет некорректно, хотя это
и маловероятно).

<LI>

Проверьте все таблицы с помощью команды <code>myisamchk -s database/*.MYI</code>.
Исправьте некорректные таблицы с помощью команды 
<code>myisamchk -r database/table.MYI</code>.

<LI>

Создайте еще раз резервные копии этих таблиц.

<LI>

Переместите (или удалите совсем) все старые журнальные файлы из
каталога данных MySQL, если нужно освободить больше места.

<LI>

Запустите <code>mysqld</code> с <code>--log-bin</code> (see section <A HREF="manual.ru.html#Binary_log">4.9.4  Бинарный журнал обновлений</A>).
Если вы хотите найти запрос, который приводит к сбою <code>mysqld</code>, то
следует использовать <code>--log --log-bin</code>.

<LI>

Когда таблица с искажениями будет получена, остановите сервер <code>mysqld</code>.

<LI>

Восстановите систему из резервной копии.

<LI>

Перезапустите сервер <code>mysqld</code>  без  <code>--log-bin</code>.

<LI>

Выполните заново команды <code>mysqlbinlog update-log-file | mysql</code>.
Обновленная запись в журнале сохраняется в каталоге баз данных MySQL с
именем <tt>`hostname-bin.#'</tt>.

<LI>

Если в результате вышеприведенной команды таблицы опять окажутся
поврежденными или вы можете получить сбой в работе <code>mysqld</code>, то, значит,
вы нашли повторяющуюся ошибку, которую можно исправить! Загрузите 
эти таблицы и запись из двоичного журнала по адресу
<a HREF="ftp://support.mysql.com/pub/mysql/secret/">ftp://support.mysql.com/pub/mysql/secret/</a> и пошлите письмо с описанием
данной проблемы на <code>bugs@lists.mysql.com</code> или (если вы являетесь
коммерческим пользователем) на <code>support@mysql.com</code> - и команда
разработчиков MySQL устранит ошибку настолько быстро, насколько это
возможно.
</UL>

<P>
Для локализации проблемы можно также использовать скрипт <code>mysql_find_rows</code>,
чтобы просто выполнить ряд обновляющих команд.

</P>


<H2><A NAME="Debugging_client" HREF="manual.ru_toc.html#Debugging_client">D.2  Отладка клиента MySQL</A></H2>

<P>
Чтобы иметь возможность отладки клиента MySQL с помощью встроенного
отладчика, необходимо сконфигурировать сборку MySQL с <code>--with-debug</code> или
<code>--with-debug=full</code>. See section <A HREF="manual.ru.html#configure_options">2.3.3  Типичные опции <code>configure</code></A>.

</P>
<P>
Перед запуском клиента следует установить переменную окружения <code>MYSQL_DEBUG</code>:

</P>


<PRE>
shell&#62; MYSQL_DEBUG=d:t:O,/tmp/client.trace
shell&#62; export MYSQL_DEBUG
</PRE>

<P>
Это заставит клиента генерировать трассировочный файл в
<tt>`/tmp/client.trace'</tt>.

</P>
<P>
Если существуют проблемы с кодом конкретного клиента, необходимо
попытаться соединиться с сервером и послать запрос, используя другой
заведомо работоспособный клиент. Это следует делать при работе <code>mysql</code> в
режиме отладки (предполагается, что данный экземпляр MySQL скомпилирован с
возможностью отладки):

</P>

<PRE>
shell&#62; mysql --debug=d:t:O,/tmp/client.trace
</PRE>

<P>
приведенный выше вызов снабдит вас полезной информацией для отчета об
ошибках. See section <A HREF="manual.ru.html#Bug_reports">1.8.1.3  Как отправлять отчеты об ошибках или проблемах</A>.

</P>
<P>
Если ваш клиент, имея "правильный" на первый взгляд код, отказывается
устойчиво работать, необходимо проверить, соответствует ли включаемый файл
<tt>`mysql.h'</tt> файлу вашей библиотеки <code>mysql</code>. Очень распространенная ошибка
заключается в том, что используется старый файл <tt>`mysql.h'</tt> из MySQL старой
установки с новой библиотекой MySQL.

</P>



<H2><A NAME="The_DBUG_package" HREF="manual.ru_toc.html#The_DBUG_package">D.3  Пакет DBUG</A></H2>

<P>
Сервер MySQL и большинство клиентов MySQL компилируются с пакетом <code>DBUG</code>,
автором первой версии которого является Фред Фиш (Fred  Fish). При
конфигурации MySQL в отладочном режиме этот пакет дает возможность
получить трассировочный файл для отладки программы. See section <A HREF="manual.ru.html#Making_trace_files">D.1.2  Создание трассировочных файлов</A>.

</P>
<P>
Чтобы воспользоваться пакетом отладки, следует в вызове программы задать
опцию <code>--debug="..."</code> или <code>-#...</code>

</P>
<P>
Большинство программ MySQL по умолчанию имеют отладочную строку, которая будет 
использована, если не задана опция <code>--debug</code>. По умолчанию
трассировочный файл обычно находится в <tt>`/tmp/имя_программы.trace'</tt> под Unix и
в <tt>`\имя_программы.trace'</tt> под Windows.

</P>
<P>
Строка управления отладкой представляет собой последовательность
разделенных двоеточиями полей, как в следующем примере:

</P>

<PRE>
&#60;field_1&#62;:&#60;field_2&#62;:...:&#60;field_N&#62;
</PRE>

<P>
Каждое поле состоит из обязательного флагового символа, за которым следует
необязательный символ "," и разделенный запятыми список модификаторов:

</P>

<PRE>
flag[,modifier,modifier,...,modifier]
</PRE>

<P>
В настоящее время распознаются следующие символы флагов:

</P>
<TABLE BORDER>
<TR><TD><strong>Флаг</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD>d </TD><TD> Разрешает вывод из макроса <code>DBUG_&#60;N&#62;</code> для текущего состояния. За этим
флагом может следовать список ключевых слов. Если задан такой список, то
из вывода макроса <code>DBUG</code> будет выбираться вывод только с данными ключевыми
словами. Если задан пустой список ключевых слов, выбирается вывод всего
макроса.

</TD></TR>
<TR><TD>D </TD><TD> Задает задержку вывода после каждой строки отладчика. Аргумент
представляет собой количество десятых долей секунд задержки в
соответствии с возможностями машины. Т.е. <code>D,20</code> означает задержку в две
секунды.

</TD></TR>
<TR><TD>f </TD><TD> Ограничивает отладку и/или трассировку и профайлинг только перечисленными
в списке функциями. Обратите внимание: если задан нулевой список, то
будут заблокированы все функции. Соответствующие флаги "<code>d</code>" или "<code>t</code>" должны
также задаваться, данный флаг только ограничивает их действия, если они
разрешены.

</TD></TR>
<TR><TD>F </TD><TD> Идентифицирует имя исходного файла для каждой строки вывода отладки или
трассировки.

</TD></TR>
<TR><TD>i </TD><TD> Идентифицирует процесс указанием <code>pid</code> или идентификатором потока (<code>thread
id</code>) в каждой строке вывода отладки или трассировки.

</TD></TR>
<TR><TD>g </TD><TD> Разрешает профайлинг. Создает файл с именем <tt>`dbugmon.out'</tt>, содержащий
информацию, которую можно использовать для профайлинга программы. За этим
флагом может следовать список ключевых слов; если такой список задан, то
профайлинг будет применяться только для функций из этого списка. Если
задан нулевой список ключевых слов, то профайлинг применяется ко всем
функциям.

</TD></TR>
<TR><TD>L </TD><TD> Идентифицирует номер строки исходного файла для каждой строки вывода
отладки или трассировки.

</TD></TR>
<TR><TD>n </TD><TD> Задает вывод глубины вложенности текущей функции для каждой строки вывода
отладки или трассировки.

</TD></TR>
<TR><TD>N </TD><TD> Задает нумерацию каждой строки в выводе <code>dbug</code>.

</TD></TR>
<TR><TD>o </TD><TD> Переадресует выходной поток отладчика в указанный файл. По умолчанию
вывод осуществляется в stderr.

</TD></TR>
<TR><TD>O </TD><TD> То же, что и <code>o</code>, но указанный файл сбрасывается на диск каждый раз между
операциями записи. При необходимости этот файл закрывается и снова
открывается каждый раз между операциями записи.

</TD></TR>
<TR><TD>p </TD><TD> Ограничивает действия отладчика указанным процессом. Процесс должен быть
идентифицирован макросом <code>DBUG_PROCESS</code> и совпадать с указанным в списке
для действий отладчика.

</TD></TR>
<TR><TD>P </TD><TD> Выводит имя текущего процесса для каждой строки вывода отладки или
трассировки.

</TD></TR>
<TR><TD>r </TD><TD> Не наследовать уровень вложенности функции в предыдущем состоянии при
переходе в новое состояние. Полезно, если вывод должен начинаться с
левого поля.

</TD></TR>
<TR><TD>S </TD><TD> Выполнять функцию <code>_sanity(_file_,_line_)</code> для каждой отлаженной функции,
пока <code>_sanity()</code> не возвратит значение, отличное от <code>0</code>. (Главным
образом используется совместно с <code>safemalloc</code> для определения утечек
памяти).

</TD></TR>
<TR><TD>t </TD><TD> Разрешает трассировку вызовов функций/выход из функций. За этим
параметром может следовать список (содержащий только один модификатор).
Данный модификатор задает число - максимальный уровень вложения функций,
ниже которого не производится вывод ни для отладочного, ни для
трассировочного макросов. Параметр по умолчанию задается во время
компиляции.
</TD></TR>
</TABLE>

<P>
Ниже представлены некоторые примеры строк управления отладкой, которые
можно применять в командной строке оболочки (символ "<code>-#</code>" обычно
используется для внедрения управляющей строки в программу):

</P>

<PRE>
-#d:t
-#d:f,main,subr1:F:L:t,20
-#d,input,output,files:n
-#d:t:i:O,\\mysqld.trace
</PRE>

<P>
В MySQL обычно применяются следующие дескрипторы для вывода (совместно с
опцией <code>d</code>): <code>enter,exit,error,warning,info</code> и <code>loop</code>.

</P>


<H2><A NAME="Locking_methods" HREF="manual.ru_toc.html#Locking_methods">D.4  Методы блокировки</A></H2>

<P>
В настоящее время MySQL поддерживает только табличную блокировку для
таблиц типов ISAM/MyISAM и HEAP, страничную блокировку для таблиц BDB и
строковую блокировку для таблиц InnoDB (see section <A HREF="manual.ru.html#Internal_locking">5.3.1  Как MySQL блокирует таблицы</A>). Для таблиц MyISAM можно произвольным образом сочетать команды
<code>INSERT</code> и <code>SELECT</code> без блокировок, поскольку поддерживается управление
версиями (Versioning).

</P>
<P>
Начиная с версии 3.23.33 имеется возможность анализировать конфликты и
конкуренцию блокировок таблиц в системе. Это делается путем проверки
переменных <code>Table_locks_waited</code> и <code>Table_locks_immediate</code>.

</P>
<P>
Если вы хотите использовать тип таблиц с блокировкой уровня записи, то
прежде, чем принимать такое решение, следует посмотреть, что делает данное
приложение и какая принята модель выборки/обновления данных.

</P>
<P>
Аргументы в пользу строковой блокировки:

</P>

<UL>
<LI>

Меньше конфликтов блокировок при обращении к различным строкам из
множества потоков.

<LI>

Меньше изменений при откатах.

<LI>

Возможна блокировка одной строки на длительное время.
</UL>

<P>
Аргументы против строковой блокировки

</P>

<UL>
<LI>

Требуется больше памяти, чем при страничной или табличной блокировке.

<LI>

При использовании большой части таблицы строковая блокировка работает
медленнее в сравнении с блокировкой на уровне страниц или таблиц,
поскольку требуется производить намного больше блокировок.

<LI>

Определенно хуже других блокировок, если часто выполняется операция
<code>GROUP BY</code> на значительной части данных или если приходится сканировать
всю таблицу.

<LI>

Для блокировок более высокого уровня также проще осуществить поддержку
различных типов блокировок для настройки приложения, поскольку для них
затраты на блокировку менее заметны, чем для строкового уровня
блокировки.
</UL>

<P>
Блокировки на уровне таблиц лучше, чем блокировки страничного/строкового
уровня в следующих случаях:

</P>

<UL>
<LI>

Когда производится главным образом чтение.

<LI>

При чтении и обновлении для строго заданных ключей; при обновлении или
удалении строки, которая может быть извлечена чтением одного ключа:


<PRE>
UPDATE table_name SET column=value WHERE unique_key#
DELETE FROM table_name WHERE unique_key=#
</PRE>

<LI>

<code>SELECT</code> с <code>INSERT</code> (и очень мало операций
<code>UPDATE</code> и <code>DELETE</code>).

<LI>

Выполняется много операций просмотра и группировки <code>GROUP BY</code> на всей
таблице без записи.
</UL>

<P>
Другие возможности, кроме строчного/страничного уровня блокирования:

</P>
<P>
Управление версиями (Versioning), подобно тому, как это делается в MySQL
для параллельных вставок. При этом один из пользователей может выполнять
операцию записи в то же время, когда несколько пользователей производят
чтение. Это означает, что данная база данных/таблица поддерживает
различные представления для данных в зависимости от того, когда произошло
обращение к ним. Существуют и другие названия этой возможности -
перемещение по времени (time  travel), метод копирования в момент записи
(copy  on  write) или метод копирования по запросу (copy  on  demand).

</P>
<P>
Копирование по запросу во многих случаях значительно лучше, чем страничный
или строковый уровень блокировки; однако в наиболее неблагоприятном
варианте этот метод требует намного больше памяти, чем при использовании
обычных блокировок.

</P>
<P>
Вместо использования блокировок строкового уровня можно применять
блокировки уровня приложения (подобно get_lock/release_lock в MySQL).
Конечно, такие блокировки годятся только для корректно работающих
приложений.

</P>
<P>
Если речь идет о конкретном приложении, то обычно можно с уверенностью
сказать, какой тип блокировки лучше всего в нем использовать, однако для
общего случая такой вывод сделать практически невозможно: все зависит от
конкретного приложения, причем для различных частей приложения могут
требоваться различные типы блокировок.

</P>
<P>
Ниже приводится несколько советов по блокировкам в MySQL:

</P>
<P>
Большинство веб-приложений выполняют большое количество
выборок, очень мало удалений, обновления главным образом по ключам и
вставки в некоторые специальные таблицы. Базовая установка MySQL очень
хорошо настроена для этого.

</P>
<P>
Одновременный доступ пользователей не представляет проблем, если не
происходит смешивания обновлений и выборок, требующих проверки нескольких
строк в одной и той же таблице.

</P>
<P>
В случае сочетания вставок и удалений в одной и той же таблице очень
полезно применять <code>INSERT DELAYED</code>.

</P>
<P>
Для повышения скорости можно также использовать <code>LOCK TABLES</code> (несколько
обновлений в рамках одной блокировки выполняются намного быстрее, чем
обновления без блокировок). Целесообразно также распределять данные по
различным таблицам.

</P>
<P>
Иногда проблемы со скоростью при блокировках таблиц в MySQL удается решить
преобразованием ряда таблиц в таблицы типа InnoDB или BDB. 
See section <A HREF="manual.ru.html#InnoDB">7.5  Таблицы <code>InnoDB</code></A>. See section <A HREF="manual.ru.html#BDB">7.6  Таблицы <code>BDB</code> или BerkeleyDB</A>.

</P>
<P>
Большое количество различных аспектов настройки приложения рассмотрено в
разделе данного руководства, посвященном оптимизации (see section <A HREF="manual.ru.html#Tips">5.2.12  Другие советы по оптимизации</A>).

</P>


<H2><A NAME="RTS-threads" HREF="manual.ru_toc.html#RTS-threads">D.5  Замечания по потокам RTS</A></H2>

<P>
При попытке применить пакеты потоков RTS с MySQL автору пришлось
столкнуться со следующими проблемами:

</P>
<P>
В этих пакетах используются старые версии большинства вызовов POSIX,
поэтому очень утомительно создавать оболочки (wrapper) для всех функций.
На мой взгляд, было бы легче изменить библиотеки этих потоков в
соответствии с современной спецификацией POSIX.

</P>
<P>
Некоторые оболочки уже написаны (чтобы получить более подробную
информацию, обращайтесь к <tt>`mysys/my_pthread.c'</tt>).

</P>
<P>
Следует изменить, по меньшей мере, следующие аспекты:

</P>
<P>
В  <code>pthread_get_specific</code> должен использоваться один аргумент, а в <code>sigwait</code> -
два аргумента. Многие функции (по крайней мере, <code>pthread_cond_wait</code>,
<code>pthread_cond_timedwait</code>) должны возвращать код ошибки или ошибку. Сейчас
они возвращают <code>-1</code> и устанавливают <code>errno</code>.

</P>
<P>
Еще одна проблема заключается в том, что потоки пользовательского уровня
используют сигнал <code>ALRM</code>, преждевременно прекращающий работу многих функций
(<code>read, write, open...</code>). MySQL должен повторять попытку выполнить такие
вызовы в случае прерывания, но это не так легко проверить.

</P>
<P>
Наиболее значительная из нерешенных проблем заключается в следующем:

</P>
<P>
Чтобы получать alarm на уровне потока, я изменил <code>mysys/thr_alarm.c</code> -
чтобы ожидать alarm с помощью функции <code>pthread_cond_timedwait()</code>. Однако
оказалось, что это приводит к преждевременному прекращению работы с
ошибкой <code>EINTR</code>. Чтобы понять, почему так получается, я пытался отладить
библиотеку потока, но не смог найти никакого простого решения.

</P>
<P>
Для тех, кто хочет попробовать использовать MySQL с потоками RTS, я
предлагаю следующее:

</P>

<UL>
<LI>

Измените функции, используемые MySQL из библиотеки потоков для POSIX.
Это не должно занять много времени.

<LI>

Скомпилируйте все библиотеки с <code>-DHAVE_rts_threads</code>.

<LI>

Скомпилируйте <code>thr_alarm</code>.

<LI>

Если существуют некоторые небольшие отличия в реализации, то они могут
быть устранены изменением <tt>`my_pthread.h'</tt> и <tt>`my_pthread.c'</tt>.

<LI>

Запустите <code>thr_alarm</code>. Если программа выполняется без каких-либо
предупреждений, сообщений об ошибках или об аварийном выходе, значит,
вы на правильном пути. Ниже приводится успешный прогон программы под
Solaris:


<PRE>
Main thread: 1
Thread 0 (5) started
Thread: 5  Waiting
process_alarm
Thread 1 (6) started
Thread: 6  Waiting
process_alarm
process_alarm
thread_alarm
Thread: 6  Slept for 1 (1) sec
Thread: 6  Waiting
process_alarm
process_alarm
thread_alarm
Thread: 6  Slept for 2 (2) sec
Thread: 6  Simulation of no alarm needed
Thread: 6  Slept for 0 (3) sec
Thread: 6  Waiting
process_alarm
process_alarm
thread_alarm
Thread: 6  Slept for 4 (4) sec
Thread: 6  Waiting
process_alarm
thread_alarm
Thread: 5  Slept for 10 (10) sec
Thread: 5  Waiting
process_alarm
process_alarm
thread_alarm
Thread: 6  Slept for 5 (5) sec
Thread: 6  Waiting
process_alarm
process_alarm

...
thread_alarm
Thread: 5  Slept for 0 (1) sec
end
</PRE>

</UL>



<H2><A NAME="Thread_packages" HREF="manual.ru_toc.html#Thread_packages">D.6  Различия между разными потоковыми пакетами</A></H2>

<P>
Работа MySQL в значительной степени зависит от используемого потокового
пакета. Таким образом, при выборе хорошей платформы для MySQL потоковый
пакет играет очень важную роль.

</P>
<P>
Существуют по меньшей мере три типа потоковых пакетов:

</P>

<UL>
<LI>

Пользовательские потоки в одном процессе. Переключение потоков
осуществляется сигналами (alarm) и библиотека потоков управляет всеми
функциями, не поддерживающими потоки, с помощью блокировок. Операции
чтения, записи и выборки обычно управляются программой выбора потоков,
которая переключает их на другой поток, если текущий должен ожидать
данные (речь идет о вызове select). Пакеты пользовательских потоков
могут быть интегрированы в стандартные библиотеки (FreeBSD- и
BSDI-потоки). Такие интегрированные пакеты требуют меньше затрат в
сравнении с потоковыми пакетами, которые должны обрабатывать все
ненадежные вызовы (MIT-pthreads, FSU  Pthreads и потоки RTS). В
некоторых средах (например SCO) все системные вызовы поддерживают
потоки, так что обработка может быть выполнена очень просто (FSU 
Pthreads под SCO). Недостатки такого метода: поскольку все вызовы, для
которых установлены соответствия, занимают мало времени, очень сложно
контролировать обработку всех ситуаций. Обычно существуют также
системные вызовы, не обрабатываемые потоковым пакетом (такие как
MIT-pthreads и сокеты). Диспетчеризация потоков не всегда является
оптимальной.

<LI>

Пользовательские потоки в раздельных процессах. Переключение потоков
производится ядром и все данные используются совместно всеми потоками.
Потоковый пакет управляет стандартными вызовами потоков, чтобы
обеспечить совместное использование данных этими потоками. Такой метод
используется в LinuxThreads. Недостатки этого метода: масса процессов;
медленное создание потока. Если один поток умирает, то остальные
обычно зависают и необходимо их уничтожать перед перезапуском.
Переключение потоков отчасти затратно.

<LI>

Потоки ядра. Переключение потоков управляется потоковой библиотекой
или ядром и происходит очень быстро. Все делается в одном процессе, но
для некоторых систем <code>ps</code> может показывать разные потоки. Если один из
потоков неожиданно умрет, то происходит аварийное прерывание всего
процесса. Большинство системных вызовов поддерживают потоки и должны
требовать очень небольших затрат. С потоками ядра работают Solaris,
HP-UX, AIX и OSF/1.
</UL>

<P>
В некоторых системах управление потоками ядра осуществляется путем
интеграции потоков пользовательского уровня в системные библиотеки. В
подобных случаях переключение потоков может осуществляться только данной
потоковой библиотекой, и ядро фактически "не в курсе событий".


<H1><A NAME="Environment_variables" HREF="manual.ru_toc.html#Environment_variables">E  Переменные окружения</A></H1>
<P>
<A NAME="IDX1792"></A>

</P>

<P>
Ниже приводится список всех переменных окружения, которые прямо или
косвенно используются в MySQL. Многие из них можно найти и в других частях
данного руководства.

</P>
<P>
Следует иметь в виду, что все опции командной строки имеют более высокий
приоритет, чем параметры, указанные в конфигурационных файлах и
переменныхокружения, а параметры в конфигурационных файлах - более высокий
приоритет, чем значения переменных окружения.

</P>
<P>
Во многих случаях для изменения поведения MySQL более предпочтительно
использовать конфигурационный файл. See section <A HREF="manual.ru.html#Option_files">4.1.2  Файлы параметров <tt>`my.cnf'</tt></A>.

</P>
<P>
<A NAME="IDX1793"></A>
<A NAME="IDX1794"></A>
<A NAME="IDX1795"></A>
<A NAME="IDX1796"></A>
<A NAME="IDX1797"></A>
<A NAME="IDX1798"></A>
<A NAME="IDX1799"></A>
<A NAME="IDX1800"></A>
<A NAME="IDX1801"></A>
<A NAME="IDX1802"></A>
<A NAME="IDX1803"></A>
<A NAME="IDX1804"></A>
<A NAME="IDX1805"></A>
<A NAME="IDX1806"></A>
<A NAME="IDX1807"></A>
<A NAME="IDX1808"></A>
<A NAME="IDX1809"></A>
<A NAME="IDX1810"></A>
<A NAME="IDX1811"></A>
<A NAME="IDX1812"></A>
<A NAME="IDX1813"></A>
<A NAME="IDX1814"></A>
<A NAME="IDX1815"></A>
<A NAME="IDX1816"></A>
<A NAME="IDX1817"></A>
<A NAME="IDX1818"></A>
<A NAME="IDX1819"></A>
<A NAME="IDX1820"></A>
<A NAME="IDX1821"></A>
<A NAME="IDX1822"></A>
<A NAME="IDX1823"></A>
<A NAME="IDX1824"></A>
<A NAME="IDX1825"></A>
<A NAME="IDX1826"></A>
<A NAME="IDX1827"></A>
<A NAME="IDX1828"></A>
<A NAME="IDX1829"></A>
<A NAME="IDX1830"></A>
<A NAME="IDX1831"></A>
<A NAME="IDX1832"></A>
<A NAME="IDX1833"></A>
<A NAME="IDX1834"></A>

</P>

<TABLE BORDER>
<TR><TD><strong>Переменная</strong> </TD><TD> <strong>Описание</strong>
</TD></TR>
<TR><TD><code>CCX</code> </TD><TD> Устанавливается в компиляторе C++ при конфигурации.
</TD></TR>
<TR><TD><code>CC</code> </TD><TD> Устанавливается в компиляторе C при конфигурации.
</TD></TR>
<TR><TD><code>CFLAGS</code> </TD><TD> Флаги для компилятора C при конфигурации.
</TD></TR>
<TR><TD><code>CXXFLAGS</code> </TD><TD> Флаги для компилятора C++ при конфигурации.
</TD></TR>
<TR><TD><code>DBI_USER</code> </TD><TD> Имя пользователя по умолчанию для интерфейса Perl  <code>DBI</code>.
</TD></TR>
<TR><TD><code>DBI_TRACE</code> </TD><TD> Используется при трассировке в Perl  <code>DBI</code>.
</TD></TR>
<TR><TD><code>HOME</code> </TD><TD> Для файла истории <code>mysql</code> путь по умолчанию <tt>`$HOME/.mysql_history'</tt>.
</TD></TR>
<TR><TD><code>LD_RUN_PATH</code> </TD><TD> Используется для указания, где находится <tt>`libmysqlclient.so'</tt>.
</TD></TR>
<TR><TD><code>MYSQL_DEBUG</code> </TD><TD> Опции отладки-трассировки при отладке.
</TD></TR>
<TR><TD><code>MYSQL_HISTFILE</code> </TD><TD> Путь к файлу истории <code>mysql</code>.
</TD></TR>
<TR><TD><code>MYSQL_HOST</code> </TD><TD> Имя хоста по умолчанию, используемое для клиента командной строки <code>mysql</code>.
</TD></TR>
<TR><TD><code>MYSQL_PS1</code> </TD><TD> Приглашение для использования в клиенте командной строки <code>mysql</code>. See section <A HREF="manual.ru.html#mysql">4.8.2  <code>mysql</code>, Утилита командной строки</A>.
</TD></TR>
<TR><TD><code>MYSQL_PWD</code> </TD><TD> Пароль по умолчанию при подключении к <code>mysqld</code>. Учтите, что использование этой переменной небезопасно!
</TD></TR>
<TR><TD><code>MYSQL_TCP_PORT</code> </TD><TD> Порт TCP/IP по умолчанию.
</TD></TR>
<TR><TD><code>MYSQL_UNIX_PORT</code> </TD><TD> Сокет по умолчанию; используется для подсоединений к локальной машине.
</TD></TR>
<TR><TD><code>PATH</code> </TD><TD> Используется оболочкой для поиска программ MySQL.
</TD></TR>
<TR><TD><code>TMPDIR</code> </TD><TD> Каталог, в котором создаются временные таблицы/файлы.
</TD></TR>
<TR><TD><code>TZ</code> </TD><TD> Должна быть установлена для локального часового пояса.  See section <A HREF="manual.ru.html#Timezone_problems">A.4.6  Проблемы с часовыми поясами</A>.
</TD></TR>
<TR><TD><code>UMASK_DIR</code> </TD><TD> Маска создания пользовательского каталога при создании каталогов. Учтите, что эта переменная дополняет <code>UMASK</code>!
</TD></TR>
<TR><TD><code>UMASK</code> </TD><TD> Маска создания пользовательского файла при создании файлов.
</TD></TR>
<TR><TD><code>USER</code> </TD><TD> Пользователь по умолчанию под Windows при подключении к <code>mysqld</code>.
</TD></TR>
</TABLE>



<H1><A NAME="Regexp" HREF="manual.ru_toc.html#Regexp">F  Регулярные выражения в MySQL</A></H1>

<P>
<A NAME="IDX1835"></A>
<A NAME="IDX1836"></A>
<A NAME="IDX1837"></A>
<A NAME="IDX1838"></A>

</P>
<P>
Регулярные выражения (regex, regexp) представляют собой мощный способ
выполнения сложного поиска.

</P>
<P>
В MySQL используется расширенная версия предложенной Генри Спенсером
(Henry  Spencer) реализации регулярных выражений, которая ориентирована на
соответствие POSIX 1003.2.

</P>
<P>
В данном разделе приведен упрощенный справочник; подробности здесь
опущены. Чтобы получить более точную информацию, обращайтесь к странице
руководства Генри Спенсера <code>regex(7)</code>, которая включена в дистрибутив
исходного кода. See section <A HREF="manual.ru.html#Credits">B  Благодарности</A>.

</P>
<P>
Регулярное выражение описывает набор строк. Простейшее регулярное
выражение не включает в себя специальных символов. Например, регулярное
выражение <code>hello</code> означает совпадение с <code>hello</code> и ничего больше.

</P>
<P>
В нетривиальных регулярных выражениях используются определенные
специальные конструкции - это обеспечивает возможность получать
соответствие для более чем одной строки. Например, регулярное выражение
<code>hello|word</code> соответствует как <code>hello</code>, так и <code>word</code>.

</P>
<P>
Можно привести и более сложный пример: регулярному выражению <code>B[an]*s</code>
соответствует любая из строк: <code>Bananas</code>, <code>Baaaaas</code>, <code>Bs</code>, а также любая другая
строка, начинающаяся с <code>B</code>, заканчивающаяся на <code>s</code> и содержащая любое
количество символов <code>a</code> или <code>n</code> между ними.

</P>
<P>
В регулярном выражении могут использоваться любые специальные
символы/структуры из числа приведенных ниже:

</P>
<DL COMPACT>

<DT><code>^</code>
<DD>
Соответствие началу строки.


<PRE>
mysql&#62; SELECT "fo\nfo" REGEXP "^fo$"; 	-&#62; 0
mysql&#62; SELECT "fofo" REGEXP "^fo"; 	-&#62; 1
</PRE>

<DT><code>$</code>
<DD>
Соответствие концу строки.

<PRE>
mysql&#62; SELECT "fo\no" REGEXP "^fo\no$"; -&#62; 1
mysql&#62; SELECT "fo\no" REGEXP "^fo$"; 	-&#62; 0
</PRE>

<DT><code>.</code>
<DD>
Соответствие любому символу (включая перевод строки).

<PRE>
mysql&#62; SELECT "fofo" REGEXP "^f.*"; 	-&#62; 1
mysql&#62; SELECT "fo\nfo" REGEXP "^f.*"; 	-&#62; 1
</PRE>

<DT><code>a*</code>
<DD>
Соответствие любой последовательности из нуля или более символов "a".

<PRE>
mysql&#62; SELECT "Ban" REGEXP "^Ba*n"; 	-&#62; 1
mysql&#62; SELECT "Baaan" REGEXP "^Ba*n"; 	-&#62; 1
mysql&#62; SELECT "Bn" REGEXP "^Ba*n"; 	-&#62; 1
</PRE>

<DT><code>a+</code>
<DD>
Соответствие любой последовательности из одного или более символов "a ".

<PRE>
mysql&#62; SELECT "Ban" REGEXP "^Ba+n"; 	-&#62; 1
mysql&#62; SELECT "Bn" REGEXP "^Ba+n"; 	-&#62; 0
</PRE>

<DT><code>a?</code>
<DD>
Соответствие как нулю, так и одному символу "a".


<PRE>
mysql&#62; SELECT "Bn" REGEXP "^Ba?n"; 	-&#62; 1
mysql&#62; SELECT "Ban" REGEXP "^Ba?n"; 	-&#62; 1
mysql&#62; SELECT "Baan" REGEXP "^Ba?n"; 	-&#62; 0
</PRE>

<DT><code>de|abc</code>
<DD>
Соответствие как последовательности  de, так и последовательности  abc.

<PRE>
mysql&#62; SELECT "pi" REGEXP "pi|apa"; 		-&#62; 1
mysql&#62; SELECT "axe" REGEXP "pi|apa"; 		-&#62; 0
mysql&#62; SELECT "apa" REGEXP "pi|apa"; 		-&#62; 1
mysql&#62; SELECT "apa" REGEXP "^(pi|apa)$"; 	-&#62; 1
mysql&#62; SELECT "pi" REGEXP "^(pi|apa)$"; 	-&#62; 1
mysql&#62; SELECT "pix" REGEXP "^(pi|apa)$"; 	-&#62; 0
</PRE>

<DT><code>(abc)*</code>
<DD>
Соответствие нулю или более вхождениям последовательности abc.

<PRE>
mysql&#62; SELECT "pi" REGEXP "^(pi)*$"; 	-&#62; 1
mysql&#62; SELECT "pip" REGEXP "^(pi)*$"; 	-&#62; 0
mysql&#62; SELECT "pipi" REGEXP "^(pi)*$"; 	-&#62; 1
</PRE>

<DT><code>{1}</code>
<DD>
<DT><code>{2,3}</code>
<DD>
Существует более общий способ написания регулярных выражений, позволяющий
установить соответствия для нескольких вхождений предшествующего элемента.

<DL COMPACT>

<DT><code>a*</code>
<DD>
Можно записать как a{0,}.

<DT><code>a+</code>
<DD>
Можно записать как a{1,}.

<DT><code>a?</code>
<DD>
Можно записать как a{0,1}.
</DL>

Точнее говоря, элемент, за которым следует ограничение, содержащее одно
целое число <code>i</code> без запятой, соответствует последовательности, в точности
состоящей из <code>i</code> вхождений данного элемента. Если за элементом следует
ограничение, содержащее одно число <code>i</code> и запятую, то устанавливается
соответствие для последовательности, содержащей <code>i</code> или более вхождений
данного элемента. Если за элементом следует ограничение, содержащее два
целых числа <code>i</code> и <code>j</code>, то устанавливается соответствие для последовательности
от <code>i</code> до <code>j</code> (включительно) вхождений данного элемента. Оба аргумента должны
находится в диапазоне от <code>0</code> до <code>RE_DUP_MAX</code> (по умолчанию 255) включительно.
Если существуют оба аргумента, то второй должен быть больше первого или
равен ему.

<DT><code>[a-dX]</code>
<DD>
<DT><code>[^a-dX]</code>
<DD>
Устанавливает соответствие для любого символа, являющегося (или не
являющегося, если используется <code>^</code>) символом <code>a</code>, <code>b</code>, <code>c</code>, <code>d</code> или <code>X</code>. Для
литерального включения символа <code>]</code> следует сразу же после него написать
открывающую скобку <code>[</code>. Для литерального включения символа <code>-</code> он должен быть
написан первым или последним. Таким образом, выражение <code>[0-9]</code> устанавливает
соответствие для любой десятичной цифры. Любой символ, для которого не
задано определенное значение внутри пары скобок <code>[]</code>, не имеет специального
значения и совпадает только с самим собой.


<PRE>
mysql&#62; SELECT "aXbc" REGEXP "[a-dXYZ]"; 	-&#62; 1
mysql&#62; SELECT "aXbc" REGEXP "^[a-dXYZ]$"; 	-&#62; 0
mysql&#62; SELECT "aXbc" REGEXP "^[a-dXYZ]+$"; 	-&#62; 1
mysql&#62; SELECT "aXbc" REGEXP "^[^a-dXYZ]+$"; 	-&#62; 0
mysql&#62; SELECT "gheis" REGEXP "^[^a-dXYZ]+$"; 	-&#62; 1
mysql&#62; SELECT "gheisa" REGEXP "^[^a-dXYZ]+$"; 	-&#62; 0
</PRE>

<DT><code>[[.characters.]]</code>
<DD>
Последовательность символов данного элемента сравнения. Эта
последовательность представляет собой единственный элемент из списка в
выражении в скобках. Выражение в скобках, содержащее многосимвольный
сравнивающий элемент, может, следовательно, искать соответствие более, чем
одного, например, если последовательность сравнения включает в себя
элемент сравнения <code>ch</code>, то регулярное выражение <code>[[.ch.]]*c</code> устанавливает
соответствие с первыми пятью символами выражения <code>chchcc</code>.

<DT><code>[=character_class=]</code>
<DD>
Класс эквивалентности, означающий, что последовательности символов всех
элементов сравнения, включенных в данный класс, эквивалентны между собой.
Например, если <code>o</code> и <code>(+)</code> являются членами класса эквивалентности, то
последовательности <code>[[=o=]]</code>, <code>[[=(+)=]]</code> и <code>[o(+)]</code> все являются синонимичными.
Класс эквивалентности может не быть конечной точкой диапазона.

<DT><code>[:character_class:]</code>
<DD>
Имя класса символов, заключенное внутри выражения в скобках <code>[: имя :]</code>,
обозначает список всех символов, принадлежащих данному классу. Имена
стандартных классов символов следующие:

<TABLE BORDER>
<TR><TD><strong>Имя</strong> </TD><TD> <strong>Имя</strong> </TD><TD> <strong>Имя</strong>
</TD></TR>
<TR><TD>alnum </TD><TD> digit </TD><TD> punct
</TD></TR>
<TR><TD>alpha </TD><TD> graph </TD><TD> space
</TD></TR>
<TR><TD>blank </TD><TD> lower </TD><TD> upper
</TD></TR>
<TR><TD>cntrl </TD><TD> print </TD><TD> xdigit
</TD></TR>
</TABLE>

Они обозначают классы символов, определенные на странице <code>ctype(3)</code>. Локаль
может предоставлять другие классы. Класс символов не может использоваться
как конечная точка диапазона.


<PRE>
mysql&#62; SELECT "justalnums" REGEXP "[[:alnum:]]+"; 	-&#62; 1
mysql&#62; SELECT "!!" REGEXP "[[:alnum:]]+"; 		-&#62; 0
</PRE>

<DT><code>[[:&#60;:]]</code>
<DD>
<DT><code>[[:&#62;:]]</code>
<DD>
Эти выражения устанавливают соответствие с нулевой строкой в начале и в
конце слова соответственно. Слово определяется как последовательность
символов слова, которой не предшествуют и за которой не следуют символы
слова. Под символом слова понимается любая буква или цифра (как определено
в <code>ctype(3)</code>) или подчеркивание (<code>_</code>).


<PRE>
mysql&#62; SELECT "a word a" REGEXP "[[:&#60;:]]word[[:&#62;:]]"; 		  -&#62; 1
mysql&#62; SELECT "a xword a" REGEXP "[[:&#60;:]]word[[:&#62;:]]"; 		  -&#62; 0
</PRE>

</DL>


<PRE>
mysql&#62; SELECT "weeknights" REGEXP "^(wee|week)(knights|nights)$"; -&#62; 1
</PRE>



<H1><A NAME="GPL_license" HREF="manual.ru_toc.html#GPL_license">G  GNU General Public License</A></H1>

<P>
<A NAME="IDX1839"></A>
<A NAME="IDX1840"></A>

</P>
<P>
Version 2, June 1991

</P>

<PRE>
Copyright &copy; 1989, 1991 Free Software Foundation, Inc.
59 Temple Place - Suite 330, Boston, MA  02111-1307, USA

Everyone is permitted to copy and distribute verbatim copies
of this license document, but changing it is not allowed.
</PRE>



<H2><A NAME="SEC835" HREF="manual.ru_toc.html#SEC835">9.4  Preamble</A></H2>

<P>
  The licenses for most software are designed to take away your
freedom to share and change it.  By contrast, the GNU General Public
License is intended to guarantee your freedom to share and change free
software--to make sure the software is free for all its users.  This
General Public License applies to most of the Free Software
Foundation's software and to any other program whose authors commit to
using it.  (Some other Free Software Foundation software is covered by
the GNU Library General Public License instead.)  You can apply it to
your programs, too.

</P>
<P>
  When we speak of free software, we are referring to freedom, not
price.  Our General Public Licenses are designed to make sure that you
have the freedom to distribute copies of free software (and charge for
this service if you wish), that you receive source code or can get it
if you want it, that you can change the software or use pieces of it
in new free programs; and that you know you can do these things.

</P>
<P>
  To protect your rights, we need to make restrictions that forbid
anyone to deny you these rights or to ask you to surrender the rights.
These restrictions translate to certain responsibilities for you if you
distribute copies of the software, or if you modify it.

</P>
<P>
  For example, if you distribute copies of such a program, whether
gratis or for a fee, you must give the recipients all the rights that
you have.  You must make sure that they, too, receive or can get the
source code.  And you must show them these terms so they know their
rights.

</P>
<P>
  We protect your rights with two steps: (1) copyright the software, and
(2) offer you this license which gives you legal permission to copy,
distribute and/or modify the software.

</P>
<P>
  Also, for each author's protection and ours, we want to make certain
that everyone understands that there is no warranty for this free
software.  If the software is modified by someone else and passed on, we
want its recipients to know that what they have is not the original, so
that any problems introduced by others will not reflect on the original
authors' reputations.

</P>
<P>
  Finally, any free program is threatened constantly by software
patents.  We wish to avoid the danger that redistributors of a free
program will individually obtain patent licenses, in effect making the
program proprietary.  To prevent this, we have made it clear that any
patent must be licensed for everyone's free use or not licensed at all.

</P>
<P>
  The precise terms and conditions for copying, distribution and
modification follow.

</P>

<H2>9.5  TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION</H2>


<OL>
<LI>

This License applies to any program or other work which contains
a notice placed by the copyright holder saying it may be distributed
under the terms of this General Public License.  The ``Program'', below,
refers to any such program or work, and a ``work based on the Program''
means either the Program or any derivative work under copyright law:
that is to say, a work containing the Program or a portion of it,
either verbatim or with modifications and/or translated into another
language.  (Hereinafter, translation is included without limitation in
the term ``modification''.)  Each licensee is addressed as ``you''.

Activities other than copying, distribution and modification are not
covered by this License; they are outside its scope.  The act of
running the Program is not restricted, and the output from the Program
is covered only if its contents constitute a work based on the
Program (independent of having been made by running the Program).
Whether that is true depends on what the Program does.

<LI>

You may copy and distribute verbatim copies of the Program's
source code as you receive it, in any medium, provided that you
conspicuously and appropriately publish on each copy an appropriate
copyright notice and disclaimer of warranty; keep intact all the
notices that refer to this License and to the absence of any warranty;
and give any other recipients of the Program a copy of this License
along with the Program.

You may charge a fee for the physical act of transferring a copy, and
you may at your option offer warranty protection in exchange for a fee.

<LI>

You may modify your copy or copies of the Program or any portion
of it, thus forming a work based on the Program, and copy and
distribute such modifications or work under the terms of Section 1
above, provided that you also meet all of these conditions:


<OL>
<LI>

You must cause the modified files to carry prominent notices
stating that you changed the files and the date of any change.

<LI>

You must cause any work that you distribute or publish, that in
whole or in part contains or is derived from the Program or any
part thereof, to be licensed as a whole at no charge to all third
parties under the terms of this License.

<LI>

If the modified program normally reads commands interactively
when run, you must cause it, when started running for such
interactive use in the most ordinary way, to print or display an
announcement including an appropriate copyright notice and a
notice that there is no warranty (or else, saying that you provide
a warranty) and that users may redistribute the program under
these conditions, and telling the user how to view a copy of this
License.  (Exception: if the Program itself is interactive but
does not normally print such an announcement, your work based on
the Program is not required to print an announcement.)
</OL>

These requirements apply to the modified work as a whole.  If
identifiable sections of that work are not derived from the Program,
and can be reasonably considered independent and separate works in
themselves, then this License, and its terms, do not apply to those
sections when you distribute them as separate works.  But when you
distribute the same sections as part of a whole which is a work based
on the Program, the distribution of the whole must be on the terms of
this License, whose permissions for other licensees extend to the
entire whole, and thus to each and every part regardless of who wrote it.

Thus, it is not the intent of this section to claim rights or contest
your rights to work written entirely by you; rather, the intent is to
exercise the right to control the distribution of derivative or
collective works based on the Program.

In addition, mere aggregation of another work not based on the Program
with the Program (or with a work based on the Program) on a volume of
a storage or distribution medium does not bring the other work under
the scope of this License.

<LI>

You may copy and distribute the Program (or a work based on it,
under Section 2) in object code or executable form under the terms of
Sections 1 and 2 above provided that you also do one of the following:


<OL>
<LI>

Accompany it with the complete corresponding machine-readable
source code, which must be distributed under the terms of Sections
1 and 2 above on a medium customarily used for software interchange; or,

<LI>

Accompany it with a written offer, valid for at least three
years, to give any third-party, for a charge no more than your
cost of physically performing source distribution, a complete
machine-readable copy of the corresponding source code, to be
distributed under the terms of Sections 1 and 2 above on a medium
customarily used for software interchange; or,

<LI>

Accompany it with the information you received as to the offer
to distribute corresponding source code.  (This alternative is
allowed only for noncommercial distribution and only if you
received the program in object code or executable form with such
an offer, in accord with Subsection b above.)
</OL>

The source code for a work means the preferred form of the work for
making modifications to it.  For an executable work, complete source
code means all the source code for all modules it contains, plus any
associated interface definition files, plus the scripts used to
control compilation and installation of the executable.  However, as a
special exception, the source code distributed need not include
anything that is normally distributed (in either source or binary
form) with the major components (compiler, kernel, and so on) of the
operating system on which the executable runs, unless that component
itself accompanies the executable.

If distribution of executable or object code is made by offering
access to copy from a designated place, then offering equivalent
access to copy the source code from the same place counts as
distribution of the source code, even though third parties are not
compelled to copy the source along with the object code.

<LI>

You may not copy, modify, sublicense, or distribute the Program
except as expressly provided under this License.  Any attempt
otherwise to copy, modify, sublicense or distribute the Program is
void, and will automatically terminate your rights under this License.
However, parties who have received copies, or rights, from you under
this License will not have their licenses terminated so long as such
parties remain in full compliance.

<LI>

You are not required to accept this License, since you have not
signed it.  However, nothing else grants you permission to modify or
distribute the Program or its derivative works.  These actions are
prohibited by law if you do not accept this License.  Therefore, by
modifying or distributing the Program (or any work based on the
Program), you indicate your acceptance of this License to do so, and
all its terms and conditions for copying, distributing or modifying
the Program or works based on it.

<LI>

Each time you redistribute the Program (or any work based on the
Program), the recipient automatically receives a license from the
original licensor to copy, distribute or modify the Program subject to
these terms and conditions.  You may not impose any further
restrictions on the recipients' exercise of the rights granted herein.
You are not responsible for enforcing compliance by third parties to
this License.

<LI>

If, as a consequence of a court judgment or allegation of patent
infringement or for any other reason (not limited to patent issues),
conditions are imposed on you (whether by court order, agreement or
otherwise) that contradict the conditions of this License, they do not
excuse you from the conditions of this License.  If you cannot
distribute so as to satisfy simultaneously your obligations under this
License and any other pertinent obligations, then as a consequence you
may not distribute the Program at all.  For example, if a patent
license would not permit royalty-free redistribution of the Program by
all those who receive copies directly or indirectly through you, then
the only way you could satisfy both it and this License would be to
refrain entirely from distribution of the Program.

If any portion of this section is held invalid or unenforceable under
any particular circumstance, the balance of the section is intended to
apply and the section as a whole is intended to apply in other
circumstances.

It is not the purpose of this section to induce you to infringe any
patents or other property right claims or to contest validity of any
such claims; this section has the sole purpose of protecting the
integrity of the free software distribution system, which is
implemented by public license practices.  Many people have made
generous contributions to the wide range of software distributed
through that system in reliance on consistent application of that
system; it is up to the author/donor to decide if he or she is willing
to distribute software through any other system and a licensee cannot
impose that choice.

This section is intended to make thoroughly clear what is believed to
be a consequence of the rest of this License.

<LI>

If the distribution and/or use of the Program is restricted in
certain countries either by patents or by copyrighted interfaces, the
original copyright holder who places the Program under this License
may add an explicit geographical distribution limitation excluding
those countries, so that distribution is permitted only in or among
countries not thus excluded.  In such case, this License incorporates
the limitation as if written in the body of this License.

<LI>

The Free Software Foundation may publish revised and/or new versions
of the General Public License from time to time.  Such new versions will
be similar in spirit to the present version, but may differ in detail to
address new problems or concerns.

Each version is given a distinguishing version number.  If the Program
specifies a version number of this License which applies to it and ``any
later version'', you have the option of following the terms and conditions
either of that version or of any later version published by the Free
Software Foundation.  If the Program does not specify a version number of
this License, you may choose any version ever published by the Free Software
Foundation.

<LI>

If you wish to incorporate parts of the Program into other free
programs whose distribution conditions are different, write to the author
to ask for permission.  For software which is copyrighted by the Free
Software Foundation, write to the Free Software Foundation; we sometimes
make exceptions for this.  Our decision will be guided by the two goals
of preserving the free status of all derivatives of our free software and
of promoting the sharing and reuse of software generally.



<P><STRONG>9.6  NO WARRANTY</STRONG></P>

<LI>

BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY
FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW.  EXCEPT WHEN
OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES
PROVIDE THE PROGRAM ``AS IS'' WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED
OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  THE ENTIRE RISK AS
TO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU.  SHOULD THE
PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING,
REPAIR OR CORRECTION.

<LI>

IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR
REDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES,
INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING
OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED
TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY
YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER
PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGES.
</OL>


<H2>9.7  END OF TERMS AND CONDITIONS</H2>


<H2>9.8  How to Apply These Terms to Your New Programs</H2>

<P>
  If you develop a new program, and you want it to be of the greatest
possible use to the public, the best way to achieve this is to make it
free software which everyone can redistribute and change under these terms.

</P>
<P>
  To do so, attach the following notices to the program.  It is safest
to attach them to the start of each source file to most effectively
convey the exclusion of warranty; and each file should have at least
the ``copyright'' line and a pointer to where the full notice is found.

</P>

<PRE>
<var>one line to give the program's name and a brief idea of what it does.</var>
Copyright (C) <var>yyyy</var>  <var>name of author</var>

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
</PRE>

<P>
Also add information on how to contact you by electronic and paper mail.

</P>
<P>
If the program is interactive, make it output a short notice like this
when it starts in an interactive mode:

</P>

<PRE>
Gnomovision version 69, Copyright (C) 19<var>yy</var> <var>name of author</var>
Gnomovision comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
This is free software, and you are welcome to redistribute it
under certain conditions; type `show c' for details.
</PRE>

<P>
The hypothetical commands <samp>`show w'</samp> and <samp>`show c'</samp> should show
the appropriate parts of the General Public License.  Of course, the
commands you use may be called something other than <samp>`show w'</samp> and
<samp>`show c'</samp>; they could even be mouse-clicks or menu items--whatever
suits your program.

</P>
<P>
You should also get your employer (if you work as a programmer) or your
school, if any, to sign a ``copyright disclaimer'' for the program, if
necessary.  Here is a sample; alter the names:

</P>

<PRE>
Yoyodyne, Inc., hereby disclaims all copyright interest in the program
`Gnomovision' (which makes passes at compilers) written by James Hacker.

<var>signature of Ty Coon</var>, 1 April 1989
Ty Coon, President of Vice
</PRE>

<P>
This General Public License does not permit incorporating your program into
proprietary programs.  If your program is a subroutine library, you may
consider it more useful to permit linking proprietary applications with the
library.  If this is what you want to do, use the GNU Library General
Public License instead of this License.

</P>



<H1><A NAME="LGPL_license" HREF="manual.ru_toc.html#LGPL_license">H  GNU Lesser General Public License</A></H1>

<P>
<A NAME="IDX1841"></A>
<A NAME="IDX1842"></A>
<A NAME="IDX1843"></A>
<A NAME="IDX1844"></A>

</P>
<P>
Version 2.1, February 1999

</P>

<PRE>
Copyright &copy; 1991, 1999 Free Software Foundation, Inc.
59 Temple Place -- Suite 330, Boston, MA 02111-1307, USA

Everyone is permitted to copy and distribute verbatim copies
of this license document, but changing it is not allowed.

[This is the first released version of the Lesser GPL.  It also counts
as the successor of the GNU Library Public License, version 2, hence the
version number 2.1.]
</PRE>


<H2>9.9  Preamble</H2>

<P>
  The licenses for most software are designed to take away your
freedom to share and change it.  By contrast, the GNU General Public
Licenses are intended to guarantee your freedom to share and change
free software--to make sure the software is free for all its users.

</P>
<P>
  This license, the Lesser General Public License, applies to some
specially designated software--typically libraries--of the Free
Software Foundation and other authors who decide to use it.  You can use
it too, but we suggest you first think carefully about whether this
license or the ordinary General Public License is the better strategy to
use in any particular case, based on the explanations below.

</P>
<P>
  When we speak of free software, we are referring to freedom of use,
not price.  Our General Public Licenses are designed to make sure that
you have the freedom to distribute copies of free software (and charge
for this service if you wish); that you receive source code or can get
it if you want it; that you can change the software and use pieces of it
in new free programs; and that you are informed that you can do these
things.

</P>
<P>
  To protect your rights, we need to make restrictions that forbid
distributors to deny you these rights or to ask you to surrender these
rights.  These restrictions translate to certain responsibilities for
you if you distribute copies of the library or if you modify it.

</P>
<P>
  For example, if you distribute copies of the library, whether gratis
or for a fee, you must give the recipients all the rights that we gave
you.  You must make sure that they, too, receive or can get the source
code.  If you link other code with the library, you must provide
complete object files to the recipients, so that they can relink them
with the library after making changes to the library and recompiling
it.  And you must show them these terms so they know their rights.

</P>
<P>
  We protect your rights with a two-step method: (1) we copyright the
library, and (2) we offer you this license, which gives you legal
permission to copy, distribute and/or modify the library.

</P>
<P>
  To protect each distributor, we want to make it very clear that
there is no warranty for the free library.  Also, if the library is
modified by someone else and passed on, the recipients should know
that what they have is not the original version, so that the original
author's reputation will not be affected by problems that might be
introduced by others.

</P>
<P>
  Finally, software patents pose a constant threat to the existence of
any free program.  We wish to make sure that a company cannot
effectively restrict the users of a free program by obtaining a
restrictive license from a patent holder.  Therefore, we insist that
any patent license obtained for a version of the library must be
consistent with the full freedom of use specified in this license.

</P>
<P>
  Most GNU software, including some libraries, is covered by the
ordinary GNU General Public License.  This license, the GNU Lesser
General Public License, applies to certain designated libraries, and
is quite different from the ordinary General Public License.  We use
this license for certain libraries in order to permit linking those
libraries into non-free programs.

</P>
<P>
  When a program is linked with a library, whether statically or using
a shared library, the combination of the two is legally speaking a
combined work, a derivative of the original library.  The ordinary
General Public License therefore permits such linking only if the
entire combination fits its criteria of freedom.  The Lesser General
Public License permits more lax criteria for linking other code with
the library.

</P>
<P>
  We call this license the <strong>Lesser</strong> General Public License because it
does <em>Less</em> to protect the user's freedom than the ordinary General
Public License.  It also provides other free software developers Less
of an advantage over competing non-free programs.  These disadvantages
are the reason we use the ordinary General Public License for many
libraries.  However, the Lesser license provides advantages in certain
special circumstances.

</P>
<P>
  For example, on rare occasions, there may be a special need to
encourage the widest possible use of a certain library, so that it becomes
a de-facto standard.  To achieve this, non-free programs must be
allowed to use the library.  A more frequent case is that a free
library does the same job as widely used non-free libraries.  In this
case, there is little to gain by limiting the free library to free
software only, so we use the Lesser General Public License.

</P>
<P>
  In other cases, permission to use a particular library in non-free
programs enables a greater number of people to use a large body of
free software.  For example, permission to use the GNU C Library in
non-free programs enables many more people to use the whole GNU
operating system, as well as its variant, the GNU/Linux operating
system.

</P>
<P>
  Although the Lesser General Public License is Less protective of the
users' freedom, it does ensure that the user of a program that is
linked with the Library has the freedom and the wherewithal to run
that program using a modified version of the Library.

</P>
<P>
  The precise terms and conditions for copying, distribution and
modification follow.  Pay close attention to the difference between a
``work based on the library'' and a ``work that uses the library''.  The
former contains code derived from the library, whereas the latter must
be combined with the library in order to run.

</P>

<H2>9.10  TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION</H2>


<OL>
<LI>

This License Agreement applies to any software library or other program
which contains a notice placed by the copyright holder or other
authorized party saying it may be distributed under the terms of this
Lesser General Public License (also called ``this License'').  Each
licensee is addressed as ``you''.

  A ``library'' means a collection of software functions and/or data
prepared so as to be conveniently linked with application programs
(which use some of those functions and data) to form executables.

  The ``Library'', below, refers to any such software library or work
which has been distributed under these terms.  A ``work based on the
Library'' means either the Library or any derivative work under
copyright law: that is to say, a work containing the Library or a
portion of it, either verbatim or with modifications and/or translated
straightforwardly into another language.  (Hereinafter, translation is
included without limitation in the term ``modification''.)

  ``Source code'' for a work means the preferred form of the work for
making modifications to it.  For a library, complete source code means
all the source code for all modules it contains, plus any associated
interface definition files, plus the scripts used to control compilation
and installation of the library.

  Activities other than copying, distribution and modification are not
covered by this License; they are outside its scope.  The act of
running a program using the Library is not restricted, and output from
such a program is covered only if its contents constitute a work based
on the Library (independent of the use of the Library in a tool for
writing it).  Whether that is true depends on what the Library does
and what the program that uses the Library does.

<LI>

You may copy and distribute verbatim copies of the Library's
complete source code as you receive it, in any medium, provided that
you conspicuously and appropriately publish on each copy an
appropriate copyright notice and disclaimer of warranty; keep intact
all the notices that refer to this License and to the absence of any
warranty; and distribute a copy of this License along with the
Library.

  You may charge a fee for the physical act of transferring a copy,
and you may at your option offer warranty protection in exchange for a
fee.

<LI>

You may modify your copy or copies of the Library or any portion
of it, thus forming a work based on the Library, and copy and
distribute such modifications or work under the terms of Section 1
above, provided that you also meet all of these conditions:


<OL>
<LI>

The modified work must itself be a software library.

<LI>

You must cause the files modified to carry prominent notices
stating that you changed the files and the date of any change.

<LI>

You must cause the whole of the work to be licensed at no
charge to all third parties under the terms of this License.

<LI>

If a facility in the modified Library refers to a function or a
table of data to be supplied by an application program that uses
the facility, other than as an argument passed when the facility
is invoked, then you must make a good faith effort to ensure that,
in the event an application does not supply such function or
table, the facility still operates, and performs whatever part of
its purpose remains meaningful.

(For example, a function in a library to compute square roots has
a purpose that is entirely well-defined independent of the
application.  Therefore, Subsection 2d requires that any
application-supplied function or table used by this function must
be optional: if the application does not supply it, the square
root function must still compute square roots.)
</OL>

These requirements apply to the modified work as a whole.  If
identifiable sections of that work are not derived from the Library,
and can be reasonably considered independent and separate works in
themselves, then this License, and its terms, do not apply to those
sections when you distribute them as separate works.  But when you
distribute the same sections as part of a whole which is a work based
on the Library, the distribution of the whole must be on the terms of
this License, whose permissions for other licensees extend to the
entire whole, and thus to each and every part regardless of who wrote
it.

Thus, it is not the intent of this section to claim rights or contest
your rights to work written entirely by you; rather, the intent is to
exercise the right to control the distribution of derivative or
collective works based on the Library.

In addition, mere aggregation of another work not based on the Library
with the Library (or with a work based on the Library) on a volume of
a storage or distribution medium does not bring the other work under
the scope of this License.

<LI>

You may opt to apply the terms of the ordinary GNU General Public
License instead of this License to a given copy of the Library.  To do
this, you must alter all the notices that refer to this License, so
that they refer to the ordinary GNU General Public License, version 2,
instead of to this License.  (If a newer version than version 2 of the
ordinary GNU General Public License has appeared, then you can specify
that version instead if you wish.)  Do not make any other change in
these notices.

  Once this change is made in a given copy, it is irreversible for
that copy, so the ordinary GNU General Public License applies to all
subsequent copies and derivative works made from that copy.

  This option is useful when you wish to copy part of the code of
the Library into a program that is not a library.

<LI>

You may copy and distribute the Library (or a portion or
derivative of it, under Section 2) in object code or executable form
under the terms of Sections 1 and 2 above provided that you accompany
it with the complete corresponding machine-readable source code, which
must be distributed under the terms of Sections 1 and 2 above on a
medium customarily used for software interchange.

  If distribution of object code is made by offering access to copy
from a designated place, then offering equivalent access to copy the
source code from the same place satisfies the requirement to
distribute the source code, even though third parties are not
compelled to copy the source along with the object code.

<LI>

A program that contains no derivative of any portion of the
Library, but is designed to work with the Library by being compiled or
linked with it, is called a ``work that uses the Library''.  Such a
work, in isolation, is not a derivative work of the Library, and
therefore falls outside the scope of this License.

  However, linking a ``work that uses the Library'' with the Library
creates an executable that is a derivative of the Library (because it
contains portions of the Library), rather than a ``work that uses the
library''.  The executable is therefore covered by this License.
Section 6 states terms for distribution of such executables.

  When a ``work that uses the Library'' uses material from a header file
that is part of the Library, the object code for the work may be a
derivative work of the Library even though the source code is not.
Whether this is true is especially significant if the work can be
linked without the Library, or if the work is itself a library.  The
threshold for this to be true is not precisely defined by law.

  If such an object file uses only numerical parameters, data
structure layouts and accessors, and small macros and small inline
functions (ten lines or less in length), then the use of the object
file is unrestricted, regardless of whether it is legally a derivative
work.  (Executables containing this object code plus portions of the
Library will still fall under Section 6.)

  Otherwise, if the work is a derivative of the Library, you may
distribute the object code for the work under the terms of Section 6.
Any executables containing that work also fall under Section 6,
whether they are linked directly with the Library itself.

<LI>

As an exception to the Sections above, you may also combine or
link a ``work that uses the Library'' with the Library to produce a
work containing portions of the Library, and distribute that work
under terms of your choice, provided that the terms permit
modification of the work for the customer's own use and reverse
engineering for debugging such modifications.

  You must give prominent notice with each copy of the work that the
Library is used in it and that the Library and its use are covered by
this License.  You must supply a copy of this License.  If the work
during execution displays copyright notices, you must include the
copyright notice for the Library among them, as well as a reference
directing the user to the copy of this License.  Also, you must do one
of these things:


<OL>
<LI>

Accompany the work with the complete corresponding
machine-readable source code for the Library including whatever
changes were used in the work (which must be distributed under
Sections 1 and 2 above); and, if the work is an executable linked
with the Library, with the complete machine-readable ``work that
uses the Library'', as object code and/or source code, so that the
user can modify the Library and then relink to produce a modified
executable containing the modified Library.  (It is understood
that the user who changes the contents of definitions files in the
Library will not necessarily be able to recompile the application
to use the modified definitions.)

<LI>

Use a suitable shared library mechanism for linking with the Library.  A
suitable mechanism is one that (1) uses at runtime a copy of the
library already present on the user's computer system, rather than
copying library functions into the executable, and (2) will operate
properly with a modified version of the library, if the user installs
one, as long as the modified version is interface-compatible with the
version that the work was made with.

<LI>

Accompany the work with a written offer, valid for at
least three years, to give the same user the materials
specified in Subsection 6a, above, for a charge no more
than the cost of performing this distribution.

<LI>

If distribution of the work is made by offering access to copy
from a designated place, offer equivalent access to copy the above
specified materials from the same place.

<LI>

Verify that the user has already received a copy of these
materials or that you have already sent this user a copy.
</OL>

  For an executable, the required form of the ``work that uses the
Library'' must include any data and utility programs needed for
reproducing the executable from it.  However, as a special exception,
the materials to be distributed need not include anything that is
normally distributed (in either source or binary form) with the major
components (compiler, kernel, and so on) of the operating system on
which the executable runs, unless that component itself accompanies the
executable.

  It may happen that this requirement contradicts the license
restrictions of other proprietary libraries that do not normally
accompany the operating system.  Such a contradiction means you cannot
use both them and the Library together in an executable that you
distribute.

<LI>

You may place library facilities that are a work based on the
Library side-by-side in a single library together with other library
facilities not covered by this License, and distribute such a combined
library, provided that the separate distribution of the work based on
the Library and of the other library facilities is otherwise
permitted, and provided that you do these two things:


<OL>
<LI>

Accompany the combined library with a copy of the same work
based on the Library, uncombined with any other library
facilities.  This must be distributed under the terms of the
Sections above.

<LI>

Give prominent notice with the combined library of the fact
that part of it is a work based on the Library, and explaining
where to find the accompanying uncombined form of the same work.
</OL>

<LI>

You may not copy, modify, sublicense, link with, or distribute
the Library except as expressly provided under this License.  Any
attempt otherwise to copy, modify, sublicense, link with, or
distribute the Library is void, and will automatically terminate your
rights under this License.  However, parties who have received copies,
or rights, from you under this License will not have their licenses
terminated so long as such parties remain in full compliance.

<LI>

You are not required to accept this License, since you have not
signed it.  However, nothing else grants you permission to modify or
distribute the Library or its derivative works.  These actions are
prohibited by law if you do not accept this License.  Therefore, by
modifying or distributing the Library (or any work based on the
Library), you indicate your acceptance of this License to do so, and
all its terms and conditions for copying, distributing or modifying
the Library or works based on it.

<LI>

Each time you redistribute the Library (or any work based on the
Library), the recipient automatically receives a license from the
original licensor to copy, distribute, link with or modify the Library
subject to these terms and conditions.  You may not impose any further
restrictions on the recipients' exercise of the rights granted herein.
You are not responsible for enforcing compliance by third parties with
this License.

<LI>

If, as a consequence of a court judgment or allegation of patent
infringement or for any other reason (not limited to patent issues),
conditions are imposed on you (whether by court order, agreement or
otherwise) that contradict the conditions of this License, they do not
excuse you from the conditions of this License.  If you cannot
distribute so as to satisfy simultaneously your obligations under this
License and any other pertinent obligations, then as a consequence you
may not distribute the Library at all.  For example, if a patent
license would not permit royalty-free redistribution of the Library by
all those who receive copies directly or indirectly through you, then
the only way you could satisfy both it and this License would be to
refrain entirely from distribution of the Library.

If any portion of this section is held invalid or unenforceable under any
particular circumstance, the balance of the section is intended to apply,
and the section as a whole is intended to apply in other circumstances.

It is not the purpose of this section to induce you to infringe any
patents or other property right claims or to contest validity of any
such claims; this section has the sole purpose of protecting the
integrity of the free software distribution system which is
implemented by public license practices.  Many people have made
generous contributions to the wide range of software distributed
through that system in reliance on consistent application of that
system; it is up to the author/donor to decide if he or she is willing
to distribute software through any other system and a licensee cannot
impose that choice.

This section is intended to make thoroughly clear what is believed to
be a consequence of the rest of this License.

<LI>

If the distribution and/or use of the Library is restricted in
certain countries either by patents or by copyrighted interfaces, the
original copyright holder who places the Library under this License may add
an explicit geographical distribution limitation excluding those countries,
so that distribution is permitted only in or among countries not thus
excluded.  In such case, this License incorporates the limitation as if
written in the body of this License.

<LI>

The Free Software Foundation may publish revised and/or new
versions of the Lesser General Public License from time to time.
Such new versions will be similar in spirit to the present version,
but may differ in detail to address new problems or concerns.

Each version is given a distinguishing version number.  If the Library
specifies a version number of this License which applies to it and
``any later version'', you have the option of following the terms and
conditions either of that version or of any later version published by
the Free Software Foundation.  If the Library does not specify a
license version number, you may choose any version ever published by
the Free Software Foundation.

<LI>

If you wish to incorporate parts of the Library into other free
programs whose distribution conditions are incompatible with these,
write to the author to ask for permission.  For software which is
copyrighted by the Free Software Foundation, write to the Free
Software Foundation; we sometimes make exceptions for this.  Our
decision will be guided by the two goals of preserving the free status
of all derivatives of our free software and of promoting the sharing
and reuse of software generally.



<P><STRONG>9.11  NO WARRANTY</STRONG></P>

<LI>

BECAUSE THE LIBRARY IS LICENSED FREE OF CHARGE, THERE IS NO
WARRANTY FOR THE LIBRARY, TO THE EXTENT PERMITTED BY APPLICABLE LAW.
EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR
OTHER PARTIES PROVIDE THE LIBRARY ``AS IS'' WITHOUT WARRANTY OF ANY
KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
PURPOSE.  THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE
LIBRARY IS WITH YOU.  SHOULD THE LIBRARY PROVE DEFECTIVE, YOU ASSUME
THE COST OF ALL NECESSARY SERVICING, REPAIR OR CORRECTION.

<LI>

IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN
WRITING WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY
AND/OR REDISTRIBUTE THE LIBRARY AS PERMITTED ABOVE, BE LIABLE TO YOU
FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR
CONSEQUENTIAL DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THE
LIBRARY (INCLUDING BUT NOT LIMITED TO LOSS OF DATA OR DATA BEING
RENDERED INACCURATE OR LOSSES SUSTAINED BY YOU OR THIRD PARTIES OR A
FAILURE OF THE LIBRARY TO OPERATE WITH ANY OTHER SOFTWARE), EVEN IF
SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH
DAMAGES.
</OL>


<H2>9.12  END OF TERMS AND CONDITIONS</H2>


<H2>9.13  How to Apply These Terms to Your New Libraries</H2>

<P>
  If you develop a new library, and you want it to be of the greatest
possible use to the public, we recommend making it free software that
everyone can redistribute and change.  You can do so by permitting
redistribution under these terms (or, alternatively, under the terms of the
ordinary General Public License).

</P>
<P>
  To apply these terms, attach the following notices to the library.  It is
safest to attach them to the start of each source file to most effectively
convey the exclusion of warranty; and each file should have at least the
``copyright'' line and a pointer to where the full notice is found.

</P>

<PRE>
<var>one line to give the library's name and an idea of what it does.</var>
Copyright (C) <var>year</var>  <var>name of author</var>

This library is free software; you can redistribute it and/or modify it
under the terms of the GNU Lesser General Public License as published by
the Free Software Foundation; either version 2.1 of the License, or (at
your option) any later version.

This library is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public
License along with this library; if not, write to the Free Software
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307,
USA.
</PRE>

<P>
Also add information on how to contact you by electronic and paper mail.

</P>
<P>
You should also get your employer (if you work as a programmer) or your
school, if any, to sign a ``copyright disclaimer'' for the library, if
necessary.  Here is a sample; alter the names:

</P>

<PRE>
Yoyodyne, Inc., hereby disclaims all copyright interest in the library
`Frob' (a library for tweaking knobs) written by James Random Hacker.

<var>signature of Ty Coon</var>, 1 April 1990
Ty Coon, President of Vice
</PRE>

<P>
That's all there is to it!

</P>



<H1><A NAME="Function_Index" HREF="manual.ru_toc.html#Function_Index">Команды SQL, функциональное оглавление</A></H1>

<P>
<H2> </H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX1131">! (логическое NOT)</A>
<LI><A HREF="manual.ru.html#IDX1103">!= (не равно)</A>
<LI><A HREF="manual.ru.html#IDX979">"</A>
<LI><A HREF="manual.ru.html#IDX959">%</A>, <A HREF="manual.ru.html#IDX1225">%</A>
<LI><A HREF="manual.ru.html#IDX1296">&#38; (битовое AND)</A>
<LI><A HREF="manual.ru.html#IDX1133">&#38;&#38; (логическое AND)</A>
<LI><A HREF="manual.ru.html#IDX1091">() (круглые скобки)</A>
<LI><A HREF="manual.ru.html#IDX957">(Control-Z) \z</A>
<LI><A HREF="manual.ru.html#IDX1214">* (умножение)</A>
<LI><A HREF="manual.ru.html#IDX1210">+ (сложение)</A>
<LI><A HREF="manual.ru.html#IDX1219">- (унарный минус)</A>
<LI><A HREF="manual.ru.html#IDX1212">- (вычитание)</A>
<LI><A HREF="manual.ru.html#IDX341">.my.cnf файлы</A>
<LI><A HREF="manual.ru.html#IDX1216">/ (деление)</A>
<LI><A HREF="manual.ru.html#IDX1363">/etc/passwd</A>
<LI><A HREF="manual.ru.html#IDX1107">&#60; (меньше чем)</A>
<LI><A HREF="manual.ru.html#IDX421">&#60;&#60;</A>
<LI><A HREF="manual.ru.html#IDX1300">&#60;&#60; (левый сдвиг)</A>
<LI><A HREF="manual.ru.html#IDX1105">&#60;= (меньше или равно)</A>
<LI><A HREF="manual.ru.html#IDX1114">&#60;=&#62; (равно)</A>
<LI><A HREF="manual.ru.html#IDX1101">&#60;&#62; (не равно)</A>
<LI><A HREF="manual.ru.html#IDX1099">= (равенство)</A>
<LI><A HREF="manual.ru.html#IDX1111">&#62; (больше чем)</A>
<LI><A HREF="manual.ru.html#IDX1109">&#62;= (больше или равно)</A>
<LI><A HREF="manual.ru.html#IDX1301">&#62;&#62; (правый сдвиг)</A>
<LI><A HREF="manual.ru.html#IDX949">\" (двойная кавычка)</A>
<LI><A HREF="manual.ru.html#IDX947">\' (одинарная кавычка)</A>
<LI><A HREF="manual.ru.html#IDX945">\0 (ASCII 0)</A>
<LI><A HREF="manual.ru.html#IDX958">\\</A>
<LI><A HREF="manual.ru.html#IDX951">\b</A>
<LI><A HREF="manual.ru.html#IDX952">\n</A>
<LI><A HREF="manual.ru.html#IDX953">\r</A>
<LI><A HREF="manual.ru.html#IDX954">\t (табуляция)</A>
<LI><A HREF="manual.ru.html#IDX956">\z (Control-Z) ASCII(26)</A>
<LI><A HREF="manual.ru.html#IDX1298">^ (побитовый XOR)</A>
<LI><A HREF="manual.ru.html#IDX960">_</A>
<LI><A HREF="manual.ru.html#IDX978">`</A>
</DIR>
<H2>A</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX1222">ABS()</A>
<LI><A HREF="manual.ru.html#IDX1271">ADDDATE()</A>
<LI><A HREF="manual.ru.html#IDX1319">AES_DECRYPT()</A>
<LI><A HREF="manual.ru.html#IDX1318">AES_ENCRYPT()</A>
<LI><A HREF="manual.ru.html#IDX1772">alias</A>
<LI><A HREF="manual.ru.html#IDX1421">ALTER COLUMN</A>
<LI><A HREF="manual.ru.html#IDX1418">ALTER TABLE</A>, <A HREF="manual.ru.html#IDX1432">ALTER TABLE</A>, <A HREF="manual.ru.html#IDX1778">ALTER TABLE</A>
<LI><A HREF="manual.ru.html#IDX594">ANALYZE TABLE</A>
<LI><A HREF="manual.ru.html#IDX1297">AND, битовое</A>
<LI><A HREF="manual.ru.html#IDX1132">AND, логическое</A>
<LI><A HREF="manual.ru.html#IDX1355">AS</A>, <A HREF="manual.ru.html#IDX1377">AS</A>
<LI><A HREF="manual.ru.html#IDX1146">ASCII()</A>
<LI><A HREF="manual.ru.html#IDX1241">ASIN()</A>
<LI><A HREF="manual.ru.html#IDX1242">ATAN()</A>, <A HREF="manual.ru.html#IDX1243">ATAN()</A>
<LI><A HREF="manual.ru.html#IDX1244">ATAN2()</A>
<LI><A HREF="manual.ru.html#IDX1545">AUTO_INCREMENT, использование с DBI</A>
<LI><A HREF="manual.ru.html#IDX1339">AVG()</A>
</DIR>
<H2>B</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX561">BACKUP TABLE</A>
<LI><A HREF="manual.ru.html#IDX1452">BEGIN</A>
<LI><A HREF="manual.ru.html#IDX1329">BENCHMARK()</A>
<LI><A HREF="manual.ru.html#IDX1120">BETWEEN ... AND</A>
<LI><A HREF="manual.ru.html#IDX1012">BIGINT</A>
<LI><A HREF="manual.ru.html#IDX1149">BIN()</A>
<LI><A HREF="manual.ru.html#IDX1207">BINARY</A>
<LI><A HREF="manual.ru.html#IDX1007">BIT</A>
<LI><A HREF="manual.ru.html#IDX1347">BIT_AND()</A>
<LI><A HREF="manual.ru.html#IDX420">BIT_COUNT</A>
<LI><A HREF="manual.ru.html#IDX1303">BIT_COUNT()</A>
<LI><A HREF="manual.ru.html#IDX1159">BIT_LENGTH()</A>
<LI><A HREF="manual.ru.html#IDX419">BIT_OR</A>
<LI><A HREF="manual.ru.html#IDX1346">BIT_OR()</A>
<LI><A HREF="manual.ru.html#IDX1042">BLOB</A>, <A HREF="manual.ru.html#IDX1064">BLOB</A>
<LI><A HREF="manual.ru.html#IDX1006">BOOL</A>
</DIR>
<H2>C</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX1143">CASE</A>
<LI><A HREF="manual.ru.html#IDX1290">CAST</A>
<LI><A HREF="manual.ru.html#IDX272">CC переменная окружения</A>, <A HREF="manual.ru.html#IDX1795">CC переменная окружения</A>
<LI><A HREF="manual.ru.html#IDX229"><code>CC</code> переменная окружения</A>
<LI><A HREF="manual.ru.html#IDX1793">CCX переменная окружения</A>
<LI><A HREF="manual.ru.html#IDX1227">CEILING()</A>
<LI><A HREF="manual.ru.html#IDX276">CFLAGS переменная окружения</A>, <A HREF="manual.ru.html#IDX1797">CFLAGS переменная окружения</A>
<LI><A HREF="manual.ru.html#IDX1035">CHAR</A>, <A HREF="manual.ru.html#IDX1062">CHAR</A>
<LI><A HREF="manual.ru.html#IDX1038">CHAR VARYING</A>
<LI><A HREF="manual.ru.html#IDX1152">CHAR()</A>
<LI><A HREF="manual.ru.html#IDX1157">CHAR_LENGTH()</A>
<LI><A HREF="manual.ru.html#IDX1036">CHARACTER</A>
<LI><A HREF="manual.ru.html#IDX1037">CHARACTER VARYING</A>
<LI><A HREF="manual.ru.html#IDX1158">CHARACTER_LENGTH()</A>
<LI><A HREF="manual.ru.html#IDX564">CHECK TABLE</A>
<LI><A HREF="manual.ru.html#IDX1126">COALESCE()</A>
<LI><A HREF="manual.ru.html#IDX130">COMMIT</A>, <A HREF="manual.ru.html#IDX1453">COMMIT</A>
<LI><A HREF="manual.ru.html#IDX1153">CONCAT()</A>
<LI><A HREF="manual.ru.html#IDX1154">CONCAT_WS()</A>
<LI><A HREF="manual.ru.html#IDX1325">CONNECTION_ID()</A>
<LI><A HREF="manual.ru.html#IDX1148">CONV()</A>
<LI><A HREF="manual.ru.html#IDX1291">CONVERT</A>
<LI><A HREF="manual.ru.html#IDX1238">COS()</A>
<LI><A HREF="manual.ru.html#IDX1245">COT()</A>
<LI><A HREF="manual.ru.html#IDX1336">COUNT()</A>
<LI><A HREF="manual.ru.html#IDX1337">COUNT(DISTINCT)</A>
<LI><A HREF="manual.ru.html#IDX1404">CREATE DATABASE</A>
<LI><A HREF="manual.ru.html#IDX1697">CREATE FUNCTION</A>
<LI><A HREF="manual.ru.html#IDX1408">CREATE TABLE</A>
<LI><A HREF="manual.ru.html#IDX1367">CROSS JOIN</A>
<LI><A HREF="manual.ru.html#IDX1278">CURDATE()</A>
<LI><A HREF="manual.ru.html#IDX1279">CURRENT_DATE</A>
<LI><A HREF="manual.ru.html#IDX1281">CURRENT_TIME</A>
<LI><A HREF="manual.ru.html#IDX1284">CURRENT_TIMESTAMP</A>
<LI><A HREF="manual.ru.html#IDX1309">CURRENT_USER()</A>
<LI><A HREF="manual.ru.html#IDX1280">CURTIME()</A>
<LI><A HREF="manual.ru.html#IDX231"><code>CXX</code> переменная окружения</A>
<LI><A HREF="manual.ru.html#IDX264">CXX переменная окружения</A>, <A HREF="manual.ru.html#IDX266">CXX переменная окружения</A>, <A HREF="manual.ru.html#IDX274">CXX переменная окружения</A>
<LI><A HREF="manual.ru.html#IDX236">CXXFLAGS переменная окружения</A>, <A HREF="manual.ru.html#IDX240">CXXFLAGS переменная окружения</A>, <A HREF="manual.ru.html#IDX278">CXXFLAGS переменная окружения</A>, <A HREF="manual.ru.html#IDX1799">CXXFLAGS переменная окружения</A>
</DIR>
<H2>D</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX1305">DATABASE()</A>
<LI><A HREF="manual.ru.html#IDX1028">DATE</A>, <A HREF="manual.ru.html#IDX1054">DATE</A>, <A HREF="manual.ru.html#IDX1762">DATE</A>
<LI><A HREF="manual.ru.html#IDX1269">DATE_ADD()</A>
<LI><A HREF="manual.ru.html#IDX1276">DATE_FORMAT()</A>
<LI><A HREF="manual.ru.html#IDX1270">DATE_SUB()</A>
<LI><A HREF="manual.ru.html#IDX1029">DATETIME</A>, <A HREF="manual.ru.html#IDX1053">DATETIME</A>
<LI><A HREF="manual.ru.html#IDX1258">DAYNAME()</A>
<LI><A HREF="manual.ru.html#IDX1255">DAYOFMONTH()</A>
<LI><A HREF="manual.ru.html#IDX1253">DAYOFWEEK()</A>
<LI><A HREF="manual.ru.html#IDX1256">DAYOFYEAR()</A>
<LI><A HREF="manual.ru.html#IDX1537">DBI-&#62;ChopBlanks()</A>
<LI><A HREF="manual.ru.html#IDX1506">DBI-&#62;connect()</A>
<LI><A HREF="manual.ru.html#IDX1535">DBI-&#62;data_sources()</A>
<LI><A HREF="manual.ru.html#IDX1509">DBI-&#62;disconnect</A>
<LI><A HREF="manual.ru.html#IDX1515">DBI-&#62;do</A>
<LI><A HREF="manual.ru.html#IDX1513">DBI-&#62;execute</A>
<LI><A HREF="manual.ru.html#IDX1525">DBI-&#62;fetchall_arrayref()</A>
<LI><A HREF="manual.ru.html#IDX1519">DBI-&#62;fetchrow_array()</A>
<LI><A HREF="manual.ru.html#IDX1521">DBI-&#62;fetchrow_arrayref()</A>
<LI><A HREF="manual.ru.html#IDX1523">DBI-&#62;fetchrow_hashref()</A>
<LI><A HREF="manual.ru.html#IDX1527">DBI-&#62;finish()</A>
<LI><A HREF="manual.ru.html#IDX1511">DBI-&#62;prepare</A>
<LI><A HREF="manual.ru.html#IDX1517">DBI-&#62;quote()</A>
<LI><A HREF="manual.ru.html#IDX1529">DBI-&#62;rows()</A>
<LI><A HREF="manual.ru.html#IDX1539">DBI-&#62;trace()</A>
<LI><A HREF="manual.ru.html#IDX1543">DBI-&#62;{insertid}</A>
<LI><A HREF="manual.ru.html#IDX1546">DBI-&#62;{is_blob}</A>
<LI><A HREF="manual.ru.html#IDX1548">DBI-&#62;{is_key}</A>
<LI><A HREF="manual.ru.html#IDX1554">DBI-&#62;{is_not_null}</A>
<LI><A HREF="manual.ru.html#IDX1550">DBI-&#62;{is_num}</A>
<LI><A HREF="manual.ru.html#IDX1552">DBI-&#62;{is_pri_key}</A>
<LI><A HREF="manual.ru.html#IDX1556">DBI-&#62;{length}</A>
<LI><A HREF="manual.ru.html#IDX1558">DBI-&#62;{max_length}</A>
<LI><A HREF="manual.ru.html#IDX1560">DBI-&#62;{NAME}</A>
<LI><A HREF="manual.ru.html#IDX1531">DBI-&#62;{NULLABLE}</A>
<LI><A HREF="manual.ru.html#IDX1533">DBI-&#62;{NUM_OF_FIELDS}</A>
<LI><A HREF="manual.ru.html#IDX1562">DBI-&#62;{table}</A>
<LI><A HREF="manual.ru.html#IDX1564">DBI-&#62;{type}</A>
<LI><A HREF="manual.ru.html#IDX1803">DBI_TRACE переменная окружения</A>
<LI><A HREF="manual.ru.html#IDX1541"><code>DBI_TRACE</code> переменная окружения</A>
<LI><A HREF="manual.ru.html#IDX1801">DBI_USER переменная окружения</A>
<LI><A HREF="manual.ru.html#IDX1026">DEC</A>
<LI><A HREF="manual.ru.html#IDX1025">DECIMAL</A>
<LI><A HREF="manual.ru.html#IDX1314">DECODE()</A>
<LI><A HREF="manual.ru.html#IDX1249">DEGREES()</A>
<LI><A HREF="manual.ru.html#IDX1394">DELAYED</A>
<LI><A HREF="manual.ru.html#IDX1399">DELETE</A>
<LI><A HREF="manual.ru.html#IDX1321">DES_DECRYPT()</A>
<LI><A HREF="manual.ru.html#IDX1320">DES_ENCRYPT()</A>
<LI><A HREF="manual.ru.html#IDX1448">DESC</A>
<LI><A HREF="manual.ru.html#IDX411">DESCRIBE</A>, <A HREF="manual.ru.html#IDX1449">DESCRIBE</A>
<LI><A HREF="manual.ru.html#IDX391">DISTINCT</A>, <A HREF="manual.ru.html#IDX867">DISTINCT</A>, <A HREF="manual.ru.html#IDX1338">DISTINCT</A>
<LI><A HREF="manual.ru.html#IDX1403">DO</A>
<LI><A HREF="manual.ru.html#IDX1021">DOUBLE</A>
<LI><A HREF="manual.ru.html#IDX1023">DOUBLE PRECISION</A>
<LI><A HREF="manual.ru.html#IDX1405">DROP DATABASE</A>
<LI><A HREF="manual.ru.html#IDX1698">DROP FUNCTION</A>
<LI><A HREF="manual.ru.html#IDX1426">DROP INDEX</A>, <A HREF="manual.ru.html#IDX1443">DROP INDEX</A>
<LI><A HREF="manual.ru.html#IDX1437">DROP TABLE</A>
<LI><A HREF="manual.ru.html#IDX1364">DUMPFILE</A>
</DIR>
<H2>E</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX1180">ELT()</A>
<LI><A HREF="manual.ru.html#IDX1313">ENCODE()</A>
<LI><A HREF="manual.ru.html#IDX1312">ENCRYPT()</A>
<LI><A HREF="manual.ru.html#IDX1069">ENUM</A>
<LI><A HREF="manual.ru.html#IDX1757">Environment variable, TZ</A>
<LI><A HREF="manual.ru.html#IDX1230">EXP()</A>
<LI><A HREF="manual.ru.html#IDX855">EXPLAIN</A>
<LI><A HREF="manual.ru.html#IDX1184">EXPORT_SET()</A>
<LI><A HREF="manual.ru.html#IDX1273">EXTRACT()</A>
</DIR>
<H2>F</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX1181">FIELD()</A>
<LI><A HREF="manual.ru.html#IDX1182">FIND_IN_SET()</A>
<LI><A HREF="manual.ru.html#IDX1015">FLOAT</A>, <A HREF="manual.ru.html#IDX1019">FLOAT</A>
<LI><A HREF="manual.ru.html#IDX1020">FLOAT(M,D)</A>
<LI><A HREF="manual.ru.html#IDX1016">FLOAT(точность)</A>, <A HREF="manual.ru.html#IDX1022">FLOAT(точность)</A>
<LI><A HREF="manual.ru.html#IDX1226">FLOOR()</A>
<LI><A HREF="manual.ru.html#IDX595">FLUSH</A>
<LI><A HREF="manual.ru.html#IDX1360">FORCE INDEX</A>, <A HREF="manual.ru.html#IDX1382">FORCE INDEX</A>
<LI><A HREF="manual.ru.html#IDX1323">FORMAT()</A>
<LI><A HREF="manual.ru.html#IDX1333">FOUND_ROWS()</A>
<LI><A HREF="manual.ru.html#IDX1275">FROM_DAYS()</A>
<LI><A HREF="manual.ru.html#IDX1286">FROM_UNIXTIME()</A>, <A HREF="manual.ru.html#IDX1287">FROM_UNIXTIME()</A>
</DIR>
<H2>G</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX1326">GET_LOCK()</A>
<LI><A HREF="manual.ru.html#IDX514">GRANT</A>
<LI><A HREF="manual.ru.html#IDX534">GRANT statement</A>
<LI><A HREF="manual.ru.html#IDX632">GRANTS</A>
<LI><A HREF="manual.ru.html#IDX1248">GREATEST()</A>
</DIR>
<H2>H</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX1386">HANDLER</A>
<LI><A HREF="manual.ru.html#IDX1151">HEX()</A>
<LI><A HREF="manual.ru.html#IDX1805">HOME переменная окружения</A>
<LI><A HREF="manual.ru.html#IDX289">host.frm, проблемы поиска</A>
<LI><A HREF="manual.ru.html#IDX1264">HOUR()</A>
</DIR>
<H2>I</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX1142">IF()</A>
<LI><A HREF="manual.ru.html#IDX1140">IFNULL()</A>
<LI><A HREF="manual.ru.html#IDX1357">IGNORE INDEX</A>, <A HREF="manual.ru.html#IDX1381">IGNORE INDEX</A>
<LI><A HREF="manual.ru.html#IDX1359">IGNORE KEY</A>, <A HREF="manual.ru.html#IDX1384">IGNORE KEY</A>
<LI><A HREF="manual.ru.html#IDX1122">IN</A>
<LI><A HREF="manual.ru.html#IDX1331">INET_ATON()</A>
<LI><A HREF="manual.ru.html#IDX1330">INET_NTOA()</A>
<LI><A HREF="manual.ru.html#IDX1366">INNER JOIN</A>
<LI><A HREF="manual.ru.html#IDX873">INSERT</A>, <A HREF="manual.ru.html#IDX1387">INSERT</A>
<LI><A HREF="manual.ru.html#IDX1389">INSERT ... SELECT</A>, <A HREF="manual.ru.html#IDX1392">INSERT ... SELECT</A>
<LI><A HREF="manual.ru.html#IDX1393">INSERT DELAYED</A>
<LI><A HREF="manual.ru.html#IDX1179">INSERT()</A>
<LI><A HREF="manual.ru.html#IDX1163">INSTR()</A>
<LI><A HREF="manual.ru.html#IDX1010">INT</A>
<LI><A HREF="manual.ru.html#IDX1011">INTEGER</A>
<LI><A HREF="manual.ru.html#IDX1127">INTERVAL()</A>
<LI><A HREF="manual.ru.html#IDX1116">IS NOT NULL</A>
<LI><A HREF="manual.ru.html#IDX1115">IS NULL</A>
<LI><A HREF="manual.ru.html#IDX898">IS NULL, и индексы</A>
<LI><A HREF="manual.ru.html#IDX1328">IS_FREE_LOCK()</A>
<LI><A HREF="manual.ru.html#IDX1124">ISNULL()</A>
<LI><A HREF="manual.ru.html#IDX1458">ISOLATION LEVEL</A>
</DIR>
<H2>J</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX1365">JOIN</A>
</DIR>
<H2>K</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX599">KILL</A>
</DIR>
<H2>L</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX140">LAST_INSERT_ID()</A>, <A HREF="manual.ru.html#IDX1322">LAST_INSERT_ID()</A>
<LI><A HREF="manual.ru.html#IDX1185">LCASE()</A>
<LI><A HREF="manual.ru.html#IDX327">LD_RUN_PATH переменная окружения</A>, <A HREF="manual.ru.html#IDX347">LD_RUN_PATH переменная окружения</A>, <A HREF="manual.ru.html#IDX359">LD_RUN_PATH переменная окружения</A>, <A HREF="manual.ru.html#IDX1807">LD_RUN_PATH переменная окружения</A>
<LI><A HREF="manual.ru.html#IDX1247">LEAST()</A>
<LI><A HREF="manual.ru.html#IDX869">LEFT JOIN</A>, <A HREF="manual.ru.html#IDX1368">LEFT JOIN</A>
<LI><A HREF="manual.ru.html#IDX1369">LEFT OUTER JOIN</A>
<LI><A HREF="manual.ru.html#IDX1166">LEFT()</A>
<LI><A HREF="manual.ru.html#IDX1155">LENGTH()</A>
<LI><A HREF="manual.ru.html#IDX1195">LIKE</A>
<LI><A HREF="manual.ru.html#IDX894">LIKE, и индексы</A>
<LI><A HREF="manual.ru.html#IDX895">LIKE, и шаблонные символы</A>
<LI><A HREF="manual.ru.html#IDX871">LIMIT</A>, <A HREF="manual.ru.html#IDX1334">LIMIT</A>
<LI><A HREF="manual.ru.html#IDX1231">LN()</A>
<LI><A HREF="manual.ru.html#IDX1402">LOAD DATA INFILE</A>, <A HREF="manual.ru.html#IDX1767">LOAD DATA INFILE</A>
<LI><A HREF="manual.ru.html#IDX1189">LOAD_FILE()</A>
<LI><A HREF="manual.ru.html#IDX1160">LOCATE()</A>, <A HREF="manual.ru.html#IDX1162">LOCATE()</A>
<LI><A HREF="manual.ru.html#IDX1455">LOCK TABLES</A>
<LI><A HREF="manual.ru.html#IDX1232">LOG()</A>
<LI><A HREF="manual.ru.html#IDX1234">LOG10()</A>
<LI><A HREF="manual.ru.html#IDX1233">LOG2()</A>
<LI><A HREF="manual.ru.html#IDX1046">LONGBLOB</A>
<LI><A HREF="manual.ru.html#IDX1047">LONGTEXT</A>
<LI><A HREF="manual.ru.html#IDX1186">LOWER()</A>
<LI><A HREF="manual.ru.html#IDX1164">LPAD()</A>
<LI><A HREF="manual.ru.html#IDX1171">LTRIM()</A>
</DIR>
<H2>M</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX1183">MAKE_SET()</A>
<LI><A HREF="manual.ru.html#IDX1332">MASTER_POS_WAIT()</A>
<LI><A HREF="manual.ru.html#IDX1204">MATCH ... AGAINST()</A>
<LI><A HREF="manual.ru.html#IDX1341">MAX()</A>
<LI><A HREF="manual.ru.html#IDX1315">MD5()</A>
<LI><A HREF="manual.ru.html#IDX1044">MEDIUMBLOB</A>
<LI><A HREF="manual.ru.html#IDX1009">MEDIUMINT</A>
<LI><A HREF="manual.ru.html#IDX1045">MEDIUMTEXT</A>
<LI><A HREF="manual.ru.html#IDX1169">MID()</A>
<LI><A HREF="manual.ru.html#IDX1340">MIN()</A>
<LI><A HREF="manual.ru.html#IDX1265">MINUTE()</A>
<LI><A HREF="manual.ru.html#IDX1224">MOD()</A>
<LI><A HREF="manual.ru.html#IDX1257">MONTH()</A>
<LI><A HREF="manual.ru.html#IDX1259">MONTHNAME()</A>
<LI><A HREF="manual.ru.html#IDX1656"><code>my_init()</code></A>
<LI><A HREF="manual.ru.html#IDX1596">my_ulonglong значения, вывод</A>
<LI><A HREF="manual.ru.html#IDX1599"><code>mysql_affected_rows()</code></A>
<LI><A HREF="manual.ru.html#IDX1600"><code>mysql_change_user()</code></A>
<LI><A HREF="manual.ru.html#IDX1601"><code>mysql_character_set_name()</code></A>
<LI><A HREF="manual.ru.html#IDX1602"><code>mysql_close()</code></A>
<LI><A HREF="manual.ru.html#IDX1603"><code>mysql_connect()</code></A>
<LI><A HREF="manual.ru.html#IDX1604"><code>mysql_create_db()</code></A>
<LI><A HREF="manual.ru.html#IDX1605"><code>mysql_data_seek()</code></A>
<LI><A HREF="manual.ru.html#IDX1809">MYSQL_DEBUG переменная окружения</A>
<LI><A HREF="manual.ru.html#IDX701"><code>MYSQL_DEBUG</code> переменная окружения</A>
<LI><A HREF="manual.ru.html#IDX1606"><code>mysql_debug()</code></A>
<LI><A HREF="manual.ru.html#IDX1607"><code>mysql_drop_db()</code></A>
<LI><A HREF="manual.ru.html#IDX1608"><code>mysql_dump_debug_info()</code></A>
<LI><A HREF="manual.ru.html#IDX1609"><code>mysql_eof()</code></A>, <A HREF="manual.ru.html#IDX1610"><code>mysql_eof()</code></A>
<LI><A HREF="manual.ru.html#IDX1611"><code>mysql_errno()</code></A>
<LI><A HREF="manual.ru.html#IDX1612"><code>mysql_error()</code></A>
<LI><A HREF="manual.ru.html#IDX1613"><code>mysql_escape_string()</code></A>
<LI><A HREF="manual.ru.html#IDX1614"><code>mysql_fetch_field()</code></A>
<LI><A HREF="manual.ru.html#IDX1615"><code>mysql_fetch_field_direct()</code></A>
<LI><A HREF="manual.ru.html#IDX1616"><code>mysql_fetch_fields()</code></A>
<LI><A HREF="manual.ru.html#IDX1617"><code>mysql_fetch_lengths()</code></A>
<LI><A HREF="manual.ru.html#IDX1618"><code>mysql_fetch_row()</code></A>
<LI><A HREF="manual.ru.html#IDX1619"><code>mysql_field_count()</code></A>, <A HREF="manual.ru.html#IDX1639"><code>mysql_field_count()</code></A>
<LI><A HREF="manual.ru.html#IDX1620"><code>mysql_field_seek()</code></A>
<LI><A HREF="manual.ru.html#IDX1621"><code>mysql_field_tell()</code></A>
<LI><A HREF="manual.ru.html#IDX1622"><code>mysql_free_result()</code></A>
<LI><A HREF="manual.ru.html#IDX1623"><code>mysql_get_client_info()</code></A>
<LI><A HREF="manual.ru.html#IDX1625"><code>mysql_get_host_info()</code></A>
<LI><A HREF="manual.ru.html#IDX1626"><code>mysql_get_proto_info()</code></A>
<LI><A HREF="manual.ru.html#IDX1627"><code>mysql_get_server_info()</code></A>
<LI><A HREF="manual.ru.html#IDX1624"><code>mysql_get_server_version()</code></A>
<LI><A HREF="manual.ru.html#IDX1811">MYSQL_HISTFILE переменная окружения</A>
<LI><A HREF="manual.ru.html#IDX1813">MYSQL_HOST переменная окружения</A>
<LI><A HREF="manual.ru.html#IDX1433">mysql_info()</A>
<LI><A HREF="manual.ru.html#IDX1628"><code>mysql_info()</code></A>
<LI><A HREF="manual.ru.html#IDX1629"><code>mysql_init()</code></A>
<LI><A HREF="manual.ru.html#IDX1630"><code>mysql_insert_id()</code></A>
<LI><A HREF="manual.ru.html#IDX139">mysql_insert_id()</A>
<LI><A HREF="manual.ru.html#IDX1631"><code>mysql_kill()</code></A>
<LI><A HREF="manual.ru.html#IDX1632"><code>mysql_list_dbs()</code></A>
<LI><A HREF="manual.ru.html#IDX1633"><code>mysql_list_fields()</code></A>
<LI><A HREF="manual.ru.html#IDX1634"><code>mysql_list_processes()</code></A>, <A HREF="manual.ru.html#IDX1635"><code>mysql_list_processes()</code></A>
<LI><A HREF="manual.ru.html#IDX1636"><code>mysql_list_tables()</code></A>, <A HREF="manual.ru.html#IDX1637"><code>mysql_list_tables()</code></A>
<LI><A HREF="manual.ru.html#IDX1638"><code>mysql_num_fields()</code></A>
<LI><A HREF="manual.ru.html#IDX1640"><code>mysql_num_rows()</code></A>
<LI><A HREF="manual.ru.html#IDX1641"><code>mysql_options()</code></A>
<LI><A HREF="manual.ru.html#IDX1642"><code>mysql_ping()</code></A>
<LI><A HREF="manual.ru.html#IDX1815">MYSQL_PS1 переменная окружения</A>
<LI><A HREF="manual.ru.html#IDX1817">MYSQL_PWD переменная окружения</A>
<LI><A HREF="manual.ru.html#IDX699"><code>MYSQL_PWD</code> переменная окружения</A>
<LI><A HREF="manual.ru.html#IDX1643"><code>mysql_query()</code></A>, <A HREF="manual.ru.html#IDX1662"><code>mysql_query()</code></A>
<LI><A HREF="manual.ru.html#IDX1644"><code>mysql_real_connect()</code></A>
<LI><A HREF="manual.ru.html#IDX1645"><code>mysql_real_escape_string()</code></A>
<LI><A HREF="manual.ru.html#IDX1646"><code>mysql_real_query()</code></A>
<LI><A HREF="manual.ru.html#IDX1647"><code>mysql_reload()</code></A>
<LI><A HREF="manual.ru.html#IDX1648"><code>mysql_row_seek()</code></A>
<LI><A HREF="manual.ru.html#IDX1649"><code>mysql_row_tell()</code></A>
<LI><A HREF="manual.ru.html#IDX1650"><code>mysql_select_db()</code></A>
<LI><A HREF="manual.ru.html#IDX1661"><code>mysql_server_end()</code></A>
<LI><A HREF="manual.ru.html#IDX1660"><code>mysql_server_init()</code></A>
<LI><A HREF="manual.ru.html#IDX1651"><code>mysql_shutdown()</code></A>
<LI><A HREF="manual.ru.html#IDX1652"><code>mysql_stat()</code></A>
<LI><A HREF="manual.ru.html#IDX1653"><code>mysql_store_result()</code></A>, <A HREF="manual.ru.html#IDX1663"><code>mysql_store_result()</code></A>
<LI><A HREF="manual.ru.html#IDX1819">MYSQL_TCP_PORT переменная окружения</A>
<LI><A HREF="manual.ru.html#IDX697"><code>MYSQL_TCP_PORT</code> переменная окружения</A>
<LI><A HREF="manual.ru.html#IDX1658"><code>mysql_thread_end()</code></A>
<LI><A HREF="manual.ru.html#IDX1654"><code>mysql_thread_id()</code></A>
<LI><A HREF="manual.ru.html#IDX1657"><code>mysql_thread_init()</code></A>
<LI><A HREF="manual.ru.html#IDX1659"><code>mysql_thread_safe()</code></A>
<LI><A HREF="manual.ru.html#IDX300">MYSQL_UNIX_PORT переменная окружения</A>, <A HREF="manual.ru.html#IDX1821">MYSQL_UNIX_PORT переменная окружения</A>
<LI><A HREF="manual.ru.html#IDX695"><code>MYSQL_UNIX_PORT</code> переменная окружения</A>
<LI><A HREF="manual.ru.html#IDX1655"><code>mysql_use_result()</code></A>
</DIR>
<H2>N</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX1033">NATIONAL CHAR</A>
<LI><A HREF="manual.ru.html#IDX1370">NATURAL LEFT JOIN</A>
<LI><A HREF="manual.ru.html#IDX1371">NATURAL LEFT OUTER JOIN</A>
<LI><A HREF="manual.ru.html#IDX1374">NATURAL RIGHT JOIN</A>
<LI><A HREF="manual.ru.html#IDX1375">NATURAL RIGHT OUTER JOIN</A>
<LI><A HREF="manual.ru.html#IDX1034">NCHAR</A>
<LI><A HREF="manual.ru.html#IDX1121">NOT BETWEEN</A>
<LI><A HREF="manual.ru.html#IDX1123">NOT IN</A>
<LI><A HREF="manual.ru.html#IDX1196">NOT LIKE</A>
<LI><A HREF="manual.ru.html#IDX1202">NOT REGEXP</A>
<LI><A HREF="manual.ru.html#IDX1130">NOT, логическое</A>
<LI><A HREF="manual.ru.html#IDX1282">NOW()</A>
<LI><A HREF="manual.ru.html#IDX400">NULL</A>, <A HREF="manual.ru.html#IDX946">NULL</A>, <A HREF="manual.ru.html#IDX1766">NULL</A>
<LI><A HREF="manual.ru.html#IDX968">NULL value</A>
<LI><A HREF="manual.ru.html#IDX1141">NULLIF()</A>
<LI><A HREF="manual.ru.html#IDX1027">NUMERIC</A>
</DIR>
<H2>O</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX1150">OCT()</A>
<LI><A HREF="manual.ru.html#IDX1156">OCTET_LENGTH()</A>
<LI><A HREF="manual.ru.html#IDX1311">OLD_PASSWORD()</A>
<LI><A HREF="manual.ru.html#IDX591">OPTIMIZE TABLE</A>
<LI><A HREF="manual.ru.html#IDX1295">OR, битовое</A>
<LI><A HREF="manual.ru.html#IDX1134">OR, логическое</A>
<LI><A HREF="manual.ru.html#IDX1147">ORD()</A>
<LI><A HREF="manual.ru.html#IDX1431">ORDER BY</A>
</DIR>
<H2>P</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX490">PASSWORD()</A>, <A HREF="manual.ru.html#IDX541">PASSWORD()</A>, <A HREF="manual.ru.html#IDX1310">PASSWORD()</A>
<LI><A HREF="manual.ru.html#IDX211">PATH переменная окружения</A>, <A HREF="manual.ru.html#IDX1823">PATH переменная окружения</A>
<LI><A HREF="manual.ru.html#IDX1267">PERIOD_ADD()</A>
<LI><A HREF="manual.ru.html#IDX1268">PERIOD_DIFF()</A>
<LI><A HREF="manual.ru.html#IDX1237">PI()</A>
<LI><A HREF="manual.ru.html#IDX1161">POSITION()</A>
<LI><A HREF="manual.ru.html#IDX1235">POW()</A>
<LI><A HREF="manual.ru.html#IDX1236">POWER()</A>
<LI><A HREF="manual.ru.html#IDX1411">PRIMARY KEY</A>, <A HREF="manual.ru.html#IDX1430">PRIMARY KEY</A>
<LI><A HREF="manual.ru.html#IDX628">PROCESSLIST</A>
</DIR>
<H2>Q</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX1260">QUARTER()</A>
<LI><A HREF="manual.ru.html#IDX1190">QUOTE()</A>
</DIR>
<H2>R</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX1250">RADIANS()</A>
<LI><A HREF="manual.ru.html#IDX1246">RAND()</A>
<LI><A HREF="manual.ru.html#IDX1024">REAL</A>
<LI><A HREF="manual.ru.html#IDX1200">REGEXP</A>
<LI><A HREF="manual.ru.html#IDX1327">RELEASE_LOCK()</A>
<LI><A HREF="manual.ru.html#IDX1436">RENAME TABLE</A>
<LI><A HREF="manual.ru.html#IDX565">REPAIR TABLE</A>
<LI><A HREF="manual.ru.html#IDX1177">REPEAT()</A>
<LI><A HREF="manual.ru.html#IDX1401">REPLACE</A>
<LI><A HREF="manual.ru.html#IDX1388">REPLACE ... SELECT</A>, <A HREF="manual.ru.html#IDX1391">REPLACE ... SELECT</A>
<LI><A HREF="manual.ru.html#IDX1176">REPLACE()</A>
<LI><A HREF="manual.ru.html#IDX563">RESTORE TABLE</A>
<LI><A HREF="manual.ru.html#IDX1178">REVERSE()</A>
<LI><A HREF="manual.ru.html#IDX515">REVOKE</A>
<LI><A HREF="manual.ru.html#IDX1372">RIGHT JOIN</A>
<LI><A HREF="manual.ru.html#IDX1373">RIGHT OUTER JOIN</A>
<LI><A HREF="manual.ru.html#IDX1167">RIGHT()</A>
<LI><A HREF="manual.ru.html#IDX1201">RLIKE</A>
<LI><A HREF="manual.ru.html#IDX131">ROLLBACK</A>, <A HREF="manual.ru.html#IDX1454">ROLLBACK</A>
<LI><A HREF="manual.ru.html#IDX1228">ROUND()</A>, <A HREF="manual.ru.html#IDX1229">ROUND()</A>
<LI><A HREF="manual.ru.html#IDX1165">RPAD()</A>
<LI><A HREF="manual.ru.html#IDX1172">RTRIM()</A>
</DIR>
<H2>S</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX1288">SEC_TO_TIME()</A>
<LI><A HREF="manual.ru.html#IDX1266">SECOND()</A>
<LI><A HREF="manual.ru.html#IDX1353">SELECT</A>
<LI><A HREF="manual.ru.html#IDX129">SELECT INTO TABLE</A>
<LI><A HREF="manual.ru.html#IDX863">SELECT speed</A>
<LI><A HREF="manual.ru.html#IDX856">SELECT, оптимизация</A>
<LI><A HREF="manual.ru.html#IDX1308">SESSION_USER()</A>
<LI><A HREF="manual.ru.html#IDX1048">SET</A>, <A HREF="manual.ru.html#IDX1070">SET</A>
<LI><A HREF="manual.ru.html#IDX932">SET OPTION</A>
<LI><A HREF="manual.ru.html#IDX542">SET PASSWORD оператор</A>
<LI><A HREF="manual.ru.html#IDX1457">SET TRANSACTION</A>
<LI><A HREF="manual.ru.html#IDX1317">SHA()</A>
<LI><A HREF="manual.ru.html#IDX1316">SHA1()</A>
<LI><A HREF="manual.ru.html#IDX604">SHOW COLUMNS</A>
<LI><A HREF="manual.ru.html#IDX613">SHOW CREATE TABLE</A>, <A HREF="manual.ru.html#IDX636">SHOW CREATE TABLE</A>
<LI><A HREF="manual.ru.html#IDX601">SHOW DATABASE INFO</A>
<LI><A HREF="manual.ru.html#IDX602">SHOW DATABASES</A>
<LI><A HREF="manual.ru.html#IDX605">SHOW FIELDS</A>
<LI><A HREF="manual.ru.html#IDX612">SHOW GRANTS</A>, <A HREF="manual.ru.html#IDX633">SHOW GRANTS</A>
<LI><A HREF="manual.ru.html#IDX606">SHOW INDEX</A>
<LI><A HREF="manual.ru.html#IDX607">SHOW KEYS</A>
<LI><A HREF="manual.ru.html#IDX615">SHOW MASTER LOGS</A>
<LI><A HREF="manual.ru.html#IDX614">SHOW MASTER STATUS</A>
<LI><A HREF="manual.ru.html#IDX639">SHOW PRIVILEGES</A>
<LI><A HREF="manual.ru.html#IDX610">SHOW PROCESSLIST</A>, <A HREF="manual.ru.html#IDX629">SHOW PROCESSLIST</A>
<LI><A HREF="manual.ru.html#IDX616">SHOW SLAVE STATUS</A>
<LI><A HREF="manual.ru.html#IDX608">SHOW STATUS</A>
<LI><A HREF="manual.ru.html#IDX611">SHOW TABLE STATUS</A>
<LI><A HREF="manual.ru.html#IDX618">SHOW TABLE TYPES</A>, <A HREF="manual.ru.html#IDX638">SHOW TABLE TYPES</A>
<LI><A HREF="manual.ru.html#IDX603">SHOW TABLES</A>
<LI><A HREF="manual.ru.html#IDX609">SHOW VARIABLES</A>
<LI><A HREF="manual.ru.html#IDX617">SHOW WARNINGS</A>, <A HREF="manual.ru.html#IDX637">SHOW WARNINGS</A>
<LI><A HREF="manual.ru.html#IDX1223">SIGN()</A>
<LI><A HREF="manual.ru.html#IDX1239">SIN()</A>
<LI><A HREF="manual.ru.html#IDX1008">SMALLINT</A>
<LI><A HREF="manual.ru.html#IDX1174">SOUNDEX()</A>
<LI><A HREF="manual.ru.html#IDX1197">SOUNDS LIKE</A>
<LI><A HREF="manual.ru.html#IDX1175">SPACE()</A>
<LI><A HREF="manual.ru.html#IDX1464">SQL_CACHE</A>
<LI><A HREF="manual.ru.html#IDX1465">SQL_NO_CACHE</A>
<LI><A HREF="manual.ru.html#IDX1451">START TRANSACTION</A>
<LI><A HREF="manual.ru.html#IDX535">statements, GRANT</A>
<LI><A HREF="manual.ru.html#IDX1344">STD()</A>
<LI><A HREF="manual.ru.html#IDX1345">STDDEV()</A>
<LI><A HREF="manual.ru.html#IDX1376">STRAIGHT_JOIN</A>
<LI><A HREF="manual.ru.html#IDX1203">STRCMP()</A>
<LI><A HREF="manual.ru.html#IDX1272">SUBDATE()</A>
<LI><A HREF="manual.ru.html#IDX1168">SUBSTRING()</A>
<LI><A HREF="manual.ru.html#IDX1170">SUBSTRING_INDEX()</A>
<LI><A HREF="manual.ru.html#IDX1342">SUM()</A>
<LI><A HREF="manual.ru.html#IDX1283">SYSDATE()</A>
<LI><A HREF="manual.ru.html#IDX1307">SYSTEM_USER()</A>
</DIR>
<H2>T</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX908">table_cache</A>
<LI><A HREF="manual.ru.html#IDX1240">TAN()</A>
<LI><A HREF="manual.ru.html#IDX1043">TEXT</A>, <A HREF="manual.ru.html#IDX1065">TEXT</A>
<LI><A HREF="manual.ru.html#IDX627">threads</A>
<LI><A HREF="manual.ru.html#IDX1031">TIME</A>, <A HREF="manual.ru.html#IDX1058">TIME</A>
<LI><A HREF="manual.ru.html#IDX1277">TIME_FORMAT()</A>
<LI><A HREF="manual.ru.html#IDX1289">TIME_TO_SEC()</A>
<LI><A HREF="manual.ru.html#IDX1030">TIMESTAMP</A>, <A HREF="manual.ru.html#IDX1055">TIMESTAMP</A>
<LI><A HREF="manual.ru.html#IDX1040">TINYBLOB</A>
<LI><A HREF="manual.ru.html#IDX1005">TINYINT</A>
<LI><A HREF="manual.ru.html#IDX1041">TINYTEXT</A>
<LI><A HREF="manual.ru.html#IDX299">TMPDIR переменная окружения</A>, <A HREF="manual.ru.html#IDX1825">TMPDIR переменная окружения</A>
<LI><A HREF="manual.ru.html#IDX1274">TO_DAYS()</A>
<LI><A HREF="manual.ru.html#IDX1173">TRIM()</A>
<LI><A HREF="manual.ru.html#IDX1400">TRUNCATE</A>
<LI><A HREF="manual.ru.html#IDX1251">TRUNCATE()</A>
<LI><A HREF="manual.ru.html#IDX1756">TZ environment variable</A>
<LI><A HREF="manual.ru.html#IDX1827">TZ переменная окружения</A>
</DIR>
<H2>U</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX1187">UCASE()</A>
<LI><A HREF="manual.ru.html#IDX1701">UDF функции</A>
<LI><A HREF="manual.ru.html#IDX1831">UMASK переменная окружения</A>
<LI><A HREF="manual.ru.html#IDX1829">UMASK_DIR переменная окружения</A>
<LI><A HREF="manual.ru.html#IDX416">UNION</A>, <A HREF="manual.ru.html#IDX1385">UNION</A>
<LI><A HREF="manual.ru.html#IDX1429">UNIQUE</A>
<LI><A HREF="manual.ru.html#IDX1285">UNIX_TIMESTAMP()</A>
<LI><A HREF="manual.ru.html#IDX1456">UNLOCK TABLES</A>
<LI><A HREF="manual.ru.html#IDX1398">UPDATE</A>
<LI><A HREF="manual.ru.html#IDX1188">UPPER()</A>
<LI><A HREF="manual.ru.html#IDX1446">USE</A>
<LI><A HREF="manual.ru.html#IDX1356">USE INDEX</A>, <A HREF="manual.ru.html#IDX1380">USE INDEX</A>
<LI><A HREF="manual.ru.html#IDX1358">USE KEY</A>, <A HREF="manual.ru.html#IDX1383">USE KEY</A>
<LI><A HREF="manual.ru.html#IDX1833">USER переменная окружения</A>
<LI><A HREF="manual.ru.html#IDX1306">USER()</A>
</DIR>
<H2>V</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX1039">VARCHAR</A>, <A HREF="manual.ru.html#IDX1063">VARCHAR</A>
<LI><A HREF="manual.ru.html#IDX1343">VARIANCE()</A>
<LI><A HREF="manual.ru.html#IDX1324">VERSION()</A>
</DIR>
<H2>W</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX1261">WEEK()</A>
<LI><A HREF="manual.ru.html#IDX1254">WEEKDAY()</A>
<LI><A HREF="manual.ru.html#IDX865">WHERE</A>
</DIR>
<H2>X</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX1136">XOR, логическое</A>
<LI><A HREF="manual.ru.html#IDX1299">XOR, побитовый</A>
</DIR>
<H2>Y</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX1032">YEAR</A>, <A HREF="manual.ru.html#IDX1059">YEAR</A>
<LI><A HREF="manual.ru.html#IDX1262">YEAR()</A>
<LI><A HREF="manual.ru.html#IDX1263">YEARWEEK()</A>
</DIR>
<H2> </H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX1294">| (битовое OR)</A>
<LI><A HREF="manual.ru.html#IDX1135">|| (логическое OR)</A>
<LI><A HREF="manual.ru.html#IDX1302">~</A>
<LI><A HREF="manual.ru.html#IDX1292">арифметические функции</A>
<LI><A HREF="manual.ru.html#IDX1293">битовые функции</A>
<LI><A HREF="manual.ru.html#IDX1110">больше или равно (&#62;=)</A>
<LI><A HREF="manual.ru.html#IDX1112">больше чем (&#62;)</A>
<LI><A HREF="manual.ru.html#IDX1217">деление (/)</A>
<LI><A HREF="manual.ru.html#IDX950">двойная кавычка (\"</A>
<LI><A HREF="manual.ru.html#IDX439">файл .my.cnf</A>, <A HREF="manual.ru.html#IDX441">файл .my.cnf</A>, <A HREF="manual.ru.html#IDX457">файл .my.cnf</A>, <A HREF="manual.ru.html#IDX513">файл .my.cnf</A>, <A HREF="manual.ru.html#IDX549">файл .my.cnf</A>
<LI><A HREF="manual.ru.html#IDX709">файл .mysql_history</A>
<LI><A HREF="manual.ru.html#IDX586">файл .pid</A>
<LI><A HREF="manual.ru.html#IDX1252">функции даты и времени</A>
<LI><A HREF="manual.ru.html#IDX1137">функции потока управления</A>
<LI><A HREF="manual.ru.html#IDX1191">функции сравнения строк</A>
<LI><A HREF="manual.ru.html#IDX1335">функции, GROUP BY</A>
<LI><A HREF="manual.ru.html#IDX1138">функции, поток управления</A>
<LI><A HREF="manual.ru.html#IDX1145">функции, строки</A>
<LI><A HREF="manual.ru.html#IDX976">идентивикаторы, квотинг</A>
<LI><A HREF="manual.ru.html#IDX1205">конвертирование</A>
<LI><A HREF="manual.ru.html#IDX1092">круглые скобки ( и )</A>
<LI><A HREF="manual.ru.html#IDX977">квотинг идентификаторов</A>
<LI><A HREF="manual.ru.html#IDX1128">логические операторы</A>
<LI><A HREF="manual.ru.html#IDX1218">математические функции</A>
<LI><A HREF="manual.ru.html#IDX1106">меньше или равно (&#60;=)</A>
<LI><A HREF="manual.ru.html#IDX1108">меньше чем (&#60;)</A>
<LI><A HREF="manual.ru.html#IDX1538">метод DBI ChopBlanks()</A>
<LI><A HREF="manual.ru.html#IDX1507">метод DBI connect()</A>
<LI><A HREF="manual.ru.html#IDX1536">метод DBI data_sources()</A>
<LI><A HREF="manual.ru.html#IDX1508">метод DBI disconnect</A>
<LI><A HREF="manual.ru.html#IDX1514">метод DBI do</A>
<LI><A HREF="manual.ru.html#IDX1512">метод DBI execute</A>
<LI><A HREF="manual.ru.html#IDX1526">метод DBI fetchall_arrayref()</A>
<LI><A HREF="manual.ru.html#IDX1520">метод DBI fetchrow_array()</A>
<LI><A HREF="manual.ru.html#IDX1522">метод DBI fetchrow_arrayref()</A>
<LI><A HREF="manual.ru.html#IDX1524">метод DBI fetchrow_hashref()</A>
<LI><A HREF="manual.ru.html#IDX1528">метод DBI finish()</A>
<LI><A HREF="manual.ru.html#IDX1544">метод DBI insertid</A>
<LI><A HREF="manual.ru.html#IDX1547">метод DBI is_blob</A>
<LI><A HREF="manual.ru.html#IDX1549">метод DBI is_key</A>
<LI><A HREF="manual.ru.html#IDX1555">метод DBI is_not_null</A>
<LI><A HREF="manual.ru.html#IDX1551">метод DBI is_num</A>
<LI><A HREF="manual.ru.html#IDX1553">метод DBI is_pri_key</A>
<LI><A HREF="manual.ru.html#IDX1557">метод DBI length</A>
<LI><A HREF="manual.ru.html#IDX1559">метод DBI max_length</A>
<LI><A HREF="manual.ru.html#IDX1561">метод DBI NAME</A>
<LI><A HREF="manual.ru.html#IDX1532">метод DBI NULLABLE</A>
<LI><A HREF="manual.ru.html#IDX1534">метод DBI NUM_OF_FIELDS</A>
<LI><A HREF="manual.ru.html#IDX1510">метод DBI prepare</A>
<LI><A HREF="manual.ru.html#IDX1518">метод DBI quote()</A>
<LI><A HREF="manual.ru.html#IDX1530">метод DBI rows()</A>
<LI><A HREF="manual.ru.html#IDX1563">метод DBI table</A>
<LI><A HREF="manual.ru.html#IDX1540">метод DBI trace()</A>
<LI><A HREF="manual.ru.html#IDX1565">метод DBI type</A>
<LI><A HREF="manual.ru.html#IDX1220">минус, унарный (-)</A>
<LI><A HREF="manual.ru.html#IDX1104">не равно (!=)</A>
<LI><A HREF="manual.ru.html#IDX1102">не равно (&#60;&#62;)</A>
<LI><A HREF="manual.ru.html#IDX948">одинарная кавычка (\')</A>
<LI><A HREF="manual.ru.html#IDX243">опции configure, --with-charset</A>
<LI><A HREF="manual.ru.html#IDX244">опции configure, --with-extra-charsets</A>
<LI><A HREF="manual.ru.html#IDX545">опция -p</A>
<LI><A HREF="manual.ru.html#IDX546">опция -password</A>
<LI><A HREF="manual.ru.html#IDX218">опция without-server</A>
<LI><A HREF="manual.ru.html#IDX556">оператор GRANT</A>
<LI><A HREF="manual.ru.html#IDX539">оператор INSERT, назначить привилегии</A>
<LI><A HREF="manual.ru.html#IDX1095">операторы сравнения</A>
<LI><A HREF="manual.ru.html#IDX540">операторы, INSERT</A>
<LI><A HREF="manual.ru.html#IDX1129">опреаторы, логические</A>
<LI><A HREF="manual.ru.html#IDX1702">определяемые пользователем функции</A>
<LI><A HREF="manual.ru.html#IDX547">параметр -p</A>
<LI><A HREF="manual.ru.html#IDX548">параметр -password</A>
<LI><A HREF="manual.ru.html#IDX555">параметр REQUIRE GRANT</A>
<LI><A HREF="manual.ru.html#IDX432">параметры командной строки</A>
<LI><A HREF="manual.ru.html#IDX705">переменная окружения <code>HOME</code></A>
<LI><A HREF="manual.ru.html#IDX703">переменная окружения <code>MYSQL_HISTFILE</code></A>
<LI><A HREF="manual.ru.html#IDX478">переменная окружения <code>MYSQL_HOST</code></A>
<LI><A HREF="manual.ru.html#IDX480">переменная окружения <code>MYSQL_PWD</code></A>
<LI><A HREF="manual.ru.html#IDX447">переменная окружения <code>MYSQL_TCP_PORT</code></A>
<LI><A HREF="manual.ru.html#IDX454">переменная окружения MYSQL_TCP_PORT</A>
<LI><A HREF="manual.ru.html#IDX446">переменная окружения <code>MYSQL_UNIX_PORT</code></A>
<LI><A HREF="manual.ru.html#IDX453">переменная окружения MYSQL_UNIX_PORT</A>
<LI><A HREF="manual.ru.html#IDX1741">переменная окружения UMASK</A>
<LI><A HREF="manual.ru.html#IDX1743">переменная окружения UMASK_DIR</A>
<LI><A HREF="manual.ru.html#IDX482">переменная окружения <code>USER</code></A>
<LI><A HREF="manual.ru.html#IDX230">переменная окружения, <code>CC</code></A>
<LI><A HREF="manual.ru.html#IDX273">переменная окружения, CC</A>, <A HREF="manual.ru.html#IDX1796">переменная окружения, CC</A>
<LI><A HREF="manual.ru.html#IDX1794">переменная окружения, CCX</A>
<LI><A HREF="manual.ru.html#IDX277">переменная окружения, CFLAGS</A>, <A HREF="manual.ru.html#IDX1798">переменная окружения, CFLAGS</A>
<LI><A HREF="manual.ru.html#IDX232">переменная окружения, <code>CXX</code></A>
<LI><A HREF="manual.ru.html#IDX265">переменная окружения, CXX</A>, <A HREF="manual.ru.html#IDX267">переменная окружения, CXX</A>, <A HREF="manual.ru.html#IDX275">переменная окружения, CXX</A>
<LI><A HREF="manual.ru.html#IDX237">переменная окружения, CXXFLAGS</A>, <A HREF="manual.ru.html#IDX241">переменная окружения, CXXFLAGS</A>, <A HREF="manual.ru.html#IDX279">переменная окружения, CXXFLAGS</A>, <A HREF="manual.ru.html#IDX1800">переменная окружения, CXXFLAGS</A>
<LI><A HREF="manual.ru.html#IDX1804">переменная окружения, DBI_TRACE</A>
<LI><A HREF="manual.ru.html#IDX1542">переменная окружения, <code>DBI_TRACE</code></A>
<LI><A HREF="manual.ru.html#IDX1802">переменная окружения, DBI_USER</A>
<LI><A HREF="manual.ru.html#IDX706">переменная окружения, <code>HOME</code></A>
<LI><A HREF="manual.ru.html#IDX1806">переменная окружения, HOME</A>
<LI><A HREF="manual.ru.html#IDX328">переменная окружения, LD_RUN_PATH</A>, <A HREF="manual.ru.html#IDX348">переменная окружения, LD_RUN_PATH</A>, <A HREF="manual.ru.html#IDX360">переменная окружения, LD_RUN_PATH</A>, <A HREF="manual.ru.html#IDX1808">переменная окружения, LD_RUN_PATH</A>
<LI><A HREF="manual.ru.html#IDX1810">переменная окружения, MYSQL_DEBUG</A>
<LI><A HREF="manual.ru.html#IDX702">переменная окружения, <code>MYSQL_DEBUG</code></A>
<LI><A HREF="manual.ru.html#IDX1812">переменная окружения, MYSQL_HISTFILE</A>
<LI><A HREF="manual.ru.html#IDX704">переменная окружения, <code>MYSQL_HISTFILE</code></A>
<LI><A HREF="manual.ru.html#IDX1814">переменная окружения, MYSQL_HOST</A>
<LI><A HREF="manual.ru.html#IDX479">переменная окружения, <code>MYSQL_HOST</code></A>
<LI><A HREF="manual.ru.html#IDX1816">переменная окружения, MYSQL_PS1</A>
<LI><A HREF="manual.ru.html#IDX481">переменная окружения, <code>MYSQL_PWD</code></A>, <A HREF="manual.ru.html#IDX700">переменная окружения, <code>MYSQL_PWD</code></A>
<LI><A HREF="manual.ru.html#IDX1818">переменная окружения, MYSQL_PWD</A>
<LI><A HREF="manual.ru.html#IDX449">переменная окружения, <code>MYSQL_TCP_PORT</code></A>, <A HREF="manual.ru.html#IDX698">переменная окружения, <code>MYSQL_TCP_PORT</code></A>
<LI><A HREF="manual.ru.html#IDX456">переменная окружения, MYSQL_TCP_PORT</A>, <A HREF="manual.ru.html#IDX1820">переменная окружения, MYSQL_TCP_PORT</A>
<LI><A HREF="manual.ru.html#IDX448">переменная окружения, <code>MYSQL_UNIX_PORT</code></A>, <A HREF="manual.ru.html#IDX696">переменная окружения, <code>MYSQL_UNIX_PORT</code></A>
<LI><A HREF="manual.ru.html#IDX302">переменная окружения, MYSQL_UNIX_PORT</A>, <A HREF="manual.ru.html#IDX455">переменная окружения, MYSQL_UNIX_PORT</A>, <A HREF="manual.ru.html#IDX1822">переменная окружения, MYSQL_UNIX_PORT</A>
<LI><A HREF="manual.ru.html#IDX212">переменная окружения, PATH</A>, <A HREF="manual.ru.html#IDX1824">переменная окружения, PATH</A>
<LI><A HREF="manual.ru.html#IDX301">переменная окружения, TMPDIR</A>, <A HREF="manual.ru.html#IDX1826">переменная окружения, TMPDIR</A>
<LI><A HREF="manual.ru.html#IDX1828">переменная окружения, TZ</A>
<LI><A HREF="manual.ru.html#IDX1742">переменная окружения, UMASK</A>, <A HREF="manual.ru.html#IDX1832">переменная окружения, UMASK</A>
<LI><A HREF="manual.ru.html#IDX1744">переменная окружения, UMASK_DIR</A>, <A HREF="manual.ru.html#IDX1830">переменная окружения, UMASK_DIR</A>
<LI><A HREF="manual.ru.html#IDX483">переменная окружения, <code>USER</code></A>
<LI><A HREF="manual.ru.html#IDX1834">переменная окружения, USER</A>
<LI><A HREF="manual.ru.html#IDX1100">равенство (=)</A>
<LI><A HREF="manual.ru.html#IDX1304">разные функции</A>
<LI><A HREF="manual.ru.html#IDX1211">сложение (+)</A>
<LI><A HREF="manual.ru.html#IDX1192">сравнение строк, функции</A>
<LI><A HREF="manual.ru.html#IDX1144">строковые функции</A>
<LI><A HREF="manual.ru.html#IDX955">табуляция (\t)</A>
<LI><A HREF="manual.ru.html#IDX1595">тип данных C my_ulonglong</A>
<LI><A HREF="manual.ru.html#IDX1590">тип данных C MYSQL</A>
<LI><A HREF="manual.ru.html#IDX1593">тип данных C MYSQL_FIELD</A>
<LI><A HREF="manual.ru.html#IDX1594">тип данных C MYSQL_FIELD_OFFSET</A>
<LI><A HREF="manual.ru.html#IDX1591">тип данных C MYSQL_RES</A>
<LI><A HREF="manual.ru.html#IDX1592">тип данных C MYSQL_ROW</A>
<LI><A HREF="manual.ru.html#IDX1215">умножение (*)</A>
<LI><A HREF="manual.ru.html#IDX1221">унарный минус (-)</A>
<LI><A HREF="manual.ru.html#IDX1213">вычитание (-)</A>
<LI><A HREF="manual.ru.html#IDX967">шестнадцатиричные величины</A>
<LI><A HREF="manual.ru.html#IDX1703">Функции, определяемые пользователем</A>
<LI><A HREF="manual.ru.html#IDX1004">Типы</A>
</DIR>

</P>



<H1><A NAME="Concept_Index" HREF="manual.ru_toc.html#Concept_Index">Концептуальное оглавление</A></H1>

<P>
<H2>A</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX138"><code>ACID</code></A>
<LI><A HREF="manual.ru.html#IDX1492">ACID</A>
<LI><A HREF="manual.ru.html#IDX464">ACLs</A>
<LI><A HREF="manual.ru.html#IDX356">ActiveState Perl</A>
<LI><A HREF="manual.ru.html#IDX431">Apache</A>
<LI><A HREF="manual.ru.html#IDX1496">APIs</A>
<LI><A HREF="manual.ru.html#IDX1582">AUTO-INCREMENT, ODBC</A>
<LI><A HREF="manual.ru.html#IDX423">AUTO_INCREMENT</A>
<LI><A HREF="manual.ru.html#IDX1769"><code>AUTO_INCREMENT</code>, и значения <code>NULL</code></A>
</DIR>
<H2>B</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX729"><code>batch</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX1761">Big5 китайский набор символов</A>
<LI><A HREF="manual.ru.html#IDX422">bit_functions, пример</A>
<LI><A HREF="manual.ru.html#IDX1413"><code>BLOB</code> столбцы, индексация</A>
<LI><A HREF="manual.ru.html#IDX1067"><code>BLOB</code> столбцы, значения по умолчанию</A>
<LI><A HREF="manual.ru.html#IDX1084"><code>BLOB</code>, размер</A>
</DIR>
<H2>C</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX1586">C API</A>
<LI><A HREF="manual.ru.html#IDX1597">C API, функции</A>
<LI><A HREF="manual.ru.html#IDX1580">C++ Builder</A>
<LI><A HREF="manual.ru.html#IDX234">C++ компилятор, <code>gcc</code></A>
<LI><A HREF="manual.ru.html#IDX257">cc1plus проблемы</A>
<LI><A HREF="manual.ru.html#IDX730"><code>character-sets-dir</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX1574">ColdFusion</A>
<LI><A HREF="manual.ru.html#IDX1731">commands out of sync</A>
<LI><A HREF="manual.ru.html#IDX731"><code>compress</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX256">config.cache</A>
<LI><A HREF="manual.ru.html#IDX1729">connection, aborted</A>
<LI><A HREF="manual.ru.html#IDX849">crash-me</A>
<LI><A HREF="manual.ru.html#IDX248">cvs</A>
</DIR>
<H2>D</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX733"><code>database</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX1575">DataJunction</A>
<LI><A HREF="manual.ru.html#IDX1566"><code>DBI/DBD</code></A>
<LI><A HREF="manual.ru.html#IDX760"><code>debug-info</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX732"><code>debug</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX734"><code>default-character-set</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX1396">delayed_insert_limit</A>
<LI><A HREF="manual.ru.html#IDX1579">Delphi</A>
<LI><A HREF="manual.ru.html#IDX1750">disk full</A>
<LI><A HREF="manual.ru.html#IDX930">DNS</A>
</DIR>
<H2>E</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX739"><code>enable-named-commands</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX1087">ENUM, размер</A>
<LI><A HREF="manual.ru.html#IDX810">Errcode</A>
<LI><A HREF="manual.ru.html#IDX809">errno</A>
<LI><A HREF="manual.ru.html#IDX1576">Excel</A>
<LI><A HREF="manual.ru.html#IDX735"><code>execute</code>, опции <code>mysql</code></A>
</DIR>
<H2>F</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX258">fatal signal 11</A>
<LI><A HREF="manual.ru.html#IDX737"><code>force</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX1434">foreign keys</A>
<LI><A HREF="manual.ru.html#IDX271">FreeBSD, осторожно</A>
<LI><A HREF="manual.ru.html#IDX1749">full disk</A>
<LI><A HREF="manual.ru.html#IDX1461">FULLTEXT</A>
</DIR>
<H2>G</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX233"><code>gcc</code></A>
<LI><A HREF="manual.ru.html#IDX22">General Public License</A>
<LI><A HREF="manual.ru.html#IDX73">General Public License, MySQL</A>
<LI><A HREF="manual.ru.html#IDX1839">GPL, General Public License</A>
<LI><A HREF="manual.ru.html#IDX1840">GPL, GNU General Public License</A>
<LI><A HREF="manual.ru.html#IDX74">GPL, MySQL</A>
<LI><A HREF="manual.ru.html#IDX1350"><code>GROUP BY</code>, псевдонимы в</A>
<LI><A HREF="manual.ru.html#IDX1362"><code>GROUP BY</code>, расширение к ANSI SQL</A>
</DIR>
<H2>H</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX725"><code>help</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX741"><code>host</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX349">HP-UX, бинарная поставка</A>
<LI><A HREF="manual.ru.html#IDX742"><code>html</code>, опции <code>mysql</code></A>
</DIR>
<H2>I</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX740"><code>ignore-space</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX1395">INSERT DELAYED</A>
<LI><A HREF="manual.ru.html#IDX113">Internet Relay Chat</A>
<LI><A HREF="manual.ru.html#IDX112">IRC</A>
</DIR>
<H2>J</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX1683">JDBC</A>
</DIR>
<H2>L</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX1844">LGPL, GNU Lesser General Public License</A>
<LI><A HREF="manual.ru.html#IDX1842">LGPL, GNU Library General Public License</A>
<LI><A HREF="manual.ru.html#IDX1843">LGPL, Lesser General Public License</A>
<LI><A HREF="manual.ru.html#IDX1841">LGPL, Library General Public License</A>
<LI><A HREF="manual.ru.html#IDX1676">libmysqld</A>
</DIR>
<H2>M</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX175">Mac OS X, инсталяция</A>
<LI><A HREF="manual.ru.html#IDX663"><code>make_binary_distribution</code></A>
<LI><A HREF="manual.ru.html#IDX768"><code>max_allowed_packet</code></A>
<LI><A HREF="manual.ru.html#IDX771"><code>max_join_size</code></A>
<LI><A HREF="manual.ru.html#IDX281">MIT-pthreads</A>
<LI><A HREF="manual.ru.html#IDX280">MIT-потоки</A>
<LI><A HREF="manual.ru.html#IDX165">mSQL и MySQL - различия в протоколе связи</A>
<LI><A HREF="manual.ru.html#IDX1198">mSQL совместимость</A>
<LI><A HREF="manual.ru.html#IDX160">mSQL, MySQL и mSQL, обзор</A>
<LI><A HREF="manual.ru.html#IDX710"><code>msql2mysql</code></A>
<LI><A HREF="manual.ru.html#IDX673">multi mysqld</A>
<LI><A HREF="manual.ru.html#IDX1732">multi-byte character sets</A>
<LI><A HREF="manual.ru.html#IDX28">My, вариации</A>
<LI><A HREF="manual.ru.html#IDX1089">MyISAM, size</A>
<LI><A HREF="manual.ru.html#IDX688">MyISAM, сжатые таблицы</A>, <A HREF="manual.ru.html#IDX1483">MyISAM, сжатые таблицы</A>
<LI><A HREF="manual.ru.html#IDX245"><code>myisamchk</code></A>, <A HREF="manual.ru.html#IDX662"><code>myisamchk</code></A>
<LI><A HREF="manual.ru.html#IDX567"><code>myisamchk</code>, опции</A>
<LI><A HREF="manual.ru.html#IDX569"><code>myisamchk</code>, параметры</A>
<LI><A HREF="manual.ru.html#IDX590"><code>myisamchk</code>, пример вывода</A>
<LI><A HREF="manual.ru.html#IDX689"><code>myisampack</code></A>, <A HREF="manual.ru.html#IDX1484"><code>myisampack</code></A>
<LI><A HREF="manual.ru.html#IDX1569">MyODBC</A>
<LI><A HREF="manual.ru.html#IDX1585">MyODBC, сообщения о проблемах</A>
<LI><A HREF="manual.ru.html#IDX720"><code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX157">MySQL и будущее</A>
<LI><A HREF="manual.ru.html#IDX16">MySQL, определение</A>
<LI><A HREF="manual.ru.html#IDX24">MySQL, произношение</A>
<LI><A HREF="manual.ru.html#IDX17">MySQL, введение</A>
<LI><A HREF="manual.ru.html#IDX1752"><code>mysql.sock</code>, защита</A>
<LI><A HREF="manual.ru.html#IDX510"><code>mysql_fix_privilege_tables</code></A>
<LI><A HREF="manual.ru.html#IDX666"><code>mysql_install_db</code></A>
<LI><A HREF="manual.ru.html#IDX711"><code>mysqlaccess</code></A>
<LI><A HREF="manual.ru.html#IDX596"><code>mysqladmin</code></A>, <A HREF="manual.ru.html#IDX600"><code>mysqladmin</code></A>, <A HREF="manual.ru.html#IDX623"><code>mysqladmin</code></A>, <A HREF="manual.ru.html#IDX712"><code>mysqladmin</code></A>, <A HREF="manual.ru.html#IDX777"><code>mysqladmin</code></A>, <A HREF="manual.ru.html#IDX1407"><code>mysqladmin</code></A>
<LI><A HREF="manual.ru.html#IDX560"><code>mysqlbinlog</code></A>, <A HREF="manual.ru.html#IDX818"><code>mysqlbinlog</code></A>
<LI><A HREF="manual.ru.html#IDX664"><code>mysqlbug</code></A>
<LI><A HREF="manual.ru.html#IDX101"><code>mysqlbug</code> скрипт</A>
<LI><A HREF="manual.ru.html#IDX665"><code>mysqld</code></A>
<LI><A HREF="manual.ru.html#IDX1737"><code>mysqld</code>, запуск</A>
<LI><A HREF="manual.ru.html#IDX692"><code>mysqld-max</code></A>
<LI><A HREF="manual.ru.html#IDX674"><code>mysqld_multi</code></A>
<LI><A HREF="manual.ru.html#IDX670"><code>mysqld_safe</code></A>
<LI><A HREF="manual.ru.html#IDX325"><code>mysqldump</code></A>, <A HREF="manual.ru.html#IDX713"><code>mysqldump</code></A>
<LI><A HREF="manual.ru.html#IDX326"><code>mysqlimport</code></A>, <A HREF="manual.ru.html#IDX714"><code>mysqlimport</code></A>, <A HREF="manual.ru.html#IDX801"><code>mysqlimport</code></A>
<LI><A HREF="manual.ru.html#IDX715"><code>mysqlshow</code></A>
<LI><A HREF="manual.ru.html#IDX1690">mysqltest, пакет тестирования MySQL</A>
</DIR>
<H2>N</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX769"><code>net_buffer_length</code></A>
<LI><A HREF="manual.ru.html#IDX726"><code>no-auto-rehash</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX728"><code>no-beep</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX738"><code>no-named-commands</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX745"><code>no-pager</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX746"><code>no-tee</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX1726">Non-transactional tables</A>
<LI><A HREF="manual.ru.html#IDX1412"><code>NULL</code> значения, индексы</A>
<LI><A HREF="manual.ru.html#IDX1113"><code>NULL</code>, проверка на NULL</A>, <A HREF="manual.ru.html#IDX1117"><code>NULL</code>, проверка на NULL</A>
<LI><A HREF="manual.ru.html#IDX1125"><code>NULL</code>, проверка на null</A>, <A HREF="manual.ru.html#IDX1139"><code>NULL</code>, проверка на null</A>
</DIR>
<H2>O</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX1567">ODBC</A>
<LI><A HREF="manual.ru.html#IDX1017">ODBC совместимость</A>, <A HREF="manual.ru.html#IDX1097">ODBC совместимость</A>, <A HREF="manual.ru.html#IDX1118">ODBC совместимость</A>, <A HREF="manual.ru.html#IDX1378">ODBC совместимость</A>
<LI><A HREF="manual.ru.html#IDX1570">ODBC, administrator</A>
<LI><A HREF="manual.ru.html#IDX1578">odbcadmin</A>
<LI><A HREF="manual.ru.html#IDX750"><code>one-database</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX550">OpenSSL</A>
<LI><A HREF="manual.ru.html#IDX1348"><code>ORDER BY</code>, псевдонимы в</A>
</DIR>
<H2>P</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX690"><code>pack_isam</code></A>
<LI><A HREF="manual.ru.html#IDX751"><code>pager</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX752"><code>password</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX358">Perl DBI/DBD, проблемы инсталляции</A>
<LI><A HREF="manual.ru.html#IDX352">Perl, инсталляция</A>
<LI><A HREF="manual.ru.html#IDX355">Perl, инсталляция под Windows</A>
<LI><A HREF="manual.ru.html#IDX808">perror</A>
<LI><A HREF="manual.ru.html#IDX1501">PHP API</A>
<LI><A HREF="manual.ru.html#IDX1502">PHP интерфейс</A>
<LI><A HREF="manual.ru.html#IDX753"><code>port</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX166">PostgreSQL и MySQL, сравнение</A>
<LI><A HREF="manual.ru.html#IDX727"><code>prompt</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX754"><code>protocol</code>, <code>mysql</code> option</A>
</DIR>
<H2>Q</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX755"><code>quick</code>, опции <code>mysql</code></A>
</DIR>
<H2>R</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX756"><code>raw</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX173">RedHat package manager</A>
<LI><A HREF="manual.ru.html#IDX1838">regex</A>
<LI><A HREF="manual.ru.html#IDX1837">regexp</A>
<LI><A HREF="manual.ru.html#IDX716"><code>replace</code></A>
<LI><A HREF="manual.ru.html#IDX207">RPM, определение</A>
</DIR>
<H2>S</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX763"><code>safe-updates</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX669"><code>safe_mysqld</code></A>
<LI><A HREF="manual.ru.html#IDX1463"><code>SELECT</code>, Кэш запросов</A>
<LI><A HREF="manual.ru.html#IDX770"><code>select_limit</code></A>
<LI><A HREF="manual.ru.html#IDX1088">SET, размер</A>
<LI><A HREF="manual.ru.html#IDX749"><code>set-variable var=option</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX757"><code>silent</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX748"><code>skip-column-names</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX744"><code>skip-line-numbers</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX758"><code>socket</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX270">Solaris, осторожно</A>
<LI><A HREF="manual.ru.html#IDX20">SQL, определение</A>
<LI><A HREF="manual.ru.html#IDX332">SSH</A>
<LI><A HREF="manual.ru.html#IDX936">stripe</A>
<LI><A HREF="manual.ru.html#IDX128">subSELECT</A>
</DIR>
<H2>T</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX913">table cache</A>
<LI><A HREF="manual.ru.html#IDX1730">table is full</A>
<LI><A HREF="manual.ru.html#IDX759"><code>table</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX330">TCP/IP</A>
<LI><A HREF="manual.ru.html#IDX761"><code>tee</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX10">Texinfo</A>
<LI><A HREF="manual.ru.html#IDX1415"><code>TEXT</code> столбцы, индексация</A>
<LI><A HREF="manual.ru.html#IDX1068"><code>TEXT</code> столбцы, значения по умолчанию</A>
<LI><A HREF="manual.ru.html#IDX1085"><code>TEXT</code>, размер</A>
<LI><A HREF="manual.ru.html#IDX1768"><code>TIMESTAMP</code>, и значения <code>NULL</code></A>
<LI><A HREF="manual.ru.html#IDX1679">TODO libmysqld</A>
</DIR>
<H2>U</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX1695">UDF, определение</A>
<LI><A HREF="manual.ru.html#IDX1710">UDF, возвращаемые значения</A>
<LI><A HREF="manual.ru.html#IDX747"><code>unbuffered</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX779">uptime</A>
<LI><A HREF="manual.ru.html#IDX762"><code>user</code>, опции <code>mysql</code></A>
</DIR>
<H2>V</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX1086"><code>VARCHAR</code>, размер</A>
<LI><A HREF="manual.ru.html#IDX764"><code>verbose</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX765"><code>version</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX736"><code>vertical</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX1581">Visual Basic</A>
</DIR>
<H2>W</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX766"><code>wait</code>, опции <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX1568">Windows</A>
<LI><A HREF="manual.ru.html#IDX339">Windows против Unix</A>
<LI><A HREF="manual.ru.html#IDX338">Windows, компиляция</A>
<LI><A HREF="manual.ru.html#IDX342">Windows, вопросы открытости</A>
<LI><A HREF="manual.ru.html#IDX1577">Word</A>
</DIR>
<H2>X</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX743"><code>xml</code>, опции <code>mysql</code></A>
</DIR>
<H2>Y</H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX42">Y2K</A>
</DIR>
<H2> </H2>
<DIR>
<LI><A HREF="manual.ru.html#IDX776">администратор сервера</A>
<LI><A HREF="manual.ru.html#IDX775">администратор, сервер</A>
<LI><A HREF="manual.ru.html#IDX107">адрес электронной почты, коммерческая поддержка</A>
<LI><A HREF="manual.ru.html#IDX529">анонимный пользоваетль</A>
<LI><A HREF="manual.ru.html#IDX531">анонимный пользователь</A>
<LI><A HREF="manual.ru.html#IDX311">апгрейд</A>
<LI><A HREF="manual.ru.html#IDX314">апгрейд, 4.0 до 4.1</A>
<LI><A HREF="manual.ru.html#IDX323">апгрейд, иные архитектуры</A>
<LI><A HREF="manual.ru.html#IDX321">апгрейд, с 3.20 до 3.21</A>
<LI><A HREF="manual.ru.html#IDX319">апгрейд, с 3.21 до 3.22</A>
<LI><A HREF="manual.ru.html#IDX317">апгрейд, с 3.22 до 3.23</A>
<LI><A HREF="manual.ru.html#IDX315">апгрейд, с 3.23 до 4.0</A>
<LI><A HREF="manual.ru.html#IDX1209">арифметические операторы</A>
<LI><A HREF="manual.ru.html#IDX575">авария, восстановление</A>
<LI><A HREF="manual.ru.html#IDX68">авторские права</A>
<LI><A HREF="manual.ru.html#IDX18">база данных, определение</A>
<LI><A HREF="manual.ru.html#IDX377">база данных, выбор</A>
<LI><A HREF="manual.ru.html#IDX982">база данных, чувствительность к регистру</A>
<LI><A HREF="manual.ru.html#IDX158">базы данных, MySQL и остальные</A>
<LI><A HREF="manual.ru.html#IDX790">базы данных, дамп</A>, <A HREF="manual.ru.html#IDX794">базы данных, дамп</A>
<LI><A HREF="manual.ru.html#IDX971">базы данных, имена</A>
<LI><A HREF="manual.ru.html#IDX374">базы данных, использование</A>
<LI><A HREF="manual.ru.html#IDX409">базы данных, получение информации</A>
<LI><A HREF="manual.ru.html#IDX802">базы данных, просмотр</A>
<LI><A HREF="manual.ru.html#IDX557">базы данных, резервное копирование</A>
<LI><A HREF="manual.ru.html#IDX939">базы данных, символические ссылки</A>
<LI><A HREF="manual.ru.html#IDX373">базы данных, создание</A>
<LI><A HREF="manual.ru.html#IDX827">базы данных, замещение</A>
<LI><A HREF="manual.ru.html#IDX79">бесплатное лицензирование</A>
<LI><A HREF="manual.ru.html#IDX466">безопастность, от хакеров</A>
<LI><A HREF="manual.ru.html#IDX1498">библиотека <code>mysqlclient</code></A>
<LI><A HREF="manual.ru.html#IDX1677">библиотека встраиваемого сервера</A>
<LI><A HREF="manual.ru.html#IDX1500">библиотека, <code>mysqlclient</code></A>
<LI><A HREF="manual.ru.html#IDX188">бинарная поставка</A>, <A HREF="manual.ru.html#IDX203">бинарная поставка</A>
<LI><A HREF="manual.ru.html#IDX350">бинарная поставка, HP-UX</A>
<LI><A HREF="manual.ru.html#IDX329">бинарная поставка, linux</A>
<LI><A HREF="manual.ru.html#IDX204">бинарный дистрибутив</A>
<LI><A HREF="manual.ru.html#IDX206">бинарный дистрибутив, установка</A>
<LI><A HREF="manual.ru.html#IDX816">бинарный журнал обновлений</A>
<LI><A HREF="manual.ru.html#IDX918">блокировка</A>
<LI><A HREF="manual.ru.html#IDX142">блокировка на уровне строки</A>
<LI><A HREF="manual.ru.html#IDX880">блокировка, таблицы</A>
<LI><A HREF="manual.ru.html#IDX25">цели MySQL</A>
<LI><A HREF="manual.ru.html#IDX964">целое число</A>
<LI><A HREF="manual.ru.html#IDX67">цены, поддержка</A>
<LI><A HREF="manual.ru.html#IDX1000">цифры</A>
<LI><A HREF="manual.ru.html#IDX789">дамп, базы данных</A>, <A HREF="manual.ru.html#IDX793">дамп, базы данных</A>
<LI><A HREF="manual.ru.html#IDX798">данные, импорт</A>
<LI><A HREF="manual.ru.html#IDX644">данные, кодировка</A>
<LI><A HREF="manual.ru.html#IDX641">данные, набор символов</A>
<LI><A HREF="manual.ru.html#IDX886">данные, размер</A>
<LI><A HREF="manual.ru.html#IDX383">данные, выборка</A>
<LI><A HREF="manual.ru.html#IDX382">данные, загрузка данных в таблицу</A>
<LI><A HREF="manual.ru.html#IDX398">дата</A>
<LI><A HREF="manual.ru.html#IDX1083">дата, тип</A>
<LI><A HREF="manual.ru.html#IDX312">даунгрейд</A>
<LI><A HREF="manual.ru.html#IDX247">дерево BitKeeper</A>
<LI><A HREF="manual.ru.html#IDX336">диск, распределение данных</A>
<LI><A HREF="manual.ru.html#IDX653">добавить, кодировка</A>
<LI><A HREF="manual.ru.html#IDX651">добавить, набор символов</A>
<LI><A HREF="manual.ru.html#IDX537">добавить, привилегии, новый пользователь</A>
<LI><A HREF="manual.ru.html#IDX209">добавление новых пользователей</A>
<LI><A HREF="manual.ru.html#IDX1693">добавление, новые функции</A>
<LI><A HREF="manual.ru.html#IDX1704">добавление, определяемых пользователем функций</A>
<LI><A HREF="manual.ru.html#IDX1718">добавление, процедуры</A>
<LI><A HREF="manual.ru.html#IDX1715">добавление, родных функции</A>
<LI><A HREF="manual.ru.html#IDX970">допустимые имена</A>
<LI><A HREF="manual.ru.html#IDX296">доступ для записи, <tt>`/tmp'</tt></A>
<LI><A HREF="manual.ru.html#IDX252">файл <tt>`config.cache'</tt></A>
<LI><A HREF="manual.ru.html#IDX831">файл <tt>`my.cnf'</tt></A>
<LI><A HREF="manual.ru.html#IDX226">файл mysql.sock, расположение</A>
<LI><A HREF="manual.ru.html#IDX707">файл истории</A>
<LI><A HREF="manual.ru.html#IDX427">файл скрипта</A>
<LI><A HREF="manual.ru.html#IDX225">файл сокета, расположение</A>
<LI><A HREF="manual.ru.html#IDX38">файл, лимиты размеров</A>
<LI><A HREF="manual.ru.html#IDX1738">файл, права доступа</A>
<LI><A HREF="manual.ru.html#IDX1740">файл, сообщение not found</A>
<LI><A HREF="manual.ru.html#IDX172">файлы RPM</A>
<LI><A HREF="manual.ru.html#IDX436">файлы параметров</A>, <A HREF="manual.ru.html#IDX511">файлы параметров</A>
<LI><A HREF="manual.ru.html#IDX222">файлы журналов</A>, <A HREF="manual.ru.html#IDX811">файлы журналов</A>
<LI><A HREF="manual.ru.html#IDX823">файлы журналов, обслуживание</A>
<LI><A HREF="manual.ru.html#IDX253">файлы, <tt>`config.cache'</tt></A>
<LI><A HREF="manual.ru.html#IDX832">файлы, <tt>`my.cnf'</tt></A>
<LI><A HREF="manual.ru.html#IDX298">файлы, <tt>`tmp'</tt></A>
<LI><A HREF="manual.ru.html#IDX817">файлы, бинарный журнал</A>
<LI><A HREF="manual.ru.html#IDX428">файлы, скрипт</A>
<LI><A HREF="manual.ru.html#IDX648">файлы, сообщения об ошибках</A>
<LI><A HREF="manual.ru.html#IDX799">файлы, текст</A>
<LI><A HREF="manual.ru.html#IDX820">файлы, журнал медленных запросов</A>
<LI><A HREF="manual.ru.html#IDX815">файлы, журнал обновлений</A>
<LI><A HREF="manual.ru.html#IDX813">файлы, журнал запросов</A>
<LI><A HREF="manual.ru.html#IDX223">файлы, журналы</A>, <A HREF="manual.ru.html#IDX821">файлы, журналы</A>
<LI><A HREF="manual.ru.html#IDX573">файлы, восстановление</A>
<LI><A HREF="manual.ru.html#IDX41">функции даты, год 2000</A>
<LI><A HREF="manual.ru.html#IDX1090">функции используемые для <code>SELECT</code> с <code>WHERE</code></A>
<LI><A HREF="manual.ru.html#IDX1093">функции, группировка</A>
<LI><A HREF="manual.ru.html#IDX1692">функции, новые</A>
<LI><A HREF="manual.ru.html#IDX1696">функции, определяемые пользователем</A>
<LI><A HREF="manual.ru.html#IDX1706">функции, определяемые пользователем, определение</A>
<LI><A HREF="manual.ru.html#IDX1700">функция, удаление</A>
<LI><A HREF="manual.ru.html#IDX518">глобальные привилегии</A>
<LI><A HREF="manual.ru.html#IDX1094">группировка, выражение</A>
<LI><A HREF="manual.ru.html#IDX465">хакеры, обезопасить</A>
<LI><A HREF="manual.ru.html#IDX885">хранилище данных</A>
<LI><A HREF="manual.ru.html#IDX145">хранимые процедуры</A>
<LI><A HREF="manual.ru.html#IDX144">хранимые процедуры и триггеры, определение</A>
<LI><A HREF="manual.ru.html#IDX969">имена</A>
<LI><A HREF="manual.ru.html#IDX120">имена баз данных, чувствительность к регистру</A>
<LI><A HREF="manual.ru.html#IDX973">имена индексов</A>
<LI><A HREF="manual.ru.html#IDX522">имена пользователей, и пароли</A>
<LI><A HREF="manual.ru.html#IDX121">имена таблиц, чувствительность к регистру</A>
<LI><A HREF="manual.ru.html#IDX988">имена, переменные</A>
<LI><A HREF="manual.ru.html#IDX980">имена, чувствительность к регистру</A>
<LI><A HREF="manual.ru.html#IDX331">именованные каналы</A>
<LI><A HREF="manual.ru.html#IDX797">импорт, данные</A>
<LI><A HREF="manual.ru.html#IDX27">имя MySQL</A>
<LI><A HREF="manual.ru.html#IDX475">имя хоста по умолчанию</A>
<LI><A HREF="manual.ru.html#IDX476">имя хоста, по умолчанию</A>
<LI><A HREF="manual.ru.html#IDX985">имя псевдонима, чувствительность к регистру</A>
<LI><A HREF="manual.ru.html#IDX984">имя столбца, чувствительность к регистру</A>
<LI><A HREF="manual.ru.html#IDX983">имя таблицы, чувствительность к регистру</A>
<LI><A HREF="manual.ru.html#IDX1428">индекс, удаление</A>, <A HREF="manual.ru.html#IDX1445">индекс, удаление</A>
<LI><A HREF="manual.ru.html#IDX1414">индексация, <code>BLOB</code> столбцы</A>
<LI><A HREF="manual.ru.html#IDX1416">индексация, <code>TEXT</code> столбцы</A>
<LI><A HREF="manual.ru.html#IDX1440">индексы</A>
<LI><A HREF="manual.ru.html#IDX899">индексы, и <code>IS NULL</code></A>
<LI><A HREF="manual.ru.html#IDX896">индексы, и <code>LIKE</code></A>
<LI><A HREF="manual.ru.html#IDX891">индексы, использование</A>
<LI><A HREF="manual.ru.html#IDX892">индексы, левый префикс</A>
<LI><A HREF="manual.ru.html#IDX904">индексы, многостолбцовые</A>
<LI><A HREF="manual.ru.html#IDX626">индексы, размер блока</A>
<LI><A HREF="manual.ru.html#IDX1441">индексы, составные</A>
<LI><A HREF="manual.ru.html#IDX900">индексы, столбцы</A>
<LI><A HREF="manual.ru.html#IDX473">информация о привилегиях, расположение</A>
<LI><A HREF="manual.ru.html#IDX353">инсталляция, Perl</A>
<LI><A HREF="manual.ru.html#IDX354">инсталляция, Perl на Windows</A>
<LI><A HREF="manual.ru.html#IDX1714">инсталляция, UDF</A>
<LI><A HREF="manual.ru.html#IDX171">инсталляция, обзор</A>
<LI><A HREF="manual.ru.html#IDX1719">инсталляция, процедуры</A>
<LI><A HREF="manual.ru.html#IDX176">инсталяция, Mac OS X PKG пакеты</A>
<LI><A HREF="manual.ru.html#IDX1587">интерфейс C</A>
<LI><A HREF="manual.ru.html#IDX1598">интерфейс C, функции</A>
<LI><A HREF="manual.ru.html#IDX1668">интерфейс C, проблемы с линкованием</A>
<LI><A HREF="manual.ru.html#IDX1504">интерфейс <code>DBI</code></A>
<LI><A HREF="manual.ru.html#IDX1503">интерфейс Perl</A>
<LI><A HREF="manual.ru.html#IDX1497">интерфейсы</A>
<LI><A HREF="manual.ru.html#IDX1680">интерфейсы C++</A>
<LI><A HREF="manual.ru.html#IDX1684">интерфейсы Python</A>
<LI><A HREF="manual.ru.html#IDX1685">интерфейсы TCL</A>
<LI><A HREF="manual.ru.html#IDX335">использование множества дисков для распределения данных</A>
<LI><A HREF="manual.ru.html#IDX787">использование памяти</A>, <A HREF="manual.ru.html#IDX929">использование памяти</A>
<LI><A HREF="manual.ru.html#IDX574">использование памяти, myisamchk</A>
<LI><A HREF="manual.ru.html#IDX844">использование, MySQL</A>
<LI><A HREF="manual.ru.html#IDX26">история MySQL</A>
<LI><A HREF="manual.ru.html#IDX708">история командной строки</A>
<LI><A HREF="manual.ru.html#IDX1424">изменение поля</A>
<LI><A HREF="manual.ru.html#IDX506">изменение привилегий</A>
<LI><A HREF="manual.ru.html#IDX310">изменение расположения файла сокета <tt>`mysql.sock'</tt></A>
<LI><A HREF="manual.ru.html#IDX1422">изменение столбца</A>
<LI><A HREF="manual.ru.html#IDX1419">изменение таблицы</A>
<LI><A HREF="manual.ru.html#IDX1779">изменение, таблица</A>
<LI><A HREF="manual.ru.html#IDX1417">изменения определений столбцов</A>
<LI><A HREF="manual.ru.html#IDX224">изменения расположения файла сокета</A>
<LI><A HREF="manual.ru.html#IDX1783">изменить, порядок столбцов</A>
<LI><A HREF="manual.ru.html#IDX525">изначальные, привелегии</A>
<LI><A HREF="manual.ru.html#IDX155">известные проблемы</A>
<LI><A HREF="manual.ru.html#IDX994">ключевое слово</A>
<LI><A HREF="manual.ru.html#IDX992">ключевые слова</A>
<LI><A HREF="manual.ru.html#IDX902">ключи</A>
<LI><A HREF="manual.ru.html#IDX905">ключи, многостолбцовые</A>
<LI><A HREF="manual.ru.html#IDX418">ключи, поиск по двум</A>
<LI><A HREF="manual.ru.html#IDX148">ключи, внешние</A>, <A HREF="manual.ru.html#IDX415">ключи, внешние</A>
<LI><A HREF="manual.ru.html#IDX1674">клиент, поток</A>
<LI><A HREF="manual.ru.html#IDX1669">клиентские программы, линкование</A>
<LI><A HREF="manual.ru.html#IDX1495">клиентские утилиты</A>
<LI><A HREF="manual.ru.html#IDX643">кодировка</A>
<LI><A HREF="manual.ru.html#IDX652">кодировка, добавить</A>
<LI><A HREF="manual.ru.html#IDX774">команда <code>prompt</code></A>
<LI><A HREF="manual.ru.html#IDX778">команда status, результаты</A>
<LI><A HREF="manual.ru.html#IDX833">команды SQL, репликация</A>
<LI><A HREF="manual.ru.html#IDX208">команды для установки бинарного дистрибутива</A>
<LI><A HREF="manual.ru.html#IDX834">команды, репликация</A>
<LI><A HREF="manual.ru.html#IDX773">комманда <code>status</code></A>
<LI><A HREF="manual.ru.html#IDX718">коммандная строка, ктилита</A>
<LI><A HREF="manual.ru.html#IDX772">комманды, список</A>
<LI><A HREF="manual.ru.html#IDX991">комментарии, добавление</A>
<LI><A HREF="manual.ru.html#IDX150">комментарии, начало</A>
<LI><A HREF="manual.ru.html#IDX106">коммерческая поддержка, адрес электронной почты</A>
<LI><A HREF="manual.ru.html#IDX63">коммерческая поддержка, типы</A>
<LI><A HREF="manual.ru.html#IDX163">коммуникационный протокол</A>
<LI><A HREF="manual.ru.html#IDX1713">компиляция, UDF</A>
<LI><A HREF="manual.ru.html#IDX337">компиляция, на Windows</A>
<LI><A HREF="manual.ru.html#IDX915">компиляция, оптимизация</A>
<LI><A HREF="manual.ru.html#IDX249">компиляция, проблемы</A>
<LI><A HREF="manual.ru.html#IDX926">компиляция, скорость</A>
<LI><A HREF="manual.ru.html#IDX227">компиляция, статически</A>
<LI><A HREF="manual.ru.html#IDX1681">компилятор Borland C++</A>
<LI><A HREF="manual.ru.html#IDX263">компилятор C++  не в состоянии создать исполняемый файл</A>
<LI><A HREF="manual.ru.html#IDX235">компилятор, C++ <code>gcc</code></A>
<LI><A HREF="manual.ru.html#IDX48">консалтинг</A>
<LI><A HREF="manual.ru.html#IDX49">консалтинг по MySQL</A>
<LI><A HREF="manual.ru.html#IDX838">конструкция, ограничения</A>
<LI><A HREF="manual.ru.html#IDX883">конструкция, особенность</A>
<LI><A HREF="manual.ru.html#IDX50">консультации</A>
<LI><A HREF="manual.ru.html#IDX51">консультации по MySQL</A>
<LI><A HREF="manual.ru.html#IDX53">контактная информация</A>
<LI><A HREF="manual.ru.html#IDX162">конвертация, утилиты MySQL</A>
<LI><A HREF="manual.ru.html#IDX1003">квадратные скобки</A>
<LI><A HREF="manual.ru.html#IDX598">кэш, очиска</A>
<LI><A HREF="manual.ru.html#IDX931">кэширование имен хостов</A>
<LI><A HREF="manual.ru.html#IDX893">левый префикс индекса</A>
<LI><A HREF="manual.ru.html#IDX69">лицензии</A>
<LI><A HREF="manual.ru.html#IDX60">лицензирование</A>
<LI><A HREF="manual.ru.html#IDX78">лицензирование, бесплатно</A>
<LI><A HREF="manual.ru.html#IDX55">лицензирование, контактная информация</A>
<LI><A HREF="manual.ru.html#IDX75">лицензирование, в примерах</A>
<LI><A HREF="manual.ru.html#IDX37">лимиты, размер файла</A>
<LI><A HREF="manual.ru.html#IDX1670">линкование</A>
<LI><A HREF="manual.ru.html#IDX1667">линкование, проблемы</A>
<LI><A HREF="manual.ru.html#IDX925">линкование, скорость</A>
<LI><A HREF="manual.ru.html#IDX228">линкование, статически</A>
<LI><A HREF="manual.ru.html#IDX1733">линковка, ошибки</A>
<LI><A HREF="manual.ru.html#IDX943">литералы</A>
<LI><A HREF="manual.ru.html#IDX87">логотипы</A>
<LI><A HREF="manual.ru.html#IDX788">максимальный объем памяти</A>
<LI><A HREF="manual.ru.html#IDX782">медленные запросы</A>
<LI><A HREF="manual.ru.html#IDX174">менеджер пакетов RedHat</A>
<LI><A HREF="manual.ru.html#IDX199">место установки по умолчанию</A>
<LI><A HREF="manual.ru.html#IDX659">многобайтовые символы</A>
<LI><A HREF="manual.ru.html#IDX903">многостолбцовые индексы</A>
<LI><A HREF="manual.ru.html#IDX324">модернизация, иные архитектуры</A>
<LI><A HREF="manual.ru.html#IDX33">модули, список</A>
<LI><A HREF="manual.ru.html#IDX1505">модуль Perl DBI</A>
<LI><A HREF="manual.ru.html#IDX363">монитор, терминал</A>
<LI><A HREF="manual.ru.html#IDX640">набор символов</A>
<LI><A HREF="manual.ru.html#IDX242">набор символов, кодировка</A>
<LI><A HREF="manual.ru.html#IDX847">набор тестов</A>
<LI><A HREF="manual.ru.html#IDX192">наименования, версий MySQL</A>
<LI><A HREF="manual.ru.html#IDX285">настрйка, после установки</A>
<LI><A HREF="manual.ru.html#IDX828">настройка master-slave</A>
<LI><A HREF="manual.ru.html#IDX829">настройка головной сервер - подчиненный сервер</A>
<LI><A HREF="manual.ru.html#IDX1678">настройки, встраиваемый сервер</A>
<LI><A HREF="manual.ru.html#IDX520">назначить, привилегии</A>
<LI><A HREF="manual.ru.html#IDX151">начало комментария</A>
<LI><A HREF="manual.ru.html#IDX261">нехватка виртуальной памяти при компиляции</A>
<LI><A HREF="manual.ru.html#IDX450">несколько серверов</A>
<LI><A HREF="manual.ru.html#IDX650">нобор символов, добавить</A>
<LI><A HREF="manual.ru.html#IDX190">номера версий</A>
<LI><A HREF="manual.ru.html#IDX135">обновление, таблицы</A>
<LI><A HREF="manual.ru.html#IDX202">обновления версий MySQL</A>
<LI><A HREF="manual.ru.html#IDX1727">оборванные клиенты</A>
<LI><A HREF="manual.ru.html#IDX1728">оборванные соединения</A>
<LI><A HREF="manual.ru.html#IDX1709">обработка аргументов</A>
<LI><A HREF="manual.ru.html#IDX1712">обработка, ошибки</A>
<LI><A HREF="manual.ru.html#IDX1466">обработчик таблицы, выбор</A>
<LI><A HREF="manual.ru.html#IDX1467">обработчики таблиц MySQL</A>
<LI><A HREF="manual.ru.html#IDX822">обслуживание, файлы журналов</A>
<LI><A HREF="manual.ru.html#IDX1">обзор</A>
<LI><A HREF="manual.ru.html#IDX215">обзор инсталляции</A>
<LI><A HREF="manual.ru.html#IDX2">общая информация</A>
<LI><A HREF="manual.ru.html#IDX860">оценка, производительность запросов</A>
<LI><A HREF="manual.ru.html#IDX839">ограничения, конструкция</A>
<LI><A HREF="manual.ru.html#IDX21"><code>окрытый код</code>, определение</A>
<LI><A HREF="manual.ru.html#IDX364">опции</A>
<LI><A HREF="manual.ru.html#IDX923">опции <code>mysqld</code></A>
<LI><A HREF="manual.ru.html#IDX434">опции mysqld</A>
<LI><A HREF="manual.ru.html#IDX572">опции исправления, myisamchk</A>
<LI><A HREF="manual.ru.html#IDX221">опции конфигурации</A>
<LI><A HREF="manual.ru.html#IDX220">опции, configure</A>
<LI><A HREF="manual.ru.html#IDX566">опции, <code>myisamchk</code></A>
<LI><A HREF="manual.ru.html#IDX433">опции, командная строка</A>
<LI><A HREF="manual.ru.html#IDX723">опции, командная строка, <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX830">опции, репликации</A>
<LI><A HREF="manual.ru.html#IDX262">опция configure, --with-low-memory</A>
<LI><A HREF="manual.ru.html#IDX340">операционные системы, Windows против Unix</A>
<LI><A HREF="manual.ru.html#IDX36">операционные системы, файловый лимит</A>
<LI><A HREF="manual.ru.html#IDX184">операционные системы, поддерживаемые</A>
<LI><A HREF="manual.ru.html#IDX1206">операторы конвертирования</A>
<LI><A HREF="manual.ru.html#IDX1208">операторы, арифметические</A>
<LI><A HREF="manual.ru.html#IDX655">определение символов</A>
<LI><A HREF="manual.ru.html#IDX654">определение, символов</A>
<LI><A HREF="manual.ru.html#IDX1694">определяемые пользователем функции, добавление</A>, <A HREF="manual.ru.html#IDX1705">определяемые пользователем функции, добавление</A>
<LI><A HREF="manual.ru.html#IDX866">оптимизация</A>, <A HREF="manual.ru.html#IDX876">оптимизация</A>
<LI><A HREF="manual.ru.html#IDX916">оптимизация системы</A>
<LI><A HREF="manual.ru.html#IDX868">оптимизация, DISTINCT</A>
<LI><A HREF="manual.ru.html#IDX870">оптимизация, LEFT JOIN</A>
<LI><A HREF="manual.ru.html#IDX872">оптимизация, LIMIT</A>
<LI><A HREF="manual.ru.html#IDX877">оптимизация, советы</A>
<LI><A HREF="manual.ru.html#IDX583">оптимизация, таблицы</A>
<LI><A HREF="manual.ru.html#IDX29">основные возможности MySQL</A>
<LI><A HREF="manual.ru.html#IDX551">основы SSL и X509</A>
<LI><A HREF="manual.ru.html#IDX290">остановка сервера</A>
<LI><A HREF="manual.ru.html#IDX307">остановка сервера, автоматическая</A>
<LI><A HREF="manual.ru.html#IDX308">остановка, автоматическая</A>
<LI><A HREF="manual.ru.html#IDX269">осторожно: FreeBSD</A>
<LI><A HREF="manual.ru.html#IDX268">осторожно: Solaris</A>
<LI><A HREF="manual.ru.html#IDX239">отказ от значений по умолчанию</A>
<LI><A HREF="manual.ru.html#IDX911">открытие, таблицы</A>
<LI><A HREF="manual.ru.html#IDX786">открытые таблицы</A>, <A HREF="manual.ru.html#IDX907">открытые таблицы</A>
<LI><A HREF="manual.ru.html#IDX783">открытые, таблицы</A>
<LI><A HREF="manual.ru.html#IDX519">отобрать, привилегии</A>
<LI><A HREF="manual.ru.html#IDX620">отображение, статус таблиц</A>
<LI><A HREF="manual.ru.html#IDX966">отрицательные значения</A>
<LI><A HREF="manual.ru.html#IDX366">отсоединение, от сервера</A>
<LI><A HREF="manual.ru.html#IDX1776">отсутсвие строк, удовлетворяющих условиям поиска</A>
<LI><A HREF="manual.ru.html#IDX111">ответы на вопросы, рекомендации</A>
<LI><A HREF="manual.ru.html#IDX103">отчет об ошибке, критерии</A>
<LI><A HREF="manual.ru.html#IDX4">отчет, ошибки</A>
<LI><A HREF="manual.ru.html#IDX1583">отчет, проблемы с MyODBC</A>
<LI><A HREF="manual.ru.html#IDX1725">ошибки access denied</A>
<LI><A HREF="manual.ru.html#IDX1013">ошибки округления</A>
<LI><A HREF="manual.ru.html#IDX1723">ошибки, access denied</A>
<LI><A HREF="manual.ru.html#IDX152">ошибки, известные</A>
<LI><A HREF="manual.ru.html#IDX1734">ошибки, линковка</A>
<LI><A HREF="manual.ru.html#IDX1711">ошибки, обработка в UDF</A>
<LI><A HREF="manual.ru.html#IDX3">ошибки, отчет</A>
<LI><A HREF="manual.ru.html#IDX90">ошибки, отчеты</A>, <A HREF="manual.ru.html#IDX97">ошибки, отчеты</A>
<LI><A HREF="manual.ru.html#IDX579">ошибки, проверка таблиц</A>
<LI><A HREF="manual.ru.html#IDX1721">ошибки, распространенные</A>
<LI><A HREF="manual.ru.html#IDX96">ошибки, сообщения</A>
<LI><A HREF="manual.ru.html#IDX1722">ошибки, список</A>
<LI><A HREF="manual.ru.html#IDX597">очистка, кэш</A>
<LI><A HREF="manual.ru.html#IDX425">пакетный режим</A>
<LI><A HREF="manual.ru.html#IDX675">параметр config-file</A>
<LI><A HREF="manual.ru.html#IDX676">параметр example</A>
<LI><A HREF="manual.ru.html#IDX677">параметр help</A>
<LI><A HREF="manual.ru.html#IDX678">параметр log</A>
<LI><A HREF="manual.ru.html#IDX679">параметр mysqladmin</A>
<LI><A HREF="manual.ru.html#IDX680">параметр mysqld</A>
<LI><A HREF="manual.ru.html#IDX681">параметр no-log</A>
<LI><A HREF="manual.ru.html#IDX682">параметр password</A>
<LI><A HREF="manual.ru.html#IDX683">параметр tcp-ip</A>
<LI><A HREF="manual.ru.html#IDX684">параметр user</A>
<LI><A HREF="manual.ru.html#IDX685">параметр version</A>
<LI><A HREF="manual.ru.html#IDX554">параметры касающиеся SSL</A>
<LI><A HREF="manual.ru.html#IDX721">параметры командной строки <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX722">параметры командной строки, <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX435">параметры по умолчанию</A>
<LI><A HREF="manual.ru.html#IDX922">параметры запуска</A>
<LI><A HREF="manual.ru.html#IDX724">параметры запуска, <code>mysql</code></A>
<LI><A HREF="manual.ru.html#IDX917">параметры запуска, настройка</A>
<LI><A HREF="manual.ru.html#IDX438">параметры запуска, по умолчанию</A>
<LI><A HREF="manual.ru.html#IDX568">параметры, <code>myisamchk</code></A>
<LI><A HREF="manual.ru.html#IDX919">параметры, сервер</A>
<LI><A HREF="manual.ru.html#IDX470">пароли, безопастность</A>
<LI><A HREF="manual.ru.html#IDX523">пароли, для пользователей</A>
<LI><A HREF="manual.ru.html#IDX933">пароли, установка</A>
<LI><A HREF="manual.ru.html#IDX526">пароль root</A>
<LI><A HREF="manual.ru.html#IDX1747">пароль, переустановить</A>
<LI><A HREF="manual.ru.html#IDX530">пароль, пользователь root</A>
<LI><A HREF="manual.ru.html#IDX521">пароль, установить</A>, <A HREF="manual.ru.html#IDX543">пароль, установить</A>
<LI><A HREF="manual.ru.html#IDX1746">пароль, забыт</A>
<LI><A HREF="manual.ru.html#IDX52">партнерство с MySQL AB</A>
<LI><A HREF="manual.ru.html#IDX216">патчи, применение</A>
<LI><A HREF="manual.ru.html#IDX251">переконфигурация</A>, <A HREF="manual.ru.html#IDX255">переконфигурация</A>
<LI><A HREF="manual.ru.html#IDX767">переменная <code>connect_timeout</code></A>
<LI><A HREF="manual.ru.html#IDX440">переменные окружения</A>, <A HREF="manual.ru.html#IDX512">переменные окружения</A>, <A HREF="manual.ru.html#IDX660">переменные окружения</A>, <A HREF="manual.ru.html#IDX693">переменные окружения</A>
<LI><A HREF="manual.ru.html#IDX987">переменные пользователя</A>
<LI><A HREF="manual.ru.html#IDX924">переменные, <code>mysqld</code></A>
<LI><A HREF="manual.ru.html#IDX986">переменные, пользователь</A>
<LI><A HREF="manual.ru.html#IDX989">переменные, системные</A>
<LI><A HREF="manual.ru.html#IDX624">переменные, статус</A>
<LI><A HREF="manual.ru.html#IDX625">переменные, значения</A>
<LI><A HREF="manual.ru.html#IDX841">переносимость</A>
<LI><A HREF="manual.ru.html#IDX1751">переполнение диска</A>
<LI><A HREF="manual.ru.html#IDX533">пересоздать, таблицы привелегий</A>
<LI><A HREF="manual.ru.html#IDX1001">плавающая точка</A>
<LI><A HREF="manual.ru.html#IDX59">поддержка</A>
<LI><A HREF="manual.ru.html#IDX186">поддержка потоков</A>
<LI><A HREF="manual.ru.html#IDX282">поддержка потоков, привнесенная</A>
<LI><A HREF="manual.ru.html#IDX649">поддержка языков</A>
<LI><A HREF="manual.ru.html#IDX105">поддержка, адрес электронной почты</A>
<LI><A HREF="manual.ru.html#IDX72">поддержка, лицензирование</A>
<LI><A HREF="manual.ru.html#IDX187">поддержка, операционные системы</A>
<LI><A HREF="manual.ru.html#IDX61">поддержка, типы</A>
<LI><A HREF="manual.ru.html#IDX407">подсчет, строки таблицы</A>
<LI><A HREF="manual.ru.html#IDX126">подзапросы</A>
<LI><A HREF="manual.ru.html#IDX417">поиск, два ключа</A>
<LI><A HREF="manual.ru.html#IDX1759">поиск, и чувствиетльность к регистру</A>
<LI><A HREF="manual.ru.html#IDX1459">поиск, полнотекстовый</A>
<LI><A HREF="manual.ru.html#IDX95">поиск, веб странички MySQL</A>
<LI><A HREF="manual.ru.html#IDX806">показ, информация по базам данным</A>
<LI><A HREF="manual.ru.html#IDX1425">поле, изменение</A>
<LI><A HREF="manual.ru.html#IDX70">политика лицензирования</A>
<LI><A HREF="manual.ru.html#IDX1460">полнотекстовый поиск</A>
<LI><A HREF="manual.ru.html#IDX181">получение MySQL</A>
<LI><A HREF="manual.ru.html#IDX619">получение, информации, <code>SHOW</code></A>
<LI><A HREF="manual.ru.html#IDX845">пользователи, MySQL</A>
<LI><A HREF="manual.ru.html#IDX528">пользователи, root</A>
<LI><A HREF="manual.ru.html#IDX210">пользователи, добавление</A>
<LI><A HREF="manual.ru.html#IDX1748">пользователь root, переустановить пароль</A>
<LI><A HREF="manual.ru.html#IDX1787">помощники, сделавшие вклад в MySQL</A>
<LI><A HREF="manual.ru.html#IDX1781">порядок, столбцы</A>
<LI><A HREF="manual.ru.html#IDX1074">портативность, типы</A>
<LI><A HREF="manual.ru.html#IDX445">после инсталяции, много серверов</A>
<LI><A HREF="manual.ru.html#IDX442">после инсталяции, несколько серверов</A>
<LI><A HREF="manual.ru.html#IDX1665">последняя запись, уникальный ID</A>
<LI><A HREF="manual.ru.html#IDX189">поставка исходных текстов</A>
<LI><A HREF="manual.ru.html#IDX214">поставка исходных текстов, установка</A>
<LI><A HREF="manual.ru.html#IDX780">потоки</A>, <A HREF="manual.ru.html#IDX1688">потоки</A>
<LI><A HREF="manual.ru.html#IDX1673">потоки, клиенты</A>
<LI><A HREF="manual.ru.html#IDX630">потоки, показывать</A>
<LI><A HREF="manual.ru.html#IDX1675">потоковый клиент</A>
<LI><A HREF="manual.ru.html#IDX254">повторный запуск <code>configure</code></A>
<LI><A HREF="manual.ru.html#IDX292">повторый запуск сервера</A>
<LI><A HREF="manual.ru.html#IDX460">права доступа</A>
<LI><A HREF="manual.ru.html#IDX538">права пользователя, добавить</A>
<LI><A HREF="manual.ru.html#IDX462">права, доступ</A>
<LI><A HREF="manual.ru.html#IDX372">приглашение, значения</A>
<LI><A HREF="manual.ru.html#IDX217">применение патчей</A>
<LI><A HREF="manual.ru.html#IDX691">пример, сжатые таблицы</A>
<LI><A HREF="manual.ru.html#IDX963">примеры</A>
<LI><A HREF="manual.ru.html#IDX589">примеры, вывод <code>myisamchk</code></A>
<LI><A HREF="manual.ru.html#IDX413">примеры, запросы</A>
<LI><A HREF="manual.ru.html#IDX459">привилегии доступа</A>
<LI><A HREF="manual.ru.html#IDX516">привилегии, дать</A>
<LI><A HREF="manual.ru.html#IDX536">привилегии, добавить</A>
<LI><A HREF="manual.ru.html#IDX461">привилегии, доступ</A>
<LI><A HREF="manual.ru.html#IDX505">привилегии, изменение</A>
<LI><A HREF="manual.ru.html#IDX524">привилегии, изначальные</A>
<LI><A HREF="manual.ru.html#IDX517">привилегии, отобрать</A>
<LI><A HREF="manual.ru.html#IDX634">привилегии, показать</A>
<LI><A HREF="manual.ru.html#IDX635">привилегии, посмотреть</A>
<LI><A HREF="manual.ru.html#IDX1051">проблема 2000 года</A>
<LI><A HREF="manual.ru.html#IDX39">проблема-2000</A>
<LI><A HREF="manual.ru.html#IDX344">проблемы инсталляции, Solaris</A>
<LI><A HREF="manual.ru.html#IDX345">проблемы инсталляции, tar</A>
<LI><A HREF="manual.ru.html#IDX346">проблемы инсталляции, контрольные суммы</A>
<LI><A HREF="manual.ru.html#IDX304">проблемы при запуске сервера</A>
<LI><A HREF="manual.ru.html#IDX1754">проблемы с временными зонами</A>
<LI><A HREF="manual.ru.html#IDX259">проблемы в <tt>`sql_yacc.cc'</tt></A>
<LI><A HREF="manual.ru.html#IDX1584">проблемы, MyODBC</A>
<LI><A HREF="manual.ru.html#IDX882">проблемы, блокировка таблиц</A>
<LI><A HREF="manual.ru.html#IDX357">проблемы, инсталляция Perl</A>
<LI><A HREF="manual.ru.html#IDX351">проблемы, инсталляция на IBM AIX</A>
<LI><A HREF="manual.ru.html#IDX153">проблемы, известные</A>
<LI><A HREF="manual.ru.html#IDX250">проблемы, компиляция</A>
<LI><A HREF="manual.ru.html#IDX1735">проблемы, линковка</A>
<LI><A HREF="manual.ru.html#IDX99">проблемы, отчеты</A>
<LI><A HREF="manual.ru.html#IDX1724">проблемы, ошибки access denied</A>
<LI><A HREF="manual.ru.html#IDX1720">проблемы, распространенные ошибки</A>
<LI><A HREF="manual.ru.html#IDX98">проблемы, сообщения</A>
<LI><A HREF="manual.ru.html#IDX1764">проблемы, столбец типа <code>DATE</code></A>
<LI><A HREF="manual.ru.html#IDX1755">проблемы, временные зоны</A>
<LI><A HREF="manual.ru.html#IDX303">проблемы, запуск сервера</A>
<LI><A HREF="manual.ru.html#IDX1056">проблемы, значение времени</A>
<LI><A HREF="manual.ru.html#IDX1717">процедуры, добавление</A>
<LI><A HREF="manual.ru.html#IDX631">процессы, показывать</A>
<LI><A HREF="manual.ru.html#IDX76">продажа продуктов</A>
<LI><A HREF="manual.ru.html#IDX77">продукты, продажа</A>
<LI><A HREF="manual.ru.html#IDX884">проектирование базы данных</A>
<LI><A HREF="manual.ru.html#IDX584">профилактика, таблицы</A>
<LI><A HREF="manual.ru.html#IDX842">программа crash-me</A>, <A HREF="manual.ru.html#IDX848">программа crash-me</A>
<LI><A HREF="manual.ru.html#IDX1571">программы для Access</A>
<LI><A HREF="manual.ru.html#IDX1572">программы для ADO</A>
<LI><A HREF="manual.ru.html#IDX1573">программы для Borland Builder 4</A>
<LI><A HREF="manual.ru.html#IDX843">программы, crash-me</A>
<LI><A HREF="manual.ru.html#IDX1672">программы, клиенты</A>
<LI><A HREF="manual.ru.html#IDX661">программы, список</A>, <A HREF="manual.ru.html#IDX694">программы, список</A>
<LI><A HREF="manual.ru.html#IDX23">произношение, MySQL</A>
<LI><A HREF="manual.ru.html#IDX935">производительность</A>
<LI><A HREF="manual.ru.html#IDX862">производительность, оценка</A>
<LI><A HREF="manual.ru.html#IDX851">производительность, тесты</A>
<LI><A HREF="manual.ru.html#IDX890">производительность, улучшение</A>
<LI><A HREF="manual.ru.html#IDX836">производительность, увеливечение</A>
<LI><A HREF="manual.ru.html#IDX803">просмотр, информация по базам данным</A>
<LI><A HREF="manual.ru.html#IDX1477">пространство для ключей, MyISAM</A>
<LI><A HREF="manual.ru.html#IDX322">протокол коммуникации</A>
<LI><A HREF="manual.ru.html#IDX164">протокол связи</A>
<LI><A HREF="manual.ru.html#IDX84">провайдеры услуг Internet</A>
<LI><A HREF="manual.ru.html#IDX83">провайдеры услуг интернет</A>
<LI><A HREF="manual.ru.html#IDX853">проверка прав, эффект на скорость</A>
<LI><A HREF="manual.ru.html#IDX577">проверка, таблиц на ошибки</A>
<LI><A HREF="manual.ru.html#IDX570">проверочные опции, myisamchk</A>
<LI><A HREF="manual.ru.html#IDX1361">псевдоним таблицы</A>
<LI><A HREF="manual.ru.html#IDX1351">псевдонимы в <code>GROUP BY</code></A>
<LI><A HREF="manual.ru.html#IDX1352">псевдонимы выражений</A>, <A HREF="manual.ru.html#IDX1354">псевдонимы выражений</A>
<LI><A HREF="manual.ru.html#IDX975">псевдонимы, имена</A>
<LI><A HREF="manual.ru.html#IDX1349">псевдонимы, в <code>ORDER BY</code></A>
<LI><A HREF="manual.ru.html#IDX57">работа на MySQL</A>
<LI><A HREF="manual.ru.html#IDX85">работа на веб-сервере</A>
<LI><A HREF="manual.ru.html#IDX118">работа в режиме ANSI</A>
<LI><A HREF="manual.ru.html#IDX54">работа, контактная информация</A>
<LI><A HREF="manual.ru.html#IDX7">расположение руководства в сети</A>
<LI><A HREF="manual.ru.html#IDX116">расширения по сравнению с ANSI SQL</A>
<LI><A HREF="manual.ru.html#IDX117">расширения по сравнению с ANSI SQL92</A>
<LI><A HREF="manual.ru.html#IDX921">размер буфера, сервер <code>mysqld</code></A>
<LI><A HREF="manual.ru.html#IDX888">размер ранилища, минимизция</A>
<LI><A HREF="manual.ru.html#IDX35">размер таблиц</A>
<LI><A HREF="manual.ru.html#IDX998">размер вывода</A>
<LI><A HREF="manual.ru.html#IDX1499">размеры буферов, клиент</A>
<LI><A HREF="manual.ru.html#IDX1786">разработчики, список</A>
<LI><A HREF="manual.ru.html#IDX56">реклама, контактная информация</A>
<LI><A HREF="manual.ru.html#IDX19">реляционная база данных, определение</A>
<LI><A HREF="manual.ru.html#IDX581">ремонт, таблицы</A>
<LI><A HREF="manual.ru.html#IDX824">репликация</A>
<LI><A HREF="manual.ru.html#IDX835">репликация, команды</A>
<LI><A HREF="manual.ru.html#IDX293">рестарт сервера</A>
<LI><A HREF="manual.ru.html#IDX424">режим, пакетный</A>
<LI><A HREF="manual.ru.html#IDX558">резервное копирование</A>
<LI><A HREF="manual.ru.html#IDX562">резервное копирование, базы данных</A>, <A HREF="manual.ru.html#IDX792">резервное копирование, базы данных</A>, <A HREF="manual.ru.html#IDX796">резервное копирование, базы данных</A>
<LI><A HREF="manual.ru.html#IDX185">родная поддержка потоков</A>
<LI><A HREF="manual.ru.html#IDX1716">родные функции, добавление</A>
<LI><A HREF="manual.ru.html#IDX9">руководство, доступные форматы</A>
<LI><A HREF="manual.ru.html#IDX8">руководство, онлайн</A>
<LI><A HREF="manual.ru.html#IDX11">руководство, типографские соглашения</A>
<LI><A HREF="manual.ru.html#IDX1745">сбои, повторяющиеся</A>
<LI><A HREF="manual.ru.html#IDX1671">сборка, клиентские программы</A>
<LI><A HREF="manual.ru.html#IDX294">сценарий <code>mysql_install_db</code></A>
<LI><A HREF="manual.ru.html#IDX6">сценарий <code>mysqlbug</code>, расположение</A>
<LI><A HREF="manual.ru.html#IDX46">сертификация</A>
<LI><A HREF="manual.ru.html#IDX47">сертификация MySQL</A>
<LI><A HREF="manual.ru.html#IDX920">сервер <code>mysqld</code>, размер буфера</A>
<LI><A HREF="manual.ru.html#IDX368">сервер, отсоединение</A>
<LI><A HREF="manual.ru.html#IDX291">сервер, перезапуск</A>
<LI><A HREF="manual.ru.html#IDX367">сервер, соединение</A>, <A HREF="manual.ru.html#IDX477">сервер, соединение</A>
<LI><A HREF="manual.ru.html#IDX451">сервера, несколько</A>
<LI><A HREF="manual.ru.html#IDX80">сервисы провайдеров</A>
<LI><A HREF="manual.ru.html#IDX81">сервисы, провайдеры</A>
<LI><A HREF="manual.ru.html#IDX82">сервисы, веб</A>
<LI><A HREF="manual.ru.html#IDX488">сетевая маска, в таблице <code>mysql.user</code></A>
<LI><A HREF="manual.ru.html#IDX93">сетевой этикет</A>, <A HREF="manual.ru.html#IDX108">сетевой этикет</A>
<LI><A HREF="manual.ru.html#IDX196">схемы установки</A>
<LI><A HREF="manual.ru.html#IDX937">символические ссылки</A>
<LI><A HREF="manual.ru.html#IDX334">символьные ссылки</A>
<LI><A HREF="manual.ru.html#IDX944">символы экранирования</A>
<LI><A HREF="manual.ru.html#IDX658">символы, многобайтовые</A>
<LI><A HREF="manual.ru.html#IDX15">синтаксис команд</A>
<LI><A HREF="manual.ru.html#IDX14">синтаксис оболочки</A>
<LI><A HREF="manual.ru.html#IDX463">система безопастности</A>
<LI><A HREF="manual.ru.html#IDX471">система привелегий, описание</A>
<LI><A HREF="manual.ru.html#IDX469">система привилегий</A>
<LI><A HREF="manual.ru.html#IDX458">система, безопастность</A>
<LI><A HREF="manual.ru.html#IDX467">система, права</A>
<LI><A HREF="manual.ru.html#IDX468">система, привилегии</A>
<LI><A HREF="manual.ru.html#IDX857">системная таблица</A>
<LI><A HREF="manual.ru.html#IDX990">системные переменные</A>
<LI><A HREF="manual.ru.html#IDX1002">скобки, квадратные</A>
<LI><A HREF="manual.ru.html#IDX927">скорость, компиляция</A>
<LI><A HREF="manual.ru.html#IDX928">скорость, линкование</A>
<LI><A HREF="manual.ru.html#IDX826">скорость, увеличение</A>
<LI><A HREF="manual.ru.html#IDX874">скорость, вставка</A>
<LI><A HREF="manual.ru.html#IDX854">скорость, запросов</A>, <A HREF="manual.ru.html#IDX864">скорость, запросов</A>
<LI><A HREF="manual.ru.html#IDX219">скрипт <code>configure</code></A>
<LI><A HREF="manual.ru.html#IDX295">скрипт <code>mysql_install_db</code></A>
<LI><A HREF="manual.ru.html#IDX100">скрипт <code>mysqlbug</code></A>
<LI><A HREF="manual.ru.html#IDX668">скрипты</A>, <A HREF="manual.ru.html#IDX672">скрипты</A>, <A HREF="manual.ru.html#IDX719">скрипты</A>
<LI><A HREF="manual.ru.html#IDX333">соединение через SSH</A>
<LI><A HREF="manual.ru.html#IDX485">соединение, проверка</A>
<LI><A HREF="manual.ru.html#IDX365">соединение, с сервером</A>, <A HREF="manual.ru.html#IDX474">соединение, с сервером</A>
<LI><A HREF="manual.ru.html#IDX486">соединение, верификация</A>
<LI><A HREF="manual.ru.html#IDX13">соглашения, типографские</A>
<LI><A HREF="manual.ru.html#IDX647">сообдения, языки</A>
<LI><A HREF="manual.ru.html#IDX807">сообщение об ошибках, просмотр</A>
<LI><A HREF="manual.ru.html#IDX1739">сообщение об ошибке, can't find file</A>
<LI><A HREF="manual.ru.html#IDX89">сообщения о, ошибки</A>
<LI><A HREF="manual.ru.html#IDX102">сообщения об ошибках, адрес электронной почты</A>
<LI><A HREF="manual.ru.html#IDX646">сообщения об ошибках, языки</A>
<LI><A HREF="manual.ru.html#IDX498">соритровка, таблицы привелегий</A>
<LI><A HREF="manual.ru.html#IDX394">сортировка, данные</A>
<LI><A HREF="manual.ru.html#IDX645">сортировка, кодировка</A>
<LI><A HREF="manual.ru.html#IDX642">сортировка, набор символов</A>
<LI><A HREF="manual.ru.html#IDX393">сортировка, строки таблицы</A>
<LI><A HREF="manual.ru.html#IDX492">сортировка, таблица привилегий</A>
<LI><A HREF="manual.ru.html#IDX1442">составной индекс</A>
<LI><A HREF="manual.ru.html#IDX119">советы</A>
<LI><A HREF="manual.ru.html#IDX878">советы, оптимизация</A>
<LI><A HREF="manual.ru.html#IDX1450">совместимость Oracle</A>
<LI><A HREF="manual.ru.html#IDX1199">совместимость с mSQL</A>
<LI><A HREF="manual.ru.html#IDX1018">совместимость с ODBC</A>, <A HREF="manual.ru.html#IDX1098">совместимость с ODBC</A>, <A HREF="manual.ru.html#IDX1119">совместимость с ODBC</A>, <A HREF="manual.ru.html#IDX1379">совместимость с ODBC</A>, <A HREF="manual.ru.html#IDX1409">совместимость с ODBC</A>
<LI><A HREF="manual.ru.html#IDX124">совместимость с Oracle</A>
<LI><A HREF="manual.ru.html#IDX125">совместимость с PostgreSQL</A>
<LI><A HREF="manual.ru.html#IDX1447">совместимость с Sybase</A>
<LI><A HREF="manual.ru.html#IDX115">совместимость со стандартами</A>
<LI><A HREF="manual.ru.html#IDX313">совместимость, между версиями MySQL</A>, <A HREF="manual.ru.html#IDX316">совместимость, между версиями MySQL</A>, <A HREF="manual.ru.html#IDX318">совместимость, между версиями MySQL</A>, <A HREF="manual.ru.html#IDX320">совместимость, между версиями MySQL</A>
<LI><A HREF="manual.ru.html#IDX114">совместимость, с ANSI SQL</A>
<LI><A HREF="manual.ru.html#IDX375">создание, базы данных</A>
<LI><A HREF="manual.ru.html#IDX437">создание, параметры запуска по умолчанию</A>
<LI><A HREF="manual.ru.html#IDX379">создание, таблицы</A>
<LI><A HREF="manual.ru.html#IDX91">списки рассылки MySQL</A>
<LI><A HREF="manual.ru.html#IDX94">списки рассылки, архивы</A>
<LI><A HREF="manual.ru.html#IDX110">списки рассылки, рекомендации</A>
<LI><A HREF="manual.ru.html#IDX5">список рассылки</A>, <A HREF="manual.ru.html#IDX92">список рассылки</A>
<LI><A HREF="manual.ru.html#IDX156">список задач к выполнению</A>
<LI><A HREF="manual.ru.html#IDX1788">спонсоры MySQL</A>
<LI><A HREF="manual.ru.html#IDX402">сравнение по шаблонам</A>
<LI><A HREF="manual.ru.html#IDX1194">сравнение строк, чувствительность к регистру</A>
<LI><A HREF="manual.ru.html#IDX159">сравнение, MySQL и остальные</A>
<LI><A HREF="manual.ru.html#IDX403">сравнение, шаблоны</A>
<LI><A HREF="manual.ru.html#IDX1435">ссылки</A>
<LI><A HREF="manual.ru.html#IDX183">ссылки для загрузки MySQL</A>
<LI><A HREF="manual.ru.html#IDX938">ссылки, символические</A>
<LI><A HREF="manual.ru.html#IDX32">стабильность</A>
<LI><A HREF="manual.ru.html#IDX309">старт и стоп</A>
<LI><A HREF="manual.ru.html#IDX622">статус, таблицы</A>
<LI><A HREF="manual.ru.html#IDX65">стоимость лицензирования</A>
<LI><A HREF="manual.ru.html#IDX66">стоимость поддержки</A>
<LI><A HREF="manual.ru.html#IDX64">стоимость, поддержка</A>
<LI><A HREF="manual.ru.html#IDX1075">столбцы, другие типы</A>
<LI><A HREF="manual.ru.html#IDX974">столбцы, имена</A>
<LI><A HREF="manual.ru.html#IDX901">столбцы, индексы</A>
<LI><A HREF="manual.ru.html#IDX1782">столбцы, изменить</A>
<LI><A HREF="manual.ru.html#IDX805">столбцы, просмотр</A>
<LI><A HREF="manual.ru.html#IDX996">столбцы, типы</A>
<LI><A HREF="manual.ru.html#IDX1077">столбцы, требования к памяти</A>
<LI><A HREF="manual.ru.html#IDX389">столбцы, выборка</A>
<LI><A HREF="manual.ru.html#IDX1763">столбец типа DATE, проблемы</A>
<LI><A HREF="manual.ru.html#IDX1423">столбец, изменение</A>
<LI><A HREF="manual.ru.html#IDX141">строка, блокировка</A>
<LI><A HREF="manual.ru.html#IDX941">строки, определение</A>
<LI><A HREF="manual.ru.html#IDX405">строки, подсчет</A>
<LI><A HREF="manual.ru.html#IDX392">строки, сортировка</A>
<LI><A HREF="manual.ru.html#IDX1061">строки, типы</A>
<LI><A HREF="manual.ru.html#IDX1774">строки, удаление</A>
<LI><A HREF="manual.ru.html#IDX1777">строки, удовлетворять условиям поиска</A>
<LI><A HREF="manual.ru.html#IDX657">строки, упорядочивание</A>
<LI><A HREF="manual.ru.html#IDX387">строки, выборка</A>
<LI><A HREF="manual.ru.html#IDX942">строки, экранируемые символы</A>
<LI><A HREF="manual.ru.html#IDX143">строчная блокировка</A>
<LI><A HREF="manual.ru.html#IDX198">структура каталогов, по умолчанию</A>
<LI><A HREF="manual.ru.html#IDX527">суперпользователь</A>
<LI><A HREF="manual.ru.html#IDX686">сжатые таблицы</A>, <A HREF="manual.ru.html#IDX1482">сжатые таблицы</A>
<LI><A HREF="manual.ru.html#IDX784">сьрос таблиц</A>
<LI><A HREF="manual.ru.html#IDX503">таблица <code>host</code></A>
<LI><A HREF="manual.ru.html#IDX493">таблица <code>user</code>, сортировка</A>
<LI><A HREF="manual.ru.html#IDX504">таблица, <code>host</code></A>
<LI><A HREF="manual.ru.html#IDX1780">таблица, изменение</A>
<LI><A HREF="manual.ru.html#IDX859">таблица, константа</A>
<LI><A HREF="manual.ru.html#IDX1439">таблица, удаление</A>
<LI><A HREF="manual.ru.html#IDX390">таблица, выборка столбцов</A>
<LI><A HREF="manual.ru.html#IDX137">таблицы <code>BDB</code></A>, <A HREF="manual.ru.html#IDX1470">таблицы <code>BDB</code></A>
<LI><A HREF="manual.ru.html#IDX1471">таблицы <code>BerkeleyDB</code></A>
<LI><A HREF="manual.ru.html#IDX499">таблицы <code>db</code>, сортировка</A>
<LI><A HREF="manual.ru.html#IDX1472">таблицы <code>HEAP</code></A>
<LI><A HREF="manual.ru.html#IDX500">таблицы <code>host</code>, сортировка</A>
<LI><A HREF="manual.ru.html#IDX136">таблицы <code>InnoDB</code></A>, <A HREF="manual.ru.html#IDX1474">таблицы <code>InnoDB</code></A>
<LI><A HREF="manual.ru.html#IDX1473">таблицы <code>ISAM</code></A>
<LI><A HREF="manual.ru.html#IDX1475">таблицы <code>MERGE</code></A>
<LI><A HREF="manual.ru.html#IDX1486">таблицы MERGE, определение</A>
<LI><A HREF="manual.ru.html#IDX1476">таблицы <code>MyISAM</code></A>
<LI><A HREF="manual.ru.html#IDX532">таблицы привелегий, пересоздать</A>
<LI><A HREF="manual.ru.html#IDX497">таблицы привелегий, сортировка</A>
<LI><A HREF="manual.ru.html#IDX508">таблицы привилегий</A>
<LI><A HREF="manual.ru.html#IDX491">таблицы привилегий, сортировка</A>
<LI><A HREF="manual.ru.html#IDX1493">таблицы, <code>BDB</code></A>
<LI><A HREF="manual.ru.html#IDX1494">таблицы, <code>Berkeley DB</code></A>
<LI><A HREF="manual.ru.html#IDX1488">таблицы, HEAP</A>
<LI><A HREF="manual.ru.html#IDX1487">таблицы, ISAM</A>
<LI><A HREF="manual.ru.html#IDX881">таблицы, блокировка</A>
<LI><A HREF="manual.ru.html#IDX791">таблицы, дамп</A>, <A HREF="manual.ru.html#IDX795">таблицы, дамп</A>
<LI><A HREF="manual.ru.html#IDX587">таблицы, дефрагментация</A>, <A HREF="manual.ru.html#IDX592">таблицы, дефрагментация</A>, <A HREF="manual.ru.html#IDX1480">таблицы, дефрагментация</A>
<LI><A HREF="manual.ru.html#IDX1479">таблицы, динамические</A>
<LI><A HREF="manual.ru.html#IDX593">таблицы, фрагментация</A>
<LI><A HREF="manual.ru.html#IDX972">таблицы, имена</A>
<LI><A HREF="manual.ru.html#IDX588">таблицы, информация</A>
<LI><A HREF="manual.ru.html#IDX1420">таблицы, изменение</A>
<LI><A HREF="manual.ru.html#IDX1784">таблицы, изменение порядка столбцов</A>
<LI><A HREF="manual.ru.html#IDX34">таблицы, максимальный размер</A>
<LI><A HREF="manual.ru.html#IDX585">таблицы, настройка профилактики</A>
<LI><A HREF="manual.ru.html#IDX408">таблицы, несколько</A>
<LI><A HREF="manual.ru.html#IDX1485">таблицы, объединение</A>
<LI><A HREF="manual.ru.html#IDX582">таблицы, оптимизация</A>
<LI><A HREF="manual.ru.html#IDX909">таблицы, открытие</A>
<LI><A HREF="manual.ru.html#IDX906">таблицы, открытые</A>
<LI><A HREF="manual.ru.html#IDX134">таблицы, поддерживающие транзакции</A>
<LI><A HREF="manual.ru.html#IDX406">таблицы, подсчет строк</A>
<LI><A HREF="manual.ru.html#IDX410">таблицы, получение информации</A>
<LI><A HREF="manual.ru.html#IDX509">таблицы, права</A>
<LI><A HREF="manual.ru.html#IDX507">таблицы, привелегии</A>
<LI><A HREF="manual.ru.html#IDX804">таблицы, просмотр</A>
<LI><A HREF="manual.ru.html#IDX571">таблицы, проверка</A>
<LI><A HREF="manual.ru.html#IDX578">таблицы, проверка ошибок</A>
<LI><A HREF="manual.ru.html#IDX580">таблицы, ремонт</A>
<LI><A HREF="manual.ru.html#IDX785">таблицы, сброс</A>
<LI><A HREF="manual.ru.html#IDX940">таблицы, символические ссылки</A>
<LI><A HREF="manual.ru.html#IDX858">таблицы, система</A>
<LI><A HREF="manual.ru.html#IDX914">таблицы, слишком много</A>
<LI><A HREF="manual.ru.html#IDX395">таблицы, сортировка строк</A>
<LI><A HREF="manual.ru.html#IDX378">таблицы, создание</A>
<LI><A HREF="manual.ru.html#IDX621">таблицы, статус</A>
<LI><A HREF="manual.ru.html#IDX687">таблицы, сжатие</A>
<LI><A HREF="manual.ru.html#IDX1481">таблицы, сжатый формат</A>
<LI><A HREF="manual.ru.html#IDX1775">таблицы, удаление строк</A>
<LI><A HREF="manual.ru.html#IDX889">таблицы, улучшение производительности</A>
<LI><A HREF="manual.ru.html#IDX384">таблицы, выборка данных</A>
<LI><A HREF="manual.ru.html#IDX388">таблицы, выборка строк</A>
<LI><A HREF="manual.ru.html#IDX381">таблицы, загрузка данных</A>
<LI><A HREF="manual.ru.html#IDX910">таблицы, закрытие</A>
<LI><A HREF="manual.ru.html#IDX1397">таймаут</A>
<LI><A HREF="manual.ru.html#IDX104">техническая поддержка, адрес электронной почты</A>
<LI><A HREF="manual.ru.html#IDX71">техническая поддержка, лицензирование</A>
<LI><A HREF="manual.ru.html#IDX800">текстовые файлы, импорт</A>
<LI><A HREF="manual.ru.html#IDX362">терминальный монитор, определение</A>
<LI><A HREF="manual.ru.html#IDX1691">тестирование mysqld, mysqltest</A>
<LI><A HREF="manual.ru.html#IDX287">тестирование сервера</A>
<LI><A HREF="manual.ru.html#IDX288">тестирование, инсталляция</A>
<LI><A HREF="manual.ru.html#IDX284">тестирование, послеустановочная настройка</A>
<LI><A HREF="manual.ru.html#IDX487">тестирование, соединение с сервером</A>
<LI><A HREF="manual.ru.html#IDX195">тестирование, выпуск MySQL</A>
<LI><A HREF="manual.ru.html#IDX850">тесты</A>
<LI><A HREF="manual.ru.html#IDX1052">тип дата, Y2K проблема</A>
<LI><A HREF="manual.ru.html#IDX1080">тип даты</A>
<LI><A HREF="manual.ru.html#IDX1081">тип времени</A>
<LI><A HREF="manual.ru.html#IDX12">типографские соглашения</A>
<LI><A HREF="manual.ru.html#IDX1588">типы данных</A>
<LI><A HREF="manual.ru.html#IDX1050">типы данных даты и времени</A>
<LI><A HREF="manual.ru.html#IDX1589">типы данных, C</A>
<LI><A HREF="manual.ru.html#IDX1096">типы конвертирования</A>
<LI><A HREF="manual.ru.html#IDX62">типы поддержки</A>
<LI><A HREF="manual.ru.html#IDX1469">типы таблиц MySQL</A>
<LI><A HREF="manual.ru.html#IDX1468">типы таблиц, выбор</A>
<LI><A HREF="manual.ru.html#IDX1049">типы, дата и время</A>
<LI><A HREF="manual.ru.html#IDX1073">типы, портативность</A>
<LI><A HREF="manual.ru.html#IDX997">типы, столбцы</A>, <A HREF="manual.ru.html#IDX1071">типы, столбцы</A>
<LI><A HREF="manual.ru.html#IDX1060">типы, строки</A>
<LI><A HREF="manual.ru.html#IDX1079">типы, число</A>
<LI><A HREF="manual.ru.html#IDX88">торговые марки</A>
<LI><A HREF="manual.ru.html#IDX132">транзакции, поддержка</A>, <A HREF="manual.ru.html#IDX1489">транзакции, поддержка</A>
<LI><A HREF="manual.ru.html#IDX133">транзакционно-безопасные таблицы</A>
<LI><A HREF="manual.ru.html#IDX1491">транзакионно-безопасные таблицы</A>
<LI><A HREF="manual.ru.html#IDX1490">транзакионные таблицы</A>
<LI><A HREF="manual.ru.html#IDX1076">требования к памяти, типы столбцов</A>
<LI><A HREF="manual.ru.html#IDX1689">треды</A>
<LI><A HREF="manual.ru.html#IDX44">тренинги</A>
<LI><A HREF="manual.ru.html#IDX45">тренинги MySQL</A>
<LI><A HREF="manual.ru.html#IDX146">триггеры</A>
<LI><A HREF="manual.ru.html#IDX1406">удаление базы данных</A>
<LI><A HREF="manual.ru.html#IDX1427">удаление индекса</A>, <A HREF="manual.ru.html#IDX1444">удаление индекса</A>
<LI><A HREF="manual.ru.html#IDX1438">удаление таблицы</A>
<LI><A HREF="manual.ru.html#IDX1753">удаление, <code>mysql.sock</code></A>
<LI><A HREF="manual.ru.html#IDX1699">удаление, функция</A>
<LI><A HREF="manual.ru.html#IDX1773">удаление, строки</A>
<LI><A HREF="manual.ru.html#IDX887">уменьшение, размер данных</A>
<LI><A HREF="manual.ru.html#IDX1666">уникальное значение для последней записи</A>
<LI><A HREF="manual.ru.html#IDX1664">уникальный ID</A>
<LI><A HREF="manual.ru.html#IDX656">упорядочивание строк</A>
<LI><A HREF="manual.ru.html#IDX484">управление доступом</A>
<LI><A HREF="manual.ru.html#IDX544">установить, пароль</A>
<LI><A HREF="manual.ru.html#IDX205">установка бинарного дистрибутива</A>
<LI><A HREF="manual.ru.html#IDX170">установка, обзор</A>
<LI><A HREF="manual.ru.html#IDX213">установка, поставка исходных текстов</A>
<LI><A HREF="manual.ru.html#IDX197">установка, схема</A>
<LI><A HREF="manual.ru.html#IDX717">утилита коммандной строки</A>
<LI><A HREF="manual.ru.html#IDX161">утилиты MySQL, конвертация</A>
<LI><A HREF="manual.ru.html#IDX671">утилиты, mysqld_multi</A>
<LI><A HREF="manual.ru.html#IDX667">утилиты, safe_mysqld</A>
<LI><A HREF="manual.ru.html#IDX837">увеливение, производительность</A>
<LI><A HREF="manual.ru.html#IDX825">увеличение, скорость</A>
<LI><A HREF="manual.ru.html#IDX361">учебное пособие</A>
<LI><A HREF="manual.ru.html#IDX472">учет регистра, проверка доступа</A>
<LI><A HREF="manual.ru.html#IDX819">журнал медленных запросов</A>
<LI><A HREF="manual.ru.html#IDX814">журнал обновлений</A>
<LI><A HREF="manual.ru.html#IDX812">журнал запросов</A>
<LI><A HREF="manual.ru.html#IDX559">журнальные файлы</A>
<LI><A HREF="manual.ru.html#IDX58">вакансии на MySQL</A>
<LI><A HREF="manual.ru.html#IDX86">веб-сервер, работа</A>
<LI><A HREF="manual.ru.html#IDX193">версии и выпуски, именование номеров версий</A>
<LI><A HREF="manual.ru.html#IDX200">версии, обновления</A>
<LI><A HREF="manual.ru.html#IDX179">версия MySQL</A>
<LI><A HREF="manual.ru.html#IDX180">версия, последняя</A>
<LI><A HREF="manual.ru.html#IDX127">вложенные запросы</A>
<LI><A HREF="manual.ru.html#IDX414">внешние ключи</A>
<LI><A HREF="manual.ru.html#IDX260">внутренние ошибки компилятора</A>
<LI><A HREF="manual.ru.html#IDX1687">внутренности MySQL</A>
<LI><A HREF="manual.ru.html#IDX879">внутреняя блокировка</A>
<LI><A HREF="manual.ru.html#IDX154">вопросы дизайна</A>
<LI><A HREF="manual.ru.html#IDX934">вопросы относящиеся к диску</A>
<LI><A HREF="manual.ru.html#IDX576">восстановление, после аварии</A>
<LI><A HREF="manual.ru.html#IDX30">возможности MySQL</A>
<LI><A HREF="manual.ru.html#IDX399">возраст, вычисление</A>
<LI><A HREF="manual.ru.html#IDX1785">временные таблицы, проблемы</A>
<LI><A HREF="manual.ru.html#IDX297">временный файл, доступ для записи</A>
<LI><A HREF="manual.ru.html#IDX1082">время, тип</A>
<LI><A HREF="manual.ru.html#IDX875">вставка, скорость</A>
<LI><A HREF="manual.ru.html#IDX371">ввод, запросов</A>
<LI><A HREF="manual.ru.html#IDX1072">выбор типов</A>
<LI><A HREF="manual.ru.html#IDX191">выбор версии</A>
<LI><A HREF="manual.ru.html#IDX376">выбор, база данных</A>
<LI><A HREF="manual.ru.html#IDX385">выборка, данные из таблицы</A>
<LI><A HREF="manual.ru.html#IDX386">выгрузка, таблицы</A>
<LI><A HREF="manual.ru.html#IDX201">выходы обновлений</A>
<LI><A HREF="manual.ru.html#IDX178">выкачка</A>
<LI><A HREF="manual.ru.html#IDX194">выпуски, тестирование</A>
<LI><A HREF="manual.ru.html#IDX404">выражение, расширенное</A>
<LI><A HREF="manual.ru.html#IDX999">вывод, размер</A>
<LI><A HREF="manual.ru.html#IDX396">вычисление данных</A>
<LI><A HREF="manual.ru.html#IDX397">вычисление, данные</A>
<LI><A HREF="manual.ru.html#IDX109">задавая вопросы</A>
<LI><A HREF="manual.ru.html#IDX177">загрузка</A>
<LI><A HREF="manual.ru.html#IDX380">загрузка, таблицы</A>
<LI><A HREF="manual.ru.html#IDX846">заказчики, MySQL</A>
<LI><A HREF="manual.ru.html#IDX912">закрытие, таблицы</A>
<LI><A HREF="manual.ru.html#IDX781">запросы</A>
<LI><A HREF="manual.ru.html#IDX861">запросы, оценка производительности</A>
<LI><A HREF="manual.ru.html#IDX412">запросы, примеры</A>
<LI><A HREF="manual.ru.html#IDX430">запросы, проект Близнецы</A>
<LI><A HREF="manual.ru.html#IDX852">запросы, скорость</A>
<LI><A HREF="manual.ru.html#IDX370">запросы, ввод</A>
<LI><A HREF="manual.ru.html#IDX286">запуск сервера</A>
<LI><A HREF="manual.ru.html#IDX306">запуск сервера, автоматический</A>
<LI><A HREF="manual.ru.html#IDX1736">запуск, <code>mysqld</code></A>
<LI><A HREF="manual.ru.html#IDX305">запуск, автоматический</A>
<LI><A HREF="manual.ru.html#IDX452">запуск, несколько серверов</A>
<LI><A HREF="manual.ru.html#IDX426">запуск, пакетный</A>
<LI><A HREF="manual.ru.html#IDX369">запуск, запросов</A>
<LI><A HREF="manual.ru.html#IDX995">зарезервированное слово</A>
<LI><A HREF="manual.ru.html#IDX993">зарезервированные слова</A>
<LI><A HREF="manual.ru.html#IDX182">зеркала сайта</A>
<LI><A HREF="manual.ru.html#IDX401">значение NULL</A>
<LI><A HREF="manual.ru.html#IDX1770">значение <code>NULL</code>, и столбцы <code>TIMESTAMP</code></A>
<LI><A HREF="manual.ru.html#IDX1057">значение времени, проблемы</A>
<LI><A HREF="manual.ru.html#IDX1765">значения <code>NULL</code></A>
<LI><A HREF="manual.ru.html#IDX1771">значения <code>NULL</code>, и столбцы <code>AUTO_INCREMENT</code></A>
<LI><A HREF="manual.ru.html#IDX31">значения по умолчанию</A>, <A HREF="manual.ru.html#IDX840">значения по умолчанию</A>, <A HREF="manual.ru.html#IDX1390">значения по умолчанию</A>, <A HREF="manual.ru.html#IDX1410">значения по умолчанию</A>
<LI><A HREF="manual.ru.html#IDX1066">значения по умолчанию, <code>BLOB</code> и <code>TEXT</code> столбцы</A>
<LI><A HREF="manual.ru.html#IDX238">значения по умолчанию, подавление</A>
<LI><A HREF="manual.ru.html#IDX897">шаблонные символы, и <code>LIKE</code></A>
<LI><A HREF="manual.ru.html#IDX502">шаблонные символы, в таблице <code>mysql.columns_priv</code></A>
<LI><A HREF="manual.ru.html#IDX495">шаблонные символы, в таблице <code>mysql.db</code></A>
<LI><A HREF="manual.ru.html#IDX496">шаблонные символы, в таблице <code>mysql.host</code></A>
<LI><A HREF="manual.ru.html#IDX501">шаблонные символы, в таблице <code>mysql.tables_priv</code></A>
<LI><A HREF="manual.ru.html#IDX961">экранирование двоичных данных</A>
<LI><A HREF="manual.ru.html#IDX1516">экранирование строк</A>
<LI><A HREF="manual.ru.html#IDX246">экспериментальное дерево исходных кодов</A>
<LI><A HREF="manual.ru.html#IDX962">числа</A>
<LI><A HREF="manual.ru.html#IDX1014">число с плавающей точкой</A>
<LI><A HREF="manual.ru.html#IDX965">число с плавающей запятой</A>
<LI><A HREF="manual.ru.html#IDX1078">числовые типы</A>
<LI><A HREF="manual.ru.html#IDX1758">чувствиетльность к регистру, в поиске</A>
<LI><A HREF="manual.ru.html#IDX981">чувствительность к регистру, имена</A>
<LI><A HREF="manual.ru.html#IDX122">чувствительность к регистру, имена баз данных</A>
<LI><A HREF="manual.ru.html#IDX123">чувствительность к регистру, имена таблиц</A>
<LI><A HREF="manual.ru.html#IDX1193">чувствительность к регистру, сравнение строк</A>
<LI><A HREF="manual.ru.html#IDX489">Анонимный пользователь</A>, <A HREF="manual.ru.html#IDX494">Анонимный пользователь</A>
<LI><A HREF="manual.ru.html#IDX429">Близнецы, запросы</A>
<LI><A HREF="manual.ru.html#IDX40">Год 2000, проблема</A>
<LI><A HREF="manual.ru.html#IDX1478">Характеристики динамических таблиц</A>
<LI><A HREF="manual.ru.html#IDX1760">Китайский</A>
<LI><A HREF="manual.ru.html#IDX1462">Кэш запросов</A>
<LI><A HREF="manual.ru.html#IDX1686">Оболочка Eiffel</A>
<LI><A HREF="manual.ru.html#IDX1792">Переменные окружения, список</A>
<LI><A HREF="manual.ru.html#IDX1789">Перенос, на другие системы</A>
<LI><A HREF="manual.ru.html#IDX1790">Порт, на другие системы</A>
<LI><A HREF="manual.ru.html#IDX1791">Портирование, на другие системы</A>
<LI><A HREF="manual.ru.html#IDX1708">Последовательность вызова UDF, агрегатные функции</A>
<LI><A HREF="manual.ru.html#IDX1707">Последовательность вызова UDF, простые функции</A>
<LI><A HREF="manual.ru.html#IDX283">Послеустановочная настройка, тестирование</A>
<LI><A HREF="manual.ru.html#IDX149">Представления</A>
<LI><A HREF="manual.ru.html#IDX343">Проблемы инсталляции на Solaris</A>
<LI><A HREF="manual.ru.html#IDX1835">Регулярные выражения, MySQL</A>
<LI><A HREF="manual.ru.html#IDX1836">Регулярные выражения, определения</A>
<LI><A HREF="manual.ru.html#IDX169">Скорость работы MySQL и PostgreSQL</A>
<LI><A HREF="manual.ru.html#IDX168">Сравнение возможностей MySQL и PostgreSQL</A>
<LI><A HREF="manual.ru.html#IDX167">Стратегии развития MySQL и PostgreSQL</A>
<LI><A HREF="manual.ru.html#IDX443">Установка нескольких серверов</A>
<LI><A HREF="manual.ru.html#IDX147">Внешние ключи</A>
<LI><A HREF="manual.ru.html#IDX1682">Взаимодействие с Java</A>
<LI><A HREF="manual.ru.html#IDX444">Запуск нескольких серверов</A>
<LI><A HREF="manual.ru.html#IDX43">Что есть MySQL AB, определение</A>
<LI><A HREF="manual.ru.html#IDX553">Что такое X509/Сертификат?</A>
<LI><A HREF="manual.ru.html#IDX552">Что такое фиврование</A>
</DIR>

</P>

 </BODY>
 </HTML>
